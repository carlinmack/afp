<div id="Prelims">
<div class="head">
<h1>Theory Prelims</h1>
</div>
<pre class="source"><span class="comment1">(* Author: Alexander Maletzky *)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Preliminaries›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Prelims
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="../../polynomials/theories/#Utils">Polynomials.Utils</a> <a href="../../groebner_bases/theories/#General">Groebner_Bases.General</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Lists›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Sequences of Lists›</span></span>

<span class="keyword1" id="Prelims-list_seq_length_mono"><span class="command">lemma</span></span> list_seq_length_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">seq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> list"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="free">seq</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">#</span> <span class="free">seq</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">j</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">seq</span> <span class="free">i</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="free">seq</span> <span class="free">j</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">=</span> Suc <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> less_iff_Suc_add <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="free">j</span> <span class="main">=</span> Suc <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="skolem">k</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">k</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">seq</span> <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">#</span> <span class="free">seq</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">seq</span> <span class="main">(</span>Suc <span class="main">(</span><span class="free">i</span> <span class="main">+</span> Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">#</span> <span class="free">seq</span> <span class="main">(</span><span class="free">i</span> <span class="main">+</span> Suc <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">hence</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">seq</span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">#</span> <span class="free">seq</span> <span class="main">(</span>Suc <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">note</span></span> Suc
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">seq</span> <span class="main">(</span>Suc <span class="main">(</span><span class="free">i</span> <span class="main">+</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="free">seq</span> <span class="main">(</span>Suc <span class="main">(</span><span class="free">i</span> <span class="main">+</span> Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> list_seq_length_mono_weak<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">seq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> list"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="free">seq</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">#</span> <span class="free">seq</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="free">j</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">seq</span> <span class="free">i</span><span class="main">)</span> <span class="main">≤</span> length <span class="main">(</span><span class="free">seq</span> <span class="free">j</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> <span class="free">j</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">seq</span> <span class="free">i</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="free">seq</span> <span class="free">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> list_seq_length_mono<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Prelims-list_seq_indexE_length"><span class="command">lemma</span></span> list_seq_indexE_length<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">seq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> list"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="free">seq</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">#</span> <span class="free">seq</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">j</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="free">seq</span> <span class="free">j</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">i</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">thesis</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> length <span class="main">(</span><span class="free">seq</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms lessI <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="free">seq</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> list_seq_length_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 0<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="free">seq</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Suc<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">i</span> <span class="main">≤</span> length <span class="main">(</span><span class="free">seq</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms lessI <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="free">seq</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> list_seq_length_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Suc<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Prelims-list_seq_nth"><span class="command">lemma</span></span> list_seq_nth<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">seq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> list"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="free">seq</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">#</span> <span class="free">seq</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="free">seq</span> <span class="free">j</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">≤</span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rev <span class="main">(</span><span class="free">seq</span> <span class="free">k</span><span class="main">)</span> <span class="main">!</span> <span class="free">i</span> <span class="main">=</span> rev <span class="main">(</span><span class="free">seq</span> <span class="free">j</span><span class="main">)</span> <span class="main">!</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> <span class="free">j</span> <span class="main">+</span> <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> nat_le_iff_add <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="free">k</span> <span class="main">=</span> <span class="free">j</span> <span class="main">+</span> <span class="skolem">l</span>›</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">l</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">l</span><span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> assms<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> le_add1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">seq</span> <span class="free">j</span><span class="main">)</span> <span class="main">≤</span> length <span class="main">(</span><span class="free">seq</span> <span class="main">(</span><span class="free">j</span> <span class="main">+</span> <span class="skolem">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> list_seq_length_mono_weak<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="free">seq</span> <span class="main">(</span><span class="free">j</span> <span class="main">+</span> <span class="skolem">l</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">seq</span> <span class="main">(</span>Suc <span class="main">(</span><span class="free">j</span> <span class="main">+</span> <span class="skolem">l</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">#</span> <span class="free">seq</span> <span class="main">(</span><span class="free">j</span> <span class="main">+</span> <span class="skolem">l</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nth_append i Suc<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> list_seq_nth'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">seq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> list"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="free">seq</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">#</span> <span class="free">seq</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="free">seq</span> <span class="free">j</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="free">seq</span> <span class="free">k</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rev <span class="main">(</span><span class="free">seq</span> <span class="free">k</span><span class="main">)</span> <span class="main">!</span> <span class="free">i</span> <span class="main">=</span> rev <span class="main">(</span><span class="free">seq</span> <span class="free">j</span><span class="main">)</span> <span class="main">!</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> linorder_cases<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">≤</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">,</span> 2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> list_seq_nth<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> <span class="free">j</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≤</span> <span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">,</span> 3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rev <span class="main">(</span><span class="free">seq</span> <span class="free">j</span><span class="main">)</span> <span class="main">!</span> <span class="free">i</span> <span class="main">=</span> rev <span class="main">(</span><span class="free">seq</span> <span class="free">k</span><span class="main">)</span> <span class="main">!</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> list_seq_nth<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> HOL.sym<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">=</span> <span class="free">k</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> filter<span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1" id="Prelims-filter_merge_wrt_1"><span class="command">lemma</span></span> filter_merge_wrt_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> set <span class="free">ys</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">y</span> <span class="main">⟹</span> False"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"filter <span class="free">P</span> <span class="main">(</span>merge_wrt <span class="free">rel</span> <span class="free">xs</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> filter <span class="free">P</span> <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">rel</span></span> <span class="quoted"><span class="free">xs</span></span> <span class="quoted"><span class="free">ys</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> merge_wrt.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">rel</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">rel</span> <span class="skolem">y</span> <span class="skolem">ys</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">y</span> <span class="main">⟹</span> False"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> set <span class="skolem">ys</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">z</span> <span class="main">⟹</span> False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> filter_empty_conv<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">rel</span> <span class="skolem">x</span> <span class="skolem">xs</span> <span class="skolem">y</span> <span class="skolem">ys</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">P</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> set <span class="skolem">ys</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">z</span> <span class="main">⟹</span> False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"filter <span class="free">P</span> <span class="main">(</span>merge_wrt <span class="skolem">rel</span> <span class="skolem">xs</span> <span class="skolem">ys</span><span class="main">)</span> <span class="main">=</span> filter <span class="free">P</span> <span class="skolem">xs</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 3<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"filter <span class="free">P</span> <span class="main">(</span>merge_wrt <span class="skolem">rel</span> <span class="skolem">xs</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> filter <span class="free">P</span> <span class="skolem">xs</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rel</span> <span class="skolem">x</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> that 3<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 3<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"filter <span class="free">P</span> <span class="main">(</span>merge_wrt <span class="skolem">rel</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="skolem">ys</span><span class="main">)</span> <span class="main">=</span> filter <span class="free">P</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">rel</span> <span class="skolem">x</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> that x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 3<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a b c <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="free">P</span> <span class="skolem">y</span>›</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Prelims-filter_merge_wrt_2"><span class="command">lemma</span></span> filter_merge_wrt_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="free">xs</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">⟹</span> False"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"filter <span class="free">P</span> <span class="main">(</span>merge_wrt <span class="free">rel</span> <span class="free">xs</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> filter <span class="free">P</span> <span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">rel</span></span> <span class="quoted"><span class="free">xs</span></span> <span class="quoted"><span class="free">ys</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> merge_wrt.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">rel</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> filter_empty_conv<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">rel</span> <span class="skolem">y</span> <span class="skolem">ys</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">rel</span> <span class="skolem">x</span> <span class="skolem">xs</span> <span class="skolem">y</span> <span class="skolem">ys</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">P</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> set <span class="skolem">xs</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">z</span> <span class="main">⟹</span> False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"filter <span class="free">P</span> <span class="main">(</span>merge_wrt <span class="skolem">rel</span> <span class="skolem">xs</span> <span class="skolem">ys</span><span class="main">)</span> <span class="main">=</span> filter <span class="free">P</span> <span class="skolem">ys</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 3<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"filter <span class="free">P</span> <span class="main">(</span>merge_wrt <span class="skolem">rel</span> <span class="skolem">xs</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> filter <span class="free">P</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rel</span> <span class="skolem">x</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> that x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 3<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"filter <span class="free">P</span> <span class="main">(</span>merge_wrt <span class="skolem">rel</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="skolem">ys</span><span class="main">)</span> <span class="main">=</span> filter <span class="free">P</span> <span class="skolem">ys</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">rel</span> <span class="skolem">x</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> that 3<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 3<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a b c <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="free">P</span> <span class="skolem">x</span>›</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Prelims-length_filter_le_1"><span class="command">lemma</span></span> length_filter_le_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>filter <span class="free">P</span> <span class="free">xs</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="free">xs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> length <span class="free">xs</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span><span class="free">xs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span><span class="free">xs</span> <span class="main">!</span> <span class="free">j</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> <span class="free">j</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="skolem">thesis</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">&lt;</span> <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">&lt;</span> length <span class="free">xs</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">as</span> <span class="bound">bs</span> <span class="bound">cs</span><span class="main">.</span> <span class="bound">as</span> <span class="main">@</span> <span class="main">(</span><span class="main">(</span><span class="free">xs</span> <span class="main">!</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="bound">bs</span> <span class="main">@</span> <span class="main">(</span><span class="main">(</span><span class="free">xs</span> <span class="main">!</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">#</span> <span class="bound">cs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">⟹</span> <span class="skolem">thesis</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">thesis</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> that<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> that<span class="main">(</span>1<span class="main">,</span> 2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">&lt;</span> length <span class="free">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> that<span class="main">(</span>1<span class="main">,</span> 2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">-</span> Suc <span class="skolem">a</span> <span class="main">&lt;</span> length <span class="main">(</span>drop <span class="main">(</span>Suc <span class="skolem">a</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> that<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">&lt;</span> length <span class="free">xs</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">!</span> <span class="skolem">b</span> <span class="main">=</span> drop <span class="main">(</span>Suc <span class="skolem">a</span><span class="main">)</span> <span class="free">xs</span> <span class="main">!</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> Suc <span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>take <span class="skolem">a</span> <span class="free">xs</span><span class="main">)</span> <span class="main">@</span> <span class="main">(</span><span class="main">(</span><span class="free">xs</span> <span class="main">!</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="main">(</span>take <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> Suc <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span>drop <span class="main">(</span>Suc <span class="skolem">a</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">@</span> <span class="main">(</span><span class="main">(</span><span class="free">xs</span> <span class="main">!</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">#</span>
                  drop <span class="main">(</span>Suc <span class="main">(</span><span class="skolem">b</span> <span class="main">-</span> Suc <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>drop <span class="main">(</span>Suc <span class="skolem">a</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">xs</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> eq id_take_nth_drop<span class="main"><span class="main">[</span></span><span class="operator">OF</span> 1<span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> id_take_nth_drop<span class="main"><span class="main">[</span></span><span class="operator">OF</span> 2<span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> linorder_cases<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">j</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">as</span></span> <span class="skolem"><span class="skolem">bs</span></span> <span class="skolem"><span class="skolem">cs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">as</span> <span class="main">@</span> <span class="main">(</span><span class="main">(</span><span class="free">xs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="skolem">bs</span> <span class="main">@</span> <span class="main">(</span><span class="main">(</span><span class="free">xs</span> <span class="main">!</span> <span class="free">j</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">cs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">xs</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> *<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"filter <span class="free">P</span> <span class="free">xs</span> <span class="main">=</span> filter <span class="free">P</span> <span class="main">(</span><span class="skolem">as</span> <span class="main">@</span> <span class="main">(</span><span class="main">(</span><span class="free">xs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="skolem">bs</span> <span class="main">@</span> <span class="main">(</span><span class="main">(</span><span class="free">xs</span> <span class="main">!</span> <span class="free">j</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">cs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>4<span class="main">,</span> 5<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>filter <span class="free">P</span> <span class="skolem">as</span><span class="main">)</span> <span class="main">@</span> <span class="main">(</span><span class="main">(</span><span class="free">xs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="main">(</span>filter <span class="free">P</span> <span class="skolem">bs</span><span class="main">)</span> <span class="main">@</span> <span class="main">(</span><span class="main">(</span><span class="free">xs</span> <span class="main">!</span> <span class="free">j</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span>filter <span class="free">P</span> <span class="skolem">cs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> length <span class="main">(</span>filter <span class="free">P</span> <span class="free">xs</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> <span class="free">i</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">as</span></span> <span class="skolem"><span class="skolem">bs</span></span> <span class="skolem"><span class="skolem">cs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">as</span> <span class="main">@</span> <span class="main">(</span><span class="main">(</span><span class="free">xs</span> <span class="main">!</span> <span class="free">j</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="skolem">bs</span> <span class="main">@</span> <span class="main">(</span><span class="main">(</span><span class="free">xs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">cs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">xs</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> *<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"filter <span class="free">P</span> <span class="free">xs</span> <span class="main">=</span> filter <span class="free">P</span> <span class="main">(</span><span class="skolem">as</span> <span class="main">@</span> <span class="main">(</span><span class="main">(</span><span class="free">xs</span> <span class="main">!</span> <span class="free">j</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="skolem">bs</span> <span class="main">@</span> <span class="main">(</span><span class="main">(</span><span class="free">xs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">cs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>4<span class="main">,</span> 5<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>filter <span class="free">P</span> <span class="skolem">as</span><span class="main">)</span> <span class="main">@</span> <span class="main">(</span><span class="main">(</span><span class="free">xs</span> <span class="main">!</span> <span class="free">j</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="main">(</span>filter <span class="free">P</span> <span class="skolem">bs</span><span class="main">)</span> <span class="main">@</span> <span class="main">(</span><span class="main">(</span><span class="free">xs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span>filter <span class="free">P</span> <span class="skolem">cs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> length <span class="main">(</span>filter <span class="free">P</span> <span class="free">xs</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Prelims-length_filter_eq"><span class="command">lemma</span></span> length_filter_eq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>filter <span class="main">(</span><span class="main">(=)</span> <span class="free">x</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> count_list <span class="free">xs</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> drop<span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1" id="Prelims-nth_in_set_dropI"><span class="command">lemma</span></span> nth_in_set_dropI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">≤</span> <span class="free">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="free">xs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">!</span> <span class="free">i</span> <span class="main">∈</span> set <span class="main">(</span>drop <span class="free">j</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="free">j</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">j</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword1"><span class="command">with</span></span> Cons<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> drop0 nth_mem<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">j0</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> Cons<span class="main">(</span>2<span class="main">)</span> Suc_le_D <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i0</span></span> <span class="keyword2"><span class="keyword">where</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> Suc <span class="skolem">i0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> Cons<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j0</span> <span class="main">≤</span> <span class="skolem">i0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">=</span> Suc <span class="skolem">j0</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i0</span> <span class="main">&lt;</span> length <span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">!</span> <span class="skolem">i0</span> <span class="main">∈</span> set <span class="main">(</span>drop <span class="skolem">j0</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Cons<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">=</span> Suc <span class="skolem">j0</span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> count_list<span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1" id="Prelims-count_list_append"><span class="command">lemma</span></span> count_list_append <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"count_list <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> <span class="free">a</span> <span class="main">=</span> count_list <span class="free">xs</span> <span class="free">a</span> <span class="main">+</span> count_list <span class="free">ys</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1" id="Prelims-count_list_upt"><span class="command">lemma</span></span> count_list_upt <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"count_list <span class="main">[</span><span class="free">a</span><span class="main">..&lt;</span><span class="free">b</span><span class="main">]</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">a</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="free">b</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="free">a</span> <span class="main">+</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> le_Suc_ex <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">=</span> <span class="free">a</span> <span class="main">+</span> <span class="skolem">k</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">k</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> sorted_wrt<span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1" id="Prelims-sorted_wrt_upt_iff"><span class="command">lemma</span></span> sorted_wrt_upt_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted_wrt <span class="free">rel</span> <span class="main">[</span><span class="free">a</span><span class="main">..&lt;</span><span class="free">b</span><span class="main">]</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="free">a</span> <span class="main">≤</span> <span class="bound">i</span> <span class="main">⟶</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="bound">j</span> <span class="main">⟶</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">⟶</span> <span class="free">rel</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="free">b</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="free">a</span> <span class="main">+</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> le_Suc_ex <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">=</span> <span class="free">a</span> <span class="main">+</span> <span class="skolem">k</span>›</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">k</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sorted_wrt_append Suc<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> iffI allI ballI impI conjI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">≥</span><span class="free">a</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&gt;</span><span class="bound">i</span><span class="main">.</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="free">a</span> <span class="main">+</span> <span class="skolem">k</span> <span class="main">⟶</span> <span class="free">rel</span> <span class="bound">i</span> <span class="bound">j</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="free">a</span><span class="main">..&lt;</span><span class="free">a</span> <span class="main">+</span> <span class="skolem">k</span><span class="main">}</span><span class="main">.</span> <span class="free">rel</span> <span class="bound">x</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i'</span> <span class="bound">j'</span><span class="main">.</span> <span class="free">a</span> <span class="main">≤</span> <span class="bound">i'</span> <span class="main">⟹</span> <span class="bound">i'</span> <span class="main">&lt;</span> <span class="bound">j'</span> <span class="main">⟹</span> <span class="bound">j'</span> <span class="main">&lt;</span> <span class="free">a</span> <span class="main">+</span> <span class="skolem">k</span> <span class="main">⟹</span> <span class="free">rel</span> <span class="bound">i'</span> <span class="bound">j'</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">a</span> <span class="main">+</span> <span class="skolem">k</span> <span class="main">⟹</span> <span class="free">rel</span> <span class="bound">x</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">j</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> Suc <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="free">a</span> <span class="main">+</span> <span class="skolem">k</span> <span class="main">∨</span> <span class="skolem">j</span> <span class="main">=</span> <span class="free">a</span> <span class="main">+</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">rel</span> <span class="skolem">i</span> <span class="skolem">j</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="free">a</span> <span class="main">+</span> <span class="skolem">k</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≤</span> <span class="skolem">i</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">j</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 1<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">=</span> <span class="free">a</span> <span class="main">+</span> <span class="skolem">k</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≤</span> <span class="skolem">i</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">j</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">=</span> <span class="free">a</span> <span class="main">+</span> <span class="skolem">k</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 2<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">≥</span><span class="free">a</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&gt;</span><span class="bound">i</span><span class="main">.</span> <span class="bound">j</span> <span class="main">&lt;</span> Suc <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">rel</span> <span class="bound">i</span> <span class="bound">j</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="free">a</span> <span class="main">+</span> <span class="skolem">k</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">rel</span> <span class="skolem">i</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">..&lt;</span><span class="free">a</span> <span class="main">+</span> <span class="skolem">k</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> <span class="free">a</span> <span class="main">+</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">≥</span><span class="free">a</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&gt;</span><span class="bound">i</span><span class="main">.</span> <span class="bound">j</span> <span class="main">&lt;</span> Suc <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">rel</span> <span class="bound">i</span> <span class="bound">j</span>"</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">rel</span> <span class="skolem">x</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> insort_wrt<span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> merge_wrt<span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1" id="Prelims-map_insort_wrt"><span class="command">lemma</span></span> map_insort_wrt<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="free">xs</span> <span class="main">⟹</span> <span class="free">r2</span> <span class="main">(</span><span class="free">f</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">r1</span> <span class="free">y</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"map <span class="free">f</span> <span class="main">(</span>insort_wrt <span class="free">r1</span> <span class="free">y</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> insort_wrt <span class="free">r2</span> <span class="main">(</span><span class="free">f</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span>map <span class="free">f</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">(</span><span class="free">f</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">r1</span> <span class="free">y</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Cons<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map <span class="free">f</span> <span class="main">(</span>insort_wrt <span class="free">r1</span> <span class="free">y</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> insort_wrt <span class="free">r2</span> <span class="main">(</span><span class="free">f</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span>map <span class="free">f</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Cons<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x'</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">∈</span> set <span class="skolem">xs</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">(</span><span class="free">f</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">x'</span><span class="main">)</span> <span class="main">=</span> <span class="free">r1</span> <span class="free">y</span> <span class="skolem">x'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Cons<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Prelims-map_merge_wrt"><span class="command">lemma</span></span> map_merge_wrt<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> set <span class="free">xs</span> <span class="main">∩</span> <span class="free">f</span> <span class="main">`</span> set <span class="free">ys</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="free">xs</span> <span class="main">⟹</span> <span class="bound">y</span> <span class="main">∈</span> set <span class="free">ys</span> <span class="main">⟹</span> <span class="free">r2</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">r1</span> <span class="bound">x</span> <span class="bound">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"map <span class="free">f</span> <span class="main">(</span>merge_wrt <span class="free">r1</span> <span class="free">xs</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> merge_wrt <span class="free">r2</span> <span class="main">(</span>map <span class="free">f</span> <span class="free">xs</span><span class="main">)</span> <span class="main">(</span>map <span class="free">f</span> <span class="free">ys</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">r1</span></span> <span class="quoted"><span class="free">xs</span></span> <span class="quoted"><span class="free">ys</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> merge_wrt.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">uu</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">r1</span> <span class="skolem">v</span> <span class="skolem">va</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">r1</span> <span class="skolem">x</span> <span class="skolem">xs</span> <span class="skolem">y</span> <span class="skolem">ys</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 3<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="free">f</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> set <span class="skolem">xs</span> <span class="main">∩</span> <span class="free">f</span> <span class="main">`</span> set <span class="main">(</span><span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> set <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">∩</span> <span class="free">f</span> <span class="main">`</span> set <span class="skolem">ys</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> eq2<span class="main">:</span> <span class="quoted"><span class="quoted">"map <span class="free">f</span> <span class="main">(</span>merge_wrt <span class="skolem">r1</span> <span class="skolem">xs</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> merge_wrt <span class="free">r2</span> <span class="main">(</span>map <span class="free">f</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">(</span>map <span class="free">f</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r1</span> <span class="skolem">x</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>›</span></span> that 1
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> 3<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> set <span class="skolem">xs</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">⟷</span> <span class="skolem">r1</span> <span class="skolem">a</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 3<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> eq3<span class="main">:</span> <span class="quoted"><span class="quoted">"map <span class="free">f</span> <span class="main">(</span>merge_wrt <span class="skolem">r1</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="skolem">ys</span><span class="main">)</span> <span class="main">=</span> merge_wrt <span class="free">r2</span> <span class="main">(</span>map <span class="free">f</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>map <span class="free">f</span> <span class="skolem">ys</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">r1</span> <span class="skolem">x</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>›</span></span> that 2
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> 3<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> set <span class="skolem">ys</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">⟷</span> <span class="skolem">r1</span> <span class="skolem">a</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 3<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> eq4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">⟷</span> <span class="skolem">r1</span> <span class="skolem">x</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 3<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq2 eq3 eq4 <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="free">f</span> <span class="skolem">y</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>›</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Recursive Functions›</span></span>

<span class="keyword1"><span class="command">locale</span></span> recursive <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">h'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">b</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'b</span></span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> b_fixpoint<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h'</span> <span class="free">b</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">Q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">h</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">function</span></span> <span class="main">(</span>domintros<span class="main">)</span> <span class="entity">recfun_aux</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">recfun_aux</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">Q</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">then</span> <span class="free">g</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">else</span> <span class="free">h'</span> <span class="main">(</span><span class="free">recfun_aux</span> <span class="main">(</span><span class="free">h</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">pat_completeness</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemmas</span></span> <span class="main">[</span><span class="operator">induct</span> <span class="quasi_keyword">del</span><span class="main">]</span> <span class="main">=</span> recfun_aux.pinduct

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">dom</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">dom</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">k</span><span class="main">.</span> <span class="free">Q</span> <span class="main">(</span><span class="main">(</span><span class="free">h</span> <span class="main">^^</span> <span class="bound">k</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Prelims-domI"><span class="command">lemma</span></span> domI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">Q</span> <span class="free">x</span> <span class="main">⟹</span> dom <span class="main">(</span><span class="free">h</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"dom <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="free">x</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">(</span><span class="main">(</span><span class="free">h</span> <span class="main">^^</span> <span class="main">0</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> dom_def <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"dom <span class="main">(</span><span class="free">h</span> <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">(</span><span class="main">(</span><span class="free">h</span> <span class="main">^^</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">(</span><span class="free">h</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dom_def <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">(</span><span class="main">(</span><span class="free">h</span> <span class="main">^^</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> funpow_swap1<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> dom_def <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Prelims-domD"><span class="command">lemma</span></span> domD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dom <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">Q</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"dom <span class="main">(</span><span class="free">h</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">(</span><span class="main">(</span><span class="free">h</span> <span class="main">^^</span> <span class="skolem">k</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dom_def <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> funpow_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> Suc <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> nat.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> * <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">(</span><span class="main">(</span><span class="free">h</span> <span class="main">^^</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span><span class="free">h</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> funpow_swap1<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> dom_def <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Prelims-recfun_aux_domI"><span class="command">lemma</span></span> recfun_aux_domI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dom <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"recfun_aux_dom <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">(</span><span class="main">(</span><span class="free">h</span> <span class="main">^^</span> <span class="skolem">k</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dom_def <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">k</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> recfun_aux.domintros <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> Suc<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">(</span><span class="main">(</span><span class="free">h</span> <span class="main">^^</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">(</span><span class="free">h</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> funpow_swap1<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"recfun_aux_dom <span class="main">(</span><span class="free">h</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Suc<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> recfun_aux.domintros <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Prelims-recfun_aux_domD"><span class="command">lemma</span></span> recfun_aux_domD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"recfun_aux_dom <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"dom <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">x</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> recfun_aux.pinduct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="skolem">x</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">with</span></span> domI <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"dom <span class="main">(</span><span class="free">h</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 1<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> domI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> recfun_aux_dom_alt<span class="main">:</span> <span class="quoted"><span class="quoted">"recfun_aux_dom <span class="main">=</span> dom"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> recfun_aux_domI recfun_aux_domD<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted">"<span class="entity">fun</span>"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">fun</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> recfun_aux_dom <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">then</span> recfun_aux <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">else</span> <span class="free">b</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Prelims-simps"><span class="command">lemma</span></span> simps<span class="main">:</span> <span class="quoted"><span class="quoted">"fun <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">Q</span> <span class="free">x</span> <span class="keyword1">then</span> <span class="free">g</span> <span class="free">x</span> <span class="keyword1">else</span> <span class="free">h'</span> <span class="main">(</span>fun <span class="main">(</span><span class="free">h</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"dom <span class="free">x</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">hence</span></span> dom<span class="main">:</span> <span class="quoted"><span class="quoted">"recfun_aux_dom <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> recfun_aux_domI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="free">x</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">with</span></span> dom <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_def recfun_aux.psimps<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"recfun_aux_dom <span class="main">(</span><span class="free">h</span> <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> recfun_aux_domI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> domD<span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span> True<span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span> False<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_def dom False recfun_aux.psimps<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">Q</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"dom <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> domI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> False <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> dom <span class="main">(</span><span class="free">h</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"dom <span class="main">(</span><span class="free">h</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"dom <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> domI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> False <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> recfun_aux_dom_alt fun_def b_fixpoint <span class="quasi_keyword">split</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> if_split<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Prelims-eq_fixpointI"><span class="command">lemma</span></span> eq_fixpointI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> dom <span class="free">x</span> <span class="main">⟹</span> fun <span class="free">x</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_def recfun_aux_dom_alt<span class="main">)</span>

<span class="keyword1" id="Prelims-pinduct"><span class="command">lemma</span></span> pinduct<span class="main">:</span> <span class="quoted"><span class="quoted">"dom <span class="free">x</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> dom <span class="bound">x</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">¬</span> <span class="free">Q</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span><span class="free">h</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> recfun_aux_dom_alt<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> recfun_aux.pinduct<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* recursive *)</span>

<span class="keyword1"><span class="command">interpretation</span></span> tailrec<span class="main">:</span> recursive <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span>"</span></span> <span class="quoted">undefined</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span> refl<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Binary Relations›</span></span>

<span class="keyword1" id="Prelims-almost_full_on_Int"><span class="command">lemma</span></span> almost_full_on_Int<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"almost_full_on <span class="free">P1</span> <span class="free">A1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"almost_full_on <span class="free">P2</span> <span class="free">A2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"almost_full_on <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">P1</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">∧</span> <span class="free">P2</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="main">(</span><span class="free">A1</span> <span class="main">∩</span> <span class="free">A2</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"almost_full_on <span class="var">?P</span> <span class="var">?A</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> almost_full_onI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">i</span> <span class="main">∈</span> <span class="var">?A</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">i</span><span class="main">,</span> <span class="skolem">f</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"almost_full_on <span class="main">(</span>prod_le <span class="free">P1</span> <span class="free">P2</span><span class="main">)</span> <span class="main">(</span><span class="free">A1</span> <span class="main">×</span> <span class="free">A2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> almost_full_on_Sigma<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> a <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">A1</span> <span class="main">×</span> <span class="free">A2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> g_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"prod_le <span class="free">P1</span> <span class="free">P2</span> <span class="main">(</span><span class="skolem">g</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">g</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> almost_full_onD<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> g_def prod_le_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">j</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"good <span class="var">?P</span> <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> goodI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> almost_full_on_same<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"almost_full_on <span class="free">P1</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"almost_full_on <span class="free">P2</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"almost_full_on <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">P1</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">∧</span> <span class="free">P2</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"almost_full_on <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">P1</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">∧</span> <span class="free">P2</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> almost_full_on_Int<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">context</span></span> ord
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_le_rel</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_le_rel</span> <span class="free"><span class="bound"><span class="entity">rel</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">rel</span></span></span> <span class="main">=</span> <span class="main">(=)</span> <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">rel</span></span></span> <span class="main">=</span> <span class="main">(≤)</span> <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">rel</span></span></span> <span class="main">=</span> <span class="main">(&lt;)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Prelims-is_le_relI"><span class="command">lemma</span></span> is_le_relI <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"is_le_rel <span class="main">(=)</span>"</span></span> <span class="quoted"><span class="quoted">"is_le_rel <span class="main">(≤)</span>"</span></span> <span class="quoted"><span class="quoted">"is_le_rel <span class="main">(&lt;)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_le_rel_def<span class="main">)</span>

<span class="keyword1" id="Prelims-is_le_relE"><span class="command">lemma</span></span> is_le_relE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_le_rel <span class="free">rel</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="quoted"><span class="quoted">"<span class="free">rel</span> <span class="main">=</span> <span class="main">(=)</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">rel</span> <span class="main">=</span> <span class="main">(≤)</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">rel</span> <span class="main">=</span> <span class="main">(&lt;)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> is_le_rel_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* ord *)</span>

<span class="keyword1"><span class="command">context</span></span> preorder
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Prelims-is_le_rel_le"><span class="command">lemma</span></span> is_le_rel_le<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_le_rel <span class="free">rel</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">rel</span> <span class="free">x</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_le_relE<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> less_imp_le<span class="main">)</span>

<span class="keyword1" id="Prelims-is_le_rel_trans"><span class="command">lemma</span></span> is_le_rel_trans<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_le_rel <span class="free">rel</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">rel</span> <span class="free">x</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">rel</span> <span class="free">y</span> <span class="free">z</span> <span class="main">⟹</span> <span class="free">rel</span> <span class="free">x</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_le_relE<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> order_trans less_trans<span class="main">)</span>

<span class="keyword1" id="Prelims-is_le_rel_trans_le_left"><span class="command">lemma</span></span> is_le_rel_trans_le_left<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_le_rel <span class="free">rel</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">rel</span> <span class="free">y</span> <span class="free">z</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_le_relE<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> order_trans le_less_trans less_imp_le<span class="main">)</span>

<span class="keyword1" id="Prelims-is_le_rel_trans_le_right"><span class="command">lemma</span></span> is_le_rel_trans_le_right<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_le_rel <span class="free">rel</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">rel</span> <span class="free">x</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_le_relE<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> order_trans less_le_trans less_imp_le<span class="main">)</span>

<span class="keyword1" id="Prelims-is_le_rel_trans_less_left"><span class="command">lemma</span></span> is_le_rel_trans_less_left<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_le_rel <span class="free">rel</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">rel</span> <span class="free">y</span> <span class="free">z</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_le_relE<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> less_le_trans less_imp_le<span class="main">)</span>

<span class="keyword1" id="Prelims-is_le_rel_trans_less_right"><span class="command">lemma</span></span> is_le_rel_trans_less_right<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_le_rel <span class="free">rel</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">rel</span> <span class="free">x</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">&lt;</span> <span class="free">z</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_le_relE<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> le_less_trans less_imp_le<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* preorder *)</span>

<span class="keyword1"><span class="command">context</span></span> order
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Prelims-is_le_rel_distinct"><span class="command">lemma</span></span> is_le_rel_distinct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_le_rel <span class="free">rel</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">rel</span> <span class="free">x</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≠</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_le_relE<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Prelims-is_le_rel_antisym"><span class="command">lemma</span></span> is_le_rel_antisym<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_le_rel <span class="free">rel</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">rel</span> <span class="free">x</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">rel</span> <span class="free">y</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_le_relE<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* order *)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* theory *)</span>
</pre>
</div><div id="More_MPoly">
<div class="head">
<h1>Theory More_MPoly</h1>
</div>
<pre class="source"><span class="comment1">(* Author: Alexander Maletzky *)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹More Properties of Power-Products and Multivariate Polynomials›</span></span>

<span class="keyword1"><span class="command">theory</span></span> More_MPoly
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="#Prelims">Prelims</a> <a href="../../polynomials/theories/#MPoly_Type_Class_Ordered">Polynomials.MPoly_Type_Class_Ordered</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Power-Products›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> comm_powerprod<span class="main">)</span> minus_plus'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="keyword1">adds</span> <span class="free">t</span> <span class="main">⟹</span> <span class="free">u</span> <span class="main">+</span> <span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">u</span> <span class="main">+</span> <span class="free">t</span><span class="main">)</span> <span class="main">-</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> add_commute minus_plus <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">context</span></span> ulcs_powerprod
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="More_MPoly-lcs_alt_2"><span class="command">lemma</span></span> lcs_alt_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">+</span> <span class="free">x</span> <span class="main">=</span> <span class="free">b</span> <span class="main">+</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lcs <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="main">(</span><span class="free">b</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">-</span> gcs <span class="free">a</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">+</span> <span class="main">(</span>lcs <span class="free">x</span> <span class="free">y</span> <span class="main">+</span> gcs <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> lcs <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">+</span> gcs <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> lcs_plus_left <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> lcs <span class="main">(</span><span class="free">b</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">+</span> gcs <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>lcs <span class="free">a</span> <span class="free">b</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">+</span> gcs <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> lcs_plus_right lcs_comm<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>gcs <span class="free">a</span> <span class="free">b</span> <span class="main">+</span> lcs <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">+</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">a</span> <span class="main">+</span> <span class="main">(</span><span class="free">b</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> gcs_plus_lcs<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>lcs <span class="free">x</span> <span class="free">y</span> <span class="main">+</span> gcs <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">-</span> gcs <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> <span class="main">(</span><span class="free">b</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">-</span> gcs <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> lcs_alt_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">+</span> <span class="free">x</span> <span class="main">=</span> <span class="free">b</span> <span class="main">+</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lcs <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span> <span class="main">-</span> gcs <span class="free">a</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lcs <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> lcs <span class="free">y</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> lcs_comm<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span> <span class="main">-</span> gcs <span class="free">b</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lcs_alt_2<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span> <span class="main">-</span> gcs <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> gcs_comm<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> lcs_minus_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">+</span> <span class="free">x</span> <span class="main">=</span> <span class="free">b</span> <span class="main">+</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lcs <span class="free">x</span> <span class="free">y</span> <span class="main">-</span> <span class="free">x</span> <span class="main">=</span> <span class="free">a</span> <span class="main">-</span> gcs <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lcs_alt_1<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span> diff_right_commute<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> lcs_minus_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">+</span> <span class="free">x</span> <span class="main">=</span> <span class="free">b</span> <span class="main">+</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lcs <span class="free">x</span> <span class="free">y</span> <span class="main">-</span> <span class="free">y</span> <span class="main">=</span> <span class="free">b</span> <span class="main">-</span> gcs <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lcs_alt_2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span> diff_right_commute<span class="main">)</span>

<span class="keyword1" id="More_MPoly-gcs_minus"><span class="command">lemma</span></span> gcs_minus<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="keyword1">adds</span> <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="keyword1">adds</span> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"gcs <span class="main">(</span><span class="free">s</span> <span class="main">-</span> <span class="free">u</span><span class="main">)</span> <span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="free">u</span><span class="main">)</span> <span class="main">=</span> gcs <span class="free">s</span> <span class="free">t</span> <span class="main">-</span> <span class="free">u</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gcs <span class="free">s</span> <span class="free">t</span> <span class="main">=</span> gcs <span class="main">(</span><span class="main">(</span><span class="free">s</span> <span class="main">-</span> <span class="free">u</span><span class="main">)</span> <span class="main">+</span> <span class="free">u</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="free">u</span><span class="main">)</span> <span class="main">+</span> <span class="free">u</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> minus_plus<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> gcs <span class="main">(</span><span class="free">s</span> <span class="main">-</span> <span class="free">u</span><span class="main">)</span> <span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="free">u</span><span class="main">)</span> <span class="main">+</span> <span class="free">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> gcs_plus_right<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> gcs_minus_gcs<span class="main">:</span> <span class="quoted"><span class="quoted">"gcs <span class="main">(</span><span class="free">s</span> <span class="main">-</span> <span class="main">(</span>gcs <span class="free">s</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="main">(</span>gcs <span class="free">s</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gcs_minus gcs_adds gcs_adds_2<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* ulcs_powerprod *)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Miscellaneous›</span></span>

<span class="keyword1" id="More_MPoly-poly_mapping_rangeE"><span class="command">lemma</span></span> poly_mapping_rangeE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∈</span> Poly_Mapping.range <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">k</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">∈</span> keys <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">=</span> lookup <span class="free">p</span> <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="More_MPoly-poly_mapping_range_nonzero"><span class="command">lemma</span></span> poly_mapping_range_nonzero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> Poly_Mapping.range <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> term_powerprod<span class="main">)</span> Keys_range_vectorize_poly<span class="main">:</span> <span class="quoted"><span class="quoted">"Keys <span class="main">(</span>Poly_Mapping.range <span class="main">(</span>vectorize_poly <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> pp_of_term <span class="main">`</span> keys <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Keys <span class="main">(</span>Poly_Mapping.range <span class="main">(</span>vectorize_poly <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> pp_of_term <span class="main">`</span> keys <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> Keys <span class="main">(</span>Poly_Mapping.range <span class="main">(</span>vectorize_poly <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> Poly_Mapping.range <span class="main">(</span>vectorize_poly <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> keys <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> in_KeysE<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> lookup <span class="main">(</span>vectorize_poly <span class="free">p</span><span class="main">)</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> DiffE imageE range.rep_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">∈</span> keys <span class="skolem">q</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">term_of_pair</span> <span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">∈</span> keys <span class="free">p</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> in_keys_iff lookup_proj_poly lookup_vectorize_poly<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"pp_of_term <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> pp_of_term <span class="main">`</span> keys <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> imageI<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> pp_of_term <span class="main">`</span> keys <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> pp_of_term_of_pair<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"pp_of_term <span class="main">`</span> keys <span class="free">p</span> <span class="main">⊆</span> Keys <span class="main">(</span>Poly_Mapping.range <span class="main">(</span>vectorize_poly <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> pp_of_term <span class="main">`</span> keys <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> keys <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> pp_of_term <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">term_of_pair</span> <span class="main">(</span><span class="skolem">t</span><span class="main">,</span> component_of_term <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> term_of_pair_pair<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> keys <span class="free">p</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lookup <span class="free">p</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="skolem">t</span><span class="main">,</span> component_of_term <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_keys_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lookup <span class="main">(</span>proj_poly <span class="main">(</span>component_of_term <span class="skolem">x</span><span class="main">)</span> <span class="free">p</span><span class="main">)</span> <span class="skolem">t</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lookup_proj_poly<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> keys <span class="main">(</span>proj_poly <span class="main">(</span>component_of_term <span class="skolem">x</span><span class="main">)</span> <span class="free">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_keys_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> keys <span class="free">p</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"component_of_term <span class="skolem">x</span> <span class="main">∈</span> keys <span class="main">(</span>vectorize_poly <span class="free">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> keys_vectorize_poly<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> t <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> Keys <span class="main">(</span>Poly_Mapping.range <span class="main">(</span>vectorize_poly <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> in_KeysI<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"proj_poly <span class="main">(</span>component_of_term <span class="skolem">x</span><span class="main">)</span> <span class="free">p</span> <span class="main">=</span> lookup <span class="main">(</span>vectorize_poly <span class="free">p</span><span class="main">)</span> <span class="main">(</span>component_of_term <span class="skolem">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> lookup_vectorize_poly<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹component_of_term <span class="skolem">x</span> <span class="main">∈</span> keys <span class="main">(</span>vectorize_poly <span class="free">p</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">∈</span> Poly_Mapping.range <span class="main">(</span>vectorize_poly <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> in_keys_lookup_in_range<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"proj_poly <span class="main">(</span>component_of_term <span class="skolem">x</span><span class="main">)</span> <span class="free">p</span> <span class="main">∈</span> Poly_Mapping.range <span class="main">(</span>vectorize_poly <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> ordered_term.lt<span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> ordered_term.higher<span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">context</span></span> ordered_term
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="More_MPoly-lt_lookup_vectorize"><span class="command">lemma</span></span> lt_lookup_vectorize<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>lookup <span class="main">(</span>vectorize_poly <span class="free">p</span><span class="main">)</span> <span class="main">(</span>component_of_term <span class="main">(</span>lt <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> lp <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vectorize_zero min_term_def pp_of_term_of_pair<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> punit.lt_eqI_keys<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> False <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="free">p</span> <span class="main">∈</span> keys <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lt_in_keys<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"lp <span class="free">p</span> <span class="main">∈</span> keys <span class="main">(</span>lookup <span class="main">(</span>vectorize_poly <span class="free">p</span><span class="main">)</span> <span class="main">(</span>component_of_term <span class="main">(</span>lt <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lookup_vectorize_poly keys_proj_poly<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> keys <span class="main">(</span>lookup <span class="main">(</span>vectorize_poly <span class="free">p</span><span class="main">)</span> <span class="main">(</span>component_of_term <span class="main">(</span>lt <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> pp_of_term <span class="main">`</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span><span class="main">∈</span>keys <span class="free">p</span><span class="main">.</span> component_of_term <span class="bound">x</span> <span class="main">=</span> component_of_term <span class="main">(</span>lt <span class="free">p</span><span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> lookup_vectorize_poly keys_proj_poly<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> keys <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"component_of_term <span class="skolem">v</span> <span class="main">=</span> component_of_term <span class="main">(</span>lt <span class="free">p</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> pp_of_term <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lt_max_keys<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main"><span class="free">≼</span></span> lp <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">t</span> <span class="main"><span class="free">≼</span></span> lp <span class="free">p</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lp <span class="free">p</span> <span class="main"><span class="free">≺</span></span> pp_of_term <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> t<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lp <span class="free">p</span> <span class="main">≠</span> pp_of_term <span class="skolem">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lp <span class="free">p</span> <span class="main"><span class="free">≼</span></span> pp_of_term <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">note</span></span> this<span class="main">(</span>2<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"component_of_term <span class="main">(</span>lt <span class="free">p</span><span class="main">)</span> <span class="main">≤</span> component_of_term <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="free">p</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ord_termI<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="free">p</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> lt <span class="free">p</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹lp <span class="free">p</span> <span class="main">≠</span> pp_of_term <span class="skolem">v</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="More_MPoly-lower_higher_zeroI"><span class="command">lemma</span></span> lower_higher_zeroI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free">v</span> <span class="main">⟹</span> lower <span class="main">(</span>higher <span class="free">p</span> <span class="free">v</span><span class="main">)</span> <span class="free">u</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lower_eq_zero_iff lookup_higher_when<span class="main">)</span>

<span class="keyword1" id="More_MPoly-lookup_minus_higher"><span class="command">lemma</span></span> lookup_minus_higher<span class="main">:</span> <span class="quoted"><span class="quoted">"lookup <span class="main">(</span><span class="free">p</span> <span class="main">-</span> higher <span class="free">p</span> <span class="free">v</span><span class="main">)</span> <span class="free">u</span> <span class="main">=</span> <span class="main">(</span>lookup <span class="free">p</span> <span class="free">u</span> <span class="keyword1">when</span> <span class="free">u</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lookup_minus lookup_higher_when when_def<span class="main">)</span>

<span class="keyword1" id="More_MPoly-keys_minus_higher"><span class="command">lemma</span></span> keys_minus_higher<span class="main">:</span> <span class="quoted"><span class="quoted">"keys <span class="main">(</span><span class="free">p</span> <span class="main">-</span> higher <span class="free">p</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">u</span></span> <span class="main">∈</span> keys <span class="free">p</span><span class="main">.</span> <span class="bound">u</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free">v</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> set_eqI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lookup_minus_higher conj_commute <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> lookup_not_eq_zero_eq_in_keys<span class="main">)</span>

<span class="keyword1" id="More_MPoly-lt_minus_higher"><span class="command">lemma</span></span> lt_minus_higher<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> keys <span class="free">p</span> <span class="main">⟹</span> lt <span class="main">(</span><span class="free">p</span> <span class="main">-</span> higher <span class="free">p</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lt_eqI_keys<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> keys_minus_higher<span class="main">)</span>

<span class="keyword1" id="More_MPoly-lc_minus_higher"><span class="command">lemma</span></span> lc_minus_higher<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> keys <span class="free">p</span> <span class="main">⟹</span> lc <span class="main">(</span><span class="free">p</span> <span class="main">-</span> higher <span class="free">p</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> lookup <span class="free">p</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lc_def lt_minus_higher lookup_minus_higher<span class="main">)</span>

<span class="keyword1" id="More_MPoly-tail_minus_higher"><span class="command">lemma</span></span> tail_minus_higher<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> keys <span class="free">p</span> <span class="main">⟹</span> tail <span class="main">(</span><span class="free">p</span> <span class="main">-</span> higher <span class="free">p</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> lower <span class="free">p</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> poly_mapping_eqI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lookup_tail_when lt_minus_higher lookup_lower_when lookup_minus_higher <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> when_cong<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* ordered_term *)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> gd_term.dgrad_p_set<span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> gd_term<span class="main">)</span> dgrad_p_set_closed_mult_scalar<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dickson_grading <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> punit.dgrad_p_set <span class="free">d</span> <span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> dgrad_p_set <span class="free">d</span> <span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">⊙</span> <span class="free">r</span> <span class="main">∈</span> dgrad_p_set <span class="free">d</span> <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> dgrad_p_setI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> keys <span class="main">(</span><span class="free">p</span> <span class="main">⊙</span> <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> keys <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> keys <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="skolem">t</span> <span class="main">⊕</span> <span class="skolem">u</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> in_keys_mult_scalarE<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">∈</span> keys <span class="free">p</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="skolem">t</span> <span class="main">≤</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.dgrad_p_setD<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">∈</span> keys <span class="free">r</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">(</span>pp_of_term <span class="skolem">u</span><span class="main">)</span> <span class="main">≤</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dgrad_p_setD<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">+</span> pp_of_term <span class="skolem">u</span><span class="main">)</span> <span class="main">≤</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dickson_gradingD1<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">(</span>pp_of_term <span class="skolem">v</span><span class="main">)</span> <span class="main">≤</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> v pp_of_term_splus<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Regular Sequences›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_regular_sequence</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>comm_powerprod <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">::</span>comm_ring_1<span class="main">)</span> list <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_regular_sequence</span> <span class="free"><span class="bound"><span class="entity">fs</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span>length <span class="free"><span class="bound"><span class="entity">fs</span></span></span><span class="main">.</span> <span class="main">∀</span><span class="bound">q</span><span class="main">.</span> <span class="bound">q</span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">fs</span></span></span> <span class="main">!</span> <span class="bound">j</span> <span class="main">∈</span> ideal <span class="main">(</span>set <span class="main">(</span>take <span class="bound">j</span> <span class="free"><span class="bound"><span class="entity">fs</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
                                                      <span class="bound">q</span> <span class="main">∈</span> ideal <span class="main">(</span>set <span class="main">(</span>take <span class="bound">j</span> <span class="free"><span class="bound"><span class="entity">fs</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="More_MPoly-is_regular_sequenceD"><span class="command">lemma</span></span> is_regular_sequenceD<span class="main">:</span>
  <span class="quoted"><span class="quoted">"is_regular_sequence <span class="free">fs</span> <span class="main">⟹</span> <span class="free">j</span> <span class="main">&lt;</span> length <span class="free">fs</span> <span class="main">⟹</span> <span class="free">q</span> <span class="main">*</span> <span class="free">fs</span> <span class="main">!</span> <span class="free">j</span> <span class="main">∈</span> ideal <span class="main">(</span>set <span class="main">(</span>take <span class="free">j</span> <span class="free">fs</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
    <span class="free">q</span> <span class="main">∈</span> ideal <span class="main">(</span>set <span class="main">(</span>take <span class="free">j</span> <span class="free">fs</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_regular_sequence_def<span class="main">)</span>

<span class="keyword1" id="More_MPoly-is_regular_sequence_Nil"><span class="command">lemma</span></span> is_regular_sequence_Nil<span class="main">:</span> <span class="quoted"><span class="quoted">"is_regular_sequence <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_regular_sequence_def<span class="main">)</span>

<span class="keyword1" id="More_MPoly-is_regular_sequence_snocI"><span class="command">lemma</span></span> is_regular_sequence_snocI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">q</span><span class="main">.</span> <span class="bound">q</span> <span class="main">*</span> <span class="free">f</span> <span class="main">∈</span> ideal <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">q</span> <span class="main">∈</span> ideal <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_regular_sequence <span class="free">fs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_regular_sequence <span class="main">(</span><span class="free">fs</span> <span class="main">@</span> <span class="main">[</span><span class="free">f</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_regular_sequence_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> impI allI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span> <span class="skolem">q</span>
  <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> Suc <span class="main">(</span>length <span class="free">fs</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">*</span> <span class="main">(</span><span class="free">fs</span> <span class="main">@</span> <span class="main">[</span><span class="free">f</span><span class="main">]</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">∈</span> ideal <span class="main">(</span>set <span class="main">(</span>take <span class="skolem">j</span> <span class="free">fs</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> ideal <span class="main">(</span>set <span class="main">(</span>take <span class="skolem">j</span> <span class="free">fs</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">=</span> length <span class="free">fs</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">from</span></span> 2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">*</span> <span class="free">f</span> <span class="main">∈</span> ideal <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> ideal <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">fs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> 2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">*</span> <span class="free">fs</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">∈</span> ideal <span class="main">(</span>set <span class="main">(</span>take <span class="skolem">j</span> <span class="free">fs</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nth_append<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">fs</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> ideal <span class="main">(</span>set <span class="main">(</span>take <span class="skolem">j</span> <span class="free">fs</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_regular_sequenceD<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="More_MPoly-is_regular_sequence_snocD"><span class="command">lemma</span></span> is_regular_sequence_snocD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_regular_sequence <span class="main">(</span><span class="free">fs</span> <span class="main">@</span> <span class="main">[</span><span class="free">f</span><span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">q</span><span class="main">.</span> <span class="bound">q</span> <span class="main">*</span> <span class="free">f</span> <span class="main">∈</span> ideal <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">q</span> <span class="main">∈</span> ideal <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_regular_sequence <span class="free">fs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">q</span>
  <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">*</span> <span class="free">f</span> <span class="main">∈</span> ideal <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">note</span></span> assms
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="free">fs</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="free">fs</span> <span class="main">@</span> <span class="main">[</span><span class="free">f</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">*</span> <span class="main">(</span><span class="free">fs</span> <span class="main">@</span> <span class="main">[</span><span class="free">f</span><span class="main">]</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span>length <span class="free">fs</span><span class="main">)</span> <span class="main">∈</span> ideal <span class="main">(</span>set <span class="main">(</span>take <span class="main">(</span>length <span class="free">fs</span><span class="main">)</span> <span class="main">(</span><span class="free">fs</span> <span class="main">@</span> <span class="main">[</span><span class="free">f</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> ideal <span class="main">(</span>set <span class="main">(</span>take <span class="main">(</span>length <span class="free">fs</span><span class="main">)</span> <span class="main">(</span><span class="free">fs</span> <span class="main">@</span> <span class="main">[</span><span class="free">f</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_regular_sequenceD<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> ideal <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_regular_sequence <span class="free">fs</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_regular_sequence_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> impI allI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span> <span class="skolem">q</span>
    <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">fs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">*</span> <span class="free">fs</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">∈</span> ideal <span class="main">(</span>set <span class="main">(</span>take <span class="skolem">j</span> <span class="free">fs</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">note</span></span> assms
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="free">fs</span> <span class="main">@</span> <span class="main">[</span><span class="free">f</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> 1 2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">*</span> <span class="main">(</span><span class="free">fs</span> <span class="main">@</span> <span class="main">[</span><span class="free">f</span><span class="main">]</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">∈</span> ideal <span class="main">(</span>set <span class="main">(</span>take <span class="skolem">j</span> <span class="main">(</span><span class="free">fs</span> <span class="main">@</span> <span class="main">[</span><span class="free">f</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nth_append<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> ideal <span class="main">(</span>set <span class="main">(</span>take <span class="skolem">j</span> <span class="main">(</span><span class="free">fs</span> <span class="main">@</span> <span class="main">[</span><span class="free">f</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_regular_sequenceD<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> ideal <span class="main">(</span>set <span class="main">(</span>take <span class="skolem">j</span> <span class="free">fs</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="More_MPoly-is_regular_sequence_removeAll_zero"><span class="command">lemma</span></span> is_regular_sequence_removeAll_zero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_regular_sequence <span class="free">fs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_regular_sequence <span class="main">(</span>removeAll <span class="main">0</span> <span class="free">fs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">fs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_regular_sequence_Nil<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>snoc <span class="skolem">f</span> <span class="skolem">fs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>removeAll <span class="main">0</span> <span class="skolem">fs</span><span class="main">)</span> <span class="main">=</span> set <span class="skolem">fs</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ideal <span class="main">...</span> <span class="main">=</span> ideal <span class="main">(</span>set <span class="skolem">fs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> ideal.span_Diff_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"ideal <span class="main">(</span>set <span class="main">(</span>removeAll <span class="main">0</span> <span class="skolem">fs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> ideal <span class="main">(</span>set <span class="skolem">fs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">from</span></span> snoc<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"is_regular_sequence <span class="skolem">fs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_regular_sequence_snocD<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI impI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_regular_sequence <span class="main">(</span>removeAll <span class="main">0</span> <span class="skolem">fs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">f</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> is_regular_sequence_snocI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">q</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">*</span> <span class="skolem">f</span> <span class="main">∈</span> ideal <span class="main">(</span>set <span class="main">(</span>removeAll <span class="main">0</span> <span class="skolem">fs</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">*</span> <span class="skolem">f</span> <span class="main">∈</span> ideal <span class="main">(</span>set <span class="skolem">fs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> eq<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> snoc<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> ideal <span class="main">(</span>set <span class="skolem">fs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_regular_sequence_snocD<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> ideal <span class="main">(</span>set <span class="main">(</span>removeAll <span class="main">0</span> <span class="skolem">fs</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> eq<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">from</span></span> * <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_regular_sequence <span class="main">(</span>removeAll <span class="main">0</span> <span class="skolem">fs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> snoc.hyps<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> * <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_regular_sequence <span class="main">(</span>removeAll <span class="main">0</span> <span class="skolem">fs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> snoc.hyps<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="More_MPoly-is_regular_sequence_remdups"><span class="command">lemma</span></span> is_regular_sequence_remdups<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_regular_sequence <span class="free">fs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_regular_sequence <span class="main">(</span>rev <span class="main">(</span>remdups <span class="main">(</span>rev <span class="free">fs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">fs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_regular_sequence_Nil<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>snoc <span class="skolem">f</span> <span class="skolem">fs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> snoc<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"is_regular_sequence <span class="skolem">fs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_regular_sequence_snocD<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI impI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_regular_sequence <span class="main">(</span>rev <span class="main">(</span>remdups <span class="main">(</span>rev <span class="skolem">fs</span><span class="main">)</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">f</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> is_regular_sequence_snocI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">q</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">*</span> <span class="skolem">f</span> <span class="main">∈</span> ideal <span class="main">(</span>set <span class="main">(</span>rev <span class="main">(</span>remdups <span class="main">(</span>rev <span class="skolem">fs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">*</span> <span class="skolem">f</span> <span class="main">∈</span> ideal <span class="main">(</span>set <span class="skolem">fs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> snoc<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> ideal <span class="main">(</span>set <span class="skolem">fs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_regular_sequence_snocD<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> ideal <span class="main">(</span>set <span class="main">(</span>rev <span class="main">(</span>remdups <span class="main">(</span>rev <span class="skolem">fs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">from</span></span> * <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_regular_sequence <span class="main">(</span>rev <span class="main">(</span>remdups <span class="main">(</span>rev <span class="skolem">fs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> snoc.hyps<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> * <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_regular_sequence <span class="main">(</span>rev <span class="main">(</span>remdups <span class="main">(</span>rev <span class="skolem">fs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> snoc.hyps<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* theory *)</span>
</pre>
</div><div id="Signature_Groebner">
<div class="head">
<h1>Theory Signature_Groebner</h1>
</div>
<pre class="source"><span class="comment1">(* Author: Alexander Maletzky *)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Signature-Based Algorithms for Computing Gr\"obner Bases›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Signature_Groebner
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="#More_MPoly">More_MPoly</a> <a href="../../groebner_bases/theories/#Syzygy">Groebner_Bases.Syzygy</a> <a href="../../polynomials/theories/#Quasi_PM_Power_Products">Polynomials.Quasi_PM_Power_Products</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹First, we develop the whole theory for elements of the module $K[X]^r$, i.\,e. objects of type
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">"<span class="tfree"><span class="tfree">'t</span></span> <span class="main"><span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span></span> <span class="tfree"><span class="tfree">'b</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. Later, we transfer all algorithms defined on such objects to algorithms
  efficiently operating on sig-poly-pairs, i.\,e. objects of type <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">"<span class="tfree"><span class="tfree">'t</span></span> <span class="main"><span class="main">×</span></span> <span class="main"><span class="main">(</span></span><span class="tfree"><span class="tfree">'a</span></span> <span class="main"><span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span></span> <span class="tfree"><span class="tfree">'b</span></span><span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹More Preliminaries›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> gd_term<span class="main">)</span> lt_spoly_less_lcs<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"spoly <span class="free">p</span> <span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span>spoly <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free">term_of_pair</span> <span class="main">(</span>lcs <span class="main">(</span>lp <span class="free">p</span><span class="main">)</span> <span class="main">(</span>lp <span class="free">q</span><span class="main">)</span><span class="main">,</span> component_of_term <span class="main">(</span>lt <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"lcs <span class="main">(</span>lp <span class="free">p</span><span class="main">)</span> <span class="main">(</span>lp <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"monom_mult <span class="main">(</span><span class="main">1</span> <span class="main">/</span> lc <span class="free">p</span><span class="main">)</span> <span class="main">(</span><span class="var">?l</span> <span class="main">-</span> lp <span class="free">p</span><span class="main">)</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?q</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"monom_mult <span class="main">(</span><span class="main">1</span> <span class="main">/</span> lc <span class="free">q</span><span class="main">)</span> <span class="main">(</span><span class="var">?l</span> <span class="main">-</span> lp <span class="free">q</span><span class="main">)</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> eq1<span class="main">:</span> <span class="quoted"><span class="quoted">"component_of_term <span class="main">(</span>lt <span class="free">p</span><span class="main">)</span> <span class="main">=</span> component_of_term <span class="main">(</span>lt <span class="free">q</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> eq2<span class="main">:</span> <span class="quoted"><span class="quoted">"spoly <span class="free">p</span> <span class="free">q</span> <span class="main">=</span> <span class="var">?p</span> <span class="main">-</span> <span class="var">?q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> spoly_def Let_def lc_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lc <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lc_not_0<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="var">?p</span> <span class="main">=</span> <span class="main">(</span><span class="var">?l</span> <span class="main">-</span> lp <span class="free">p</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lc <span class="var">?p</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lt_monom_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> lt_p<span class="main">:</span> <span class="quoted"><span class="quoted">"lt <span class="var">?p</span> <span class="main">=</span> <span class="free">term_of_pair</span> <span class="main">(</span><span class="var">?l</span><span class="main">,</span> component_of_term <span class="main">(</span>lt <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> splus_def adds_minus adds_lcs<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lc <span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lc_not_0<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="var">?q</span> <span class="main">=</span> <span class="main">(</span><span class="var">?l</span> <span class="main">-</span> lp <span class="free">q</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lc <span class="var">?q</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lt_monom_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> lt_q<span class="main">:</span> <span class="quoted"><span class="quoted">"lt <span class="var">?q</span> <span class="main">=</span> <span class="free">term_of_pair</span> <span class="main">(</span><span class="var">?l</span><span class="main">,</span> component_of_term <span class="main">(</span>lt <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq1 splus_def adds_minus adds_lcs_2<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">-</span> <span class="var">?q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq2<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="var">?q</span> <span class="main">=</span> lt <span class="var">?p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> lt_p lt_q<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lc <span class="var">?q</span> <span class="main">=</span> lc <span class="var">?p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹lc <span class="var">?p</span> <span class="main">=</span> <span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹lc <span class="var">?q</span> <span class="main">=</span> <span class="main">1</span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span><span class="var">?p</span> <span class="main">-</span> <span class="var">?q</span><span class="main">)</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="var">?p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lt_minus_lessI<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> eq2 lt_p<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Module Polynomials›</span></span>

<span class="keyword1"><span class="command">locale</span></span> qpm_inf_term <span class="main">=</span>
    gd_term <span class="quoted"><span class="free">pair_of_term</span></span> <span class="quoted"><span class="free">term_of_pair</span></span> <span class="quoted"><span class="free">ord</span></span> <span class="quoted"><span class="free">ord_strict</span></span> <span class="quoted"><span class="free">ord_term</span></span> <span class="quoted"><span class="free">ord_term_strict</span></span>
      <span class="keyword2"><span class="keyword">for</span></span> <span class="free">pair_of_term</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'t</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>quasi_pm_powerprod <span class="main">×</span> nat<span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="free">term_of_pair</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> nat<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'t</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="free">ord</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">≼</span>"</span> 50<span class="main">)</span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="free">ord_strict</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">≺</span>"</span> 50<span class="main">)</span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="free">ord_term</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'t</span> <span class="main">⇒</span> <span class="tfree">'t</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">≼<span class="hidden">⇩</span><sub>t</sub></span>"</span> 50<span class="main">)</span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="free">ord_term_strict</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'t</span> <span class="main">⇒</span> <span class="tfree">'t</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">≺<span class="hidden">⇩</span><sub>t</sub></span>"</span> 50<span class="main">)</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Signature_Groebner-in_idealE_rep_dgrad_p_set"><span class="command">lemma</span></span> in_idealE_rep_dgrad_p_set<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"hom_grading <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⊆</span> punit.dgrad_p_set <span class="free">d</span> <span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> punit.dgrad_p_set <span class="free">d</span> <span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> ideal <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">r</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"keys <span class="free">r</span> <span class="main">⊆</span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Poly_Mapping.range <span class="free">r</span> <span class="main">⊆</span> punit.dgrad_p_set <span class="free">d</span> <span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> ideal.rep <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">⊆</span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">b</span><span class="main">.</span> <span class="skolem">q</span> <span class="bound">b</span> <span class="main">∈</span> punit.dgrad_p_set <span class="free">d</span> <span class="free">m</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">a</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span> <span class="skolem">q</span> <span class="bound">a</span> <span class="main">*</span> <span class="bound">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.in_pmdlE_dgrad_p_set<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> Abs_poly_mapping <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="skolem">q</span> <span class="bound">k</span> <span class="keyword1">when</span> <span class="bound">k</span> <span class="main">∈</span> <span class="skolem">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"lookup <span class="skolem">r</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="skolem">q</span> <span class="bound">k</span> <span class="keyword1">when</span> <span class="bound">k</span> <span class="main">∈</span> <span class="skolem">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> r_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Abs_poly_mapping_inverse<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">A</span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"keys <span class="skolem">r</span> <span class="main">⊆</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_keys_iff 1<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Poly_Mapping.range <span class="skolem">r</span> <span class="main">⊆</span> punit.dgrad_p_set <span class="free">d</span> <span class="free">m</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> Poly_Mapping.range <span class="skolem">r</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> keys <span class="skolem">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> lookup <span class="skolem">r</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> poly_mapping_rangeE<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> 2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="skolem">q</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f 1<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> punit.dgrad_p_set <span class="free">d</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">=</span> <span class="skolem">q</span> <span class="skolem">b</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 0<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">a</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span> lookup <span class="skolem">r</span> <span class="bound">a</span> <span class="main">*</span> <span class="bound">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> 1<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">A</span>›</span></span> 2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">a</span><span class="main">∈</span>keys <span class="skolem">r</span><span class="main">.</span> lookup <span class="skolem">r</span> <span class="bound">a</span> <span class="main">*</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum.mono_neutral_right<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">∈</span><span class="skolem">A</span> <span class="main">-</span> keys <span class="skolem">r</span><span class="main">.</span> lookup <span class="skolem">r</span> <span class="bound">a</span> <span class="main">*</span> <span class="bound">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_keys_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> ideal.rep <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> ideal.rep_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> 2 <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="main">⊆</span> <span class="free">B</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"keys <span class="skolem">r</span> <span class="main">⊆</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subset_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">fs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">::</span>field<span class="main">)</span> list"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">sig_inv_set'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">sig_inv_set'</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">r</span><span class="main">.</span> keys <span class="main">(</span>vectorize_poly <span class="bound">r</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">}</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">sig_inv_set</span> <span class="main">≡</span> sig_inv_set' <span class="main">(</span>length <span class="free">fs</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rep_list</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">rep_list</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">=</span> ideal.rep <span class="main">(</span>pm_of_idx_pm <span class="free">fs</span> <span class="main">(</span>vectorize_poly <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Signature_Groebner-sig_inv_setI"><span class="command">lemma</span></span> sig_inv_setI<span class="main">:</span> <span class="quoted"><span class="quoted">"keys <span class="main">(</span>vectorize_poly <span class="free">r</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">j</span><span class="main">}</span> <span class="main">⟹</span> <span class="free">r</span> <span class="main">∈</span> sig_inv_set' <span class="free">j</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sig_inv_set'_def<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-sig_inv_setD"><span class="command">lemma</span></span> sig_inv_setD<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> sig_inv_set' <span class="free">j</span> <span class="main">⟹</span> keys <span class="main">(</span>vectorize_poly <span class="free">r</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">j</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sig_inv_set'_def<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-sig_inv_setI'"><span class="command">lemma</span></span> sig_inv_setI'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> keys <span class="free">r</span> <span class="main">⟹</span> component_of_term <span class="bound">v</span> <span class="main">&lt;</span> <span class="free">j</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> sig_inv_set' <span class="free">j</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sig_inv_setI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> keys <span class="main">(</span>vectorize_poly <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> keys <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> component_of_term <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> keys_vectorize_poly <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> <span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> k <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">j</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-sig_inv_setD'"><span class="command">lemma</span></span> sig_inv_setD'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> sig_inv_set' <span class="free">j</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> keys <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"component_of_term <span class="free">v</span> <span class="main">&lt;</span> <span class="free">j</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"component_of_term <span class="free">v</span> <span class="main">∈</span> component_of_term <span class="main">`</span> keys <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> imageI<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> keys <span class="main">(</span>vectorize_poly <span class="free">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> keys_vectorize_poly<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">j</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_inv_setD<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> sig_inv_setD_lt<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> sig_inv_set' <span class="free">j</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"component_of_term <span class="main">(</span>lt <span class="free">r</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">j</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_inv_setD'<span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> lt_in_keys<span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span><span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-sig_inv_set_mono"><span class="command">lemma</span></span> sig_inv_set_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="free">j</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sig_inv_set' <span class="free">i</span> <span class="main">⊆</span> sig_inv_set' <span class="free">j</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> sig_inv_set' <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"keys <span class="main">(</span>vectorize_poly <span class="skolem">r</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">i</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_inv_setD<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">j</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> sig_inv_set' <span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_inv_setI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-sig_inv_set_zero"><span class="command">lemma</span></span> sig_inv_set_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> sig_inv_set' <span class="free">j</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_inv_setI'<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-sig_inv_set_closed_uminus"><span class="command">lemma</span></span> sig_inv_set_closed_uminus<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> sig_inv_set' <span class="free">j</span> <span class="main">⟹</span> <span class="main">-</span> <span class="free">r</span> <span class="main">∈</span> sig_inv_set' <span class="free">j</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> sig_inv_setD' <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> sig_inv_setI' <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> keys_uminus<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-sig_inv_set_closed_plus"><span class="command">lemma</span></span> sig_inv_set_closed_plus<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> sig_inv_set' <span class="free">j</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> sig_inv_set' <span class="free">j</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">+</span> <span class="free">s</span> <span class="main">∈</span> sig_inv_set' <span class="free">j</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sig_inv_setI'<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> keys <span class="main">(</span><span class="free">r</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> keys <span class="free">r</span> <span class="main">∪</span> keys <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Poly_Mapping.keys_add <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"component_of_term <span class="skolem">v</span> <span class="main">&lt;</span> <span class="free">j</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> keys <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_inv_setD'<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> keys <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_inv_setD'<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-sig_inv_set_closed_minus"><span class="command">lemma</span></span> sig_inv_set_closed_minus<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> sig_inv_set' <span class="free">j</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> sig_inv_set' <span class="free">j</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">-</span> <span class="free">s</span> <span class="main">∈</span> sig_inv_set' <span class="free">j</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sig_inv_setI'<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> keys <span class="main">(</span><span class="free">r</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> keys <span class="free">r</span> <span class="main">∪</span> keys <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> keys_minus <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"component_of_term <span class="skolem">v</span> <span class="main">&lt;</span> <span class="free">j</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> keys <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_inv_setD'<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> keys <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_inv_setD'<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-sig_inv_set_closed_monom_mult"><span class="command">lemma</span></span> sig_inv_set_closed_monom_mult<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> sig_inv_set' <span class="free">j</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"monom_mult <span class="free">c</span> <span class="free">t</span> <span class="free">r</span> <span class="main">∈</span> sig_inv_set' <span class="free">j</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sig_inv_setI'<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> keys <span class="main">(</span>monom_mult <span class="free">c</span> <span class="free">t</span> <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="main">(⊕)</span> <span class="free">t</span> <span class="main">`</span> keys <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> keys_monom_mult_subset <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> keys <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="free">t</span> <span class="main">⊕</span> <span class="skolem">u</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"component_of_term <span class="skolem">u</span> <span class="main">&lt;</span> <span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_inv_setD'<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"component_of_term <span class="skolem">v</span> <span class="main">&lt;</span> <span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> v <span class="dynamic"><span class="dynamic">term_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-sig_inv_set_closed_mult_scalar"><span class="command">lemma</span></span> sig_inv_set_closed_mult_scalar<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> sig_inv_set' <span class="free">j</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">⊙</span> <span class="free">r</span> <span class="main">∈</span> sig_inv_set' <span class="free">j</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sig_inv_setI'<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> keys <span class="main">(</span><span class="free">p</span> <span class="main">⊙</span> <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> keys <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="skolem">t</span> <span class="main">⊕</span> <span class="skolem">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> in_keys_mult_scalarE<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"component_of_term <span class="skolem">u</span> <span class="main">&lt;</span> <span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_inv_setD'<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"component_of_term <span class="skolem">v</span> <span class="main">&lt;</span> <span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> v <span class="dynamic"><span class="dynamic">term_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-rep_list_zero"><span class="command">lemma</span></span> rep_list_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"rep_list <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rep_list_def vectorize_zero<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-rep_list_uminus"><span class="command">lemma</span></span> rep_list_uminus<span class="main">:</span> <span class="quoted"><span class="quoted">"rep_list <span class="main">(</span><span class="main">-</span> <span class="free">r</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> rep_list <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rep_list_def vectorize_uminus pm_of_idx_pm_uminus<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-rep_list_plus"><span class="command">lemma</span></span> rep_list_plus<span class="main">:</span> <span class="quoted"><span class="quoted">"rep_list <span class="main">(</span><span class="free">r</span> <span class="main">+</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> rep_list <span class="free">r</span> <span class="main">+</span> rep_list <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rep_list_def vectorize_plus pm_of_idx_pm_plus ideal.rep_plus<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-rep_list_minus"><span class="command">lemma</span></span> rep_list_minus<span class="main">:</span> <span class="quoted"><span class="quoted">"rep_list <span class="main">(</span><span class="free">r</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> rep_list <span class="free">r</span> <span class="main">-</span> rep_list <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rep_list_def vectorize_minus pm_of_idx_pm_minus ideal.rep_minus<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-vectorize_mult_scalar"><span class="command">lemma</span></span> vectorize_mult_scalar<span class="main">:</span>
  <span class="quoted"><span class="quoted">"vectorize_poly <span class="main">(</span><span class="free">p</span> <span class="main">⊙</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> MPoly_Type_Class.punit.monom_mult <span class="free">p</span> <span class="main">0</span> <span class="main">(</span>vectorize_poly <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> poly_mapping_eqI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lookup_vectorize_poly MPoly_Type_Class.punit.lookup_monom_mult_zero proj_mult_scalar<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-rep_list_mult_scalar"><span class="command">lemma</span></span> rep_list_mult_scalar<span class="main">:</span> <span class="quoted"><span class="quoted">"rep_list <span class="main">(</span><span class="free">c</span> <span class="main">⊙</span> <span class="free">r</span><span class="main">)</span> <span class="main">=</span> <span class="free">c</span> <span class="main">*</span> rep_list <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rep_list_def vectorize_mult_scalar pm_of_idx_pm_monom_mult punit.rep_mult_scalar<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-rep_list_monom_mult"><span class="command">lemma</span></span> rep_list_monom_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"rep_list <span class="main">(</span>monom_mult <span class="free">c</span> <span class="free">t</span> <span class="free">r</span><span class="main">)</span> <span class="main">=</span> punit.monom_mult <span class="free">c</span> <span class="free">t</span> <span class="main">(</span>rep_list <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mult_scalar_monomial<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> times_monomial_left<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rep_list_mult_scalar<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-rep_list_monomial"><span class="command">lemma</span></span> rep_list_monomial<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"distinct <span class="free">fs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="main">(</span>monomial <span class="free">c</span> <span class="free">u</span><span class="main">)</span> <span class="main">=</span>
            <span class="main">(</span>punit.monom_mult <span class="free">c</span> <span class="main">(</span>pp_of_term <span class="free">u</span><span class="main">)</span> <span class="main">(</span><span class="free">fs</span> <span class="main">!</span> <span class="main">(</span>component_of_term <span class="free">u</span><span class="main">)</span><span class="main">)</span>
              <span class="keyword1">when</span> component_of_term <span class="free">u</span> <span class="main">&lt;</span> length <span class="free">fs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rep_list_def vectorize_monomial pm_of_idx_pm_monomial<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span> when_def times_monomial_left<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-rep_list_in_ideal_sig_inv_set"><span class="command">lemma</span></span> rep_list_in_ideal_sig_inv_set<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> sig_inv_set' <span class="free">j</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">r</span> <span class="main">∈</span> ideal <span class="main">(</span>set <span class="main">(</span>take <span class="free">j</span> <span class="free">fs</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?fs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"take <span class="free">j</span> <span class="free">fs</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"keys <span class="main">(</span>vectorize_poly <span class="free">r</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">j</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_inv_setD<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"pm_of_idx_pm <span class="free">fs</span> <span class="main">(</span>vectorize_poly <span class="free">r</span><span class="main">)</span> <span class="main">=</span> pm_of_idx_pm <span class="var">?fs</span> <span class="main">(</span>vectorize_poly <span class="free">r</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> pm_of_idx_pm_take<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">r</span> <span class="main">∈</span> ideal <span class="main">(</span>keys <span class="main">(</span>pm_of_idx_pm <span class="free">fs</span> <span class="main">(</span>vectorize_poly <span class="free">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> rep_list_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal.rep_in_span<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> ideal <span class="main">(</span>keys <span class="main">(</span>pm_of_idx_pm <span class="var">?fs</span> <span class="main">(</span>vectorize_poly <span class="free">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> eq<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> keys_pm_of_idx_pm_subset <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⊆</span> ideal <span class="main">(</span>set <span class="var">?fs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal.span_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> rep_list_subset_ideal_sig_inv_set<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⊆</span> sig_inv_set' <span class="free">j</span> <span class="main">⟹</span> rep_list <span class="main">`</span> <span class="free">B</span> <span class="main">⊆</span> ideal <span class="main">(</span>set <span class="main">(</span>take <span class="free">j</span> <span class="free">fs</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> rep_list_in_ideal_sig_inv_set<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-rep_list_in_ideal"><span class="command">lemma</span></span> rep_list_in_ideal<span class="main">:</span> <span class="quoted"><span class="quoted">"rep_list <span class="free">r</span> <span class="main">∈</span> ideal <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">r</span> <span class="main">∈</span> ideal <span class="main">(</span>keys <span class="main">(</span>pm_of_idx_pm <span class="free">fs</span> <span class="main">(</span>vectorize_poly <span class="free">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> rep_list_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal.rep_in_span<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> keys_pm_of_idx_pm_subset <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⊆</span> ideal <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal.span_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> rep_list_subset_ideal<span class="main">:</span> <span class="quoted"><span class="quoted">"rep_list <span class="main">`</span> <span class="free">B</span> <span class="main">⊆</span> ideal <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rep_list_in_ideal<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-in_idealE_rep_list"><span class="command">lemma</span></span> in_idealE_rep_list<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> ideal <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">r</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> rep_list <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> sig_inv_set"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r0</span></span> <span class="keyword2"><span class="keyword">where</span></span> r0<span class="main">:</span> <span class="quoted"><span class="quoted">"keys <span class="skolem">r0</span> <span class="main">⊆</span> set <span class="free">fs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> ideal.rep <span class="skolem">r0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal.spanE_rep<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> rep_list <span class="main">(</span>atomize_poly <span class="main">(</span>idx_pm_of_pm <span class="free">fs</span> <span class="skolem">r0</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rep_list_def vectorize_atomize_poly pm_of_idx_pm_of_pm<span class="main"><span class="main">[</span></span><span class="operator">OF</span> r0<span class="main"><span class="main">]</span></span> p<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"atomize_poly <span class="main">(</span>idx_pm_of_pm <span class="free">fs</span> <span class="skolem">r0</span><span class="main">)</span> <span class="main">∈</span> sig_inv_set"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_inv_setI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vectorize_atomize_poly keys_idx_pm_of_pm_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-keys_rep_list_subset"><span class="command">lemma</span></span> keys_rep_list_subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> keys <span class="main">(</span>rep_list <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">v</span> <span class="free">s</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> keys <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> Keys <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">=</span> pp_of_term <span class="free">v</span> <span class="main">+</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v0</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> v0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v0</span> <span class="main">∈</span> Keys <span class="main">(</span>Poly_Mapping.range <span class="main">(</span>pm_of_idx_pm <span class="free">fs</span> <span class="main">(</span>vectorize_poly <span class="free">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> Keys <span class="main">(</span>keys <span class="main">(</span>pm_of_idx_pm <span class="free">fs</span> <span class="main">(</span>vectorize_poly <span class="free">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">=</span> <span class="skolem">v0</span> <span class="main">+</span> <span class="skolem">s</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> rep_list_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.keys_rep_subset<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> s
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> keys_pm_of_idx_pm_subset <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Keys <span class="main">(</span>keys <span class="main">(</span>pm_of_idx_pm <span class="free">fs</span> <span class="main">(</span>vectorize_poly <span class="free">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> Keys <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Keys_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> Keys <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">note</span></span> v0
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> range_pm_of_idx_pm_subset'
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Keys <span class="main">(</span>Poly_Mapping.range <span class="main">(</span>pm_of_idx_pm <span class="free">fs</span> <span class="main">(</span>vectorize_poly <span class="free">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> Keys <span class="main">(</span>Poly_Mapping.range <span class="main">(</span>vectorize_poly <span class="free">r</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Keys_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> pp_of_term <span class="main">`</span> keys <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> Keys_range_vectorize_poly<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> keys <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v0</span> <span class="main">=</span> pp_of_term <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">=</span> pp_of_term <span class="skolem">v</span> <span class="main">+</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> t<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> keys <span class="free">r</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">∈</span> Keys <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-dgrad_p_set_le_rep_list"><span class="command">lemma</span></span> dgrad_p_set_le_rep_list<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dickson_grading <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"dgrad_set_le <span class="free">d</span> <span class="main">(</span>pp_of_term <span class="main">`</span> keys <span class="free">r</span><span class="main">)</span> <span class="main">(</span>Keys <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"punit.dgrad_p_set_le <span class="free">d</span> <span class="main">{</span>rep_list <span class="free">r</span><span class="main">}</span> <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> punit.dgrad_p_set_le_def Keys_insert<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> dgrad_set_leI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> keys <span class="main">(</span>rep_list <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="skolem"><span class="skolem">s1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> keys <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s1</span> <span class="main">∈</span> Keys <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> pp_of_term <span class="skolem">v</span> <span class="main">+</span> <span class="skolem">s1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> keys_rep_list_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pp_of_term <span class="skolem">v</span> <span class="main">∈</span> pp_of_term <span class="main">`</span> keys <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s2</span> <span class="main">∈</span> Keys <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">(</span>pp_of_term <span class="skolem">v</span><span class="main">)</span> <span class="main">≤</span> <span class="free">d</span> <span class="skolem">s2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dgrad_set_leE<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="skolem">t</span> <span class="main">=</span> ord_class.max <span class="main">(</span><span class="free">d</span> <span class="main">(</span>pp_of_term <span class="skolem">v</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">d</span> <span class="skolem">s1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> t
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dickson_gradingD1<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="skolem">t</span> <span class="main">=</span> <span class="free">d</span> <span class="main">(</span>pp_of_term <span class="skolem">v</span><span class="main">)</span> <span class="main">∨</span> <span class="free">d</span> <span class="skolem">t</span> <span class="main">=</span> <span class="free">d</span> <span class="skolem">s1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ord_class.max_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">s</span><span class="main">∈</span>Keys <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span><span class="main">.</span> <span class="free">d</span> <span class="skolem">t</span> <span class="main">≤</span> <span class="free">d</span> <span class="bound">s</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="skolem">t</span> <span class="main">=</span> <span class="free">d</span> <span class="main">(</span>pp_of_term <span class="skolem">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">d</span> <span class="main">(</span>pp_of_term <span class="skolem">v</span><span class="main">)</span> <span class="main">≤</span> <span class="free">d</span> <span class="skolem">s2</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="skolem">t</span> <span class="main">≤</span> <span class="free">d</span> <span class="skolem">s2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s2</span> <span class="main">∈</span> Keys <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="skolem">t</span> <span class="main">=</span> <span class="free">d</span> <span class="skolem">s1</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="skolem">t</span> <span class="main">≤</span> <span class="free">d</span> <span class="skolem">s1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s1</span> <span class="main">∈</span> Keys <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> dgrad_p_set_le_rep_list_image<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dickson_grading <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"dgrad_set_le <span class="free">d</span> <span class="main">(</span>pp_of_term <span class="main">`</span> Keys <span class="free">F</span><span class="main">)</span> <span class="main">(</span>Keys <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"punit.dgrad_p_set_le <span class="free">d</span> <span class="main">(</span>rep_list <span class="main">`</span> <span class="free">F</span><span class="main">)</span> <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> punit.dgrad_p_set_leI<span class="main"><span class="keyword3">,</span></span> <span class="operator">elim</span> imageE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pp_of_term <span class="main">`</span> keys <span class="skolem">f</span> <span class="main">⊆</span> pp_of_term <span class="main">`</span> Keys <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> image_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> keys_subset_Keys<span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"dgrad_set_le <span class="free">d</span> <span class="main">(</span>pp_of_term <span class="main">`</span> keys <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span>pp_of_term <span class="main">`</span> Keys <span class="free">F</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dgrad_set_le_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"dgrad_set_le <span class="free">d</span> <span class="main">(</span>pp_of_term <span class="main">`</span> keys <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span>Keys <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dgrad_set_le_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"punit.dgrad_p_set_le <span class="free">d</span> <span class="main">{</span>rep_list <span class="skolem">f</span><span class="main">}</span> <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dgrad_p_set_le_rep_list<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">term</span></span> <span class="quoted">Max</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">dgrad_max</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> nat<span class="main">)</span> <span class="main">⇒</span> nat"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">dgrad_max</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">=</span> <span class="main">(</span>Max <span class="main">(</span><span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">`</span> <span class="main">(</span>insert <span class="main">0</span> <span class="main">(</span>Keys <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">dgrad_max_set</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">≡</span> dgrad_p_set <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">(</span>dgrad_max <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">punit_dgrad_max_set</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">≡</span> punit.dgrad_p_set <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">(</span>dgrad_max <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Signature_Groebner-dgrad_max_0"><span class="command">lemma</span></span> dgrad_max_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">0</span> <span class="main">≤</span> dgrad_max <span class="free">d</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> finite_Keys <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">d</span> <span class="main">`</span> insert <span class="main">0</span> <span class="main">(</span>Keys <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">0</span> <span class="main">∈</span> <span class="free">d</span> <span class="main">`</span> insert <span class="main">0</span> <span class="main">(</span>Keys <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> dgrad_max_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Max_ge<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-dgrad_max_1"><span class="command">lemma</span></span> dgrad_max_1<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">fs</span> <span class="main">⊆</span> punit_dgrad_max_set <span class="free">d</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Keys <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> punit.dgrad_p_setI<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="skolem">v</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> set <span class="free">fs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> keys <span class="skolem">f</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> True <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="skolem">v</span> <span class="main">≤</span> dgrad_max <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Keys_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> subset_trans<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> finite_set <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set <span class="free">fs</span> <span class="main">⊆</span> punit.dgrad_p_set <span class="free">d</span> <span class="main">(</span>Max <span class="main">(</span><span class="free">d</span> <span class="main">`</span> <span class="main">(</span>Keys <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.dgrad_p_set_exhaust_expl<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> finite_set <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>Keys <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_Keys<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">d</span> <span class="main">`</span> Keys <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_imageI<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> False <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">`</span> Keys <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dgrad_max <span class="free">d</span> <span class="main">=</span> ord_class.max <span class="main">(</span><span class="free">d</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>Max <span class="main">(</span><span class="free">d</span> <span class="main">`</span> Keys <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dgrad_max_def<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Max <span class="main">(</span><span class="free">d</span> <span class="main">`</span> <span class="main">(</span>Keys <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> dgrad_max <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"punit.dgrad_p_set <span class="free">d</span> <span class="main">(</span>Max <span class="main">(</span><span class="free">d</span> <span class="main">`</span> <span class="main">(</span>Keys <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> punit_dgrad_max_set <span class="free">d</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.dgrad_p_set_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-dgrad_max_2"><span class="command">lemma</span></span> dgrad_max_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dickson_grading <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> dgrad_max_set <span class="free">d</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">r</span> <span class="main">∈</span> punit_dgrad_max_set <span class="free">d</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> punit.dgrad_p_setI<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> keys <span class="main">(</span>rep_list <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> keys <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> Keys <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> pp_of_term <span class="skolem">v</span> <span class="main">+</span> <span class="skolem">s</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> keys_rep_list_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> keys <span class="free">r</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">(</span>pp_of_term <span class="skolem">v</span><span class="main">)</span> <span class="main">≤</span> dgrad_max <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dgrad_p_setD<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="skolem">s</span> <span class="main">≤</span> dgrad_max <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">∈</span> Keys <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span>›</span></span> dgrad_max_def finite_Keys<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="skolem">t</span> <span class="main">≤</span> dgrad_max <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> t dickson_gradingD1<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> dgrad_max_3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dickson_grading <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> dgrad_max_set <span class="free">d</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="main">`</span> <span class="free">F</span> <span class="main">⊆</span> punit_dgrad_max_set <span class="free">d</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">elim</span> imageE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> dgrad_p_set <span class="free">d</span> <span class="main">(</span>dgrad_max <span class="free">d</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="skolem">f</span> <span class="main">∈</span> punit.dgrad_p_set <span class="free">d</span> <span class="main">(</span>dgrad_max <span class="free">d</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dgrad_max_2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-punit_dgrad_max_set_subset_dgrad_p_set"><span class="command">lemma</span></span> punit_dgrad_max_set_subset_dgrad_p_set<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dickson_grading <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"set <span class="free">fs</span> <span class="main">⊆</span> punit.dgrad_p_set <span class="free">d</span> <span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> set <span class="free">fs</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"punit_dgrad_max_set <span class="free">d</span> <span class="main">⊆</span> punit.dgrad_p_set <span class="free">d</span> <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> punit.dgrad_p_set_subset<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dgrad_max <span class="free">d</span> <span class="main">≤</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dgrad_max_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Max.boundedI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">d</span> <span class="main">`</span> insert <span class="main">0</span> <span class="main">(</span>Keys <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> finite_Keys<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">`</span> insert <span class="main">0</span> <span class="main">(</span>Keys <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">d</span> <span class="main">`</span> insert <span class="main">0</span> <span class="main">(</span>Keys <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> insert <span class="main">0</span> <span class="main">(</span>Keys <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="free">d</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≤</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">=</span> <span class="free">d</span> <span class="skolem">t</span>›</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> set <span class="free">fs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> punit.dgrad_p_set <span class="free">d</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"keys <span class="skolem">f</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> keys <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="skolem">s</span> <span class="main">=</span> <span class="free">d</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">+</span> <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">=</span> <span class="main">0</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> ord_class.max <span class="main">(</span><span class="free">d</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">(</span><span class="free">d</span> <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dickson_gradingD1<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="skolem">t</span> <span class="main">≤</span> <span class="free">d</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> max_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> punit.dgrad_p_set <span class="free">d</span> <span class="free">m</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">∈</span> keys <span class="skolem">f</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">m</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.dgrad_p_setD<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="skolem">t</span> <span class="main">≤</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> Keys <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> set <span class="free">fs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> keys <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> in_KeysE<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> punit.dgrad_p_set <span class="free">d</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="skolem">t</span> <span class="main">≤</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">∈</span> keys <span class="skolem">f</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.dgrad_p_setD<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">dgrad_sig_set'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> nat<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">dgrad_sig_set'</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">=</span> dgrad_max_set <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">∩</span> sig_inv_set' <span class="free"><span class="bound"><span class="entity">j</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">dgrad_sig_set</span> <span class="main">≡</span> dgrad_sig_set' <span class="main">(</span>length <span class="free">fs</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Signature_Groebner-dgrad_sig_set_set_mono"><span class="command">lemma</span></span> dgrad_sig_set_set_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="free">j</span> <span class="main">⟹</span> dgrad_sig_set' <span class="free">i</span> <span class="free">d</span> <span class="main">⊆</span> dgrad_sig_set' <span class="free">j</span> <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dgrad_sig_set'_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> sig_inv_set_mono<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-dgrad_sig_set_closed_uminus"><span class="command">lemma</span></span> dgrad_sig_set_closed_uminus<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> dgrad_sig_set' <span class="free">j</span> <span class="free">d</span> <span class="main">⟹</span> <span class="main">-</span> <span class="free">r</span> <span class="main">∈</span> dgrad_sig_set' <span class="free">j</span> <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> dgrad_sig_set'_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> dgrad_p_set_closed_uminus sig_inv_set_closed_uminus<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-dgrad_sig_set_closed_plus"><span class="command">lemma</span></span> dgrad_sig_set_closed_plus<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> dgrad_sig_set' <span class="free">j</span> <span class="free">d</span> <span class="main">⟹</span> <span class="free">s</span> <span class="main">∈</span> dgrad_sig_set' <span class="free">j</span> <span class="free">d</span> <span class="main">⟹</span> <span class="free">r</span> <span class="main">+</span> <span class="free">s</span> <span class="main">∈</span> dgrad_sig_set' <span class="free">j</span> <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> dgrad_sig_set'_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> dgrad_p_set_closed_plus sig_inv_set_closed_plus<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-dgrad_sig_set_closed_minus"><span class="command">lemma</span></span> dgrad_sig_set_closed_minus<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> dgrad_sig_set' <span class="free">j</span> <span class="free">d</span> <span class="main">⟹</span> <span class="free">s</span> <span class="main">∈</span> dgrad_sig_set' <span class="free">j</span> <span class="free">d</span> <span class="main">⟹</span> <span class="free">r</span> <span class="main">-</span> <span class="free">s</span> <span class="main">∈</span> dgrad_sig_set' <span class="free">j</span> <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> dgrad_sig_set'_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> dgrad_p_set_closed_minus sig_inv_set_closed_minus<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-dgrad_sig_set_closed_monom_mult"><span class="command">lemma</span></span> dgrad_sig_set_closed_monom_mult<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dickson_grading <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="free">t</span> <span class="main">≤</span> dgrad_max <span class="free">d</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> dgrad_sig_set' <span class="free">j</span> <span class="free">d</span> <span class="main">⟹</span> monom_mult <span class="free">c</span> <span class="free">t</span> <span class="free">p</span> <span class="main">∈</span> dgrad_sig_set' <span class="free">j</span> <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> dgrad_sig_set'_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> assms dgrad_p_set_closed_monom_mult sig_inv_set_closed_monom_mult<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-dgrad_sig_set_closed_monom_mult_zero"><span class="command">lemma</span></span> dgrad_sig_set_closed_monom_mult_zero<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> dgrad_sig_set' <span class="free">j</span> <span class="free">d</span> <span class="main">⟹</span> monom_mult <span class="free">c</span> <span class="main">0</span> <span class="free">p</span> <span class="main">∈</span> dgrad_sig_set' <span class="free">j</span> <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> dgrad_sig_set'_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> dgrad_p_set_closed_monom_mult_zero sig_inv_set_closed_monom_mult<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-dgrad_sig_set_closed_mult_scalar"><span class="command">lemma</span></span> dgrad_sig_set_closed_mult_scalar<span class="main">:</span>
  <span class="quoted"><span class="quoted">"dickson_grading <span class="free">d</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">∈</span> punit_dgrad_max_set <span class="free">d</span> <span class="main">⟹</span> <span class="free">r</span> <span class="main">∈</span> dgrad_sig_set' <span class="free">j</span> <span class="free">d</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">⊙</span> <span class="free">r</span> <span class="main">∈</span> dgrad_sig_set' <span class="free">j</span> <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> dgrad_sig_set'_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> dgrad_p_set_closed_mult_scalar sig_inv_set_closed_mult_scalar<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-dgrad_sig_set_closed_monomial"><span class="command">lemma</span></span> dgrad_sig_set_closed_monomial<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">(</span>pp_of_term <span class="free">u</span><span class="main">)</span> <span class="main">≤</span> dgrad_max <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"component_of_term <span class="free">u</span> <span class="main">&lt;</span> <span class="free">j</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"monomial <span class="free">c</span> <span class="free">u</span> <span class="main">∈</span> dgrad_sig_set' <span class="free">j</span> <span class="free">d</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dgrad_sig_set'_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"monomial <span class="free">c</span> <span class="free">u</span> <span class="main">∈</span> dgrad_max_set <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> dgrad_p_setI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> keys <span class="main">(</span>monomial <span class="free">c</span> <span class="free">u</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⊆</span> <span class="main">{</span><span class="free">u</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">(</span>pp_of_term <span class="skolem">v</span><span class="main">)</span> <span class="main">≤</span> dgrad_max <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"monomial <span class="free">c</span> <span class="free">u</span> <span class="main">∈</span> sig_inv_set' <span class="free">j</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sig_inv_setI'<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> keys <span class="main">(</span>monomial <span class="free">c</span> <span class="free">u</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⊆</span> <span class="main">{</span><span class="free">u</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"component_of_term <span class="skolem">v</span> <span class="main">&lt;</span> <span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-rep_list_in_ideal_dgrad_sig_set"><span class="command">lemma</span></span> rep_list_in_ideal_dgrad_sig_set<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> dgrad_sig_set' <span class="free">j</span> <span class="free">d</span> <span class="main">⟹</span> rep_list <span class="free">r</span> <span class="main">∈</span> ideal <span class="main">(</span>set <span class="main">(</span>take <span class="free">j</span> <span class="free">fs</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dgrad_sig_set'_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> rep_list_in_ideal_sig_inv_set<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-in_idealE_rep_list_dgrad_sig_set_take"><span class="command">lemma</span></span> in_idealE_rep_list_dgrad_sig_set_take<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"hom_grading <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> punit_dgrad_max_set <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> ideal <span class="main">(</span>set <span class="main">(</span>take <span class="free">j</span> <span class="free">fs</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">r</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> dgrad_sig_set' <span class="free">j</span> <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> rep_list <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?fs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"take <span class="free">j</span> <span class="free">fs</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> set_take_subset dgrad_max_1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="var">?fs</span> <span class="main">⊆</span> punit_dgrad_max_set <span class="free">d</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subset_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r0</span></span> <span class="keyword2"><span class="keyword">where</span></span> r0<span class="main">:</span> <span class="quoted"><span class="quoted">"keys <span class="skolem">r0</span> <span class="main">⊆</span> set <span class="var">?fs</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"Poly_Mapping.range <span class="skolem">r0</span> <span class="main">⊆</span> punit_dgrad_max_set <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> ideal.rep <span class="skolem">r0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">,</span> 3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> in_idealE_rep_dgrad_p_set<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> idx_pm_of_pm <span class="var">?fs</span> <span class="skolem">r0</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"keys <span class="skolem">q</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="var">?fs</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> q_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> keys_idx_pm_of_pm_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">j</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> keys_q<span class="main">:</span> <span class="quoted"><span class="quoted">"keys <span class="skolem">q</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">j</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"atomize_poly <span class="skolem">q</span> <span class="main">∈</span> dgrad_max_set <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> keys <span class="main">(</span>atomize_poly <span class="skolem">q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> keys <span class="skolem">q</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> v_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="free">term_of_pair</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> keys <span class="main">(</span>lookup <span class="skolem">q</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> keys_atomize_poly <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">from</span></span> i keys_idx_pm_of_pm_subset<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?fs</span></span></span> <span class="quoted"><span class="skolem">r0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="var">?fs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> q_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> v_in <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> keys <span class="main">(</span>lookup <span class="skolem">q</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="free">term_of_pair</span> <span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="var">?fs</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> keys <span class="main">(</span>lookup <span class="skolem">r0</span> <span class="main">(</span><span class="var">?fs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lookup_idx_pm_of_pm q_def<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lookup <span class="skolem">r0</span> <span class="main">(</span><span class="var">?fs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lookup <span class="skolem">r0</span> <span class="main">(</span><span class="var">?fs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">∈</span> Poly_Mapping.range <span class="skolem">r0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_keys_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lookup <span class="skolem">r0</span> <span class="main">(</span><span class="var">?fs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">∈</span> punit_dgrad_max_set <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="skolem">t</span> <span class="main">≤</span> dgrad_max <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> t <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.dgrad_p_setD<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">(</span>pp_of_term <span class="skolem">v</span><span class="main">)</span> <span class="main">≤</span> dgrad_max <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> v pp_of_term_of_pair<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"atomize_poly <span class="skolem">q</span> <span class="main">∈</span> sig_inv_set' <span class="free">j</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_inv_setI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vectorize_atomize_poly keys_q<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> * <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"atomize_poly <span class="skolem">q</span> <span class="main">∈</span> dgrad_sig_set' <span class="free">j</span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dgrad_sig_set'_def <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹keys <span class="skolem">q</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="var">?fs</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> keys_q'<span class="main">:</span> <span class="quoted"><span class="quoted">"keys <span class="skolem">q</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">fs</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"atomize_poly <span class="skolem">q</span> <span class="main">∈</span> sig_inv_set"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_inv_setI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vectorize_atomize_poly keys_q'<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> * <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"atomize_poly <span class="skolem">q</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dgrad_sig_set'_def <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> keys_q <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pm_of_idx_pm <span class="free">fs</span> <span class="skolem">q</span> <span class="main">=</span> pm_of_idx_pm <span class="var">?fs</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> pm_of_idx_pm_take<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> rep_list <span class="main">(</span>atomize_poly <span class="skolem">q</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rep_list_def vectorize_atomize_poly pm_of_idx_pm_of_pm<span class="main"><span class="main">[</span></span><span class="operator">OF</span> r0<span class="main"><span class="main">]</span></span> p q_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> in_idealE_rep_list_dgrad_sig_set<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"hom_grading <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> punit_dgrad_max_set <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> ideal <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">r</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> rep_list <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> ideal <span class="main">(</span>set <span class="main">(</span>take <span class="main">(</span>length <span class="free">fs</span><span class="main">)</span> <span class="free">fs</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">,</span> 2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> rep_list <span class="skolem">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> in_idealE_rep_list_dgrad_sig_set_take<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-dgrad_sig_setD_lp"><span class="command">lemma</span></span> dgrad_sig_setD_lp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> dgrad_sig_set' <span class="free">j</span> <span class="free">d</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">(</span>lp <span class="free">p</span><span class="main">)</span> <span class="main">≤</span> dgrad_max <span class="free">d</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True min_term_def pp_of_term_of_pair dgrad_max_0<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> dgrad_max_set <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dgrad_sig_set'_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dgrad_p_setD_lp<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-dgrad_sig_setD_lt"><span class="command">lemma</span></span> dgrad_sig_setD_lt<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> dgrad_sig_set' <span class="free">j</span> <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"component_of_term <span class="main">(</span>lt <span class="free">p</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">j</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> sig_inv_set' <span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dgrad_sig_set'_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_inv_setD_lt<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-dgrad_sig_setD_rep_list_lt"><span class="command">lemma</span></span> dgrad_sig_setD_rep_list_lt<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dickson_grading <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> dgrad_sig_set' <span class="free">j</span> <span class="free">d</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> dgrad_max <span class="free">d</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"rep_list <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True dgrad_max_0<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> dgrad_max_set <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dgrad_sig_set'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">p</span> <span class="main">∈</span> punit_dgrad_max_set <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dgrad_max_2<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.dgrad_p_setD_lp<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">spp_of</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">spp_of</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">=</span> <span class="main">(</span>lt <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">,</span> rep_list <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹``spp'' stands for ``sig-poly-pair''.›</span></span>

<span class="keyword1" id="Signature_Groebner-fst_spp_of"><span class="command">lemma</span></span> fst_spp_of<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>spp_of <span class="free">r</span><span class="main">)</span> <span class="main">=</span> lt <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> spp_of_def<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-snd_spp_of"><span class="command">lemma</span></span> snd_spp_of<span class="main">:</span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>spp_of <span class="free">r</span><span class="main">)</span> <span class="main">=</span> rep_list <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> spp_of_def<span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Signature Reduction›</span></span>

<span class="keyword1" id="Signature_Groebner-term_is_le_rel_canc_left"><span class="command">lemma</span></span> term_is_le_rel_canc_left<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ord_term_lin.is_le_rel <span class="free">rel</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">rel</span> <span class="main">(</span><span class="free">t</span> <span class="main">⊕</span> <span class="free">u</span><span class="main">)</span> <span class="main">(</span><span class="free">t</span> <span class="main">⊕</span> <span class="free">v</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">rel</span> <span class="free">u</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ord_term_lin.is_le_relE<span class="main"><span class="keyword3">,</span></span>
      <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> splus_left_canc <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> ord_term_canc ord_term_strict_canc splus_mono splus_mono_strict<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-term_is_le_rel_minus"><span class="command">lemma</span></span> term_is_le_rel_minus<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ord_term_lin.is_le_rel <span class="free">rel</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="keyword1">adds</span> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">rel</span> <span class="main">(</span><span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">⊕</span> <span class="free">u</span><span class="main">)</span> <span class="free">v</span> <span class="main">⟷</span> <span class="free">rel</span> <span class="main">(</span><span class="free">t</span> <span class="main">⊕</span> <span class="free">u</span><span class="main">)</span> <span class="main">(</span><span class="free">s</span> <span class="main">⊕</span> <span class="free">v</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">+</span> <span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> <span class="free">t</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> add.commute<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">s</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> adds_minus<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">rel</span> <span class="main">(</span><span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">⊕</span> <span class="free">u</span><span class="main">)</span> <span class="free">v</span> <span class="main">=</span> <span class="free">rel</span> <span class="main">(</span><span class="free">s</span> <span class="main">⊕</span> <span class="main">(</span><span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">⊕</span> <span class="free">u</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">s</span> <span class="main">⊕</span> <span class="free">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> term_is_le_rel_canc_left<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">rel</span> <span class="main">(</span><span class="free">t</span> <span class="main">⊕</span> <span class="free">u</span><span class="main">)</span> <span class="main">(</span><span class="free">s</span> <span class="main">⊕</span> <span class="free">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> splus_assoc<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> eq<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-term_is_le_rel_minus_minus"><span class="command">lemma</span></span> term_is_le_rel_minus_minus<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ord_term_lin.is_le_rel <span class="free">rel</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">adds</span> <span class="free">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="keyword1">adds</span> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">rel</span> <span class="main">(</span><span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">⊕</span> <span class="free">u</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span> <span class="main">⊕</span> <span class="free">v</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">rel</span> <span class="main">(</span><span class="free">b</span> <span class="main">⊕</span> <span class="free">u</span><span class="main">)</span> <span class="main">(</span><span class="free">a</span> <span class="main">⊕</span> <span class="free">v</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> eq1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">+</span> <span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="free">t</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> add.commute<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> adds_minus<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> eq2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">+</span> <span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="free">t</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> add.commute<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> adds_minus<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">rel</span> <span class="main">(</span><span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">⊕</span> <span class="free">u</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span> <span class="main">⊕</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="free">rel</span> <span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span><span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">⊕</span> <span class="free">u</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span><span class="main">(</span><span class="free">t</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span> <span class="main">⊕</span> <span class="free">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> term_is_le_rel_canc_left<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">rel</span> <span class="main">(</span><span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span> <span class="main">⊕</span> <span class="free">u</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span> <span class="main">⊕</span> <span class="free">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> splus_assoc<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> add.assoc add.commute eq1 eq2<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">rel</span> <span class="main">(</span><span class="free">b</span> <span class="main">⊕</span> <span class="free">u</span><span class="main">)</span> <span class="main">(</span><span class="free">a</span> <span class="main">⊕</span> <span class="free">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> splus_assoc term_is_le_rel_canc_left<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-pp_is_le_rel_canc_right"><span class="command">lemma</span></span> pp_is_le_rel_canc_right<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ordered_powerprod_lin.is_le_rel <span class="free">rel</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">rel</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="free">u</span><span class="main">)</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">u</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">rel</span> <span class="free">s</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ordered_powerprod_lin.is_le_relE<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> ord_canc ord_strict_canc plus_monotone plus_monotone_strict<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-pp_is_le_rel_canc_left"><span class="command">lemma</span></span> pp_is_le_rel_canc_left<span class="main">:</span> <span class="quoted"><span class="quoted">"ordered_powerprod_lin.is_le_rel <span class="free">rel</span> <span class="main">⟹</span> <span class="free">rel</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">u</span><span class="main">)</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">v</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">rel</span> <span class="free">u</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">t</span></span><span class="main"><span class="main">]</span></span> pp_is_le_rel_canc_right<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">sig_red_single</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒</span> <span class="tfree">'t</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">sig_red_single</span> <span class="free"><span class="bound"><span class="entity">sing_reg</span></span></span> <span class="free"><span class="bound"><span class="entity">top_tail</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">⟷</span>
                <span class="main">(</span>rep_list <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> lookup <span class="main">(</span>rep_list <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span>
                 <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">-</span> monom_mult <span class="main">(</span><span class="main">(</span>lookup <span class="main">(</span>rep_list <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> punit.lc <span class="main">(</span>rep_list <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">∧</span>
                 ord_term_lin.is_le_rel <span class="free"><span class="bound"><span class="entity">sing_reg</span></span></span> <span class="main">∧</span> ordered_powerprod_lin.is_le_rel <span class="free"><span class="bound"><span class="entity">top_tail</span></span></span> <span class="main">∧</span>
                 <span class="free"><span class="bound"><span class="entity">sing_reg</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">⊕</span> lt <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">(</span>lt <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">top_tail</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The first two parameters of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> sig_red_single<span class="antiquote"><span class="antiquote">}</span></span></span></span>, <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>sing_reg›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>top_tail›</span></span></span></span>, specify whether
  the reduction is a singular/regular/arbitrary top/tail/arbitrary signature-reduction.
  <span class="antiquoted"><span class="antiquoted">▪</span></span> If <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>sing_reg›</span></span></span></span> is <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> HOL.eq<span class="antiquote"><span class="antiquote">}</span></span></span></span>, the reduction is singular.
  <span class="antiquoted"><span class="antiquoted">▪</span></span> If <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>sing_reg›</span></span></span></span> is <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free"><span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span></span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, the reduction is regular.
  <span class="antiquoted"><span class="antiquoted">▪</span></span> If <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>sing_reg›</span></span></span></span> is <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free"><span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span></span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, the reduction is an arbitrary signature-reduction.
  <span class="antiquoted"><span class="antiquoted">▪</span></span> If <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>top_tail›</span></span></span></span> is <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> HOL.eq<span class="antiquote"><span class="antiquote">}</span></span></span></span>, it is a top reduction.
  <span class="antiquoted"><span class="antiquoted">▪</span></span> If <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>top_tail›</span></span></span></span> is <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free"><span class="main"><span class="free">(≺)</span></span></span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, it is a tail reduction.
  <span class="antiquoted"><span class="antiquoted">▪</span></span> If <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>top_tail›</span></span></span></span> is <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free"><span class="main"><span class="free">(≼)</span></span></span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, the reduction is an arbitrary signature-reduction.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">sig_red</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒</span> <span class="tfree">'t</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">sig_red</span> <span class="free"><span class="bound"><span class="entity">sing_reg</span></span></span> <span class="free"><span class="bound"><span class="entity">top_tail</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">f</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">.</span> <span class="main">∃</span><span class="bound">t</span><span class="main">.</span> sig_red_single <span class="free"><span class="bound"><span class="entity">sing_reg</span></span></span> <span class="free"><span class="bound"><span class="entity">top_tail</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="bound">f</span> <span class="bound">t</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_sig_red</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒</span> <span class="tfree">'t</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_sig_red</span> <span class="free"><span class="bound"><span class="entity">sing_reg</span></span></span> <span class="free"><span class="bound"><span class="entity">top_tail</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">q</span><span class="main">.</span> sig_red <span class="free"><span class="bound"><span class="entity">sing_reg</span></span></span> <span class="free"><span class="bound"><span class="entity">top_tail</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">q</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Signature_Groebner-sig_red_singleI"><span class="command">lemma</span></span> sig_red_singleI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">f</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span> <span class="main">∈</span> keys <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="free">p</span> <span class="main">-</span> monom_mult <span class="main">(</span><span class="main">(</span>lookup <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> punit.lc <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="free">t</span> <span class="free">f</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ord_term_lin.is_le_rel <span class="free">sing_reg</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ordered_powerprod_lin.is_le_rel <span class="free">top_tail</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">sing_reg</span> <span class="main">(</span><span class="free">t</span> <span class="main">⊕</span> lt <span class="free">f</span><span class="main">)</span> <span class="main">(</span>lt <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">top_tail</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sig_red_single <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">p</span> <span class="free">q</span> <span class="free">f</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sig_red_single_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Signature_Groebner-sig_red_singleD1"><span class="command">lemma</span></span> sig_red_singleD1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sig_red_single <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">p</span> <span class="free">q</span> <span class="free">f</span> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">f</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> sig_red_single_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Signature_Groebner-sig_red_singleD2"><span class="command">lemma</span></span> sig_red_singleD2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sig_red_single <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">p</span> <span class="free">q</span> <span class="free">f</span> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span> <span class="main">∈</span> keys <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> sig_red_single_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_keys_iff<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-sig_red_singleD3"><span class="command">lemma</span></span> sig_red_singleD3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sig_red_single <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">p</span> <span class="free">q</span> <span class="free">f</span> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="free">p</span> <span class="main">-</span> monom_mult <span class="main">(</span><span class="main">(</span>lookup <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> punit.lc <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="free">t</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> sig_red_single_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Signature_Groebner-sig_red_singleD4"><span class="command">lemma</span></span> sig_red_singleD4<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sig_red_single <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">p</span> <span class="free">q</span> <span class="free">f</span> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ord_term_lin.is_le_rel <span class="free">sing_reg</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> sig_red_single_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Signature_Groebner-sig_red_singleD5"><span class="command">lemma</span></span> sig_red_singleD5<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sig_red_single <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">p</span> <span class="free">q</span> <span class="free">f</span> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ordered_powerprod_lin.is_le_rel <span class="free">top_tail</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> sig_red_single_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Signature_Groebner-sig_red_singleD6"><span class="command">lemma</span></span> sig_red_singleD6<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sig_red_single <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">p</span> <span class="free">q</span> <span class="free">f</span> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">sing_reg</span> <span class="main">(</span><span class="free">t</span> <span class="main">⊕</span> lt <span class="free">f</span><span class="main">)</span> <span class="main">(</span>lt <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> sig_red_single_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Signature_Groebner-sig_red_singleD7"><span class="command">lemma</span></span> sig_red_singleD7<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sig_red_single <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">p</span> <span class="free">q</span> <span class="free">f</span> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">top_tail</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> sig_red_single_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Signature_Groebner-sig_red_singleD8"><span class="command">lemma</span></span> sig_red_singleD8<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sig_red_single <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">p</span> <span class="free">q</span> <span class="free">f</span> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">⊕</span> lt <span class="free">f</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ord_term_lin.is_le_rel <span class="free">sing_reg</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">sing_reg</span> <span class="main">(</span><span class="free">t</span> <span class="main">⊕</span> lt <span class="free">f</span><span class="main">)</span> <span class="main">(</span>lt <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_singleD4<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> sig_red_singleD6<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ord_term_lin.is_le_rel_le<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-sig_red_singleD9"><span class="command">lemma</span></span> sig_red_singleD9<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sig_red_single <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">p</span> <span class="free">q</span> <span class="free">f</span> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span> <span class="main"><span class="free">≼</span></span> punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ordered_powerprod_lin.is_le_rel <span class="free">top_tail</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">top_tail</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_singleD5<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> sig_red_singleD7<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ordered_powerprod_lin.is_le_rel_le<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> sig_red_singleD <span class="main">=</span> sig_red_singleD1 sig_red_singleD2 sig_red_singleD3 sig_red_singleD4
                         sig_red_singleD5 sig_red_singleD6 sig_red_singleD7 sig_red_singleD8 sig_red_singleD9

<span class="keyword1" id="Signature_Groebner-sig_red_single_red_single"><span class="command">lemma</span></span> sig_red_single_red_single<span class="main">:</span>
  <span class="quoted"><span class="quoted">"sig_red_single <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">p</span> <span class="free">q</span> <span class="free">f</span> <span class="free">t</span> <span class="main">⟹</span> punit.red_single <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span> <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sig_red_single_def punit.red_single_def rep_list_minus rep_list_monom_mult<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-sig_red_single_regular_lt"><span class="command">lemma</span></span> sig_red_single_regular_lt<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sig_red_single <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="free">top_tail</span> <span class="free">p</span> <span class="free">q</span> <span class="free">f</span> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lt <span class="free">q</span> <span class="main">=</span> lt <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"monom_mult <span class="main">(</span><span class="main">(</span>lookup <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> punit.lc <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="free">t</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> lt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">⊕</span> lt <span class="free">f</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="free">p</span> <span class="main">-</span> <span class="var">?f</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_singleD6<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> sig_red_singleD3<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> lt_monom_mult_le lt <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="var">?f</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ord_term_lin.order.strict_trans1<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> q <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lt_minus_eqI_2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-sig_red_single_regular_lc"><span class="command">lemma</span></span> sig_red_single_regular_lc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sig_red_single <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="free">top_tail</span> <span class="free">p</span> <span class="free">q</span> <span class="free">f</span> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lc <span class="free">q</span> <span class="main">=</span> lc <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="free">q</span> <span class="main">=</span> lt <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_single_regular_lt<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> lt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">⊕</span> lt <span class="free">f</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="free">p</span> <span class="main">-</span> monom_mult <span class="main">(</span><span class="main">(</span>lookup <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> punit.lc <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="free">t</span> <span class="free">f</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="main">_</span> <span class="main">-</span> <span class="var">?f</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_singleD6<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> sig_red_singleD3<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> lt_monom_mult_le lt <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="var">?f</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ord_term_lin.order.strict_trans1<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lookup <span class="var">?f</span> <span class="main">(</span>lt <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> lt_max ord_term_lin.leD <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> lc_def <span class="quoted"><span class="quoted">‹lt <span class="free">q</span> <span class="main">=</span> lt <span class="free">p</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> q lookup_minus<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-sig_red_single_lt"><span class="command">lemma</span></span> sig_red_single_lt<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sig_red_single <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">p</span> <span class="free">q</span> <span class="free">f</span> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lt <span class="free">q</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> lt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">⊕</span> lt <span class="free">f</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="free">p</span> <span class="main">-</span> monom_mult <span class="main">(</span><span class="main">(</span>lookup <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> punit.lc <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="free">t</span> <span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_singleD8<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> sig_red_singleD3<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="free">p</span> <span class="main">+</span> monom_mult <span class="main">(</span><span class="main">-</span> <span class="main">(</span>lookup <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> punit.lc <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="free">t</span> <span class="free">f</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="main">_</span> <span class="main">+</span> <span class="var">?f</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> monom_mult_uminus_left<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> lt_monom_mult_le lt <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"lt <span class="var">?f</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ord_term_lin.order.trans<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="free">q</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> ord_term_lin.max <span class="main">(</span>lt <span class="free">p</span><span class="main">)</span> <span class="main">(</span>lt <span class="var">?f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> q <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> lt_plus_le_max<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ord_term_lin.max <span class="main">(</span>lt <span class="free">p</span><span class="main">)</span> <span class="main">(</span>lt <span class="var">?f</span><span class="main">)</span> <span class="main">=</span> lt <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ord_term_lin.max.absorb1<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-sig_red_single_lt_rep_list"><span class="command">lemma</span></span> sig_red_single_lt_rep_list<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sig_red_single <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">p</span> <span class="free">q</span> <span class="free">f</span> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span> <span class="main"><span class="free">≼</span></span> punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.red_single <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span> <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span> <span class="free">t</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_single_red_single<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"punit.ord_strict_p <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span> <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.red_single_ord<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"punit.ord_p <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span> <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.ord_p_lt<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-sig_red_single_tail_lt_in_keys_rep_list"><span class="command">lemma</span></span> sig_red_single_tail_lt_in_keys_rep_list<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sig_red_single <span class="free">sing_reg</span> <span class="main"><span class="free">(≺)</span></span> <span class="free">p</span> <span class="free">q</span> <span class="free">f</span> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">∈</span> keys <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="free">p</span> <span class="main">-</span> monom_mult <span class="main">(</span><span class="main">(</span>lookup <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> punit.lc <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="free">t</span> <span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_singleD3<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="free">p</span> <span class="main">+</span> monom_mult <span class="main">(</span><span class="main">-</span> <span class="main">(</span>lookup <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> punit.lc <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="free">t</span> <span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> monom_mult_uminus_left<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> q rep_list_plus rep_list_monom_mult
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> in_keys_plusI1<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span> <span class="main">∈</span> keys <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_singleD2<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">∈</span> keys <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.lt_in_keys<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">∉</span>
      keys <span class="main">(</span>punit.monom_mult <span class="main">(</span><span class="main">-</span> lookup <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> punit.lc <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="free">t</span> <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">∉</span> keys <span class="var">?f</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">∈</span> keys <span class="var">?f</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main"><span class="free">≼</span></span> punit.lt <span class="var">?f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.lt_max_keys<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main"><span class="free">≼</span></span> <span class="free">t</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> punit.lt_monom_mult_le<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main"><span class="free">≺</span></span> punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_singleD7<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> sig_red_single_tail_lt_rep_list<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sig_red_single <span class="free">sing_reg</span> <span class="main"><span class="free">(≺)</span></span> <span class="free">p</span> <span class="free">q</span> <span class="free">f</span> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span> <span class="main">=</span> punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ordered_powerprod_lin.order_antisym<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span> <span class="main"><span class="free">≼</span></span> punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_single_lt_rep_list<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">∈</span> keys <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_single_tail_lt_in_keys_rep_list<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main"><span class="free">≼</span></span> punit.lt <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.lt_max_keys<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-sig_red_single_tail_lc_rep_list"><span class="command">lemma</span></span> sig_red_single_tail_lc_rep_list<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sig_red_single <span class="free">sing_reg</span> <span class="main"><span class="free">(≺)</span></span> <span class="free">p</span> <span class="free">q</span> <span class="free">f</span> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"punit.lc <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span> <span class="main">=</span> punit.lc <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span> <span class="main">=</span> punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_single_tail_lt_rep_list<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> lt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span> <span class="main"><span class="free">≺</span></span> punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="free">p</span> <span class="main">-</span> monom_mult <span class="main">(</span><span class="main">(</span>lookup <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> punit.lc <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="free">t</span> <span class="free">f</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="main">_</span> <span class="main">-</span> <span class="var">?f</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_singleD7<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> sig_red_singleD3<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> punit.lt_monom_mult_le<span class="main">[</span><span class="operator">simplified</span><span class="main">]</span> lt <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="var">?f</span><span class="main">)</span> <span class="main"><span class="free">≺</span></span> punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> rep_list_monom_mult <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ordered_powerprod_lin.order.strict_trans1<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lookup <span class="main">(</span>rep_list <span class="var">?f</span><span class="main">)</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> punit.lt_max ordered_powerprod_lin.leD <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> punit.lc_def * <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> q lookup_minus rep_list_minus punit.lc_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-sig_red_single_top_lt_rep_list"><span class="command">lemma</span></span> sig_red_single_top_lt_rep_list<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sig_red_single <span class="free">sing_reg</span> <span class="main">(=)</span> <span class="free">p</span> <span class="free">q</span> <span class="free">f</span> <span class="free">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span> <span class="main"><span class="free">≺</span></span> punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">f</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> in_keys<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span> <span class="main">∈</span> keys <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> lt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span> <span class="main">=</span> punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="free">p</span> <span class="main">-</span> monom_mult <span class="main">(</span><span class="main">(</span>lookup <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> punit.lc <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="free">t</span> <span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_singleD<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="free">p</span> <span class="main">+</span> monom_mult <span class="main">(</span><span class="main">-</span> <span class="main">(</span>lookup <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> punit.lc <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="free">t</span> <span class="free">f</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="main">_</span> <span class="main">+</span> monom_mult <span class="var">?c</span> <span class="main">_</span> <span class="main">_</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> monom_mult_uminus_left<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹rep_list <span class="free">f</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.lc <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.lc_not_0<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"rep_list <span class="free">p</span> <span class="main">+</span> punit.monom_mult <span class="var">?c</span> <span class="free">t</span> <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> q rep_list_plus rep_list_monom_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> in_keys <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lookup <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_keys_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹rep_list <span class="free">f</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.lc <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.lc_not_0<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>punit.monom_mult <span class="var">?c</span> <span class="free">t</span> <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">t</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹rep_list <span class="free">f</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lp_monom_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>punit.monom_mult <span class="var">?c</span> <span class="free">t</span> <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> lt<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.lc <span class="main">(</span>punit.monom_mult <span class="var">?c</span> <span class="free">t</span> <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> punit.lc <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lt punit.lc_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> <span class="quoted"><span class="quoted">‹punit.lc <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> rep_list_plus rep_list_monom_mult q <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.lt_plus_lessI<span class="main"><span class="main">[</span></span><span class="operator">OF</span> *<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-sig_red_single_monom_mult"><span class="command">lemma</span></span> sig_red_single_monom_mult<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sig_red_single <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">p</span> <span class="free">q</span> <span class="free">f</span> <span class="free">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sig_red_single <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="main">(</span>monom_mult <span class="free">c</span> <span class="free">s</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span>monom_mult <span class="free">c</span> <span class="free">s</span> <span class="free">q</span><span class="main">)</span> <span class="free">f</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="free">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"ord_term_lin.is_le_rel <span class="free">sing_reg</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"ordered_powerprod_lin.is_le_rel <span class="free">top_tail</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_singleD4<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> sig_red_singleD5<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> eq1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="free">t</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">f</span> <span class="main">=</span> <span class="free">s</span> <span class="main">⊕</span> <span class="main">(</span><span class="free">t</span> <span class="main">⊕</span> lt <span class="free">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> splus_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span> <span class="main">∈</span> keys <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_singleD2<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rep_list_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> eq2<span class="main">:</span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span>monom_mult <span class="free">c</span> <span class="free">s</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">s</span> <span class="main">⊕</span> lt <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lt_monom_mult<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_singleI<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">f</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_singleD1<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">+</span> <span class="free">t</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span> <span class="main">∈</span> keys <span class="main">(</span>rep_list <span class="main">(</span>monom_mult <span class="free">c</span> <span class="free">s</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rep_list_monom_mult punit.keys_monom_mult<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main"><span class="main">(</span></span></span>2<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">]</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> 1<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="free">p</span> <span class="main">-</span> monom_mult <span class="main">(</span><span class="main">(</span>lookup <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> punit.lc <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="free">t</span> <span class="free">f</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_singleD3<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"monom_mult <span class="free">c</span> <span class="free">s</span> <span class="free">q</span> <span class="main">=</span>
          monom_mult <span class="free">c</span> <span class="free">s</span> <span class="free">p</span> <span class="main">-</span>
            monom_mult <span class="main">(</span>lookup <span class="main">(</span>rep_list <span class="main">(</span>monom_mult <span class="free">c</span> <span class="free">s</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="free">t</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> punit.lc <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="free">t</span><span class="main">)</span> <span class="free">f</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> q monom_mult_dist_right_minus <span class="dynamic"><span class="dynamic">ac_simps</span></span> rep_list_monom_mult
          punit.lookup_monom_mult_plus<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span> monom_mult_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">sing_reg</span> <span class="main">(</span><span class="free">t</span> <span class="main">⊕</span> lt <span class="free">f</span><span class="main">)</span> <span class="main">(</span>lt <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_singleD6<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">sing_reg</span> <span class="main">(</span><span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="free">t</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">f</span><span class="main">)</span> <span class="main">(</span>lt <span class="main">(</span>monom_mult <span class="free">c</span> <span class="free">s</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> eq1 eq2 term_is_le_rel_canc_left<span class="main"><span class="main">[</span></span><span class="operator">OF</span> a<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">top_tail</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_singleD7<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">top_tail</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="free">t</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="main">(</span>monom_mult <span class="free">c</span> <span class="free">s</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rep_list_monom_mult punit.lt_monom_mult<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main"><span class="main">(</span></span></span>2<span class="main"><span class="main"><span class="main">)</span></span></span> <span class="quoted"><span class="quoted">‹rep_list <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main"><span class="main">]</span></span> add.assoc pp_is_le_rel_canc_left<span class="main"><span class="main">[</span></span><span class="operator">OF</span> b<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">fact</span> a<span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span> b<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-sig_red_single_sing_reg_cases"><span class="command">lemma</span></span> sig_red_single_sing_reg_cases<span class="main">:</span>
  <span class="quoted"><span class="quoted">"sig_red_single <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="free">top_tail</span> <span class="free">p</span> <span class="free">q</span> <span class="free">f</span> <span class="free">t</span> <span class="main">=</span> <span class="main">(</span>sig_red_single <span class="main">(=)</span> <span class="free">top_tail</span> <span class="free">p</span> <span class="free">q</span> <span class="free">f</span> <span class="free">t</span> <span class="main">∨</span> sig_red_single <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="free">top_tail</span> <span class="free">p</span> <span class="free">q</span> <span class="free">f</span> <span class="free">t</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sig_red_single_def<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> sig_red_single_sing_regI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sig_red_single <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">p</span> <span class="free">q</span> <span class="free">f</span> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sig_red_single <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="free">top_tail</span> <span class="free">p</span> <span class="free">q</span> <span class="free">f</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ord_term_lin.is_le_rel <span class="free">sing_reg</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_singleD<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> ord_term_lin.is_le_rel_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sig_red_single_sing_reg_cases<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-sig_red_single_top_tail_cases"><span class="command">lemma</span></span> sig_red_single_top_tail_cases<span class="main">:</span>
  <span class="quoted"><span class="quoted">"sig_red_single <span class="free">sing_reg</span> <span class="main"><span class="free">(≼)</span></span> <span class="free">p</span> <span class="free">q</span> <span class="free">f</span> <span class="free">t</span> <span class="main">=</span> <span class="main">(</span>sig_red_single <span class="free">sing_reg</span> <span class="main">(=)</span> <span class="free">p</span> <span class="free">q</span> <span class="free">f</span> <span class="free">t</span> <span class="main">∨</span> sig_red_single <span class="free">sing_reg</span> <span class="main"><span class="free">(≺)</span></span> <span class="free">p</span> <span class="free">q</span> <span class="free">f</span> <span class="free">t</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sig_red_single_def<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> sig_red_single_top_tailI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sig_red_single <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">p</span> <span class="free">q</span> <span class="free">f</span> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sig_red_single <span class="free">sing_reg</span> <span class="main"><span class="free">(≼)</span></span> <span class="free">p</span> <span class="free">q</span> <span class="free">f</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ordered_powerprod_lin.is_le_rel <span class="free">top_tail</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_singleD<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> ordered_powerprod_lin.is_le_rel_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sig_red_single_top_tail_cases<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-dgrad_max_set_closed_sig_red_single"><span class="command">lemma</span></span> dgrad_max_set_closed_sig_red_single<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dickson_grading <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> dgrad_max_set <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> dgrad_max_set <span class="free">d</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"sig_red_single <span class="free">sing_red</span> <span class="free">top_tail</span> <span class="free">p</span> <span class="free">q</span> <span class="free">f</span> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> dgrad_max_set <span class="free">d</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"monom_mult <span class="main">(</span>lookup <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> punit.lc <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="free">t</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span> <span class="main">∈</span> keys <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="free">p</span> <span class="main">-</span> <span class="var">?f</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_singleD2<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> sig_red_singleD3<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">,</span> 2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">p</span> <span class="main">∈</span> punit_dgrad_max_set <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dgrad_max_2<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> q <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> dgrad_p_set_closed_minus<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> _ assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">∈</span> dgrad_max_set <span class="free">d</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> dgrad_p_set_closed_monom_mult<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="free">t</span> <span class="main">≤</span> <span class="free">d</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dickson_gradingD1<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹rep_list <span class="free">p</span> <span class="main">∈</span> punit_dgrad_max_set <span class="free">d</span>›</span></span> t <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> dgrad_max <span class="free">d</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.dgrad_p_setD<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="free">t</span> <span class="main">≤</span> dgrad_max <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-sig_inv_set_closed_sig_red_single"><span class="command">lemma</span></span> sig_inv_set_closed_sig_red_single<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> sig_inv_set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> sig_inv_set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"sig_red_single <span class="free">sing_red</span> <span class="free">top_tail</span> <span class="free">p</span> <span class="free">q</span> <span class="free">f</span> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> sig_inv_set"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"monom_mult <span class="main">(</span>lookup <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> punit.lc <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="free">t</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span> <span class="main">∈</span> keys <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="free">p</span> <span class="main">-</span> <span class="var">?f</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_singleD2<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> sig_red_singleD3<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> q <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sig_inv_set_closed_minus<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">∈</span> sig_inv_set"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_inv_set_closed_monom_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> dgrad_sig_set_closed_sig_red_single<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dickson_grading <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"sig_red_single <span class="free">sing_red</span> <span class="free">top_tail</span> <span class="free">p</span> <span class="free">q</span> <span class="free">f</span> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> dgrad_sig_set'_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> dgrad_max_set_closed_sig_red_single sig_inv_set_closed_sig_red_single<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-sig_red_regular_lt"><span class="command">lemma</span></span> sig_red_regular_lt<span class="main">:</span> <span class="quoted"><span class="quoted">"sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="free">top_tail</span> <span class="free">F</span> <span class="free">p</span> <span class="free">q</span> <span class="main">⟹</span> lt <span class="free">q</span> <span class="main">=</span> lt <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sig_red_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> sig_red_single_regular_lt<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-sig_red_regular_lc"><span class="command">lemma</span></span> sig_red_regular_lc<span class="main">:</span> <span class="quoted"><span class="quoted">"sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="free">top_tail</span> <span class="free">F</span> <span class="free">p</span> <span class="free">q</span> <span class="main">⟹</span> lc <span class="free">q</span> <span class="main">=</span> lc <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sig_red_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> sig_red_single_regular_lc<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-sig_red_lt"><span class="command">lemma</span></span> sig_red_lt<span class="main">:</span> <span class="quoted"><span class="quoted">"sig_red <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">F</span> <span class="free">p</span> <span class="free">q</span> <span class="main">⟹</span> lt <span class="free">q</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sig_red_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> sig_red_single_lt<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-sig_red_tail_lt_rep_list"><span class="command">lemma</span></span> sig_red_tail_lt_rep_list<span class="main">:</span> <span class="quoted"><span class="quoted">"sig_red <span class="free">sing_reg</span> <span class="main"><span class="free">(≺)</span></span> <span class="free">F</span> <span class="free">p</span> <span class="free">q</span> <span class="main">⟹</span> punit.lt <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span> <span class="main">=</span> punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sig_red_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> sig_red_single_tail_lt_rep_list<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-sig_red_tail_lc_rep_list"><span class="command">lemma</span></span> sig_red_tail_lc_rep_list<span class="main">:</span> <span class="quoted"><span class="quoted">"sig_red <span class="free">sing_reg</span> <span class="main"><span class="free">(≺)</span></span> <span class="free">F</span> <span class="free">p</span> <span class="free">q</span> <span class="main">⟹</span> punit.lc <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span> <span class="main">=</span> punit.lc <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sig_red_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> sig_red_single_tail_lc_rep_list<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-sig_red_top_lt_rep_list"><span class="command">lemma</span></span> sig_red_top_lt_rep_list<span class="main">:</span>
  <span class="quoted"><span class="quoted">"sig_red <span class="free">sing_reg</span> <span class="main">(=)</span> <span class="free">F</span> <span class="free">p</span> <span class="free">q</span> <span class="main">⟹</span> rep_list <span class="free">q</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> punit.lt <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span> <span class="main"><span class="free">≺</span></span> punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sig_red_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> sig_red_single_top_lt_rep_list<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-sig_red_lt_rep_list"><span class="command">lemma</span></span> sig_red_lt_rep_list<span class="main">:</span> <span class="quoted"><span class="quoted">"sig_red <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">F</span> <span class="free">p</span> <span class="free">q</span> <span class="main">⟹</span> punit.lt <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span> <span class="main"><span class="free">≼</span></span> punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sig_red_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> sig_red_single_lt_rep_list<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-sig_red_red"><span class="command">lemma</span></span> sig_red_red<span class="main">:</span> <span class="quoted"><span class="quoted">"sig_red <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">F</span> <span class="free">p</span> <span class="free">q</span> <span class="main">⟹</span> punit.red <span class="main">(</span>rep_list <span class="main">`</span> <span class="free">F</span><span class="main">)</span> <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sig_red_def punit.red_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> sig_red_single_red_single<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-sig_red_monom_mult"><span class="command">lemma</span></span> sig_red_monom_mult<span class="main">:</span>
  <span class="quoted"><span class="quoted">"sig_red <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">F</span> <span class="free">p</span> <span class="free">q</span> <span class="main">⟹</span> <span class="free">c</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> sig_red <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">F</span> <span class="main">(</span>monom_mult <span class="free">c</span> <span class="free">s</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span>monom_mult <span class="free">c</span> <span class="free">s</span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sig_red_def punit.red_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> sig_red_single_monom_mult<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-sig_red_sing_reg_cases"><span class="command">lemma</span></span> sig_red_sing_reg_cases<span class="main">:</span>
  <span class="quoted"><span class="quoted">"sig_red <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="free">top_tail</span> <span class="free">F</span> <span class="free">p</span> <span class="free">q</span> <span class="main">=</span> <span class="main">(</span>sig_red <span class="main">(=)</span> <span class="free">top_tail</span> <span class="free">F</span> <span class="free">p</span> <span class="free">q</span> <span class="main">∨</span> sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="free">top_tail</span> <span class="free">F</span> <span class="free">p</span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sig_red_def sig_red_single_sing_reg_cases<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> sig_red_sing_regI<span class="main">:</span> <span class="quoted"><span class="quoted">"sig_red <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">F</span> <span class="free">p</span> <span class="free">q</span> <span class="main">⟹</span> sig_red <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="free">top_tail</span> <span class="free">F</span> <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sig_red_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> sig_red_single_sing_regI<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-sig_red_top_tail_cases"><span class="command">lemma</span></span> sig_red_top_tail_cases<span class="main">:</span>
  <span class="quoted"><span class="quoted">"sig_red <span class="free">sing_reg</span> <span class="main"><span class="free">(≼)</span></span> <span class="free">F</span> <span class="free">p</span> <span class="free">q</span> <span class="main">=</span> <span class="main">(</span>sig_red <span class="free">sing_reg</span> <span class="main">(=)</span> <span class="free">F</span> <span class="free">p</span> <span class="free">q</span> <span class="main">∨</span> sig_red <span class="free">sing_reg</span> <span class="main"><span class="free">(≺)</span></span> <span class="free">F</span> <span class="free">p</span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sig_red_def sig_red_single_top_tail_cases<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> sig_red_top_tailI<span class="main">:</span> <span class="quoted"><span class="quoted">"sig_red <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">F</span> <span class="free">p</span> <span class="free">q</span> <span class="main">⟹</span> sig_red <span class="free">sing_reg</span> <span class="main"><span class="free">(≼)</span></span> <span class="free">F</span> <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sig_red_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> sig_red_single_top_tailI<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-sig_red_wf_dgrad_max_set"><span class="command">lemma</span></span> sig_red_wf_dgrad_max_set<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dickson_grading <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> dgrad_max_set <span class="free">d</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"wfP <span class="main">(</span>sig_red <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">F</span><span class="main">)</span><span class="main">¯¯</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="main">`</span> <span class="free">F</span> <span class="main">⊆</span> punit_dgrad_max_set <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dgrad_max_3<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"wfP <span class="main">(</span>punit.red <span class="main">(</span>rep_list <span class="main">`</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span><span class="main">¯¯</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.red_wf_dgrad_p_set<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∄</span><span class="bound">f</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span>punit.red <span class="main">(</span>rep_list <span class="main">`</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span><span class="main">¯¯</span> <span class="main">(</span><span class="bound">f</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="bound">f</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_iff_no_infinite_down_chain<span class="main"><span class="main">[</span></span><span class="operator">to_pred</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> wf_iff_no_infinite_down_chain<span class="main">[</span><span class="operator">to_pred</span><span class="main">]</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">elim</span> exE<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">seq</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span>sig_red <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">F</span><span class="main">)</span><span class="main">¯¯</span> <span class="main">(</span><span class="skolem">seq</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">seq</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sig_red <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">F</span> <span class="main">(</span><span class="skolem">seq</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">seq</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"punit.red <span class="main">(</span>rep_list <span class="main">`</span> <span class="free">F</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>rep_list <span class="main">∘</span> <span class="skolem">seq</span><span class="main">)</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>rep_list <span class="main">∘</span> <span class="skolem">seq</span><span class="main">)</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> sig_red_red<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span>punit.red <span class="main">(</span>rep_list <span class="main">`</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span><span class="main">¯¯</span> <span class="main">(</span><span class="main">(</span>rep_list <span class="main">∘</span> <span class="skolem">seq</span><span class="main">)</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>rep_list <span class="main">∘</span> <span class="skolem">seq</span><span class="main">)</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">f</span><span class="main">.</span> <span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span>punit.red <span class="main">(</span>rep_list <span class="main">`</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span><span class="main">¯¯</span> <span class="main">(</span><span class="bound">f</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="bound">f</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> * <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-dgrad_sig_set_closed_sig_red"><span class="command">lemma</span></span> dgrad_sig_set_closed_sig_red<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dickson_grading <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> dgrad_sig_set <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"sig_red <span class="free">sing_red</span> <span class="free">top_tail</span> <span class="free">F</span> <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sig_red_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> dgrad_sig_set_closed_sig_red_single<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-sig_red_mono"><span class="command">lemma</span></span> sig_red_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"sig_red <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">F</span> <span class="free">p</span> <span class="free">q</span> <span class="main">⟹</span> <span class="free">F</span> <span class="main">⊆</span> <span class="free">F'</span> <span class="main">⟹</span> sig_red <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">F'</span> <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sig_red_def<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-sig_red_Un"><span class="command">lemma</span></span> sig_red_Un<span class="main">:</span>
  <span class="quoted"><span class="quoted">"sig_red <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span> <span class="free">p</span> <span class="free">q</span> <span class="main">⟷</span> <span class="main">(</span>sig_red <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">A</span> <span class="free">p</span> <span class="free">q</span> <span class="main">∨</span> sig_red <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">B</span> <span class="free">p</span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sig_red_def<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-sig_red_subset"><span class="command">lemma</span></span> sig_red_subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sig_red <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">F</span> <span class="free">p</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">sing_reg</span> <span class="main">=</span> <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">∨</span> <span class="free">sing_reg</span> <span class="main">=</span> <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sig_red <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span><span class="main">∈</span><span class="free">F</span><span class="main">.</span> <span class="free">sing_reg</span> <span class="main">(</span>lt <span class="bound">f</span><span class="main">)</span> <span class="main">(</span>lt <span class="free">p</span><span class="main">)</span><span class="main">}</span> <span class="free">p</span> <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"sig_red_single <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">p</span> <span class="free">q</span> <span class="skolem">f</span> <span class="skolem">t</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> sig_red_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">f</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⊕</span> lt <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">term_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> zero_min <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="skolem">t</span> <span class="main">⊕</span> lt <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> splus_mono_left<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"lt <span class="skolem">f</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="skolem">t</span> <span class="main">⊕</span> lt <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">from</span></span> * <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">sing_reg</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">⊕</span> lt <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span>lt <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_singleD6<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">sing_reg</span> <span class="main">(</span>lt <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span>lt <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">sing_reg</span> <span class="main">=</span> <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> 1 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">sing_reg</span> <span class="main">=</span> <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> 1 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="free">F</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span><span class="main">∈</span><span class="free">F</span><span class="main">.</span> <span class="free">sing_reg</span> <span class="main">(</span>lt <span class="bound">f</span><span class="main">)</span> <span class="main">(</span>lt <span class="free">p</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">unfolding</span></span> sig_red_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-sig_red_regular_rtrancl_lt"><span class="command">lemma</span></span> sig_red_regular_rtrancl_lt<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="free">top_tail</span> <span class="free">F</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lt <span class="free">q</span> <span class="main">=</span> lt <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> sig_red_regular_lt<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-sig_red_regular_rtrancl_lc"><span class="command">lemma</span></span> sig_red_regular_rtrancl_lc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="free">top_tail</span> <span class="free">F</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lc <span class="free">q</span> <span class="main">=</span> lc <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> sig_red_regular_lc<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-sig_red_rtrancl_lt"><span class="command">lemma</span></span> sig_red_rtrancl_lt<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sig_red <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">F</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lt <span class="free">q</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> sig_red_lt<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-sig_red_tail_rtrancl_lt_rep_list"><span class="command">lemma</span></span> sig_red_tail_rtrancl_lt_rep_list<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sig_red <span class="free">sing_reg</span> <span class="main"><span class="free">(≺)</span></span> <span class="free">F</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span> <span class="main">=</span> punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> sig_red_tail_lt_rep_list<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-sig_red_tail_rtrancl_lc_rep_list"><span class="command">lemma</span></span> sig_red_tail_rtrancl_lc_rep_list<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sig_red <span class="free">sing_reg</span> <span class="main"><span class="free">(≺)</span></span> <span class="free">F</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"punit.lc <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span> <span class="main">=</span> punit.lc <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> sig_red_tail_lc_rep_list<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-sig_red_rtrancl_lt_rep_list"><span class="command">lemma</span></span> sig_red_rtrancl_lt_rep_list<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sig_red <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">F</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span> <span class="main"><span class="free">≼</span></span> punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> sig_red_lt_rep_list<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-sig_red_red_rtrancl"><span class="command">lemma</span></span> sig_red_red_rtrancl<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sig_red <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">F</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>punit.red <span class="main">(</span>rep_list <span class="main">`</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> sig_red_red<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-sig_red_rtrancl_monom_mult"><span class="command">lemma</span></span> sig_red_rtrancl_monom_mult<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sig_red <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">F</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sig_red <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">F</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>monom_mult <span class="free">c</span> <span class="free">s</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span>monom_mult <span class="free">c</span> <span class="free">s</span> <span class="free">q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">induct</span>
    <span class="keyword3"><span class="command">case</span></span> base
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">y</span> <span class="skolem">z</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> step<span class="main">(</span>2<span class="main">)</span> False <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sig_red <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">F</span> <span class="main">(</span>monom_mult <span class="free">c</span> <span class="free">s</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">(</span>monom_mult <span class="free">c</span> <span class="free">s</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_monom_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> step<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-sig_red_rtrancl_sing_regI"><span class="command">lemma</span></span> sig_red_rtrancl_sing_regI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sig_red <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">F</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">p</span> <span class="free">q</span> <span class="main">⟹</span> <span class="main">(</span>sig_red <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="free">top_tail</span> <span class="free">F</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rtranclp_induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> sig_red_sing_regI<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-sig_red_rtrancl_top_tailI"><span class="command">lemma</span></span> sig_red_rtrancl_top_tailI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sig_red <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">F</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">p</span> <span class="free">q</span> <span class="main">⟹</span> <span class="main">(</span>sig_red <span class="free">sing_reg</span> <span class="main"><span class="free">(≼)</span></span> <span class="free">F</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rtranclp_induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> sig_red_top_tailI<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-dgrad_sig_set_closed_sig_red_rtrancl"><span class="command">lemma</span></span> dgrad_sig_set_closed_sig_red_rtrancl<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dickson_grading <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> dgrad_sig_set <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sig_red <span class="free">sing_red</span> <span class="free">top_tail</span> <span class="free">F</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">,</span> 1<span class="main">,</span> 2<span class="main">,</span> 3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> dgrad_sig_set_closed_sig_red<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-sig_red_rtrancl_mono"><span class="command">lemma</span></span> sig_red_rtrancl_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sig_red <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">F</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">p</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="free">F'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sig_red <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">F'</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rtranclp_induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> sig_red_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ assms<span class="main"><span class="main"><span class="main">(</span></span></span>2<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-sig_red_rtrancl_subset"><span class="command">lemma</span></span> sig_red_rtrancl_subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sig_red <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">F</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">p</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">sing_reg</span> <span class="main">=</span> <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">∨</span> <span class="free">sing_reg</span> <span class="main">=</span> <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sig_red <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span><span class="main">∈</span><span class="free">F</span><span class="main">.</span> <span class="free">sing_reg</span> <span class="main">(</span>lt <span class="bound">f</span><span class="main">)</span> <span class="main">(</span>lt <span class="free">p</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rtranclp_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> base
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> rtranclp.rtrancl_refl<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">y</span> <span class="skolem">z</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> step<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sig_red <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">F</span><span class="main">.</span> <span class="free">sing_reg</span> <span class="main">(</span>lt <span class="bound">f</span><span class="main">)</span> <span class="main">(</span>lt <span class="skolem">y</span><span class="main">)</span><span class="main">}</span> <span class="skolem">y</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">F</span><span class="main">.</span> <span class="free">sing_reg</span> <span class="main">(</span>lt <span class="bound">f</span><span class="main">)</span> <span class="main">(</span>lt <span class="skolem">y</span><span class="main">)</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">F</span><span class="main">.</span> <span class="free">sing_reg</span> <span class="main">(</span>lt <span class="bound">f</span><span class="main">)</span> <span class="main">(</span>lt <span class="free">p</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">F</span><span class="main">.</span> <span class="free">sing_reg</span> <span class="main">(</span>lt <span class="bound">f</span><span class="main">)</span> <span class="main">(</span>lt <span class="skolem">y</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">sing_reg</span> <span class="main">(</span>lt <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span>lt <span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">from</span></span> step<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"lt <span class="skolem">y</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_rtrancl_lt<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">sing_reg</span> <span class="main">(</span>lt <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span>lt <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">sing_reg</span> <span class="main">=</span> <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> 1 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">sing_reg</span> <span class="main">=</span> <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> 1 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="free">F</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">F</span><span class="main">.</span> <span class="free">sing_reg</span> <span class="main">(</span>lt <span class="bound">f</span><span class="main">)</span> <span class="main">(</span>lt <span class="free">p</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sig_red <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> <span class="free">F</span><span class="main">.</span> <span class="free">sing_reg</span> <span class="main">(</span>lt <span class="bound">f</span><span class="main">)</span> <span class="main">(</span>lt <span class="free">p</span><span class="main">)</span><span class="main">}</span> <span class="skolem">y</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> step<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-is_sig_red_is_red"><span class="command">lemma</span></span> is_sig_red_is_red<span class="main">:</span> <span class="quoted"><span class="quoted">"is_sig_red <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">F</span> <span class="free">p</span> <span class="main">⟹</span> punit.is_red <span class="main">(</span>rep_list <span class="main">`</span> <span class="free">F</span><span class="main">)</span> <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_sig_red_def punit.is_red_alt <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> sig_red_red<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-is_sig_red_monom_mult"><span class="command">lemma</span></span> is_sig_red_monom_mult<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">F</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">F</span> <span class="main">(</span>monom_mult <span class="free">c</span> <span class="free">s</span> <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"sig_red <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">F</span> <span class="free">p</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_sig_red_def <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sig_red <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">F</span> <span class="main">(</span>monom_mult <span class="free">c</span> <span class="free">s</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span>monom_mult <span class="free">c</span> <span class="free">s</span> <span class="skolem">q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_monom_mult<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_sig_red_def <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-is_sig_red_sing_reg_cases"><span class="command">lemma</span></span> is_sig_red_sing_reg_cases<span class="main">:</span>
  <span class="quoted"><span class="quoted">"is_sig_red <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="free">top_tail</span> <span class="free">F</span> <span class="free">p</span> <span class="main">=</span> <span class="main">(</span>is_sig_red <span class="main">(=)</span> <span class="free">top_tail</span> <span class="free">F</span> <span class="free">p</span> <span class="main">∨</span> is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="free">top_tail</span> <span class="free">F</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_sig_red_def sig_red_sing_reg_cases<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> is_sig_red_sing_regI<span class="main">:</span> <span class="quoted"><span class="quoted">"is_sig_red <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">F</span> <span class="free">p</span> <span class="main">⟹</span> is_sig_red <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="free">top_tail</span> <span class="free">F</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_sig_red_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> sig_red_sing_regI<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-is_sig_red_top_tail_cases"><span class="command">lemma</span></span> is_sig_red_top_tail_cases<span class="main">:</span>
  <span class="quoted"><span class="quoted">"is_sig_red <span class="free">sing_reg</span> <span class="main"><span class="free">(≼)</span></span> <span class="free">F</span> <span class="free">p</span> <span class="main">=</span> <span class="main">(</span>is_sig_red <span class="free">sing_reg</span> <span class="main">(=)</span> <span class="free">F</span> <span class="free">p</span> <span class="main">∨</span> is_sig_red <span class="free">sing_reg</span> <span class="main"><span class="free">(≺)</span></span> <span class="free">F</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_sig_red_def sig_red_top_tail_cases<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> is_sig_red_top_tailI<span class="main">:</span> <span class="quoted"><span class="quoted">"is_sig_red <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">F</span> <span class="free">p</span> <span class="main">⟹</span> is_sig_red <span class="free">sing_reg</span> <span class="main"><span class="free">(≼)</span></span> <span class="free">F</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_sig_red_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> sig_red_top_tailI<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-is_sig_red_singletonI"><span class="command">lemma</span></span> is_sig_red_singletonI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">F</span> <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">f</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="main">{</span><span class="free">f</span><span class="main">}</span> <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"sig_red <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">F</span> <span class="free">r</span> <span class="skolem">r'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_sig_red_def <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"sig_red_single <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">r</span> <span class="skolem">r'</span> <span class="skolem">f</span> <span class="skolem">t</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sig_red_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span> <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_sig_red_def sig_red_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI bexI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="free">F</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-is_sig_red_singletonD"><span class="command">lemma</span></span> is_sig_red_singletonD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="main">{</span><span class="free">f</span><span class="main">}</span> <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">F</span> <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"sig_red <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="main">{</span><span class="free">f</span><span class="main">}</span> <span class="free">r</span> <span class="skolem">r'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_sig_red_def <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"sig_red_single <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">r</span> <span class="skolem">r'</span> <span class="free">f</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sig_red_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_sig_red_def sig_red_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI bexI<span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-is_sig_redD1"><span class="command">lemma</span></span> is_sig_redD1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">F</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ord_term_lin.is_le_rel <span class="free">sing_reg</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"sig_red <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">F</span> <span class="free">p</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_sig_red_def <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"sig_red_single <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">p</span> <span class="skolem">q</span> <span class="skolem">f</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sig_red_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_singleD<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-is_sig_redD2"><span class="command">lemma</span></span> is_sig_redD2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">F</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ordered_powerprod_lin.is_le_rel <span class="free">top_tail</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"sig_red <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">F</span> <span class="free">p</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_sig_red_def <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"sig_red_single <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">p</span> <span class="skolem">q</span> <span class="skolem">f</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sig_red_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_singleD<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-is_sig_red_addsI"><span class="command">lemma</span></span> is_sig_red_addsI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> keys <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">f</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span> <span class="keyword1">adds</span> <span class="free">t</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ord_term_lin.is_le_rel <span class="free">sing_reg</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ordered_powerprod_lin.is_le_rel <span class="free">top_tail</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">sing_reg</span> <span class="main">(</span><span class="free">t</span> <span class="main">⊕</span> lt <span class="free">f</span><span class="main">)</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">top_tail</span> <span class="free">t</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">F</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> is_sig_red_def
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?q</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">-</span> monom_mult <span class="main">(</span><span class="main">(</span>lookup <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="free">t</span><span class="main">)</span> <span class="main">/</span> punit.lc <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">t</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="free">f</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sig_red <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">F</span> <span class="free">p</span> <span class="var">?q</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sig_red_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> bexI exI<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">t</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="free">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> adds_minus<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>4<span class="main">,</span> 5<span class="main">,</span> 7<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">sing_reg</span> <span class="main">(</span><span class="main">(</span><span class="free">t</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">f</span><span class="main">)</span> <span class="main">(</span>lt <span class="free">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> term_is_le_rel_minus<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"sig_red_single <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">p</span> <span class="var">?q</span> <span class="free">f</span> <span class="main">(</span><span class="free">t</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms eq sig_red_singleI<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-is_sig_red_addsE"><span class="command">lemma</span></span> is_sig_red_addsE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">F</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">f</span> <span class="free">t</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> keys <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">f</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span> <span class="keyword1">adds</span> <span class="free">t</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">sing_reg</span> <span class="main">(</span><span class="free">t</span> <span class="main">⊕</span> lt <span class="free">f</span><span class="main">)</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">top_tail</span> <span class="free">t</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"ord_term_lin.is_le_rel <span class="free">sing_reg</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_redD1<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"sig_red <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">F</span> <span class="free">p</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_sig_red_def <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"sig_red_single <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">p</span> <span class="skolem">q</span> <span class="skolem">f</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sig_red_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"rep_list <span class="skolem">f</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">f</span><span class="main">)</span> <span class="main">∈</span> keys <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">sing_reg</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">⊕</span> lt <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span>lt <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">top_tail</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_singleD<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="free">F</span>›</span></span> 2 1
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="skolem">f</span><span class="main">)</span> <span class="keyword1">adds</span> <span class="skolem">s</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> 3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">sing_reg</span> <span class="main">(</span><span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="skolem">f</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">s</span></span><span class="main"><span class="main">]</span></span> splus_assoc term_is_le_rel_canc_left<span class="main"><span class="main">[</span></span><span class="operator">OF</span> *<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> 4 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">top_tail</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-is_sig_red_top_addsI"><span class="command">lemma</span></span> is_sig_red_top_addsI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">f</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span> <span class="keyword1">adds</span> punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ord_term_lin.is_le_rel <span class="free">sing_reg</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">sing_reg</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">f</span><span class="main">)</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="free">sing_reg</span> <span class="main">(=)</span> <span class="free">F</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">note</span></span> assms<span class="main">(</span>1<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">∈</span> keys <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.lt_in_keys<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> assms<span class="main">(</span>2<span class="main">,</span> 4<span class="main">,</span> 5<span class="main">)</span> ordered_powerprod_lin.is_le_relI<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>6<span class="main">)</span> refl
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_red_addsI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-is_sig_red_top_addsE"><span class="command">lemma</span></span> is_sig_red_top_addsE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="free">sing_reg</span> <span class="main">(=)</span> <span class="free">F</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">f</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">f</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span> <span class="keyword1">adds</span> punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">sing_reg</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">f</span><span class="main">)</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> keys <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"rep_list <span class="skolem">f</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="skolem">f</span><span class="main">)</span> <span class="keyword1">adds</span> <span class="skolem">t</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">sing_reg</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">⊕</span> lt <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="skolem">f</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_red_addsE<span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> 1 3
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> 2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> 4 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="skolem">f</span><span class="main">)</span> <span class="keyword1">adds</span> punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> t<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> 5 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">sing_reg</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="skolem">f</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> t<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-is_sig_red_top_plusE"><span class="command">lemma</span></span> is_sig_red_top_plusE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="free">sing_reg</span> <span class="main">(=)</span> <span class="free">F</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="free">sing_reg</span> <span class="main">(=)</span> <span class="free">F</span> <span class="free">q</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lt <span class="free">p</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="free">q</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lt <span class="free">q</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="free">q</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">sing_reg</span> <span class="main">=</span> <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">∨</span> <span class="free">sing_reg</span> <span class="main">=</span> <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"is_sig_red <span class="free">sing_reg</span> <span class="main">(=)</span> <span class="free">F</span> <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="free">q</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">=</span> punit.lt <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span> <span class="main">⟹</span> punit.lc <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">+</span> punit.lc <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="free">thesis</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f1</span> <span class="main">∈</span> <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="skolem">f1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="skolem">f1</span><span class="main">)</span> <span class="keyword1">adds</span> punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">sing_reg</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">f1</span><span class="main">)</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="skolem">f1</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_red_top_addsE<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f2</span> <span class="main">∈</span> <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="skolem">f2</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="skolem">f2</span><span class="main">)</span> <span class="keyword1">adds</span> punit.lt <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">sing_reg</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">f2</span><span class="main">)</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="skolem">f2</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_red_top_addsE<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">=</span> punit.lt <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span> <span class="main">∧</span> punit.lc <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">+</span> punit.lc <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">=</span> punit.lt <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"punit.lc <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">+</span> punit.lc <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 2<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> disj<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">≠</span> punit.lt <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span> <span class="main">∨</span> punit.lc <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">+</span> punit.lc <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ord_term_lin.is_le_rel <span class="free">sing_reg</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ord_term_lin.is_le_rel_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="free">q</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> rep_list_plus
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"rep_list <span class="free">p</span> <span class="main">+</span> rep_list <span class="free">q</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> eq2<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">=</span> punit.lt <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ordered_powerprod_lin.linorder_cases<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main"><span class="free">≺</span></span> punit.lt <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">p</span> <span class="main">+</span> rep_list <span class="free">q</span><span class="main">)</span> <span class="main">=</span> punit.lt <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.lt_plus_eqI<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> * zero_min<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span> <span class="main"><span class="free">≺</span></span> punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">p</span> <span class="main">+</span> rep_list <span class="free">q</span><span class="main">)</span> <span class="main">=</span> punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.lt_plus_eqI_2<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> * zero_min<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">with</span></span> disj <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.lc <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">+</span> punit.lc <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> punit.lc_def eq2 lookup_add<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> eq<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> ordered_powerprod_lin.max <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> rep_list_plus
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> punit.lt_plus_eq_maxI<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">=</span> punit.lt <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> disj <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"punit.lc <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">+</span> punit.lc <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">∨</span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> punit.lt <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ordered_powerprod_lin.max_def<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> 1<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> is_sig_red_top_addsI<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> a <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="skolem">f1</span><span class="main">)</span> <span class="keyword1">adds</span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> eq<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword1"><span class="command">from</span></span> b <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">sing_reg</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">f1</span><span class="main">)</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="skolem">f1</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">p</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> eq<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> punit.lt <span class="main">(</span>rep_list <span class="skolem">f1</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="free">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> splus_mono<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">sing_reg</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">f1</span><span class="main">)</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="skolem">f1</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> punit.lt <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> 1<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> is_sig_red_top_addsI<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> c <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="skolem">f2</span><span class="main">)</span> <span class="keyword1">adds</span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> eq<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword1"><span class="command">from</span></span> d <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">sing_reg</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">f2</span><span class="main">)</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="skolem">f2</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">q</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> eq<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> punit.lt <span class="main">(</span>rep_list <span class="skolem">f2</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="free">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> splus_mono<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">sing_reg</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">f2</span><span class="main">)</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="skolem">f2</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-is_sig_red_singleton_monom_multD"><span class="command">lemma</span></span> is_sig_red_singleton_monom_multD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="main">{</span>monom_mult <span class="free">c</span> <span class="free">t</span> <span class="free">f</span><span class="main">}</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="main">{</span><span class="free">f</span><span class="main">}</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"monom_mult <span class="free">c</span> <span class="free">t</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> keys <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"rep_list <span class="var">?f</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="var">?f</span><span class="main">)</span> <span class="keyword1">adds</span> <span class="skolem">s</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">sing_reg</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">⊕</span> lt <span class="var">?f</span><span class="main">)</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="var">?f</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">top_tail</span> <span class="skolem">s</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> is_sig_red_addsE<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">f</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rep_list_monom_mult punit.monom_mult_eq_zero_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rep_list_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> eq1<span class="main">:</span> <span class="quoted"><span class="quoted">"lt <span class="var">?f</span> <span class="main">=</span> <span class="free">t</span> <span class="main">⊕</span> lt <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lt_monom_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹rep_list <span class="free">f</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> eq2<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="var">?f</span><span class="main">)</span> <span class="main">=</span> <span class="free">t</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rep_list_monom_mult punit.lt_monom_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"ord_term_lin.is_le_rel <span class="free">sing_reg</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_redD1<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_red_addsI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="main">{</span><span class="free">f</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span> <span class="keyword1">adds</span> <span class="free">t</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> adds_triv_right<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> 3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="keyword1">adds</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> eq2<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span> <span class="keyword1">adds</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> 4 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">sing_reg</span> <span class="main">(</span><span class="free">t</span> <span class="main">⊕</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">⊕</span> lt <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">t</span> <span class="main">⊕</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq1 eq2 splus_assoc splus_left_commute<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> * <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">sing_reg</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">⊕</span> lt <span class="free">f</span><span class="main">)</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> term_is_le_rel_canc_left<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ordered_powerprod_lin.is_le_rel <span class="free">top_tail</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_redD2<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-is_sig_red_top_singleton_monom_multI"><span class="command">lemma</span></span> is_sig_red_top_singleton_monom_multI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="free">sing_reg</span> <span class="main">(=)</span> <span class="main">{</span><span class="free">f</span><span class="main">}</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="keyword1">adds</span> punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="free">sing_reg</span> <span class="main">(=)</span> <span class="main">{</span>monom_mult <span class="free">c</span> <span class="free">t</span> <span class="free">f</span><span class="main">}</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"monom_mult <span class="free">c</span> <span class="free">t</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"rep_list <span class="free">f</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span> <span class="keyword1">adds</span> punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">sing_reg</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">f</span><span class="main">)</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> is_sig_red_top_addsE<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rep_list_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> eq1<span class="main">:</span> <span class="quoted"><span class="quoted">"lt <span class="var">?f</span> <span class="main">=</span> <span class="free">t</span> <span class="main">⊕</span> lt <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lt_monom_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹rep_list <span class="free">f</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> eq2<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="var">?f</span><span class="main">)</span> <span class="main">=</span> <span class="free">t</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rep_list_monom_mult punit.lt_monom_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"ord_term_lin.is_le_rel <span class="free">sing_reg</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_redD1<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_red_top_addsI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">∈</span> <span class="main">{</span><span class="var">?f</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹rep_list <span class="free">f</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="var">?f</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rep_list_monom_mult punit.monom_mult_eq_zero_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span> <span class="keyword1">adds</span>
                        <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> adds_canc<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> 3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> adds_minus<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="var">?f</span><span class="main">)</span> <span class="keyword1">adds</span> punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> eq2<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> 4 * <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">sing_reg</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="var">?f</span><span class="main">)</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="var">?f</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq1 eq2 term_is_le_rel_canc_left splus_assoc splus_left_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-is_sig_red_cong'"><span class="command">lemma</span></span> is_sig_red_cong'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">F</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lt <span class="free">p</span> <span class="main">=</span> lt <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">p</span> <span class="main">=</span> rep_list <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">F</span> <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"ord_term_lin.is_le_rel <span class="free">sing_reg</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"ordered_powerprod_lin.is_le_rel <span class="free">top_tail</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_redD1<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> is_sig_redD2<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> keys <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="skolem">f</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="skolem">f</span><span class="main">)</span> <span class="keyword1">adds</span> <span class="skolem">t</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">sing_reg</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">⊕</span> lt <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="skolem">f</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">top_tail</span> <span class="skolem">t</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_red_addsE<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1-4<span class="main">)</span> 1 2 this<span class="main">(</span>5<span class="main">,</span> 6<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> assms<span class="main">(</span>2<span class="main">,</span> 3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_red_addsI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-is_sig_red_cong"><span class="command">lemma</span></span> is_sig_red_cong<span class="main">:</span>
  <span class="quoted"><span class="quoted">"lt <span class="free">p</span> <span class="main">=</span> lt <span class="free">q</span> <span class="main">⟹</span> rep_list <span class="free">p</span> <span class="main">=</span> rep_list <span class="free">q</span> <span class="main">⟹</span>
      is_sig_red <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">F</span> <span class="free">p</span> <span class="main">⟷</span> is_sig_red <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">F</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> is_sig_red_cong'<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-is_sig_red_top_cong"><span class="command">lemma</span></span> is_sig_red_top_cong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="free">sing_reg</span> <span class="main">(=)</span> <span class="free">F</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lt <span class="free">p</span> <span class="main">=</span> lt <span class="free">q</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">=</span> punit.lt <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="free">sing_reg</span> <span class="main">(=)</span> <span class="free">F</span> <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"ord_term_lin.is_le_rel <span class="free">sing_reg</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_redD1<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="skolem">f</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="skolem">f</span><span class="main">)</span> <span class="keyword1">adds</span> punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">sing_reg</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="skolem">f</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_red_top_addsE<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">,</span> 2<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> this<span class="main">(</span>4<span class="main">)</span> 1 this<span class="main">(</span>5<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> assms<span class="main">(</span>3<span class="main">,</span> 4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_red_top_addsI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-sig_irredE_dgrad_max_set"><span class="command">lemma</span></span> sig_irredE_dgrad_max_set<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dickson_grading <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> dgrad_max_set <span class="free">d</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">q</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sig_red <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">F</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">p</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">F</span> <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Q</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">q</span><span class="main">.</span> <span class="main">(</span>sig_red <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">F</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">p</span> <span class="bound">q</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"wfP <span class="main">(</span>sig_red <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">F</span><span class="main">)</span><span class="main">¯¯</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_wf_dgrad_max_set<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> <span class="var">?Q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> <span class="var">?Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>sig_red <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">F</span><span class="main">)</span><span class="main">¯¯</span> <span class="bound">x</span> <span class="skolem">q</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">∉</span> <span class="var">?Q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> wfE_min<span class="main"><span class="main">[</span></span><span class="operator">to_pred</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sig_red <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">F</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">p</span> <span class="skolem">q</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> sig_red <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">F</span> <span class="skolem">q</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="main">(</span>sig_red <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">F</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">p</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">F</span> <span class="skolem">q</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">F</span> <span class="skolem">q</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"sig_red <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">F</span> <span class="skolem">q</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_sig_red_def <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>sig_red <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">F</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">p</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 2<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> 1 3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sig_red <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">F</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">p</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-is_sig_red_mono"><span class="command">lemma</span></span> is_sig_red_mono<span class="main">:</span>
  <span class="quoted"><span class="quoted">"is_sig_red <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">F</span> <span class="free">p</span> <span class="main">⟹</span> <span class="free">F</span> <span class="main">⊆</span> <span class="free">F'</span> <span class="main">⟹</span> is_sig_red <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">F'</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_sig_red_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> sig_red_mono<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-is_sig_red_Un"><span class="command">lemma</span></span> is_sig_red_Un<span class="main">:</span>
  <span class="quoted"><span class="quoted">"is_sig_red <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span> <span class="free">p</span> <span class="main">⟷</span> <span class="main">(</span>is_sig_red <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">A</span> <span class="free">p</span> <span class="main">∨</span> is_sig_red <span class="free">sing_reg</span> <span class="free">top_tail</span> <span class="free">B</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_sig_red_def sig_red_Un<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-is_sig_redD_lt"><span class="command">lemma</span></span> is_sig_redD_lt<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="free">top_tail</span> <span class="main">{</span><span class="free">f</span><span class="main">}</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lt <span class="free">f</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">f</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> keys <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span> <span class="keyword1">adds</span> <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">⊕</span> lt <span class="free">f</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> punit.lt <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> is_sig_red_addsE<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> punit.lt <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> addsE<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">⊕</span> lt <span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">s</span> <span class="main">⊕</span> lt <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> splus_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> 2
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">⊕</span> lt <span class="free">f</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ord_term_canc<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main"><span class="free">≼</span></span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> zero_min<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">⊕</span> lt <span class="free">f</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="skolem">t</span> <span class="main">⊕</span> lt <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> splus_mono_left<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lt <span class="free">f</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="skolem">t</span> <span class="main">⊕</span> lt <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">term_simps</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">⊕</span> lt <span class="free">f</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="free">p</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-is_sig_red_regularD_lt"><span class="command">lemma</span></span> is_sig_red_regularD_lt<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="free">top_tail</span> <span class="main">{</span><span class="free">f</span><span class="main">}</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lt <span class="free">f</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">f</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> keys <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span> <span class="keyword1">adds</span> <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">⊕</span> lt <span class="free">f</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> punit.lt <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> is_sig_red_addsE<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> punit.lt <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> addsE<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">f</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">⊕</span> lt <span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">s</span> <span class="main">⊕</span> lt <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> splus_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> 2
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">⊕</span> lt <span class="free">f</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ord_term_strict_canc<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main"><span class="free">≼</span></span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> zero_min<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">⊕</span> lt <span class="free">f</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="skolem">t</span> <span class="main">⊕</span> lt <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> splus_mono_left<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lt <span class="free">f</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="skolem">t</span> <span class="main">⊕</span> lt <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">term_simps</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">⊕</span> lt <span class="free">f</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="free">p</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ord_term_lin.le_less_trans<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-sig_irred_regular_self"><span class="command">lemma</span></span> sig_irred_regular_self<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="free">top_tail</span> <span class="main">{</span><span class="free">p</span><span class="main">}</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> is_sig_red_regularD_lt<span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Signature Gr\"obner Bases›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">sig_red_zero</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒</span><span class="tfree">'t</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">sig_red_zero</span> <span class="free"><span class="bound"><span class="entity">sing_reg</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span>sig_red <span class="free"><span class="bound"><span class="entity">sing_reg</span></span></span> <span class="main"><span class="free">(≼)</span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="bound">s</span> <span class="main">∧</span> rep_list <span class="bound">s</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_sig_GB_in</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> nat<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span> set <span class="main">⇒</span> <span class="tfree">'t</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_sig_GB_in</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">r</span><span class="main">.</span> lt <span class="bound">r</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">⟶</span> <span class="bound">r</span> <span class="main">∈</span> dgrad_sig_set <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">⟶</span> sig_red_zero <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="bound">r</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_sig_GB_upt</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> nat<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span> set <span class="main">⇒</span> <span class="tfree">'t</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_sig_GB_upt</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">⟷</span>
            <span class="main">(</span><span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">⊆</span> dgrad_sig_set <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">(</span>pp_of_term <span class="bound">v</span><span class="main">)</span> <span class="main">≤</span> dgrad_max <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">⟶</span>
                                          component_of_term <span class="bound">v</span> <span class="main">&lt;</span> length <span class="free">fs</span> <span class="main">⟶</span> is_sig_GB_in <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_min_sig_GB</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> nat<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span> set <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_min_sig_GB</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">⟷</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">⊆</span> dgrad_sig_set <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">∧</span>
                                <span class="main">(</span><span class="main">∀</span><span class="bound">u</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">(</span>pp_of_term <span class="bound">u</span><span class="main">)</span> <span class="main">≤</span> dgrad_max <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">⟶</span> component_of_term <span class="bound">u</span> <span class="main">&lt;</span> length <span class="free">fs</span> <span class="main">⟶</span>
                                      is_sig_GB_in <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="bound">u</span><span class="main">)</span> <span class="main">∧</span>
                                <span class="main">(</span><span class="main">∀</span><span class="bound">g</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">.</span> <span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">-</span> <span class="main">{</span><span class="bound">g</span><span class="main">}</span><span class="main">)</span> <span class="bound">g</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_syz_sig</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> nat<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'t</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_syz_sig</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">s</span><span class="main">∈</span>dgrad_sig_set <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">.</span> <span class="bound">s</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> lt <span class="bound">s</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">∧</span> rep_list <span class="bound">s</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Signature_Groebner-sig_red_zeroI"><span class="command">lemma</span></span> sig_red_zeroI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sig_red <span class="free">sing_reg</span> <span class="main"><span class="free">(≼)</span></span> <span class="free">F</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">r</span> <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">s</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sig_red_zero <span class="free">sing_reg</span> <span class="free">F</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sig_red_zero_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Signature_Groebner-sig_red_zeroE"><span class="command">lemma</span></span> sig_red_zeroE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sig_red_zero <span class="free">sing_reg</span> <span class="free">F</span> <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">s</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sig_red <span class="free">sing_reg</span> <span class="main"><span class="free">(≼)</span></span> <span class="free">F</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">r</span> <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">s</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> sig_red_zero_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Signature_Groebner-sig_red_zero_monom_mult"><span class="command">lemma</span></span> sig_red_zero_monom_mult<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sig_red_zero <span class="free">sing_reg</span> <span class="free">F</span> <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sig_red_zero <span class="free">sing_reg</span> <span class="free">F</span> <span class="main">(</span>monom_mult <span class="free">c</span> <span class="free">t</span> <span class="free">r</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sig_red <span class="free">sing_reg</span> <span class="main"><span class="free">(≼)</span></span> <span class="free">F</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">r</span> <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="skolem">s</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_zeroE<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sig_red <span class="free">sing_reg</span> <span class="main"><span class="free">(≼)</span></span> <span class="free">F</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>monom_mult <span class="free">c</span> <span class="free">t</span> <span class="free">r</span><span class="main">)</span> <span class="main">(</span>monom_mult <span class="free">c</span> <span class="free">t</span> <span class="skolem">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_rtrancl_monom_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="main">(</span>monom_mult <span class="free">c</span> <span class="free">t</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rep_list_monom_mult <span class="quoted"><span class="quoted">‹rep_list <span class="skolem">s</span> <span class="main">=</span> <span class="main">0</span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_zeroI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-sig_red_zero_sing_regI"><span class="command">lemma</span></span> sig_red_zero_sing_regI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sig_red_zero <span class="free">sing_reg</span> <span class="free">G</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sig_red_zero <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="free">G</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sig_red <span class="free">sing_reg</span> <span class="main"><span class="free">(≼)</span></span> <span class="free">G</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">p</span> <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="skolem">s</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_zeroE<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sig_red <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="free">G</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">p</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_rtrancl_sing_regI<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹rep_list <span class="skolem">s</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_zeroI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-sig_red_zero_nonzero"><span class="command">lemma</span></span> sig_red_zero_nonzero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sig_red_zero <span class="free">sing_reg</span> <span class="free">F</span> <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">r</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">sing_reg</span> <span class="main">=</span> <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">∨</span> <span class="free">sing_reg</span> <span class="main">=</span> <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="free">sing_reg</span> <span class="main">(=)</span> <span class="free">F</span> <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sig_red <span class="free">sing_reg</span> <span class="main"><span class="free">(≼)</span></span> <span class="free">F</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">r</span> <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="skolem">s</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_zeroE<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> converse_rtranclp_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> base
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹rep_list <span class="skolem">s</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">y</span> <span class="skolem">z</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> step<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"sig_red_single <span class="free">sing_reg</span> <span class="main"><span class="free">(≼)</span></span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="skolem">f</span> <span class="skolem">t</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> sig_red_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"rep_list <span class="skolem">f</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">f</span><span class="main">)</span> <span class="main">∈</span> keys <span class="main">(</span>rep_list <span class="skolem">y</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">-</span> monom_mult <span class="main">(</span>lookup <span class="main">(</span>rep_list <span class="skolem">y</span><span class="main">)</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> punit.lc <span class="main">(</span>rep_list <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="skolem">t</span> <span class="skolem">f</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"ord_term_lin.is_le_rel <span class="free">sing_reg</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">sing_reg</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">⊕</span> lt <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span>lt <span class="skolem">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_singleD<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">f</span><span class="main">)</span> <span class="main">=</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">y</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_sig_red_def
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sig_red <span class="free">sing_reg</span> <span class="main">(=)</span> <span class="free">F</span> <span class="skolem">y</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sig_red_def
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> bexI exI<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> 1 2 3 4 ordered_powerprod_lin.is_le_relI<span class="main">(</span>1<span class="main">)</span> 5 True
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sig_red_single <span class="free">sing_reg</span> <span class="main">(=)</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="skolem">f</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_singleI<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">from</span></span> 2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">f</span><span class="main">)</span> <span class="main"><span class="free">≼</span></span> punit.lt <span class="main">(</span>rep_list <span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.lt_max_keys<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> False <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">f</span><span class="main">)</span> <span class="main"><span class="free">≺</span></span> punit.lt <span class="main">(</span>rep_list <span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> 1 2 3 4 ordered_powerprod_lin.is_le_relI<span class="main">(</span>3<span class="main">)</span> 5 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sig_red_single <span class="free">sing_reg</span> <span class="main"><span class="free">(≺)</span></span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="skolem">f</span> <span class="skolem">t</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_singleI<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> keys <span class="main">(</span>rep_list <span class="skolem">z</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> lt_z<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">y</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_single_tail_lt_in_keys_rep_list<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> sig_red_single_tail_lt_rep_list<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="skolem">z</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="free">sing_reg</span> <span class="main">(=)</span> <span class="free">F</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> step<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="skolem">g</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="skolem">g</span><span class="main">)</span> <span class="keyword1">adds</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">z</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">sing_reg</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="skolem">z</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">g</span><span class="main">)</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="skolem">g</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">z</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_red_top_addsE<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="skolem">g</span><span class="main">)</span> <span class="keyword1">adds</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> lt_z<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="main">∈</span> <span class="free">F</span>›</span></span> <span class="quoted"><span class="quoted">‹rep_list <span class="skolem">g</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> step<span class="main">(</span>4<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_red_top_addsI<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹is_sig_red <span class="free">sing_reg</span> <span class="main">(=)</span> <span class="free">F</span> <span class="skolem">z</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ord_term_lin.is_le_rel <span class="free">sing_reg</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_redD1<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹sig_red_single <span class="free">sing_reg</span> <span class="main"><span class="free">(≺)</span></span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="skolem">f</span> <span class="skolem">t</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">z</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_single_lt<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">sing_reg</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="skolem">y</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">g</span><span class="main">)</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="skolem">g</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">y</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">sing_reg</span> <span class="main">=</span> <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span>"</span></span>
          <span class="keyword1"><span class="command">from</span></span> a <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="skolem">y</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">g</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> punit.lt <span class="main">(</span>rep_list <span class="skolem">g</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">z</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> lt_z <span class="quoted"><span class="quoted">‹<span class="free">sing_reg</span> <span class="main">=</span> <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span>›</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹lt <span class="skolem">z</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="skolem">y</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> punit.lt <span class="main">(</span>rep_list <span class="skolem">g</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> splus_mono<span class="main">)</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">sing_reg</span> <span class="main">=</span> <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span>›</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">sing_reg</span> <span class="main">=</span> <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span>"</span></span>
          <span class="keyword1"><span class="command">from</span></span> a <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="skolem">y</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">g</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> punit.lt <span class="main">(</span>rep_list <span class="skolem">g</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">z</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> lt_z <span class="quoted"><span class="quoted">‹<span class="free">sing_reg</span> <span class="main">=</span> <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span>›</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹lt <span class="skolem">z</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="skolem">y</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> punit.lt <span class="main">(</span>rep_list <span class="skolem">g</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> splus_mono<span class="main">)</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">sing_reg</span> <span class="main">=</span> <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span>›</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-sig_red_zero_mono"><span class="command">lemma</span></span> sig_red_zero_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"sig_red_zero <span class="free">sing_reg</span> <span class="free">F</span> <span class="free">p</span> <span class="main">⟹</span> <span class="free">F</span> <span class="main">⊆</span> <span class="free">F'</span> <span class="main">⟹</span> sig_red_zero <span class="free">sing_reg</span> <span class="free">F'</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sig_red_zero_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> sig_red_rtrancl_mono<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-sig_red_zero_subset"><span class="command">lemma</span></span> sig_red_zero_subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sig_red_zero <span class="free">sing_reg</span> <span class="free">F</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">sing_reg</span> <span class="main">=</span> <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">∨</span> <span class="free">sing_reg</span> <span class="main">=</span> <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sig_red_zero <span class="free">sing_reg</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span><span class="main">∈</span><span class="free">F</span><span class="main">.</span> <span class="free">sing_reg</span> <span class="main">(</span>lt <span class="bound">f</span><span class="main">)</span> <span class="main">(</span>lt <span class="free">p</span><span class="main">)</span><span class="main">}</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sig_red <span class="free">sing_reg</span> <span class="main"><span class="free">(≼)</span></span> <span class="free">F</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">p</span> <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="skolem">s</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_zeroE<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sig_red <span class="free">sing_reg</span> <span class="main"><span class="free">(≼)</span></span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span><span class="main">∈</span><span class="free">F</span><span class="main">.</span> <span class="free">sing_reg</span> <span class="main">(</span>lt <span class="bound">f</span><span class="main">)</span> <span class="main">(</span>lt <span class="free">p</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">p</span> <span class="skolem">s</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_rtrancl_subset<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹rep_list <span class="skolem">s</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_zeroI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-sig_red_zero_idealI"><span class="command">lemma</span></span> sig_red_zero_idealI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sig_red_zero <span class="free">sing_reg</span> <span class="free">F</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">p</span> <span class="main">∈</span> ideal <span class="main">(</span>rep_list <span class="main">`</span> <span class="free">F</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sig_red <span class="free">sing_reg</span> <span class="main"><span class="free">(≼)</span></span> <span class="free">F</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">p</span> <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="skolem">s</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_zeroE<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>punit.red <span class="main">(</span>rep_list <span class="main">`</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">(</span>rep_list <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_red_rtrancl<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>punit.red <span class="main">(</span>rep_list <span class="main">`</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹rep_list <span class="skolem">s</span> <span class="main">=</span> <span class="main">0</span>›</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.red_rtranclp_0_in_pmdl<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-is_sig_GB_inI"><span class="command">lemma</span></span> is_sig_GB_inI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">r</span><span class="main">.</span> lt <span class="bound">r</span> <span class="main">=</span> <span class="free">u</span> <span class="main">⟹</span> <span class="bound">r</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span> <span class="main">⟹</span> sig_red_zero <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="free">G</span> <span class="bound">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_sig_GB_in <span class="free">d</span> <span class="free">G</span> <span class="free">u</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> is_sig_GB_in_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Signature_Groebner-is_sig_GB_inD"><span class="command">lemma</span></span> is_sig_GB_inD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_sig_GB_in <span class="free">d</span> <span class="free">G</span> <span class="free">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lt <span class="free">r</span> <span class="main">=</span> <span class="free">u</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sig_red_zero <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="free">G</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> is_sig_GB_in_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Signature_Groebner-is_sig_GB_inI_triv"><span class="command">lemma</span></span> is_sig_GB_inI_triv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">d</span> <span class="main">(</span>pp_of_term <span class="free">u</span><span class="main">)</span> <span class="main">≤</span> dgrad_max <span class="free">d</span> <span class="main">∨</span> <span class="main">¬</span> component_of_term <span class="free">u</span> <span class="main">&lt;</span> length <span class="free">fs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_sig_GB_in <span class="free">d</span> <span class="free">G</span> <span class="free">u</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_GB_inI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">r</span> <span class="main">=</span> <span class="free">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sig_red_zero <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="free">G</span> <span class="skolem">r</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="skolem">r</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> rep_list_zero<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> rtrancl_refl<span class="main">[</span><span class="operator">to_pred</span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_zeroI<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">(</span>lp <span class="skolem">r</span><span class="main">)</span> <span class="main">≤</span> dgrad_max <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dgrad_sig_setD_lp<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>›</span></span> False <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"component_of_term <span class="main">(</span>lt <span class="skolem">r</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="free">fs</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dgrad_sig_setD_lt<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹lt <span class="skolem">r</span> <span class="main">=</span> <span class="free">u</span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-is_sig_GB_in_mono"><span class="command">lemma</span></span> is_sig_GB_in_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"is_sig_GB_in <span class="free">d</span> <span class="free">G</span> <span class="free">u</span> <span class="main">⟹</span> <span class="free">G</span> <span class="main">⊆</span> <span class="free">G'</span> <span class="main">⟹</span> is_sig_GB_in <span class="free">d</span> <span class="free">G'</span> <span class="free">u</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_sig_GB_in_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> sig_red_zero_mono<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-is_sig_GB_uptI"><span class="command">lemma</span></span> is_sig_GB_uptI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">⊆</span> dgrad_sig_set <span class="free">d</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free">u</span> <span class="main">⟹</span> <span class="free">d</span> <span class="main">(</span>pp_of_term <span class="bound">v</span><span class="main">)</span> <span class="main">≤</span> dgrad_max <span class="free">d</span> <span class="main">⟹</span> component_of_term <span class="bound">v</span> <span class="main">&lt;</span> length <span class="free">fs</span> <span class="main">⟹</span>
          is_sig_GB_in <span class="free">d</span> <span class="free">G</span> <span class="bound">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_sig_GB_upt <span class="free">d</span> <span class="free">G</span> <span class="free">u</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> is_sig_GB_upt_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Signature_Groebner-is_sig_GB_uptD1"><span class="command">lemma</span></span> is_sig_GB_uptD1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_sig_GB_upt <span class="free">d</span> <span class="free">G</span> <span class="free">u</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">⊆</span> dgrad_sig_set <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> is_sig_GB_upt_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Signature_Groebner-is_sig_GB_uptD2"><span class="command">lemma</span></span> is_sig_GB_uptD2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_sig_GB_upt <span class="free">d</span> <span class="free">G</span> <span class="free">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free">u</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_sig_GB_in <span class="free">d</span> <span class="free">G</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms is_sig_GB_inI_triv <span class="keyword1"><span class="command">unfolding</span></span> is_sig_GB_upt_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Signature_Groebner-is_sig_GB_uptD3"><span class="command">lemma</span></span> is_sig_GB_uptD3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_sig_GB_upt <span class="free">d</span> <span class="free">G</span> <span class="free">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lt <span class="free">r</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free">u</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sig_red_zero <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="free">G</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_GB_inD<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> is_sig_GB_uptD2<span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span> refl<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-is_sig_GB_upt_le"><span class="command">lemma</span></span> is_sig_GB_upt_le<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_sig_GB_upt <span class="free">d</span> <span class="free">G</span> <span class="free">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free">u</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_sig_GB_upt <span class="free">d</span> <span class="free">G</span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_GB_uptI<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">⊆</span> dgrad_sig_set <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_GB_uptD1<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">w</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free">u</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ord_term_lin.less_le_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_sig_GB_in <span class="free">d</span> <span class="free">G</span> <span class="skolem">w</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_GB_uptD2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-is_sig_GB_upt_mono"><span class="command">lemma</span></span> is_sig_GB_upt_mono<span class="main">:</span>
  <span class="quoted"><span class="quoted">"is_sig_GB_upt <span class="free">d</span> <span class="free">G</span> <span class="free">u</span> <span class="main">⟹</span> <span class="free">G</span> <span class="main">⊆</span> <span class="free">G'</span> <span class="main">⟹</span> <span class="free">G'</span> <span class="main">⊆</span> dgrad_sig_set <span class="free">d</span> <span class="main">⟹</span> is_sig_GB_upt <span class="free">d</span> <span class="free">G'</span> <span class="free">u</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_sig_GB_upt_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> is_sig_GB_in_mono<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-is_sig_GB_upt_is_Groebner_basis"><span class="command">lemma</span></span> is_sig_GB_upt_is_Groebner_basis<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dickson_grading <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"hom_grading <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">⊆</span> dgrad_sig_set' <span class="free">j</span> <span class="free">d</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">u</span><span class="main">.</span> component_of_term <span class="bound">u</span> <span class="main">&lt;</span> <span class="free">j</span> <span class="main">⟹</span> is_sig_GB_in <span class="free">d</span> <span class="free">G</span> <span class="bound">u</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"punit.is_Groebner_basis <span class="main">(</span>rep_list <span class="main">`</span> <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> punit.weak_GB_is_strong_GB_dgrad_p_set<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">⊆</span> dgrad_max_set <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dgrad_sig_set'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="main">`</span> <span class="free">G</span> <span class="main">⊆</span> punit_dgrad_max_set <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dgrad_max_3<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> punit_dgrad_max_set <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> G_sub<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">⊆</span> sig_inv_set' <span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dgrad_sig_set'_def<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> ideal <span class="main">(</span>rep_list <span class="main">`</span> <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> rep_list_subset_ideal_sig_inv_set<span class="main">[</span><span class="operator">OF</span> G_sub<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⊆</span> ideal <span class="main">(</span>set <span class="main">(</span>take <span class="free">j</span> <span class="free">fs</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal.span_subset_spanI<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> ideal <span class="main">(</span>set <span class="main">(</span>take <span class="free">j</span> <span class="free">fs</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> punit_dgrad_max_set <span class="free">d</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> dgrad_sig_set' <span class="free">j</span> <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> rep_list <span class="skolem">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> in_idealE_rep_list_dgrad_sig_set_take<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> sig_inv_set' <span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dgrad_sig_set'_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>punit.red <span class="main">(</span>rep_list <span class="main">`</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="skolem">f</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f rep_list_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">r</span> <span class="main">∈</span> keys <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lt_in_keys<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span> <span class="main">∈</span> sig_inv_set' <span class="free">j</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"component_of_term <span class="main">(</span>lt <span class="skolem">r</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_inv_setD'<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_sig_GB_in <span class="free">d</span> <span class="free">G</span> <span class="main">(</span>lt <span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sig_red_zero <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="free">G</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>›</span></span> refl <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_GB_inD<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sig_red <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="free">G</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="skolem">r</span> <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"rep_list <span class="skolem">s</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_zeroE<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>punit.red <span class="main">(</span>rep_list <span class="main">`</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>rep_list <span class="skolem">r</span><span class="main">)</span> <span class="main">(</span>rep_list <span class="skolem">s</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_red_rtrancl<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> f s<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-is_sig_GB_is_Groebner_basis"><span class="command">lemma</span></span> is_sig_GB_is_Groebner_basis<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dickson_grading <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"hom_grading <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">⊆</span> dgrad_max_set <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">u</span><span class="main">.</span> is_sig_GB_in <span class="free">d</span> <span class="free">G</span> <span class="bound">u</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"punit.is_Groebner_basis <span class="main">(</span>rep_list <span class="main">`</span> <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> punit.weak_GB_is_strong_GB_dgrad_p_set<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">,</span> 3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="main">`</span> <span class="free">G</span> <span class="main">⊆</span> punit_dgrad_max_set <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dgrad_max_3<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> punit_dgrad_max_set <span class="free">d</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> ideal <span class="main">(</span>rep_list <span class="main">`</span> <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> rep_list_subset_ideal <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⊆</span> ideal <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal.span_subset_spanI<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> ideal <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> punit_dgrad_max_set <span class="free">d</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> rep_list <span class="skolem">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> in_idealE_rep_list_dgrad_sig_set<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>4<span class="main">)</span> this<span class="main">(</span>1<span class="main">)</span> refl <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sig_red_zero <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="free">G</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_GB_inD<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sig_red <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="free">G</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="skolem">r</span> <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"rep_list <span class="skolem">s</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_zeroE<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>punit.red <span class="main">(</span>rep_list <span class="main">`</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>rep_list <span class="skolem">r</span><span class="main">)</span> <span class="main">(</span>rep_list <span class="skolem">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_red_rtrancl<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>punit.red <span class="main">(</span>rep_list <span class="main">`</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="skolem">f</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> f s<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-sig_red_zero_is_red"><span class="command">lemma</span></span> sig_red_zero_is_red<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sig_red_zero <span class="free">sing_reg</span> <span class="free">F</span> <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">r</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="free">sing_reg</span> <span class="main"><span class="free">(≼)</span></span> <span class="free">F</span> <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sig_red <span class="free">sing_reg</span> <span class="main"><span class="free">(≼)</span></span> <span class="free">F</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">r</span> <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="skolem">s</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_zeroE<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≠</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> * <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> converse_rtranclp_induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_sig_red_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-is_sig_red_sing_top_is_red_zero"><span class="command">lemma</span></span> is_sig_red_sing_top_is_red_zero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dickson_grading <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_sig_GB_upt <span class="free">d</span> <span class="free">G</span> <span class="free">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lt <span class="free">a</span> <span class="main">=</span> <span class="free">u</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="main">(=)</span> <span class="main">(=)</span> <span class="free">G</span> <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="free">G</span> <span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sig_red_zero <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="free">G</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>5<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="skolem">g</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="skolem">g</span><span class="main">)</span> <span class="keyword1">adds</span> punit.lt <span class="main">(</span>rep_list <span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">a</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">g</span> <span class="main">=</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">g</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_red_top_addsE<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">,</span> 3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rep_list_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lc <span class="skolem">g</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lc <span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> lc_not_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">a</span><span class="main">)</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">g</span><span class="main">)</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">g</span> <span class="main">=</span> lt <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> term_is_le_rel_minus 2<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g'</span> <span class="main">=</span> monom_mult <span class="main">(</span>lc <span class="free">a</span> <span class="main">/</span> lc <span class="skolem">g</span><span class="main">)</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">a</span><span class="main">)</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">g</span><span class="main">)</span><span class="main">)</span> <span class="skolem">g</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹lc <span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹lc <span class="skolem">g</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> lt_g'<span class="main">:</span> <span class="quoted"><span class="quoted">"lt <span class="skolem">g'</span> <span class="main">=</span> lt <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> g'_def lt_monom_mult 3<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹lc <span class="skolem">g</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> lc_g'<span class="main">:</span> <span class="quoted"><span class="quoted">"lc <span class="skolem">g'</span> <span class="main">=</span> lc <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> g'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g'</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> g'_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> dgrad_sig_set_closed_monom_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">a</span><span class="main">)</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">g</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">d</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dickson_grading_minus<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">,</span> 3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> dgrad_max <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dgrad_sig_setD_rep_list_lt<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">a</span><span class="main">)</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">g</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> dgrad_max <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">⊆</span> dgrad_sig_set <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_GB_uptD1<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="main">∈</span> <span class="free">G</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> b_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">-</span> <span class="skolem">g'</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?b</span> <span class="main">∈</span> <span class="main">_</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dgrad_sig_set_closed_minus<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">a</span><span class="main">)</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">g</span><span class="main">)</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">g</span><span class="main">)</span> <span class="main">=</span>
                  punit.lt <span class="main">(</span>rep_list <span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> adds_minus<span class="main">)</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"lc <span class="free">a</span> <span class="main">/</span> lc <span class="skolem">g</span> <span class="main">=</span> punit.lc <span class="main">(</span>rep_list <span class="free">a</span><span class="main">)</span> <span class="main">/</span> punit.lc <span class="main">(</span>rep_list <span class="skolem">g</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sig_red_single <span class="main">(=)</span> <span class="main">(=)</span> <span class="free">a</span> <span class="var">?b</span> <span class="skolem">g</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">a</span><span class="main">)</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_singleI<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">a</span><span class="main">)</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">g</span><span class="main">)</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">g</span><span class="main">)</span> <span class="main">∈</span> keys <span class="main">(</span>rep_list <span class="free">a</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> 4 <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹rep_list <span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.lt_in_keys<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?b</span> <span class="main">=</span>
            <span class="free">a</span> <span class="main">-</span> monom_mult
             <span class="main">(</span>lookup <span class="main">(</span>rep_list <span class="free">a</span><span class="main">)</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">a</span><span class="main">)</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">g</span><span class="main">)</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">g</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span>
              punit.lc <span class="main">(</span>rep_list <span class="skolem">g</span><span class="main">)</span><span class="main">)</span>
             <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">a</span><span class="main">)</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">g</span><span class="main">)</span><span class="main">)</span> <span class="skolem">g</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> g'_def 4 punit.lc_def True<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> 3 4 <span class="quoted"><span class="quoted">‹rep_list <span class="skolem">g</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sig_red <span class="main">(=)</span> <span class="main">(=)</span> <span class="free">G</span> <span class="free">a</span> <span class="var">?b</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sig_red_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="main">∈</span> <span class="free">G</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sig_red <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="free">G</span> <span class="free">a</span> <span class="var">?b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> sig_red_sing_regI sig_red_top_tailI<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sig_red <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="free">G</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">a</span> <span class="var">?b</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="var">?b</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="var">?b</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> rep_list_zero<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> 5 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_zeroI<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lt <span class="var">?b</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> lt_g' lc_g' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lt_minus_lessI<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lt <span class="var">?b</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> b_in <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sig_red_zero <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="free">G</span> <span class="var">?b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_GB_uptD3<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sig_red <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="free">G</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="var">?b</span> <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="skolem">s</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_zeroE<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> 5 this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sig_red <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="free">G</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">a</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rtranclp_trans<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹rep_list <span class="skolem">s</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_zeroI<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹rep_list <span class="skolem">g</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹lc <span class="skolem">g</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹lc <span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="skolem">g'</span><span class="main">)</span> <span class="main">=</span> punit.lt <span class="main">(</span>rep_list <span class="free">a</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> g'_def rep_list_monom_mult punit.lt_monom_mult 4<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> 6<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.lc <span class="main">(</span>rep_list <span class="skolem">g'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>lc <span class="free">a</span> <span class="main">/</span> lc <span class="skolem">g</span><span class="main">)</span> <span class="main">*</span> punit.lc <span class="main">(</span>rep_list <span class="skolem">g</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> g'_def rep_list_monom_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> 7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≠</span> punit.lc <span class="main">(</span>rep_list <span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"lc <span class="free">a</span> <span class="main">/</span> lc <span class="skolem">g</span> <span class="main">*</span> punit.lc <span class="main">(</span>rep_list <span class="skolem">g</span><span class="main">)</span> <span class="main">=</span> punit.lc <span class="main">(</span>rep_list <span class="free">a</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹rep_list <span class="skolem">g</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.lc <span class="main">(</span>rep_list <span class="skolem">g</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.lc_not_0<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lc <span class="free">a</span> <span class="main">/</span> lc <span class="skolem">g</span> <span class="main">=</span> punit.lc <span class="main">(</span>rep_list <span class="free">a</span><span class="main">)</span> <span class="main">/</span> punit.lc <span class="main">(</span>rep_list <span class="skolem">g</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> False <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.lc <span class="main">(</span>rep_list <span class="skolem">g'</span><span class="main">)</span> <span class="main">≠</span> punit.lc <span class="main">(</span>rep_list <span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">with</span></span> 5 <span class="keyword1"><span class="command">have</span></span> 8<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="var">?b</span><span class="main">)</span> <span class="main">=</span> punit.lt <span class="main">(</span>rep_list <span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> rep_list_minus
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.lt_minus_eqI_3<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"punit.lc <span class="main">(</span>rep_list <span class="var">?b</span><span class="main">)</span> <span class="main">=</span> punit.lc <span class="main">(</span>rep_list <span class="free">a</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>lc <span class="free">a</span> <span class="main">/</span> lc <span class="skolem">g</span><span class="main">)</span> <span class="main">*</span> punit.lc <span class="main">(</span>rep_list <span class="skolem">g</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> 6<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> punit.lc_def lookup_minus rep_list_minus 5<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"punit.lc <span class="main">(</span>rep_list <span class="free">a</span><span class="main">)</span> <span class="main">-</span> lc <span class="free">a</span> <span class="main">/</span> lc <span class="skolem">g</span> <span class="main">*</span> punit.lc <span class="main">(</span>rep_list <span class="skolem">g</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lc <span class="free">a</span> <span class="main">/</span> lc <span class="skolem">g</span> <span class="main">*</span> punit.lc <span class="main">(</span>rep_list <span class="skolem">g</span><span class="main">)</span> <span class="main">=</span> punit.lc <span class="main">(</span>rep_list <span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> 7 <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="var">?b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> punit.lc_eq_zero_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rep_list_zero<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lt <span class="var">?b</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> lt_g' lc_g' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lt_minus_lessI<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lt <span class="var">?b</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> b_in <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sig_red_zero <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="free">G</span> <span class="var">?b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_GB_uptD3<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹rep_list <span class="var">?b</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">=</span> <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">∨</span> <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">=</span> <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="free">G</span> <span class="var">?b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_zero_nonzero<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g0</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g0</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="skolem">g0</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 9<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="skolem">g0</span><span class="main">)</span> <span class="keyword1">adds</span> punit.lt <span class="main">(</span>rep_list <span class="var">?b</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 10<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="var">?b</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">g0</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> punit.lt <span class="main">(</span>rep_list <span class="skolem">g0</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="var">?b</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_red_top_addsE<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> 9 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="skolem">g0</span><span class="main">)</span> <span class="keyword1">adds</span> punit.lt <span class="main">(</span>rep_list <span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> 8<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> 10 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">a</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">g0</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> punit.lt <span class="main">(</span>rep_list <span class="skolem">g0</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="var">?b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> 8<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹lt <span class="var">?b</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="free">a</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> punit.lt <span class="main">(</span>rep_list <span class="skolem">g0</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> splus_mono_strict<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">a</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">g0</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> punit.lt <span class="main">(</span>rep_list <span class="skolem">g0</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="free">G</span> <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_red_top_addsI<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ord_term_lin.is_le_rel <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>6<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-sig_regular_reduced_unique"><span class="command">lemma</span></span> sig_regular_reduced_unique<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_sig_GB_upt <span class="free">d</span> <span class="free">G</span> <span class="main">(</span>lt <span class="free">q</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lt <span class="free">p</span> <span class="main">=</span> lt <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lc <span class="free">p</span> <span class="main">=</span> lc <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="free">G</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="free">G</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">p</span> <span class="main">=</span> rep_list <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">p</span> <span class="main">≠</span> rep_list <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="free">q</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rep_list_minus<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">-</span> <span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rep_list_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span> <span class="free">q</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span><span class="main">-</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> lt <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lc <span class="main">(</span><span class="main">-</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> lc <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lt_plus_lessI<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="free">q</span><span class="main">)</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_sig_GB_in <span class="free">d</span> <span class="free">G</span> <span class="main">(</span>lt <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_GB_uptD2<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">,</span> 3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">-</span> <span class="free">q</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dgrad_sig_set_closed_minus<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sig_red_zero <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="free">G</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="free">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> refl <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_GB_inD<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="free">G</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="free">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹rep_list <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="free">q</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_zero_is_red<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> keys <span class="main">(</span>rep_list <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="skolem">g</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> adds<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="skolem">g</span><span class="main">)</span> <span class="keyword1">adds</span> <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">⊕</span> lt <span class="skolem">g</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> punit.lt <span class="main">(</span>rep_list <span class="skolem">g</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="free">q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_red_addsE<span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> this<span class="main">(</span>5<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹lt <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="free">q</span><span class="main">)</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="free">q</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="skolem">g</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="free">q</span><span class="main">)</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> punit.lt <span class="main">(</span>rep_list <span class="skolem">g</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> splus_mono_strict<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">⊕</span> lt <span class="skolem">g</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> punit.lt <span class="main">(</span>rep_list <span class="skolem">g</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">hence</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">⊕</span> lt <span class="skolem">g</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> punit.lt <span class="main">(</span>rep_list <span class="skolem">g</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> t keys_minus <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> keys <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">∪</span> keys <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> rep_list_minus <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> t_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> keys <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main"><span class="free">≼</span></span> punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.lt_max_keys<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="main">∈</span> <span class="free">G</span>›</span></span> t_in <span class="quoted"><span class="quoted">‹rep_list <span class="skolem">g</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> adds ord_term_lin.is_le_relI<span class="main">(</span>3<span class="main">)</span> ordered_powerprod_lin.is_le_relI<span class="main">(</span>2<span class="main">)</span> 2
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="free">G</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_red_addsI<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>6<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> t_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> keys <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main"><span class="free">≼</span></span> punit.lt <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.lt_max_keys<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="main">∈</span> <span class="free">G</span>›</span></span> t_in <span class="quoted"><span class="quoted">‹rep_list <span class="skolem">g</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> adds ord_term_lin.is_le_relI<span class="main">(</span>3<span class="main">)</span> ordered_powerprod_lin.is_le_relI<span class="main">(</span>2<span class="main">)</span> 1
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="free">G</span> <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_red_addsI<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>7<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> sig_regular_reduced_unique'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_sig_GB_upt <span class="free">d</span> <span class="free">G</span> <span class="main">(</span>lt <span class="free">q</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lt <span class="free">p</span> <span class="main">=</span> lt <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="free">G</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="free">G</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"punit.monom_mult <span class="main">(</span>lc <span class="free">q</span><span class="main">)</span> <span class="main">0</span> <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">=</span> punit.monom_mult <span class="main">(</span>lc <span class="free">p</span><span class="main">)</span> <span class="main">0</span> <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">q</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rep_list_zero<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lc <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lc <span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lc_not_0<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"monom_mult <span class="main">(</span>lc <span class="free">q</span><span class="main">)</span> <span class="main">0</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?q</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"monom_mult <span class="main">(</span>lc <span class="free">p</span><span class="main">)</span> <span class="main">0</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="var">?q</span> <span class="main">=</span> lt <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lt_monom_mult<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹lc <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main"><span class="main">]</span></span> splus_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_sig_GB_upt <span class="free">d</span> <span class="free">G</span> <span class="main">(</span>lt <span class="var">?q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dgrad_sig_set_closed_monom_mult_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?q</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dgrad_sig_set_closed_monom_mult_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹lt <span class="var">?q</span> <span class="main">=</span> lt <span class="free">q</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="var">?p</span> <span class="main">=</span> lt <span class="var">?q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lt_monom_mult<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹lc <span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main"><span class="main">]</span></span> splus_zero assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lc <span class="var">?p</span> <span class="main">=</span> lc <span class="var">?q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="free">G</span> <span class="var">?p</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="free">G</span> <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹lc <span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">/</span> <span class="main">(</span>lc <span class="free">q</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="free">G</span> <span class="main">(</span>monom_mult <span class="main">(</span><span class="main">1</span> <span class="main">/</span> lc <span class="free">q</span><span class="main">)</span> <span class="main">0</span> <span class="var">?p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_red_monom_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="free">G</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> monom_mult_assoc <span class="quoted"><span class="quoted">‹lc <span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>5<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="free">G</span> <span class="var">?q</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="free">G</span> <span class="var">?q</span>"</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹lc <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">/</span> <span class="main">(</span>lc <span class="free">p</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="free">G</span> <span class="main">(</span>monom_mult <span class="main">(</span><span class="main">1</span> <span class="main">/</span> lc <span class="free">p</span><span class="main">)</span> <span class="main">0</span> <span class="var">?q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_red_monom_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="free">G</span> <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> monom_mult_assoc <span class="quoted"><span class="quoted">‹lc <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>6<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="var">?p</span> <span class="main">=</span> rep_list <span class="var">?q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_regular_reduced_unique<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> rep_list_monom_mult<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-sig_regular_top_reduced_lt_lc_unique"><span class="command">lemma</span></span> sig_regular_top_reduced_lt_lc_unique<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dickson_grading <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_sig_GB_upt <span class="free">d</span> <span class="free">G</span> <span class="main">(</span>lt <span class="free">q</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lt <span class="free">p</span> <span class="main">=</span> lt <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">q</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="free">G</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="free">G</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">=</span> punit.lt <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span> <span class="main">∧</span> lc <span class="free">q</span> <span class="main">*</span> punit.lc <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">=</span> lc <span class="free">p</span> <span class="main">*</span> punit.lc <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>6<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>6<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> False <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lc <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lc_not_0<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lc <span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lc_not_0<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> G_sub<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">⊆</span> dgrad_sig_set <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_GB_uptD1<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">⊆</span> dgrad_max_set <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dgrad_sig_set'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="keyword2"><span class="keyword">where</span></span> p'_red<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≺)</span></span> <span class="free">G</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">p</span> <span class="skolem">p'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≺)</span></span> <span class="free">G</span> <span class="skolem">p'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_irredE_dgrad_max_set<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> lt_p'<span class="main">:</span> <span class="quoted"><span class="quoted">"lt <span class="skolem">p'</span> <span class="main">=</span> lt <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> lt_p''<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span> <span class="main">=</span> punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> lc_p'<span class="main">:</span> <span class="quoted"><span class="quoted">"lc <span class="skolem">p'</span> <span class="main">=</span> lc <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> lc_p''<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.lc <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span> <span class="main">=</span> punit.lc <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_regular_rtrancl_lt<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> sig_red_tail_rtrancl_lt_rep_list<span class="main"><span class="keyword3">,</span></span>
        <span class="operator">rule</span> sig_red_regular_rtrancl_lc<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> sig_red_tail_rtrancl_lc_rep_list<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="free">G</span> <span class="skolem">p'</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="free">G</span> <span class="skolem">p'</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="skolem">p'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> is_sig_red_top_addsE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≺)</span></span> <span class="free">G</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">p</span> <span class="skolem">p'</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> punit.rtrancl_0 <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> sig_red_red_rtrancl<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> a <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="free">G</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> lt_p' lt_p'' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_red_top_cong<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>7<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≺)</span></span> <span class="free">G</span> <span class="skolem">p'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="free">G</span> <span class="skolem">p'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_sig_red_top_tail_cases<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="free">G</span> <span class="main">⊆</span> dgrad_max_set <span class="free">d</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q'</span></span> <span class="keyword2"><span class="keyword">where</span></span> q'_red<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≺)</span></span> <span class="free">G</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">q</span> <span class="skolem">q'</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≺)</span></span> <span class="free">G</span> <span class="skolem">q'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_irredE_dgrad_max_set<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> lt_q'<span class="main">:</span> <span class="quoted"><span class="quoted">"lt <span class="skolem">q'</span> <span class="main">=</span> lt <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> lt_q''<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="skolem">q'</span><span class="main">)</span> <span class="main">=</span> punit.lt <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> lc_q'<span class="main">:</span> <span class="quoted"><span class="quoted">"lc <span class="skolem">q'</span> <span class="main">=</span> lc <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> lc_q''<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.lc <span class="main">(</span>rep_list <span class="skolem">q'</span><span class="main">)</span> <span class="main">=</span> punit.lc <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_regular_rtrancl_lt<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> sig_red_tail_rtrancl_lt_rep_list<span class="main"><span class="keyword3">,</span></span>
        <span class="operator">rule</span> sig_red_regular_rtrancl_lc<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> sig_red_tail_rtrancl_lc_rep_list<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="free">G</span> <span class="skolem">q'</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="free">G</span> <span class="skolem">q'</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="skolem">q'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> is_sig_red_top_addsE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≺)</span></span> <span class="free">G</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">q</span> <span class="skolem">q'</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> punit.rtrancl_0 <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> sig_red_red_rtrancl<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> a <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="free">G</span> <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> lt_q' lt_q'' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_red_top_cong<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>8<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≺)</span></span> <span class="free">G</span> <span class="skolem">q'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="free">G</span> <span class="skolem">q'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_sig_red_top_tail_cases<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_sig_GB_upt <span class="free">d</span> <span class="free">G</span> <span class="main">(</span>lt <span class="skolem">q'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> lt_q'<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> G_sub assms<span class="main">(</span>3<span class="main">)</span> p'_red <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dgrad_sig_set_closed_sig_red_rtrancl<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> G_sub assms<span class="main">(</span>4<span class="main">)</span> q'_red <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q'</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dgrad_sig_set_closed_sig_red_rtrancl<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">p'</span> <span class="main">=</span> lt <span class="skolem">q'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> lt_p' lt_q' assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.monom_mult <span class="main">(</span>lc <span class="skolem">q'</span><span class="main">)</span> <span class="main">0</span> <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span> <span class="main">=</span> punit.monom_mult <span class="main">(</span>lc <span class="skolem">p'</span><span class="main">)</span> <span class="main">0</span> <span class="main">(</span>rep_list <span class="skolem">q'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_regular_reduced_unique'<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lc <span class="free">q</span> <span class="main">*</span> punit.lc <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">=</span> lc <span class="free">q</span> <span class="main">*</span> punit.lc <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> lc_p''<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹lc <span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> punit.lc <span class="main">(</span>punit.monom_mult <span class="main">(</span>lc <span class="skolem">q'</span><span class="main">)</span> <span class="main">0</span> <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lc_q'<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> punit.lc <span class="main">(</span>punit.monom_mult <span class="main">(</span>lc <span class="skolem">p'</span><span class="main">)</span> <span class="main">0</span> <span class="main">(</span>rep_list <span class="skolem">q'</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> eq<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹lc <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> lc <span class="free">p</span> <span class="main">*</span> punit.lc <span class="main">(</span>rep_list <span class="skolem">q'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lc_p'<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> lc <span class="free">p</span> <span class="main">*</span> punit.lc <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> lc_q''<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"lc <span class="free">q</span> <span class="main">*</span> punit.lc <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">=</span> lc <span class="free">p</span> <span class="main">*</span> punit.lc <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">=</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> lt_p''<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹lc <span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> punit.lt <span class="main">(</span>punit.monom_mult <span class="main">(</span>lc <span class="skolem">q'</span><span class="main">)</span> <span class="main">0</span> <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lc_q' punit.lt_monom_mult_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> punit.lt <span class="main">(</span>punit.monom_mult <span class="main">(</span>lc <span class="skolem">p'</span><span class="main">)</span> <span class="main">0</span> <span class="main">(</span>rep_list <span class="skolem">q'</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> eq<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹lc <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">q'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lc_p' punit.lt_monom_mult_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> punit.lt <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> lt_q''<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> sig_regular_top_reduced_lt_unique<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dickson_grading <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_sig_GB_upt <span class="free">d</span> <span class="free">G</span> <span class="main">(</span>lt <span class="free">q</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lt <span class="free">p</span> <span class="main">=</span> lt <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="free">G</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="free">G</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">=</span> punit.lt <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>6<span class="main">,</span> 7<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">q</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">,</span> 2<span class="main">,</span> 3<span class="main">,</span> 4<span class="main">,</span> 5<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">=</span> punit.lt <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span> <span class="main">∧</span> lc <span class="free">q</span> <span class="main">*</span> punit.lc <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">=</span> lc <span class="free">p</span> <span class="main">*</span> punit.lc <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>8<span class="main">,</span> 9<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_regular_top_reduced_lt_lc_unique<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> sig_regular_top_reduced_lc_unique<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dickson_grading <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_sig_GB_upt <span class="free">d</span> <span class="free">G</span> <span class="main">(</span>lt <span class="free">q</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lt <span class="free">p</span> <span class="main">=</span> lt <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lc <span class="free">p</span> <span class="main">=</span> lc <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="free">G</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="free">G</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"punit.lc <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">=</span> punit.lc <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>6<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lc_eq_zero_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> True <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lc <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lc_not_0<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lc <span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lc_eq_zero_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> False <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">q</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">,</span> 2<span class="main">,</span> 3<span class="main">,</span> 4<span class="main">,</span> 5<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">=</span> punit.lt <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span> <span class="main">∧</span> lc <span class="free">q</span> <span class="main">*</span> punit.lc <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">=</span> lc <span class="free">p</span> <span class="main">*</span> punit.lc <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>7<span class="main">,</span> 8<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_regular_top_reduced_lt_lc_unique<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lc <span class="free">q</span> <span class="main">*</span> punit.lc <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">=</span> lc <span class="free">p</span> <span class="main">*</span> punit.lc <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> lc <span class="free">q</span> <span class="main">*</span> punit.lc <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹lc <span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Minimal signature Gr\"obner bases are indeed minimal, at least up to sig-lead-pairs:›</span></span>

<span class="keyword1" id="Signature_Groebner-is_min_sig_GB_minimal"><span class="command">lemma</span></span> is_min_sig_GB_minimal<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_min_sig_GB <span class="free">d</span> <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">G'</span> <span class="main">⊆</span> dgrad_sig_set <span class="free">d</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">u</span><span class="main">.</span> <span class="free">d</span> <span class="main">(</span>pp_of_term <span class="bound">u</span><span class="main">)</span> <span class="main">≤</span> dgrad_max <span class="free">d</span> <span class="main">⟹</span> component_of_term <span class="bound">u</span> <span class="main">&lt;</span> length <span class="free">fs</span> <span class="main">⟹</span> is_sig_GB_in <span class="free">d</span> <span class="free">G'</span> <span class="bound">u</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">g</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">g'</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">g'</span> <span class="main">∈</span> <span class="free">G'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">g'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lt <span class="free">g'</span> <span class="main">=</span> lt <span class="free">g</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">g'</span><span class="main">)</span> <span class="main">=</span> punit.lt <span class="main">(</span>rep_list <span class="free">g</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">⊆</span> dgrad_sig_set <span class="free">d</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">u</span><span class="main">.</span> <span class="free">d</span> <span class="main">(</span>pp_of_term <span class="bound">u</span><span class="main">)</span> <span class="main">≤</span> dgrad_max <span class="free">d</span> <span class="main">⟹</span> component_of_term <span class="bound">u</span> <span class="main">&lt;</span> length <span class="free">fs</span> <span class="main">⟹</span> is_sig_GB_in <span class="free">d</span> <span class="free">G</span> <span class="bound">u</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">g0</span><span class="main">.</span> <span class="bound">g0</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> <span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="main">(</span><span class="free">G</span> <span class="main">-</span> <span class="main">{</span><span class="bound">g0</span><span class="main">}</span><span class="main">)</span> <span class="bound">g0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_min_sig_GB_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="main">(</span><span class="free">G</span> <span class="main">-</span> <span class="main">{</span><span class="free">g</span><span class="main">}</span><span class="main">)</span> <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 2<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rep_list_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="free">G</span> <span class="main">⊆</span> dgrad_sig_set <span class="free">d</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">(</span>lp <span class="free">g</span><span class="main">)</span> <span class="main">≤</span> dgrad_max <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"component_of_term <span class="main">(</span>lt <span class="free">g</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="free">fs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dgrad_sig_setD_lp<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> dgrad_sig_setD_lt<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ <span class="quoted"><span class="quoted">‹<span class="free">g</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_sig_GB_in <span class="free">d</span> <span class="free">G'</span> <span class="main">(</span>lt <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sig_red_zero <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="free">G'</span> <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">g</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>›</span></span> refl <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_GB_inD<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> assms<span class="main">(</span>5<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">=</span> <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">∨</span> <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">=</span> <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="free">G'</span> <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_zero_nonzero<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g'</span> <span class="main">∈</span> <span class="free">G'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="skolem">g'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> adds1<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="skolem">g'</span><span class="main">)</span> <span class="keyword1">adds</span> punit.lt <span class="main">(</span>rep_list <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> le1<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">g</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">g'</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> punit.lt <span class="main">(</span>rep_list <span class="skolem">g'</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_red_top_addsE<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹rep_list <span class="skolem">g'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rep_list_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g'</span> <span class="main">∈</span> <span class="free">G'</span>›</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g'</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">(</span>lp <span class="skolem">g'</span><span class="main">)</span> <span class="main">≤</span> dgrad_max <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"component_of_term <span class="main">(</span>lt <span class="skolem">g'</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="free">fs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dgrad_sig_setD_lp<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> dgrad_sig_setD_lt<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ <span class="quoted"><span class="quoted">‹<span class="skolem">g'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_sig_GB_in <span class="free">d</span> <span class="free">G</span> <span class="main">(</span>lt <span class="skolem">g'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 1<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sig_red_zero <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="free">G</span> <span class="skolem">g'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g'</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>›</span></span> refl <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_GB_inD<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹rep_list <span class="skolem">g'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">=</span> <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">∨</span> <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">=</span> <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="free">G</span> <span class="skolem">g'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_zero_nonzero<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g0</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g0</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="skolem">g0</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> adds2<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="skolem">g0</span><span class="main">)</span> <span class="keyword1">adds</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">g'</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> le2<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="skolem">g'</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">g0</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> punit.lt <span class="main">(</span>rep_list <span class="skolem">g0</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">g'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_red_top_addsE<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> eq1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g0</span> <span class="main">=</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g0</span> <span class="main">≠</span> <span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g0</span> <span class="main">∈</span> <span class="free">G</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g0</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">-</span> <span class="main">{</span><span class="free">g</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹rep_list <span class="skolem">g0</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> assms<span class="main">(</span>5<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> adds2 adds1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="skolem">g0</span><span class="main">)</span> <span class="keyword1">adds</span> punit.lt <span class="main">(</span>rep_list <span class="free">g</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> adds_trans<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ord_term_lin.is_le_rel <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">g</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">g0</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> punit.lt <span class="main">(</span>rep_list <span class="skolem">g0</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ord_term_canc<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="skolem">g'</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">g</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">g0</span><span class="main">)</span> <span class="main">=</span>
            punit.lt <span class="main">(</span>rep_list <span class="free">g</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="skolem">g'</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">g0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> splus_left_commute<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> le2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> punit.lt <span class="main">(</span>rep_list <span class="free">g</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="skolem">g0</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">g'</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> splus_mono<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">g0</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">g</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">g'</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> splus_left_commute<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> le1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> punit.lt <span class="main">(</span>rep_list <span class="skolem">g0</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="skolem">g'</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">g</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> splus_mono<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">g'</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="skolem">g0</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">g</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> splus_left_commute<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="skolem">g'</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">g</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">g0</span><span class="main">)</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span>
                    punit.lt <span class="main">(</span>rep_list <span class="skolem">g'</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="skolem">g0</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="main">(</span><span class="free">G</span> <span class="main">-</span> <span class="main">{</span><span class="free">g</span><span class="main">}</span><span class="main">)</span> <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_red_top_addsI<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> 3 <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">from</span></span> adds2 adds1 <span class="keyword1"><span class="command">have</span></span> eq2<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="skolem">g'</span><span class="main">)</span> <span class="main">=</span> punit.lt <span class="main">(</span>rep_list <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq1 adds_antisym<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> le1 le2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">g</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">g'</span> <span class="main">=</span> punit.lt <span class="main">(</span>rep_list <span class="free">g</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq1<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">g'</span> <span class="main">=</span> lt <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> splus_left_canc<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g'</span> <span class="main">∈</span> <span class="free">G'</span>›</span></span> <span class="quoted"><span class="quoted">‹rep_list <span class="skolem">g'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> eq2 <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-sig_red_zero_regularI_adds"><span class="command">lemma</span></span> sig_red_zero_regularI_adds<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dickson_grading <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_sig_GB_upt <span class="free">d</span> <span class="free">G</span> <span class="main">(</span>lt <span class="free">q</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"sig_red_zero <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="free">G</span> <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lt <span class="free">p</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> lt <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sig_red_zero <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="free">G</span> <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">q</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> rep_list_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> rtrancl_refl<span class="main">[</span><span class="operator">to_pred</span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_zeroI<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lc <span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lc_not_0<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lc <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lc_not_0<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lc <span class="free">q</span> <span class="main">/</span> lc <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>7<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> eq1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>lp <span class="free">q</span> <span class="main">-</span> lp <span class="free">p</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">p</span> <span class="main">=</span> lt <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_diff_cancel_right' adds_termE pp_of_term_splus<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>7<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lp <span class="free">p</span> <span class="keyword1">adds</span> lp <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> adds_term_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">(</span>lp <span class="free">q</span> <span class="main">-</span> lp <span class="free">p</span><span class="main">)</span> <span class="main">≤</span> <span class="free">d</span> <span class="main">(</span>lp <span class="free">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dickson_grading_minus<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> dgrad_max <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dgrad_sig_setD_lp<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">(</span>lp <span class="free">q</span> <span class="main">-</span> lp <span class="free">p</span><span class="main">)</span> <span class="main">≤</span> dgrad_max <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> G_sub<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">⊆</span> dgrad_sig_set <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_GB_uptD1<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">⊆</span> dgrad_max_set <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dgrad_sig_set'_def<span class="main">)</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mult</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">r</span><span class="main">.</span> monom_mult <span class="main">(</span>lc <span class="free">q</span> <span class="main">/</span> lc <span class="free">p</span><span class="main">)</span> <span class="main">(</span>lp <span class="free">q</span> <span class="main">-</span> lp <span class="free">p</span><span class="main">)</span> <span class="bound">r</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>6<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="keyword2"><span class="keyword">where</span></span> p_red<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="free">G</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">p</span> <span class="skolem">p'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="skolem">p'</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_zeroE<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> p_red <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">p'</span> <span class="main">=</span> lt <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lc <span class="skolem">p'</span> <span class="main">=</span> lc <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_regular_rtrancl_lt<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> sig_red_regular_rtrancl_lc<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹lc <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹lc <span class="free">q</span> <span class="main">/</span> lc <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?mult</span> <span class="skolem">p'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> monom_mult_eq_zero_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹lc <span class="free">q</span> <span class="main">/</span> lc <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span><span class="var">?mult</span> <span class="skolem">p'</span><span class="main">)</span> <span class="main">=</span> lt <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lt_monom_mult <span class="quoted"><span class="quoted">‹lt <span class="skolem">p'</span> <span class="main">=</span> lt <span class="free">p</span>›</span></span> eq1<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹lc <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lc <span class="main">(</span><span class="var">?mult</span> <span class="skolem">p'</span><span class="main">)</span> <span class="main">=</span> lc <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹lc <span class="skolem">p'</span> <span class="main">=</span> lc <span class="free">p</span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> p_red <span class="keyword1"><span class="command">have</span></span> mult_p_red<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="free">G</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span><span class="var">?mult</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span><span class="var">?mult</span> <span class="skolem">p'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_rtrancl_monom_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="main">(</span><span class="var">?mult</span> <span class="skolem">p'</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rep_list_monom_mult <span class="quoted"><span class="quoted">‹rep_list <span class="skolem">p'</span> <span class="main">=</span> <span class="main">0</span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> mult_p'_irred<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="free">G</span> <span class="main">(</span><span class="var">?mult</span> <span class="skolem">p'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> is_sig_red_addsE <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> G_sub assms<span class="main">(</span>3<span class="main">)</span> p_red <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dgrad_sig_set_closed_sig_red_rtrancl<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="free">d</span> <span class="main">(</span>lp <span class="free">q</span> <span class="main">-</span> lp <span class="free">p</span><span class="main">)</span> <span class="main">≤</span> dgrad_max <span class="free">d</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?mult</span> <span class="skolem">p'</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dgrad_sig_set_closed_monom_mult<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="free">G</span> <span class="main">⊆</span> dgrad_max_set <span class="free">d</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q'</span></span> <span class="keyword2"><span class="keyword">where</span></span> q_red<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="free">G</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">q</span> <span class="skolem">q'</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> q'_irred<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="free">G</span> <span class="skolem">q'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_irredE_dgrad_max_set<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> q_red <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">q'</span> <span class="main">=</span> lt <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lc <span class="skolem">q'</span> <span class="main">=</span> lc <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_regular_rtrancl_lt<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> sig_red_regular_rtrancl_lc<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹lc <span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_sig_GB_upt <span class="free">d</span> <span class="free">G</span> <span class="main">(</span>lt <span class="main">(</span><span class="var">?mult</span> <span class="skolem">p'</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹lt <span class="main">(</span><span class="var">?mult</span> <span class="skolem">p'</span><span class="main">)</span> <span class="main">=</span> lt <span class="free">q</span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> G_sub assms<span class="main">(</span>4<span class="main">)</span> q_red <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q'</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dgrad_sig_set_closed_sig_red_rtrancl<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?mult</span> <span class="skolem">p'</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>›</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">q'</span> <span class="main">=</span> lt <span class="main">(</span><span class="var">?mult</span> <span class="skolem">p'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹lt <span class="main">(</span><span class="var">?mult</span> <span class="skolem">p'</span><span class="main">)</span> <span class="main">=</span> lt <span class="free">q</span>›</span></span> <span class="quoted"><span class="quoted">‹lt <span class="skolem">q'</span> <span class="main">=</span> lt <span class="free">q</span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lc <span class="skolem">q'</span> <span class="main">=</span> lc <span class="main">(</span><span class="var">?mult</span> <span class="skolem">p'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹lc <span class="main">(</span><span class="var">?mult</span> <span class="skolem">p'</span><span class="main">)</span> <span class="main">=</span> lc <span class="free">q</span>›</span></span> <span class="quoted"><span class="quoted">‹lc <span class="skolem">q'</span> <span class="main">=</span> lc <span class="free">q</span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="skolem">q'</span> <span class="main">=</span> rep_list <span class="main">(</span><span class="var">?mult</span> <span class="skolem">p'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> q'_irred mult_p'_irred
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_regular_reduced_unique<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹rep_list <span class="main">(</span><span class="var">?mult</span> <span class="skolem">p'</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="skolem">q'</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> q_red <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_zeroI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-is_syz_sigI"><span class="command">lemma</span></span> is_syz_sigI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lt <span class="free">s</span> <span class="main">=</span> <span class="free">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">s</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_syz_sig <span class="free">d</span> <span class="free">u</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> is_syz_sig_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Signature_Groebner-is_syz_sigE"><span class="command">lemma</span></span> is_syz_sigE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_syz_sig <span class="free">d</span> <span class="free">u</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">r</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lt <span class="free">r</span> <span class="main">=</span> <span class="free">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">r</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> is_syz_sig_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Signature_Groebner-is_syz_sig_adds"><span class="command">lemma</span></span> is_syz_sig_adds<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dickson_grading <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_syz_sig <span class="free">d</span> <span class="free">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">v</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">(</span>pp_of_term <span class="free">v</span><span class="main">)</span> <span class="main">≤</span> dgrad_max <span class="free">d</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_syz_sig <span class="free">d</span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">s</span> <span class="main">=</span> <span class="free">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="skolem">s</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_syz_sigE<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> <span class="skolem">t</span> <span class="main">⊕</span> <span class="free">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> adds_termE<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> is_syz_sigI<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"monom_mult <span class="main">1</span> <span class="skolem">t</span> <span class="skolem">s</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> monom_mult_eq_zero_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span>monom_mult <span class="main">1</span> <span class="skolem">t</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lt_monom_mult v <span class="quoted"><span class="quoted">‹lt <span class="skolem">s</span> <span class="main">=</span> <span class="free">u</span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">+</span> pp_of_term <span class="free">u</span><span class="main">)</span> <span class="main">≤</span> dgrad_max <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> v <span class="dynamic"><span class="dynamic">term_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="skolem">t</span> <span class="main">≤</span> dgrad_max <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dickson_gradingD1<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"monom_mult <span class="main">1</span> <span class="skolem">t</span> <span class="skolem">s</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dgrad_sig_set_closed_monom_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="main">(</span>monom_mult <span class="main">1</span> <span class="skolem">t</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹rep_list <span class="skolem">s</span> <span class="main">=</span> <span class="main">0</span>›</span></span> rep_list_monom_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-syzygy_crit"><span class="command">lemma</span></span> syzygy_crit<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dickson_grading <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_sig_GB_upt <span class="free">d</span> <span class="free">G</span> <span class="free">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_syz_sig <span class="free">d</span> <span class="free">u</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lt <span class="free">p</span> <span class="main">=</span> <span class="free">u</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sig_red_zero <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="free">G</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">s</span> <span class="main">=</span> <span class="free">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="skolem">s</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_syz_sigE<span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> assms<span class="main">(</span>1<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_sig_GB_upt <span class="free">d</span> <span class="free">G</span> <span class="main">(</span>lt <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>›</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> rtranclp.rtrancl_refl <span class="quoted"><span class="quoted">‹rep_list <span class="skolem">s</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sig_red_zero <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="free">G</span> <span class="skolem">s</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_zeroI<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">s</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> lt <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹lt <span class="skolem">s</span> <span class="main">=</span> <span class="free">u</span>›</span></span> adds_term_refl<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_zero_regularI_adds<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-lemma_21"><span class="command">lemma</span></span> lemma_21<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dickson_grading <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_sig_GB_upt <span class="free">d</span> <span class="free">G</span> <span class="main">(</span>lt <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">g</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lt <span class="free">g</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> lt <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">g</span><span class="main">)</span> <span class="keyword1">adds</span> punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="free">G</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?lp</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="var">?lp</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>8<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?lp</span> <span class="main">=</span> <span class="skolem">s</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> s_def minus_plus<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>7<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> lt_p<span class="main">:</span> <span class="quoted"><span class="quoted">"lt <span class="free">p</span> <span class="main">=</span> <span class="skolem">t</span> <span class="main">⊕</span> lt <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> adds_termE<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">⊕</span> lt <span class="free">g</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="free">p</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lp</span> <span class="main">⊕</span> lt <span class="free">g</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> punit.lt <span class="main">(</span>rep_list <span class="free">g</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">p</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> s splus_assoc splus_left_commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">s</span></span><span class="main"><span class="main">]</span></span> splus_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>4<span class="main">,</span> 6<span class="main">,</span> 5<span class="main">,</span> 8<span class="main">)</span> ord_term_lin.is_le_relI<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_red_top_addsI<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lt <span class="free">p</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="skolem">s</span> <span class="main">⊕</span> lt <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main"><span class="free">≺</span></span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lt_p ord_term_strict_canc_left<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="free">g</span><span class="main">)</span> <span class="main"><span class="free">≺</span></span> <span class="skolem">s</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> plus_monotone_strict<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="free">g</span><span class="main">)</span> <span class="main"><span class="free">≺</span></span> <span class="var">?lp</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> s<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rep_list_zero<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lc <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lc_not_0<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>6<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rep_list_zero<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lc <span class="free">g</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lc_not_0<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹lc <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"lc <span class="free">p</span> <span class="main">/</span> lc <span class="free">g</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"monom_mult <span class="main">(</span>lc <span class="free">p</span> <span class="main">/</span> lc <span class="free">g</span><span class="main">)</span> <span class="skolem">t</span> <span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> 1 <span class="quoted"><span class="quoted">‹<span class="free">g</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="var">?g</span> <span class="main">=</span> lt <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> lt_p <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lt_monom_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹lc <span class="free">g</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lc <span class="var">?g</span> <span class="main">=</span> lc <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="var">?g</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">t</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="free">g</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> rep_list_monom_mult <span class="keyword1"><span class="command">using</span></span> 1 assms<span class="main">(</span>6<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.lt_monom_mult<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main"><span class="free">≺</span></span> <span class="var">?lp</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="var">?g</span><span class="main">)</span> <span class="main"><span class="free">≺</span></span> <span class="var">?lp</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">hence</span></span> lt_pg<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="var">?g</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="var">?lp</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">p</span> <span class="main">≠</span> rep_list <span class="var">?g</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rep_list_minus punit.lt_minus_eqI_2<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="var">?g</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">-</span> <span class="var">?g</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rep_list_minus rep_list_zero<span class="main">)</span>

    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">⊆</span> dgrad_sig_set <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_GB_uptD1<span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> assms<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="skolem">t</span> <span class="main">≤</span> dgrad_max <span class="free">d</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> le_trans<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lp <span class="free">p</span> <span class="main">=</span> <span class="skolem">t</span> <span class="main">+</span> lp <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lt_p <span class="dynamic"><span class="dynamic">term_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="skolem">t</span> <span class="main">≤</span> <span class="free">d</span> <span class="main">(</span>lp <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dickson_grading_adds_imp_le<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">(</span>lp <span class="free">p</span><span class="main">)</span> <span class="main">≤</span> dgrad_max <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dgrad_sig_setD_lp<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="free">G</span> <span class="main">⊆</span> dgrad_sig_set <span class="free">d</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dgrad_sig_set_closed_monom_mult<span class="main">)</span>

    <span class="keyword1"><span class="command">note</span></span> assms<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="var">?g</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">-</span> <span class="var">?g</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dgrad_sig_set_closed_minus<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">-</span> <span class="var">?g</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹lt <span class="var">?g</span> <span class="main">=</span> lt <span class="free">p</span>›</span></span> <span class="quoted"><span class="quoted">‹lc <span class="var">?g</span> <span class="main">=</span> lc <span class="free">p</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="var">?g</span><span class="main">)</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="free">p</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lt_minus_lessI<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sig_red_zero <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="free">G</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="var">?g</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_GB_uptD3<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹rep_list <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="var">?g</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">=</span> <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">∨</span> <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">=</span> <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="free">G</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="var">?g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_zero_nonzero<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g1</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="skolem">g1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="skolem">g1</span><span class="main">)</span> <span class="keyword1">adds</span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="var">?g</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="var">?g</span><span class="main">)</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">g1</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> punit.lt <span class="main">(</span>rep_list <span class="skolem">g1</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="var">?g</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_red_top_addsE<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g1</span> <span class="main">∈</span> <span class="free">G</span>›</span></span> <span class="quoted"><span class="quoted">‹rep_list <span class="skolem">g1</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> assms<span class="main">(</span>5<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_red_top_addsI<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> 2 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="skolem">g1</span><span class="main">)</span> <span class="keyword1">adds</span> punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> lt_pg<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lp</span> <span class="main">⊕</span> lt <span class="skolem">g1</span> <span class="main">=</span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="var">?g</span><span class="main">)</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">g1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> lt_pg<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> punit.lt <span class="main">(</span>rep_list <span class="skolem">g1</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="var">?g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> 3<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹lt <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="var">?g</span><span class="main">)</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="free">p</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> punit.lt <span class="main">(</span>rep_list <span class="skolem">g1</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">p</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> splus_mono_strict<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lp</span> <span class="main">⊕</span> lt <span class="skolem">g1</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> punit.lt <span class="main">(</span>rep_list <span class="skolem">g1</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ord_term_lin.less_imp_le<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Rewrite Bases›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_rewrite_ord</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_rewrite_ord</span> <span class="free"><span class="bound"><span class="entity">rword</span></span></span> <span class="main">⟷</span> <span class="main">(</span>reflp <span class="free"><span class="bound"><span class="entity">rword</span></span></span> <span class="main">∧</span> transp <span class="free"><span class="bound"><span class="entity">rword</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">rword</span></span></span> <span class="bound">a</span> <span class="bound">b</span> <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">rword</span></span></span> <span class="bound">b</span> <span class="bound">a</span><span class="main">)</span> <span class="main">∧</span>
                                  <span class="main">(</span><span class="main">∀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">rword</span></span></span> <span class="bound">a</span> <span class="bound">b</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">rword</span></span></span> <span class="bound">b</span> <span class="bound">a</span> <span class="main">⟶</span> fst <span class="bound">a</span> <span class="main">=</span> fst <span class="bound">b</span><span class="main">)</span> <span class="main">∧</span>
                                  <span class="main">(</span><span class="main">∀</span><span class="bound">d</span> <span class="bound">G</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> dickson_grading <span class="bound">d</span> <span class="main">⟶</span> is_sig_GB_upt <span class="bound">d</span> <span class="bound">G</span> <span class="main">(</span>lt <span class="bound">b</span><span class="main">)</span> <span class="main">⟶</span>
                                          <span class="bound">a</span> <span class="main">∈</span> <span class="bound">G</span> <span class="main">⟶</span> <span class="bound">b</span> <span class="main">∈</span> <span class="bound">G</span> <span class="main">⟶</span> <span class="bound">a</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟶</span> <span class="bound">b</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟶</span> lt <span class="bound">a</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> lt <span class="bound">b</span> <span class="main">⟶</span>
                                          <span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="bound">G</span> <span class="bound">b</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">rword</span></span></span> <span class="main">(</span>spp_of <span class="bound">a</span><span class="main">)</span> <span class="main">(</span>spp_of <span class="bound">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_canon_rewriter</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span> set <span class="main">⇒</span> <span class="tfree">'t</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_canon_rewriter</span> <span class="free"><span class="bound"><span class="entity">rword</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">⟷</span>
                  <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> lt <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span> <span class="bound">a</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟶</span> lt <span class="bound">a</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">rword</span></span></span> <span class="main">(</span>spp_of <span class="bound">a</span><span class="main">)</span> <span class="main">(</span>spp_of <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_RB_in</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> nat<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span> set <span class="main">⇒</span> <span class="tfree">'t</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_RB_in</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">rword</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">⟷</span>
            <span class="main">(</span><span class="main">(</span><span class="main">∃</span><span class="bound">g</span><span class="main">.</span> is_canon_rewriter <span class="free"><span class="bound"><span class="entity">rword</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="bound">g</span> <span class="main">∧</span> <span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">(</span>monom_mult <span class="main">1</span> <span class="main">(</span>pp_of_term <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">-</span> lp <span class="bound">g</span><span class="main">)</span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span>
             is_syz_sig <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_RB_upt</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> nat<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span> set <span class="main">⇒</span> <span class="tfree">'t</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_RB_upt</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">rword</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">⟷</span>
            <span class="main">(</span><span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">⊆</span> dgrad_sig_set <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">(</span>pp_of_term <span class="bound">v</span><span class="main">)</span> <span class="main">≤</span> dgrad_max <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">⟶</span>
                                      component_of_term <span class="bound">v</span> <span class="main">&lt;</span> length <span class="free">fs</span> <span class="main">⟶</span> is_RB_in <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">rword</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Signature_Groebner-is_rewrite_ordI"><span class="command">lemma</span></span> is_rewrite_ordI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"reflp <span class="free">rword</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"transp <span class="free">rword</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="free">rword</span> <span class="bound">a</span> <span class="bound">b</span> <span class="main">∨</span> <span class="free">rword</span> <span class="bound">b</span> <span class="bound">a</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="free">rword</span> <span class="bound">a</span> <span class="bound">b</span> <span class="main">⟹</span> <span class="free">rword</span> <span class="bound">b</span> <span class="bound">a</span> <span class="main">⟹</span> fst <span class="bound">a</span> <span class="main">=</span> fst <span class="bound">b</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">d</span> <span class="bound">G</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> dickson_grading <span class="bound">d</span> <span class="main">⟹</span> is_sig_GB_upt <span class="bound">d</span> <span class="bound">G</span> <span class="main">(</span>lt <span class="bound">b</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">a</span> <span class="main">∈</span> <span class="bound">G</span> <span class="main">⟹</span> <span class="bound">b</span> <span class="main">∈</span> <span class="bound">G</span> <span class="main">⟹</span>
                   <span class="bound">a</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="bound">b</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> lt <span class="bound">a</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> lt <span class="bound">b</span> <span class="main">⟹</span> <span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="bound">G</span> <span class="bound">b</span> <span class="main">⟹</span> <span class="free">rword</span> <span class="main">(</span>spp_of <span class="bound">a</span><span class="main">)</span> <span class="main">(</span>spp_of <span class="bound">b</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_rewrite_ord <span class="free">rword</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> is_rewrite_ord_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Signature_Groebner-is_rewrite_ordD1"><span class="command">lemma</span></span> is_rewrite_ordD1<span class="main">:</span> <span class="quoted"><span class="quoted">"is_rewrite_ord <span class="free">rword</span> <span class="main">⟹</span> <span class="free">rword</span> <span class="free">a</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_rewrite_ord_def reflpD<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-is_rewrite_ordD2"><span class="command">lemma</span></span> is_rewrite_ordD2<span class="main">:</span> <span class="quoted"><span class="quoted">"is_rewrite_ord <span class="free">rword</span> <span class="main">⟹</span> <span class="free">rword</span> <span class="free">a</span> <span class="free">b</span> <span class="main">⟹</span> <span class="free">rword</span> <span class="free">b</span> <span class="free">c</span> <span class="main">⟹</span> <span class="free">rword</span> <span class="free">a</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_rewrite_ord_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> transpD<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-is_rewrite_ordD3"><span class="command">lemma</span></span> is_rewrite_ordD3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_rewrite_ord <span class="free">rword</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">rword</span> <span class="free">a</span> <span class="free">b</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">rword</span> <span class="free">a</span> <span class="free">b</span> <span class="main">⟹</span> <span class="free">rword</span> <span class="free">b</span> <span class="free">a</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="free">thesis</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> disj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">rword</span> <span class="free">a</span> <span class="free">b</span> <span class="main">∨</span> <span class="free">rword</span> <span class="free">b</span> <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_rewrite_ord_def <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> split_paired_All<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">rword</span> <span class="free">a</span> <span class="free">b</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this disj <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">rword</span> <span class="free">b</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-is_rewrite_ordD4"><span class="command">lemma</span></span> is_rewrite_ordD4<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_rewrite_ord <span class="free">rword</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">rword</span> <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">rword</span> <span class="free">b</span> <span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fst <span class="free">a</span> <span class="main">=</span> fst <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> is_rewrite_ord_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Signature_Groebner-is_rewrite_ordD4'"><span class="command">lemma</span></span> is_rewrite_ordD4'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_rewrite_ord <span class="free">rword</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">rword</span> <span class="main">(</span>spp_of <span class="free">a</span><span class="main">)</span> <span class="main">(</span>spp_of <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">rword</span> <span class="main">(</span>spp_of <span class="free">b</span><span class="main">)</span> <span class="main">(</span>spp_of <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lt <span class="free">a</span> <span class="main">=</span> lt <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>spp_of <span class="free">a</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span>spp_of <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_rewrite_ordD4<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> spp_of_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-is_rewrite_ordD5"><span class="command">lemma</span></span> is_rewrite_ordD5<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_rewrite_ord <span class="free">rword</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"dickson_grading <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_sig_GB_upt <span class="free">d</span> <span class="free">G</span> <span class="main">(</span>lt <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lt <span class="free">a</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> lt <span class="free">b</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="free">G</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">rword</span> <span class="main">(</span>spp_of <span class="free">a</span><span class="main">)</span> <span class="main">(</span>spp_of <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> is_rewrite_ord_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Signature_Groebner-is_canon_rewriterI"><span class="command">lemma</span></span> is_canon_rewriterI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lt <span class="free">p</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">u</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="bound">a</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> lt <span class="bound">a</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">u</span> <span class="main">⟹</span> <span class="free">rword</span> <span class="main">(</span>spp_of <span class="bound">a</span><span class="main">)</span> <span class="main">(</span>spp_of <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_canon_rewriter <span class="free">rword</span> <span class="free">A</span> <span class="free">u</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> is_canon_rewriter_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Signature_Groebner-is_canon_rewriterD1"><span class="command">lemma</span></span> is_canon_rewriterD1<span class="main">:</span> <span class="quoted"><span class="quoted">"is_canon_rewriter <span class="free">rword</span> <span class="free">A</span> <span class="free">u</span> <span class="free">p</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_canon_rewriter_def<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-is_canon_rewriterD2"><span class="command">lemma</span></span> is_canon_rewriterD2<span class="main">:</span> <span class="quoted"><span class="quoted">"is_canon_rewriter <span class="free">rword</span> <span class="free">A</span> <span class="free">u</span> <span class="free">p</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_canon_rewriter_def<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-is_canon_rewriterD3"><span class="command">lemma</span></span> is_canon_rewriterD3<span class="main">:</span> <span class="quoted"><span class="quoted">"is_canon_rewriter <span class="free">rword</span> <span class="free">A</span> <span class="free">u</span> <span class="free">p</span> <span class="main">⟹</span> lt <span class="free">p</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">u</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_canon_rewriter_def<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-is_canon_rewriterD4"><span class="command">lemma</span></span> is_canon_rewriterD4<span class="main">:</span>
  <span class="quoted"><span class="quoted">"is_canon_rewriter <span class="free">rword</span> <span class="free">A</span> <span class="free">u</span> <span class="free">p</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> lt <span class="free">a</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">u</span> <span class="main">⟹</span> <span class="free">rword</span> <span class="main">(</span>spp_of <span class="free">a</span><span class="main">)</span> <span class="main">(</span>spp_of <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_canon_rewriter_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> is_canon_rewriterD <span class="main">=</span> is_canon_rewriterD1 is_canon_rewriterD2 is_canon_rewriterD3 is_canon_rewriterD4

<span class="keyword1" id="Signature_Groebner-is_rewrite_ord_finite_canon_rewriterE"><span class="command">lemma</span></span> is_rewrite_ord_finite_canon_rewriterE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_rewrite_ord <span class="free">rword</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lt <span class="free">a</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">u</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">p</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"is_canon_rewriter <span class="free">rword</span> <span class="free">A</span> <span class="free">u</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> lt <span class="bound">x</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">u</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?rel</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> strict <span class="free">rword</span> <span class="main">(</span>spp_of <span class="bound">y</span><span class="main">)</span> <span class="main">(</span>spp_of <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?A</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">,</span> 4<span class="main">,</span> 5<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"irreflp <span class="var">?rel</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"reflp <span class="free">rword</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_rewrite_ord_def<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reflp_def irreflp_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"transp <span class="var">?rel</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"transp <span class="free">rword</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_rewrite_ord_def<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> transp_def <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> split_paired_All<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="var">?A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">b</span><span class="main">.</span> <span class="var">?rel</span> <span class="bound">b</span> <span class="skolem">p</span> <span class="main">⟹</span> <span class="bound">b</span> <span class="main">∉</span> <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_minimalE<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">p</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> is_canon_rewriterI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">q</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">q</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">u</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> * <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?rel</span> <span class="skolem">q</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> disj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">rword</span> <span class="main">(</span>spp_of <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>spp_of <span class="skolem">q</span><span class="main">)</span> <span class="main">∨</span> <span class="free">rword</span> <span class="main">(</span>spp_of <span class="skolem">q</span><span class="main">)</span> <span class="main">(</span>spp_of <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">rword</span> <span class="main">(</span>spp_of <span class="skolem">q</span><span class="main">)</span> <span class="main">(</span>spp_of <span class="skolem">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> is_rewrite_ordD3<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">rword</span> <span class="main">(</span>spp_of <span class="skolem">q</span><span class="main">)</span> <span class="main">(</span>spp_of <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">rword</span> <span class="main">(</span>spp_of <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>spp_of <span class="skolem">q</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> disj <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-is_rewrite_ord_canon_rewriterD1"><span class="command">lemma</span></span> is_rewrite_ord_canon_rewriterD1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_rewrite_ord <span class="free">rword</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_canon_rewriter <span class="free">rword</span> <span class="free">A</span> <span class="free">u</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_canon_rewriter <span class="free">rword</span> <span class="free">A</span> <span class="free">v</span> <span class="free">q</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lt <span class="free">p</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lt <span class="free">q</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">u</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lt <span class="free">p</span> <span class="main">=</span> lt <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="bound">a</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> lt <span class="bound">a</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">u</span> <span class="main">⟹</span> <span class="free">rword</span> <span class="main">(</span>spp_of <span class="bound">a</span><span class="main">)</span> <span class="main">(</span>spp_of <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_canon_rewriterD<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="bound">a</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> lt <span class="bound">a</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">v</span> <span class="main">⟹</span> <span class="free">rword</span> <span class="main">(</span>spp_of <span class="bound">a</span><span class="main">)</span> <span class="main">(</span>spp_of <span class="free">q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_canon_rewriterD<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">note</span></span> assms<span class="main">(</span>1<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">rword</span> <span class="main">(</span>spp_of <span class="free">p</span><span class="main">)</span> <span class="main">(</span>spp_of <span class="free">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 2<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> assms<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">rword</span> <span class="main">(</span>spp_of <span class="free">q</span><span class="main">)</span> <span class="main">(</span>spp_of <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 1<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_rewrite_ordD4'<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> is_rewrite_ord_canon_rewriterD2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_rewrite_ord <span class="free">rword</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_canon_rewriter <span class="free">rword</span> <span class="free">A</span> <span class="free">u</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_canon_rewriter <span class="free">rword</span> <span class="free">A</span> <span class="free">u</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lt <span class="free">p</span> <span class="main">=</span> lt <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> is_rewrite_ord_canon_rewriterD1<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lt <span class="free">p</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_canon_rewriterD<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lt <span class="free">q</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_canon_rewriterD<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-is_rewrite_ord_canon_rewriterD3"><span class="command">lemma</span></span> is_rewrite_ord_canon_rewriterD3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_rewrite_ord <span class="free">rword</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"dickson_grading <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_canon_rewriter <span class="free">rword</span> <span class="free">A</span> <span class="free">u</span> <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lt <span class="free">a</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_sig_GB_upt <span class="free">d</span> <span class="free">A</span> <span class="main">(</span>lt <span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lt <span class="free">p</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> lt <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="free">A</span> <span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lt <span class="free">p</span> <span class="main">=</span> lt <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">note</span></span> assms<span class="main">(</span>1<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">,</span> 2<span class="main">,</span> 7<span class="main">)</span> _ assms<span class="main">(</span>4<span class="main">)</span> _ assms<span class="main">(</span>5<span class="main">,</span> 8<span class="main">,</span> 9<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">rword</span> <span class="main">(</span>spp_of <span class="free">p</span><span class="main">)</span> <span class="main">(</span>spp_of <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> is_rewrite_ordD5<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_canon_rewriterD<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">,</span> 4<span class="main">,</span> 5<span class="main">,</span> 6<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">rword</span> <span class="main">(</span>spp_of <span class="free">a</span><span class="main">)</span> <span class="main">(</span>spp_of <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_canon_rewriterD4<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_rewrite_ordD4'<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-is_RB_inI1"><span class="command">lemma</span></span> is_RB_inI1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_canon_rewriter <span class="free">rword</span> <span class="free">G</span> <span class="free">u</span> <span class="free">g</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="free">G</span> <span class="main">(</span>monom_mult <span class="main">1</span> <span class="main">(</span>pp_of_term <span class="free">u</span> <span class="main">-</span> lp <span class="free">g</span><span class="main">)</span> <span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_RB_in <span class="free">d</span> <span class="free">rword</span> <span class="free">G</span> <span class="free">u</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> is_RB_in_def <span class="keyword1"><span class="command">using</span></span> assms is_canon_rewriterD1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Signature_Groebner-is_RB_inI2"><span class="command">lemma</span></span> is_RB_inI2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_syz_sig <span class="free">d</span> <span class="free">u</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_RB_in <span class="free">d</span> <span class="free">rword</span> <span class="free">G</span> <span class="free">u</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> is_RB_in_def Let_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Signature_Groebner-is_RB_inE"><span class="command">lemma</span></span> is_RB_inE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_RB_in <span class="free">d</span> <span class="free">rword</span> <span class="free">G</span> <span class="free">u</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_syz_sig <span class="free">d</span> <span class="free">u</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">g</span><span class="main">.</span> <span class="main">¬</span> is_syz_sig <span class="free">d</span> <span class="free">u</span> <span class="main">⟹</span> is_canon_rewriter <span class="free">rword</span> <span class="free">G</span> <span class="free">u</span> <span class="bound">g</span> <span class="main">⟹</span>
            <span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="free">G</span> <span class="main">(</span>monom_mult <span class="main">1</span> <span class="main">(</span>pp_of_term <span class="free">u</span> <span class="main">-</span> lp <span class="bound">g</span><span class="main">)</span> <span class="bound">g</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="free">thesis</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> is_RB_in_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Signature_Groebner-is_RB_inD"><span class="command">lemma</span></span> is_RB_inD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dickson_grading <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">⊆</span> dgrad_sig_set <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_RB_in <span class="free">d</span> <span class="free">rword</span> <span class="free">G</span> <span class="free">u</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_syz_sig <span class="free">d</span> <span class="free">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">(</span>pp_of_term <span class="free">u</span><span class="main">)</span> <span class="main">≤</span> dgrad_max <span class="free">d</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_canon_rewriter <span class="free">rword</span> <span class="free">G</span> <span class="free">u</span> <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">g</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"rep_list <span class="free">g</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_syz_sig <span class="free">d</span> <span class="free">u</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> is_syz_sig_adds<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_syz_sig <span class="free">d</span> <span class="main">(</span>lt <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> is_syz_sigI<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>6<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_canon_rewriterD2<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>6<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_canon_rewriterD1<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">fact</span> refl<span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span> a<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>6<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lt <span class="free">g</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_canon_rewriterD3<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-is_RB_uptI"><span class="command">lemma</span></span> is_RB_uptI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">⊆</span> dgrad_sig_set <span class="free">d</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free">u</span> <span class="main">⟹</span> <span class="free">d</span> <span class="main">(</span>pp_of_term <span class="bound">v</span><span class="main">)</span> <span class="main">≤</span> dgrad_max <span class="free">d</span> <span class="main">⟹</span> component_of_term <span class="bound">v</span> <span class="main">&lt;</span> length <span class="free">fs</span> <span class="main">⟹</span>
            is_RB_in <span class="free">d</span> <span class="free">canon</span> <span class="free">G</span> <span class="bound">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_RB_upt <span class="free">d</span> <span class="free">canon</span> <span class="free">G</span> <span class="free">u</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> is_RB_upt_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Signature_Groebner-is_RB_uptD1"><span class="command">lemma</span></span> is_RB_uptD1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_RB_upt <span class="free">d</span> <span class="free">canon</span> <span class="free">G</span> <span class="free">u</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">⊆</span> dgrad_sig_set <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> is_RB_upt_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Signature_Groebner-is_RB_uptD2"><span class="command">lemma</span></span> is_RB_uptD2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_RB_upt <span class="free">d</span> <span class="free">canon</span> <span class="free">G</span> <span class="free">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">(</span>pp_of_term <span class="free">v</span><span class="main">)</span> <span class="main">≤</span> dgrad_max <span class="free">d</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"component_of_term <span class="free">v</span> <span class="main">&lt;</span> length <span class="free">fs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_RB_in <span class="free">d</span> <span class="free">canon</span> <span class="free">G</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> is_RB_upt_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Signature_Groebner-is_RB_in_UnI"><span class="command">lemma</span></span> is_RB_in_UnI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_RB_in <span class="free">d</span> <span class="free">rword</span> <span class="free">G</span> <span class="free">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">h</span><span class="main">.</span> <span class="bound">h</span> <span class="main">∈</span> <span class="free">H</span> <span class="main">⟹</span> <span class="free">u</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="bound">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_RB_in <span class="free">d</span> <span class="free">rword</span> <span class="main">(</span><span class="free">H</span> <span class="main">∪</span> <span class="free">G</span><span class="main">)</span> <span class="free">u</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> is_RB_inE<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_syz_sig <span class="free">d</span> <span class="free">u</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"is_RB_in <span class="free">d</span> <span class="free">rword</span> <span class="main">(</span><span class="free">H</span> <span class="main">∪</span> <span class="free">G</span><span class="main">)</span> <span class="free">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_RB_inI2<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">g'</span>
  <span class="keyword3"><span class="command">assume</span></span> crw<span class="main">:</span> <span class="quoted"><span class="quoted">"is_canon_rewriter <span class="free">rword</span> <span class="free">G</span> <span class="free">u</span> <span class="skolem">g'</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> irred<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="free">G</span> <span class="main">(</span>monom_mult <span class="main">1</span> <span class="main">(</span>pp_of_term <span class="free">u</span> <span class="main">-</span> lp <span class="skolem">g'</span><span class="main">)</span> <span class="skolem">g'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> crw <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g'</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">g'</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">u</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> max<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> <span class="bound">a</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> lt <span class="bound">a</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">u</span> <span class="main">⟹</span> <span class="free">rword</span> <span class="main">(</span>spp_of <span class="bound">a</span><span class="main">)</span> <span class="main">(</span>spp_of <span class="skolem">g'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_canon_rewriterD<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_RB_in <span class="free">d</span> <span class="free">rword</span> <span class="main">(</span><span class="free">H</span> <span class="main">∪</span> <span class="free">G</span><span class="main">)</span> <span class="free">u</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> is_RB_inI1<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_canon_rewriter <span class="free">rword</span> <span class="main">(</span><span class="free">H</span> <span class="main">∪</span> <span class="free">G</span><span class="main">)</span> <span class="free">u</span> <span class="skolem">g'</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> is_canon_rewriterI<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g'</span> <span class="main">∈</span> <span class="free">G</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g'</span> <span class="main">∈</span> <span class="free">H</span> <span class="main">∪</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">H</span> <span class="main">∪</span> <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">a</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">u</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">rword</span> <span class="main">(</span>spp_of <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span>spp_of <span class="skolem">g'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">H</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹lt <span class="skolem">a</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">u</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">a</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">a</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ord_adds_term<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> <span class="free">H</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">G</span>"</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹lt <span class="skolem">a</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">u</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> max<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="main">(</span><span class="free">H</span> <span class="main">∪</span> <span class="free">G</span><span class="main">)</span> <span class="main">(</span>monom_mult <span class="main">1</span> <span class="main">(</span>pp_of_term <span class="free">u</span> <span class="main">-</span> lp <span class="skolem">g'</span><span class="main">)</span> <span class="skolem">g'</span><span class="main">)</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="main">_</span> <span class="main">_</span> <span class="main">_</span> <span class="var">?g</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="main">(</span><span class="free">H</span> <span class="main">∪</span> <span class="free">G</span><span class="main">)</span> <span class="var">?g</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> irred <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="free">H</span> <span class="var">?g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_sig_red_Un <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> Un_insert_left<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> <span class="free">H</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="main">{</span><span class="skolem">h</span><span class="main">}</span> <span class="var">?g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_red_singletonI<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">h</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="var">?g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_red_regularD_lt<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹lt <span class="skolem">g'</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">u</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">u</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lt_monom_mult adds_term_alt pp_of_term_splus<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">h</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free">u</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">h</span> <span class="main">∈</span> <span class="free">H</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="skolem">h</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> is_RB_in_insertI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_RB_in <span class="free">d</span> <span class="free">rword</span> <span class="free">G</span> <span class="free">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_RB_in <span class="free">d</span> <span class="free">rword</span> <span class="main">(</span>insert <span class="free">g</span> <span class="free">G</span><span class="main">)</span> <span class="free">u</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_RB_in <span class="free">d</span> <span class="free">rword</span> <span class="main">(</span><span class="main">{</span><span class="free">g</span><span class="main">}</span> <span class="main">∪</span> <span class="free">G</span><span class="main">)</span> <span class="free">u</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> is_RB_in_UnI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">h</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> <span class="main">{</span><span class="free">g</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="skolem">h</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> is_RB_upt_UnI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_RB_upt <span class="free">d</span> <span class="free">rword</span> <span class="free">G</span> <span class="free">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">⊆</span> dgrad_sig_set <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">h</span><span class="main">.</span> <span class="bound">h</span> <span class="main">∈</span> <span class="free">H</span> <span class="main">⟹</span> <span class="free">u</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="bound">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_RB_upt <span class="free">d</span> <span class="free">rword</span> <span class="main">(</span><span class="free">H</span> <span class="main">∪</span> <span class="free">G</span><span class="main">)</span> <span class="free">u</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> is_RB_uptI<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">⊆</span> dgrad_sig_set <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_RB_uptD1<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">∪</span> <span class="free">G</span> <span class="main">⊆</span> dgrad_sig_set <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Un_least<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">(</span>pp_of_term <span class="skolem">v</span><span class="main">)</span> <span class="main">≤</span> dgrad_max <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"component_of_term <span class="skolem">v</span> <span class="main">&lt;</span> length <span class="free">fs</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_RB_in <span class="free">d</span> <span class="free">rword</span> <span class="free">G</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_RB_uptD2<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free">u</span>›</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">h</span><span class="main">.</span> <span class="bound">h</span> <span class="main">∈</span> <span class="free">H</span> <span class="main">⟹</span> <span class="skolem">v</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="bound">h</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ord_term_lin.less_le_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_RB_in <span class="free">d</span> <span class="free">rword</span> <span class="main">(</span><span class="free">H</span> <span class="main">∪</span> <span class="free">G</span><span class="main">)</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_RB_in_UnI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> is_RB_upt_insertI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_RB_upt <span class="free">d</span> <span class="free">rword</span> <span class="free">G</span> <span class="free">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_RB_upt <span class="free">d</span> <span class="free">rword</span> <span class="main">(</span>insert <span class="free">g</span> <span class="free">G</span><span class="main">)</span> <span class="free">u</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_RB_upt <span class="free">d</span> <span class="free">rword</span> <span class="main">(</span><span class="main">{</span><span class="free">g</span><span class="main">}</span> <span class="main">∪</span> <span class="free">G</span><span class="main">)</span> <span class="free">u</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> is_RB_upt_UnI<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">g</span><span class="main">}</span> <span class="main">⊆</span> dgrad_sig_set <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">h</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> <span class="main">{</span><span class="free">g</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="skolem">h</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-is_RB_upt_is_sig_GB_upt"><span class="command">lemma</span></span> is_RB_upt_is_sig_GB_upt<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dickson_grading <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_RB_upt <span class="free">d</span> <span class="free">rword</span> <span class="free">G</span> <span class="free">u</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_sig_GB_upt <span class="free">d</span> <span class="free">G</span> <span class="free">u</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Q</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free">u</span> <span class="main">∧</span> <span class="free">d</span> <span class="main">(</span>pp_of_term <span class="bound">v</span><span class="main">)</span> <span class="main">≤</span> dgrad_max <span class="free">d</span> <span class="main">∧</span> component_of_term <span class="bound">v</span> <span class="main">&lt;</span> length <span class="free">fs</span> <span class="main">∧</span> <span class="main">¬</span> is_sig_GB_in <span class="free">d</span> <span class="free">G</span> <span class="bound">v</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> Q_sub<span class="main">:</span> <span class="quoted"><span class="quoted">"pp_of_term <span class="main">`</span> <span class="var">?Q</span> <span class="main">⊆</span> dgrad_set <span class="free">d</span> <span class="main">(</span>dgrad_max <span class="free">d</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> G_sub<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">⊆</span> dgrad_sig_set <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_RB_uptD1<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">⊆</span> dgrad_max_set <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dgrad_sig_set'_def<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_GB_upt <span class="free">d</span> <span class="free">G</span> <span class="free">u</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> G_sub <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v'</span> <span class="main">∈</span> <span class="var">?Q</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_sig_GB_upt_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="var">?Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> min<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="skolem">v</span> <span class="main">⟹</span> <span class="bound">y</span> <span class="main">∉</span> <span class="var">?Q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Q_sub
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ord_term_minimum_dgrad_set<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> <span class="var">?Q</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">(</span>pp_of_term <span class="skolem">v</span><span class="main">)</span> <span class="main">≤</span> dgrad_max <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"component_of_term <span class="skolem">v</span> <span class="main">&lt;</span> length <span class="free">fs</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_GB_in <span class="free">d</span> <span class="free">G</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> this<span class="main">(</span>1<span class="main">,</span> 2<span class="main">,</span> 3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_RB_in <span class="free">d</span> <span class="free">rword</span> <span class="free">G</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_RB_uptD2<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> is_sig_GB_in <span class="free">d</span> <span class="free">G</span> <span class="skolem">v</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">r</span> <span class="main">=</span> <span class="skolem">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> sig_red_zero <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="free">G</span> <span class="skolem">r</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> is_sig_GB_in_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="skolem">r</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sig_red_zero_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rep_list_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lc <span class="skolem">r</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lc_not_0<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> G_sub <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_sig_GB_upt <span class="free">d</span> <span class="free">G</span> <span class="skolem">v</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_GB_uptI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">w</span>
    <span class="keyword3"><span class="command">assume</span></span> dw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">(</span>pp_of_term <span class="skolem">w</span><span class="main">)</span> <span class="main">≤</span> dgrad_max <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> cp<span class="main">:</span> <span class="quoted"><span class="quoted">"component_of_term <span class="skolem">w</span> <span class="main">&lt;</span> length <span class="free">fs</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∉</span> <span class="var">?Q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> min<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">w</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free">u</span> <span class="main">∨</span> is_sig_GB_in <span class="free">d</span> <span class="free">G</span> <span class="skolem">w</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dw cp<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"is_sig_GB_in <span class="free">d</span> <span class="free">G</span> <span class="skolem">w</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">w</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free">u</span>"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">w</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="skolem">v</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free">u</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ord_term_lin.less_trans<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹is_RB_in <span class="free">d</span> <span class="free">rword</span> <span class="free">G</span> <span class="skolem">v</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sig_red_zero <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="free">G</span> <span class="skolem">r</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> is_RB_inE<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_syz_sig <span class="free">d</span> <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sig_red_zero <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="free">G</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> syzygy_crit<span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_zero_sing_regI<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">g</span>
    <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="free">G</span> <span class="main">(</span>monom_mult <span class="main">1</span> <span class="main">(</span>pp_of_term <span class="skolem">v</span> <span class="main">-</span> lp <span class="skolem">g</span><span class="main">)</span> <span class="skolem">g</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_canon_rewriter <span class="free">rword</span> <span class="free">G</span> <span class="skolem">v</span> <span class="skolem">g</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">g</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_canon_rewriterD<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_syz_sig <span class="free">d</span> <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="main">∈</span> <span class="free">G</span>›</span></span> G_sub <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lc <span class="skolem">g</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lc_not_0<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹lc <span class="skolem">r</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lc <span class="skolem">r</span> <span class="main">/</span> lc <span class="skolem">g</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹lt <span class="skolem">g</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="skolem">v</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">g</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> lt <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹lt <span class="skolem">r</span> <span class="main">=</span> <span class="skolem">v</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> eq1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>lp <span class="skolem">r</span> <span class="main">-</span> lp <span class="skolem">g</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">g</span> <span class="main">=</span> lt <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_implies_diff adds_termE pp_of_term_splus<span class="main">)</span>

    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?h</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"monom_mult <span class="main">(</span>lc <span class="skolem">r</span> <span class="main">/</span> lc <span class="skolem">g</span><span class="main">)</span> <span class="main">(</span>lp <span class="skolem">r</span> <span class="main">-</span> lp <span class="skolem">g</span><span class="main">)</span> <span class="skolem">g</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹lc <span class="skolem">g</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹lc <span class="skolem">r</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?h</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> monom_mult_eq_zero_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> h_irred<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="free">G</span> <span class="var">?h</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="free">G</span> <span class="var">?h</span>"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹lc <span class="skolem">g</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹lc <span class="skolem">r</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lc <span class="skolem">g</span> <span class="main">/</span> lc <span class="skolem">r</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="free">G</span> <span class="main">(</span>monom_mult <span class="main">(</span>lc <span class="skolem">g</span> <span class="main">/</span> lc <span class="skolem">r</span><span class="main">)</span> <span class="main">0</span> <span class="var">?h</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_red_monom_mult<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹lc <span class="skolem">g</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹lc <span class="skolem">r</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="free">G</span> <span class="main">(</span>monom_mult <span class="main">1</span> <span class="main">(</span>pp_of_term <span class="skolem">v</span> <span class="main">-</span> lp <span class="skolem">g</span><span class="main">)</span> <span class="skolem">g</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> monom_mult_assoc <span class="quoted"><span class="quoted">‹lt <span class="skolem">r</span> <span class="main">=</span> <span class="skolem">v</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> a <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹lc <span class="skolem">r</span> <span class="main">/</span> lc <span class="skolem">g</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="var">?h</span> <span class="main">=</span> lt <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lt_monom_mult eq1<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lt <span class="var">?h</span> <span class="main">=</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹lt <span class="skolem">r</span> <span class="main">=</span> <span class="skolem">v</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹lc <span class="skolem">g</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lc <span class="var">?h</span> <span class="main">=</span> lc <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> _ <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?h</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> dgrad_sig_set_closed_monom_mult<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹lt <span class="skolem">g</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> lt <span class="skolem">r</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lp <span class="skolem">g</span> <span class="keyword1">adds</span> lp <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> adds_term_def<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">(</span>lp <span class="skolem">r</span> <span class="main">-</span> lp <span class="skolem">g</span><span class="main">)</span> <span class="main">≤</span> <span class="free">d</span> <span class="main">(</span>lp <span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dickson_grading_minus<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> dgrad_max <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dgrad_sig_setD_lp<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">(</span>lp <span class="skolem">r</span> <span class="main">-</span> lp <span class="skolem">g</span><span class="main">)</span> <span class="main">≤</span> dgrad_max <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="var">?h</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="var">?h</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?h</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹lt <span class="var">?h</span> <span class="main">=</span> <span class="skolem">v</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?h</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_syz_sig <span class="free">d</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_syz_sigI<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> is_syz_sig <span class="free">d</span> <span class="skolem">v</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="skolem">g</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rep_list_monom_mult punit.monom_mult_eq_zero_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"punit.lc <span class="main">(</span>rep_list <span class="skolem">g</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.lc_not_0<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="free">G</span> <span class="main">⊆</span> dgrad_max_set <span class="free">d</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> s_red<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="free">G</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="skolem">r</span> <span class="skolem">s</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> s_irred<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="free">G</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_irredE_dgrad_max_set<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> s_red <span class="keyword1"><span class="command">have</span></span> s_red'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sig_red <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="free">G</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="skolem">r</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_rtrancl_sing_regI<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="skolem">s</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="skolem">s</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> s_red' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sig_red_zero <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="free">G</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_zeroI<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> sig_red_zero <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="free">G</span> <span class="skolem">r</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> G_sub <span class="quoted"><span class="quoted">‹<span class="skolem">r</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>›</span></span> s_red <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dgrad_sig_set_closed_sig_red_rtrancl<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> s_red <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">s</span> <span class="main">=</span> lt <span class="skolem">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lc <span class="skolem">s</span> <span class="main">=</span> lc <span class="skolem">r</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_regular_rtrancl_lt<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> sig_red_regular_rtrancl_lc<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lt <span class="var">?h</span> <span class="main">=</span> lt <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lc <span class="var">?h</span> <span class="main">=</span> lc <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹lc <span class="skolem">r</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹lt <span class="var">?h</span> <span class="main">=</span> lt <span class="skolem">r</span>›</span></span> <span class="quoted"><span class="quoted">‹lc <span class="var">?h</span> <span class="main">=</span> lc <span class="skolem">r</span>›</span></span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> lc_monom_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> s_irred <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="free">G</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_sig_red_top_tail_cases<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹is_sig_GB_upt <span class="free">d</span> <span class="free">G</span> <span class="skolem">v</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_sig_GB_upt <span class="free">d</span> <span class="free">G</span> <span class="main">(</span>lt <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹lt <span class="skolem">s</span> <span class="main">=</span> lt <span class="skolem">r</span>›</span></span> <span class="quoted"><span class="quoted">‹lt <span class="skolem">r</span> <span class="main">=</span> <span class="skolem">v</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="var">?h</span><span class="main">)</span> <span class="main">=</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">s</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_regular_top_reduced_lt_unique<span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> eq2<span class="main">:</span> <span class="quoted"><span class="quoted">"lp <span class="skolem">r</span> <span class="main">-</span> lp <span class="skolem">g</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">g</span><span class="main">)</span> <span class="main">=</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">s</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹lc <span class="skolem">r</span> <span class="main">/</span> lc <span class="skolem">g</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹rep_list <span class="skolem">g</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rep_list_monom_mult punit.lt_monom_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.lc <span class="main">(</span>rep_list <span class="var">?h</span><span class="main">)</span> <span class="main">=</span> punit.lc <span class="main">(</span>rep_list <span class="skolem">s</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_regular_top_reduced_lc_unique<span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> eq3<span class="main">:</span> <span class="quoted"><span class="quoted">"lc <span class="skolem">r</span> <span class="main">/</span> lc <span class="skolem">g</span> <span class="main">=</span> punit.lc <span class="main">(</span>rep_list <span class="skolem">s</span><span class="main">)</span> <span class="main">/</span> punit.lc <span class="main">(</span>rep_list <span class="skolem">g</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹punit.lc <span class="main">(</span>rep_list <span class="skolem">g</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rep_list_monom_mult <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sig_red_single <span class="main">(=)</span> <span class="main">(=)</span> <span class="skolem">s</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> <span class="var">?h</span><span class="main">)</span> <span class="skolem">g</span> <span class="main">(</span>lp <span class="skolem">r</span> <span class="main">-</span> lp <span class="skolem">g</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_singleI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eq1 eq2 eq3 punit.lc_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> <span class="quoted"><span class="quoted">‹lt <span class="skolem">s</span> <span class="main">=</span> lt <span class="skolem">r</span>›</span></span>
            <span class="quoted"><span class="quoted">‹rep_list <span class="skolem">g</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹rep_list <span class="skolem">s</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> punit.lt_in_keys<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="main">∈</span> <span class="free">G</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sig_red <span class="main">(=)</span> <span class="main">(=)</span> <span class="free">G</span> <span class="skolem">s</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> <span class="var">?h</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sig_red_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sig_red <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="free">G</span> <span class="skolem">s</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> <span class="var">?h</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> sig_red_sing_regI sig_red_top_tailI<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> s_red' <span class="keyword1"><span class="command">have</span></span> r_red<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sig_red <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="free">G</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="skolem">r</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> <span class="var">?h</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">-</span> <span class="var">?h</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> <span class="var">?h</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> rep_list_zero<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> r_red <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_zeroI<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹is_sig_GB_upt <span class="free">d</span> <span class="free">G</span> <span class="main">(</span>lt <span class="skolem">s</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?h</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">-</span> <span class="var">?h</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dgrad_sig_set_closed_minus<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> False <span class="quoted"><span class="quoted">‹lt <span class="var">?h</span> <span class="main">=</span> lt <span class="skolem">s</span>›</span></span> <span class="quoted"><span class="quoted">‹lc <span class="var">?h</span> <span class="main">=</span> lc <span class="skolem">s</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> <span class="var">?h</span><span class="main">)</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lt_minus_lessI<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sig_red_zero <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="free">G</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> <span class="var">?h</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_GB_uptD3<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sig_red <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="free">G</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> <span class="var">?h</span><span class="main">)</span> <span class="skolem">s'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="skolem">s'</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_zeroE<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> r_red this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sig_red <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="free">G</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="skolem">r</span> <span class="skolem">s'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹rep_list <span class="skolem">s'</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_zeroI<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> sig_red_zero <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="free">G</span> <span class="skolem">r</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> is_RB_upt_is_syz_sigD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dickson_grading <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_RB_upt <span class="free">d</span> <span class="free">rword</span> <span class="free">G</span> <span class="free">u</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_syz_sig <span class="free">d</span> <span class="free">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lt <span class="free">p</span> <span class="main">=</span> <span class="free">u</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sig_red_zero <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="free">G</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">note</span></span> assms<span class="main">(</span>1<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">,</span> 2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_sig_GB_upt <span class="free">d</span> <span class="free">G</span> <span class="free">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_RB_upt_is_sig_GB_upt<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">,</span> 4<span class="main">,</span> 5<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> syzygy_crit<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹S-Pairs›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">spair</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">spair</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">t1</span> <span class="main">=</span> punit.lt <span class="main">(</span>rep_list <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">;</span> <span class="bound">t2</span> <span class="main">=</span> punit.lt <span class="main">(</span>rep_list <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span><span class="main">;</span> <span class="bound">l</span> <span class="main">=</span> lcs <span class="bound">t1</span> <span class="bound">t2</span> <span class="keyword1">in</span>
                        <span class="main">(</span>monom_mult <span class="main">(</span><span class="main">1</span> <span class="main">/</span> punit.lc <span class="main">(</span>rep_list <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="bound">t1</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">-</span>
                        <span class="main">(</span>monom_mult <span class="main">(</span><span class="main">1</span> <span class="main">/</span> punit.lc <span class="main">(</span>rep_list <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="bound">t2</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_regular_spair</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_regular_spair</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">⟷</span>
                    <span class="main">(</span>rep_list <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> rep_list <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span>
                      <span class="main">(</span><span class="keyword1">let</span> <span class="bound">t1</span> <span class="main">=</span> punit.lt <span class="main">(</span>rep_list <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">;</span> <span class="bound">t2</span> <span class="main">=</span> punit.lt <span class="main">(</span>rep_list <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span><span class="main">;</span> <span class="bound">l</span> <span class="main">=</span> lcs <span class="bound">t1</span> <span class="bound">t2</span> <span class="keyword1">in</span>
                        <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="bound">t1</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≠</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="bound">t2</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Signature_Groebner-rep_list_spair"><span class="command">lemma</span></span> rep_list_spair<span class="main">:</span> <span class="quoted"><span class="quoted">"rep_list <span class="main">(</span>spair <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> punit.spoly <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> spair_def punit.spoly_def Let_def rep_list_minus rep_list_monom_mult punit.lc_def<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-spair_comm"><span class="command">lemma</span></span> spair_comm<span class="main">:</span> <span class="quoted"><span class="quoted">"spair <span class="free">p</span> <span class="free">q</span> <span class="main">=</span> <span class="main">-</span> spair <span class="free">q</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> spair_def Let_def lcs_comm<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-dgrad_sig_set_closed_spair"><span class="command">lemma</span></span> dgrad_sig_set_closed_spair<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dickson_grading <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"spair <span class="free">p</span> <span class="free">q</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">t1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t1</span> <span class="main">=</span> punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">t2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t2</span> <span class="main">=</span> punit.lt <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"lcs <span class="skolem">t1</span> <span class="skolem">t2</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="skolem">t1</span> <span class="main">≤</span> dgrad_max <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"rep_list <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> t1_def True dgrad_max_0<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> dgrad_max_set <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dgrad_sig_set'_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">p</span> <span class="main">∈</span> punit_dgrad_max_set <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dgrad_max_2<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> t1_def <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.dgrad_p_setD_lp<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="skolem">t2</span> <span class="main">≤</span> dgrad_max <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"rep_list <span class="free">q</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> t2_def True dgrad_max_0<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> dgrad_max_set <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dgrad_sig_set'_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">q</span> <span class="main">∈</span> punit_dgrad_max_set <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dgrad_max_2<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> t2_def <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.dgrad_p_setD_lp<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ord_class.max <span class="main">(</span><span class="free">d</span> <span class="skolem">t1</span><span class="main">)</span> <span class="main">(</span><span class="free">d</span> <span class="skolem">t2</span><span class="main">)</span> <span class="main">≤</span> dgrad_max <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="var">?l</span> <span class="main">≤</span> ord_class.max <span class="main">(</span><span class="free">d</span> <span class="skolem">t1</span><span class="main">)</span> <span class="main">(</span><span class="free">d</span> <span class="skolem">t2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dickson_grading_lcs<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="var">?l</span> <span class="main">≤</span> dgrad_max <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">thm</span></span> dickson_grading_minus
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> spair_def Let_def t1_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> t2_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
      <span class="operator">intro</span> dgrad_sig_set_closed_minus dgrad_sig_set_closed_monom_mult<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> adds_lcs <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">(</span><span class="var">?l</span> <span class="main">-</span> <span class="skolem">t1</span><span class="main">)</span> <span class="main">≤</span> <span class="free">d</span> <span class="var">?l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dickson_grading_minus<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">(</span><span class="var">?l</span> <span class="main">-</span> <span class="skolem">t1</span><span class="main">)</span> <span class="main">≤</span> dgrad_max <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> le_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> adds_lcs_2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">(</span><span class="var">?l</span> <span class="main">-</span> <span class="skolem">t2</span><span class="main">)</span> <span class="main">≤</span> <span class="free">d</span> <span class="var">?l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dickson_grading_minus<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">(</span><span class="var">?l</span> <span class="main">-</span> <span class="skolem">t2</span><span class="main">)</span> <span class="main">≤</span> dgrad_max <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> le_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-lt_spair"><span class="command">lemma</span></span> lt_spair<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">q</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> punit.lt <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span>spair <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>lcs <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">=</span> lcs <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="keyword1">adds</span> <span class="skolem">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span> <span class="keyword1">adds</span> <span class="skolem">l</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> l_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> adds_lcs<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> adds_lcs_2<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> eq1<span class="main">:</span> <span class="quoted"><span class="quoted">"spair <span class="free">p</span> <span class="free">q</span> <span class="main">=</span> <span class="main">(</span>monom_mult <span class="main">(</span><span class="main">1</span> <span class="main">/</span> punit.lc <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">l</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="free">p</span><span class="main">)</span> <span class="main">+</span>
                         <span class="main">(</span>monom_mult <span class="main">(</span><span class="main">-</span> <span class="main">1</span> <span class="main">/</span> punit.lc <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">l</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="free">q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> spair_def Let_def l_def monom_mult_uminus_left<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.lc <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.lc_not_0<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">/</span> punit.lc <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rep_list_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> eq2<span class="main">:</span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span>monom_mult <span class="main">(</span><span class="main">1</span> <span class="main">/</span> punit.lc <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">l</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span>
                        <span class="main">(</span><span class="skolem">l</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lt_monom_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span>monom_mult <span class="main">(</span><span class="main">-</span> <span class="main">1</span> <span class="main">/</span> punit.lc <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">l</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="free">q</span><span class="main">)</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span>
                        <span class="main">(</span><span class="skolem">l</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> lt_monom_mult_le<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="main">(</span><span class="skolem">l</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> term_is_le_rel_minus_minus<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ 2 1<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> eq2<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> eq1 l_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lt_plus_eqI_2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-lt_spair'"><span class="command">lemma</span></span> lt_spair'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">⊕</span> lt <span class="free">q</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free">a</span> <span class="main">⊕</span> lt <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span>spair <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span> <span class="main">-</span> gcs <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span><span class="free">b</span> <span class="main">⊕</span> lt <span class="free">q</span><span class="main">)</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span><span class="free">a</span> <span class="main">⊕</span> lt <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> splus_mono_strict<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">b</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">q</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="main">(</span><span class="free">b</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> splus_assoc<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> add.commute assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">q</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> punit.lt <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> splus_assoc ord_term_strict_canc<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span>spair <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>lcs <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lt_spair<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lcs_minus_1<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-lt_rep_list_spair"><span class="command">lemma</span></span> lt_rep_list_spair<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="main">(</span>spair <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="main">(</span>spair <span class="free">p</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">≺</span></span> <span class="main">(</span><span class="free">a</span> <span class="main">-</span> gcs <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.lc <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.lc_not_0<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.lc <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.lc_not_0<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">=</span> lcs <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"rep_list <span class="main">(</span>spair <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>punit.monom_mult <span class="main">(</span><span class="main">1</span> <span class="main">/</span> punit.lc <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">l</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
                               <span class="main">(</span>punit.monom_mult <span class="main">(</span><span class="main">-</span> <span class="main">1</span> <span class="main">/</span> punit.lc <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">l</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?a</span> <span class="main">+</span> <span class="var">?b</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> spair_def Let_def rep_list_minus rep_list_monom_mult punit.monom_mult_uminus_left l_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a</span> <span class="main">+</span> <span class="var">?b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> eq<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> 1 2 assms<span class="main">(</span>1<span class="main">,</span> 2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="var">?b</span> <span class="main">=</span> punit.lt <span class="var">?a</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lp_monom_mult l_def minus_plus adds_lcs adds_lcs_2<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.lc <span class="var">?b</span> <span class="main">=</span> <span class="main">-</span> punit.lc <span class="var">?a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> 1 2<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="main">(</span>spair <span class="free">p</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">≺</span></span> punit.lt <span class="var">?a</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> eq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.lt_plus_lessI<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> 1 assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">l</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lp_monom_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> l_def minus_plus adds_lcs<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> gcs <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> l_def <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lcs_alt_1<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span> <span class="main">-</span> gcs <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> minus_plus gcs_adds<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-is_regular_spair_sym"><span class="command">lemma</span></span> is_regular_spair_sym<span class="main">:</span> <span class="quoted"><span class="quoted">"is_regular_spair <span class="free">p</span> <span class="free">q</span> <span class="main">⟹</span> is_regular_spair <span class="free">q</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_regular_spair_def Let_def lcs_comm<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-is_regular_spairI"><span class="command">lemma</span></span> is_regular_spairI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">p</span> <span class="main">≠</span> punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_regular_spair <span class="free">p</span> <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>lcs <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">p</span> <span class="main">≠</span>
           <span class="main">(</span>lcs <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">q</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">≠</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">p</span> <span class="main">=</span> punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">q</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> term_is_le_rel_minus_minus adds_lcs adds_lcs_2<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">,</span> 2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_regular_spair_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-is_regular_spairI'"><span class="command">lemma</span></span> is_regular_spairI'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">⊕</span> lt <span class="free">p</span> <span class="main">≠</span> <span class="free">b</span> <span class="main">⊕</span> lt <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_regular_spair <span class="free">p</span> <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">p</span> <span class="main">≠</span> punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">p</span> <span class="main">=</span> punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">⊕</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span> <span class="main">⊕</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">p</span> <span class="main">=</span> <span class="main">(</span><span class="free">b</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">q</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> splus_assoc<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span><span class="free">a</span> <span class="main">⊕</span> lt <span class="free">p</span><span class="main">)</span> <span class="main">=</span> punit.lt <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span><span class="free">b</span> <span class="main">⊕</span> lt <span class="free">q</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> add.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span> splus_assoc<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">⊕</span> lt <span class="free">p</span> <span class="main">=</span> <span class="free">b</span> <span class="main">⊕</span> lt <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> splus_left_canc<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">,</span> 2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_regular_spairI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-is_regular_spairD1"><span class="command">lemma</span></span> is_regular_spairD1<span class="main">:</span> <span class="quoted"><span class="quoted">"is_regular_spair <span class="free">p</span> <span class="free">q</span> <span class="main">⟹</span> rep_list <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_regular_spair_def<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-is_regular_spairD2"><span class="command">lemma</span></span> is_regular_spairD2<span class="main">:</span> <span class="quoted"><span class="quoted">"is_regular_spair <span class="free">p</span> <span class="free">q</span> <span class="main">⟹</span> rep_list <span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_regular_spair_def<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-is_regular_spairD3"><span class="command">lemma</span></span> is_regular_spairD3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">t1</span> <span class="main">≡</span> punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">≡</span> punit.lt <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_regular_spair <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">⊕</span> lt <span class="free">p</span> <span class="main">≠</span> <span class="free">t1</span> <span class="main">⊕</span> lt <span class="free">q</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?thesis1</span></span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span>monom_mult <span class="main">(</span><span class="main">1</span> <span class="main">/</span> punit.lc <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>lcs <span class="free">t1</span> <span class="free">t2</span> <span class="main">-</span> <span class="free">t1</span><span class="main">)</span> <span class="free">p</span><span class="main">)</span> <span class="main">≠</span>
         lt <span class="main">(</span>monom_mult <span class="main">(</span><span class="main">1</span> <span class="main">/</span> punit.lc <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>lcs <span class="free">t1</span> <span class="free">t2</span> <span class="main">-</span> <span class="free">t2</span><span class="main">)</span> <span class="free">q</span><span class="main">)</span>"</span></span>  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">≠</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_regular_spairD1<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"punit.lc <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rep_list_zero punit.lc_eq_zero_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_regular_spairD2<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"punit.lc <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rep_list_zero punit.lc_eq_zero_iff<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="main">(</span>lcs <span class="free">t1</span> <span class="free">t2</span> <span class="main">-</span> <span class="free">t1</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹punit.lc <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lt_monom_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≠</span> <span class="main">(</span>lcs <span class="free">t1</span> <span class="free">t2</span> <span class="main">-</span> <span class="free">t2</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_regular_spair_def t1_def t2_def Let_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>lcs <span class="free">t1</span> <span class="free">t2</span> <span class="main">-</span> <span class="free">t2</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">q</span> <span class="main">=</span> <span class="var">?r</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹punit.lc <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lt_monom_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">≠</span> <span class="var">?r</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis1</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">t2</span> <span class="main">⊕</span> lt <span class="free">p</span> <span class="main">=</span> <span class="free">t1</span> <span class="main">⊕</span> lt <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>lcs <span class="free">t1</span> <span class="free">t2</span> <span class="main">-</span> <span class="free">t1</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">p</span> <span class="main">=</span> <span class="main">(</span>lcs <span class="free">t1</span> <span class="free">t2</span> <span class="main">-</span> <span class="free">t2</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">q</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> term_is_le_rel_minus_minus adds_lcs adds_lcs_2<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> * <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-is_regular_spair_nonzero"><span class="command">lemma</span></span> is_regular_spair_nonzero<span class="main">:</span> <span class="quoted"><span class="quoted">"is_regular_spair <span class="free">p</span> <span class="free">q</span> <span class="main">⟹</span> spair <span class="free">p</span> <span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> spair_def Let_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> is_regular_spairD3<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-is_regular_spair_lt"><span class="command">lemma</span></span> is_regular_spair_lt<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_regular_spair <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span>spair <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> ord_term_lin.max
              <span class="main">(</span><span class="main">(</span>lcs <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">p</span><span class="main">)</span>
              <span class="main">(</span><span class="main">(</span>lcs <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"lcs <span class="var">?t1</span> <span class="var">?t2</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ord_term_lin.linorder_cases<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?t2</span> <span class="main">⊕</span> lt <span class="free">p</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="var">?t1</span> <span class="main">⊕</span> lt <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?l</span> <span class="main">-</span> <span class="var">?t1</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">p</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="main">(</span><span class="var">?l</span> <span class="main">-</span> <span class="var">?t2</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">q</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> term_is_le_rel_minus_minus adds_lcs adds_lcs_2<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?l</span> <span class="main">-</span> <span class="var">?t1</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">p</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="main">(</span><span class="var">?l</span> <span class="main">-</span> <span class="var">?t2</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ord_term_lin.less_imp_le<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_regular_spairD2<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span>spair <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> lt <span class="main">(</span>spair <span class="free">q</span> <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> spair_comm<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹rep_list <span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> a <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>lcs <span class="var">?t2</span> <span class="var">?t1</span> <span class="main">-</span> <span class="var">?t2</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lt_spair<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="var">?l</span> <span class="main">-</span> <span class="var">?t2</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> lcs_comm<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> le <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ord_term_lin.max_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?t1</span> <span class="main">⊕</span> lt <span class="free">q</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="var">?t2</span> <span class="main">⊕</span> lt <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?l</span> <span class="main">-</span> <span class="var">?t2</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">q</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="main">(</span><span class="var">?l</span> <span class="main">-</span> <span class="var">?t1</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">p</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> term_is_le_rel_minus_minus adds_lcs adds_lcs_2<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">(</span><span class="var">?l</span> <span class="main">-</span> <span class="var">?t1</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">p</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="main">(</span><span class="var">?l</span> <span class="main">-</span> <span class="var">?t2</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_regular_spairD1<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span>spair <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>lcs <span class="var">?t1</span> <span class="var">?t2</span> <span class="main">-</span> <span class="var">?t1</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lt_spair<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> le <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ord_term_lin.max_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?t2</span> <span class="main">⊕</span> lt <span class="free">p</span> <span class="main">≠</span> <span class="var">?t1</span> <span class="main">⊕</span> lt <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_regular_spairD3<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?t2</span> <span class="main">⊕</span> lt <span class="free">p</span> <span class="main">=</span> <span class="var">?t1</span> <span class="main">⊕</span> lt <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-is_regular_spair_lt_ge_1"><span class="command">lemma</span></span> is_regular_spair_lt_ge_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_regular_spair <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lt <span class="free">p</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="main">(</span>spair <span class="free">p</span> <span class="free">q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="free">p</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⊕</span> lt <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">term_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> zero_min <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="main">(</span>lcs <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> splus_mono_left<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> ord_term_lin.max
              <span class="main">(</span><span class="main">(</span>lcs <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">p</span><span class="main">)</span>
              <span class="main">(</span><span class="main">(</span>lcs <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ord_term_lin.max.cobounded1<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> lt <span class="main">(</span>spair <span class="free">p</span> <span class="free">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> is_regular_spair_lt<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> is_regular_spair_lt_ge_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_regular_spair <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lt <span class="free">q</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="main">(</span>spair <span class="free">p</span> <span class="free">q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_regular_spair <span class="free">q</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_regular_spair_sym<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lt <span class="free">q</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="main">(</span>spair <span class="free">q</span> <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_regular_spair_lt_ge_1<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> lt <span class="main">(</span>spair <span class="free">p</span> <span class="free">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> spair_comm<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">q</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-is_regular_spair_component_lt_cases"><span class="command">lemma</span></span> is_regular_spair_component_lt_cases<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_regular_spair <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"component_of_term <span class="main">(</span>lt <span class="main">(</span>spair <span class="free">p</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> component_of_term <span class="main">(</span>lt <span class="free">p</span><span class="main">)</span> <span class="main">∨</span>
          component_of_term <span class="main">(</span>lt <span class="main">(</span>spair <span class="free">p</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> component_of_term <span class="main">(</span>lt <span class="free">q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ord_term_lin.linorder_cases<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_regular_spairD2<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">p</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span>spair <span class="free">q</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>lcs <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lt_spair<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> spair_comm<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main"><span class="main">]</span></span> <span class="dynamic"><span class="dynamic">term_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_regular_spairD1<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">q</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> punit.lt <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span>spair <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>lcs <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lt_spair<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">term_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">p</span> <span class="main">≠</span> punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_regular_spairD3<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">p</span> <span class="main">=</span> punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-lemma_9"><span class="command">lemma</span></span> lemma_9<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dickson_grading <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_rewrite_ord <span class="free">rword</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_RB_upt <span class="free">d</span> <span class="free">rword</span> <span class="free">G</span> <span class="free">u</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"inj_on lt <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_syz_sig <span class="free">d</span> <span class="free">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_canon_rewriter <span class="free">rword</span> <span class="free">G</span> <span class="free">u</span> <span class="free">g1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">∈</span> <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="main">{</span><span class="free">h</span><span class="main">}</span> <span class="main">(</span>monom_mult <span class="main">1</span> <span class="main">(</span>pp_of_term <span class="free">u</span> <span class="main">-</span> lp <span class="free">g1</span><span class="main">)</span> <span class="free">g1</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">(</span>pp_of_term <span class="free">u</span><span class="main">)</span> <span class="main">≤</span> dgrad_max <span class="free">d</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lcs <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">g1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">h</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="free">g1</span><span class="main">)</span> <span class="main">=</span>
            pp_of_term <span class="free">u</span> <span class="main">-</span> lp <span class="free">g1</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?thesis1</span></span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lcs <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">g1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">h</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="free">h</span><span class="main">)</span> <span class="main">=</span>
            <span class="main">(</span><span class="main">(</span>pp_of_term <span class="free">u</span> <span class="main">-</span> lp <span class="free">g1</span><span class="main">)</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="free">g1</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="free">h</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?thesis2</span></span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_regular_spair <span class="free">g1</span> <span class="free">h</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?thesis3</span></span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span>spair <span class="free">g1</span> <span class="free">h</span><span class="main">)</span> <span class="main">=</span> <span class="free">u</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?thesis4</span></span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>8<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="main">(</span>monom_mult <span class="main">1</span> <span class="main">(</span>pp_of_term <span class="free">u</span> <span class="main">-</span> lp <span class="free">g1</span><span class="main">)</span> <span class="free">g1</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> is_sig_red_top_addsE <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">g1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rep_list_monom_mult punit.monom_mult_eq_zero_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rep_list_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>6<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lt <span class="free">g1</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_canon_rewriterD<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">⊆</span> dgrad_sig_set <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_RB_uptD1<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">g1</span> <span class="main">∈</span> <span class="free">G</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"component_of_term <span class="main">(</span>lt <span class="free">g1</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="free">fs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">g1</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dgrad_sig_setD_lt<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹lt <span class="free">g1</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">u</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"component_of_term <span class="free">u</span> <span class="main">&lt;</span> length <span class="free">fs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> adds_term_def<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹lt <span class="free">g1</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">u</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">⊕</span> lt <span class="free">g1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> adds_termE<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> pp_of_term <span class="free">u</span> <span class="main">-</span> lp <span class="free">g1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">term_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>8<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="main">{</span><span class="free">h</span><span class="main">}</span> <span class="main">(</span>monom_mult <span class="main">1</span> <span class="skolem">a</span> <span class="free">g1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> a<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">h</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="main">(</span>monom_mult <span class="main">1</span> <span class="skolem">a</span> <span class="free">g1</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      2<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">h</span><span class="main">)</span> <span class="keyword1">adds</span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span>monom_mult <span class="main">1</span> <span class="skolem">a</span> <span class="free">g1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      3<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="main">(</span>monom_mult <span class="main">1</span> <span class="skolem">a</span> <span class="free">g1</span><span class="main">)</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">h</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> punit.lt <span class="main">(</span>rep_list <span class="free">h</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="main">(</span>monom_mult <span class="main">1</span> <span class="skolem">a</span> <span class="free">g1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> is_sig_red_top_addsE<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">g1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rep_list_monom_mult punit.monom_mult_eq_zero_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rep_list_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹rep_list <span class="free">h</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rep_list_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 2 <span class="quoted"><span class="quoted">‹rep_list <span class="free">g1</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">h</span><span class="main">)</span> <span class="keyword1">adds</span> <span class="skolem">a</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="free">g1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rep_list_monom_mult punit.lt_monom_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> eq1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="free">g1</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">b</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="free">h</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> addsE <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> add.commute<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>pp_of_term <span class="free">u</span> <span class="main">-</span> lp <span class="free">g1</span><span class="main">)</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="free">g1</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="free">h</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a<span class="main">)</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> gcs <span class="skolem">a</span> <span class="skolem">b</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="keyword1">adds</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> gcs_adds<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>p</sub></span> <span class="free">u</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> u <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> adds_pp_triv<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> u2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">=</span> <span class="skolem">g</span> <span class="main">⊕</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> adds_ppE<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="free">u</span> <span class="main">⊖</span> <span class="skolem">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">term_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> u2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> adds_termI<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ord_adds_term<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">≠</span> <span class="free">u</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="free">u</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">⊕</span> <span class="skolem">v</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⊕</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> u2 <span class="dynamic"><span class="dynamic">term_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> splus_right_canc<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">note</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free">u</span>›</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">(</span>pp_of_term <span class="skolem">v</span><span class="main">)</span> <span class="main">≤</span> dgrad_max <span class="free">d</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> le_trans<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">(</span>pp_of_term <span class="skolem">v</span><span class="main">)</span> <span class="main">≤</span> <span class="free">d</span> <span class="main">(</span>pp_of_term <span class="free">u</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> u2 <span class="dynamic"><span class="dynamic">term_simps</span></span> dickson_gradingD1<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹component_of_term <span class="free">u</span> <span class="main">&lt;</span> length <span class="free">fs</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"component_of_term <span class="skolem">v</span> <span class="main">&lt;</span> length <span class="free">fs</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> v <span class="dynamic"><span class="dynamic">term_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_RB_in <span class="free">d</span> <span class="free">rword</span> <span class="free">G</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_RB_uptD2<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> is_RB_inE<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_syz_sig <span class="free">d</span> <span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_syz_sig <span class="free">d</span> <span class="free">u</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">u</span>›</span></span> assms<span class="main">(</span>9<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_syz_sig_adds<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>5<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">g2</span>
      <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="free">G</span> <span class="main">(</span>monom_mult <span class="main">1</span> <span class="main">(</span>pp_of_term <span class="skolem">v</span> <span class="main">-</span> lp <span class="skolem">g2</span><span class="main">)</span> <span class="skolem">g2</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_canon_rewriter <span class="free">rword</span> <span class="free">G</span> <span class="skolem">v</span> <span class="skolem">g2</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g2</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g2</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">g2</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_canon_rewriterD<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_syz_sig <span class="free">d</span> <span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command">note</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">‹is_canon_rewriter <span class="free">rword</span> <span class="free">G</span> <span class="skolem">v</span> <span class="skolem">g2</span>›</span></span> assms<span class="main">(</span>6<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹lt <span class="skolem">g2</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="skolem">v</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">u</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">g2</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> adds_term_trans<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="keyword1">adds</span> <span class="skolem">a</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="free">g1</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> v u minus_splus<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> adds_termI<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">g2</span> <span class="main">=</span> lt <span class="free">g1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_rewrite_ord_canon_rewriterD1<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g2</span> <span class="main">=</span> <span class="free">g1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g2</span> <span class="main">∈</span> <span class="free">G</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">g1</span> <span class="main">∈</span> <span class="free">G</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> inj_onD<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pp_of_term <span class="skolem">v</span> <span class="main">-</span> lp <span class="free">g1</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">-</span> <span class="skolem">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> u v <span class="dynamic"><span class="dynamic">term_simps</span></span> diff_diff_add<span class="main">)</span>
  
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="free">G</span> <span class="main">(</span>monom_mult <span class="main">1</span> <span class="main">(</span>pp_of_term <span class="skolem">v</span> <span class="main">-</span> lp <span class="skolem">g2</span><span class="main">)</span> <span class="skolem">g2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g2</span> <span class="main">=</span> <span class="free">g1</span>›</span></span> <span class="quoted"><span class="quoted">‹pp_of_term <span class="skolem">v</span> <span class="main">-</span> lp <span class="free">g1</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">-</span> <span class="skolem">g</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>7<span class="main">)</span> <span class="quoted"><span class="quoted">‹rep_list <span class="free">h</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_red_top_addsI<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹rep_list <span class="free">g1</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="main">(</span>monom_mult <span class="main">1</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">-</span> <span class="skolem">g</span><span class="main">)</span> <span class="free">g1</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rep_list_monom_mult punit.monom_mult_eq_zero_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword1"><span class="command">have</span></span> eq3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span> <span class="main">-</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="free">g1</span><span class="main">)</span> <span class="main">=</span> lcs <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">g1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">h</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> g_def lcs_minus_1<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eq1<span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> adds_minus adds_lcs<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹rep_list <span class="free">g1</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">h</span><span class="main">)</span> <span class="keyword1">adds</span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span>monom_mult <span class="main">1</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">-</span> <span class="skolem">g</span><span class="main">)</span> <span class="free">g1</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rep_list_monom_mult punit.lt_monom_mult eq3 adds_lcs_2<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword1"><span class="command">from</span></span> 3 <span class="quoted"><span class="quoted">‹rep_list <span class="free">g1</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">g1</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="main">(</span>monom_mult <span class="main">1</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">-</span> <span class="skolem">g</span><span class="main">)</span> <span class="free">g1</span><span class="main">)</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">h</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span>
              punit.lt <span class="main">(</span>rep_list <span class="free">h</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="main">(</span>monom_mult <span class="main">1</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">-</span> <span class="skolem">g</span><span class="main">)</span> <span class="free">g1</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rep_list_monom_mult punit.lt_monom_mult lt_monom_mult splus_assoc splus_left_commute
                <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> ord_term_strict_canc <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> splus_mono_strict<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ord_term_lin.is_le_rel <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> ord_term_lin.is_le_relI<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">with</span></span> * <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis1</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?thesis2</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a b lcs_minus_1<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eq1<span class="main"><span class="main">]</span></span> lcs_minus_2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eq1<span class="main"><span class="main">]</span></span> g_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> eq3<span class="main">:</span> <span class="quoted"><span class="quoted">"spair <span class="free">g1</span> <span class="free">h</span> <span class="main">=</span> monom_mult <span class="main">(</span><span class="main">1</span> <span class="main">/</span> punit.lc <span class="main">(</span>rep_list <span class="free">g1</span><span class="main">)</span><span class="main">)</span> <span class="skolem">a</span> <span class="free">g1</span> <span class="main">-</span>
                            monom_mult <span class="main">(</span><span class="main">1</span> <span class="main">/</span> punit.lc <span class="main">(</span>rep_list <span class="free">h</span><span class="main">)</span><span class="main">)</span> <span class="skolem">b</span> <span class="free">h</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> spair_def Let_def a b<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> 3 <span class="quoted"><span class="quoted">‹rep_list <span class="free">g1</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">g1</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">⊕</span> lt <span class="free">h</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="skolem">a</span> <span class="main">⊕</span> lt <span class="free">g1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rep_list_monom_mult punit.lt_monom_mult lt_monom_mult eq1 splus_assoc
        splus_left_commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">b</span></span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> ord_term_strict_canc<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">⊕</span> lt <span class="free">g1</span> <span class="main">≠</span> <span class="skolem">b</span> <span class="main">⊕</span> lt <span class="free">h</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹rep_list <span class="free">g1</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹rep_list <span class="free">h</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> eq1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis3</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_regular_spairI'<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span>monom_mult <span class="main">(</span><span class="main">1</span> <span class="main">/</span> punit.lc <span class="main">(</span>rep_list <span class="free">h</span><span class="main">)</span><span class="main">)</span> <span class="skolem">b</span> <span class="free">h</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">b</span> <span class="main">⊕</span> lt <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> lt_monom_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹rep_list <span class="free">h</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">/</span> punit.lc <span class="main">(</span>rep_list <span class="free">h</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> punit.lc_eq_zero_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="skolem">a</span> <span class="main">⊕</span> lt <span class="free">g1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> lt <span class="main">(</span>monom_mult <span class="main">(</span><span class="main">1</span> <span class="main">/</span> punit.lc <span class="main">(</span>rep_list <span class="free">g1</span><span class="main">)</span><span class="main">)</span> <span class="skolem">a</span> <span class="free">g1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> HOL.sym<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> lt_monom_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹rep_list <span class="free">g1</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">/</span> punit.lc <span class="main">(</span>rep_list <span class="free">g1</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> punit.lc_eq_zero_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span>spair <span class="free">g1</span> <span class="free">h</span><span class="main">)</span> <span class="main">=</span> lt <span class="main">(</span>monom_mult <span class="main">(</span><span class="main">1</span> <span class="main">/</span> punit.lc <span class="main">(</span>rep_list <span class="free">g1</span><span class="main">)</span><span class="main">)</span> <span class="skolem">a</span> <span class="free">g1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> eq3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lt_minus_eqI_2<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">⊕</span> lt <span class="free">g1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> HOL.sym<span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis4</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> u<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-is_RB_upt_finite"><span class="command">lemma</span></span> is_RB_upt_finite<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dickson_grading <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_rewrite_ord <span class="free">rword</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">⊆</span> dgrad_sig_set <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"inj_on lt <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">g1</span> <span class="bound">g2</span><span class="main">.</span> <span class="bound">g1</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> <span class="bound">g2</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> is_regular_spair <span class="bound">g1</span> <span class="bound">g2</span> <span class="main">⟹</span> lt <span class="main">(</span>spair <span class="bound">g1</span> <span class="bound">g2</span><span class="main">)</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free">u</span> <span class="main">⟹</span>
              is_RB_in <span class="free">d</span> <span class="free">rword</span> <span class="free">G</span> <span class="main">(</span>lt <span class="main">(</span>spair <span class="bound">g1</span> <span class="bound">g2</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="free">fs</span> <span class="main">⟹</span> <span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free">u</span> <span class="main">⟹</span> is_RB_in <span class="free">d</span> <span class="free">rword</span> <span class="free">G</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_RB_upt <span class="free">d</span> <span class="free">rword</span> <span class="free">G</span> <span class="free">u</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Q</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free">u</span> <span class="main">∧</span> <span class="free">d</span> <span class="main">(</span>pp_of_term <span class="bound">v</span><span class="main">)</span> <span class="main">≤</span> dgrad_max <span class="free">d</span> <span class="main">∧</span> component_of_term <span class="bound">v</span> <span class="main">&lt;</span> length <span class="free">fs</span> <span class="main">∧</span> <span class="main">¬</span> is_RB_in <span class="free">d</span> <span class="free">rword</span> <span class="free">G</span> <span class="bound">v</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> Q_sub<span class="main">:</span> <span class="quoted"><span class="quoted">"pp_of_term <span class="main">`</span> <span class="var">?Q</span> <span class="main">⊆</span> dgrad_set <span class="free">d</span> <span class="main">(</span>dgrad_max <span class="free">d</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">⊆</span> dgrad_max_set <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dgrad_sig_set'_def<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_RB_upt <span class="free">d</span> <span class="free">rword</span> <span class="free">G</span> <span class="free">u</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v'</span> <span class="main">∈</span> <span class="var">?Q</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_RB_upt_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="var">?Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> min<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="skolem">v</span> <span class="main">⟹</span> <span class="bound">y</span> <span class="main">∉</span> <span class="var">?Q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Q_sub
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ord_term_minimum_dgrad_set<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> <span class="var">?Q</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">(</span>pp_of_term <span class="skolem">v</span><span class="main">)</span> <span class="main">≤</span> dgrad_max <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"component_of_term <span class="skolem">v</span> <span class="main">&lt;</span> length <span class="free">fs</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_RB_in <span class="free">d</span> <span class="free">rword</span> <span class="free">G</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>4<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> impl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">g</span><span class="main">.</span> <span class="bound">g</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> is_canon_rewriter <span class="free">rword</span> <span class="free">G</span> <span class="skolem">v</span> <span class="bound">g</span> <span class="main">⟹</span>
                    is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="free">G</span> <span class="main">(</span>monom_mult <span class="main">1</span> <span class="main">(</span>pp_of_term <span class="skolem">v</span> <span class="main">-</span> lp <span class="bound">g</span><span class="main">)</span> <span class="bound">g</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_syz_sig <span class="free">d</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_RB_in_def Let_def<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_RB_upt <span class="free">d</span> <span class="free">rword</span> <span class="free">G</span> <span class="skolem">v</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> is_RB_uptI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">w</span>
    <span class="keyword3"><span class="command">assume</span></span> dw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">(</span>pp_of_term <span class="skolem">w</span><span class="main">)</span> <span class="main">≤</span> dgrad_max <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> cp<span class="main">:</span> <span class="quoted"><span class="quoted">"component_of_term <span class="skolem">w</span> <span class="main">&lt;</span> length <span class="free">fs</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∉</span> <span class="var">?Q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> min<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">w</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free">u</span> <span class="main">∨</span> is_RB_in <span class="free">d</span> <span class="free">rword</span> <span class="free">G</span> <span class="skolem">w</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dw cp<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"is_RB_in <span class="free">d</span> <span class="free">rword</span> <span class="free">G</span> <span class="skolem">w</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">w</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free">u</span>"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">w</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="skolem">v</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free">u</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ord_term_lin.less_trans<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">g</span><span class="main">∈</span><span class="free">G</span><span class="main">.</span> <span class="bound">g</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> lt <span class="bound">g</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="skolem">v</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">g</span><span class="main">.</span> <span class="bound">g</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> lt <span class="bound">g</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="skolem">v</span> <span class="main">⟹</span> <span class="bound">g</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?w</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> component_of_term <span class="skolem">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?w</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> adds_term_def <span class="dynamic"><span class="dynamic">term_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?w</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ord_adds_term<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?w</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free">u</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹component_of_term <span class="skolem">v</span> <span class="main">&lt;</span> length <span class="free">fs</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_RB_in <span class="free">d</span> <span class="free">rword</span> <span class="free">G</span> <span class="var">?w</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> is_RB_inE<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_syz_sig <span class="free">d</span> <span class="var">?w</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_syz_sig <span class="free">d</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?w</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="skolem">v</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">d</span> <span class="main">(</span>pp_of_term <span class="skolem">v</span><span class="main">)</span> <span class="main">≤</span> dgrad_max <span class="free">d</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_syz_sig_adds<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> is_syz_sig <span class="free">d</span> <span class="skolem">v</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">g1</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_canon_rewriter <span class="free">rword</span> <span class="free">G</span> <span class="var">?w</span> <span class="skolem">g1</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g1</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">g1</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="var">?w</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_canon_rewriterD<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">g1</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?w</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="skolem">v</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> adds_term_trans<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g1</span> <span class="main">∈</span> <span class="free">G</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g1</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> x<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g1</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g'</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">g'</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">,</span> 5<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g1</span></span> <span class="keyword2"><span class="keyword">where</span></span> crw<span class="main">:</span> <span class="quoted"><span class="quoted">"is_canon_rewriter <span class="free">rword</span> <span class="free">G</span> <span class="skolem">v</span> <span class="skolem">g1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_rewrite_ord_finite_canon_rewriterE<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g1</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_canon_rewriterD1<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="free">G</span> <span class="main">(</span>monom_mult <span class="main">1</span> <span class="main">(</span>pp_of_term <span class="skolem">v</span> <span class="main">-</span> lp <span class="skolem">g1</span><span class="main">)</span> <span class="skolem">g1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> crw <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> impl<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="main">{</span><span class="skolem">h</span><span class="main">}</span> <span class="main">(</span>monom_mult <span class="main">1</span> <span class="main">(</span>pp_of_term <span class="skolem">v</span> <span class="main">-</span> lp <span class="skolem">g1</span><span class="main">)</span> <span class="skolem">g1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_red_singletonI<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">,</span> 2<span class="main">)</span> <span class="quoted"><span class="quoted">‹is_RB_upt <span class="free">d</span> <span class="free">rword</span> <span class="free">G</span> <span class="skolem">v</span>›</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> is_syz_sig <span class="free">d</span> <span class="skolem">v</span>›</span></span> crw
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_regular_spair <span class="skolem">g1</span> <span class="skolem">h</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span>spair <span class="skolem">g1</span> <span class="skolem">h</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">d</span> <span class="main">(</span>pp_of_term <span class="skolem">v</span><span class="main">)</span> <span class="main">≤</span> dgrad_max <span class="free">d</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lemma_9<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free">u</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span>spair <span class="skolem">g1</span> <span class="skolem">h</span><span class="main">)</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> eq<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g1</span> <span class="main">∈</span> <span class="free">G</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">h</span> <span class="main">∈</span> <span class="free">G</span>›</span></span> <span class="quoted"><span class="quoted">‹is_regular_spair <span class="skolem">g1</span> <span class="skolem">h</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_RB_in <span class="free">d</span> <span class="free">rword</span> <span class="free">G</span> <span class="main">(</span>lt <span class="main">(</span>spair <span class="skolem">g1</span> <span class="skolem">h</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_RB_in <span class="free">d</span> <span class="free">rword</span> <span class="free">G</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> eq<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> is_RB_in <span class="free">d</span> <span class="free">rword</span> <span class="free">G</span> <span class="skolem">v</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Note that the following lemma actually holds for <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">emph</span></span> ‹all›<span class="antiquote"><span class="antiquote">}</span></span></span></span> regularly reducible power-products
  in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free"><span class="free">p</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, not just for the leading power-product.›</span></span>

<span class="keyword1" id="Signature_Groebner-lemma_11"><span class="command">lemma</span></span> lemma_11<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dickson_grading <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_rewrite_ord <span class="free">rword</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_RB_upt <span class="free">d</span> <span class="free">rword</span> <span class="free">G</span> <span class="main">(</span>lt <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="free">G</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">u</span> <span class="free">g</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">(</span>pp_of_term <span class="free">u</span><span class="main">)</span> <span class="main">≤</span> dgrad_max <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"component_of_term <span class="free">u</span> <span class="main">&lt;</span> length <span class="free">fs</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_syz_sig <span class="free">d</span> <span class="free">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_canon_rewriter <span class="free">rword</span> <span class="free">G</span> <span class="free">u</span> <span class="free">g</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">=</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">g</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="main">{</span><span class="free">g</span><span class="main">}</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> G_sub<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">⊆</span> dgrad_sig_set <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_RB_uptD1<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> is_sig_red_addsE <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rep_list_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?lc</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"punit.lc <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?lp</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹rep_list <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lc</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.lc_not_0<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> dgrad_max_set <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dgrad_sig_set'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">(</span>lp <span class="free">p</span><span class="main">)</span> <span class="main">≤</span> dgrad_max <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dgrad_sig_setD_lp<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"component_of_term <span class="main">(</span>lt <span class="free">p</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="free">fs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dgrad_sig_setD_lt<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> dgrad_max_set <span class="free">d</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">p</span> <span class="main">∈</span> punit_dgrad_max_set <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dgrad_max_2<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="var">?lp</span> <span class="main">≤</span> dgrad_max <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹rep_list <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.dgrad_p_setD_lp<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>5<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g0</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g0</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="main">{</span><span class="skolem">g0</span><span class="main">}</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_red_singletonI<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g0</span> <span class="main">∈</span> <span class="free">G</span>›</span></span> G_sub <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g0</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g0</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"monom_mult <span class="main">(</span><span class="var">?lc</span> <span class="main">/</span> punit.lc <span class="main">(</span>rep_list <span class="skolem">g0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="var">?lp</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">g0</span><span class="main">)</span><span class="main">)</span> <span class="skolem">g0</span>"</span></span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">M</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">=</span> <span class="main">{</span>monom_mult <span class="main">(</span><span class="var">?lc</span> <span class="main">/</span> punit.lc <span class="main">(</span>rep_list <span class="bound">g</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="var">?lp</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="bound">g</span><span class="main">)</span><span class="main">)</span> <span class="bound">g</span> <span class="main">|</span>
                          <span class="bound">g</span><span class="main">.</span> <span class="bound">g</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span> <span class="main">∧</span> is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="main">{</span><span class="bound">g</span><span class="main">}</span> <span class="free">p</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g0</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>›</span></span> <span class="quoted"><span class="quoted">‹is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="main">{</span><span class="skolem">g0</span><span class="main">}</span> <span class="free">p</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g0</span> <span class="main">∈</span> <span class="skolem">M</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> M_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> rep_list <span class="main">`</span> <span class="skolem">M</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> rep_list <span class="main">`</span> <span class="skolem">M</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="main">{</span><span class="skolem">g</span><span class="main">}</span> <span class="free">p</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"rep_list <span class="main">(</span>monom_mult <span class="main">(</span><span class="var">?lc</span> <span class="main">/</span> punit.lc <span class="main">(</span>rep_list <span class="skolem">g</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="var">?lp</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">g</span><span class="main">)</span><span class="main">)</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> M_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="skolem">g</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> is_sig_red_addsE <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.lc <span class="main">(</span>rep_list <span class="skolem">g</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.lc_not_0<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="main">(</span>monom_mult <span class="main">(</span><span class="var">?lc</span> <span class="main">/</span> punit.lc <span class="main">(</span>rep_list <span class="skolem">g</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="var">?lp</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">g</span><span class="main">)</span><span class="main">)</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?lc</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rep_list_monom_mult punit.monom_mult_eq_zero_iff<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> rep_list_zero <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> <span class="skolem">M</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">⊆</span> dgrad_sig_set <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> <span class="skolem">M</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="main">{</span><span class="skolem">g</span><span class="main">}</span> <span class="free">p</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> monom_mult <span class="main">(</span><span class="var">?lc</span> <span class="main">/</span> punit.lc <span class="main">(</span>rep_list <span class="skolem">g</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="var">?lp</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">g</span><span class="main">)</span><span class="main">)</span> <span class="skolem">g</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> M_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="skolem">g</span><span class="main">)</span> <span class="keyword1">adds</span> <span class="var">?lp</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> is_sig_red_top_addsE <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">note</span></span> assms<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">thm</span></span> dickson_grading_minus
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">(</span><span class="var">?lp</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">g</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> dgrad_max <span class="free">d</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> le_trans<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> dickson_grading_minus<span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> m <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dgrad_sig_set_closed_monom_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">⊆</span> sig_inv_set"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dgrad_sig_set'_def<span class="main">)</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"lt <span class="main">`</span> <span class="skolem">M</span>"</span></span>
  <span class="keyword1"><span class="command">note</span></span> assms<span class="main">(</span>1<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?g0</span> <span class="main">∈</span> <span class="skolem">M</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="var">?g0</span> <span class="main">∈</span> <span class="var">?M</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> imageI<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">M</span> <span class="main">⊆</span> dgrad_sig_set <span class="free">d</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pp_of_term <span class="main">`</span> <span class="var">?M</span> <span class="main">⊆</span> dgrad_set <span class="free">d</span> <span class="main">(</span>dgrad_max <span class="free">d</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> dgrad_sig_setD_lp<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="var">?M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> min<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="skolem">u</span> <span class="main">⟹</span> <span class="bound">v</span> <span class="main">∉</span> <span class="var">?M</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ord_term_minimum_dgrad_set<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">∈</span> <span class="var">?M</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> <span class="skolem">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> u'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> lt <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g1</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="main">{</span><span class="skolem">g1</span><span class="main">}</span> <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> monom_mult <span class="main">(</span><span class="var">?lc</span> <span class="main">/</span> punit.lc <span class="main">(</span>rep_list <span class="skolem">g1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="var">?lp</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">g1</span><span class="main">)</span><span class="main">)</span> <span class="skolem">g1</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> M_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword1"><span class="command">have</span></span> adds<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="skolem">g1</span><span class="main">)</span> <span class="keyword1">adds</span> <span class="var">?lp</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lp</span> <span class="main">⊕</span> lt <span class="skolem">g1</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> punit.lt <span class="main">(</span>rep_list <span class="skolem">g1</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="skolem">g1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> is_sig_red_top_addsE <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> lc_g1<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.lc <span class="main">(</span>rep_list <span class="skolem">g1</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.lc_not_0<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="main">∈</span> <span class="skolem">M</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">∉</span> rep_list <span class="main">`</span> <span class="skolem">M</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="skolem">m</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="main">∈</span> <span class="skolem">M</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">∉</span> <span class="skolem">M</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lc <span class="skolem">m</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lc_not_0<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> lc_g1 <span class="keyword1"><span class="command">have</span></span> eq0<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.lc <span class="main">(</span>rep_list <span class="skolem">m</span><span class="main">)</span> <span class="main">=</span> <span class="var">?lc</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> m rep_list_monom_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?lc</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹rep_list <span class="skolem">g1</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> adds <span class="keyword1"><span class="command">have</span></span> eq1<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="skolem">m</span><span class="main">)</span> <span class="main">=</span> <span class="var">?lp</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> m rep_list_monom_mult punit.lt_monom_mult punit.lc_eq_zero_iff adds_minus<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="main">∈</span> <span class="skolem">M</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">M</span> <span class="main">⊆</span> dgrad_sig_set <span class="free">d</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹rep_list <span class="skolem">g1</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.lc <span class="main">(</span>rep_list <span class="skolem">g1</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rep_list_zero punit.lc_eq_zero_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?lc</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="main">(</span><span class="var">?lp</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">g1</span><span class="main">)</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">g1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> u' m lt_monom_mult lc_eq_zero_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="skolem">g1</span><span class="main">)</span> <span class="main">⊕</span> <span class="skolem">u</span> <span class="main">=</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">g1</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span><span class="main">(</span><span class="var">?lp</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">g1</span><span class="main">)</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">g1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> adds <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?lp</span> <span class="main">⊕</span> lt <span class="skolem">g1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> splus_assoc<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> add.commute adds_minus<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> punit.lt <span class="main">(</span>rep_list <span class="skolem">g1</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ord_term_strict_canc<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">∈</span> <span class="var">?M</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pp_of_term <span class="skolem">u</span> <span class="main">∈</span> pp_of_term <span class="main">`</span> <span class="var">?M</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> imageI<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⊆</span> dgrad_set <span class="free">d</span> <span class="main">(</span>dgrad_max <span class="free">d</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">(</span>pp_of_term <span class="skolem">u</span><span class="main">)</span> <span class="main">≤</span> dgrad_max <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dgrad_setD<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">∈</span> <span class="var">?M</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"component_of_term <span class="skolem">u</span> <span class="main">∈</span> component_of_term <span class="main">`</span> <span class="var">?M</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> imageI<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">M</span> <span class="main">⊆</span> sig_inv_set›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">∉</span> <span class="skolem">M</span>›</span></span> sig_inv_setD_lt <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">fs</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"component_of_term <span class="skolem">u</span> <span class="main">&lt;</span> length <span class="free">fs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_syz_sig <span class="free">d</span> <span class="skolem">u</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_syz_sig <span class="free">d</span> <span class="skolem">u</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">s</span> <span class="main">=</span> <span class="skolem">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="skolem">s</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_syz_sigE<span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"monom_mult <span class="main">(</span>lc <span class="skolem">m</span> <span class="main">/</span> lc <span class="skolem">s</span><span class="main">)</span> <span class="main">0</span> <span class="skolem">s</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="var">?s</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rep_list_monom_mult <span class="quoted"><span class="quoted">‹rep_list <span class="skolem">s</span> <span class="main">=</span> <span class="main">0</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lc <span class="skolem">s</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lc_not_0<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lc <span class="skolem">m</span> <span class="main">/</span> lc <span class="skolem">s</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹lc <span class="skolem">m</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">-</span> <span class="var">?s</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">-</span> <span class="var">?s</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> <span class="var">?s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹rep_list <span class="var">?s</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="skolem">m</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹rep_list <span class="skolem">m</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹lc <span class="skolem">m</span> <span class="main">/</span> lc <span class="skolem">s</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="var">?s</span> <span class="main">=</span> lt <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lt_monom_mult_zero <span class="quoted"><span class="quoted">‹lt <span class="skolem">s</span> <span class="main">=</span> <span class="skolem">u</span>›</span></span> u'<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹lc <span class="skolem">s</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lc <span class="var">?s</span> <span class="main">=</span> lc <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span><span class="skolem">m</span> <span class="main">-</span> <span class="var">?s</span><span class="main">)</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="skolem">u</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> u' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lt_minus_lessI<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span><span class="skolem">m</span> <span class="main">-</span> <span class="var">?s</span><span class="main">)</span> <span class="main">∉</span> <span class="var">?M</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> min<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">-</span> <span class="var">?s</span> <span class="main">∉</span> <span class="skolem">M</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">-</span> <span class="var">?s</span> <span class="main">∈</span> <span class="skolem">M</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?s</span> <span class="main">=</span> monom_mult <span class="main">(</span><span class="var">?lc</span> <span class="main">/</span> lc <span class="skolem">s</span><span class="main">)</span> <span class="main">0</span> <span class="main">(</span>monom_mult <span class="main">(</span>lc <span class="skolem">g1</span> <span class="main">/</span> punit.lc <span class="main">(</span>rep_list <span class="skolem">g1</span><span class="main">)</span><span class="main">)</span> <span class="main">0</span> <span class="skolem">s</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> m monom_mult_assoc mult.commute<span class="main">)</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">m'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m'</span> <span class="main">=</span> <span class="skolem">m</span> <span class="main">-</span> <span class="var">?s</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"rep_list <span class="skolem">m'</span> <span class="main">=</span> rep_list <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> m'_def rep_list_minus <span class="quoted"><span class="quoted">‹rep_list <span class="var">?s</span> <span class="main">=</span> <span class="main">0</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?lc</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m'</span> <span class="main">=</span> monom_mult <span class="main">(</span><span class="var">?lc</span> <span class="main">/</span> punit.lc <span class="main">(</span>rep_list <span class="skolem">m'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="var">?lp</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">m'</span><span class="main">)</span><span class="main">)</span> <span class="skolem">m'</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq eq0 eq1<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">∈</span> <span class="skolem">M</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> M_def
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> exI conjI<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?s</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dgrad_sig_set_closed_monom_mult_zero<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m'</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> m'_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dgrad_sig_set_closed_minus<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="main">{</span><span class="skolem">m'</span><span class="main">}</span> <span class="free">p</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_red_top_addsI<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m'</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">m'</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹rep_list <span class="skolem">m</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="skolem">m'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="skolem">m'</span><span class="main">)</span> <span class="keyword1">adds</span> punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq eq1<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">m'</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">⊕</span> <span class="skolem">u</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> splus_mono_strict<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> m'_def <span class="quoted"><span class="quoted">‹lt <span class="main">(</span><span class="skolem">m</span> <span class="main">-</span> <span class="var">?s</span><span class="main">)</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="skolem">u</span>›</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> punit.lt <span class="main">(</span>rep_list <span class="skolem">m'</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">p</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> eq eq1 <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="free">p</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> splus_mono_strict<span class="main">)</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">m'</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> punit.lt <span class="main">(</span>rep_list <span class="skolem">m'</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ord_term_lin.is_le_rel <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">fact</span> refl<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> m'_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_RB_in <span class="free">d</span> <span class="free">rword</span> <span class="free">G</span> <span class="skolem">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_RB_uptD2<span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> is_RB_inE<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_syz_sig <span class="free">d</span> <span class="skolem">u</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> is_syz_sig <span class="free">d</span> <span class="skolem">u</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">g</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_canon_rewriter <span class="free">rword</span> <span class="free">G</span> <span class="skolem">u</span> <span class="skolem">g</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> adds'<span class="main">:</span> <span class="quoted"><span class="quoted">"lt <span class="skolem">g</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="skolem">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_canon_rewriterD<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword3"><span class="command">assume</span></span> irred<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="free">G</span> <span class="main">(</span>monom_mult <span class="main">1</span> <span class="main">(</span>pp_of_term <span class="skolem">u</span> <span class="main">-</span> lp <span class="skolem">g</span><span class="main">)</span> <span class="skolem">g</span><span class="main">)</span>"</span></span>

    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> monom_mult <span class="main">1</span> <span class="main">(</span>pp_of_term <span class="skolem">u</span> <span class="main">-</span> lp <span class="skolem">g</span><span class="main">)</span> <span class="skolem">g</span>"</span></span>
    <span class="keyword1"><span class="command">note</span></span> assms<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_sig_GB_upt <span class="free">d</span> <span class="free">G</span> <span class="main">(</span>lt <span class="skolem">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> u'<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_GB_upt_le<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> is_RB_upt_is_sig_GB_upt<span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ord_term_lin.less_imp_le<span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> b_def
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> dgrad_sig_set_closed_monom_mult<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> adds' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lp <span class="skolem">g</span> <span class="keyword1">adds</span> pp_of_term <span class="skolem">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> adds_term_def<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">(</span>pp_of_term <span class="skolem">u</span> <span class="main">-</span> lp <span class="skolem">g</span><span class="main">)</span> <span class="main">≤</span> <span class="free">d</span> <span class="main">(</span>pp_of_term <span class="skolem">u</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dickson_grading_minus<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">(</span>pp_of_term <span class="skolem">u</span> <span class="main">-</span> lp <span class="skolem">g</span><span class="main">)</span> <span class="main">≤</span> dgrad_max <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">d</span> <span class="main">(</span>pp_of_term <span class="skolem">u</span><span class="main">)</span> <span class="main">≤</span> dgrad_max <span class="free">d</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> le_trans<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="main">∈</span> <span class="free">G</span>›</span></span> G_sub <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>›</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">b</span> <span class="main">=</span> lt <span class="skolem">m</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> b_def u'<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> lt_monom_mult<span class="main"><span class="keyword3">,</span></span>
          <span class="operator">metis</span> adds' add_diff_cancel_right' adds_termE pp_of_term_splus<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> b_def monom_mult_eq_zero_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> irred <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="free">G</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> b_def<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="free">G</span> <span class="skolem">m</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="free">G</span> <span class="skolem">m</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g2</span></span> <span class="keyword2"><span class="keyword">where</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g2</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"rep_list <span class="skolem">g2</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="skolem">g2</span><span class="main">)</span> <span class="keyword1">adds</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">m</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="skolem">m</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">g2</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> punit.lt <span class="main">(</span>rep_list <span class="skolem">g2</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">m</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_red_top_addsE<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> 2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g2</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"punit.lc <span class="main">(</span>rep_list <span class="skolem">g2</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rep_list_zero punit.lc_eq_zero_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> 3 4 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span>monom_mult <span class="main">(</span><span class="var">?lc</span> <span class="main">/</span> punit.lc <span class="main">(</span>rep_list <span class="skolem">g2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="var">?lp</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">g2</span><span class="main">)</span><span class="main">)</span> <span class="skolem">g2</span><span class="main">)</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="skolem">u</span>"</span></span>
        <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"lt <span class="var">?g2</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="skolem">u</span>"</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?lc</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> term_is_le_rel_minus u' eq1 lt_monom_mult<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lt <span class="var">?g2</span> <span class="main">∉</span> <span class="var">?M</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> min<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g2</span> <span class="main">∉</span> <span class="skolem">M</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g2</span> <span class="main">∉</span> dgrad_sig_set <span class="free">d</span> <span class="main">∨</span> <span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="main">{</span><span class="skolem">g2</span><span class="main">}</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> M_def<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g2</span> <span class="main">∉</span> dgrad_sig_set <span class="free">d</span>"</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g2</span> <span class="main">∈</span> <span class="free">G</span>›</span></span> G_sub <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g2</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="main">{</span><span class="skolem">g2</span><span class="main">}</span> <span class="free">p</span>"</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="main">{</span><span class="skolem">g2</span><span class="main">}</span> <span class="free">p</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_red_top_addsI<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g2</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">g2</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword1"><span class="command">from</span></span> 3 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="skolem">g2</span><span class="main">)</span> <span class="keyword1">adds</span> punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> eq1<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword1"><span class="command">from</span></span> 4 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lp</span> <span class="main">⊕</span> lt <span class="skolem">g2</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> punit.lt <span class="main">(</span>rep_list <span class="skolem">g2</span><span class="main">)</span> <span class="main">⊕</span> <span class="skolem">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> eq1 u'<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="free">p</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> punit.lt <span class="main">(</span>rep_list <span class="skolem">g2</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> splus_mono_strict<span class="main">)</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lp</span> <span class="main">⊕</span> lt <span class="skolem">g2</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> punit.lt <span class="main">(</span>rep_list <span class="skolem">g2</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ord_term_lin.is_le_rel <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> eq2<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="skolem">b</span><span class="main">)</span> <span class="main">=</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">m</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_regular_top_reduced_lt_unique<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="skolem">g</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_RB_inD<span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> adds' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lp <span class="skolem">g</span> <span class="keyword1">adds</span> pp_of_term <span class="skolem">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"component_of_term <span class="main">(</span>lt <span class="skolem">g</span><span class="main">)</span> <span class="main">=</span> component_of_term <span class="skolem">u</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> adds_term_def<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="main">(</span><span class="var">?lp</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">g</span><span class="main">)</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">g</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq1<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> eq2<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> b_def rep_list_monom_mult punit.lt_monom_mult
          splus_def adds_minus <span class="dynamic"><span class="dynamic">term_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="main">{</span><span class="skolem">b</span><span class="main">}</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_red_top_addsI<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹rep_list <span class="skolem">g</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="skolem">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> b_def rep_list_monom_mult punit.monom_mult_eq_zero_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="skolem">b</span><span class="main">)</span> <span class="keyword1">adds</span> punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq1 eq2<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">b</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> punit.lt <span class="main">(</span>rep_list <span class="skolem">b</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">p</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq1 eq2 <span class="quoted"><span class="quoted">‹lt <span class="skolem">b</span> <span class="main">=</span> lt <span class="skolem">m</span>›</span></span> u'<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="free">p</span>›</span></span> splus_mono_strict<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ord_term_lin.is_le_rel <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="main">{</span><span class="skolem">g</span><span class="main">}</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> b_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_red_singleton_monom_multD<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Termination›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">term_pp_rel</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒</span> <span class="tfree">'t</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">term_pp_rel</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">⟷</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">⊕</span> fst <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">⊕</span> fst <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">canon_term_pp_pair</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">canon_term_pp_pair</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">⟷</span> <span class="main">(</span>gcs <span class="main">(</span>pp_of_term <span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">cancel_term_pp_pair</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">cancel_term_pp_pair</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> <span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">⊖</span> <span class="main">(</span>gcs <span class="main">(</span>pp_of_term <span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">,</span> snd <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">-</span> <span class="main">(</span>gcs <span class="main">(</span>pp_of_term <span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Signature_Groebner-term_pp_rel_refl"><span class="command">lemma</span></span> term_pp_rel_refl<span class="main">:</span> <span class="quoted"><span class="quoted">"reflp <span class="free">r</span> <span class="main">⟹</span> term_pp_rel <span class="free">r</span> <span class="free">a</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> term_pp_rel_def reflp_def<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-term_pp_rel_irrefl"><span class="command">lemma</span></span> term_pp_rel_irrefl<span class="main">:</span> <span class="quoted"><span class="quoted">"irreflp <span class="free">r</span> <span class="main">⟹</span> <span class="main">¬</span> term_pp_rel <span class="free">r</span> <span class="free">a</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> term_pp_rel_def irreflp_def<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-term_pp_rel_sym"><span class="command">lemma</span></span> term_pp_rel_sym<span class="main">:</span> <span class="quoted"><span class="quoted">"symp <span class="free">r</span> <span class="main">⟹</span> term_pp_rel <span class="free">r</span> <span class="free">a</span> <span class="free">b</span> <span class="main">⟹</span> term_pp_rel <span class="free">r</span> <span class="free">b</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> term_pp_rel_def symp_def<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-term_pp_rel_trans"><span class="command">lemma</span></span> term_pp_rel_trans<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ord_term_lin.is_le_rel <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"term_pp_rel <span class="free">r</span> <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"term_pp_rel <span class="free">r</span> <span class="free">b</span> <span class="free">c</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"term_pp_rel <span class="free">r</span> <span class="free">a</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"transp <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ord_term_lin.is_le_relE<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">(</span>snd <span class="free">b</span> <span class="main">⊕</span> fst <span class="free">a</span><span class="main">)</span> <span class="main">(</span>snd <span class="free">a</span> <span class="main">⊕</span> fst <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> term_pp_rel_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">(</span>snd <span class="free">c</span> <span class="main">⊕</span> fst <span class="free">b</span><span class="main">)</span> <span class="main">(</span>snd <span class="free">b</span> <span class="main">⊕</span> fst <span class="free">c</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> term_pp_rel_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"snd <span class="free">b</span> <span class="main">⊕</span> <span class="main">(</span>snd <span class="free">c</span> <span class="main">⊕</span> fst <span class="free">a</span><span class="main">)</span> <span class="main">=</span> snd <span class="free">c</span> <span class="main">⊕</span> <span class="main">(</span>snd <span class="free">b</span> <span class="main">⊕</span> fst <span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> splus_left_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">...</span> <span class="main">(</span>snd <span class="free">a</span> <span class="main">⊕</span> <span class="main">(</span>snd <span class="free">c</span> <span class="main">⊕</span> fst <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> splus_left_commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"snd <span class="free">a</span>"</span></span><span class="main"><span class="main">]</span></span> term_is_le_rel_canc_left<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> 2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">...</span> <span class="main">(</span>snd <span class="free">b</span> <span class="main">⊕</span> <span class="main">(</span>snd <span class="free">a</span> <span class="main">⊕</span> fst <span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> splus_left_commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"snd <span class="free">b</span>"</span></span><span class="main"><span class="main">]</span></span> term_is_le_rel_canc_left<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span><span class="main">(</span>transpD<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹transp <span class="free">r</span>›</span></span><span class="main">]</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> term_pp_rel_def term_is_le_rel_canc_left<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-term_pp_rel_trans_eq_left"><span class="command">lemma</span></span> term_pp_rel_trans_eq_left<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ord_term_lin.is_le_rel <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"term_pp_rel <span class="main">(=)</span> <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"term_pp_rel <span class="free">r</span> <span class="free">b</span> <span class="free">c</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"term_pp_rel <span class="free">r</span> <span class="free">a</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"transp <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ord_term_lin.is_le_relE<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"snd <span class="free">b</span> <span class="main">⊕</span> fst <span class="free">a</span> <span class="main">=</span> snd <span class="free">a</span> <span class="main">⊕</span> fst <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> term_pp_rel_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">(</span>snd <span class="free">c</span> <span class="main">⊕</span> fst <span class="free">b</span><span class="main">)</span> <span class="main">(</span>snd <span class="free">b</span> <span class="main">⊕</span> fst <span class="free">c</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> term_pp_rel_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"snd <span class="free">b</span> <span class="main">⊕</span> <span class="main">(</span>snd <span class="free">c</span> <span class="main">⊕</span> fst <span class="free">a</span><span class="main">)</span> <span class="main">=</span> snd <span class="free">c</span> <span class="main">⊕</span> <span class="main">(</span>snd <span class="free">b</span> <span class="main">⊕</span> fst <span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> splus_left_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>snd <span class="free">a</span> <span class="main">⊕</span> <span class="main">(</span>snd <span class="free">c</span> <span class="main">⊕</span> fst <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> splus_left_commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"snd <span class="free">a</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"snd <span class="free">b</span> <span class="main">⊕</span> <span class="main">(</span>snd <span class="free">c</span> <span class="main">⊕</span> fst <span class="free">a</span><span class="main">)</span> <span class="main">=</span> snd <span class="free">a</span> <span class="main">⊕</span> <span class="main">(</span>snd <span class="free">c</span> <span class="main">⊕</span> fst <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> 2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">(</span>snd <span class="free">b</span> <span class="main">⊕</span> <span class="main">(</span>snd <span class="free">c</span> <span class="main">⊕</span> fst <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="free">b</span> <span class="main">⊕</span> <span class="main">(</span>snd <span class="free">a</span> <span class="main">⊕</span> fst <span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> eq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> splus_left_commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"snd <span class="free">b</span>"</span></span><span class="main"><span class="main">]</span></span> term_is_le_rel_canc_left<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> term_pp_rel_def term_is_le_rel_canc_left<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-term_pp_rel_trans_eq_right"><span class="command">lemma</span></span> term_pp_rel_trans_eq_right<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ord_term_lin.is_le_rel <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"term_pp_rel <span class="free">r</span> <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"term_pp_rel <span class="main">(=)</span> <span class="free">b</span> <span class="free">c</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"term_pp_rel <span class="free">r</span> <span class="free">a</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"transp <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ord_term_lin.is_le_relE<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">(</span>snd <span class="free">b</span> <span class="main">⊕</span> fst <span class="free">a</span><span class="main">)</span> <span class="main">(</span>snd <span class="free">a</span> <span class="main">⊕</span> fst <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> term_pp_rel_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"snd <span class="free">c</span> <span class="main">⊕</span> fst <span class="free">b</span> <span class="main">=</span> snd <span class="free">b</span> <span class="main">⊕</span> fst <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> term_pp_rel_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"snd <span class="free">b</span> <span class="main">⊕</span> <span class="main">(</span>snd <span class="free">a</span> <span class="main">⊕</span> fst <span class="free">c</span><span class="main">)</span> <span class="main">=</span> snd <span class="free">a</span> <span class="main">⊕</span> <span class="main">(</span>snd <span class="free">b</span> <span class="main">⊕</span> fst <span class="free">c</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> splus_left_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> 2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>snd <span class="free">a</span> <span class="main">⊕</span> <span class="main">(</span>snd <span class="free">c</span> <span class="main">⊕</span> fst <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> splus_left_commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"snd <span class="free">a</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"snd <span class="free">b</span> <span class="main">⊕</span> <span class="main">(</span>snd <span class="free">a</span> <span class="main">⊕</span> fst <span class="free">c</span><span class="main">)</span> <span class="main">=</span> snd <span class="free">a</span> <span class="main">⊕</span> <span class="main">(</span>snd <span class="free">c</span> <span class="main">⊕</span> fst <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">(</span>snd <span class="free">b</span> <span class="main">⊕</span> <span class="main">(</span>snd <span class="free">c</span> <span class="main">⊕</span> fst <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="free">b</span> <span class="main">⊕</span> <span class="main">(</span>snd <span class="free">a</span> <span class="main">⊕</span> fst <span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> eq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> splus_left_commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"snd <span class="free">c</span>"</span></span><span class="main"><span class="main">]</span></span> term_is_le_rel_canc_left<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> term_pp_rel_def term_is_le_rel_canc_left<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-canon_term_pp_cancel"><span class="command">lemma</span></span> canon_term_pp_cancel<span class="main">:</span> <span class="quoted"><span class="quoted">"canon_term_pp_pair <span class="main">(</span>cancel_term_pp_pair <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cancel_term_pp_pair_def canon_term_pp_pair_def gcs_minus_gcs <span class="dynamic"><span class="dynamic">term_simps</span></span><span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-term_pp_rel_cancel"><span class="command">lemma</span></span> term_pp_rel_cancel<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"reflp <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"term_pp_rel <span class="free">r</span> <span class="free">a</span> <span class="main">(</span>cancel_term_pp_pair <span class="free">a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> prod.exhaust<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a cancel_term_pp_pair_def<span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"gcs <span class="main">(</span>pp_of_term <span class="skolem">u</span><span class="main">)</span> <span class="skolem">s</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span> <span class="keyword1">adds</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> gcs_adds_2<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> <span class="var">?g</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span><span class="skolem">u</span> <span class="main">⊖</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">s</span> <span class="main">⊕</span> <span class="skolem">u</span> <span class="main">⊖</span> <span class="main">(</span><span class="var">?g</span> <span class="main">+</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> zero_adds_pp
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> minus_splus_sminus<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">s</span> <span class="main">⊕</span> <span class="main">(</span><span class="skolem">u</span> <span class="main">⊖</span> <span class="var">?g</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.left_neutral add.right_neutral adds_pp_def diff_zero gcs_adds_2 gcs_comm
          minus_splus_sminus zero_adds<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">(</span><span class="main">(</span><span class="skolem">s</span> <span class="main">-</span> <span class="var">?g</span><span class="main">)</span> <span class="main">⊕</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">⊕</span> <span class="main">(</span><span class="skolem">u</span> <span class="main">⊖</span> <span class="var">?g</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">term_simps</span></span> reflp_def<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"term_pp_rel <span class="free">r</span> <span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">(</span><span class="skolem">u</span> <span class="main">⊖</span> <span class="var">?g</span><span class="main">,</span> <span class="skolem">s</span> <span class="main">-</span> <span class="var">?g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a term_pp_rel_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-canon_term_pp_rel_id"><span class="command">lemma</span></span> canon_term_pp_rel_id<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"term_pp_rel <span class="main">(=)</span> <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"canon_term_pp_pair <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"canon_term_pp_pair <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> prod.exhaust<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">v</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> prod.exhaust<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">⊕</span> <span class="skolem">u</span> <span class="main">=</span> <span class="skolem">s</span> <span class="main">⊕</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> term_pp_rel_def a b<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">+</span> pp_of_term <span class="skolem">u</span> <span class="main">=</span> <span class="skolem">s</span> <span class="main">+</span> pp_of_term <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> pp_of_term_splus<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"gcs <span class="main">(</span>pp_of_term <span class="skolem">u</span><span class="main">)</span> <span class="skolem">s</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> canon_term_pp_pair_def a<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"gcs <span class="main">(</span>pp_of_term <span class="skolem">v</span><span class="main">)</span> <span class="skolem">t</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> canon_term_pp_pair_def b<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> <span class="skolem">t</span> <span class="main">+</span> gcs <span class="main">(</span>pp_of_term <span class="skolem">u</span><span class="main">)</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> 2<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> gcs <span class="main">(</span><span class="skolem">t</span> <span class="main">+</span> pp_of_term <span class="skolem">u</span><span class="main">)</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">+</span> <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> gcs_plus_left<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> gcs <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> pp_of_term <span class="skolem">v</span><span class="main">)</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> 1 add.commute<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">s</span> <span class="main">+</span> gcs <span class="main">(</span>pp_of_term <span class="skolem">v</span><span class="main">)</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> gcs_plus_left<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> 3<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">⊕</span> <span class="skolem">u</span> <span class="main">=</span> <span class="skolem">s</span> <span class="main">⊕</span> <span class="skolem">v</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">=</span> <span class="skolem">s</span>›</span></span> splus_left_canc<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a b<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-min_set_finite"><span class="command">lemma</span></span> min_set_finite<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">seq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">::</span>field<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dickson_grading <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"range <span class="free">seq</span> <span class="main">⊆</span> dgrad_sig_set <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> rep_list <span class="main">`</span> range <span class="free">seq</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="bound">j</span> <span class="main">⟹</span> lt <span class="main">(</span><span class="free">seq</span> <span class="bound">i</span><span class="main">)</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="main">(</span><span class="free">seq</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span><span class="bound">i</span><span class="main">.</span> lt <span class="main">(</span><span class="free">seq</span> <span class="bound">j</span><span class="main">)</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> lt <span class="main">(</span><span class="free">seq</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∧</span>
                             punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">seq</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">adds</span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">seq</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> lt <span class="main">(</span><span class="free">seq</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
    <span class="keyword3"><span class="command">assume</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span><span class="free">seq</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> lt <span class="main">(</span><span class="free">seq</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="skolem">j</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> linorder_cases<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">j</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span><span class="free">seq</span> <span class="skolem">i</span><span class="main">)</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="main">(</span><span class="free">seq</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span><span class="free">seq</span> <span class="skolem">j</span><span class="main">)</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="main">(</span><span class="free">seq</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"inj <span class="free">seq</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> comp_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> inj_on_imageI2<span class="main">)</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">p</span> <span class="bound">q</span><span class="main">.</span> lt <span class="bound">p</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> lt <span class="bound">q</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">p</span> <span class="bound">q</span><span class="main">.</span> punit.lt <span class="main">(</span>rep_list <span class="bound">p</span><span class="main">)</span> <span class="keyword1">adds</span> punit.lt <span class="main">(</span>rep_list <span class="bound">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">p</span> <span class="bound">q</span><span class="main">.</span> <span class="var">?P1</span> <span class="bound">p</span> <span class="bound">q</span> <span class="main">∧</span> <span class="var">?P2</span> <span class="bound">p</span> <span class="bound">q</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"reflp <span class="var">?P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reflp_def adds_term_refl<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"almost_full_on <span class="var">?P1</span> <span class="main">(</span>range <span class="free">seq</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> almost_full_on_map<span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">t</span><span class="main">.</span> pp_of_term <span class="bound">t</span> <span class="main">∈</span> dgrad_set <span class="free">d</span> <span class="main">(</span>dgrad_max <span class="free">d</span><span class="main">)</span> <span class="main">∧</span> component_of_term <span class="bound">t</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">fs</span><span class="main">}</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> finite_atLeastLessThan <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"almost_full_on <span class="keyword1">(adds<span class="hidden">⇩</span><sub>t</sub>)</span> <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Dickson_term<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lt <span class="main">`</span> range <span class="free">seq</span> <span class="main">⊆</span> <span class="var">?B</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> lt <span class="main">`</span> range <span class="free">seq</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> range <span class="free">seq</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> lt <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rep_list_zero<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">∈</span> range <span class="free">seq</span>›</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">(</span>lp <span class="skolem">p</span><span class="main">)</span> <span class="main">≤</span> dgrad_max <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dgrad_sig_setD_lp<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lp <span class="skolem">p</span> <span class="main">∈</span> dgrad_set <span class="free">d</span> <span class="main">(</span>dgrad_max <span class="free">d</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dgrad_set_def<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"component_of_term <span class="main">(</span>lt <span class="skolem">p</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="free">fs</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dgrad_sig_setD_lt<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> v<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"almost_full_on <span class="var">?P2</span> <span class="main">(</span>range <span class="free">seq</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> almost_full_on_map<span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"dgrad_set <span class="free">d</span> <span class="main">(</span>dgrad_max <span class="free">d</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"almost_full_on <span class="keyword1">(adds)</span> <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dickson_gradingD_dgrad_set<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> punit.lt <span class="main">(</span>rep_list <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> range <span class="free">seq</span> <span class="main">⊆</span> <span class="var">?B</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> punit.lt <span class="main">(</span>rep_list <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> range <span class="free">seq</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> range <span class="free">seq</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">∈</span> range <span class="free">seq</span>›</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> dgrad_max_set <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dgrad_sig_set'_def<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="skolem">p</span> <span class="main">∈</span> punit_dgrad_max_set <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dgrad_max_2<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹rep_list <span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> dgrad_max <span class="free">d</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.dgrad_p_setD_lp<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> t dgrad_set_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"almost_full_on <span class="var">?P</span> <span class="main">(</span>range <span class="free">seq</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> almost_full_on_same<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹reflp <span class="var">?P</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">T</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">T</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="main">⊆</span> range <span class="free">seq</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">∈</span> range <span class="free">seq</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound">q</span><span class="main">∈</span><span class="skolem">T</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">q</span> <span class="bound">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> almost_full_on_finite_subsetE<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">T</span> <span class="main">⊆</span> range <span class="free">seq</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">I</span></span> <span class="keyword2"><span class="keyword">where</span></span> T<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="main">=</span> <span class="free">seq</span> <span class="main">`</span> <span class="skolem">I</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> subset_image_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span><span class="bound">i</span><span class="main">.</span> <span class="var">?P</span> <span class="main">(</span><span class="free">seq</span> <span class="bound">j</span><span class="main">)</span> <span class="main">(</span><span class="free">seq</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">}</span> <span class="main">⊆</span> <span class="skolem">I</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span><span class="bound">i</span><span class="main">.</span> <span class="var">?P</span> <span class="main">(</span><span class="free">seq</span> <span class="bound">j</span><span class="main">)</span> <span class="main">(</span><span class="free">seq</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span><span class="skolem">i</span><span class="main">.</span> <span class="var">?P</span> <span class="main">(</span><span class="free">seq</span> <span class="bound">j</span><span class="main">)</span> <span class="main">(</span><span class="free">seq</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> <span class="skolem">I</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">(</span><span class="free">seq</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span><span class="free">seq</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">seq</span> <span class="skolem">i</span> <span class="main">∈</span> range <span class="free">seq</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">q</span><span class="main">∈</span><span class="skolem">T</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">q</span> <span class="main">(</span><span class="free">seq</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> *<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> <span class="skolem">T</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">q</span> <span class="main">(</span><span class="free">seq</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> <span class="skolem">I</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="free">seq</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> T <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="var">?P</span> <span class="skolem">q</span> <span class="main">(</span><span class="free">seq</span> <span class="skolem">i</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">=</span> <span class="free">seq</span> <span class="skolem">j</span>›</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span> x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">j</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">j</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span><span class="free">seq</span> <span class="skolem">i</span><span class="main">)</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="main">(</span><span class="free">seq</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?P1</span> <span class="main">(</span><span class="free">seq</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span><span class="free">seq</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ord_adds_term ord_term_lin.leD <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?P</span> <span class="main">(</span><span class="free">seq</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span><span class="free">seq</span> <span class="skolem">i</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="skolem">I</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">∈</span> <span class="skolem">I</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹inj <span class="free">seq</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">T</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">I</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> finite_image_iff inj_on_subset T<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-rb_termination"><span class="command">lemma</span></span> rb_termination<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">seq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">::</span>field<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dickson_grading <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"range <span class="free">seq</span> <span class="main">⊆</span> dgrad_sig_set <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> rep_list <span class="main">`</span> range <span class="free">seq</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="bound">j</span> <span class="main">⟹</span> lt <span class="main">(</span><span class="free">seq</span> <span class="bound">i</span><span class="main">)</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="main">(</span><span class="free">seq</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="main">(</span><span class="free">seq</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="bound">i</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="free">seq</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span>length <span class="free">fs</span><span class="main">.</span> lt <span class="main">(</span><span class="free">seq</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> lt <span class="main">(</span>monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'b</span><span class="main">)</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">seq</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">≼</span></span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span>monomial <span class="main">1</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span>
              <span class="main">(</span><span class="main">∃</span><span class="bound">j</span> <span class="bound">k</span><span class="main">.</span> is_regular_spair <span class="main">(</span><span class="free">seq</span> <span class="bound">j</span><span class="main">)</span> <span class="main">(</span><span class="free">seq</span> <span class="bound">k</span><span class="main">)</span> <span class="main">∧</span> rep_list <span class="main">(</span>spair <span class="main">(</span><span class="free">seq</span> <span class="bound">j</span><span class="main">)</span> <span class="main">(</span><span class="free">seq</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span>
                    lt <span class="main">(</span><span class="free">seq</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> lt <span class="main">(</span>spair <span class="main">(</span><span class="free">seq</span> <span class="bound">j</span><span class="main">)</span> <span class="main">(</span><span class="free">seq</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                    punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">seq</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">≼</span></span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span>spair <span class="main">(</span><span class="free">seq</span> <span class="bound">j</span><span class="main">)</span> <span class="main">(</span><span class="free">seq</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> is_sig_GB_upt <span class="free">d</span> <span class="main">(</span><span class="free">seq</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="bound">i</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span>lt <span class="main">(</span><span class="free">seq</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="free">thesis</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> range <span class="free">seq</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rep_list_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ord_term_lin.is_le_rel <span class="main">(=)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ord_term_lin.is_le_rel <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ord_term_lin.is_le_relI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"reflp <span class="main">(=)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"symp <span class="main">(=)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> symp_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"irreflp <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> irreflp_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> lt <span class="main">(</span><span class="free">seq</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
    <span class="keyword3"><span class="command">assume</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span><span class="free">seq</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> lt <span class="main">(</span><span class="free">seq</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="skolem">j</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> linorder_cases<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">j</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span><span class="free">seq</span> <span class="skolem">i</span><span class="main">)</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="main">(</span><span class="free">seq</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span><span class="free">seq</span> <span class="skolem">j</span><span class="main">)</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="main">(</span><span class="free">seq</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"inj <span class="free">seq</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> comp_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> inj_on_imageI2<span class="main">)</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">R</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> term_pp_rel <span class="main">(=)</span> <span class="main">(</span>lt <span class="main">(</span><span class="free">seq</span> <span class="bound">i</span><span class="main">)</span><span class="main">,</span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">seq</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> canon_term_pp_pair <span class="bound">x</span> <span class="main">∧</span> <span class="skolem">R</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">}</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?A</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">min_set</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">min_set</span> <span class="main">=</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span><span class="bound">i</span><span class="main">.</span> lt <span class="main">(</span><span class="free">seq</span> <span class="bound">j</span><span class="main">)</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> lt <span class="main">(</span><span class="free">seq</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∧</span>
                                      punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">seq</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">adds</span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">seq</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> cancel_term_pp_pair <span class="main">(</span>lt <span class="main">(</span><span class="free">seq</span> <span class="bound">i</span><span class="main">)</span><span class="main">,</span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">seq</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">min_set</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="skolem">t</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?A</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"canon_term_pp_pair <span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"term_pp_rel <span class="main">(=)</span> <span class="main">(</span>lt <span class="main">(</span><span class="free">seq</span> <span class="skolem">i</span><span class="main">)</span><span class="main">,</span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">seq</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> R_def<span class="main">)</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?equiv</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> term_pp_rel <span class="main">(=)</span> <span class="main">(</span>lt <span class="main">(</span><span class="free">seq</span> <span class="bound">i</span><span class="main">)</span><span class="main">,</span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">seq</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>lt <span class="main">(</span><span class="free">seq</span> <span class="bound">j</span><span class="main">)</span><span class="main">,</span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">seq</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> <span class="skolem">min_set</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?equiv</span> <span class="skolem">j</span> <span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="skolem">min_set</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?equiv</span> <span class="skolem">i</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> term_pp_rel_refl<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Q</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">seq</span> <span class="bound">j</span> <span class="main">|</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">j</span> <span class="main">&lt;</span> <span class="skolem">i</span> <span class="main">∧</span> is_sig_red <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">{</span><span class="free">seq</span> <span class="bound">j</span><span class="main">}</span> <span class="main">(</span><span class="free">seq</span> <span class="skolem">i</span><span class="main">)</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="main">⊆</span> range <span class="free">seq</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⊆</span> dgrad_sig_set <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="main">⊆</span> dgrad_max_set <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dgrad_sig_set'_def<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?Q</span> <span class="main">⊆</span> range <span class="free">seq</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">∉</span> range <span class="free">seq</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> <span class="var">?Q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> Q_sub<span class="main">:</span> <span class="quoted"><span class="quoted">"pp_of_term <span class="main">`</span> lt <span class="main">`</span> <span class="var">?Q</span> <span class="main">⊆</span> dgrad_set <span class="free">d</span> <span class="main">(</span>dgrad_max <span class="free">d</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> image_image <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> CollectI dgrad_p_setD_lp dgrad_set_def image_subset_iff subsetCE<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">g</span><span class="main">∈</span><span class="free">seq</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">k</span><span class="main">}</span><span class="main">.</span> is_sig_red <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">{</span><span class="bound">g</span><span class="main">}</span> <span class="main">(</span><span class="free">seq</span> <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∉</span> <span class="skolem">min_set</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">k</span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">from</span></span> that <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span><span class="free">seq</span> <span class="skolem">j</span><span class="main">)</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> lt <span class="main">(</span><span class="free">seq</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>
            <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">seq</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">adds</span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">seq</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> min_set_def<span class="main">)</span>
          <span class="keyword1"><span class="command">note</span></span> assms<span class="main">(</span>1<span class="main">,</span> 7<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">seq</span> <span class="skolem">k</span> <span class="main">∈</span> dgrad_sig_set <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">&lt;</span> <span class="skolem">k</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">seq</span> <span class="skolem">j</span> <span class="main">∈</span> <span class="free">seq</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">k</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="main">(</span><span class="free">seq</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="main">(</span><span class="free">seq</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="main">(</span><span class="free">seq</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">k</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="free">seq</span> <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a b <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lemma_21<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>5<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">k</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="main">(</span><span class="free">seq</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">k</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="free">seq</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_sig_red_top_tail_cases<span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(</span><span class="free">seq</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">k</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="free">seq</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_sig_red_sing_reg_cases<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g0</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g0</span> <span class="main">∈</span> <span class="free">seq</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">k</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">{</span><span class="skolem">g0</span><span class="main">}</span> <span class="main">(</span><span class="free">seq</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_red_singletonI<span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">qed</span></span>

        <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">OF</span> False<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g0</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g0</span> <span class="main">∈</span> <span class="free">seq</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">i</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">{</span><span class="skolem">g0</span><span class="main">}</span> <span class="main">(</span><span class="free">seq</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g0</span> <span class="main">∈</span> <span class="var">?Q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">g0</span> <span class="main">∈</span> lt <span class="main">`</span> <span class="var">?Q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> imageI<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> lt <span class="main">`</span> <span class="var">?Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> min<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v'</span><span class="main">.</span> <span class="bound">v'</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="skolem">v</span> <span class="main">⟹</span> <span class="bound">v'</span> <span class="main">∉</span> lt <span class="main">`</span> <span class="var">?Q</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Q_sub <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ord_term_minimum_dgrad_set<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">{</span><span class="free">seq</span> <span class="skolem">j</span><span class="main">}</span> <span class="main">(</span><span class="free">seq</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> lt <span class="main">(</span><span class="free">seq</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">seq</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">adds</span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">seq</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">seq</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="main">(</span><span class="free">seq</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">seq</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="main">(</span><span class="free">seq</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> is_sig_red_top_addsE<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?equiv</span> <span class="skolem">j</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> term_pp_rel_def 2<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> <span class="skolem">min_set</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∉</span> <span class="skolem">min_set</span>"</span></span>
            <span class="keyword1"><span class="command">from</span></span> *<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g1</span> <span class="main">∈</span> <span class="free">seq</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">j</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> red<span class="main">:</span> <span class="quoted"><span class="quoted">"is_sig_red <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">{</span><span class="skolem">g1</span><span class="main">}</span> <span class="main">(</span><span class="free">seq</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
            <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j0</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j0</span> <span class="main">&lt;</span> <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g1</span> <span class="main">=</span> <span class="free">seq</span> <span class="skolem">j0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>

            <span class="keyword1"><span class="command">from</span></span> red <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">seq</span> <span class="skolem">j0</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">adds</span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">seq</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword2"><span class="keyword">and</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">seq</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="main">(</span><span class="free">seq</span> <span class="skolem">j0</span><span class="main">)</span> <span class="main">=</span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">seq</span> <span class="skolem">j0</span><span class="main">)</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="main">(</span><span class="free">seq</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g1</span> <span class="main">=</span> <span class="free">seq</span> <span class="skolem">j0</span>›</span></span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> is_sig_red_top_addsE<span class="main">)</span>

            <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j0</span> <span class="main">&lt;</span> <span class="skolem">j</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">&lt;</span> <span class="skolem">i</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j0</span> <span class="main">&lt;</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j0</span> <span class="main">&lt;</span> <span class="skolem">j</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span><span class="free">seq</span> <span class="skolem">j0</span><span class="main">)</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> v <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span><span class="free">seq</span> <span class="skolem">j0</span><span class="main">)</span> <span class="main">∉</span> lt <span class="main">`</span><span class="var">?Q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> min<span class="main">)</span>
            <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j0</span> <span class="main">&lt;</span> <span class="skolem">i</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">{</span><span class="free">seq</span> <span class="skolem">j0</span><span class="main">}</span> <span class="main">(</span><span class="free">seq</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">{</span><span class="free">seq</span> <span class="skolem">j0</span><span class="main">}</span> <span class="main">(</span><span class="free">seq</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_red_top_addsI<span class="main">)</span>
              <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="main">(</span><span class="free">seq</span> <span class="skolem">j0</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="main">(</span><span class="free">seq</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword1"><span class="command">from</span></span> 3 1 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">seq</span> <span class="skolem">j0</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">adds</span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">seq</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> adds_trans<span class="main">)</span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword1"><span class="command">from</span></span> 4 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?equiv</span> <span class="skolem">j0</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> term_pp_rel_def<span class="main">)</span>
              <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> 2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?equiv</span> <span class="skolem">j</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> term_pp_rel_def<span class="main">)</span>
              <span class="keyword1"><span class="command">finally</span></span><span class="main">(</span>term_pp_rel_trans<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹ord_term_lin.is_le_rel <span class="main">(=)</span>›</span></span><span class="main">]</span><span class="main">)</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">seq</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="main">(</span><span class="free">seq</span> <span class="skolem">j0</span><span class="main">)</span> <span class="main">=</span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">seq</span> <span class="skolem">j0</span><span class="main">)</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="main">(</span><span class="free">seq</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> term_pp_rel_def<span class="main">)</span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ord_term_lin.is_le_rel <span class="main">(=)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"term_pp_rel <span class="main">(=)</span> <span class="main">(</span>cancel_term_pp_pair <span class="main">(</span>lt <span class="main">(</span><span class="free">seq</span> <span class="skolem">j</span><span class="main">)</span><span class="main">,</span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">seq</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>lt <span class="main">(</span><span class="free">seq</span> <span class="skolem">j</span><span class="main">)</span><span class="main">,</span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">seq</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> term_pp_rel_sym<span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span> <span class="quoted"><span class="quoted">‹symp <span class="main">(=)</span>›</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> term_pp_rel_cancel<span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span> <span class="quoted"><span class="quoted">‹reflp <span class="main">(=)</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?equiv</span> <span class="skolem">j</span> <span class="skolem">i</span>›</span></span>
      <span class="keyword1"><span class="command">also</span></span><span class="main">(</span>term_pp_rel_trans<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹ord_term_lin.is_le_rel <span class="main">(=)</span>›</span></span><span class="main">]</span><span class="main">)</span> <span class="keyword1"><span class="command">note</span></span> x
      <span class="keyword1"><span class="command">finally</span></span><span class="main">(</span>term_pp_rel_trans<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹ord_term_lin.is_le_rel <span class="main">(=)</span>›</span></span><span class="main">]</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"term_pp_rel <span class="main">(=)</span> <span class="main">(</span>cancel_term_pp_pair <span class="main">(</span>lt <span class="main">(</span><span class="free">seq</span> <span class="skolem">j</span><span class="main">)</span><span class="main">,</span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">seq</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹symp <span class="main">(=)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"term_pp_rel <span class="main">(=)</span> <span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">(</span>cancel_term_pp_pair <span class="main">(</span>lt <span class="main">(</span><span class="free">seq</span> <span class="skolem">j</span><span class="main">)</span><span class="main">,</span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">seq</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> term_pp_rel_sym<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> cancel_term_pp_pair <span class="main">(</span>lt <span class="main">(</span><span class="free">seq</span> <span class="skolem">j</span><span class="main">)</span><span class="main">,</span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">seq</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹canon_term_pp_pair <span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span>›</span></span> canon_term_pp_cancel <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> canon_term_pp_rel_id<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">∈</span> <span class="skolem">min_set</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> cancel_term_pp_pair <span class="main">(</span>lt <span class="main">(</span><span class="free">seq</span> <span class="bound">i</span><span class="main">)</span><span class="main">,</span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">seq</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">min_set</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> cancel_term_pp_pair <span class="main">(</span>lt <span class="main">(</span><span class="free">seq</span> <span class="bound">i</span><span class="main">)</span><span class="main">,</span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">seq</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">min_set</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> finite_imageI<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">min_set</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> min_set_def <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1-4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> min_set_finite<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"range <span class="free">seq</span> <span class="main">⊆</span> <span class="free">seq</span> <span class="main">`</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span><span class="skolem">R</span> <span class="main">`</span> <span class="var">?A</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> image_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span><span class="skolem">R</span> <span class="main">`</span> <span class="var">?A</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="main">(</span>cancel_term_pp_pair <span class="main">(</span>lt <span class="main">(</span><span class="free">seq</span> <span class="skolem">i</span><span class="main">)</span><span class="main">,</span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">seq</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R_def term_pp_rel_cancel<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"cancel_term_pp_pair <span class="main">(</span>lt <span class="main">(</span><span class="free">seq</span> <span class="skolem">i</span><span class="main">)</span><span class="main">,</span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">seq</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?A</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> canon_term_pp_cancel <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹inj <span class="free">seq</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>range <span class="free">seq</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> range_inj_infinite<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span><span class="free">seq</span> <span class="main">`</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span><span class="skolem">R</span> <span class="main">`</span> <span class="var">?A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> infinite_super<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">seq</span> <span class="main">`</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span><span class="skolem">R</span> <span class="main">`</span> <span class="var">?A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> finite_imageI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> finite_UN_I<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?A</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?rel</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"term_pp_rel <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"irreflp <span class="var">?rel</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> irreflpI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> term_pp_rel_irrefl<span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"transp <span class="var">?rel</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> transpI<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule</span> term_pp_rel_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹ord_term_lin.is_le_rel <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"wfp_on <span class="var">?rel</span> <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹finite <span class="var">?A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> wfp_on_finite<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="skolem">R</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?A</span>›</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> wfp_on_induct<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>less <span class="skolem">x</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> less<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"canon_term_pp_pair <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">R'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">" <span class="skolem">R'</span> <span class="main">=</span> <span class="main">⋃</span> <span class="main">(</span><span class="skolem">R</span> <span class="main">`</span> <span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> canon_term_pp_pair <span class="bound">x</span> <span class="main">∧</span> <span class="skolem">R</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="bound">z</span><span class="main">.</span> term_pp_rel <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="bound">z</span> <span class="skolem">x</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">red_set</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">red_set</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">::</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">.</span> <span class="main">{</span><span class="bound">k</span><span class="main">.</span> lt <span class="main">(</span><span class="free">seq</span> <span class="bound">k</span><span class="main">)</span> <span class="main">=</span> lt <span class="bound">p</span> <span class="main">∧</span>
                                              punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">seq</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">≼</span></span> punit.lt <span class="main">(</span>rep_list <span class="bound">p</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> finite_red_set<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="skolem">red_set</span> <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">p</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">red_set</span> <span class="skolem">p</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> lt_k<span class="main">:</span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span><span class="free">seq</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> lt <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> red_set_def<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">red_set</span> <span class="skolem">p</span> <span class="main">⊆</span> <span class="main">{</span><span class="skolem">k</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k'</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k'</span> <span class="main">∈</span> <span class="skolem">red_set</span> <span class="skolem">p</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span><span class="free">seq</span> <span class="skolem">k'</span><span class="main">)</span> <span class="main">=</span> lt <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> red_set_def<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span><span class="free">seq</span> <span class="skolem">k'</span><span class="main">)</span> <span class="main">=</span> lt <span class="main">(</span><span class="free">seq</span> <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> lt_k<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹inj <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> lt <span class="main">(</span><span class="free">seq</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k'</span> <span class="main">=</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> injD<span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k'</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">k</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> infinite_super <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="skolem">x</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">i</span><span class="main">∈</span><span class="skolem">R'</span><span class="main">.</span> <span class="main">⋃</span><span class="bound">j</span><span class="main">∈</span><span class="skolem">R'</span><span class="main">.</span> <span class="skolem">red_set</span> <span class="main">(</span>spair <span class="main">(</span><span class="free">seq</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="free">seq</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span>
                   <span class="main">(</span><span class="main">⋃</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">fs</span><span class="main">}</span><span class="main">.</span> <span class="skolem">red_set</span> <span class="main">(</span>monomial <span class="main">1</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⊆</span> <span class="var">?B</span> <span class="main">∪</span> <span class="var">?C</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> i_x<span class="main">:</span> <span class="quoted"><span class="quoted">"term_pp_rel <span class="main">(=)</span> <span class="main">(</span>lt <span class="main">(</span><span class="free">seq</span> <span class="skolem">i</span><span class="main">)</span><span class="main">,</span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">seq</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R_def term_pp_rel_def<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>6<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="var">?B</span> <span class="main">∪</span> <span class="var">?C</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">elim</span> disjE exE conjE<span class="main">)</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">fs</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">fs</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span><span class="free">seq</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> lt <span class="main">(</span>monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'b</span><span class="main">)</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">seq</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">≼</span></span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span>monomial <span class="main">1</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="skolem">red_set</span> <span class="main">(</span>monomial <span class="main">1</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> red_set_def<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">fs</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="var">?C</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span> <span class="skolem">k</span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?li</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">seq</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?lj</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">seq</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?lk</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">seq</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword3"><span class="command">assume</span></span> lt_i<span class="main">:</span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span><span class="free">seq</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> lt <span class="main">(</span>spair <span class="main">(</span><span class="free">seq</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span><span class="free">seq</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword2"><span class="keyword">and</span></span> lt_i'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?li</span> <span class="main"><span class="free">≼</span></span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span>spair <span class="main">(</span><span class="free">seq</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span><span class="free">seq</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword2"><span class="keyword">and</span></span> spair_0<span class="main">:</span> <span class="quoted"><span class="quoted">"rep_list <span class="main">(</span>spair <span class="main">(</span><span class="free">seq</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span><span class="free">seq</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="skolem">red_set</span> <span class="main">(</span>spair <span class="main">(</span><span class="free">seq</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span><span class="free">seq</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> red_set_def<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> i_0<span class="main">:</span> <span class="quoted"><span class="quoted">"rep_list <span class="main">(</span><span class="free">seq</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> j_0<span class="main">:</span> <span class="quoted"><span class="quoted">"rep_list <span class="main">(</span><span class="free">seq</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
            <span class="keyword2"><span class="keyword">and</span></span> k_0<span class="main">:</span> <span class="quoted"><span class="quoted">"rep_list <span class="main">(</span><span class="free">seq</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>

          <span class="keyword1"><span class="command">have</span></span> R'I<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="skolem">R'</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"term_pp_rel <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(</span>lt <span class="main">(</span><span class="free">seq</span> <span class="skolem">a</span><span class="main">)</span><span class="main">,</span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">seq</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cancel_term_pp_pair <span class="main">(</span>lt <span class="main">(</span><span class="free">seq</span> <span class="skolem">a</span><span class="main">)</span><span class="main">,</span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">seq</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> R'_def
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> UN_I<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="skolem">R</span> <span class="var">?x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> R_def term_pp_rel_cancel<span class="main">)</span>
              <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="var">?x</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹ord_term_lin.is_le_rel <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span>›</span></span>
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"term_pp_rel <span class="main">(=)</span> <span class="var">?x</span> <span class="main">(</span>lt <span class="main">(</span><span class="free">seq</span> <span class="skolem">a</span><span class="main">)</span><span class="main">,</span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">seq</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> term_pp_rel_sym<span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> term_pp_rel_cancel<span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span><span class="main">)</span>
              <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"term_pp_rel <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="var">?x</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> term_pp_rel_trans_eq_left<span class="main">)</span>
            <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">fact</span> canon_term_pp_cancel<span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>

          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_regular_spair <span class="main">(</span><span class="free">seq</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span><span class="free">seq</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lk</span> <span class="main">⊕</span> lt <span class="main">(</span><span class="free">seq</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">≠</span> <span class="var">?lj</span> <span class="main">⊕</span> lt <span class="main">(</span><span class="free">seq</span> <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_regular_spairD3<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"term_pp_rel <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(</span>lt <span class="main">(</span><span class="free">seq</span> <span class="skolem">j</span><span class="main">)</span><span class="main">,</span> <span class="var">?lj</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">∧</span> term_pp_rel <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(</span>lt <span class="main">(</span><span class="free">seq</span> <span class="skolem">k</span><span class="main">)</span><span class="main">,</span> <span class="var">?lk</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ord_term_lin.neqE<span class="main">)</span>
            <span class="keyword3"><span class="command">assume</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?lk</span> <span class="main">⊕</span> lt <span class="main">(</span><span class="free">seq</span> <span class="skolem">j</span><span class="main">)</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="var">?lj</span> <span class="main">⊕</span> lt <span class="main">(</span><span class="free">seq</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">hence</span></span> j_k<span class="main">:</span> <span class="quoted"><span class="quoted">"term_pp_rel <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(</span>lt <span class="main">(</span><span class="free">seq</span> <span class="skolem">j</span><span class="main">)</span><span class="main">,</span> <span class="var">?lj</span><span class="main">)</span> <span class="main">(</span>lt <span class="main">(</span><span class="free">seq</span> <span class="skolem">k</span><span class="main">)</span><span class="main">,</span> <span class="var">?lk</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> term_pp_rel_def<span class="main">)</span>
            <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹ord_term_lin.is_le_rel <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span>›</span></span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"term_pp_rel <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(</span>lt <span class="main">(</span><span class="free">seq</span> <span class="skolem">k</span><span class="main">)</span><span class="main">,</span> <span class="var">?lk</span><span class="main">)</span> <span class="main">(</span>lt <span class="main">(</span><span class="free">seq</span> <span class="skolem">i</span><span class="main">)</span><span class="main">,</span> <span class="var">?li</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> term_pp_rel_def<span class="main">)</span>
              <span class="keyword1"><span class="command">from</span></span> lt_i' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?li</span> <span class="main">⊕</span> lt <span class="main">(</span><span class="free">seq</span> <span class="skolem">k</span><span class="main">)</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span>
                                punit.lt <span class="main">(</span>rep_list <span class="main">(</span>spair <span class="main">(</span><span class="free">seq</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span><span class="free">seq</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="main">(</span><span class="free">seq</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> splus_mono_left<span class="main">)</span>
              <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="main">(</span><span class="var">?lk</span> <span class="main">-</span> gcs <span class="var">?lk</span> <span class="var">?lj</span> <span class="main">+</span> <span class="var">?lj</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="main">(</span><span class="free">seq</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> splus_mono_strict_left<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> lt_rep_list_spair<span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> add.commute<span class="main">)</span>
              <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="var">?lk</span> <span class="main">+</span> <span class="var">?lj</span><span class="main">)</span> <span class="main">-</span> gcs <span class="var">?lj</span> <span class="var">?lk</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="main">(</span><span class="free">seq</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> minus_plus gcs_adds_2 gcs_comm<span class="main">)</span>
              <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?lk</span> <span class="main">⊕</span> <span class="main">(</span><span class="main">(</span><span class="var">?lj</span> <span class="main">-</span> gcs <span class="var">?lj</span> <span class="var">?lk</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="main">(</span><span class="free">seq</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> minus_plus' gcs_adds splus_assoc<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?lk</span> <span class="main">⊕</span> lt <span class="main">(</span><span class="free">seq</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lt_spair'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> k_0 _ c<span class="main"><span class="main">]</span></span> add.commute spair_comm<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">seq</span> <span class="skolem">j</span>"</span></span><span class="main"><span class="main">]</span></span> lt_i<span class="main">)</span>
              <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?li</span> <span class="main">⊕</span> lt <span class="main">(</span><span class="free">seq</span> <span class="skolem">k</span><span class="main">)</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="var">?lk</span> <span class="main">⊕</span> lt <span class="main">(</span><span class="free">seq</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"term_pp_rel <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(</span>lt <span class="main">(</span><span class="free">seq</span> <span class="skolem">k</span><span class="main">)</span><span class="main">,</span> <span class="var">?lk</span><span class="main">)</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i_x
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> term_pp_rel_trans_eq_right<span class="main">)</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹ord_term_lin.is_le_rel <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span>›</span></span> j_k this
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"term_pp_rel <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(</span>lt <span class="main">(</span><span class="free">seq</span> <span class="skolem">j</span><span class="main">)</span><span class="main">,</span> <span class="var">?lj</span><span class="main">)</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> term_pp_rel_trans<span class="main">)</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">assume</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?lj</span> <span class="main">⊕</span> lt <span class="main">(</span><span class="free">seq</span> <span class="skolem">k</span><span class="main">)</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="var">?lk</span> <span class="main">⊕</span> lt <span class="main">(</span><span class="free">seq</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">hence</span></span> j_k<span class="main">:</span> <span class="quoted"><span class="quoted">"term_pp_rel <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(</span>lt <span class="main">(</span><span class="free">seq</span> <span class="skolem">k</span><span class="main">)</span><span class="main">,</span> <span class="var">?lk</span><span class="main">)</span> <span class="main">(</span>lt <span class="main">(</span><span class="free">seq</span> <span class="skolem">j</span><span class="main">)</span><span class="main">,</span> <span class="var">?lj</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> term_pp_rel_def<span class="main">)</span>
            <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹ord_term_lin.is_le_rel <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span>›</span></span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"term_pp_rel <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(</span>lt <span class="main">(</span><span class="free">seq</span> <span class="skolem">j</span><span class="main">)</span><span class="main">,</span> <span class="var">?lj</span><span class="main">)</span> <span class="main">(</span>lt <span class="main">(</span><span class="free">seq</span> <span class="skolem">i</span><span class="main">)</span><span class="main">,</span> <span class="var">?li</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> term_pp_rel_def<span class="main">)</span>
              <span class="keyword1"><span class="command">from</span></span> lt_i' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?li</span> <span class="main">⊕</span> lt <span class="main">(</span><span class="free">seq</span> <span class="skolem">j</span><span class="main">)</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span>
                                punit.lt <span class="main">(</span>rep_list <span class="main">(</span>spair <span class="main">(</span><span class="free">seq</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span><span class="free">seq</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="main">(</span><span class="free">seq</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> splus_mono_left<span class="main">)</span>
              <span class="keyword1"><span class="command">thm</span></span> lt_rep_list_spair
              <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="main">(</span><span class="var">?lk</span> <span class="main">-</span> gcs <span class="var">?lk</span> <span class="var">?lj</span> <span class="main">+</span> <span class="var">?lj</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="main">(</span><span class="free">seq</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> splus_mono_strict_left<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> lt_rep_list_spair<span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> add.commute<span class="main">)</span>
              <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="var">?lk</span> <span class="main">+</span> <span class="var">?lj</span><span class="main">)</span> <span class="main">-</span> gcs <span class="var">?lk</span> <span class="var">?lj</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="main">(</span><span class="free">seq</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> minus_plus gcs_adds_2 gcs_comm<span class="main">)</span>
              <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?lj</span> <span class="main">⊕</span> <span class="main">(</span><span class="main">(</span><span class="var">?lk</span> <span class="main">-</span> gcs <span class="var">?lk</span> <span class="var">?lj</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="main">(</span><span class="free">seq</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> minus_plus' gcs_adds splus_assoc<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> add.commute<span class="main">)</span>
              <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?lj</span> <span class="main">⊕</span> lt <span class="main">(</span><span class="free">seq</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lt_spair'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> j_0 _ c<span class="main"><span class="main">]</span></span> lt_i add.commute<span class="main">)</span>
              <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?li</span> <span class="main">⊕</span> lt <span class="main">(</span><span class="free">seq</span> <span class="skolem">j</span><span class="main">)</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="var">?lj</span> <span class="main">⊕</span> lt <span class="main">(</span><span class="free">seq</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"term_pp_rel <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(</span>lt <span class="main">(</span><span class="free">seq</span> <span class="skolem">j</span><span class="main">)</span><span class="main">,</span> <span class="var">?lj</span><span class="main">)</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i_x
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> term_pp_rel_trans_eq_right<span class="main">)</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹ord_term_lin.is_le_rel <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span>›</span></span> j_k this
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"term_pp_rel <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(</span>lt <span class="main">(</span><span class="free">seq</span> <span class="skolem">k</span><span class="main">)</span><span class="main">,</span> <span class="var">?lk</span><span class="main">)</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> term_pp_rel_trans<span class="main">)</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">∈</span> <span class="skolem">red_set</span> <span class="main">(</span>spair <span class="main">(</span><span class="free">seq</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span><span class="free">seq</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> R'I <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="var">?B</span> <span class="main">∪</span> <span class="var">?C</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> finite_UnI<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">R'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> R'_def
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> finite_UN_I<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹finite <span class="var">?A</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="var">?A</span> <span class="main">∩</span> <span class="main">{</span><span class="bound">z</span><span class="main">.</span> term_pp_rel <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="bound">z</span> <span class="skolem">x</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="var">?A</span> <span class="main">∩</span> <span class="main">{</span><span class="bound">z</span><span class="main">.</span> term_pp_rel <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="bound">z</span> <span class="skolem">x</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="var">?A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"term_pp_rel <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="skolem">y</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="skolem">R</span> <span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> less<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> finite_UN_I <span class="quoted"><span class="quoted">‹finite <span class="skolem">R'</span>›</span></span> finite_red_set<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> finite_UN_I finite_atLeastLessThan finite_red_set<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Concrete Rewrite Orders›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_strict_rewrite_ord</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_strict_rewrite_ord</span> <span class="free"><span class="bound"><span class="entity">rel</span></span></span> <span class="main">⟷</span> is_rewrite_ord <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">¬</span> <span class="free"><span class="bound"><span class="entity">rel</span></span></span> <span class="bound">y</span> <span class="bound">x</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Signature_Groebner-is_strict_rewrite_ordI"><span class="command">lemma</span></span> is_strict_rewrite_ordI<span class="main">:</span> <span class="quoted"><span class="quoted">"is_rewrite_ord <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">¬</span> <span class="free">rel</span> <span class="bound">y</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span> is_strict_rewrite_ord <span class="free">rel</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> is_strict_rewrite_ord_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Signature_Groebner-is_strict_rewrite_ordD"><span class="command">lemma</span></span> is_strict_rewrite_ordD<span class="main">:</span> <span class="quoted"><span class="quoted">"is_strict_rewrite_ord <span class="free">rel</span> <span class="main">⟹</span> is_rewrite_ord <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">¬</span> <span class="free">rel</span> <span class="bound">y</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> is_strict_rewrite_ord_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Signature_Groebner-is_strict_rewrite_ord_antisym"><span class="command">lemma</span></span> is_strict_rewrite_ord_antisym<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_strict_rewrite_ord <span class="free">rel</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">rel</span> <span class="free">x</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">rel</span> <span class="free">y</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fst <span class="free">x</span> <span class="main">=</span> fst <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_rewrite_ordD4<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> is_strict_rewrite_ordD<span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-is_strict_rewrite_ord_asym"><span class="command">lemma</span></span> is_strict_rewrite_ord_asym<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_strict_rewrite_ord <span class="free">rel</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">rel</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">rel</span> <span class="free">y</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_rewrite_ord <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">¬</span> <span class="free">rel</span> <span class="bound">y</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_strict_rewrite_ordD<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> is_rewrite_ordD3<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">¬</span> <span class="free">rel</span> <span class="free">y</span> <span class="free">x</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">rel</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">rel</span> <span class="free">x</span> <span class="free">y</span>›</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-is_strict_rewrite_ord_irrefl"><span class="command">lemma</span></span> is_strict_rewrite_ord_irrefl<span class="main">:</span> <span class="quoted"><span class="quoted">"is_strict_rewrite_ord <span class="free">rel</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">rel</span> <span class="free">x</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> is_strict_rewrite_ord_asym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rw_rat</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">rw_rat</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">u</span> <span class="main">=</span> punit.lt <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">⊕</span> fst <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">;</span> <span class="bound">v</span> <span class="main">=</span> punit.lt <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">⊕</span> fst <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="keyword1">in</span>
                          <span class="bound">u</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="bound">v</span> <span class="main">∨</span> <span class="main">(</span><span class="bound">u</span> <span class="main">=</span> <span class="bound">v</span> <span class="main">∧</span> fst <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> fst <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rw_rat_strict</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">rw_rat_strict</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">u</span> <span class="main">=</span> punit.lt <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">⊕</span> fst <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">;</span> <span class="bound">v</span> <span class="main">=</span> punit.lt <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">⊕</span> fst <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="keyword1">in</span>
                          <span class="bound">u</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="bound">v</span> <span class="main">∨</span> <span class="main">(</span><span class="bound">u</span> <span class="main">=</span> <span class="bound">v</span> <span class="main">∧</span> fst <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> fst <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rw_add</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">rw_add</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">⟷</span> <span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> fst <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rw_add_strict</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">rw_add_strict</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">⟷</span> <span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> fst <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Signature_Groebner-rw_rat_alt"><span class="command">lemma</span></span> rw_rat_alt<span class="main">:</span> <span class="quoted"><span class="quoted">"rw_rat <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">p</span> <span class="bound">q</span><span class="main">.</span> <span class="main">¬</span> rw_rat_strict <span class="bound">q</span> <span class="bound">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rw_rat_def rw_rat_strict_def Let_def<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-rw_rat_is_rewrite_ord"><span class="command">lemma</span></span> rw_rat_is_rewrite_ord<span class="main">:</span> <span class="quoted"><span class="quoted">"is_rewrite_ord rw_rat"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> is_rewrite_ordI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"reflp rw_rat"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reflp_def rw_rat_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"ord_term_lin.is_le_rel <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"ord_term_lin.is_le_rel <span class="main">(=)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ord_term_lin.is_le_relI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rw_rat <span class="skolem">p</span> <span class="skolem">q</span> <span class="main">⟷</span> <span class="main">(</span>term_pp_rel <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(</span>fst <span class="skolem">p</span><span class="main">,</span> punit.lt <span class="main">(</span>snd <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fst <span class="skolem">q</span><span class="main">,</span> punit.lt <span class="main">(</span>snd <span class="skolem">q</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span>
                        <span class="main">(</span>term_pp_rel <span class="main">(=)</span> <span class="main">(</span>fst <span class="skolem">p</span><span class="main">,</span> punit.lt <span class="main">(</span>snd <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fst <span class="skolem">q</span><span class="main">,</span> punit.lt <span class="main">(</span>snd <span class="skolem">q</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                          fst <span class="skolem">p</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> fst <span class="skolem">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">p</span> <span class="skolem">q</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rw_rat_def term_pp_rel_def Let_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"transp rw_rat"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> transp_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> term_pp_rel_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> 1<span class="main"><span class="main">]</span></span> term_pp_rel_trans_eq_left<span class="main"><span class="main">[</span></span><span class="operator">OF</span> 1<span class="main"><span class="main">]</span></span>
        term_pp_rel_trans_eq_right<span class="main"><span class="main">[</span></span><span class="operator">OF</span> 1<span class="main"><span class="main">]</span></span> term_pp_rel_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> 2<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">q</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rw_rat <span class="skolem">p</span> <span class="skolem">q</span> <span class="main">∨</span> rw_rat <span class="skolem">q</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rw_rat_def Let_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">q</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"rw_rat <span class="skolem">p</span> <span class="skolem">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rw_rat <span class="skolem">q</span> <span class="skolem">p</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"fst <span class="skolem">p</span> <span class="main">=</span> fst <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rw_rat_def Let_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">d</span> <span class="skolem">G</span> <span class="skolem">p</span> <span class="skolem">q</span>
  <span class="keyword3"><span class="command">assume</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"dickson_grading <span class="skolem">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> gb<span class="main">:</span> <span class="quoted"><span class="quoted">"is_sig_GB_upt <span class="skolem">d</span> <span class="skolem">G</span> <span class="main">(</span>lt <span class="skolem">q</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="skolem">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> <span class="skolem">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">p</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> lt <span class="skolem">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="skolem">G</span> <span class="skolem">q</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?u</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="skolem">q</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">p</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?v</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="skolem">p</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">q</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹lt <span class="skolem">p</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> lt <span class="skolem">q</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> lt_q<span class="main">:</span> <span class="quoted"><span class="quoted">"lt <span class="skolem">q</span> <span class="main">=</span> <span class="skolem">t</span> <span class="main">⊕</span> lt <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> adds_termE<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> gb <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">⊆</span> dgrad_sig_set <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_GB_uptD1<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">⊆</span> dgrad_max_set <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dgrad_sig_set'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> d <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="keyword2"><span class="keyword">where</span></span> red<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="skolem">G</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>monom_mult <span class="main">1</span> <span class="skolem">t</span> <span class="skolem">p</span><span class="main">)</span> <span class="skolem">p'</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="skolem">G</span> <span class="skolem">p'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_irredE_dgrad_max_set<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> red <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">p'</span> <span class="main">=</span> lt <span class="main">(</span>monom_mult <span class="main">1</span> <span class="skolem">t</span> <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lc <span class="skolem">p'</span> <span class="main">=</span> lc <span class="main">(</span>monom_mult <span class="main">1</span> <span class="skolem">t</span> <span class="skolem">p</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span> <span class="main"><span class="free">≼</span></span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span>monom_mult <span class="main">1</span> <span class="skolem">t</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_regular_rtrancl_lt<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> sig_red_regular_rtrancl_lc<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> sig_red_rtrancl_lt_rep_list<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">p'</span> <span class="main">=</span> lt <span class="skolem">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lc <span class="skolem">p'</span> <span class="main">=</span> lc <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lt_q lt_monom_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 2 punit.lt_monom_mult_le<span class="main">[</span><span class="operator">simplified</span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span> <span class="main"><span class="free">≼</span></span> <span class="skolem">t</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> rep_list_monom_mult <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ordered_powerprod_lin.order_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span> <span class="main">=</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sig_regular_top_reduced_lt_unique<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">∈</span> dgrad_sig_set <span class="skolem">d</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> dgrad_sig_set_closed_sig_red_rtrancl<span class="main">)</span>
      <span class="keyword1"><span class="command">note</span></span> d
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="skolem">t</span> <span class="main">≤</span> dgrad_max <span class="skolem">d</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> le_trans<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="keyword1">adds</span> lp <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lt_q <span class="dynamic"><span class="dynamic">term_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> d <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="skolem">t</span> <span class="main">≤</span> <span class="skolem">d</span> <span class="main">(</span>lp <span class="skolem">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dickson_grading_adds_imp_le<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">∈</span> <span class="skolem">G</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">G</span> <span class="main">⊆</span> dgrad_max_set <span class="skolem">d</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> dgrad_max_set <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">(</span>lp <span class="skolem">q</span><span class="main">)</span> <span class="main">≤</span> dgrad_max <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dgrad_p_setD_lp<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">∈</span> <span class="skolem">G</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">G</span> <span class="main">⊆</span> dgrad_sig_set <span class="skolem">d</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> dgrad_sig_set <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"monom_mult <span class="main">1</span> <span class="skolem">t</span> <span class="skolem">p</span> <span class="main">∈</span> dgrad_sig_set <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dgrad_sig_set_closed_monom_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">∈</span> <span class="skolem">G</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">G</span> <span class="main">⊆</span> dgrad_sig_set <span class="skolem">d</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> dgrad_sig_set <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹lc <span class="skolem">p'</span> <span class="main">=</span> lc <span class="skolem">p</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lc_eq_zero_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">with</span></span> 3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="skolem">q</span><span class="main">)</span> <span class="main"><span class="free">≼</span></span> <span class="skolem">t</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?u</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="main">(</span><span class="skolem">t</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> splus_mono_left<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lt_q splus_assoc splus_left_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?u</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="var">?v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> rel_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹lt <span class="skolem">p</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> lt <span class="skolem">q</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">p</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ord_adds_term<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rw_rat <span class="main">(</span>spp_of <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>spp_of <span class="skolem">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rw_rat_def Let_def spp_of_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-rw_rat_strict_is_strict_rewrite_ord"><span class="command">lemma</span></span> rw_rat_strict_is_strict_rewrite_ord<span class="main">:</span> <span class="quoted"><span class="quoted">"is_strict_rewrite_ord rw_rat_strict"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> is_strict_rewrite_ordI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_rewrite_ord <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">¬</span> rw_rat_strict <span class="bound">y</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> rw_rat_alt<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> rw_rat_is_rewrite_ord<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-rw_add_alt"><span class="command">lemma</span></span> rw_add_alt<span class="main">:</span> <span class="quoted"><span class="quoted">"rw_add <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">p</span> <span class="bound">q</span><span class="main">.</span> <span class="main">¬</span> rw_add_strict <span class="bound">q</span> <span class="bound">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rw_add_def rw_add_strict_def<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-rw_add_is_rewrite_ord"><span class="command">lemma</span></span> rw_add_is_rewrite_ord<span class="main">:</span> <span class="quoted"><span class="quoted">"is_rewrite_ord rw_add"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> is_rewrite_ordI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"reflp rw_add"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reflp_def rw_add_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"transp rw_add"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> transp_def rw_add_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">q</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rw_add <span class="skolem">p</span> <span class="skolem">q</span> <span class="main">∨</span> rw_add <span class="skolem">q</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> rw_add_def ord_term_lin.linear<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">q</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"rw_add <span class="skolem">p</span> <span class="skolem">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rw_add <span class="skolem">q</span> <span class="skolem">p</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"fst <span class="skolem">p</span> <span class="main">=</span> fst <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> rw_add_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">p</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> lt <span class="skolem">q</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"rw_add <span class="main">(</span>spp_of <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>spp_of <span class="skolem">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> rw_add_def spp_of_def fst_conv <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ord_adds_term<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-rw_add_strict_is_strict_rewrite_ord"><span class="command">lemma</span></span> rw_add_strict_is_strict_rewrite_ord<span class="main">:</span> <span class="quoted"><span class="quoted">"is_strict_rewrite_ord rw_add_strict"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> is_strict_rewrite_ordI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_rewrite_ord <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">¬</span> rw_add_strict <span class="bound">y</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> rw_add_alt<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> rw_add_is_rewrite_ord<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Preparations for Sig-Poly-Pairs›</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">dgrad</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> nat"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">spp_rel</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">spp_rel</span> <span class="free"><span class="bound"><span class="entity">sp</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">∈</span> dgrad_sig_set <span class="free">dgrad</span> <span class="main">∧</span> lt <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">=</span> fst <span class="free"><span class="bound"><span class="entity">sp</span></span></span> <span class="main">∧</span> rep_list <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">=</span> snd <span class="free"><span class="bound"><span class="entity">sp</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">spp_inv</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">spp_inv</span> <span class="free"><span class="bound"><span class="entity">sp</span></span></span> <span class="main">⟷</span> Ex <span class="main">(</span>spp_rel <span class="free"><span class="bound"><span class="entity">sp</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">vec_of</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">vec_of</span> <span class="free"><span class="bound"><span class="entity">sp</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> spp_inv <span class="free"><span class="bound"><span class="entity">sp</span></span></span> <span class="keyword1">then</span> Eps <span class="main">(</span>spp_rel <span class="free"><span class="bound"><span class="entity">sp</span></span></span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Signature_Groebner-spp_inv_spp_of"><span class="command">lemma</span></span> spp_inv_spp_of<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> dgrad_sig_set <span class="free">dgrad</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"spp_inv <span class="main">(</span>spp_of <span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> spp_inv_def spp_rel_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI conjI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lt <span class="free">r</span> <span class="main">=</span> fst <span class="main">(</span>spp_of <span class="free">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> spp_of_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">r</span> <span class="main">=</span> snd <span class="main">(</span>spp_of <span class="free">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> spp_of_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">sp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> spi<span class="main">:</span> <span class="quoted"><span class="quoted">"spp_inv <span class="free">sp</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Signature_Groebner-sig_poly_rel_vec_of"><span class="command">lemma</span></span> sig_poly_rel_vec_of<span class="main">:</span> <span class="quoted"><span class="quoted">"spp_rel <span class="free">sp</span> <span class="main">(</span>vec_of <span class="free">sp</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> spi <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"vec_of <span class="free">sp</span> <span class="main">=</span> Eps <span class="main">(</span>spp_rel <span class="free">sp</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_of_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> spi <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> eq spp_inv_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> someI_ex<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-vec_of_nonzero"><span class="command">lemma</span></span> vec_of_nonzero<span class="main">:</span> <span class="quoted"><span class="quoted">"vec_of <span class="free">sp</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> sig_poly_rel_vec_of <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> spp_rel_def<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-lt_vec_of"><span class="command">lemma</span></span> lt_vec_of<span class="main">:</span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span>vec_of <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> fst <span class="free">sp</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> sig_poly_rel_vec_of <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> spp_rel_def<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-rep_list_vec_of"><span class="command">lemma</span></span> rep_list_vec_of<span class="main">:</span> <span class="quoted"><span class="quoted">"rep_list <span class="main">(</span>vec_of <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> snd <span class="free">sp</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> sig_poly_rel_vec_of <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> spp_rel_def<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-spp_of_vec_of"><span class="command">lemma</span></span> spp_of_vec_of<span class="main">:</span> <span class="quoted"><span class="quoted">"spp_of <span class="main">(</span>vec_of <span class="free">sp</span><span class="main">)</span> <span class="main">=</span> <span class="free">sp</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> spp_of_def lt_vec_of rep_list_vec_of<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="Signature_Groebner-map_spp_of_vec_of"><span class="command">lemma</span></span> map_spp_of_vec_of<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"list_all spp_inv <span class="free">sps</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span>spp_of <span class="main">∘</span> vec_of<span class="main">)</span> <span class="free">sps</span> <span class="main">=</span> <span class="free">sps</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> map_idI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">sp</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">sp</span> <span class="main">∈</span> set <span class="free">sps</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"spp_inv <span class="skolem">sp</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_all_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"spp_of <span class="main">(</span>vec_of <span class="skolem">sp</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">sp</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> spp_of_vec_of<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>spp_of <span class="main">∘</span> vec_of<span class="main">)</span> <span class="skolem">sp</span> <span class="main">=</span> <span class="skolem">sp</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-vec_of_dgrad_sig_set"><span class="command">lemma</span></span> vec_of_dgrad_sig_set<span class="main">:</span> <span class="quoted"><span class="quoted">"vec_of <span class="free">sp</span> <span class="main">∈</span> dgrad_sig_set <span class="free">dgrad</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"spp_inv <span class="free">sp</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"spp_rel <span class="free">sp</span> <span class="main">(</span>vec_of <span class="free">sp</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_poly_rel_vec_of<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> spp_rel_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> dgrad_sig_set <span class="free">dgrad</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dgrad_sig_set'_def
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> dgrad_max_set <span class="free">dgrad</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dgrad_p_setI<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> sig_inv_set"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_inv_setI<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">term_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_of_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-spp_invD_fst"><span class="command">lemma</span></span> spp_invD_fst<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"spp_inv <span class="free">sp</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">dgrad</span> <span class="main">(</span>pp_of_term <span class="main">(</span>fst <span class="free">sp</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> dgrad_max <span class="free">dgrad</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"component_of_term <span class="main">(</span>fst <span class="free">sp</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="free">fs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> vec_of_dgrad_sig_set <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">dgrad</span> <span class="main">(</span>lp <span class="main">(</span>vec_of <span class="free">sp</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> dgrad_max <span class="free">dgrad</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dgrad_sig_setD_lp<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">dgrad</span> <span class="main">(</span>pp_of_term <span class="main">(</span>fst <span class="free">sp</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> dgrad_max <span class="free">dgrad</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lt_vec_of<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> vec_of_dgrad_sig_set vec_of_nonzero<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"component_of_term <span class="main">(</span>lt <span class="main">(</span>vec_of <span class="free">sp</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="free">fs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dgrad_sig_setD_lt<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"component_of_term <span class="main">(</span>fst <span class="free">sp</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="free">fs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lt_vec_of<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-spp_invD_snd"><span class="command">lemma</span></span> spp_invD_snd<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dickson_grading <span class="free">dgrad</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"spp_inv <span class="free">sp</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"snd <span class="free">sp</span> <span class="main">∈</span> punit_dgrad_max_set <span class="free">dgrad</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> vec_of_dgrad_sig_set<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">sp</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vec_of <span class="free">sp</span> <span class="main">∈</span> dgrad_max_set <span class="free">dgrad</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dgrad_sig_set'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="main">(</span>vec_of <span class="free">sp</span><span class="main">)</span> <span class="main">∈</span> punit_dgrad_max_set <span class="free">dgrad</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dgrad_max_2<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rep_list_vec_of<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-vec_of_inj"><span class="command">lemma</span></span> vec_of_inj<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"spp_inv <span class="free">sp</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"vec_of <span class="free">sp</span> <span class="main">=</span> vec_of <span class="free">sp'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">sp</span> <span class="main">=</span> <span class="free">sp'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vec_of <span class="free">sp</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> vec_of_nonzero<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"vec_of <span class="free">sp'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"spp_inv <span class="free">sp'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_of_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">sp</span> <span class="main">=</span> spp_of <span class="main">(</span>vec_of <span class="free">sp</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> spp_of_vec_of<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> spp_of <span class="main">(</span>vec_of <span class="free">sp'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹spp_inv <span class="free">sp'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">sp'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> spp_of_vec_of<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-spp_inv_alt"><span class="command">lemma</span></span> spp_inv_alt<span class="main">:</span> <span class="quoted"><span class="quoted">"spp_inv <span class="free">sp</span> <span class="main">⟷</span> <span class="main">(</span>vec_of <span class="free">sp</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"spp_inv <span class="free">sp</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"vec_of <span class="free">sp</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> spp_inv <span class="free">sp</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"vec_of <span class="free">sp</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_of_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> that <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> vec_of_nonzero<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-spp_of_vec_of_spp_of"><span class="command">lemma</span></span> spp_of_vec_of_spp_of<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> dgrad_sig_set <span class="free">dgrad</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"spp_of <span class="main">(</span>vec_of <span class="main">(</span>spp_of <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> spp_of <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"spp_inv <span class="main">(</span>spp_of <span class="free">p</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> spp_of_vec_of<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"vec_of <span class="main">(</span>spp_of <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> spp_inv_alt<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> True<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"spp_inv <span class="main">(</span>spp_of <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> spp_inv_def
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword1"><span class="command">from</span></span> False assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"spp_rel <span class="main">(</span>spp_of <span class="free">p</span><span class="main">)</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> spp_rel_def spp_of_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> spp_of_vec_of<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Total Reduction›</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">find_sig_reducer</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> list <span class="main">⇒</span> <span class="tfree">'t</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> nat <span class="main">⇒</span> nat option"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">find_sig_reducer</span> <span class="main">[]</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> None"</span></span><span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">find_sig_reducer</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span>
          <span class="main">(</span><span class="keyword1">if</span> snd <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> punit.lt <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="keyword1">adds</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">-</span> punit.lt <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">⊕</span> fst <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="keyword1">then</span> Some <span class="free"><span class="bound"><span class="entity">i</span></span></span>
           <span class="keyword1">else</span> <span class="free">find_sig_reducer</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Signature_Groebner-find_sig_reducer_SomeD_aux"><span class="command">lemma</span></span> find_sig_reducer_SomeD_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"find_sig_reducer <span class="free">bs</span> <span class="free">u</span> <span class="free">t</span> <span class="free">i</span> <span class="main">=</span> Some <span class="free">j</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="free">j</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">-</span> <span class="free">i</span> <span class="main">&lt;</span> length <span class="free">bs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="free">j</span> <span class="main">∧</span> <span class="free">j</span> <span class="main">-</span> <span class="free">i</span> <span class="main">&lt;</span> length <span class="free">bs</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">bs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">i</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">b</span> <span class="skolem">bs</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"find_sig_reducer <span class="skolem">bs</span> <span class="free">u</span> <span class="free">t</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">j</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">i</span> <span class="main">≤</span> <span class="free">j</span> <span class="main">∧</span> <span class="free">j</span> <span class="main">-</span> Suc <span class="skolem">i</span> <span class="main">&lt;</span> length <span class="skolem">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Cons<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> <span class="free">j</span> <span class="main">∧</span> <span class="free">j</span> <span class="main">-</span> <span class="skolem">i</span> <span class="main">&lt;</span> Suc <span class="main">(</span>length <span class="skolem">bs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="free">j</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">-</span> <span class="free">i</span> <span class="main">&lt;</span> length <span class="free">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-find_sig_reducer_SomeD'"><span class="command">lemma</span></span> find_sig_reducer_SomeD'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"find_sig_reducer <span class="free">bs</span> <span class="free">u</span> <span class="free">t</span> <span class="free">i</span> <span class="main">=</span> Some <span class="free">j</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="free">bs</span> <span class="main">!</span> <span class="main">(</span><span class="free">j</span> <span class="main">-</span> <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"snd <span class="free">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>snd <span class="free">b</span><span class="main">)</span> <span class="keyword1">adds</span> <span class="free">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">t</span> <span class="main">-</span> punit.lt <span class="main">(</span>snd <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">⊕</span> fst <span class="free">b</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free">u</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">-</span> <span class="free">i</span> <span class="main">&lt;</span> length <span class="free">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> find_sig_reducer_SomeD_aux<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nth_mem<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"snd <span class="free">b</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> punit.lt <span class="main">(</span>snd <span class="free">b</span><span class="main">)</span> <span class="keyword1">adds</span> <span class="free">t</span> <span class="main">∧</span> <span class="main">(</span><span class="free">t</span> <span class="main">-</span> punit.lt <span class="main">(</span>snd <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">⊕</span> fst <span class="free">b</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free">u</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">bs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">i</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil
    <span class="keyword1"><span class="command">from</span></span> Nil<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">bs</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="free">j</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> Cons<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"snd <span class="skolem">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>snd <span class="skolem">a</span><span class="main">)</span> <span class="keyword1">adds</span> <span class="free">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">t</span> <span class="main">-</span> punit.lt <span class="main">(</span>snd <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main">⊕</span> fst <span class="skolem">a</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free">u</span>"</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"find_sig_reducer <span class="skolem">bs</span> <span class="free">u</span> <span class="free">t</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">j</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">i</span> <span class="main">≤</span> <span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> find_sig_reducer_SomeD_aux<span class="main">)</span>
      <span class="keyword1"><span class="command">note</span></span> Cons<span class="main">(</span>3<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹Suc <span class="skolem">i</span> <span class="main">≤</span> <span class="free">j</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">bs</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span><span class="free">j</span> <span class="main">-</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">bs</span> <span class="main">!</span> <span class="main">(</span><span class="free">j</span> <span class="main">-</span> Suc <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="skolem">bs</span> <span class="main">!</span> <span class="main">(</span><span class="free">j</span> <span class="main">-</span> Suc <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">with</span></span> * <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Cons<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"snd <span class="free">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>snd <span class="free">b</span><span class="main">)</span> <span class="keyword1">adds</span> <span class="free">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">t</span> <span class="main">-</span> punit.lt <span class="main">(</span>snd <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">⊕</span> fst <span class="free">b</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> find_sig_reducer_SomeD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"find_sig_reducer <span class="main">(</span>map spp_of <span class="free">bs</span><span class="main">)</span> <span class="free">u</span> <span class="free">t</span> <span class="main">0</span> <span class="main">=</span> Some <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="free">bs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">adds</span> <span class="free">t</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">t</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free">u</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">-</span> <span class="main">0</span> <span class="main">&lt;</span> length <span class="main">(</span>map spp_of <span class="free">bs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> find_sig_reducer_SomeD_aux<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="free">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"spp_of <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>map spp_of <span class="free">bs</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span><span class="free">i</span> <span class="main">-</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>spp_of <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>snd <span class="main">(</span>spp_of <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">adds</span> <span class="free">t</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">t</span> <span class="main">-</span> punit.lt <span class="main">(</span>snd <span class="main">(</span>spp_of <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊕</span> fst <span class="main">(</span>spp_of <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free">u</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> find_sig_reducer_SomeD'<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">adds</span> <span class="free">t</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">t</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fst_spp_of snd_spp_of<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-find_sig_reducer_NoneE"><span class="command">lemma</span></span> find_sig_reducer_NoneE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"find_sig_reducer <span class="free">bs</span> <span class="free">u</span> <span class="free">t</span> <span class="free">i</span> <span class="main">=</span> None"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"snd <span class="free">b</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"snd <span class="free">b</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">¬</span> punit.lt <span class="main">(</span>snd <span class="free">b</span><span class="main">)</span> <span class="keyword1">adds</span> <span class="free">t</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"snd <span class="free">b</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> punit.lt <span class="main">(</span>snd <span class="free">b</span><span class="main">)</span> <span class="keyword1">adds</span> <span class="free">t</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="main">(</span><span class="free">t</span> <span class="main">-</span> punit.lt <span class="main">(</span>snd <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">⊕</span> fst <span class="free">b</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free">u</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="free">thesis</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">bs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="quoted"><span class="free">i</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">from</span></span> Nil<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">bs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"snd <span class="skolem">a</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="main">¬</span> punit.lt <span class="main">(</span>snd <span class="skolem">a</span><span class="main">)</span> <span class="keyword1">adds</span> <span class="free">t</span> <span class="main">∨</span> <span class="main">¬</span> <span class="main">(</span><span class="free">t</span> <span class="main">-</span> punit.lt <span class="main">(</span>snd <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main">⊕</span> fst <span class="skolem">a</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free">u</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"find_sig_reducer <span class="skolem">bs</span> <span class="free">u</span> <span class="free">t</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> None"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">∨</span> <span class="free">b</span> <span class="main">∈</span> set <span class="skolem">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"snd <span class="skolem">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Cons<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">=</span> <span class="skolem">a</span>›</span></span> True<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> punit.lt <span class="main">(</span>snd <span class="skolem">a</span><span class="main">)</span> <span class="keyword1">adds</span> <span class="free">t</span> <span class="main">∨</span> <span class="main">¬</span> <span class="main">(</span><span class="free">t</span> <span class="main">-</span> punit.lt <span class="main">(</span>snd <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main">⊕</span> fst <span class="skolem">a</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>snd <span class="skolem">a</span><span class="main">)</span> <span class="keyword1">adds</span> <span class="free">t</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">with</span></span> 2 <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="free">t</span> <span class="main">-</span> punit.lt <span class="main">(</span>snd <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main">⊕</span> fst <span class="skolem">a</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Cons<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">=</span> <span class="skolem">a</span>›</span></span> <span class="quoted"><span class="quoted">‹snd <span class="skolem">a</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> True 3<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Cons<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">=</span> <span class="skolem">a</span>›</span></span> <span class="quoted"><span class="quoted">‹snd <span class="skolem">a</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> False<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> set <span class="skolem">bs</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> eq <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Cons<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"snd <span class="free">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Cons<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"snd <span class="free">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> punit.lt <span class="main">(</span>snd <span class="free">b</span><span class="main">)</span> <span class="keyword1">adds</span> <span class="free">t</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Cons<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"snd <span class="free">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>snd <span class="free">b</span><span class="main">)</span> <span class="keyword1">adds</span> <span class="free">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="free">t</span> <span class="main">-</span> punit.lt <span class="main">(</span>snd <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">⊕</span> fst <span class="free">b</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free">u</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Cons<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-find_sig_reducer_SomeD_red_single"><span class="command">lemma</span></span> find_sig_reducer_SomeD_red_single<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> keys <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"find_sig_reducer <span class="main">(</span>map spp_of <span class="free">bs</span><span class="main">)</span> <span class="main">(</span>lt <span class="free">p</span><span class="main">)</span> <span class="free">t</span> <span class="main">0</span> <span class="main">=</span> Some <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sig_red_single <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="free">p</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> monom_mult <span class="main">(</span>lookup <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="free">t</span> <span class="main">/</span> punit.lc <span class="main">(</span>rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
            <span class="main">(</span><span class="free">t</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="main">(</span><span class="free">t</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">adds</span> <span class="free">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">t</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> find_sig_reducer_SomeD<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">t</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> adds_minus<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main"><span class="free">≼</span></span> punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.lt_max_keys<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_singleI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq 1 2 3 assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> find_sig_reducer_SomeD_red<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> keys <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"find_sig_reducer <span class="main">(</span>map spp_of <span class="free">bs</span><span class="main">)</span> <span class="main">(</span>lt <span class="free">p</span><span class="main">)</span> <span class="free">t</span> <span class="main">0</span> <span class="main">=</span> Some <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="free">p</span> <span class="main">(</span><span class="free">p</span> <span class="main">-</span> monom_mult <span class="main">(</span>lookup <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="free">t</span> <span class="main">/</span> punit.lc <span class="main">(</span>rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
            <span class="main">(</span><span class="free">t</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sig_red_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> bexI exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> find_sig_reducer_SomeD_red_single<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">-</span> <span class="main">0</span> <span class="main">&lt;</span> length <span class="main">(</span>map spp_of <span class="free">bs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> find_sig_reducer_SomeD_aux<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="free">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">bs</span> <span class="main">!</span> <span class="free">i</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nth_mem<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">bs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span> list"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">sig_trd_term</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> nat<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">sig_trd_term</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> punit.dgrad_p_set_le <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">{</span>rep_list <span class="main">(</span>snd <span class="bound">x</span><span class="main">)</span><span class="main">}</span>
                                      <span class="main">(</span>insert <span class="main">(</span>rep_list <span class="main">(</span>snd <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>rep_list <span class="main">`</span> set <span class="free">bs</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                                 fst <span class="bound">x</span> <span class="main">∈</span> keys <span class="main">(</span>rep_list <span class="main">(</span>snd <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> fst <span class="bound">y</span> <span class="main">∈</span> keys <span class="main">(</span>rep_list <span class="main">(</span>snd <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                                 fst <span class="bound">x</span> <span class="main"><span class="free">≺</span></span> fst <span class="bound">y</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Signature_Groebner-sig_trd_term_wf"><span class="command">lemma</span></span> sig_trd_term_wf<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dickson_grading <span class="free">d</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"wf <span class="main">(</span>sig_trd_term <span class="free">d</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> wfI_min<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">Q</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">Q</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">z</span><span class="main">∈</span><span class="skolem">Q</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">z</span><span class="main">)</span> <span class="main">∈</span> sig_trd_term <span class="free">d</span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">∉</span> <span class="skolem">Q</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"fst <span class="skolem">x</span> <span class="main">∈</span> keys <span class="main">(</span>rep_list <span class="main">(</span>snd <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">X</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">=</span> rep_list <span class="main">`</span> set <span class="free">bs</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"insert <span class="main">(</span>rep_list <span class="main">(</span>snd <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="skolem">X</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">X</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> X_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> finite_insert<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">⊆</span> punit.dgrad_p_set <span class="free">d</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.dgrad_p_set_exhaust<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"rep_list <span class="main">(</span>snd <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> punit.dgrad_p_set <span class="free">d</span> <span class="skolem">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊆</span> punit.dgrad_p_set <span class="free">d</span> <span class="skolem">m</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Q</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">q</span></span> <span class="main">∈</span> <span class="skolem">Q</span><span class="main">.</span> rep_list <span class="main">(</span>snd <span class="bound">q</span><span class="main">)</span> <span class="main">∈</span> punit.dgrad_p_set <span class="free">d</span> <span class="skolem">m</span> <span class="main">∧</span> fst <span class="bound">q</span> <span class="main">∈</span> keys <span class="main">(</span>rep_list <span class="main">(</span>snd <span class="bound">q</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">Q</span>›</span></span> x True <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?Q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">Q</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="bound">Q</span> <span class="main">∧</span> <span class="bound">Q</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">q</span><span class="main">.</span> <span class="free">d</span> <span class="bound">q</span> <span class="main">≤</span> <span class="skolem">m</span><span class="main">}</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">z</span><span class="main">∈</span><span class="bound">Q</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main"><span class="free">≺</span></span> <span class="bound">z</span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">∉</span> <span class="bound">Q</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> wfp_on_imp_minimal<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> wfp_on_ord_strict<span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span> assms<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="skolem">x</span> <span class="main">∈</span> fst <span class="main">`</span> <span class="var">?Q</span> <span class="main">⟹</span> fst <span class="main">`</span> <span class="var">?Q</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">q</span><span class="main">.</span> <span class="free">d</span> <span class="bound">q</span> <span class="main">≤</span> <span class="skolem">m</span><span class="main">}</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound">z</span><span class="main">∈</span>fst <span class="main">`</span> <span class="var">?Q</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main"><span class="free">≺</span></span> <span class="bound">z</span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">∉</span> fst <span class="main">`</span> <span class="var">?Q</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
  
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fst <span class="skolem">x</span> <span class="main">∈</span> fst <span class="main">`</span> <span class="var">?Q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span> refl<span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="var">?Q</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">q</span><span class="main">.</span> <span class="free">d</span> <span class="bound">q</span> <span class="main">≤</span> <span class="skolem">m</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">q</span>
        <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"rep_list <span class="main">(</span>snd <span class="skolem">q</span><span class="main">)</span> <span class="main">∈</span> punit.dgrad_p_set <span class="free">d</span> <span class="skolem">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="skolem">q</span> <span class="main">∈</span> keys <span class="main">(</span>rep_list <span class="main">(</span>snd <span class="skolem">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> a <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"keys <span class="main">(</span>rep_list <span class="main">(</span>snd <span class="skolem">q</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> dgrad_set <span class="free">d</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> punit.dgrad_p_set_def<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> b <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fst <span class="skolem">q</span> <span class="main">∈</span> dgrad_set <span class="free">d</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">(</span>fst <span class="skolem">q</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dgrad_set_def<span class="main">)</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">z</span><span class="main">∈</span>fst <span class="main">`</span> <span class="var">?Q</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main"><span class="free">≺</span></span> <span class="bound">z</span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">∉</span> fst <span class="main">`</span> <span class="var">?Q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 1<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z0</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z0</span> <span class="main">∈</span> fst <span class="main">`</span> <span class="var">?Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main"><span class="free">≺</span></span> <span class="skolem">z0</span> <span class="main">⟹</span> <span class="bound">y</span> <span class="main">∉</span> fst <span class="main">`</span> <span class="var">?Q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="var">?Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> z0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z0</span> <span class="main">=</span> fst <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="skolem">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"rep_list <span class="main">(</span>snd <span class="skolem">z</span><span class="main">)</span> <span class="main">∈</span> punit.dgrad_p_set <span class="free">d</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">z</span><span class="main">∈</span><span class="skolem">Q</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">z</span><span class="main">)</span> <span class="main">∈</span> sig_trd_term <span class="free">d</span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">∉</span> <span class="skolem">Q</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">∈</span> sig_trd_term <span class="free">d</span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">∉</span> <span class="skolem">Q</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI impI<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">y</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">∈</span> sig_trd_term <span class="free">d</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.dgrad_p_set_le <span class="free">d</span> <span class="main">{</span>rep_list <span class="main">(</span>snd <span class="skolem">y</span><span class="main">)</span><span class="main">}</span> <span class="main">(</span>insert <span class="main">(</span>rep_list <span class="main">(</span>snd <span class="skolem">z</span><span class="main">)</span><span class="main">)</span> <span class="skolem">X</span><span class="main">)</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="skolem">y</span> <span class="main">∈</span> keys <span class="main">(</span>rep_list <span class="main">(</span>snd <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"fst <span class="skolem">y</span> <span class="main"><span class="free">≺</span></span> <span class="skolem">z0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sig_trd_term_def X_def z0<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fst <span class="skolem">y</span> <span class="main">∉</span> fst <span class="main">`</span> <span class="var">?Q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 2<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∉</span> <span class="skolem">Q</span> <span class="main">∨</span> rep_list <span class="main">(</span>snd <span class="skolem">y</span><span class="main">)</span> <span class="main">∉</span> punit.dgrad_p_set <span class="free">d</span> <span class="skolem">m</span> <span class="main">∨</span> fst <span class="skolem">y</span> <span class="main">∉</span> keys <span class="main">(</span>rep_list <span class="main">(</span>snd <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∉</span> <span class="skolem">Q</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">elim</span> disjE<span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"rep_list <span class="main">(</span>snd <span class="skolem">y</span><span class="main">)</span> <span class="main">∉</span> punit.dgrad_p_set <span class="free">d</span> <span class="skolem">m</span>"</span></span>
          <span class="keyword1"><span class="command">from</span></span> z X <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insert <span class="main">(</span>rep_list <span class="main">(</span>snd <span class="skolem">z</span><span class="main">)</span><span class="main">)</span> <span class="skolem">X</span> <span class="main">⊆</span> punit.dgrad_p_set <span class="free">d</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">with</span></span> 3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span>rep_list <span class="main">(</span>snd <span class="skolem">y</span><span class="main">)</span><span class="main">}</span> <span class="main">⊆</span> punit.dgrad_p_set <span class="free">d</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.dgrad_p_set_le_dgrad_p_set<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="main">(</span>snd <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> punit.dgrad_p_set <span class="free">d</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">with</span></span> 5 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"fst <span class="skolem">y</span> <span class="main">∉</span> keys <span class="main">(</span>rep_list <span class="main">(</span>snd <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> 4 <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">Q</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> sig_trd_term <span class="free">d</span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">∉</span> <span class="skolem">Q</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI impI<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">y</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> sig_trd_term <span class="free">d</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"fst <span class="skolem">x</span> <span class="main">∈</span> keys <span class="main">(</span>rep_list <span class="main">(</span>snd <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sig_trd_term_def<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> False <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∉</span> <span class="skolem">Q</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">function</span></span> <span class="main">(</span>domintros<span class="main">)</span> <span class="entity">sig_trd_aux</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sig_trd_aux</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">let</span> <span class="bound">p'</span> <span class="main">=</span>
      <span class="main">(</span><span class="keyword1">case</span> find_sig_reducer <span class="main">(</span>map spp_of <span class="free">bs</span><span class="main">)</span> <span class="main">(</span>lt <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">0</span> <span class="keyword1">of</span>
          None   <span class="main">⇒</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>
        <span class="main">|</span> Some <span class="bound">i</span> <span class="main">⇒</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">-</span> monom_mult <span class="main">(</span>lookup <span class="main">(</span>rep_list <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">/</span> punit.lc <span class="main">(</span>rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                          <span class="main">(</span><span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
      <span class="bound">p''</span> <span class="main">=</span> punit.lower <span class="main">(</span>rep_list <span class="bound">p'</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="keyword1">in</span>
    <span class="keyword1">if</span> <span class="bound">p''</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="bound">p'</span> <span class="keyword1">else</span> <span class="free">sig_trd_aux</span> <span class="main">(</span>punit.lt <span class="bound">p''</span><span class="main">,</span> <span class="bound">p'</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Signature_Groebner-sig_trd_aux_domI"><span class="command">lemma</span></span> sig_trd_aux_domI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"fst <span class="free">args0</span> <span class="main">∈</span> keys <span class="main">(</span>rep_list <span class="main">(</span>snd <span class="free">args0</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sig_trd_aux_dom <span class="free">args0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> ex_hgrad <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d</span></span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"dickson_grading <span class="skolem">d</span> <span class="main">∧</span> hom_grading <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">hence</span></span> dg<span class="main">:</span> <span class="quoted"><span class="quoted">"dickson_grading <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"wf <span class="main">(</span>sig_trd_term <span class="skolem">d</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_trd_term_wf<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">args0</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>less <span class="skolem">args</span><span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> args<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">args</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> prod.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> less<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span> <span class="bound">q</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">q</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> sig_trd_term <span class="skolem">d</span> <span class="main">⟹</span> <span class="bound">s</span> <span class="main">∈</span> keys <span class="main">(</span>rep_list <span class="bound">q</span><span class="main">)</span> <span class="main">⟹</span> sig_trd_aux_dom <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">q</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> prod.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> less<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> keys <span class="main">(</span>rep_list <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> args<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> args
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sig_trd_aux.domintros<span class="main">)</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> find_sig_reducer <span class="main">(</span>map spp_of <span class="free">bs</span><span class="main">)</span> <span class="main">(</span>lt <span class="skolem">p</span><span class="main">)</span> <span class="skolem">t</span> <span class="main">0</span> <span class="keyword1">of</span>
                                None <span class="main">⇒</span> <span class="skolem">p</span>
                              <span class="main">|</span> Some <span class="bound">i</span> <span class="main">⇒</span> <span class="skolem">p</span> <span class="main">-</span>
                                  monom_mult <span class="main">(</span>lookup <span class="main">(</span>rep_list <span class="skolem">p</span><span class="main">)</span> <span class="skolem">t</span> <span class="main">/</span> punit.lc <span class="main">(</span>rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                                   <span class="main">(</span><span class="skolem">t</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p''</span> <span class="main">=</span> punit.lower <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span> <span class="skolem">t</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p''</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p''</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="skolem">p''</span> <span class="main">∈</span> keys <span class="skolem">p''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.lt_in_keys<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⊆</span> keys <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> p''_def punit.keys_lower<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="skolem">p''</span> <span class="main">∈</span> keys <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">with</span></span> _ <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sig_trd_aux_dom <span class="main">(</span>punit.lt <span class="skolem">p''</span><span class="main">,</span> <span class="skolem">p'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> 1<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.dgrad_p_set_le <span class="skolem">d</span> <span class="main">{</span>rep_list <span class="skolem">p'</span><span class="main">}</span> <span class="main">(</span>insert <span class="main">(</span>rep_list <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>rep_list <span class="main">`</span> set <span class="free">bs</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"find_sig_reducer <span class="main">(</span>map spp_of <span class="free">bs</span><span class="main">)</span> <span class="main">(</span>lt <span class="skolem">p</span><span class="main">)</span> <span class="skolem">t</span> <span class="main">0</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> None
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">=</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p'_def<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span>rep_list <span class="skolem">p'</span><span class="main">}</span> <span class="main">⊆</span> insert <span class="main">(</span>rep_list <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>rep_list <span class="main">`</span> set <span class="free">bs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.dgrad_p_set_le_subset<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Some <span class="skolem">i</span><span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> p'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">=</span> <span class="skolem">p</span> <span class="main">-</span> monom_mult <span class="main">(</span>lookup <span class="main">(</span>rep_list <span class="skolem">p</span><span class="main">)</span> <span class="skolem">t</span> <span class="main">/</span> punit.lc <span class="main">(</span>rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                                    <span class="main">(</span><span class="skolem">t</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p'_def<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="skolem">p</span> <span class="skolem">p'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p' <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">∈</span> keys <span class="main">(</span>rep_list <span class="skolem">p</span><span class="main">)</span>›</span></span> Some
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> find_sig_reducer_SomeD_red<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"punit.red <span class="main">(</span>rep_list <span class="main">`</span> set <span class="free">bs</span><span class="main">)</span> <span class="main">(</span>rep_list <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_red<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> dg <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.dgrad_p_set_le_red<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹punit.lt <span class="skolem">p''</span> <span class="main">∈</span> keys <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">∈</span> keys <span class="main">(</span>rep_list <span class="skolem">p</span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p''</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="skolem">p''</span> <span class="main"><span class="free">≺</span></span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p''_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.lt_lower_less<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>punit.lt <span class="skolem">p''</span><span class="main">,</span> <span class="skolem">p'</span><span class="main">)</span><span class="main">,</span> <span class="skolem">t</span><span class="main">,</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">∈</span> sig_trd_term <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sig_trd_term_def<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">sig_trd</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">sig_trd</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> rep_list <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1">else</span> sig_trd_aux <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Signature_Groebner-sig_trd_aux_red_rtrancl"><span class="command">lemma</span></span> sig_trd_aux_red_rtrancl<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"fst <span class="free">args0</span> <span class="main">∈</span> keys <span class="main">(</span>rep_list <span class="main">(</span>snd <span class="free">args0</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>snd <span class="free">args0</span><span class="main">)</span> <span class="main">(</span>sig_trd_aux <span class="free">args0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sig_trd_aux_dom <span class="free">args0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_trd_aux_domI<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">args0</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> sig_trd_aux.pinduct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">t</span> <span class="skolem">p</span><span class="main">)</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> find_sig_reducer <span class="main">(</span>map spp_of <span class="free">bs</span><span class="main">)</span> <span class="main">(</span>lt <span class="skolem">p</span><span class="main">)</span> <span class="skolem">t</span> <span class="main">0</span> <span class="keyword1">of</span>
                              None <span class="main">⇒</span> <span class="skolem">p</span>
                            <span class="main">|</span> Some <span class="bound">i</span> <span class="main">⇒</span> <span class="skolem">p</span> <span class="main">-</span>
                                monom_mult <span class="main">(</span>lookup <span class="main">(</span>rep_list <span class="skolem">p</span><span class="main">)</span> <span class="skolem">t</span> <span class="main">/</span> punit.lc <span class="main">(</span>rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                                 <span class="main">(</span><span class="skolem">t</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p''</span> <span class="main">=</span> punit.lower <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span> <span class="skolem">t</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> 1<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> keys <span class="main">(</span>rep_list <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="skolem">p</span> <span class="skolem">p'</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"find_sig_reducer <span class="main">(</span>map spp_of <span class="free">bs</span><span class="main">)</span> <span class="main">(</span>lt <span class="skolem">p</span><span class="main">)</span> <span class="skolem">t</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> None
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">=</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p'_def<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Some <span class="skolem">i</span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> p'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">=</span> <span class="skolem">p</span> <span class="main">-</span> monom_mult <span class="main">(</span>lookup <span class="main">(</span>rep_list <span class="skolem">p</span><span class="main">)</span> <span class="skolem">t</span> <span class="main">/</span> punit.lc <span class="main">(</span>rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                                  <span class="main">(</span><span class="skolem">t</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p'_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="skolem">p</span> <span class="skolem">p'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p' <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">∈</span> keys <span class="main">(</span>rep_list <span class="skolem">p</span><span class="main">)</span>›</span></span> Some
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> find_sig_reducer_SomeD_red<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sig_trd_aux.psimps<span class="main"><span class="main">[</span></span><span class="operator">OF</span> 1<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">]</span></span> Let_def p'_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> p''_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> *<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> impI<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p''</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> * <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="skolem">p</span> <span class="main">(</span>snd <span class="main">(</span>punit.lt <span class="skolem">p''</span><span class="main">,</span> <span class="skolem">p'</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> snd_conv<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>snd <span class="main">(</span>punit.lt <span class="skolem">p''</span><span class="main">,</span> <span class="skolem">p'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>sig_trd_aux <span class="main">(</span>punit.lt <span class="skolem">p''</span><span class="main">,</span> <span class="skolem">p'</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> p'_def p''_def <span class="quoted"><span class="quoted">‹<span class="skolem">p''</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> 1<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p''</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="skolem">p''</span> <span class="main">∈</span> keys <span class="skolem">p''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.lt_in_keys<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⊆</span> keys <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> p''_def punit.keys_lower<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>punit.lt <span class="skolem">p''</span><span class="main">,</span> <span class="skolem">p'</span><span class="main">)</span> <span class="main">∈</span> keys <span class="main">(</span>rep_list <span class="main">(</span>snd <span class="main">(</span>punit.lt <span class="skolem">p''</span><span class="main">,</span> <span class="skolem">p'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="skolem">p</span> <span class="main">(</span>sig_trd_aux <span class="main">(</span>punit.lt <span class="skolem">p''</span><span class="main">,</span> <span class="skolem">p'</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rtranclp_trans<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> sig_trd_red_rtrancl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">p</span> <span class="main">(</span>sig_trd <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sig_trd_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">split</span> if_split<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI impI rtranclp.rtrancl_refl<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?args</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span><span class="main">,</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">∈</span> keys <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.lt_in_keys<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span><span class="main">,</span> <span class="free">p</span><span class="main">)</span> <span class="main">∈</span> keys <span class="main">(</span>rep_list <span class="main">(</span>snd <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span><span class="main">,</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> fst_conv snd_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>snd <span class="var">?args</span><span class="main">)</span> <span class="main">(</span>sig_trd_aux <span class="var">?args</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_trd_aux_red_rtrancl<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="free">p</span> <span class="main">(</span>sig_trd_aux <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span><span class="main">,</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> snd_conv<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-sig_trd_aux_irred"><span class="command">lemma</span></span> sig_trd_aux_irred<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"fst <span class="free">args0</span> <span class="main">∈</span> keys <span class="main">(</span>rep_list <span class="main">(</span>snd <span class="free">args0</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">b</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈</span> set <span class="free">bs</span> <span class="main">⟹</span> rep_list <span class="bound">b</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> fst <span class="free">args0</span> <span class="main"><span class="free">≺</span></span> <span class="bound">s</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="bound">b</span><span class="main">)</span> <span class="main">⟹</span>
              <span class="bound">s</span> <span class="main">⊕</span> lt <span class="bound">b</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="main">(</span>snd <span class="main">(</span><span class="free">args0</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> lookup <span class="main">(</span>rep_list <span class="main">(</span>snd <span class="free">args0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="bound">s</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="bound">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="main">(</span>sig_trd_aux <span class="free">args0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sig_trd_aux_dom <span class="free">args0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_trd_aux_domI<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">args0</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> sig_trd_aux.pinduct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">t</span> <span class="skolem">p</span><span class="main">)</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> find_sig_reducer <span class="main">(</span>map spp_of <span class="free">bs</span><span class="main">)</span> <span class="main">(</span>lt <span class="skolem">p</span><span class="main">)</span> <span class="skolem">t</span> <span class="main">0</span> <span class="keyword1">of</span>
                              None <span class="main">⇒</span> <span class="skolem">p</span>
                            <span class="main">|</span> Some <span class="bound">i</span> <span class="main">⇒</span> <span class="skolem">p</span> <span class="main">-</span>
                                monom_mult <span class="main">(</span>lookup <span class="main">(</span>rep_list <span class="skolem">p</span><span class="main">)</span> <span class="skolem">t</span> <span class="main">/</span> punit.lc <span class="main">(</span>rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                                 <span class="main">(</span><span class="skolem">t</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p''</span> <span class="main">=</span> punit.lower <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span> <span class="skolem">t</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> 1<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> keys <span class="main">(</span>rep_list <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> 1<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> set <span class="free">bs</span> <span class="main">⟹</span> rep_list <span class="skolem">b</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="skolem">t</span> <span class="main"><span class="free">≺</span></span> <span class="skolem">s</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">b</span><span class="main">)</span> <span class="main">⟹</span>
                       <span class="skolem">s</span> <span class="main">⊕</span> lt <span class="skolem">b</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="skolem">p</span> <span class="main">⟹</span> lookup <span class="main">(</span>rep_list <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">b</span> <span class="skolem">s</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> fst_conv snd_conv<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">p'</span> <span class="main">=</span> lt <span class="skolem">p</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="skolem">t</span> <span class="main"><span class="free">≺</span></span> <span class="bound">s</span> <span class="main">⟶</span> lookup <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span> <span class="bound">s</span> <span class="main">=</span> lookup <span class="main">(</span>rep_list <span class="skolem">p</span><span class="main">)</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"find_sig_reducer <span class="main">(</span>map spp_of <span class="free">bs</span><span class="main">)</span> <span class="main">(</span>lt <span class="skolem">p</span><span class="main">)</span> <span class="skolem">t</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> None
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p'_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Some <span class="skolem">i</span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> p'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">=</span> <span class="skolem">p</span> <span class="main">-</span> monom_mult <span class="main">(</span>lookup <span class="main">(</span>rep_list <span class="skolem">p</span><span class="main">)</span> <span class="skolem">t</span> <span class="main">/</span> punit.lc <span class="main">(</span>rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                                  <span class="main">(</span><span class="skolem">t</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p'_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sig_red_single <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="skolem">p</span> <span class="skolem">p'</span> <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> p' <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">∈</span> keys <span class="main">(</span>rep_list <span class="skolem">p</span><span class="main">)</span>›</span></span> Some <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> find_sig_reducer_SomeD_red_single<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.red_single <span class="main">(</span>rep_list <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span> <span class="main">(</span>rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">p'</span> <span class="main">=</span> lt <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_single_red_single<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> sig_red_single_regular_lt<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="skolem">t</span> <span class="main"><span class="free">≺</span></span> <span class="bound">s</span> <span class="main">⟶</span> lookup <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span> <span class="bound">s</span> <span class="main">=</span> lookup <span class="main">(</span>rep_list <span class="skolem">p</span><span class="main">)</span> <span class="bound">s</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI impI<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main"><span class="free">≺</span></span> <span class="skolem">s</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> Some <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">adds</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> find_sig_reducer_SomeD<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> eq0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">t</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?t</span> <span class="main">=</span> <span class="skolem">t</span>"</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> adds_minus<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main"><span class="free">≺</span></span> <span class="skolem">s</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lookup <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span> <span class="skolem">s</span> <span class="main">=</span> lookup <span class="main">(</span>punit.higher <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span> <span class="var">?t</span><span class="main">)</span> <span class="skolem">s</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq0 punit.lookup_higher_when<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> r <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> lookup <span class="main">(</span>punit.higher <span class="main">(</span>rep_list <span class="skolem">p</span><span class="main">)</span> <span class="var">?t</span><span class="main">)</span> <span class="skolem">s</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> punit.red_single_higher<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main"><span class="free">≺</span></span> <span class="skolem">s</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> lookup <span class="main">(</span>rep_list <span class="skolem">p</span><span class="main">)</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq0 punit.lookup_higher_when<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lookup <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span> <span class="skolem">s</span> <span class="main">=</span> lookup <span class="main">(</span>rep_list <span class="skolem">p</span><span class="main">)</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹lt <span class="skolem">p'</span> <span class="main">=</span> lt <span class="skolem">p</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">hence</span></span> lt_p'<span class="main">:</span> <span class="quoted"><span class="quoted">"lt <span class="skolem">p'</span> <span class="main">=</span> lt <span class="skolem">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="skolem">t</span> <span class="main"><span class="free">≺</span></span> <span class="bound">s</span> <span class="main">⟹</span> lookup <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span> <span class="bound">s</span> <span class="main">=</span> lookup <span class="main">(</span>rep_list <span class="skolem">p</span><span class="main">)</span> <span class="bound">s</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"lookup <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="skolem">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main"><span class="free">≼</span></span> <span class="skolem">s</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">⊕</span> lt <span class="skolem">b</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="skolem">p'</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">b</span> <span class="skolem">s</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main"><span class="free">≺</span></span> <span class="skolem">s</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">b</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lookup <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
             lookup <span class="main">(</span>rep_list <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">b</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> b<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> that<span class="main">(</span>1<span class="main">,</span> 2<span class="main">)</span> True that<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> lt_p' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> a<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">with</span></span> that<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> <span class="skolem">s</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"find_sig_reducer <span class="main">(</span>map spp_of <span class="free">bs</span><span class="main">)</span> <span class="main">(</span>lt <span class="skolem">p</span><span class="main">)</span> <span class="skolem">t</span> <span class="main">0</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> None
        <span class="keyword1"><span class="command">from</span></span> that<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"spp_of <span class="skolem">b</span> <span class="main">∈</span> set <span class="main">(</span>map spp_of <span class="free">bs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">with</span></span> None <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> find_sig_reducer_NoneE<span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>spp_of <span class="skolem">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">with</span></span> that<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> snd_spp_of<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> punit.lt <span class="main">(</span>snd <span class="main">(</span>spp_of <span class="skolem">b</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">adds</span> <span class="skolem">t</span>"</span></span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> snd_spp_of t<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">-</span> punit.lt <span class="main">(</span>snd <span class="main">(</span>spp_of <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊕</span> fst <span class="main">(</span>spp_of <span class="skolem">b</span><span class="main">)</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="skolem">p</span>"</span></span>
          <span class="keyword1"><span class="command">with</span></span> that<span class="main">(</span>4<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fst_spp_of snd_spp_of t lt_p'<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Some <span class="skolem">i</span><span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> p'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">=</span> <span class="skolem">p</span> <span class="main">-</span> monom_mult <span class="main">(</span>lookup <span class="main">(</span>rep_list <span class="skolem">p</span><span class="main">)</span> <span class="skolem">t</span> <span class="main">/</span> punit.lc <span class="main">(</span>rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                                  <span class="main">(</span><span class="skolem">t</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p'_def<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sig_red_single <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="skolem">p</span> <span class="skolem">p'</span> <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> p' <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">∈</span> keys <span class="main">(</span>rep_list <span class="skolem">p</span><span class="main">)</span>›</span></span> Some <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> find_sig_reducer_SomeD_red_single<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.red_single <span class="main">(</span>rep_list <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span> <span class="main">(</span>rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_single_red_single<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> Some <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">adds</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> find_sig_reducer_SomeD<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> eq0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">t</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?t</span> <span class="main">=</span> <span class="skolem">t</span>"</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> adds_minus<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> r <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lookup <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.red_single_lookup<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> eq0 t<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sig_trd_aux.psimps<span class="main"><span class="main">[</span></span><span class="operator">OF</span> 1<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">]</span></span> Let_def p'_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> p''_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI impI<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p''</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="skolem">p'</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="skolem">p'</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> keys <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="skolem">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> adds<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="skolem">b</span><span class="main">)</span> <span class="keyword1">adds</span> <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">⊕</span> lt <span class="skolem">b</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> punit.lt <span class="main">(</span>rep_list <span class="skolem">b</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">p'</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_red_addsE<span class="main">)</span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">b</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> adds <span class="keyword1"><span class="command">have</span></span> eq0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?s</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">b</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> adds_minus<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main"><span class="free">≼</span></span> <span class="skolem">s</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> set <span class="free">bs</span>›</span></span> <span class="quoted"><span class="quoted">‹rep_list <span class="skolem">b</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> True <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main"><span class="free">≼</span></span> <span class="var">?s</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> eq0<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> adds <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">⊕</span> lt <span class="skolem">b</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> punit.lt <span class="main">(</span>rep_list <span class="skolem">b</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">p'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?s</span> <span class="main">⊕</span> lt <span class="skolem">b</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="skolem">p'</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> term_is_le_rel_minus<span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lookup <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span> <span class="main">(</span><span class="var">?s</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> c<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∉</span> keys <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq0 in_keys_iff<span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">∈</span> keys <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main"><span class="free">≺</span></span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lookup <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span> <span class="skolem">s</span> <span class="main">=</span> lookup <span class="main">(</span>punit.lower <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span> <span class="skolem">t</span><span class="main">)</span> <span class="skolem">s</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> punit.lookup_lower_when<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p''</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p''_def<span class="main">)</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∉</span> keys <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_keys_iff<span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">∈</span> keys <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p''</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> p'_def p''_def <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="main">(</span>sig_trd_aux <span class="main">(</span>punit.lt <span class="skolem">p''</span><span class="main">,</span> <span class="skolem">p'</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> 1<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p''</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="skolem">p''</span> <span class="main">∈</span> keys <span class="skolem">p''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.lt_in_keys<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⊆</span> keys <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> p''_def punit.keys_lower<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>punit.lt <span class="skolem">p''</span><span class="main">,</span> <span class="skolem">p'</span><span class="main">)</span> <span class="main">∈</span> keys <span class="main">(</span>rep_list <span class="main">(</span>snd <span class="main">(</span>punit.lt <span class="skolem">p''</span><span class="main">,</span> <span class="skolem">p'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span> <span class="skolem">s</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="skolem">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>punit.lt <span class="skolem">p''</span><span class="main">,</span> <span class="skolem">p'</span><span class="main">)</span> <span class="main"><span class="free">≺</span></span> <span class="skolem">s</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">b</span><span class="main">)</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">⊕</span> lt <span class="skolem">b</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="main">(</span>snd <span class="main">(</span>punit.lt <span class="skolem">p''</span><span class="main">,</span> <span class="skolem">p'</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="skolem">p''</span> <span class="main"><span class="free">≺</span></span> <span class="skolem">s</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">⊕</span> lt <span class="skolem">b</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="skolem">p'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lookup <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main"><span class="free">≼</span></span> <span class="skolem">s</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">b</span><span class="main">)</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> set <span class="free">bs</span>›</span></span> <span class="quoted"><span class="quoted">‹rep_list <span class="skolem">b</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">⊕</span> lt <span class="skolem">b</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="skolem">p'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> c<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">b</span><span class="main">)</span> <span class="main"><span class="free">≺</span></span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lookup <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                  lookup <span class="main">(</span>punit.lower <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> punit.lookup_lower_when<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"lookup <span class="main">(</span>punit.lower <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">b</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">b</span><span class="main">)</span> <span class="main"><span class="free">≼</span></span> punit.lt <span class="main">(</span>punit.lower <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span> <span class="skolem">t</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.lt_max<span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> punit.lt <span class="skolem">p''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> p''_def<span class="main">)</span>
            <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹punit.lt <span class="skolem">p''</span> <span class="main"><span class="free">≺</span></span> <span class="skolem">s</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">b</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"lookup <span class="main">(</span>rep_list <span class="main">(</span>snd <span class="main">(</span>punit.lt <span class="skolem">p''</span><span class="main">,</span> <span class="skolem">p'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> snd_conv<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> sig_trd_irred<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="main">(</span>sig_trd <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sig_trd_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">split</span> if_split<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI impI<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> keys <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_red_addsE<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹rep_list <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="main">(</span>sig_trd_aux <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span><span class="main">,</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sig_trd_aux_irred<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹rep_list <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">∈</span> keys <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.lt_in_keys<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span><span class="main">,</span> <span class="free">p</span><span class="main">)</span> <span class="main">∈</span> keys <span class="main">(</span>rep_list <span class="main">(</span>snd <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span><span class="main">,</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span> <span class="skolem">s</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span><span class="main">,</span> <span class="free">p</span><span class="main">)</span> <span class="main"><span class="free">≺</span></span> <span class="skolem">s</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">b</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"lookup <span class="main">(</span>rep_list <span class="main">(</span>snd <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span><span class="main">,</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> punit.lt_max <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">bs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> list"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">v</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'t</span></span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">sig_trd_spp_body</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sig_trd_spp_body</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">case</span> find_sig_reducer <span class="free">bs</span> <span class="free">v</span> <span class="main">(</span>punit.lt <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">0</span> <span class="keyword1">of</span>
        None   <span class="main">⇒</span> <span class="main">(</span>punit.tail <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">+</span> monomial <span class="main">(</span>punit.lc <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">(</span>punit.lt <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span>
      <span class="main">|</span> Some <span class="bound">i</span> <span class="main">⇒</span> <span class="keyword1">let</span> <span class="bound">b</span> <span class="main">=</span> snd <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span> <span class="keyword1">in</span>
          <span class="main">(</span>punit.tail <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">-</span> punit.monom_mult <span class="main">(</span>punit.lc <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">/</span> punit.lc <span class="bound">b</span><span class="main">)</span> <span class="main">(</span>punit.lt <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">-</span> punit.lt <span class="bound">b</span><span class="main">)</span> <span class="main">(</span>punit.tail <span class="bound">b</span><span class="main">)</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">sig_trd_spp_aux</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> sig_trd_spp_aux_def <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword">del</span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">sig_trd_spp_aux</span> <span class="main">=</span> tailrec.fun <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> fst <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> snd sig_trd_spp_body"</span></span>

<span class="keyword1" id="Signature_Groebner-sig_trd_spp_aux_simps"><span class="command">lemma</span></span> sig_trd_spp_aux_simps <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"sig_trd_spp_aux <span class="main">(</span><span class="free">p</span><span class="main">,</span> <span class="free">r</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="free">r</span> <span class="keyword1">else</span> sig_trd_spp_aux <span class="main">(</span>sig_trd_spp_body <span class="main">(</span><span class="free">p</span><span class="main">,</span> <span class="free">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sig_trd_spp_aux_def tailrec.simps<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">sig_trd_spp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sig_trd_spp</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">,</span> sig_trd_spp_aux <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We define function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> sig_trd_spp<span class="antiquote"><span class="antiquote">}</span></span></span></span>, operating on sig-poly-pairs, already here, to have
  its definition in the right context. Lemmas are proved about it below in Section <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Sig-Poly-Pairs›</span></span></span></span>.›</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Koszul Syzygies›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">emph</span></span> ‹Koszul syzygy›<span class="antiquote"><span class="antiquote">}</span></span></span></span> of the list <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">fs</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> of scalar polynomials is a syzygy of the form
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="free"><span class="free">fs</span></span> <span class="main"><span class="main">!</span></span> <span class="free"><span class="free">i</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">⊙</span></span> <span class="main"><span class="main">(</span></span>monomial <span class="main"><span class="main">1</span></span> <span class="main"><span class="main">(</span></span><span class="free"><span class="free">term_of_pair</span></span> <span class="main"><span class="main">(</span></span><span class="main"><span class="main">0</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">j</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">-</span></span> <span class="main"><span class="main">(</span></span><span class="free"><span class="free">fs</span></span> <span class="main"><span class="main">!</span></span> <span class="free"><span class="free">j</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">⊙</span></span> <span class="main"><span class="main">(</span></span>monomial <span class="main"><span class="main">1</span></span> <span class="main"><span class="main">(</span></span><span class="free"><span class="free">term_of_pair</span></span> <span class="main"><span class="main">(</span></span><span class="main"><span class="main">0</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">i</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>,
  for <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">prop</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">i</span></span> <span class="main"><span class="main">&lt;</span></span> <span class="free"><span class="free">j</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">prop</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">j</span></span> <span class="main"><span class="main">&lt;</span></span> length <span class="free"><span class="free">fs</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">Koszul_syz_sigs_aux</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span> list <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'t</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Koszul_syz_sigs_aux</span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">Koszul_syz_sigs_aux</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span>
    map_idx <span class="main">(</span><span class="main">λ</span><span class="bound">b'</span> <span class="bound">j</span><span class="main">.</span> ord_term_lin.max <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span>punit.lt <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span>punit.lt <span class="bound">b'</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="main">@</span>
    <span class="free">Koszul_syz_sigs_aux</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Koszul_syz_sigs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span> list <span class="main">⇒</span> <span class="tfree">'t</span> list"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Koszul_syz_sigs</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="main">=</span> filter_min <span class="keyword1">(adds<span class="hidden">⇩</span><sub>t</sub>)</span> <span class="main">(</span>Koszul_syz_sigs_aux <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">new_syz_sigs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'t</span> list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span> list <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> nat <span class="main">⇒</span> <span class="tfree">'t</span> list"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">new_syz_sigs</span> <span class="free"><span class="bound"><span class="entity">ss</span></span></span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="main">(</span>Inl <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">ss</span></span></span>"</span></span> <span class="main">|</span>
    <span class="quoted"><span class="quoted">"<span class="free">new_syz_sigs</span> <span class="free"><span class="bound"><span class="entity">ss</span></span></span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="main">(</span>Inr <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span> <span class="main">=</span>
      <span class="main">(</span><span class="keyword1">if</span> is_pot_ord <span class="keyword1">then</span>
        filter_min_append <span class="keyword1">(adds<span class="hidden">⇩</span><sub>t</sub>)</span> <span class="free"><span class="bound"><span class="entity">ss</span></span></span> <span class="main">(</span>filter_min <span class="keyword1">(adds<span class="hidden">⇩</span><sub>t</sub>)</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="free">term_of_pair</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="bound">b</span><span class="main">)</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span><span class="main">)</span><span class="main">)</span>
      <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">ss</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">new_syz_sigs_spp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'t</span> list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> list <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> nat <span class="main">⇒</span> <span class="tfree">'t</span> list"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">new_syz_sigs_spp</span> <span class="free"><span class="bound"><span class="entity">ss</span></span></span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="main">(</span>Inl <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">ss</span></span></span>"</span></span> <span class="main">|</span>
    <span class="quoted"><span class="quoted">"<span class="free">new_syz_sigs_spp</span> <span class="free"><span class="bound"><span class="entity">ss</span></span></span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="main">(</span>Inr <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span> <span class="main">=</span>
      <span class="main">(</span><span class="keyword1">if</span> is_pot_ord <span class="keyword1">then</span>
        filter_min_append <span class="keyword1">(adds<span class="hidden">⇩</span><sub>t</sub>)</span> <span class="free"><span class="bound"><span class="entity">ss</span></span></span> <span class="main">(</span>filter_min <span class="keyword1">(adds<span class="hidden">⇩</span><sub>t</sub>)</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="free">term_of_pair</span> <span class="main">(</span>punit.lt <span class="main">(</span>snd <span class="bound">b</span><span class="main">)</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span><span class="main">)</span><span class="main">)</span>
      <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">ss</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Signature_Groebner-Koszul_syz_sigs_auxI"><span class="command">lemma</span></span> Koszul_syz_sigs_auxI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">j</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> length <span class="free">bs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ord_term_lin.max <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span>punit.lt <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span><span class="main">,</span> <span class="free">k</span> <span class="main">+</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span>punit.lt <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="free">j</span><span class="main">)</span><span class="main">,</span> <span class="free">k</span> <span class="main">+</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span>
          set <span class="main">(</span>Koszul_syz_sigs_aux <span class="free">bs</span> <span class="free">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">bs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">i</span></span> <span class="quoted"><span class="free">j</span></span> <span class="quoted"><span class="free">k</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">from</span></span> Nil<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">b</span> <span class="skolem">bs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j0</span></span> <span class="keyword2"><span class="keyword">where</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">=</span> Suc <span class="skolem">j0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> lessE<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j0</span> <span class="main">&lt;</span> length <span class="skolem">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> j<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> ord_term_lin.max <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span>punit.lt <span class="skolem">b</span><span class="main">,</span> Suc <span class="main">(</span><span class="bound">j</span> <span class="main">+</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span>punit.lt <span class="main">(</span><span class="skolem">bs</span> <span class="main">!</span> <span class="bound">j</span><span class="main">)</span><span class="main">,</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span>
                <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="skolem">bs</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>Koszul_syz_sigs_aux <span class="skolem">bs</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j0</span> <span class="main">&lt;</span> length <span class="skolem">bs</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j0</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="skolem">bs</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ord_term_lin.max <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span>punit.lt <span class="skolem">b</span><span class="main">,</span> Suc <span class="main">(</span><span class="skolem">j0</span> <span class="main">+</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span>punit.lt <span class="main">(</span><span class="skolem">bs</span> <span class="main">!</span> <span class="skolem">j0</span><span class="main">)</span><span class="main">,</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> imageI<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span>›</span></span> j set_map_idx <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">i0</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i0</span> <span class="main">&lt;</span> <span class="skolem">j0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">=</span> Suc <span class="skolem">i0</span>›</span></span> j<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ord_term_lin.max <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span>punit.lt <span class="main">(</span><span class="skolem">bs</span> <span class="main">!</span> <span class="skolem">i0</span><span class="main">)</span><span class="main">,</span> Suc <span class="skolem">k</span> <span class="main">+</span> <span class="skolem">j0</span><span class="main">)</span><span class="main">)</span>
              <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span>punit.lt <span class="main">(</span><span class="skolem">bs</span> <span class="main">!</span> <span class="skolem">j0</span><span class="main">)</span><span class="main">,</span> Suc <span class="skolem">k</span> <span class="main">+</span> <span class="skolem">i0</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?B</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j0</span> <span class="main">&lt;</span> length <span class="skolem">bs</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Cons<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">=</span> Suc <span class="skolem">i0</span>›</span></span> j set_map_idx <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-Koszul_syz_sigs_auxE"><span class="command">lemma</span></span> Koszul_syz_sigs_auxE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> set <span class="main">(</span>Koszul_syz_sigs_aux <span class="free">bs</span> <span class="free">k</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">i</span> <span class="free">j</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">j</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> length <span class="free">bs</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> ord_term_lin.max <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span>punit.lt <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span><span class="main">,</span> <span class="free">k</span> <span class="main">+</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span>punit.lt <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="free">j</span><span class="main">)</span><span class="main">,</span> <span class="free">k</span> <span class="main">+</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">bs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">k</span></span> <span class="quoted"><span class="free">thesis</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">from</span></span> Nil<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">b</span> <span class="skolem">bs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">j</span><span class="main">.</span> ord_term_lin.max <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span>punit.lt <span class="skolem">b</span><span class="main">,</span> Suc <span class="main">(</span><span class="bound">j</span> <span class="main">+</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span>punit.lt <span class="main">(</span><span class="skolem">bs</span> <span class="main">!</span> <span class="bound">j</span><span class="main">)</span><span class="main">,</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span>
                <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="skolem">bs</span><span class="main">}</span> <span class="main">∪</span> set <span class="main">(</span>Koszul_syz_sigs_aux <span class="skolem">bs</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> <span class="var">?A</span> <span class="main">∪</span> <span class="var">?B</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> Cons<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_map_idx<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> <span class="var">?A</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="skolem">bs</span><span class="main">}</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> ord_term_lin.max <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span>punit.lt <span class="skolem">b</span><span class="main">,</span> Suc <span class="main">(</span><span class="skolem">j</span> <span class="main">+</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                                    <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span>punit.lt <span class="main">(</span><span class="skolem">bs</span> <span class="main">!</span> <span class="skolem">j</span><span class="main">)</span><span class="main">,</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="skolem">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Cons<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> Suc <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="skolem">bs</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">j</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">b</span> <span class="main">#</span> <span class="skolem">bs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> ord_term_lin.max <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span>punit.lt <span class="main">(</span><span class="main">(</span><span class="skolem">b</span> <span class="main">#</span> <span class="skolem">bs</span><span class="main">)</span> <span class="main">!</span> <span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="skolem">k</span> <span class="main">+</span> Suc <span class="skolem">j</span><span class="main">)</span><span class="main">)</span>
                                  <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span>punit.lt <span class="main">(</span><span class="main">(</span><span class="skolem">b</span> <span class="main">#</span> <span class="skolem">bs</span><span class="main">)</span> <span class="main">!</span> Suc <span class="skolem">j</span><span class="main">)</span><span class="main">,</span> <span class="skolem">k</span> <span class="main">+</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> v <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> <span class="var">?B</span>"</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="skolem">bs</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> ord_term_lin.max <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span>punit.lt <span class="main">(</span><span class="skolem">bs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span><span class="main">,</span> Suc <span class="skolem">k</span> <span class="main">+</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span>
                                    <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span>punit.lt <span class="main">(</span><span class="skolem">bs</span> <span class="main">!</span> <span class="skolem">j</span><span class="main">)</span><span class="main">,</span> Suc <span class="skolem">k</span> <span class="main">+</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Cons<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> <span class="quoted"><span class="quoted">‹<span class="free">v</span> <span class="main">∈</span> <span class="var">?B</span>›</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Cons<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">j</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">i</span> <span class="main">&lt;</span> Suc <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="skolem">bs</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">j</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">b</span> <span class="main">#</span> <span class="skolem">bs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> ord_term_lin.max <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span>punit.lt <span class="main">(</span><span class="main">(</span><span class="skolem">b</span> <span class="main">#</span> <span class="skolem">bs</span><span class="main">)</span> <span class="main">!</span> Suc <span class="skolem">i</span><span class="main">)</span><span class="main">,</span> <span class="skolem">k</span> <span class="main">+</span> Suc <span class="skolem">j</span><span class="main">)</span><span class="main">)</span>
                                  <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span>punit.lt <span class="main">(</span><span class="main">(</span><span class="skolem">b</span> <span class="main">#</span> <span class="skolem">bs</span><span class="main">)</span> <span class="main">!</span> Suc <span class="skolem">j</span><span class="main">)</span><span class="main">,</span> <span class="skolem">k</span> <span class="main">+</span> Suc <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> v<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-lt_Koszul_syz_comp"><span class="command">lemma</span></span> lt_Koszul_syz_comp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> set <span class="free">fs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="free">fs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span><span class="main">(</span><span class="free">fs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="main">⊙</span> monomial <span class="main">1</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">term_of_pair</span> <span class="main">(</span>punit.lt <span class="main">(</span><span class="free">fs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span><span class="main">,</span> <span class="free">j</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">fs</span> <span class="main">!</span> <span class="free">i</span> <span class="main">∈</span> set <span class="free">fs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nth_mem<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">fs</span> <span class="main">!</span> <span class="free">i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lt_mult_scalar_monomial_right splus_def <span class="dynamic"><span class="dynamic">term_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-Koszul_syz_nonzero_lt"><span class="command">lemma</span></span> Koszul_syz_nonzero_lt<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"component_of_term <span class="main">(</span>lt <span class="free">a</span><span class="main">)</span> <span class="main">&lt;</span> component_of_term <span class="main">(</span>lt <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">a</span> <span class="main">⊙</span> <span class="free">b</span> <span class="main">-</span> rep_list <span class="free">b</span> <span class="main">⊙</span> <span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">-</span> <span class="var">?q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span>rep_list <span class="free">a</span> <span class="main">⊙</span> <span class="free">b</span> <span class="main">-</span> rep_list <span class="free">b</span> <span class="main">⊙</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span>
          ord_term_lin.max <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">a</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">b</span><span class="main">)</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">b</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">a</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rep_list_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> lt_p<span class="main">:</span> <span class="quoted"><span class="quoted">"lt <span class="var">?p</span> <span class="main">=</span> punit.lt <span class="main">(</span>rep_list <span class="free">a</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lt_mult_scalar<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rep_list_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> lt_q<span class="main">:</span> <span class="quoted"><span class="quoted">"lt <span class="var">?q</span> <span class="main">=</span> punit.lt <span class="main">(</span>rep_list <span class="free">b</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lt_mult_scalar<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"component_of_term <span class="main">(</span>lt <span class="var">?p</span><span class="main">)</span> <span class="main">≠</span> component_of_term <span class="main">(</span>lt <span class="var">?q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lt_p lt_q component_of_term_splus<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lt <span class="var">?p</span> <span class="main">≠</span> lt <span class="var">?q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span><span class="var">?p</span> <span class="main">-</span> <span class="var">?q</span><span class="main">)</span> <span class="main">=</span> ord_term_lin.max <span class="main">(</span>lt <span class="var">?p</span><span class="main">)</span> <span class="main">(</span>lt <span class="var">?q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lt_minus_distinct_eq_max<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> lt_p lt_q<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span><span class="var">?p</span> <span class="main">-</span> <span class="var">?q</span><span class="main">)</span> <span class="main">=</span> <span class="var">?r</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹lt <span class="var">?p</span> <span class="main">≠</span> lt <span class="var">?q</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">-</span> <span class="var">?q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-Koszul_syz_is_syz"><span class="command">lemma</span></span> Koszul_syz_is_syz<span class="main">:</span> <span class="quoted"><span class="quoted">"rep_list <span class="main">(</span>rep_list <span class="free">a</span> <span class="main">⊙</span> <span class="free">b</span> <span class="main">-</span> rep_list <span class="free">b</span> <span class="main">⊙</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rep_list_minus rep_list_mult_scalar<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-dgrad_sig_set_closed_Koszul_syz"><span class="command">lemma</span></span> dgrad_sig_set_closed_Koszul_syz<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dickson_grading <span class="free">dgrad</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> dgrad_sig_set <span class="free">dgrad</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> dgrad_sig_set <span class="free">dgrad</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">a</span> <span class="main">⊙</span> <span class="free">b</span> <span class="main">-</span> rep_list <span class="free">b</span> <span class="main">⊙</span> <span class="free">a</span> <span class="main">∈</span> dgrad_sig_set <span class="free">dgrad</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">,</span> 3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> dgrad_max_set <span class="free">dgrad</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> dgrad_max_set <span class="free">dgrad</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dgrad_sig_set'_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> dgrad_sig_set_closed_minus dgrad_sig_set_closed_mult_scalar dgrad_max_2 assms 1 2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> Koszul_syz_is_syz_sig<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dickson_grading <span class="free">dgrad</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> dgrad_sig_set <span class="free">dgrad</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> dgrad_sig_set <span class="free">dgrad</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"component_of_term <span class="main">(</span>lt <span class="free">a</span><span class="main">)</span> <span class="main">&lt;</span> component_of_term <span class="main">(</span>lt <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_syz_sig <span class="free">dgrad</span> <span class="main">(</span>ord_term_lin.max <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">a</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">b</span><span class="main">)</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">b</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> is_syz_sigI<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>4-6<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">a</span> <span class="main">⊙</span> <span class="free">b</span> <span class="main">-</span> rep_list <span class="free">b</span> <span class="main">⊙</span> <span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span>rep_list <span class="free">a</span> <span class="main">⊙</span> <span class="free">b</span> <span class="main">-</span> rep_list <span class="free">b</span> <span class="main">⊙</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span>
          ord_term_lin.max <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">a</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">b</span><span class="main">)</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">b</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Koszul_syz_nonzero_lt<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1-3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">a</span> <span class="main">⊙</span> <span class="free">b</span> <span class="main">-</span> rep_list <span class="free">b</span> <span class="main">⊙</span> <span class="free">a</span> <span class="main">∈</span> dgrad_sig_set <span class="free">dgrad</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dgrad_sig_set_closed_Koszul_syz<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">fact</span> Koszul_syz_is_syz<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> lt_Koszul_syz_in_Koszul_syz_sigs_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"distinct <span class="free">fs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> set <span class="free">fs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">j</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> length <span class="free">fs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span><span class="main">(</span><span class="free">fs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="main">⊙</span> monomial <span class="main">1</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="free">fs</span> <span class="main">!</span> <span class="free">j</span><span class="main">)</span> <span class="main">⊙</span> monomial <span class="main">1</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span>
          set <span class="main">(</span>Koszul_syz_sigs_aux <span class="free">fs</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">∈</span> <span class="var">?K</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?a</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'b</span><span class="main">)</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?b</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'b</span><span class="main">)</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">,</span> 4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="free">fs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"rep_list <span class="var">?a</span> <span class="main">=</span> <span class="free">fs</span> <span class="main">!</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rep_list_monomial <span class="dynamic"><span class="dynamic">term_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">,</span> 4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"rep_list <span class="var">?b</span> <span class="main">=</span> <span class="free">fs</span> <span class="main">!</span> <span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rep_list_monomial <span class="dynamic"><span class="dynamic">term_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> lt <span class="main">(</span>rep_list <span class="var">?a</span> <span class="main">⊙</span> <span class="var">?b</span> <span class="main">-</span> rep_list <span class="var">?b</span> <span class="main">⊙</span> <span class="var">?a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> a b<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> ord_term_lin.max <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="var">?a</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="var">?b</span><span class="main">)</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="var">?b</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="var">?a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Koszul_syz_nonzero_lt<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">i</span> <span class="main">&lt;</span> length <span class="free">fs</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">fs</span> <span class="main">!</span> <span class="free">i</span> <span class="main">∈</span> set <span class="free">fs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nth_mem<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="var">?a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> a<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">fs</span> <span class="main">!</span> <span class="free">j</span> <span class="main">∈</span> set <span class="free">fs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nth_mem<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="var">?b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> b<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"component_of_term <span class="main">(</span>lt <span class="var">?a</span><span class="main">)</span> <span class="main">&lt;</span> component_of_term <span class="main">(</span>lt <span class="var">?b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lt_monomial component_of_term_of_pair<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> ord_term_lin.max <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span>punit.lt <span class="main">(</span><span class="free">fs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span> <span class="main">+</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span>punit.lt <span class="main">(</span><span class="free">fs</span> <span class="main">!</span> <span class="free">j</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span> <span class="main">+</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a b lt_monomial splus_def <span class="dynamic"><span class="dynamic">term_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">,</span> 4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">∈</span> <span class="var">?K</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Koszul_syz_sigs_auxI<span class="main">)</span>
  <span class="keyword1"><span class="command">thm</span></span> Koszul_syz_sigs_auxI<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">,</span></span> 4<span class="main"><span class="main">)</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> lt_Koszul_syz_in_Koszul_syz_sigs<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_pot_ord"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"distinct <span class="free">fs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> set <span class="free">fs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">j</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> length <span class="free">fs</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">v</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> set <span class="main">(</span>Koszul_syz_sigs <span class="free">fs</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> lt <span class="main">(</span><span class="main">(</span><span class="free">fs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="main">⊙</span> monomial <span class="main">1</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="free">fs</span> <span class="main">!</span> <span class="free">j</span><span class="main">)</span> <span class="main">⊙</span> monomial <span class="main">1</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"transp <span class="keyword1">(adds<span class="hidden">⇩</span><sub>t</sub>)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> transpI<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule</span> adds_term_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span><span class="main">(</span><span class="free">fs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="main">⊙</span> monomial <span class="main">1</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="free">fs</span> <span class="main">!</span> <span class="free">j</span><span class="main">)</span> <span class="main">⊙</span> monomial <span class="main">1</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span>
                  set <span class="main">(</span>Koszul_syz_sigs_aux <span class="free">fs</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">∈</span> set <span class="var">?ks</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2-5<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lt_Koszul_syz_in_Koszul_syz_sigs_aux<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> filter_min_cases<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">∈</span> set <span class="main">(</span>filter_min <span class="keyword1">(adds<span class="hidden">⇩</span><sub>t</sub>)</span> <span class="var">?ks</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">∈</span> set <span class="main">(</span>Koszul_syz_sigs <span class="free">fs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Koszul_syz_sigs_def assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> adds_term_refl <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> set <span class="main">(</span>filter_min <span class="keyword1">(adds<span class="hidden">⇩</span><sub>t</sub>)</span> <span class="var">?ks</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> set <span class="main">(</span>Koszul_syz_sigs <span class="free">fs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Koszul_syz_sigs_def assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="var">?l</span>"</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-lt_Koszul_syz_init"><span class="command">lemma</span></span> lt_Koszul_syz_init<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> set <span class="free">fs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">j</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> length <span class="free">fs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span><span class="main">(</span><span class="free">fs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="main">⊙</span> monomial <span class="main">1</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="free">fs</span> <span class="main">!</span> <span class="free">j</span><span class="main">)</span> <span class="main">⊙</span> monomial <span class="main">1</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
          ord_term_lin.max <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span>punit.lt <span class="main">(</span><span class="free">fs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span><span class="main">,</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span>punit.lt <span class="main">(</span><span class="free">fs</span> <span class="main">!</span> <span class="free">j</span><span class="main">)</span><span class="main">,</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span><span class="var">?p</span> <span class="main">-</span> <span class="var">?q</span><span class="main">)</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">,</span> 3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="free">fs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> lt_i<span class="main">:</span> <span class="quoted"><span class="quoted">"lt <span class="var">?p</span> <span class="main">=</span> <span class="free">term_of_pair</span> <span class="main">(</span>punit.lt <span class="main">(</span><span class="free">fs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span><span class="main">,</span> <span class="free">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lt_Koszul_syz_comp<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">,</span> 3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> lt_j<span class="main">:</span> <span class="quoted"><span class="quoted">"lt <span class="var">?q</span> <span class="main">=</span> <span class="free">term_of_pair</span> <span class="main">(</span>punit.lt <span class="main">(</span><span class="free">fs</span> <span class="main">!</span> <span class="free">j</span><span class="main">)</span><span class="main">,</span> <span class="free">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lt_Koszul_syz_comp<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"component_of_term <span class="main">(</span>lt <span class="var">?p</span><span class="main">)</span> <span class="main">≠</span> component_of_term <span class="main">(</span>lt <span class="var">?q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lt_i lt_j component_of_term_of_pair<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lt <span class="var">?p</span> <span class="main">≠</span> lt <span class="var">?q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span><span class="var">?p</span> <span class="main">-</span> <span class="var">?q</span><span class="main">)</span> <span class="main">=</span> ord_term_lin.max <span class="main">(</span>lt <span class="var">?p</span><span class="main">)</span> <span class="main">(</span>lt <span class="var">?q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lt_minus_distinct_eq_max<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> lt_i lt_j<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> Koszul_syz_sigs_auxE_lt_Koszul_syz<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> set <span class="free">fs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> set <span class="main">(</span>Koszul_syz_sigs_aux <span class="free">fs</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">i</span> <span class="free">j</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">j</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> length <span class="free">fs</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> lt <span class="main">(</span><span class="main">(</span><span class="free">fs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="main">⊙</span> monomial <span class="main">1</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="free">fs</span> <span class="main">!</span> <span class="free">j</span><span class="main">)</span> <span class="main">⊙</span> monomial <span class="main">1</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">fs</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> ord_term_lin.max <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span>punit.lt <span class="main">(</span><span class="free">fs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span> <span class="main">+</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span>
                        <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span>punit.lt <span class="main">(</span><span class="free">fs</span> <span class="main">!</span> <span class="skolem">j</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span> <span class="main">+</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Koszul_syz_sigs_auxE<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> lt <span class="main">(</span><span class="main">(</span><span class="free">fs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">⊙</span> monomial <span class="main">1</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span>
                                <span class="main">(</span><span class="free">fs</span> <span class="main">!</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">⊙</span> monomial <span class="main">1</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lt_Koszul_syz_init<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">j</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">fs</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> Koszul_syz_sigs_is_syz_sig<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dickson_grading <span class="free">dgrad</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"distinct <span class="free">fs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> set <span class="free">fs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> set <span class="main">(</span>Koszul_syz_sigs <span class="free">fs</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_syz_sig <span class="free">dgrad</span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> set <span class="main">(</span>Koszul_syz_sigs_aux <span class="free">fs</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> filter_min_subset <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Koszul_syz_sigs_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">fs</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> v'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> lt <span class="main">(</span><span class="main">(</span><span class="free">fs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">⊙</span> monomial <span class="main">1</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="free">fs</span> <span class="main">!</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">⊙</span> monomial <span class="main">1</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> lt <span class="main">(</span><span class="var">?p</span> <span class="main">-</span> <span class="var">?q</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Koszul_syz_sigs_auxE_lt_Koszul_syz<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?a</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'b</span><span class="main">)</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?b</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'b</span><span class="main">)</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">j</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">fs</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">fs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"rep_list <span class="var">?a</span> <span class="main">=</span> <span class="free">fs</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rep_list_monomial <span class="dynamic"><span class="dynamic">term_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">fs</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"rep_list <span class="var">?b</span> <span class="main">=</span> <span class="free">fs</span> <span class="main">!</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rep_list_monomial <span class="dynamic"><span class="dynamic">term_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> v'
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span><span class="var">?p</span> <span class="main">-</span> <span class="var">?q</span><span class="main">)</span> <span class="main">=</span> ord_term_lin.max <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span>punit.lt <span class="main">(</span><span class="free">fs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span>punit.lt <span class="main">(</span><span class="free">fs</span> <span class="main">!</span> <span class="skolem">j</span><span class="main">)</span><span class="main">,</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">j</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">fs</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lt_Koszul_syz_init<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> ord_term_lin.max <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="var">?a</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="var">?b</span><span class="main">)</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="var">?b</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="var">?a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a b lt_monomial splus_def <span class="dynamic"><span class="dynamic">term_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> ord_term_lin.max <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="var">?a</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="var">?b</span><span class="main">)</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="var">?b</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="var">?a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> v <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Koszul_syz_is_syz_sig<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a</span> <span class="main">∈</span> dgrad_sig_set <span class="free">dgrad</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dgrad_sig_set_closed_monomial<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">term_simps</span></span> dgrad_max_0 <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">fs</span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?b</span> <span class="main">∈</span> dgrad_sig_set <span class="free">dgrad</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dgrad_sig_set_closed_monomial<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">term_simps</span></span> dgrad_max_0 <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">fs</span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">fs</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">fs</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">∈</span> set <span class="free">fs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nth_mem<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="var">?a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> a<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">fs</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">fs</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">∈</span> set <span class="free">fs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nth_mem<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="var">?b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> b<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">j</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"component_of_term <span class="main">(</span>lt <span class="var">?a</span><span class="main">)</span> <span class="main">&lt;</span> component_of_term <span class="main">(</span>lt <span class="var">?b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lt_monomial component_of_term_of_pair<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-Koszul_syz_sigs_minimal"><span class="command">lemma</span></span> Koszul_syz_sigs_minimal<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> set <span class="main">(</span>Koszul_syz_sigs <span class="free">fs</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> set <span class="main">(</span>Koszul_syz_sigs <span class="free">fs</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">=</span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">,</span> 2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> set <span class="main">(</span>filter_min <span class="keyword1">(adds<span class="hidden">⇩</span><sub>t</sub>)</span> <span class="main">(</span>Koszul_syz_sigs_aux <span class="free">fs</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> set <span class="main">(</span>filter_min <span class="keyword1">(adds<span class="hidden">⇩</span><sub>t</sub>)</span> <span class="main">(</span>Koszul_syz_sigs_aux <span class="free">fs</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Koszul_syz_sigs_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> _ <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> filter_min_minimal<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"transp <span class="keyword1">(adds<span class="hidden">⇩</span><sub>t</sub>)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> transpI<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule</span> adds_term_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-Koszul_syz_sigs_distinct"><span class="command">lemma</span></span> Koszul_syz_sigs_distinct<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>Koszul_syz_sigs <span class="free">fs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> adds_term_refl <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"reflp <span class="keyword1">(adds<span class="hidden">⇩</span><sub>t</sub>)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> reflpI<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Koszul_syz_sigs_def filter_min_distinct<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Algorithms›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">spair_spp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">spair_spp</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">t1</span> <span class="main">=</span> punit.lt <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">;</span> <span class="bound">t2</span> <span class="main">=</span> punit.lt <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span><span class="main">;</span> <span class="bound">l</span> <span class="main">=</span> lcs <span class="bound">t1</span> <span class="bound">t2</span> <span class="keyword1">in</span>
                          <span class="main">(</span>ord_term_lin.max <span class="main">(</span><span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="bound">t1</span><span class="main">)</span> <span class="main">⊕</span> fst <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="bound">t2</span><span class="main">)</span> <span class="main">⊕</span> fst <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span><span class="main">,</span>
                            punit.monom_mult <span class="main">(</span><span class="main">1</span> <span class="main">/</span> punit.lc <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="bound">t1</span><span class="main">)</span> <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">-</span>
                            punit.monom_mult <span class="main">(</span><span class="main">1</span> <span class="main">/</span> punit.lc <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="bound">t2</span><span class="main">)</span> <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_regular_spair_spp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_regular_spair_spp</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">⟷</span>
                    <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> snd <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> punit.lt <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">⊕</span> fst <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≠</span> punit.lt <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">⊕</span> fst <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">spair_sigs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="tfree">'t</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">spair_sigs</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">=</span>
                  <span class="main">(</span><span class="keyword1">let</span> <span class="bound">t1</span> <span class="main">=</span> punit.lt <span class="main">(</span>rep_list <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">;</span> <span class="bound">t2</span> <span class="main">=</span> punit.lt <span class="main">(</span>rep_list <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span><span class="main">;</span> <span class="bound">l</span> <span class="main">=</span> lcs <span class="bound">t1</span> <span class="bound">t2</span> <span class="keyword1">in</span>
                    <span class="main">(</span><span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="bound">t1</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="bound">t2</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">spair_sigs_spp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="tfree">'t</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">spair_sigs_spp</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">=</span>
                  <span class="main">(</span><span class="keyword1">let</span> <span class="bound">t1</span> <span class="main">=</span> punit.lt <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">;</span> <span class="bound">t2</span> <span class="main">=</span> punit.lt <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span><span class="main">;</span> <span class="bound">l</span> <span class="main">=</span> lcs <span class="bound">t1</span> <span class="bound">t2</span> <span class="keyword1">in</span>
                    <span class="main">(</span><span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="bound">t1</span><span class="main">)</span> <span class="main">⊕</span> fst <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span> <span class="main">(</span><span class="bound">l</span> <span class="main">-</span> <span class="bound">t2</span><span class="main">)</span> <span class="main">⊕</span> fst <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">poly_of_pair</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> nat<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">poly_of_pair</span> <span class="main">(</span>Inl <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> spair <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span>"</span></span> <span class="main">|</span>
    <span class="quoted"><span class="quoted">"<span class="free">poly_of_pair</span> <span class="main">(</span>Inr <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span> <span class="main">=</span> monomial <span class="main">1</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">spp_of_pair</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> nat<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">spp_of_pair</span> <span class="main">(</span>Inl <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> spair_spp <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span>"</span></span> <span class="main">|</span>
    <span class="quoted"><span class="quoted">"<span class="free">spp_of_pair</span> <span class="main">(</span>Inr <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span><span class="main">,</span> <span class="free">fs</span> <span class="main">!</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">sig_of_pair</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> nat<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'t</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">sig_of_pair</span> <span class="main">(</span>Inl <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">=</span> spair_sigs <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="keyword1">in</span> ord_term_lin.max <span class="bound">u</span> <span class="bound">v</span><span class="main">)</span>"</span></span> <span class="main">|</span>
    <span class="quoted"><span class="quoted">"<span class="free">sig_of_pair</span> <span class="main">(</span>Inr <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">sig_of_pair_spp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> nat<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'t</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">sig_of_pair_spp</span> <span class="main">(</span>Inl <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">=</span> spair_sigs_spp <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="keyword1">in</span> ord_term_lin.max <span class="bound">u</span> <span class="bound">v</span><span class="main">)</span>"</span></span> <span class="main">|</span>
    <span class="quoted"><span class="quoted">"<span class="free">sig_of_pair_spp</span> <span class="main">(</span>Inr <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">pair_ord</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> nat<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> nat<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">pair_ord</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">⟷</span> <span class="main">(</span>sig_of_pair <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> sig_of_pair <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">pair_ord_spp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> nat<span class="main">)</span> <span class="main">⇒</span>
                            <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> nat<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">pair_ord_spp</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">⟷</span> <span class="main">(</span>sig_of_pair_spp <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> sig_of_pair_spp <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">new_spairs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span> list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> nat<span class="main">)</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">new_spairs</span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">new_spairs</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">if</span> is_regular_spair <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">then</span> insort_wrt pair_ord <span class="main">(</span>Inl <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">new_spairs</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="keyword1">else</span> <span class="free">new_spairs</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">new_spairs_spp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> <span class="main">⇒</span>
                            <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> nat<span class="main">)</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">new_spairs_spp</span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">new_spairs_spp</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span>
      <span class="main">(</span><span class="keyword1">if</span> is_regular_spair_spp <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">then</span>
        insort_wrt pair_ord_spp <span class="main">(</span>Inl <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">new_spairs_spp</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>
      <span class="keyword1">else</span> <span class="free">new_spairs_spp</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">add_spairs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> nat<span class="main">)</span> list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span> list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">⇒</span>
                            <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> nat<span class="main">)</span> list"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">add_spairs</span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> merge_wrt pair_ord <span class="main">(</span>new_spairs <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">add_spairs_spp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> nat<span class="main">)</span> list <span class="main">⇒</span>
                              <span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> <span class="main">⇒</span>
                              <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> nat<span class="main">)</span> list"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">add_spairs_spp</span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> merge_wrt pair_ord_spp <span class="main">(</span>new_spairs_spp <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span>"</span></span>

<span class="keyword1" id="Signature_Groebner-spair_alt_spair_sigs"><span class="command">lemma</span></span> spair_alt_spair_sigs<span class="main">:</span>
  <span class="quoted"><span class="quoted">"spair <span class="free">p</span> <span class="free">q</span> <span class="main">=</span> monom_mult <span class="main">(</span><span class="main">1</span> <span class="main">/</span> punit.lc <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>pp_of_term <span class="main">(</span>fst <span class="main">(</span>spair_sigs <span class="free">p</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> lp <span class="free">p</span><span class="main">)</span> <span class="free">p</span> <span class="main">-</span>
                monom_mult <span class="main">(</span><span class="main">1</span> <span class="main">/</span> punit.lc <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>pp_of_term <span class="main">(</span>snd <span class="main">(</span>spair_sigs <span class="free">p</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> lp <span class="free">q</span><span class="main">)</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> spair_def spair_sigs_def Let_def <span class="dynamic"><span class="dynamic">term_simps</span></span><span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-sig_of_spair"><span class="command">lemma</span></span> sig_of_spair<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_regular_spair <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sig_of_pair <span class="main">(</span>Inl <span class="main">(</span><span class="free">p</span><span class="main">,</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> lt <span class="main">(</span>spair <span class="free">p</span> <span class="free">q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_regular_spairD1<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.lc <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.lc_not_0<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rep_list_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_regular_spairD2<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.lc <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.lc_not_0<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rep_list_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"lcs <span class="var">?t1</span> <span class="var">?t2</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span>monom_mult <span class="main">(</span><span class="main">1</span> <span class="main">/</span> punit.lc <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="var">?l</span> <span class="main">-</span> <span class="var">?t1</span><span class="main">)</span> <span class="free">p</span><span class="main">)</span> <span class="main">≠</span>
                   lt <span class="main">(</span>monom_mult <span class="main">(</span><span class="main">1</span> <span class="main">/</span> punit.lc <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="var">?l</span> <span class="main">-</span> <span class="var">?t2</span><span class="main">)</span> <span class="free">q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_regular_spairD3<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span>monom_mult <span class="main">(</span><span class="main">1</span> <span class="main">/</span> punit.lc <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>pp_of_term <span class="main">(</span>fst <span class="main">(</span>spair_sigs <span class="free">p</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> lp <span class="free">p</span><span class="main">)</span> <span class="free">p</span><span class="main">)</span> <span class="main">≠</span>
            lt <span class="main">(</span>monom_mult <span class="main">(</span><span class="main">1</span> <span class="main">/</span> punit.lc <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>pp_of_term <span class="main">(</span>snd <span class="main">(</span>spair_sigs <span class="free">p</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> lp <span class="free">q</span><span class="main">)</span> <span class="free">q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> spair_sigs_def Let_def <span class="dynamic"><span class="dynamic">term_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 1 2 <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> spair_alt_spair_sigs lt_monom_mult lt_minus_distinct_eq_max<span class="main"><span class="main">[</span></span><span class="operator">OF</span> *<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
        <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> spair_sigs_def Let_def <span class="dynamic"><span class="dynamic">term_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-sig_of_spair_commute"><span class="command">lemma</span></span> sig_of_spair_commute<span class="main">:</span> <span class="quoted"><span class="quoted">"sig_of_pair <span class="main">(</span>Inl <span class="main">(</span><span class="free">p</span><span class="main">,</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> sig_of_pair <span class="main">(</span>Inl <span class="main">(</span><span class="free">q</span><span class="main">,</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> spair_sigs_def Let_def lcs_comm ord_term_lin.max.commute<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-in_new_spairsI"><span class="command">lemma</span></span> in_new_spairsI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_regular_spair <span class="free">p</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Inl <span class="main">(</span><span class="free">p</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>new_spairs <span class="free">bs</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">bs</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">bs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">∨</span> <span class="free">b</span> <span class="main">∈</span> set <span class="skolem">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">=</span> <span class="skolem">a</span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> set <span class="skolem">bs</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Inl <span class="main">(</span><span class="free">p</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>new_spairs <span class="skolem">bs</span> <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Cons<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-in_new_spairsD"><span class="command">lemma</span></span> in_new_spairsD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Inl <span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>new_spairs <span class="free">bs</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_regular_spair <span class="free">p</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="free">p</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">∈</span> set <span class="free">bs</span> <span class="main">∧</span> is_regular_spair <span class="free">p</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">bs</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">c</span> <span class="skolem">bs</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>is_regular_spair <span class="free">p</span> <span class="skolem">c</span> <span class="main">∧</span> Inl <span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> Inl <span class="main">(</span><span class="free">p</span><span class="main">,</span> <span class="skolem">c</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> Inl <span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>new_spairs <span class="skolem">bs</span> <span class="free">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_regular_spair <span class="free">p</span> <span class="skolem">c</span> <span class="main">∧</span> Inl <span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> Inl <span class="main">(</span><span class="free">p</span><span class="main">,</span> <span class="skolem">c</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_regular_spair <span class="free">p</span> <span class="skolem">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Inl <span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>new_spairs <span class="skolem">bs</span> <span class="free">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="free">p</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">∈</span> set <span class="skolem">bs</span> <span class="main">∧</span> is_regular_spair <span class="free">p</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Cons<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_regular_spair <span class="free">p</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> in_new_spairs_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Inl <span class="main">(</span><span class="free">p</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>new_spairs <span class="free">bs</span> <span class="free">p</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">b</span> <span class="main">∈</span> set <span class="free">bs</span> <span class="main">∧</span> is_regular_spair <span class="free">p</span> <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> in_new_spairsI <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> in_new_spairsD<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-Inr_not_in_new_spairs"><span class="command">lemma</span></span> Inr_not_in_new_spairs<span class="main">:</span> <span class="quoted"><span class="quoted">"Inr <span class="free">j</span> <span class="main">∉</span> set <span class="main">(</span>new_spairs <span class="free">bs</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">bs</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-sum_prodE"><span class="command">lemma</span></span> sum_prodE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="free">p</span> <span class="main">=</span> Inl <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">j</span><span class="main">.</span> <span class="free">p</span> <span class="main">=</span> Inr <span class="bound">j</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="free">thesis</span></span>
  <span class="keyword1"><span class="command">using</span></span> _ assms<span class="main">(</span>2<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sumE<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> Inl <span class="skolem">x</span>"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> Inl <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> in_new_spairsE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> set <span class="main">(</span>new_spairs <span class="free">bs</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">b</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_regular_spair <span class="free">p</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> Inl <span class="main">(</span><span class="free">p</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum_prodE<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
  <span class="keyword3"><span class="command">assume</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> Inl <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_regular_spair <span class="free">p</span> <span class="skolem">b</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> q <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> in_new_spairsD<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">note</span></span> this<span class="main">(</span>2<span class="main">,</span> 3<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> Inl <span class="main">(</span><span class="free">p</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> q <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">=</span> <span class="free">p</span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> Inr <span class="skolem">j</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Inr_not_in_new_spairs<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-new_spairs_sorted"><span class="command">lemma</span></span> new_spairs_sorted<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted_wrt pair_ord <span class="main">(</span>new_spairs <span class="free">bs</span> <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">bs</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">bs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"transp pair_ord"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> transpI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pair_ord_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pair_ord <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">∨</span> pair_ord <span class="skolem">y</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pair_ord_def ord_term_lin.linear<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sorted_wrt_insort_wrt<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-sorted_add_spairs"><span class="command">lemma</span></span> sorted_add_spairs<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sorted_wrt pair_ord <span class="free">ps</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sorted_wrt pair_ord <span class="main">(</span>add_spairs <span class="free">ps</span> <span class="free">bs</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> add_spairs_def <span class="keyword1"><span class="command">using</span></span> _ _ new_spairs_sorted assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sorted_merge_wrt<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"transp pair_ord"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> transpI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pair_ord_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"pair_ord <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">∨</span> pair_ord <span class="skolem">y</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pair_ord_def ord_term_lin.linear<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">rword_strict</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span>   <span class="comment1">―‹Must be a <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">emph</span> ‹strict›<span class="antiquote">}</span></span> rewrite order.›</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword2"><span class="keyword">qualified</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="entity">rword</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">rword</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">⟷</span> <span class="main">¬</span> <span class="free">rword_strict</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_pred_syz</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'t</span> list <span class="main">⇒</span> <span class="tfree">'t</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_pred_syz</span> <span class="free"><span class="bound"><span class="entity">ss</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v</span><span class="main">∈</span>set <span class="free"><span class="bound"><span class="entity">ss</span></span></span><span class="main">.</span> <span class="bound">v</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_rewritable</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span> list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'t</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_rewritable</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">∈</span>set <span class="free"><span class="bound"><span class="entity">bs</span></span></span><span class="main">.</span> <span class="bound">b</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> lt <span class="bound">b</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">∧</span> <span class="free">rword_strict</span> <span class="main">(</span>spp_of <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">(</span>spp_of <span class="bound">b</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_rewritable_spp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'t</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_rewritable_spp</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">∈</span>set <span class="free"><span class="bound"><span class="entity">bs</span></span></span><span class="main">.</span> fst <span class="bound">b</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">∧</span> <span class="free">rword_strict</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">b</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">sig_crit</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span> list <span class="main">⇒</span> <span class="tfree">'t</span> list <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> nat<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">sig_crit</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="free"><span class="bound"><span class="entity">ss</span></span></span> <span class="main">(</span>Inl <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
      <span class="main">(</span><span class="keyword1">let</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">=</span> spair_sigs <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="keyword1">in</span>
        is_pred_syz <span class="free"><span class="bound"><span class="entity">ss</span></span></span> <span class="bound">u</span> <span class="main">∨</span> is_pred_syz <span class="free"><span class="bound"><span class="entity">ss</span></span></span> <span class="bound">v</span> <span class="main">∨</span> is_rewritable <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">u</span> <span class="main">∨</span> is_rewritable <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="bound">v</span><span class="main">)</span>"</span></span> <span class="main">|</span>
    <span class="quoted"><span class="quoted">"<span class="free">sig_crit</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="free"><span class="bound"><span class="entity">ss</span></span></span> <span class="main">(</span>Inr <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span> <span class="main">=</span> is_pred_syz <span class="free"><span class="bound"><span class="entity">ss</span></span></span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">sig_crit'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span> list <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> nat<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">sig_crit'</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="main">(</span>Inl <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
      <span class="main">(</span><span class="keyword1">let</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">=</span> spair_sigs <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="keyword1">in</span>
        is_syz_sig <span class="free">dgrad</span> <span class="bound">u</span> <span class="main">∨</span> is_syz_sig <span class="free">dgrad</span> <span class="bound">v</span> <span class="main">∨</span> is_rewritable <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">u</span> <span class="main">∨</span> is_rewritable <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="bound">v</span><span class="main">)</span>"</span></span> <span class="main">|</span>
    <span class="quoted"><span class="quoted">"<span class="free">sig_crit'</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="main">(</span>Inr <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span> <span class="main">=</span> is_syz_sig <span class="free">dgrad</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">sig_crit_spp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> list <span class="main">⇒</span> <span class="tfree">'t</span> list <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> nat<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">sig_crit_spp</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="free"><span class="bound"><span class="entity">ss</span></span></span> <span class="main">(</span>Inl <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
      <span class="main">(</span><span class="keyword1">let</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">=</span> spair_sigs_spp <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="keyword1">in</span>
        is_pred_syz <span class="free"><span class="bound"><span class="entity">ss</span></span></span> <span class="bound">u</span> <span class="main">∨</span> is_pred_syz <span class="free"><span class="bound"><span class="entity">ss</span></span></span> <span class="bound">v</span> <span class="main">∨</span> is_rewritable_spp <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">u</span> <span class="main">∨</span> is_rewritable_spp <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="bound">v</span><span class="main">)</span>"</span></span> <span class="main">|</span>
    <span class="quoted"><span class="quoted">"<span class="free">sig_crit_spp</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="free"><span class="bound"><span class="entity">ss</span></span></span> <span class="main">(</span>Inr <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span> <span class="main">=</span> is_pred_syz <span class="free"><span class="bound"><span class="entity">ss</span></span></span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> sig_crit<span class="antiquote"><span class="antiquote">}</span></span></span></span> is used in algorithms, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> sig_crit'<span class="antiquote"><span class="antiquote">}</span></span></span></span> is only needed for proving.›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">rb_spp_body</span> <span class="main">::</span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> list <span class="main">×</span> <span class="tfree">'t</span> list <span class="main">×</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> nat<span class="main">)</span> list<span class="main">)</span> <span class="main">×</span> nat<span class="main">)</span> <span class="main">⇒</span>
       <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> list <span class="main">×</span> <span class="tfree">'t</span> list <span class="main">×</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> nat<span class="main">)</span> list<span class="main">)</span> <span class="main">×</span> nat<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">rb_spp_body</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">bs</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">ss</span></span></span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">bs</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">ss</span></span></span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">rb_spp_body</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">bs</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">ss</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">)</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">let</span> <span class="bound">ss'</span> <span class="main">=</span> new_syz_sigs_spp <span class="free"><span class="bound"><span class="entity">ss</span></span></span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1">in</span>
      <span class="keyword1">if</span> sig_crit_spp <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="bound">ss'</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1">then</span>
          <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">bs</span></span></span><span class="main">,</span> <span class="bound">ss'</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">)</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span>
       <span class="keyword1">else</span>
          <span class="keyword1">let</span> <span class="bound">p'</span> <span class="main">=</span> sig_trd_spp <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="main">(</span>spp_of_pair <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="keyword1">in</span>
          <span class="keyword1">if</span> snd <span class="bound">p'</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span>
            <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">bs</span></span></span><span class="main">,</span> fst <span class="bound">p'</span> <span class="main">#</span> <span class="bound">ss'</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">)</span><span class="main">,</span> Suc <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span>
          <span class="keyword1">else</span>
            <span class="main">(</span><span class="main">(</span><span class="bound">p'</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span><span class="main">,</span> <span class="bound">ss'</span><span class="main">,</span> add_spairs_spp <span class="free"><span class="bound"><span class="entity">ps</span></span></span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="bound">p'</span><span class="main">)</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rb_spp_aux</span> <span class="main">::</span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> list <span class="main">×</span> <span class="tfree">'t</span> list <span class="main">×</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> nat<span class="main">)</span> list<span class="main">)</span> <span class="main">×</span> nat<span class="main">)</span> <span class="main">⇒</span>
       <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> list <span class="main">×</span> <span class="tfree">'t</span> list <span class="main">×</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> nat<span class="main">)</span> list<span class="main">)</span> <span class="main">×</span> nat<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> rb_spp_aux_def <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword">del</span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">rb_spp_aux</span> <span class="main">=</span> tailrec.fun <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> snd <span class="main">(</span>snd <span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span> rb_spp_body"</span></span>

<span class="keyword1" id="Signature_Groebner-rb_spp_aux_Nil"><span class="command">lemma</span></span> rb_spp_aux_Nil <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"rb_spp_aux <span class="main">(</span><span class="main">(</span><span class="free">bs</span><span class="main">,</span> <span class="free">ss</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span><span class="main">,</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">bs</span><span class="main">,</span> <span class="free">ss</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span><span class="main">,</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rb_spp_aux_def tailrec.simps<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-rb_spp_aux_Cons"><span class="command">lemma</span></span> rb_spp_aux_Cons <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"rb_spp_aux <span class="main">(</span><span class="main">(</span><span class="free">bs</span><span class="main">,</span> <span class="free">ss</span><span class="main">,</span> <span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span><span class="main">,</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> rb_spp_aux <span class="main">(</span>rb_spp_body <span class="main">(</span><span class="main">(</span><span class="free">bs</span><span class="main">,</span> <span class="free">ss</span><span class="main">,</span> <span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span><span class="main">,</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rb_spp_aux_def tailrec.simps<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The last parameter / return value of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> rb_spp_aux<span class="antiquote"><span class="antiquote">}</span></span></span></span>, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">z</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, counts the number of
  zero-reductions. Below we will prove that this number remains $0$ under certain conditions.›</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> rword_is_strict_rewrite_ord<span class="main">:</span> <span class="quoted"><span class="quoted">"is_strict_rewrite_ord <span class="free">rword_strict</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> dgrad<span class="main">:</span> <span class="quoted"><span class="quoted">"dickson_grading <span class="free">dgrad</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Signature_Groebner-rword"><span class="command">lemma</span></span> rword<span class="main">:</span> <span class="quoted"><span class="quoted">"is_rewrite_ord rword"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rword_def <span class="keyword1"><span class="command">using</span></span> rword_is_strict_rewrite_ord <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_strict_rewrite_ordD<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-sig_crit'_sym"><span class="command">lemma</span></span> sig_crit'_sym<span class="main">:</span> <span class="quoted"><span class="quoted">"sig_crit' <span class="free">bs</span> <span class="main">(</span>Inl <span class="main">(</span><span class="free">p</span><span class="main">,</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> sig_crit' <span class="free">bs</span> <span class="main">(</span>Inl <span class="main">(</span><span class="free">q</span><span class="main">,</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> spair_sigs_def Let_def lcs_comm<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-is_rewritable_ConsD"><span class="command">lemma</span></span> is_rewritable_ConsD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_rewritable <span class="main">(</span><span class="free">b</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span> <span class="free">p</span> <span class="free">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_rewritable <span class="free">bs</span> <span class="free">p</span> <span class="free">u</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b'</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">b</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">b'</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">u</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">rword_strict</span> <span class="main">(</span>spp_of <span class="free">p</span><span class="main">)</span> <span class="main">(</span>spp_of <span class="skolem">b'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_rewritable_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">b'</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ord_adds_term<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b'</span> <span class="main">≠</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b'</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">b</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b'</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹lt <span class="skolem">b'</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">u</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">rword_strict</span> <span class="main">(</span>spp_of <span class="free">p</span><span class="main">)</span> <span class="main">(</span>spp_of <span class="skolem">b'</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_rewritable_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-sig_crit'_ConsD"><span class="command">lemma</span></span> sig_crit'_ConsD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sig_crit' <span class="main">(</span><span class="free">b</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"sig_of_pair <span class="free">p</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sig_crit' <span class="free">bs</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum_prodE<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
  <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> Inl <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> fst <span class="main">(</span>spair_sigs <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> snd <span class="main">(</span>spair_sigs <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> sigs<span class="main">:</span> <span class="quoted"><span class="quoted">"spair_sigs <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> u_def v_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> sig_of_pair <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> sig_of_pair <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p sigs<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> p sigs <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> is_rewritable_ConsD<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
  <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> Inr <span class="skolem">j</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rb_aux_inv1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span> list <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">rb_aux_inv1</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="main">=</span>
               <span class="main">(</span>set <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="main">⊆</span> dgrad_sig_set <span class="free">dgrad</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">∉</span> rep_list <span class="main">`</span> set <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="main">∧</span>
                sorted_wrt <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> lt <span class="bound">y</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="bound">x</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="main">∧</span>
                <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="free"><span class="bound"><span class="entity">bs</span></span></span><span class="main">.</span> <span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="main">(</span>set <span class="main">(</span>drop <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="free"><span class="bound"><span class="entity">bs</span></span></span><span class="main">.</span>
    <span class="main">(</span><span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span>length <span class="free">fs</span><span class="main">.</span> lt <span class="main">(</span><span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> lt <span class="main">(</span>monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'b</span><span class="main">)</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
            punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">≼</span></span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span>monomial <span class="main">1</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span>
    <span class="main">(</span><span class="main">∃</span><span class="bound">p</span><span class="main">∈</span>set <span class="free"><span class="bound"><span class="entity">bs</span></span></span><span class="main">.</span> <span class="main">∃</span><span class="bound">q</span><span class="main">∈</span>set <span class="free"><span class="bound"><span class="entity">bs</span></span></span><span class="main">.</span> is_regular_spair <span class="bound">p</span> <span class="bound">q</span> <span class="main">∧</span> rep_list <span class="main">(</span>spair <span class="bound">p</span> <span class="bound">q</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span>
            lt <span class="main">(</span><span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> lt <span class="main">(</span>spair <span class="bound">p</span> <span class="bound">q</span><span class="main">)</span> <span class="main">∧</span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">≼</span></span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span>spair <span class="bound">p</span> <span class="bound">q</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="free"><span class="bound"><span class="entity">bs</span></span></span><span class="main">.</span> is_RB_upt <span class="free">dgrad</span> rword <span class="main">(</span>set <span class="main">(</span>drop <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>lt <span class="main">(</span><span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">rb_aux_inv</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span> list <span class="main">×</span> <span class="tfree">'t</span> list <span class="main">×</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> nat<span class="main">)</span> list<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">rb_aux_inv</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">bs</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">ss</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">)</span> <span class="main">=</span>
          <span class="main">(</span>rb_aux_inv1 <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="main">∧</span>
            <span class="main">(</span><span class="main">∀</span><span class="bound">u</span><span class="main">∈</span>set <span class="free"><span class="bound"><span class="entity">ss</span></span></span><span class="main">.</span> is_syz_sig <span class="free">dgrad</span> <span class="bound">u</span><span class="main">)</span> <span class="main">∧</span>
            <span class="main">(</span><span class="main">∀</span><span class="bound">p</span> <span class="bound">q</span><span class="main">.</span> Inl <span class="main">(</span><span class="bound">p</span><span class="main">,</span> <span class="bound">q</span><span class="main">)</span> <span class="main">∈</span> set <span class="free"><span class="bound"><span class="entity">ps</span></span></span> <span class="main">⟶</span> <span class="main">(</span>is_regular_spair <span class="bound">p</span> <span class="bound">q</span> <span class="main">∧</span> <span class="bound">p</span> <span class="main">∈</span> set <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="main">∧</span> <span class="bound">q</span> <span class="main">∈</span> set <span class="free"><span class="bound"><span class="entity">bs</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
            <span class="main">(</span><span class="main">∀</span><span class="bound">j</span><span class="main">.</span> Inr <span class="bound">j</span> <span class="main">∈</span> set <span class="free"><span class="bound"><span class="entity">ps</span></span></span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">j</span> <span class="main">&lt;</span> length <span class="free">fs</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">b</span><span class="main">∈</span>set <span class="free"><span class="bound"><span class="entity">bs</span></span></span><span class="main">.</span> lt <span class="bound">b</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                              length <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">q</span><span class="main">.</span> sig_of_pair <span class="bound">q</span> <span class="main">=</span> <span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span><span class="main">)</span> <span class="main">∧</span>
            <span class="main">(</span>sorted_wrt pair_ord <span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">)</span> <span class="main">∧</span>
            <span class="main">(</span><span class="main">∀</span><span class="bound">p</span><span class="main">∈</span>set <span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">b1</span><span class="main">∈</span>set <span class="free"><span class="bound"><span class="entity">bs</span></span></span><span class="main">.</span> <span class="main">∀</span><span class="bound">b2</span><span class="main">∈</span>set <span class="free"><span class="bound"><span class="entity">bs</span></span></span><span class="main">.</span> is_regular_spair <span class="bound">b1</span> <span class="bound">b2</span> <span class="main">⟶</span>
                          sig_of_pair <span class="bound">p</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="main">(</span>spair <span class="bound">b1</span> <span class="bound">b2</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span>Inl <span class="main">(</span><span class="bound">b1</span><span class="main">,</span> <span class="bound">b2</span><span class="main">)</span> <span class="main">∈</span> set <span class="free"><span class="bound"><span class="entity">ps</span></span></span> <span class="main">∨</span> Inl <span class="main">(</span><span class="bound">b2</span><span class="main">,</span> <span class="bound">b1</span><span class="main">)</span> <span class="main">∈</span> set <span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                        <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span>length <span class="free">fs</span><span class="main">.</span> sig_of_pair <span class="bound">p</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span> <span class="main">⟶</span> Inr <span class="bound">j</span> <span class="main">∈</span> set <span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
            <span class="main">(</span><span class="main">∀</span><span class="bound">b</span><span class="main">∈</span>set <span class="free"><span class="bound"><span class="entity">bs</span></span></span><span class="main">.</span> <span class="main">∀</span><span class="bound">p</span><span class="main">∈</span>set <span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">.</span> lt <span class="bound">b</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> sig_of_pair <span class="bound">p</span><span class="main">)</span> <span class="main">∧</span>
            <span class="main">(</span><span class="main">∀</span><span class="bound">a</span><span class="main">∈</span>set <span class="free"><span class="bound"><span class="entity">bs</span></span></span><span class="main">.</span> <span class="main">∀</span><span class="bound">b</span><span class="main">∈</span>set <span class="free"><span class="bound"><span class="entity">bs</span></span></span><span class="main">.</span> is_regular_spair <span class="bound">a</span> <span class="bound">b</span> <span class="main">⟶</span> Inl <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∉</span> set <span class="free"><span class="bound"><span class="entity">ps</span></span></span> <span class="main">⟶</span> Inl <span class="main">(</span><span class="bound">b</span><span class="main">,</span> <span class="bound">a</span><span class="main">)</span> <span class="main">∉</span> set <span class="free"><span class="bound"><span class="entity">ps</span></span></span> <span class="main">⟶</span>
                <span class="main">¬</span> is_RB_in <span class="free">dgrad</span> rword <span class="main">(</span>set <span class="free"><span class="bound"><span class="entity">bs</span></span></span><span class="main">)</span> <span class="main">(</span>lt <span class="main">(</span>spair <span class="bound">a</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
                <span class="main">(</span><span class="main">∃</span><span class="bound">p</span><span class="main">∈</span>set <span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">.</span> sig_of_pair <span class="bound">p</span> <span class="main">=</span> lt <span class="main">(</span>spair <span class="bound">a</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> sig_crit' <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
            <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span>length <span class="free">fs</span><span class="main">.</span> Inr <span class="bound">j</span> <span class="main">∉</span> set <span class="free"><span class="bound"><span class="entity">ps</span></span></span> <span class="main">⟶</span> <span class="main">(</span>is_RB_in <span class="free">dgrad</span> rword <span class="main">(</span>set <span class="free"><span class="bound"><span class="entity">bs</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                rep_list <span class="main">(</span>monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'b</span><span class="main">)</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> ideal <span class="main">(</span>rep_list <span class="main">`</span> set <span class="free"><span class="bound"><span class="entity">bs</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span> <span class="main">=</span> rb_aux_inv.simps

<span class="keyword1" id="Signature_Groebner-rb_aux_inv1_D1"><span class="command">lemma</span></span> rb_aux_inv1_D1<span class="main">:</span> <span class="quoted"><span class="quoted">"rb_aux_inv1 <span class="free">bs</span> <span class="main">⟹</span> set <span class="free">bs</span> <span class="main">⊆</span> dgrad_sig_set <span class="free">dgrad</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rb_aux_inv1_def<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-rb_aux_inv1_D2"><span class="command">lemma</span></span> rb_aux_inv1_D2<span class="main">:</span> <span class="quoted"><span class="quoted">"rb_aux_inv1 <span class="free">bs</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">∉</span> rep_list <span class="main">`</span> set <span class="free">bs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rb_aux_inv1_def<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-rb_aux_inv1_D3"><span class="command">lemma</span></span> rb_aux_inv1_D3<span class="main">:</span> <span class="quoted"><span class="quoted">"rb_aux_inv1 <span class="free">bs</span> <span class="main">⟹</span> sorted_wrt <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> lt <span class="bound">y</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="bound">x</span><span class="main">)</span> <span class="free">bs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rb_aux_inv1_def<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-rb_aux_inv1_D4"><span class="command">lemma</span></span> rb_aux_inv1_D4<span class="main">:</span>
  <span class="quoted"><span class="quoted">"rb_aux_inv1 <span class="free">bs</span> <span class="main">⟹</span> <span class="free">i</span> <span class="main">&lt;</span> length <span class="free">bs</span> <span class="main">⟹</span> <span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="main">(</span>set <span class="main">(</span>drop <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="free">bs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rb_aux_inv1_def<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-rb_aux_inv1_D5"><span class="command">lemma</span></span> rb_aux_inv1_D5<span class="main">:</span>
  <span class="quoted"><span class="quoted">"rb_aux_inv1 <span class="free">bs</span> <span class="main">⟹</span> <span class="free">i</span> <span class="main">&lt;</span> length <span class="free">bs</span> <span class="main">⟹</span> is_RB_upt <span class="free">dgrad</span> rword <span class="main">(</span>set <span class="main">(</span>drop <span class="main">(</span>Suc <span class="free">i</span><span class="main">)</span> <span class="free">bs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>lt <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rb_aux_inv1_def<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-rb_aux_inv1_E"><span class="command">lemma</span></span> rb_aux_inv1_E<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv1 <span class="free">bs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="free">bs</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span> <span class="main">&lt;</span> length <span class="free">fs</span> <span class="main">⟹</span> lt <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> lt <span class="main">(</span>monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'b</span><span class="main">)</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
            punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">≼</span></span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span>monomial <span class="main">1</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span> <span class="bound">q</span><span class="main">.</span> <span class="bound">p</span> <span class="main">∈</span> set <span class="free">bs</span> <span class="main">⟹</span> <span class="bound">q</span> <span class="main">∈</span> set <span class="free">bs</span> <span class="main">⟹</span> is_regular_spair <span class="bound">p</span> <span class="bound">q</span> <span class="main">⟹</span> rep_list <span class="main">(</span>spair <span class="bound">p</span> <span class="bound">q</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span>
            lt <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> lt <span class="main">(</span>spair <span class="bound">p</span> <span class="bound">q</span><span class="main">)</span> <span class="main">⟹</span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">≼</span></span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span>spair <span class="bound">p</span> <span class="bound">q</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="free">thesis</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> rb_aux_inv1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemmas</span></span> rb_aux_inv1_D <span class="main">=</span> rb_aux_inv1_D1 rb_aux_inv1_D2 rb_aux_inv1_D3 rb_aux_inv1_D4
                           rb_aux_inv1_D5

<span class="keyword1" id="Signature_Groebner-rb_aux_inv1_distinct_lt"><span class="command">lemma</span></span> rb_aux_inv1_distinct_lt<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv1 <span class="free">bs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map lt <span class="free">bs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> distinct_sorted_wrt_irrefl<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"irreflp <span class="keyword1">(≻<span class="hidden">⇩</span><sub>t</sub>)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> irreflp_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"transp <span class="keyword1">(≻<span class="hidden">⇩</span><sub>t</sub>)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> transp_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sorted_wrt <span class="keyword1">(≻<span class="hidden">⇩</span><sub>t</sub>)</span> <span class="main">(</span>map lt <span class="free">bs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> sorted_wrt_map conversep_iff <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv1_D3<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> rb_aux_inv1_lt_inj_on<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv1 <span class="free">bs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"inj_on lt <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">bs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="free">bs</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> in_set_conv_nth<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">bs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> <span class="free">bs</span> <span class="main">!</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> in_set_conv_nth<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">a</span> <span class="main">=</span> lt <span class="skolem">b</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> i j <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>map lt <span class="free">bs</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span>map lt <span class="free">bs</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a b<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map lt <span class="free">bs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv1_distinct_lt<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> i <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="main">(</span>map lt <span class="free">bs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> j <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="main">(</span>map lt <span class="free">bs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> nth_eq_iff_index_eq<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a b<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-canon_rewriter_unique"><span class="command">lemma</span></span> canon_rewriter_unique<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv1 <span class="free">bs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_canon_rewriter rword <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="free">u</span> <span class="free">a</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_canon_rewriter rword <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="free">u</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on lt <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv1_lt_inj_on<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> rword<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">,</span> 3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="free">a</span> <span class="main">=</span> lt <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_rewrite_ord_canon_rewriterD2<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_canon_rewriterD1<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_canon_rewriterD1<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> inj_onD<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-rb_aux_inv_D1"><span class="command">lemma</span></span> rb_aux_inv_D1<span class="main">:</span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span><span class="free">bs</span><span class="main">,</span> <span class="free">ss</span><span class="main">,</span> <span class="free">ps</span><span class="main">)</span> <span class="main">⟹</span> rb_aux_inv1 <span class="free">bs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rb_aux_inv.simps<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-rb_aux_inv_D2"><span class="command">lemma</span></span> rb_aux_inv_D2<span class="main">:</span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span><span class="free">bs</span><span class="main">,</span> <span class="free">ss</span><span class="main">,</span> <span class="free">ps</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">u</span> <span class="main">∈</span> set <span class="free">ss</span> <span class="main">⟹</span> is_syz_sig <span class="free">dgrad</span> <span class="free">u</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rb_aux_inv.simps<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-rb_aux_inv_D3"><span class="command">lemma</span></span> rb_aux_inv_D3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span><span class="free">bs</span><span class="main">,</span> <span class="free">ss</span><span class="main">,</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Inl <span class="main">(</span><span class="free">p</span><span class="main">,</span> <span class="free">q</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_regular_spair <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rb_aux_inv.simps<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-rb_aux_inv_D4"><span class="command">lemma</span></span> rb_aux_inv_D4<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span><span class="free">bs</span><span class="main">,</span> <span class="free">ss</span><span class="main">,</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Inr <span class="free">j</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> length <span class="free">fs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈</span> set <span class="free">bs</span> <span class="main">⟹</span> lt <span class="bound">b</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">j</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">q</span><span class="main">.</span> sig_of_pair <span class="bound">q</span> <span class="main">=</span> <span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span> <span class="free">ps</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rb_aux_inv.simps<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-rb_aux_inv_D5"><span class="command">lemma</span></span> rb_aux_inv_D5<span class="main">:</span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span><span class="free">bs</span><span class="main">,</span> <span class="free">ss</span><span class="main">,</span> <span class="free">ps</span><span class="main">)</span> <span class="main">⟹</span> sorted_wrt pair_ord <span class="free">ps</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rb_aux_inv.simps<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-rb_aux_inv_D6_1"><span class="command">lemma</span></span> rb_aux_inv_D6_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span><span class="free">bs</span><span class="main">,</span> <span class="free">ss</span><span class="main">,</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b1</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b2</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_regular_spair <span class="free">b1</span> <span class="free">b2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"sig_of_pair <span class="free">p</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="main">(</span>spair <span class="free">b1</span> <span class="free">b2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="quoted"><span class="quoted">"Inl <span class="main">(</span><span class="free">b1</span><span class="main">,</span> <span class="free">b2</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"Inl <span class="main">(</span><span class="free">b2</span><span class="main">,</span> <span class="free">b1</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> rb_aux_inv.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Signature_Groebner-rb_aux_inv_D6_2"><span class="command">lemma</span></span> rb_aux_inv_D6_2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span><span class="free">bs</span><span class="main">,</span> <span class="free">ss</span><span class="main">,</span> <span class="free">ps</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">∈</span> set <span class="free">ps</span> <span class="main">⟹</span> <span class="free">j</span> <span class="main">&lt;</span> length <span class="free">fs</span> <span class="main">⟹</span> sig_of_pair <span class="free">p</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">j</span><span class="main">)</span> <span class="main">⟹</span>
    Inr <span class="free">j</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rb_aux_inv.simps<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-rb_aux_inv_D7"><span class="command">lemma</span></span> rb_aux_inv_D7<span class="main">:</span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span><span class="free">bs</span><span class="main">,</span> <span class="free">ss</span><span class="main">,</span> <span class="free">ps</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">b</span> <span class="main">∈</span> set <span class="free">bs</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">∈</span> set <span class="free">ps</span> <span class="main">⟹</span> lt <span class="free">b</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> sig_of_pair <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rb_aux_inv.simps<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-rb_aux_inv_D8"><span class="command">lemma</span></span> rb_aux_inv_D8<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span><span class="free">bs</span><span class="main">,</span> <span class="free">ss</span><span class="main">,</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_regular_spair <span class="free">a</span> <span class="free">b</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Inl <span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span> <span class="main">∉</span> set <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Inl <span class="main">(</span><span class="free">b</span><span class="main">,</span> <span class="free">a</span><span class="main">)</span> <span class="main">∉</span> set <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_RB_in <span class="free">dgrad</span> rword <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="main">(</span>lt <span class="main">(</span>spair <span class="free">a</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">p</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"sig_of_pair <span class="free">p</span> <span class="main">=</span> lt <span class="main">(</span>spair <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> sig_crit' <span class="free">bs</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> rb_aux_inv.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>

<span class="keyword1" id="Signature_Groebner-rb_aux_inv_D9"><span class="command">lemma</span></span> rb_aux_inv_D9<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span><span class="free">bs</span><span class="main">,</span> <span class="free">ss</span><span class="main">,</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> length <span class="free">fs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Inr <span class="free">j</span> <span class="main">∉</span> set <span class="free">ps</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_RB_in <span class="free">dgrad</span> rword <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="main">(</span>monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'b</span><span class="main">)</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> ideal <span class="main">(</span>rep_list <span class="main">`</span> set <span class="free">bs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rb_aux_inv.simps<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-rb_aux_inv_is_RB_upt"><span class="command">lemma</span></span> rb_aux_inv_is_RB_upt<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span><span class="free">bs</span><span class="main">,</span> <span class="free">ss</span><span class="main">,</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">∈</span> set <span class="free">ps</span> <span class="main">⟹</span> <span class="free">u</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> sig_of_pair <span class="bound">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_RB_upt <span class="free">dgrad</span> rword <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="free">u</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> inv1<span class="main">:</span> <span class="quoted"><span class="quoted">"rb_aux_inv1 <span class="free">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_D1<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> dgrad rword<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> is_RB_upt_finite<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> inv1 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set <span class="free">bs</span> <span class="main">⊆</span> dgrad_sig_set <span class="free">dgrad</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv1_D1<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> inv1 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on lt <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv1_lt_inj_on<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> finite_set<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">g1</span> <span class="skolem">g2</span>
    <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g1</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g2</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"is_regular_spair <span class="skolem">g1</span> <span class="skolem">g2</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span>spair <span class="skolem">g1</span> <span class="skolem">g2</span><span class="main">)</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free">u</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∉</span> set <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"sig_of_pair <span class="skolem">p</span> <span class="main">=</span> lt <span class="main">(</span>spair <span class="skolem">g1</span> <span class="skolem">g2</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">p</span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> sig_of_pair <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free">u</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> 4<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_RB_in <span class="free">dgrad</span> rword <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="main">(</span>lt <span class="main">(</span>spair <span class="skolem">g1</span> <span class="skolem">g2</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword1"><span class="command">note</span></span> assms<span class="main">(</span>1<span class="main">)</span> 1 2 3
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Inl <span class="main">(</span><span class="skolem">g1</span><span class="main">,</span> <span class="skolem">g2</span><span class="main">)</span> <span class="main">∉</span> set <span class="free">ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 5<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> sig_of_spair<span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span> 3<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Inl <span class="main">(</span><span class="skolem">g2</span><span class="main">,</span> <span class="skolem">g1</span><span class="main">)</span> <span class="main">∉</span> set <span class="free">ps</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 5<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> sig_of_spair_commute<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> sig_of_spair<span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span> 3<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_RB_in <span class="free">dgrad</span> rword <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="main">(</span>lt <span class="main">(</span>spair <span class="skolem">g1</span> <span class="skolem">g2</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"sig_of_pair <span class="skolem">p</span> <span class="main">=</span> lt <span class="main">(</span>spair <span class="skolem">g1</span> <span class="skolem">g2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_D8<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∉</span> set <span class="free">ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 5<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">∈</span> set <span class="free">ps</span>›</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
    <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free">u</span>"</span></span>
    <span class="keyword1"><span class="command">note</span></span> assms<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">fs</span>"</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Inr <span class="skolem">j</span> <span class="main">∉</span> set <span class="free">ps</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Inr <span class="skolem">j</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> sig_of_pair <span class="main">(</span>Inr <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> 1<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_RB_in <span class="free">dgrad</span> rword <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_D9<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-rb_aux_inv_is_RB_upt_Cons"><span class="command">lemma</span></span> rb_aux_inv_is_RB_upt_Cons<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span><span class="free">bs</span><span class="main">,</span> <span class="free">ss</span><span class="main">,</span> <span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_RB_upt <span class="free">dgrad</span> rword <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="main">(</span>sig_of_pair <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_is_RB_upt<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">q</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="free">p</span> <span class="main">∨</span> <span class="skolem">q</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"sig_of_pair <span class="free">p</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> sig_of_pair <span class="skolem">q</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sorted_wrt pair_ord <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_D5<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pair_ord_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-Inr_in_tailD"><span class="command">lemma</span></span> Inr_in_tailD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span><span class="free">bs</span><span class="main">,</span> <span class="free">ss</span><span class="main">,</span> <span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Inr <span class="free">j</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sig_of_pair <span class="free">p</span> <span class="main">≠</span> <span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">j</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"sig_of_pair <span class="free">p</span> <span class="main">=</span> <span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Inr <span class="free">j</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">q</span><span class="main">.</span> sig_of_pair <span class="bound">q</span> <span class="main">=</span> <span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i1</span> <span class="main">&lt;</span> length <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Inrj<span class="main">:</span> <span class="quoted"><span class="quoted">"Inr <span class="free">j</span> <span class="main">=</span> <span class="free">ps</span> <span class="main">!</span> <span class="skolem">i1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> in_set_conv_nth<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹Inr <span class="free">j</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>filter <span class="var">?P</span> <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_D4<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i1</span> <span class="main">&lt;</span> length <span class="free">ps</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">i1</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">(</span><span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span> <span class="main">!</span> Suc <span class="skolem">i1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Inrj<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">(</span><span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span> <span class="main">!</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">i1</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> length_filter_le_1<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-pair_list_aux"><span class="command">lemma</span></span> pair_list_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span><span class="free">bs</span><span class="main">,</span> <span class="free">ss</span><span class="main">,</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sig_of_pair <span class="free">p</span> <span class="main">=</span> lt <span class="main">(</span>poly_of_pair <span class="free">p</span><span class="main">)</span> <span class="main">∧</span> poly_of_pair <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> poly_of_pair <span class="free">p</span> <span class="main">∈</span> dgrad_sig_set <span class="free">dgrad</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum_prodE<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
  <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> Inl <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv1 <span class="free">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_D1<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> bs_sub<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">bs</span> <span class="main">⊆</span> dgrad_sig_set <span class="free">dgrad</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv1_D1<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_regular_spair <span class="skolem">a</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_D3<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sig_of_pair <span class="free">p</span> <span class="main">=</span> lt <span class="main">(</span>poly_of_pair <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"poly_of_pair <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> p poly_of_pair.simps <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_of_spair<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> is_regular_spair_nonzero<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> dgrad <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_of_pair <span class="free">p</span> <span class="main">∈</span> dgrad_sig_set <span class="free">dgrad</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p poly_of_pair.simps
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> dgrad_sig_set_closed_spair<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_D3<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> dgrad_sig_set <span class="free">dgrad</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bs_sub <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_D3<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> dgrad_sig_set <span class="free">dgrad</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bs_sub <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> Inr <span class="skolem">j</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">fs</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">=</span> Inr <span class="skolem">j</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_D4<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"monomial <span class="main">1</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> dgrad_sig_set <span class="free">dgrad</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dgrad_sig_set_closed_monomial<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pp_of_term_of_pair dgrad_max_0<span class="main"><span class="keyword3">,</span></span>
        <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> component_of_term_of_pair <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">fs</span>›</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">=</span> Inr <span class="skolem">j</span>›</span></span> lt_monomial monomial_0_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> pair_list_sig_of_pair<span class="main">:</span>
  <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span><span class="free">bs</span><span class="main">,</span> <span class="free">ss</span><span class="main">,</span> <span class="free">ps</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">∈</span> set <span class="free">ps</span> <span class="main">⟹</span> sig_of_pair <span class="free">p</span> <span class="main">=</span> lt <span class="main">(</span>poly_of_pair <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pair_list_aux<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> pair_list_nonzero<span class="main">:</span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span><span class="free">bs</span><span class="main">,</span> <span class="free">ss</span><span class="main">,</span> <span class="free">ps</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">∈</span> set <span class="free">ps</span> <span class="main">⟹</span> poly_of_pair <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pair_list_aux<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> pair_list_dgrad_sig_set<span class="main">:</span>
  <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span><span class="free">bs</span><span class="main">,</span> <span class="free">ss</span><span class="main">,</span> <span class="free">ps</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">∈</span> set <span class="free">ps</span> <span class="main">⟹</span> poly_of_pair <span class="free">p</span> <span class="main">∈</span> dgrad_sig_set <span class="free">dgrad</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pair_list_aux<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-is_rewritableI_is_canon_rewriter"><span class="command">lemma</span></span> is_rewritableI_is_canon_rewriter<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv1 <span class="free">bs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lt <span class="free">b</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">u</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_canon_rewriter rword <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="free">u</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_rewritable <span class="free">bs</span> <span class="free">b</span> <span class="free">u</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2-5<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b'</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">b'</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">u</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> rword <span class="main">(</span>spp_of <span class="skolem">b'</span><span class="main">)</span> <span class="main">(</span>spp_of <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_canon_rewriter_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_rewritable_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> bexI conjI<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> rword<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"rword <span class="main">(</span>spp_of <span class="free">b</span><span class="main">)</span> <span class="main">(</span>spp_of <span class="skolem">b'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> is_rewrite_ordD3<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"rword <span class="main">(</span>spp_of <span class="skolem">b'</span><span class="main">)</span> <span class="main">(</span>spp_of <span class="free">b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">from</span></span> rword<span class="main">(</span>1<span class="main">)</span> 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≠</span> <span class="skolem">b'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> is_rewrite_ordD1<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="free">b</span> <span class="main">≠</span> lt <span class="skolem">b'</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"lt <span class="free">b</span> <span class="main">=</span> lt <span class="skolem">b'</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> rb_aux_inv1_lt_inj_on<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="skolem">b'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">b'</span> <span class="main">∈</span> set <span class="free">bs</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> inj_onD<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">≠</span> <span class="skolem">b'</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>spp_of <span class="free">b</span><span class="main">)</span> <span class="main">≠</span> fst <span class="main">(</span>spp_of <span class="skolem">b'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> spp_of_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> rword_is_strict_rewrite_ord 2 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">rword_strict</span> <span class="main">(</span>spp_of <span class="free">b</span><span class="main">)</span> <span class="main">(</span>spp_of <span class="skolem">b'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rword_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> is_strict_rewrite_ord_antisym<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-is_rewritableD_is_canon_rewriter"><span class="command">lemma</span></span> is_rewritableD_is_canon_rewriter<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv1 <span class="free">bs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_rewritable <span class="free">bs</span> <span class="free">b</span> <span class="free">u</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_canon_rewriter rword <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="free">u</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_canon_rewriter rword <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="free">u</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lt <span class="free">b</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">u</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> set <span class="free">bs</span> <span class="main">⟹</span> <span class="bound">a</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> lt <span class="bound">a</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">u</span> <span class="main">⟹</span> rword <span class="main">(</span>spp_of <span class="bound">a</span><span class="main">)</span> <span class="main">(</span>spp_of <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_canon_rewriterD<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b'</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">b'</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">u</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">rword_strict</span> <span class="main">(</span>spp_of <span class="free">b</span><span class="main">)</span> <span class="main">(</span>spp_of <span class="skolem">b'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_rewritable_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">,</span> 2<span class="main">,</span> 3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rword <span class="main">(</span>spp_of <span class="skolem">b'</span><span class="main">)</span> <span class="main">(</span>spp_of <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 1<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> rword_is_strict_rewrite_ord 2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rword <span class="main">(</span>spp_of <span class="free">b</span><span class="main">)</span> <span class="main">(</span>spp_of <span class="skolem">b'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> rword_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_strict_rewrite_ord_asym<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>spp_of <span class="skolem">b'</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span>spp_of <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_rewrite_ordD4<span class="main"><span class="main">[</span></span><span class="operator">OF</span> rword<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">b'</span> <span class="main">=</span> lt <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> spp_of_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> rb_aux_inv1_lt_inj_on<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b'</span> <span class="main">=</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b'</span> <span class="main">∈</span> set <span class="free">bs</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> set <span class="free">bs</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> inj_onD<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> rword_is_strict_rewrite_ord <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">rword_strict</span> <span class="main">(</span>spp_of <span class="free">b</span><span class="main">)</span> <span class="main">(</span>spp_of <span class="skolem">b'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b'</span> <span class="main">=</span> <span class="free">b</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_strict_rewrite_ord_irrefl<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-lemma_12"><span class="command">lemma</span></span> lemma_12<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span><span class="free">bs</span><span class="main">,</span> <span class="free">ss</span><span class="main">,</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_RB_upt <span class="free">dgrad</span> rword <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="free">u</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">dgrad</span> <span class="main">(</span>pp_of_term <span class="free">u</span><span class="main">)</span> <span class="main">≤</span> dgrad_max <span class="free">dgrad</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_canon_rewriter rword <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="free">u</span> <span class="free">a</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_syz_sig <span class="free">dgrad</span> <span class="free">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="main">(</span>monom_mult <span class="main">1</span> <span class="main">(</span>pp_of_term <span class="free">u</span> <span class="main">-</span> lp <span class="free">a</span><span class="main">)</span> <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">p</span> <span class="free">q</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_regular_spair <span class="free">p</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span>spair <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="free">u</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> sig_crit' <span class="free">bs</span> <span class="main">(</span>Inl <span class="main">(</span><span class="free">p</span><span class="main">,</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> inv1<span class="main">:</span> <span class="quoted"><span class="quoted">"rb_aux_inv1 <span class="free">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_D1<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> inj<span class="main">:</span> <span class="quoted"><span class="quoted">"inj_on lt <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv1_lt_inj_on<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="free">a</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_canon_rewriterD3<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lp <span class="free">a</span> <span class="keyword1">adds</span> pp_of_term <span class="free">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> comp_a<span class="main">:</span> <span class="quoted"><span class="quoted">"component_of_term <span class="main">(</span>lt <span class="free">a</span><span class="main">)</span> <span class="main">=</span> component_of_term <span class="free">u</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> adds_term_def<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"pp_of_term <span class="free">u</span> <span class="main">-</span> lp <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?a</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"monom_mult <span class="main">1</span> <span class="var">?s</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_canon_rewriterD1<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>6<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="var">?a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> is_sig_red_top_addsE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rep_list_monom_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rep_list_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lt <span class="var">?a</span> <span class="main">=</span> <span class="var">?s</span> <span class="main">⊕</span> lt <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lt_monom_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹lp <span class="free">a</span> <span class="keyword1">adds</span> pp_of_term <span class="free">u</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> eq0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">u</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> splus_def comp_a adds_minus <span class="dynamic"><span class="dynamic">term_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="var">?a</span> <span class="main">=</span> <span class="free">u</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">note</span></span> dgrad rword<span class="main">(</span>1<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_RB_upt <span class="free">dgrad</span> rword <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="main">(</span>lt <span class="var">?a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹lt <span class="var">?a</span> <span class="main">=</span> <span class="free">u</span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> dgrad <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a</span> <span class="main">∈</span> dgrad_sig_set <span class="free">dgrad</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> dgrad_sig_set_closed_monom_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> dgrad <span class="quoted"><span class="quoted">‹lp <span class="free">a</span> <span class="keyword1">adds</span> pp_of_term <span class="free">u</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">dgrad</span> <span class="main">(</span>pp_of_term <span class="free">u</span> <span class="main">-</span> lp <span class="free">a</span><span class="main">)</span> <span class="main">≤</span> <span class="free">dgrad</span> <span class="main">(</span>pp_of_term <span class="free">u</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dickson_grading_minus<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">dgrad</span> <span class="main">(</span>pp_of_term <span class="free">u</span> <span class="main">-</span> lp <span class="free">a</span><span class="main">)</span> <span class="main">≤</span> dgrad_max <span class="free">dgrad</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> le_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> inv1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="free">bs</span> <span class="main">⊆</span> dgrad_sig_set <span class="free">dgrad</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv1_D1<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> set <span class="free">bs</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> dgrad_sig_set <span class="free">dgrad</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="var">?a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">dgrad</span> <span class="main">(</span>pp_of_term <span class="skolem">v</span><span class="main">)</span> <span class="main">≤</span> dgrad_max <span class="free">dgrad</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"component_of_term <span class="skolem">v</span> <span class="main">&lt;</span> length <span class="free">fs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ns<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_syz_sig <span class="free">dgrad</span> <span class="skolem">v</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="var">?a</span><span class="main">)</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">b</span><span class="main">)</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">b</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> cr<span class="main">:</span> <span class="quoted"><span class="quoted">"is_canon_rewriter rword <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="skolem">v</span> <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="main">{</span><span class="skolem">b</span><span class="main">}</span> <span class="var">?a</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>6<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lemma_11<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>6<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_canon_rewriterD1<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> set <span class="free">bs</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword1"><span class="command">from</span></span> dgrad rword<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> inj assms<span class="main">(</span>5<span class="main">,</span> 4<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> set <span class="free">bs</span>›</span></span> <span class="quoted"><span class="quoted">‹is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="main">{</span><span class="skolem">b</span><span class="main">}</span> <span class="var">?a</span>›</span></span> assms<span class="main">(</span>3<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_regular_spair <span class="free">a</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lemma_9<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> dgrad rword<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> inj assms<span class="main">(</span>5<span class="main">,</span> 4<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> set <span class="free">bs</span>›</span></span> <span class="quoted"><span class="quoted">‹is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="main">{</span><span class="skolem">b</span><span class="main">}</span> <span class="var">?a</span>›</span></span> assms<span class="main">(</span>3<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span>spair <span class="free">a</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">=</span> <span class="free">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lemma_9<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹rep_list <span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> v'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="main">(</span><span class="var">?s</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="free">a</span><span class="main">)</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">b</span><span class="main">)</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">b</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> v rep_list_monom_mult punit.lt_monom_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> dgrad rword<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> inj assms<span class="main">(</span>5<span class="main">,</span> 4<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> set <span class="free">bs</span>›</span></span> <span class="quoted"><span class="quoted">‹is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="main">{</span><span class="skolem">b</span><span class="main">}</span> <span class="var">?a</span>›</span></span> assms<span class="main">(</span>3<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lcs <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="skolem">b</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="var">?s</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lcs <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="skolem">b</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">b</span><span class="main">)</span> <span class="main">=</span>
            <span class="var">?s</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="free">a</span><span class="main">)</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lemma_9<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> eq1<span class="main">:</span> <span class="quoted"><span class="quoted">"spair_sigs <span class="free">a</span> <span class="skolem">b</span> <span class="main">=</span> <span class="main">(</span><span class="free">u</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> spair_sigs_def eq0<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> sig_crit' <span class="free">bs</span> <span class="main">(</span>Inl <span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq1 assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> ns<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI notI<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_rewritable <span class="free">bs</span> <span class="free">a</span> <span class="free">u</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> inv1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_canon_rewriter rword <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="free">u</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_rewritableD_is_canon_rewriter<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_rewritable <span class="free">bs</span> <span class="skolem">b</span> <span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> inv1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_canon_rewriter rword <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="skolem">v</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_rewritableD_is_canon_rewriter<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> cr <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-is_canon_rewriterI_eq_sig"><span class="command">lemma</span></span> is_canon_rewriterI_eq_sig<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv1 <span class="free">bs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_canon_rewriter rword <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="main">(</span>lt <span class="free">b</span><span class="main">)</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">b</span> <span class="main">∈</span> rep_list <span class="main">`</span> set <span class="free">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> imageI<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> rep_list <span class="main">`</span> set <span class="free">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv1_D2<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rep_list_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> is_canon_rewriterI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">a</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> lt <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">bs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="free">bs</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> in_set_conv_nth<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_RB_upt <span class="free">dgrad</span> rword <span class="main">(</span>set <span class="main">(</span>drop <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="free">bs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>lt <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv1_D5<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> dgrad <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_sig_GB_upt <span class="free">dgrad</span> <span class="main">(</span>set <span class="main">(</span>drop <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="free">bs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>lt <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_RB_upt_is_sig_GB_upt<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_sig_GB_upt <span class="free">dgrad</span> <span class="main">(</span>set <span class="main">(</span>drop <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="free">bs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>lt <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> b<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>drop <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="free">bs</span><span class="main">)</span> <span class="main">⊆</span> set <span class="free">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> set_drop_subset<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="free">bs</span> <span class="main">⊆</span> dgrad_sig_set <span class="free">dgrad</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv1_D1<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_sig_GB_upt <span class="free">dgrad</span> <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="main">(</span>lt <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_GB_upt_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> rword<span class="main">(</span>1<span class="main">)</span> dgrad <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rword <span class="main">(</span>spp_of <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span>spp_of <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> is_rewrite_ordD5<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">bs</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="main">(</span>set <span class="main">(</span>drop <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="free">bs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv1_D4<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="main">(</span>set <span class="main">(</span>drop <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="free">bs</span><span class="main">)</span><span class="main">)</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> b is_sig_red_top_tail_cases<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="main">(</span>set <span class="main">(</span>take <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="free">bs</span><span class="main">)</span><span class="main">)</span> <span class="free">b</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="main">(</span>set <span class="main">(</span>take <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="free">bs</span><span class="main">)</span><span class="main">)</span> <span class="free">b</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> f_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> set <span class="main">(</span>take <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="free">bs</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="main">{</span><span class="skolem">f</span><span class="main">}</span> <span class="free">b</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_red_singletonI<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">f</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_red_regularD_lt<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">bs</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> take_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="free">bs</span> <span class="main">=</span> <span class="main">(</span>take <span class="skolem">i</span> <span class="free">bs</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="free">b</span><span class="main">]</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> b <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> take_Suc_conv_app_nth<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sorted_wrt <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> lt <span class="bound">y</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>take <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="free">bs</span><span class="main">)</span> <span class="main">@</span> <span class="main">(</span>drop <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="free">bs</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> append_take_drop_id <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv1_D3<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> set <span class="main">(</span>take <span class="skolem">i</span> <span class="free">bs</span><span class="main">)</span> <span class="main">⟹</span> lt <span class="free">b</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="bound">y</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sorted_wrt_append take_eq <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> append_take_drop_id<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> f_in <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∨</span> <span class="skolem">f</span> <span class="main">∈</span> set <span class="main">(</span>take <span class="skolem">i</span> <span class="free">bs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> take_eq<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lt <span class="free">b</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="skolem">f</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> set <span class="main">(</span>take <span class="skolem">i</span> <span class="free">bs</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lt <span class="free">b</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 1<span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹lt <span class="skolem">f</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="free">b</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="main">(</span>set <span class="main">(</span>take <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="free">bs</span><span class="main">)</span> <span class="main">∪</span> set <span class="main">(</span>drop <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="free">bs</span><span class="main">)</span><span class="main">)</span> <span class="free">b</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_sig_red_Un<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_take_drop_id set_append<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">term_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-not_sig_crit"><span class="command">lemma</span></span> not_sig_crit<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span><span class="free">bs</span><span class="main">,</span> <span class="free">ss</span><span class="main">,</span> <span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> sig_crit <span class="free">bs</span> <span class="main">(</span>new_syz_sigs <span class="free">ss</span> <span class="free">bs</span> <span class="free">p</span><span class="main">)</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lt <span class="free">b</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> sig_of_pair <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum_prodE<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
  <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> Inl <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Inl <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> p<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">t1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t1</span> <span class="main">=</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">x</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">t2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t2</span> <span class="main">=</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">y</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> fst <span class="main">(</span>spair_sigs <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> snd <span class="main">(</span>spair_sigs <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="main">(</span>lcs <span class="skolem">t1</span> <span class="skolem">t2</span> <span class="main">-</span> <span class="skolem">t1</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> u_def spair_sigs_def t1_def t2_def Let_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="main">(</span>lcs <span class="skolem">t1</span> <span class="skolem">t2</span> <span class="main">-</span> <span class="skolem">t2</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> v_def spair_sigs_def t1_def t2_def Let_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> spair_sigs<span class="main">:</span> <span class="quoted"><span class="quoted">"spair_sigs <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> u_def v_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_rewritable <span class="free">bs</span> <span class="skolem">x</span> <span class="skolem">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_rewritable <span class="free">bs</span> <span class="skolem">y</span> <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹Inl <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> x_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_regular_spair <span class="skolem">x</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_D3<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> inv1<span class="main">:</span> <span class="quoted"><span class="quoted">"rb_aux_inv1 <span class="free">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_D1<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> inv1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> rep_list <span class="main">`</span> set <span class="free">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv1_D2<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> x_in y_in <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="skolem">y</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rep_list_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> inv1 <span class="keyword1"><span class="command">have</span></span> sorted<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted_wrt <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> lt <span class="bound">y</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="bound">x</span><span class="main">)</span> <span class="free">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv1_D3<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> x_in <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i1</span> <span class="main">&lt;</span> length <span class="free">bs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="free">bs</span> <span class="main">!</span> <span class="skolem">i1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> in_set_conv_nth<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> y_in <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i2</span> <span class="main">&lt;</span> length <span class="free">bs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="free">bs</span> <span class="main">!</span> <span class="skolem">i2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> in_set_conv_nth<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="free">b</span> <span class="main">≠</span> sig_of_pair <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> lt_b<span class="main">:</span> <span class="quoted"><span class="quoted">"lt <span class="free">b</span> <span class="main">=</span> sig_of_pair <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> inv1 <span class="keyword1"><span class="command">have</span></span> crw<span class="main">:</span> <span class="quoted"><span class="quoted">"is_canon_rewriter rword <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="main">(</span>lt <span class="free">b</span><span class="main">)</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_canon_rewriterI_eq_sig<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ord_term_lin.linorder_cases<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lt <span class="free">b</span> <span class="main">=</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lt_b p spair_sigs ord_term_lin.max_def<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> crw <span class="keyword1"><span class="command">have</span></span> crw_b<span class="main">:</span> <span class="quoted"><span class="quoted">"is_canon_rewriter rword <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="skolem">v</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> v <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">y</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> adds_termI<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_canon_rewriter rword <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="skolem">v</span> <span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> inv1 y_in <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> is_rewritable <span class="free">bs</span> <span class="skolem">y</span> <span class="skolem">v</span>›</span></span> is_rewritableI_is_canon_rewriter <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">with</span></span> inv1 crw_b <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> canon_rewriter_unique<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹lt <span class="free">b</span> <span class="main">=</span> <span class="skolem">v</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> inv1 <span class="quoted"><span class="quoted">‹<span class="skolem">i2</span> <span class="main">&lt;</span> length <span class="free">bs</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="main">(</span>set <span class="main">(</span>drop <span class="main">(</span>Suc <span class="skolem">i2</span><span class="main">)</span> <span class="free">bs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="skolem">i2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv1_D4<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="main">(</span>set <span class="main">(</span>drop <span class="main">(</span>Suc <span class="skolem">i2</span><span class="main">)</span> <span class="free">bs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="skolem">i2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_red_singletonD<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_red_top_addsI<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹lt <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">v</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>lcs <span class="skolem">t1</span> <span class="skolem">t2</span> <span class="main">-</span> <span class="skolem">t2</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">y</span> <span class="main">=</span> lt <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> v<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⊕</span> lt <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">term_simps</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lcs <span class="skolem">t1</span> <span class="skolem">t2</span> <span class="main">-</span> <span class="skolem">t2</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> splus_right_canc<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lcs <span class="skolem">t1</span> <span class="skolem">t2</span> <span class="main">=</span> <span class="skolem">t2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> add.left_neutral adds_minus adds_lcs_2<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> adds_lcs<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">t1</span></span> <span class="quoted"><span class="skolem">t2</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">adds</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">y</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> t1_def t2_def<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="skolem">v</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="skolem">y</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">x</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> punit.lt <span class="main">(</span>rep_list <span class="skolem">x</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">y</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> t1_def t2_def u v term_is_le_rel_minus_minus adds_lcs adds_lcs_2<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">|</span></span><span class="operator">fact</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="skolem">i2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> y is_sig_red_top_tail_cases<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">x</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="main">0</span> <span class="main">⊕</span> lt <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">term_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="skolem">u</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> u <span class="keyword1"><span class="command">using</span></span> zero_min <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> splus_mono_left<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="skolem">i1</span><span class="main">)</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="skolem">i2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹lt <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">v</span>›</span></span> x y<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i2</span> <span class="main">&lt;</span> <span class="skolem">i1</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> linorder_cases<span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i1</span> <span class="main">&lt;</span> <span class="skolem">i2</span>"</span></span>
          <span class="keyword1"><span class="command">with</span></span> sorted <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="skolem">i2</span><span class="main">)</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="skolem">i1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i2</span> <span class="main">&lt;</span> length <span class="free">bs</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sorted_wrt_nth_less<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> * <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i1</span> <span class="main">=</span> <span class="skolem">i2</span>"</span></span>
          <span class="keyword1"><span class="command">with</span></span> * <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">i2</span> <span class="main">≤</span> <span class="skolem">i1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">(</span>drop <span class="main">(</span>Suc <span class="skolem">i2</span><span class="main">)</span> <span class="free">bs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> x <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i1</span> <span class="main">&lt;</span> length <span class="free">bs</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nth_in_set_dropI<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="skolem">u</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lt <span class="free">b</span> <span class="main">=</span> <span class="skolem">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lt_b p spair_sigs ord_term_lin.max_def<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> crw <span class="keyword1"><span class="command">have</span></span> crw_b<span class="main">:</span> <span class="quoted"><span class="quoted">"is_canon_rewriter rword <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="skolem">u</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> u <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">x</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="skolem">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> adds_termI<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_canon_rewriter rword <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="skolem">u</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> inv1 x_in <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> is_rewritable <span class="free">bs</span> <span class="skolem">x</span> <span class="skolem">u</span>›</span></span> is_rewritableI_is_canon_rewriter <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">with</span></span> inv1 crw_b <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> canon_rewriter_unique<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹lt <span class="free">b</span> <span class="main">=</span> <span class="skolem">u</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> inv1 <span class="quoted"><span class="quoted">‹<span class="skolem">i1</span> <span class="main">&lt;</span> length <span class="free">bs</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="main">(</span>set <span class="main">(</span>drop <span class="main">(</span>Suc <span class="skolem">i1</span><span class="main">)</span> <span class="free">bs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="skolem">i1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv1_D4<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="main">(</span>set <span class="main">(</span>drop <span class="main">(</span>Suc <span class="skolem">i1</span><span class="main">)</span> <span class="free">bs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="skolem">i1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_red_singletonD<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="main">{</span><span class="skolem">y</span><span class="main">}</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_red_top_addsI<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹lt <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">u</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>lcs <span class="skolem">t1</span> <span class="skolem">t2</span> <span class="main">-</span> <span class="skolem">t1</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">x</span> <span class="main">=</span> lt <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> u<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⊕</span> lt <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">term_simps</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lcs <span class="skolem">t1</span> <span class="skolem">t2</span> <span class="main">-</span> <span class="skolem">t1</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> splus_right_canc<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lcs <span class="skolem">t1</span> <span class="skolem">t2</span> <span class="main">=</span> <span class="skolem">t1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> add.left_neutral adds_minus adds_lcs<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> adds_lcs_2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">t2</span></span> <span class="quoted"><span class="skolem">t1</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="skolem">y</span><span class="main">)</span> <span class="keyword1">adds</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">x</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> t1_def t2_def<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="skolem">u</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="skolem">x</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">y</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> punit.lt <span class="main">(</span>rep_list <span class="skolem">y</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">x</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> t1_def t2_def u v term_is_le_rel_minus_minus adds_lcs adds_lcs_2<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">|</span></span><span class="operator">fact</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="main">{</span><span class="skolem">y</span><span class="main">}</span> <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="skolem">i1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x is_sig_red_top_tail_cases<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">y</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="main">0</span> <span class="main">⊕</span> lt <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">term_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> v <span class="keyword1"><span class="command">using</span></span> zero_min <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> splus_mono_left<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="skolem">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="skolem">i2</span><span class="main">)</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="skolem">i1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹lt <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">u</span>›</span></span> y x<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i1</span> <span class="main">&lt;</span> <span class="skolem">i2</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> linorder_cases<span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i2</span> <span class="main">&lt;</span> <span class="skolem">i1</span>"</span></span>
          <span class="keyword1"><span class="command">with</span></span> sorted <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="skolem">i1</span><span class="main">)</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="skolem">i2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i1</span> <span class="main">&lt;</span> length <span class="free">bs</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sorted_wrt_nth_less<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> * <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i2</span> <span class="main">=</span> <span class="skolem">i1</span>"</span></span>
          <span class="keyword1"><span class="command">with</span></span> * <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">i1</span> <span class="main">≤</span> <span class="skolem">i2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> set <span class="main">(</span>drop <span class="main">(</span>Suc <span class="skolem">i1</span><span class="main">)</span> <span class="free">bs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> y <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i2</span> <span class="main">&lt;</span> length <span class="free">bs</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nth_in_set_dropI<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="skolem">x</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">y</span> <span class="main">=</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">y</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> t1_def t2_def u v term_is_le_rel_minus_minus adds_lcs adds_lcs_2<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹is_regular_spair <span class="skolem">x</span> <span class="skolem">y</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="skolem">y</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">x</span> <span class="main">≠</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">x</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_regular_spairD3<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">,</span> 3<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="free">b</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> sig_of_pair <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_D7<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
  <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> Inr <span class="skolem">j</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Inr <span class="skolem">j</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="free">b</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_D4<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> fs_distinct<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="free">fs</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> fs_nonzero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> set <span class="free">fs</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Signature_Groebner-rep_list_monomial'"><span class="command">lemma</span></span> rep_list_monomial'<span class="main">:</span> <span class="quoted"><span class="quoted">"rep_list <span class="main">(</span>monomial <span class="main">1</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">fs</span> <span class="main">!</span> <span class="free">j</span><span class="main">)</span> <span class="keyword1">when</span> <span class="free">j</span> <span class="main">&lt;</span> length <span class="free">fs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rep_list_monomial fs_distinct <span class="dynamic"><span class="dynamic">term_simps</span></span><span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-new_syz_sigs_is_syz_sig"><span class="command">lemma</span></span> new_syz_sigs_is_syz_sig<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span><span class="free">bs</span><span class="main">,</span> <span class="free">ss</span><span class="main">,</span> <span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> set <span class="main">(</span>new_syz_sigs <span class="free">ss</span> <span class="free">bs</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_syz_sig <span class="free">dgrad</span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum_prodE<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> Inl <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> set <span class="free">ss</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_D2<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
  <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> Inr <span class="skolem">j</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="free">term_of_pair</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="bound">b</span><span class="main">)</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?a</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'b</span><span class="main">)</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> inv1<span class="main">:</span> <span class="quoted"><span class="quoted">"rb_aux_inv1 <span class="free">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_D1<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Inr <span class="skolem">j</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">fs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_D4<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"rep_list <span class="var">?a</span> <span class="main">=</span> <span class="free">fs</span> <span class="main">!</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rep_list_monomial'<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"is_pot_ord"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> set <span class="main">(</span>filter_min_append <span class="keyword1">(adds<span class="hidden">⇩</span><sub>t</sub>)</span> <span class="free">ss</span> <span class="main">(</span>filter_min <span class="keyword1">(adds<span class="hidden">⇩</span><sub>t</sub>)</span> <span class="main">(</span>map <span class="var">?f</span> <span class="free">bs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> set <span class="free">ss</span> <span class="main">∪</span> <span class="var">?f</span> <span class="main">`</span> set <span class="free">bs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> filter_min_append_subset filter_min_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> set <span class="free">ss</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_D2<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> <span class="var">?f</span> <span class="main">`</span> set <span class="free">bs</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> <span class="var">?f</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">have</span></span> comp_b<span class="main">:</span> <span class="quoted"><span class="quoted">"component_of_term <span class="main">(</span>lt <span class="skolem">b</span><span class="main">)</span> <span class="main">&lt;</span> component_of_term <span class="main">(</span>lt <span class="var">?a</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"pp_of_term <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">≼</span></span> pp_of_term <span class="main">(</span>lt <span class="skolem">b</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pp_of_term_of_pair zero_min<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> component_of_term <span class="main">(</span>lt <span class="skolem">b</span><span class="main">)</span> <span class="main">&lt;</span> component_of_term <span class="main">(</span>lt <span class="var">?a</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"component_of_term <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> component_of_term <span class="main">(</span>lt <span class="skolem">b</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lt_monomial<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> * <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ord_termI<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹Inr <span class="skolem">j</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> set <span class="free">bs</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">b</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_D4<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">b</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="var">?a</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v</span> <span class="main">=</span> <span class="var">?f</span> <span class="skolem">b</span>›</span></span> a lt_monomial splus_def <span class="dynamic"><span class="dynamic">term_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> ord_term_lin.max <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="skolem">b</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="var">?a</span><span class="main">)</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="var">?a</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"component_of_term <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="var">?a</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">b</span><span class="main">)</span> <span class="main">=</span> component_of_term <span class="main">(</span>lt <span class="skolem">b</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">term_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">&lt;</span> component_of_term <span class="main">(</span>lt <span class="var">?a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> comp_b<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> component_of_term <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="skolem">b</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="var">?a</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">term_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"component_of_term <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="var">?a</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">b</span><span class="main">)</span> <span class="main">&lt;</span>
                      component_of_term <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="skolem">b</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="var">?a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">with</span></span> True <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="var">?a</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">b</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> punit.lt <span class="main">(</span>rep_list <span class="skolem">b</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="var">?a</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_pot_ordD<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ord_term_lin.max_def<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> ord_term_lin.max <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="skolem">b</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="var">?a</span><span class="main">)</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="var">?a</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> v <span class="keyword1"><span class="command">using</span></span> dgrad
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Koszul_syz_is_syz_sig<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> inv1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="free">bs</span> <span class="main">⊆</span> dgrad_sig_set <span class="free">dgrad</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv1_D1<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> set <span class="free">bs</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> dgrad_sig_set <span class="free">dgrad</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a</span> <span class="main">∈</span> dgrad_sig_set <span class="free">dgrad</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dgrad_sig_set_closed_monomial<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">term_simps</span></span> dgrad_max_0 <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">fs</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword1"><span class="command">from</span></span> inv1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> rep_list <span class="main">`</span> set <span class="free">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv1_D2<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> set <span class="free">bs</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="skolem">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">fs</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">fs</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">∈</span> set <span class="free">fs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nth_mem<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> fs_nonzero <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="var">?a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> a<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">fact</span> comp_b<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> set <span class="free">ss</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_D2<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-new_syz_sigs_minimal"><span class="command">lemma</span></span> new_syz_sigs_minimal<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">u'</span> <span class="bound">v'</span><span class="main">.</span> <span class="bound">u'</span> <span class="main">∈</span> set <span class="free">ss</span> <span class="main">⟹</span> <span class="bound">v'</span> <span class="main">∈</span> set <span class="free">ss</span> <span class="main">⟹</span> <span class="bound">u'</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="bound">v'</span> <span class="main">⟹</span> <span class="bound">u'</span> <span class="main">=</span> <span class="bound">v'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> set <span class="main">(</span>new_syz_sigs <span class="free">ss</span> <span class="free">bs</span> <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> set <span class="main">(</span>new_syz_sigs <span class="free">ss</span> <span class="free">bs</span> <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">=</span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum_prodE<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
  <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> Inl <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">,</span> 3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> set <span class="free">ss</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> set <span class="free">ss</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
  <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> Inr <span class="skolem">j</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted">is_pot_ord</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"transp <span class="keyword1">(adds<span class="hidden">⇩</span><sub>t</sub>)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> transpI<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule</span> adds_term_trans<span class="main">)</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ss'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ss'</span> <span class="main">=</span> filter_min <span class="keyword1">(adds<span class="hidden">⇩</span><sub>t</sub>)</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="free">term_of_pair</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="bound">b</span><span class="main">)</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="free">bs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">note</span></span> assms<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u'</span> <span class="main">=</span> <span class="skolem">v'</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u'</span> <span class="main">∈</span> set <span class="skolem">ss'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v'</span> <span class="main">∈</span> set <span class="skolem">ss'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u'</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="skolem">v'</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">u'</span> <span class="skolem">v'</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹transp <span class="keyword1">(adds<span class="hidden">⇩</span><sub>t</sub>)</span>›</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> ss'_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> filter_min_minimal<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> True assms<span class="main">(</span>2<span class="main">,</span> 3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> set <span class="main">(</span>filter_min_append <span class="keyword1">(adds<span class="hidden">⇩</span><sub>t</sub>)</span> <span class="free">ss</span> <span class="skolem">ss'</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> set <span class="main">(</span>filter_min_append <span class="keyword1">(adds<span class="hidden">⇩</span><sub>t</sub>)</span> <span class="free">ss</span> <span class="skolem">ss'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p ss'_def<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> filter_min_append_minimal<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">,</span> 3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> set <span class="free">ss</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> set <span class="free">ss</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-new_syz_sigs_distinct"><span class="command">lemma</span></span> new_syz_sigs_distinct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"distinct <span class="free">ss</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>new_syz_sigs <span class="free">ss</span> <span class="free">bs</span> <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum_prodE<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> Inl <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
  <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> Inr <span class="skolem">j</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted">is_pot_ord</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ss'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ss'</span> <span class="main">=</span> filter_min <span class="keyword1">(adds<span class="hidden">⇩</span><sub>t</sub>)</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="free">term_of_pair</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="bound">b</span><span class="main">)</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="free">bs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> adds_term_refl <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"reflp <span class="keyword1">(adds<span class="hidden">⇩</span><sub>t</sub>)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> reflpI<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> assms
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"distinct <span class="skolem">ss'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ss'_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹reflp <span class="keyword1">(adds<span class="hidden">⇩</span><sub>t</sub>)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> filter_min_distinct<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>filter_min_append <span class="keyword1">(adds<span class="hidden">⇩</span><sub>t</sub>)</span> <span class="free">ss</span> <span class="skolem">ss'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> filter_min_append_distinct<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p ss'_def True<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-sig_crit'I_sig_crit"><span class="command">lemma</span></span> sig_crit'I_sig_crit<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span><span class="free">bs</span><span class="main">,</span> <span class="free">ss</span><span class="main">,</span> <span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"sig_crit <span class="free">bs</span> <span class="main">(</span>new_syz_sigs <span class="free">ss</span> <span class="free">bs</span> <span class="free">p</span><span class="main">)</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sig_crit' <span class="free">bs</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> rl<span class="main">:</span> <span class="quoted"><span class="quoted">"is_syz_sig <span class="free">dgrad</span> <span class="skolem">u</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"is_pred_syz <span class="main">(</span>new_syz_sigs <span class="free">ss</span> <span class="free">bs</span> <span class="free">p</span><span class="main">)</span> <span class="skolem">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">dgrad</span> <span class="main">(</span>pp_of_term <span class="skolem">u</span><span class="main">)</span> <span class="main">≤</span> dgrad_max <span class="free">dgrad</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">u</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> that<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> set <span class="main">(</span>new_syz_sigs <span class="free">ss</span> <span class="free">bs</span> <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> adds<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="skolem">u</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> is_pred_syz_def <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_syz_sig <span class="free">dgrad</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> new_syz_sigs_is_syz_sig<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> dgrad <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> adds that<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_syz_sig_adds<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv1 <span class="free">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_D1<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> bs_sub<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">bs</span> <span class="main">⊆</span> dgrad_sig_set <span class="free">dgrad</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv1_D1<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum_prodE<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
    <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> Inl <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Inl <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_D3<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">with</span></span> bs_sub <span class="keyword1"><span class="command">have</span></span> a_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> dgrad_sig_set <span class="free">dgrad</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> dgrad_sig_set <span class="free">dgrad</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">t1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t1</span> <span class="main">=</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">a</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">t2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t2</span> <span class="main">=</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">b</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> fst <span class="main">(</span>spair_sigs <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> snd <span class="main">(</span>spair_sigs <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> dgrad a_in <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">dgrad</span> <span class="skolem">t1</span> <span class="main">≤</span> dgrad_max <span class="free">dgrad</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> t1_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dgrad_sig_setD_rep_list_lt<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> dgrad b_in <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">dgrad</span> <span class="skolem">t2</span> <span class="main">≤</span> dgrad_max <span class="free">dgrad</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> t2_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dgrad_sig_setD_rep_list_lt<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ord_class.max <span class="main">(</span><span class="free">dgrad</span> <span class="skolem">t1</span><span class="main">)</span> <span class="main">(</span><span class="free">dgrad</span> <span class="skolem">t2</span><span class="main">)</span> <span class="main">≤</span> dgrad_max <span class="free">dgrad</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> dickson_grading_lcs<span class="main">[</span><span class="operator">OF</span> dgrad<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">dgrad</span> <span class="main">(</span>lcs <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span> <span class="main">≤</span> dgrad_max <span class="free">dgrad</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> le_trans<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="main">(</span>lcs <span class="skolem">t1</span> <span class="skolem">t2</span> <span class="main">-</span> <span class="skolem">t1</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> u_def spair_sigs_def t1_def t2_def Let_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="main">(</span>lcs <span class="skolem">t1</span> <span class="skolem">t2</span> <span class="main">-</span> <span class="skolem">t2</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> v_def spair_sigs_def t1_def t2_def Let_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"spair_sigs <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> u_def v_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>is_pred_syz <span class="main">(</span>new_syz_sigs <span class="free">ss</span> <span class="free">bs</span> <span class="free">p</span><span class="main">)</span> <span class="skolem">u</span> <span class="main">∨</span> is_pred_syz <span class="main">(</span>new_syz_sigs <span class="free">ss</span> <span class="free">bs</span> <span class="free">p</span><span class="main">)</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∨</span>
                        <span class="main">(</span>is_rewritable <span class="free">bs</span> <span class="skolem">a</span> <span class="skolem">u</span> <span class="main">∨</span> is_rewritable <span class="free">bs</span> <span class="skolem">b</span> <span class="skolem">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p 1<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_pred_syz <span class="main">(</span>new_syz_sigs <span class="free">ss</span> <span class="free">bs</span> <span class="free">p</span><span class="main">)</span> <span class="skolem">u</span> <span class="main">∨</span> is_pred_syz <span class="main">(</span>new_syz_sigs <span class="free">ss</span> <span class="free">bs</span> <span class="free">p</span><span class="main">)</span> <span class="skolem">v</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_pred_syz <span class="main">(</span>new_syz_sigs <span class="free">ss</span> <span class="free">bs</span> <span class="free">p</span><span class="main">)</span> <span class="skolem">u</span>"</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">dgrad</span> <span class="main">(</span>pp_of_term <span class="skolem">u</span><span class="main">)</span> <span class="main">≤</span> dgrad_max <span class="free">dgrad</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> u <span class="dynamic"><span class="dynamic">term_simps</span></span> dickson_gradingD1<span class="main"><span class="main">[</span></span><span class="operator">OF</span> dgrad<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span><span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> dgrad adds_lcs <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">dgrad</span> <span class="main">(</span>lcs <span class="skolem">t1</span> <span class="skolem">t2</span> <span class="main">-</span> <span class="skolem">t1</span><span class="main">)</span> <span class="main">≤</span> <span class="free">dgrad</span> <span class="main">(</span>lcs <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dickson_grading_minus<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> dgrad_max <span class="free">dgrad</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">dgrad</span> <span class="main">(</span>lcs <span class="skolem">t1</span> <span class="skolem">t2</span> <span class="main">-</span> <span class="skolem">t1</span><span class="main">)</span> <span class="main">≤</span> dgrad_max <span class="free">dgrad</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword1"><span class="command">from</span></span> a_in <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">dgrad</span> <span class="main">(</span>lp <span class="skolem">a</span><span class="main">)</span> <span class="main">≤</span> dgrad_max <span class="free">dgrad</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dgrad_sig_setD_lp<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_syz_sig <span class="free">dgrad</span> <span class="skolem">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rl<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p 1<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_pred_syz <span class="main">(</span>new_syz_sigs <span class="free">ss</span> <span class="free">bs</span> <span class="free">p</span><span class="main">)</span> <span class="skolem">v</span>"</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">dgrad</span> <span class="main">(</span>pp_of_term <span class="skolem">v</span><span class="main">)</span> <span class="main">≤</span> dgrad_max <span class="free">dgrad</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> v <span class="dynamic"><span class="dynamic">term_simps</span></span> dickson_gradingD1<span class="main"><span class="main">[</span></span><span class="operator">OF</span> dgrad<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span><span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> dgrad adds_lcs_2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">dgrad</span> <span class="main">(</span>lcs <span class="skolem">t1</span> <span class="skolem">t2</span> <span class="main">-</span> <span class="skolem">t2</span><span class="main">)</span> <span class="main">≤</span> <span class="free">dgrad</span> <span class="main">(</span>lcs <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dickson_grading_minus<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> dgrad_max <span class="free">dgrad</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">dgrad</span> <span class="main">(</span>lcs <span class="skolem">t1</span> <span class="skolem">t2</span> <span class="main">-</span> <span class="skolem">t2</span><span class="main">)</span> <span class="main">≤</span> dgrad_max <span class="free">dgrad</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword1"><span class="command">from</span></span> b_in <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">dgrad</span> <span class="main">(</span>lp <span class="skolem">b</span><span class="main">)</span> <span class="main">≤</span> dgrad_max <span class="free">dgrad</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dgrad_sig_setD_lp<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_syz_sig <span class="free">dgrad</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rl<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p 1<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_rewritable <span class="free">bs</span> <span class="skolem">a</span> <span class="skolem">u</span> <span class="main">∨</span> is_rewritable <span class="free">bs</span> <span class="skolem">b</span> <span class="skolem">v</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p 1<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> Inr <span class="skolem">j</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_pred_syz <span class="main">(</span>new_syz_sigs <span class="free">ss</span> <span class="free">bs</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">dgrad</span> <span class="main">(</span>pp_of_term <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> dgrad_max <span class="free">dgrad</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pp_of_term_of_pair dgrad_max_0<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_syz_sig <span class="free">dgrad</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rl<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">=</span> Inr <span class="skolem">j</span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-rb_aux_inv_preserved_0"><span class="command">lemma</span></span> rb_aux_inv_preserved_0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span><span class="free">bs</span><span class="main">,</span> <span class="free">ss</span><span class="main">,</span> <span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> set <span class="free">ss'</span> <span class="main">⟹</span> is_syz_sig <span class="free">dgrad</span> <span class="bound">s</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> set <span class="free">bs</span> <span class="main">⟹</span> <span class="bound">b</span> <span class="main">∈</span> set <span class="free">bs</span> <span class="main">⟹</span> is_regular_spair <span class="bound">a</span> <span class="bound">b</span> <span class="main">⟹</span> Inl <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∉</span> set <span class="free">ps</span> <span class="main">⟹</span>
           Inl <span class="main">(</span><span class="bound">b</span><span class="main">,</span> <span class="bound">a</span><span class="main">)</span> <span class="main">∉</span> set <span class="free">ps</span> <span class="main">⟹</span> <span class="main">¬</span> is_RB_in <span class="free">dgrad</span> rword <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="main">(</span>lt <span class="main">(</span>spair <span class="bound">a</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
           <span class="main">∃</span><span class="bound">q</span><span class="main">∈</span>set <span class="free">ps</span><span class="main">.</span> sig_of_pair <span class="bound">q</span> <span class="main">=</span> lt <span class="main">(</span>spair <span class="bound">a</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> sig_crit' <span class="free">bs</span> <span class="bound">q</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span> <span class="main">&lt;</span> length <span class="free">fs</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">=</span> Inr <span class="bound">j</span> <span class="main">⟹</span> Inr <span class="bound">j</span> <span class="main">∉</span> set <span class="free">ps</span> <span class="main">⟹</span> is_RB_in <span class="free">dgrad</span> rword <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
            rep_list <span class="main">(</span>monomial <span class="main">1</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> ideal <span class="main">(</span>rep_list <span class="main">`</span> set <span class="free">bs</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span><span class="free">bs</span><span class="main">,</span> <span class="free">ss'</span><span class="main">,</span> <span class="free">ps</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv1 <span class="free">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_D1<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> rb_aux_inv.simps
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI ballI allI impI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> set <span class="free">ss'</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"is_syz_sig <span class="free">dgrad</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">q1</span> <span class="skolem">q2</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Inl <span class="main">(</span><span class="skolem">q1</span><span class="main">,</span> <span class="skolem">q2</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Inl <span class="main">(</span><span class="skolem">q1</span><span class="main">,</span> <span class="skolem">q2</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_regular_spair <span class="skolem">q1</span> <span class="skolem">q2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q1</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q2</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_D3<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Inr <span class="skolem">j</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Inr <span class="skolem">j</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">fs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">q</span><span class="main">.</span> sig_of_pair <span class="bound">q</span> <span class="main">=</span> <span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_D4<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">q</span><span class="main">.</span> sig_of_pair <span class="bound">q</span> <span class="main">=</span> <span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="free">ps</span><span class="main">)</span> <span class="main">≤</span>
          length <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">q</span><span class="main">.</span> sig_of_pair <span class="bound">q</span> <span class="main">=</span> <span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">q</span><span class="main">.</span> sig_of_pair <span class="bound">q</span> <span class="main">=</span> <span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="free">ps</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">fs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>

    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹Inr <span class="skolem">j</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">b</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_D4<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sorted_wrt pair_ord <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_D5<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"sorted_wrt pair_ord <span class="free">ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">q</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sorted_wrt pair_ord <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_D5<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p'</span><span class="main">.</span> <span class="bound">p'</span> <span class="main">∈</span> set <span class="free">ps</span> <span class="main">⟹</span> sig_of_pair <span class="free">p</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> sig_of_pair <span class="bound">p'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pair_ord_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">∈</span> set <span class="free">ps</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"sig_of_pair <span class="free">p</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> sig_of_pair <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b1</span> <span class="skolem">b2</span>
      <span class="keyword1"><span class="command">note</span></span> assms<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">∈</span> set <span class="free">ps</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b1</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b2</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_regular_spair <span class="skolem">b1</span> <span class="skolem">b2</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"sig_of_pair <span class="skolem">q</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="main">(</span>spair <span class="skolem">b1</span> <span class="skolem">b2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Inl <span class="main">(</span><span class="skolem">b1</span><span class="main">,</span> <span class="skolem">b2</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span> <span class="main">∨</span> Inl <span class="main">(</span><span class="skolem">b2</span><span class="main">,</span> <span class="skolem">b1</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_D6_1<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Inl <span class="main">(</span><span class="skolem">b1</span><span class="main">,</span> <span class="skolem">b2</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> 1 2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sig_of_pair <span class="free">p</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="main">(</span>spair <span class="skolem">b1</span> <span class="skolem">b2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Inl <span class="main">(</span><span class="skolem">b1</span><span class="main">,</span> <span class="skolem">b2</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sig_of_spair <span class="quoted"><span class="quoted">‹is_regular_spair <span class="skolem">b1</span> <span class="skolem">b2</span>›</span></span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> sig_of_pair.simps<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Inl <span class="main">(</span><span class="skolem">b2</span><span class="main">,</span> <span class="skolem">b1</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> 1 2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sig_of_pair <span class="free">p</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="main">(</span>spair <span class="skolem">b1</span> <span class="skolem">b2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Inl <span class="main">(</span><span class="skolem">b2</span><span class="main">,</span> <span class="skolem">b1</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sig_of_spair <span class="quoted"><span class="quoted">‹is_regular_spair <span class="skolem">b1</span> <span class="skolem">b2</span>›</span></span> sig_of_spair_commute <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> sig_of_pair.simps<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
      <span class="keyword1"><span class="command">note</span></span> assms<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">∈</span> set <span class="free">ps</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">fs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"sig_of_pair <span class="skolem">q</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Inr <span class="skolem">j</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_D6_2<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> 1 2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sig_of_pair <span class="free">p</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> sig_of_pair <span class="main">(</span>Inr <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Inr <span class="skolem">j</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span> <span class="skolem">q</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">b</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> sig_of_pair <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_D7<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">fs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Inr <span class="skolem">j</span> <span class="main">∉</span> set <span class="free">ps</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_RB_in <span class="free">dgrad</span> rword <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
            rep_list <span class="main">(</span>monomial <span class="main">1</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> ideal <span class="main">(</span>rep_list <span class="main">`</span> set <span class="free">bs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> Inr <span class="skolem">j</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">fs</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Inr <span class="skolem">j</span> <span class="main">∉</span> set <span class="free">ps</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹Inr <span class="skolem">j</span> <span class="main">∉</span> set <span class="free">ps</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Inr <span class="skolem">j</span> <span class="main">∉</span> set <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">fs</span>›</span></span> rb_aux_inv_D9 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"is_RB_in <span class="free">dgrad</span> rword <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="main">(</span>monomial <span class="main">1</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> ideal <span class="main">(</span>rep_list <span class="main">`</span> set <span class="free">bs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">fact</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-rb_aux_inv_preserved_1"><span class="command">lemma</span></span> rb_aux_inv_preserved_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span><span class="free">bs</span><span class="main">,</span> <span class="free">ss</span><span class="main">,</span> <span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"sig_crit <span class="free">bs</span> <span class="main">(</span>new_syz_sigs <span class="free">ss</span> <span class="free">bs</span> <span class="free">p</span><span class="main">)</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span><span class="free">bs</span><span class="main">,</span> new_syz_sigs <span class="free">ss</span> <span class="free">bs</span> <span class="free">p</span><span class="main">,</span> <span class="free">ps</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv1 <span class="free">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_D1<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> bs_sub<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">bs</span> <span class="main">⊆</span> dgrad_sig_set <span class="free">dgrad</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv1_D1<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">,</span> 2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sig_crit' <span class="free">bs</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_crit'I_sig_crit<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_preserved_0<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> set <span class="main">(</span>new_syz_sigs <span class="free">ss</span> <span class="free">bs</span> <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_syz_sig <span class="free">dgrad</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> new_syz_sigs_is_syz_sig<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
    <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"is_regular_spair <span class="skolem">a</span> <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"Inl <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">∉</span> set <span class="free">ps</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"Inl <span class="main">(</span><span class="skolem">b</span><span class="main">,</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">∉</span> set <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_RB_in <span class="free">dgrad</span> rword <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="main">(</span>lt <span class="main">(</span>spair <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">,</span> 2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sig_crit' <span class="free">bs</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_crit'I_sig_crit<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">q</span><span class="main">∈</span>set <span class="free">ps</span><span class="main">.</span> sig_of_pair <span class="bound">q</span> <span class="main">=</span> lt <span class="main">(</span>spair <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> sig_crit' <span class="free">bs</span> <span class="bound">q</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> Inl <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">∨</span> <span class="free">p</span> <span class="main">=</span> Inl <span class="main">(</span><span class="skolem">b</span><span class="main">,</span> <span class="skolem">a</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">hence</span></span> sig_of_p<span class="main">:</span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span>spair <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">=</span> sig_of_pair <span class="free">p</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> Inl <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> 3 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> p sig_of_spair<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> Inl <span class="main">(</span><span class="skolem">b</span><span class="main">,</span> <span class="skolem">a</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> 3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_regular_spair <span class="skolem">b</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_regular_spair_sym<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> p sig_of_spair spair_comm<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="main">]</span></span> lt_uminus<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">note</span></span> assms<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_RB_upt <span class="free">dgrad</span> rword <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="main">(</span>lt <span class="main">(</span>spair <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sig_of_p
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_is_RB_upt_Cons<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">dgrad</span> <span class="main">(</span>lp <span class="main">(</span>spair <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> dgrad_max <span class="free">dgrad</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> dgrad_sig_setD_lp<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> dgrad_sig_set_closed_spair<span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span> dgrad<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> set <span class="free">bs</span>›</span></span> bs_sub <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> dgrad_sig_set <span class="free">dgrad</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> set <span class="free">bs</span>›</span></span> bs_sub <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> dgrad_sig_set <span class="free">dgrad</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> crw<span class="main">:</span> <span class="quoted"><span class="quoted">"is_canon_rewriter rword <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="main">(</span>lt <span class="main">(</span>spair <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span> <span class="skolem">c</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ord_term_lin.linorder_cases<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> 3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="skolem">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_regular_spairD2<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="skolem">b</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">a</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> punit.lt <span class="main">(</span>rep_list <span class="skolem">a</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">b</span>"</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span>spair <span class="skolem">b</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>lcs <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="skolem">b</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">b</span><span class="main">)</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">b</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lt_spair<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span>spair <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>lcs <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="skolem">b</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">b</span><span class="main">)</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">b</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> spair_comm<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">b</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> lt <span class="main">(</span>spair <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> adds_termI<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹rep_list <span class="skolem">b</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rep_list_zero<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_rewrite_ord_finite_canon_rewriterE<span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span> rword<span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span> finite_set<span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword1"><span class="command">from</span></span> 3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="skolem">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_regular_spairD1<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="skolem">a</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">b</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> punit.lt <span class="main">(</span>rep_list <span class="skolem">b</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">a</span>"</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span>spair <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>lcs <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="skolem">b</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">a</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lt_spair<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">a</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> lt <span class="main">(</span>spair <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> adds_termI<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹rep_list <span class="skolem">a</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rep_list_zero<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_rewrite_ord_finite_canon_rewriterE<span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span> rword<span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span> finite_set<span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword1"><span class="command">from</span></span> 3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="skolem">b</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">a</span> <span class="main">≠</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">a</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">b</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_regular_spairD3<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="skolem">b</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">a</span> <span class="main">=</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">a</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">b</span>"</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> 6 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_syz_sig <span class="free">dgrad</span> <span class="main">(</span>lt <span class="main">(</span>spair <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_RB_in_def<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> 6 crw <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="main">(</span>monom_mult <span class="main">1</span> <span class="main">(</span>lp <span class="main">(</span>spair <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">-</span> lp <span class="skolem">c</span><span class="main">)</span> <span class="skolem">c</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_RB_in_def<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> 7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 9<span class="main">:</span> <span class="quoted"><span class="quoted">"is_regular_spair <span class="skolem">x</span> <span class="skolem">y</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> 10<span class="main">:</span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span>spair <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> lt <span class="main">(</span>spair <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 11<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> sig_crit' <span class="free">bs</span> <span class="main">(</span>Inl <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lemma_12<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>5<span class="main">)</span> <span class="quoted"><span class="quoted">‹sig_crit' <span class="free">bs</span> <span class="free">p</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Inl <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">≠</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Inl <span class="main">(</span><span class="skolem">y</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≠</span> <span class="free">p</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> sig_crit'_sym<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Inl <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span> <span class="main">∨</span> Inl <span class="main">(</span><span class="skolem">y</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Inl <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> bexI conjI<span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sig_of_pair <span class="main">(</span>Inl <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> lt <span class="main">(</span>spair <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> sig_of_spair 9 10<span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Inl <span class="main">(</span><span class="skolem">y</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> bexI conjI<span class="main">)</span>
            <span class="keyword1"><span class="command">from</span></span> 9 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_regular_spair <span class="skolem">y</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_regular_spair_sym<span class="main">)</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"sig_of_pair <span class="main">(</span>Inl <span class="main">(</span><span class="skolem">y</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> lt <span class="main">(</span>spair <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> sig_of_spair spair_comm<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">y</span></span><span class="main"><span class="main">]</span></span> lt_uminus 10<span class="main">)</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword1"><span class="command">from</span></span> 11 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> sig_crit' <span class="free">bs</span> <span class="main">(</span>Inl <span class="main">(</span><span class="skolem">y</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> sig_crit'_sym<span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">note</span></span> assms<span class="main">(</span>1<span class="main">)</span> 7 8 9
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> False <span class="quoted"><span class="quoted">‹Inl <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">≠</span> <span class="free">p</span>›</span></span> <span class="quoted"><span class="quoted">‹Inl <span class="main">(</span><span class="skolem">y</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≠</span> <span class="free">p</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Inl <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∉</span> set <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Inl <span class="main">(</span><span class="skolem">y</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∉</span> set <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> 6 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_RB_in <span class="free">dgrad</span> rword <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="main">(</span>lt <span class="main">(</span>spair <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> 10<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> 12<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 13<span class="main">:</span> <span class="quoted"><span class="quoted">"sig_of_pair <span class="skolem">q</span> <span class="main">=</span> lt <span class="main">(</span>spair <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> 14<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> sig_crit' <span class="free">bs</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_D8<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> 12 14 <span class="quoted"><span class="quoted">‹sig_crit' <span class="free">bs</span> <span class="free">p</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> 13 14 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> 10 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">with</span></span> 4 5 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Inl <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">∉</span> set <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Inl <span class="main">(</span><span class="skolem">b</span><span class="main">,</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">∉</span> set <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> 1 2 3 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> 7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 8<span class="main">:</span> <span class="quoted"><span class="quoted">"sig_of_pair <span class="skolem">q</span> <span class="main">=</span> lt <span class="main">(</span>spair <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> 9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> sig_crit' <span class="free">bs</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 6 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_D8<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> 7 9 <span class="quoted"><span class="quoted">‹sig_crit' <span class="free">bs</span> <span class="free">p</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> 8 9 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">fs</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> Inr <span class="skolem">j</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹sig_crit' <span class="free">bs</span> <span class="free">p</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_syz_sig <span class="free">dgrad</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_RB_in <span class="free">dgrad</span> rword <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_RB_inI2<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="main">(</span>monomial <span class="main">1</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> ideal <span class="main">(</span>rep_list <span class="main">`</span> set <span class="free">bs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_zero_idealI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> syzygy_crit<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_RB_upt <span class="free">dgrad</span> rword <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="main">(</span>sig_of_pair <span class="free">p</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_is_RB_upt_Cons<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> dgrad <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_sig_GB_upt <span class="free">dgrad</span> <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="main">(</span>sig_of_pair <span class="free">p</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_RB_upt_is_sig_GB_upt<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"is_sig_GB_upt <span class="free">dgrad</span> <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"monomial <span class="main">1</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> dgrad_sig_set <span class="free">dgrad</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dgrad_sig_set_closed_monomial<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">term_simps</span></span> dgrad_max_0 <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">fs</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span>monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'b</span><span class="main">)</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lt_monomial<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">fact</span> dgrad<span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_RB_in <span class="free">dgrad</span> rword <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                      rep_list <span class="main">(</span>monomial <span class="main">1</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> ideal <span class="main">(</span>rep_list <span class="main">`</span> set <span class="free">bs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-rb_aux_inv_preserved_2"><span class="command">lemma</span></span> rb_aux_inv_preserved_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span><span class="free">bs</span><span class="main">,</span> <span class="free">ss</span><span class="main">,</span> <span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="main">(</span>sig_trd <span class="free">bs</span> <span class="main">(</span>poly_of_pair <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span><span class="free">bs</span><span class="main">,</span> lt <span class="main">(</span>sig_trd <span class="free">bs</span> <span class="main">(</span>poly_of_pair <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">#</span> new_syz_sigs <span class="free">ss</span> <span class="free">bs</span> <span class="free">p</span><span class="main">,</span> <span class="free">ps</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"sig_trd <span class="free">bs</span> <span class="main">(</span>poly_of_pair <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>poly_of_pair <span class="free">p</span><span class="main">)</span> <span class="var">?p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_trd_red_rtrancl<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"lt <span class="var">?p</span> <span class="main">=</span> lt <span class="main">(</span>poly_of_pair <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_regular_rtrancl_lt<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> inv1<span class="main">:</span> <span class="quoted"><span class="quoted">"rb_aux_inv1 <span class="free">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_D1<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"is_syz_sig <span class="free">dgrad</span> <span class="main">(</span>lt <span class="main">(</span>poly_of_pair <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> is_syz_sigI<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_of_pair <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pair_list_nonzero<span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lc <span class="main">(</span>poly_of_pair <span class="free">p</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lc_not_0<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> 0 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lc <span class="var">?p</span> <span class="main">=</span> lc <span class="main">(</span>poly_of_pair <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_regular_rtrancl_lc<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lc <span class="var">?p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lc_eq_zero_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">note</span></span> dgrad<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> inv1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="free">bs</span> <span class="main">⊆</span> dgrad_sig_set <span class="free">dgrad</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv1_D1<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly_of_pair <span class="free">p</span> <span class="main">∈</span> dgrad_sig_set <span class="free">dgrad</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pair_list_dgrad_sig_set<span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">∈</span> dgrad_sig_set <span class="free">dgrad</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 0 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dgrad_sig_set_closed_sig_red_rtrancl<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">fact</span> eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> rb<span class="main">:</span> <span class="quoted"><span class="quoted">"is_RB_in <span class="free">dgrad</span> rword <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="main">(</span>lt <span class="main">(</span>poly_of_pair <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_RB_inI2<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_preserved_0<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> set <span class="main">(</span>lt <span class="var">?p</span> <span class="main">#</span> new_syz_sigs <span class="free">ss</span> <span class="free">bs</span> <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> lt <span class="main">(</span>poly_of_pair <span class="free">p</span><span class="main">)</span> <span class="main">∨</span> <span class="skolem">s</span> <span class="main">∈</span> set <span class="main">(</span>new_syz_sigs <span class="free">ss</span> <span class="free">bs</span> <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"is_syz_sig <span class="free">dgrad</span> <span class="skolem">s</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> lt <span class="main">(</span>poly_of_pair <span class="free">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> * <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> set <span class="main">(</span>new_syz_sigs <span class="free">ss</span> <span class="free">bs</span> <span class="free">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> new_syz_sigs_is_syz_sig<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
    <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"is_regular_spair <span class="skolem">a</span> <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"Inl <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">∉</span> set <span class="free">ps</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"Inl <span class="main">(</span><span class="skolem">b</span><span class="main">,</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">∉</span> set <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_RB_in <span class="free">dgrad</span> rword <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="main">(</span>lt <span class="main">(</span>spair <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> sig_of_p<span class="main">:</span> <span class="quoted"><span class="quoted">"sig_of_pair <span class="free">p</span> <span class="main">=</span> lt <span class="main">(</span>poly_of_pair <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pair_list_sig_of_pair<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> rb 6 <span class="keyword1"><span class="command">have</span></span> neq<span class="main">:</span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span>poly_of_pair <span class="free">p</span><span class="main">)</span> <span class="main">≠</span> lt <span class="main">(</span>spair <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> Inl <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> Inl <span class="main">(</span><span class="skolem">b</span><span class="main">,</span> <span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> spair_comm<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> 4 5 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Inl <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">∉</span> set <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Inl <span class="main">(</span><span class="skolem">b</span><span class="main">,</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">∉</span> set <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> 1 2 3 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> 7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 8<span class="main">:</span> <span class="quoted"><span class="quoted">"sig_of_pair <span class="skolem">q</span> <span class="main">=</span> lt <span class="main">(</span>spair <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> sig_crit' <span class="free">bs</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 6 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_D8<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">,</span> 2<span class="main">)</span> neq <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sig_of_p<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">q</span><span class="main">∈</span>set <span class="free">ps</span><span class="main">.</span> sig_of_pair <span class="bound">q</span> <span class="main">=</span> lt <span class="main">(</span>spair <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> sig_crit' <span class="free">bs</span> <span class="bound">q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 8 9 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">fs</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> Inr <span class="skolem">j</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> rb <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_RB_in <span class="free">dgrad</span> rword <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p lt_monomial<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="main">(</span>monomial <span class="main">1</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> ideal <span class="main">(</span>rep_list <span class="main">`</span> set <span class="free">bs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_zero_idealI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> sig_red_zeroI<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> 0 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>monomial <span class="main">1</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="var">?p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_RB_in <span class="free">dgrad</span> rword <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                      rep_list <span class="main">(</span>monomial <span class="main">1</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> ideal <span class="main">(</span>rep_list <span class="main">`</span> set <span class="free">bs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-rb_aux_inv_preserved_3"><span class="command">lemma</span></span> rb_aux_inv_preserved_3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span><span class="free">bs</span><span class="main">,</span> <span class="free">ss</span><span class="main">,</span> <span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> sig_crit <span class="free">bs</span> <span class="main">(</span>new_syz_sigs <span class="free">ss</span> <span class="free">bs</span> <span class="free">p</span><span class="main">)</span> <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="main">(</span>sig_trd <span class="free">bs</span> <span class="main">(</span>poly_of_pair <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span><span class="main">(</span>sig_trd <span class="free">bs</span> <span class="main">(</span>poly_of_pair <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">#</span> <span class="free">bs</span><span class="main">,</span> new_syz_sigs <span class="free">ss</span> <span class="free">bs</span> <span class="free">p</span><span class="main">,</span>
                          add_spairs <span class="free">ps</span> <span class="free">bs</span> <span class="main">(</span>sig_trd <span class="free">bs</span> <span class="main">(</span>poly_of_pair <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span>sig_trd <span class="free">bs</span> <span class="main">(</span>poly_of_pair <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> lt <span class="main">`</span> set <span class="free">bs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> sig_of_p<span class="main">:</span> <span class="quoted"><span class="quoted">"sig_of_pair <span class="free">p</span> <span class="main">=</span> lt <span class="main">(</span>poly_of_pair <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> p_in<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_of_pair <span class="free">p</span> <span class="main">∈</span> dgrad_sig_set <span class="free">dgrad</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pair_list_sig_of_pair<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> pair_list_dgrad_sig_set<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">=</span> sig_trd <span class="free">bs</span> <span class="main">(</span>poly_of_pair <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> inv1<span class="main">:</span> <span class="quoted"><span class="quoted">"rb_aux_inv1 <span class="free">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_D1<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> bs_sub<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">bs</span> <span class="main">⊆</span> dgrad_sig_set <span class="free">dgrad</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv1_D1<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> p_red<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>poly_of_pair <span class="free">p</span><span class="main">)</span> <span class="skolem">p'</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> p'_irred<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="skolem">p'</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> p'_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_trd_red_rtrancl<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> sig_trd_irred<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> dgrad bs_sub p_in p_red <span class="keyword1"><span class="command">have</span></span> p'_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">∈</span> dgrad_sig_set <span class="free">dgrad</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dgrad_sig_set_closed_sig_red_rtrancl<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> p_red <span class="keyword1"><span class="command">have</span></span> lt_p'<span class="main">:</span> <span class="quoted"><span class="quoted">"lt <span class="skolem">p'</span> <span class="main">=</span> lt <span class="main">(</span>poly_of_pair <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_regular_rtrancl_lt<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> sig_merge<span class="main">:</span> <span class="quoted"><span class="quoted">"sig_of_pair <span class="free">p</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> sig_of_pair <span class="skolem">q</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> set <span class="main">(</span>add_spairs <span class="free">ps</span> <span class="free">bs</span> <span class="skolem">p'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">q</span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> add_spairs_def set_merge_wrt
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> set <span class="main">(</span>new_spairs <span class="free">bs</span> <span class="skolem">p'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b0</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"is_regular_spair <span class="skolem">p'</span> <span class="skolem">b0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> Inl <span class="main">(</span><span class="skolem">p'</span><span class="main">,</span> <span class="skolem">b0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> in_new_spairsE<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> sig_of_q<span class="main">:</span> <span class="quoted"><span class="quoted">"sig_of_pair <span class="skolem">q</span> <span class="main">=</span> lt <span class="main">(</span>spair <span class="skolem">p'</span> <span class="skolem">b0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> sig_of_spair<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> sig_of_q sig_of_p lt_p'<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_regular_spair_lt_ge_1<span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sorted_wrt pair_ord <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_D5<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pair_ord_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> sig_of_p_less<span class="main">:</span> <span class="quoted"><span class="quoted">"sig_of_pair <span class="free">p</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"Inr <span class="skolem">j</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">j</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ord_term_lin.le_neq_trans<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sorted_wrt pair_ord <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_D5<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹Inr <span class="skolem">j</span> <span class="main">∈</span> set <span class="free">ps</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sig_of_pair <span class="free">p</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pair_ord_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> that <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sig_of_pair <span class="free">p</span> <span class="main">≠</span> <span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Inr_in_tailD<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> lt_p_gr<span class="main">:</span> <span class="quoted"><span class="quoted">"lt <span class="skolem">b</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="main">(</span>poly_of_pair <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">b</span> <span class="keyword1"><span class="command">unfolding</span></span> sig_of_p<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span> 2<span class="main">)</span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> not_sig_crit<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> inv1<span class="main">:</span> <span class="quoted"><span class="quoted">"rb_aux_inv1 <span class="main">(</span><span class="skolem">p'</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> rb_aux_inv1_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI impI allI<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> bs_sub p'_in <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="skolem">p'</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span> <span class="main">⊆</span> dgrad_sig_set <span class="free">dgrad</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> inv1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> rep_list <span class="main">`</span> set <span class="free">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv1_D2<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> rep_list <span class="main">`</span> set <span class="main">(</span><span class="skolem">p'</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> inv1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sorted_wrt <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> lt <span class="bound">y</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="bound">x</span><span class="main">)</span> <span class="free">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv1_D3<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> lt_p_gr <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sorted_wrt <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> lt <span class="bound">y</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">p'</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lt_p'<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">p'</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="main">(</span>set <span class="main">(</span>drop <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">p'</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="skolem">p'</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
          <span class="main">(</span><span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span>length <span class="free">fs</span><span class="main">.</span> lt <span class="main">(</span><span class="main">(</span><span class="skolem">p'</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> lt <span class="main">(</span>monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'b</span><span class="main">)</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
             punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="main">(</span><span class="skolem">p'</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">≼</span></span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span>monomial <span class="main">1</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span>
         <span class="main">(</span><span class="main">∃</span><span class="bound">p</span><span class="main">∈</span>set <span class="main">(</span><span class="skolem">p'</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound">q</span><span class="main">∈</span>set <span class="main">(</span><span class="skolem">p'</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span><span class="main">.</span> is_regular_spair <span class="bound">p</span> <span class="bound">q</span> <span class="main">∧</span> rep_list <span class="main">(</span>spair <span class="bound">p</span> <span class="bound">q</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span>
                lt <span class="main">(</span><span class="main">(</span><span class="skolem">p'</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> lt <span class="main">(</span>spair <span class="bound">p</span> <span class="bound">q</span><span class="main">)</span> <span class="main">∧</span>
                punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="main">(</span><span class="skolem">p'</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">≼</span></span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span>spair <span class="bound">p</span> <span class="bound">q</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
          is_RB_upt <span class="free">dgrad</span> rword <span class="main">(</span>set <span class="main">(</span>drop <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">p'</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>lt <span class="main">(</span><span class="main">(</span><span class="skolem">p'</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?thesis1</span> <span class="main">∧</span> <span class="var">?thesis2</span> <span class="main">∧</span> <span class="var">?thesis3</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 0
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span>›</span></span> p'_irred <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> bex_simps<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span>length <span class="free">fs</span><span class="main">.</span> lt <span class="skolem">p'</span> <span class="main">=</span> lt <span class="main">(</span>monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'b</span><span class="main">)</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                  punit.lt <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span> <span class="main"><span class="free">≼</span></span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span>monomial <span class="main">1</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span>
              <span class="main">(</span><span class="main">∃</span><span class="bound">p</span><span class="main">∈</span>insert <span class="skolem">p'</span> <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound">q</span><span class="main">∈</span>insert <span class="skolem">p'</span> <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span><span class="main">.</span> is_regular_spair <span class="bound">p</span> <span class="bound">q</span> <span class="main">∧</span> rep_list <span class="main">(</span>spair <span class="bound">p</span> <span class="bound">q</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span>
                     lt <span class="skolem">p'</span> <span class="main">=</span> lt <span class="main">(</span>spair <span class="bound">p</span> <span class="bound">q</span><span class="main">)</span> <span class="main">∧</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span> <span class="main"><span class="free">≼</span></span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span>spair <span class="bound">p</span> <span class="bound">q</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum_prodE<span class="main">)</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
          <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> Inl <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Inl <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_regular_spair <span class="skolem">a</span> <span class="skolem">b</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_D3<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
          <span class="keyword1"><span class="command">from</span></span> p_red <span class="keyword1"><span class="command">have</span></span> p'_red<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>spair <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span> <span class="skolem">p'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>punit.red <span class="main">(</span>rep_list <span class="main">`</span> set <span class="free">bs</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>rep_list <span class="main">(</span>spair <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_red_rtrancl<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="skolem">p'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p'_def<span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="main">(</span>spair <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> punit.rtrancl_0<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> p'_red <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">p'</span> <span class="main">=</span> lt <span class="main">(</span>spair <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
            <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span> <span class="main"><span class="free">≼</span></span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span>spair <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_regular_rtrancl_lt<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> sig_red_rtrancl_lt_rep_list<span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> set <span class="free">bs</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> set <span class="free">bs</span>›</span></span> <span class="quoted"><span class="quoted">‹is_regular_spair <span class="skolem">a</span> <span class="skolem">b</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> Inr <span class="skolem">j</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Inr <span class="skolem">j</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">fs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_D4<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> p_red <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>monomial <span class="main">1</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">p'</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">=</span> Inr <span class="skolem">j</span>›</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">p'</span> <span class="main">=</span> lt <span class="main">(</span>monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'b</span><span class="main">)</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span> <span class="main"><span class="free">≼</span></span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span>monomial <span class="main">1</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_regular_rtrancl_lt<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> sig_red_rtrancl_lt_rep_list<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">fs</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_RB_upt <span class="free">dgrad</span> rword <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="main">(</span>lt <span class="skolem">p'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> lt_p' sig_of_p<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_is_RB_upt_Cons<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">i'</span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">p'</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> i'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i'</span> <span class="main">&lt;</span> length <span class="free">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">=</span> Suc <span class="skolem">i'</span>›</span></span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> bex_simps<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> inv1 i' <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="main">(</span>set <span class="main">(</span>drop <span class="main">(</span>Suc <span class="skolem">i'</span><span class="main">)</span> <span class="free">bs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="skolem">i'</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv1_D4<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword1"><span class="command">from</span></span> inv1 i'
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span>length <span class="free">fs</span><span class="main">.</span> lt <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="skolem">i'</span><span class="main">)</span> <span class="main">=</span> lt <span class="main">(</span>monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'b</span><span class="main">)</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="skolem">i'</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">≼</span></span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span>monomial <span class="main">1</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span>
            <span class="main">(</span><span class="main">∃</span><span class="bound">p</span><span class="main">∈</span>insert <span class="skolem">p'</span> <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound">q</span><span class="main">∈</span>insert <span class="skolem">p'</span> <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span><span class="main">.</span> is_regular_spair <span class="bound">p</span> <span class="bound">q</span> <span class="main">∧</span> rep_list <span class="main">(</span>spair <span class="bound">p</span> <span class="bound">q</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span>
                lt <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="skolem">i'</span><span class="main">)</span> <span class="main">=</span> lt <span class="main">(</span>spair <span class="bound">p</span> <span class="bound">q</span><span class="main">)</span> <span class="main">∧</span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="skolem">i'</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">≼</span></span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span>spair <span class="bound">p</span> <span class="bound">q</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rb_aux_inv1_E<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword1"><span class="command">from</span></span> inv1 i' <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_RB_upt <span class="free">dgrad</span> rword <span class="main">(</span>set <span class="main">(</span>drop <span class="main">(</span>Suc <span class="skolem">i'</span><span class="main">)</span> <span class="free">bs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>lt <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="skolem">i'</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv1_D5<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis1</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?thesis2</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?thesis3</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> rb<span class="main">:</span> <span class="quoted"><span class="quoted">"is_RB_in <span class="free">dgrad</span> rword <span class="main">(</span>set <span class="main">(</span><span class="skolem">p'</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>sig_of_pair <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> is_RB_inI1<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">p'</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> inv1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_canon_rewriter rword <span class="main">(</span>set <span class="main">(</span><span class="skolem">p'</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>lt <span class="skolem">p'</span><span class="main">)</span> <span class="skolem">p'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_canon_rewriterI_eq_sig<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"is_canon_rewriter rword <span class="main">(</span>set <span class="main">(</span><span class="skolem">p'</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>sig_of_pair <span class="free">p</span><span class="main">)</span> <span class="skolem">p'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lt_p' sig_of_p<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> p'_irred <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="skolem">p'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_sig_red_top_tail_cases<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> sig_irred_regular_self <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="main">(</span><span class="main">{</span><span class="skolem">p'</span><span class="main">}</span> <span class="main">∪</span> set <span class="free">bs</span><span class="main">)</span> <span class="skolem">p'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_sig_red_Un <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> Un_insert_left<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="main">(</span>set <span class="main">(</span><span class="skolem">p'</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>monom_mult <span class="main">1</span> <span class="main">(</span>pp_of_term <span class="main">(</span>sig_of_pair <span class="free">p</span><span class="main">)</span> <span class="main">-</span> lp <span class="skolem">p'</span><span class="main">)</span> <span class="skolem">p'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lt_p' sig_of_p<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span><span class="skolem">p'</span> <span class="main">#</span> <span class="free">bs</span><span class="main">,</span> new_syz_sigs <span class="free">ss</span> <span class="free">bs</span> <span class="free">p</span><span class="main">,</span> add_spairs <span class="free">ps</span> <span class="free">bs</span> <span class="skolem">p'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> rb_aux_inv.simps
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI ballI allI impI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv1 <span class="main">(</span><span class="skolem">p'</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> inv1<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> set <span class="main">(</span>new_syz_sigs <span class="free">ss</span> <span class="free">bs</span> <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_syz_sig <span class="free">dgrad</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> new_syz_sigs_is_syz_sig<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">q1</span> <span class="skolem">q2</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Inl <span class="main">(</span><span class="skolem">q1</span><span class="main">,</span> <span class="skolem">q2</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>add_spairs <span class="free">ps</span> <span class="free">bs</span> <span class="skolem">p'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Inl <span class="main">(</span><span class="skolem">q1</span><span class="main">,</span> <span class="skolem">q2</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>new_spairs <span class="free">bs</span> <span class="skolem">p'</span><span class="main">)</span> <span class="main">∨</span> Inl <span class="main">(</span><span class="skolem">q1</span><span class="main">,</span> <span class="skolem">q2</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> add_spairs_def set_merge_wrt<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_regular_spair <span class="skolem">q1</span> <span class="skolem">q2</span> <span class="main">∧</span> <span class="skolem">q1</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">p'</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">q2</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">p'</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Inl <span class="main">(</span><span class="skolem">q1</span><span class="main">,</span> <span class="skolem">q2</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>new_spairs <span class="free">bs</span> <span class="skolem">p'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q1</span> <span class="main">=</span> <span class="skolem">p'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q2</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_regular_spair <span class="skolem">p'</span> <span class="skolem">q2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> in_new_spairsD<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Inl <span class="main">(</span><span class="skolem">q1</span><span class="main">,</span> <span class="skolem">q2</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_regular_spair <span class="skolem">q1</span> <span class="skolem">q2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q1</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q2</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_D3<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"is_regular_spair <span class="skolem">q1</span> <span class="skolem">q2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q1</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">p'</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q2</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">p'</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Inr <span class="skolem">j</span> <span class="main">∈</span> set <span class="main">(</span>add_spairs <span class="free">ps</span> <span class="free">bs</span> <span class="skolem">p'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Inr <span class="skolem">j</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_spairs_def set_merge_wrt Inr_not_in_new_spairs<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Inr <span class="skolem">j</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">fs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_D4<span class="main">)</span>

    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">p'</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> <span class="skolem">p'</span> <span class="main">∨</span> <span class="skolem">b</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">b</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> <span class="skolem">p'</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">b</span> <span class="main">=</span> sig_of_pair <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> lt_p' sig_of_p<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹Inr <span class="skolem">j</span> <span class="main">∈</span> set <span class="free">ps</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_of_p_less<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹Inr <span class="skolem">j</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_D4<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Inr <span class="skolem">j</span> <span class="main">∈</span> set <span class="main">(</span>add_spairs <span class="free">ps</span> <span class="free">bs</span> <span class="skolem">p'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Inr <span class="skolem">j</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_spairs_def set_merge_wrt Inr_not_in_new_spairs<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Inr <span class="skolem">j</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">q</span><span class="main">.</span> sig_of_pair <span class="bound">q</span> <span class="main">=</span> <span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filter <span class="var">?P</span> <span class="main">(</span>add_spairs <span class="free">ps</span> <span class="free">bs</span> <span class="skolem">p'</span><span class="main">)</span> <span class="main">=</span> filter <span class="var">?P</span> <span class="free">ps</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> add_spairs_def
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> filter_merge_wrt_2<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">q</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> set <span class="main">(</span>new_spairs <span class="free">bs</span> <span class="skolem">p'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_regular_spair <span class="skolem">p'</span> <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> Inl <span class="main">(</span><span class="skolem">p'</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> in_new_spairsE<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"sig_of_pair <span class="skolem">q</span> <span class="main">=</span> <span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span>spair <span class="skolem">p'</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">=</span> <span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sig_of_spair <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> sig_of_pair.simps<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"component_of_term <span class="main">(</span>lt <span class="main">(</span>spair <span class="skolem">p'</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> component_of_term_of_pair<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"component_of_term <span class="main">(</span>lt <span class="skolem">p'</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">j</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> component_of_term <span class="main">(</span>lt <span class="skolem">p'</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">j</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"component_of_term <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> component_of_term <span class="main">(</span>lt <span class="skolem">p'</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> component_of_term_of_pair<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pp_of_term <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">≼</span></span> pp_of_term <span class="main">(</span>lt <span class="skolem">p'</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pp_of_term_of_pair zero_min<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="skolem">p'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ord_termI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">p'</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> lt_p' sig_of_p<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Inr <span class="skolem">j</span> <span class="main">∈</span> set <span class="free">ps</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_of_p_less<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"component_of_term <span class="main">(</span>lt <span class="skolem">b</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">j</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> component_of_term <span class="main">(</span>lt <span class="skolem">b</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">j</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"component_of_term <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> component_of_term <span class="main">(</span>lt <span class="skolem">b</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> component_of_term_of_pair<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pp_of_term <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">≼</span></span> pp_of_term <span class="main">(</span>lt <span class="skolem">b</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pp_of_term_of_pair zero_min<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ord_termI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹Inr <span class="skolem">j</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> set <span class="free">bs</span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">b</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_D4<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"component_of_term <span class="main">(</span>lt <span class="main">(</span>spair <span class="skolem">p'</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">j</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> is_regular_spair_component_lt_cases<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹is_regular_spair <span class="skolem">p'</span> <span class="skolem">b</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>filter <span class="var">?P</span> <span class="main">(</span>add_spairs <span class="free">ps</span> <span class="free">bs</span> <span class="skolem">p'</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> length <span class="main">(</span>filter <span class="var">?P</span> <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹Inr <span class="skolem">j</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_D4<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>filter <span class="var">?P</span> <span class="main">(</span>add_spairs <span class="free">ps</span> <span class="free">bs</span> <span class="skolem">p'</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sorted_wrt pair_ord <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_D5<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sorted_wrt pair_ord <span class="free">ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"sorted_wrt pair_ord <span class="main">(</span>add_spairs <span class="free">ps</span> <span class="free">bs</span> <span class="skolem">p'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sorted_add_spairs<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">q</span> <span class="skolem">b1</span> <span class="skolem">b2</span>
    <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> set <span class="main">(</span>add_spairs <span class="free">ps</span> <span class="free">bs</span> <span class="skolem">p'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"is_regular_spair <span class="skolem">b1</span> <span class="skolem">b2</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"sig_of_pair <span class="skolem">q</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="main">(</span>spair <span class="skolem">b1</span> <span class="skolem">b2</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b1</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">p'</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b2</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">p'</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b1</span> <span class="main">=</span> <span class="skolem">p'</span> <span class="main">∨</span> <span class="skolem">b1</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b2</span> <span class="main">=</span> <span class="skolem">p'</span> <span class="main">∨</span> <span class="skolem">b2</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"Inl <span class="main">(</span><span class="skolem">b1</span><span class="main">,</span> <span class="skolem">b2</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>add_spairs <span class="free">ps</span> <span class="free">bs</span> <span class="skolem">p'</span><span class="main">)</span> <span class="main">∨</span> Inl <span class="main">(</span><span class="skolem">b2</span><span class="main">,</span> <span class="skolem">b1</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>add_spairs <span class="free">ps</span> <span class="free">bs</span> <span class="skolem">p'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">elim</span> disjE<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b1</span> <span class="main">=</span> <span class="skolem">p'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b2</span> <span class="main">=</span> <span class="skolem">p'</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_regular_spair_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b1</span> <span class="main">=</span> <span class="skolem">p'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b2</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span> 2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Inl <span class="main">(</span><span class="skolem">b1</span><span class="main">,</span> <span class="skolem">b2</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>new_spairs <span class="free">bs</span> <span class="skolem">p'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b1</span> <span class="main">=</span> <span class="skolem">p'</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> in_new_spairsI<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sig_of_spair add_spairs_def set_merge_wrt image_Un <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> sig_of_pair.simps<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b2</span> <span class="main">=</span> <span class="skolem">p'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b1</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span>
      <span class="keyword1"><span class="command">note</span></span> this<span class="main">(</span>2<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> 2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_regular_spair <span class="skolem">b2</span> <span class="skolem">b1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_regular_spair_sym<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Inl <span class="main">(</span><span class="skolem">b2</span><span class="main">,</span> <span class="skolem">b1</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>new_spairs <span class="free">bs</span> <span class="skolem">p'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b2</span> <span class="main">=</span> <span class="skolem">p'</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> in_new_spairsI<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sig_of_spair_commute sig_of_spair add_spairs_def set_merge_wrt image_Un <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> sig_of_pair.simps<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">note</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b1</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b2</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> 2
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"sig_of_pair <span class="free">p</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="main">(</span>spair <span class="skolem">b1</span> <span class="skolem">b2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ord_term_lin.le_less_trans<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> sig_merge<span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span> 1<span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span> 3<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_D6_1<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Inl <span class="main">(</span><span class="skolem">b1</span><span class="main">,</span> <span class="skolem">b2</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> 4 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Inl <span class="main">(</span><span class="skolem">b1</span><span class="main">,</span> <span class="skolem">b2</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sig_of_spair <span class="quoted"><span class="quoted">‹is_regular_spair <span class="skolem">b1</span> <span class="skolem">b2</span>›</span></span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> sig_of_pair.simps<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_spairs_def set_merge_wrt<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Inl <span class="main">(</span><span class="skolem">b2</span><span class="main">,</span> <span class="skolem">b1</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> 4 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Inl <span class="main">(</span><span class="skolem">b2</span><span class="main">,</span> <span class="skolem">b1</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sig_of_spair sig_of_spair_commute <span class="quoted"><span class="quoted">‹is_regular_spair <span class="skolem">b1</span> <span class="skolem">b2</span>›</span></span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> sig_of_pair.simps<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_spairs_def set_merge_wrt<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">q</span> <span class="skolem">j</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">fs</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> set <span class="main">(</span>add_spairs <span class="free">ps</span> <span class="free">bs</span> <span class="skolem">p'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sig_of_pair <span class="free">p</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> sig_of_pair <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_merge<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"sig_of_pair <span class="skolem">q</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"sig_of_pair <span class="free">p</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">fs</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Inr <span class="skolem">j</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_D6_2<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Inr <span class="skolem">j</span> <span class="main">∈</span> set <span class="main">(</span>add_spairs <span class="free">ps</span> <span class="free">bs</span> <span class="skolem">p'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> add_spairs_def set_merge_wrt<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span> <span class="skolem">q</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">p'</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> q_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> set <span class="main">(</span>add_spairs <span class="free">ps</span> <span class="free">bs</span> <span class="skolem">p'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> <span class="skolem">p'</span> <span class="main">∨</span> <span class="skolem">b</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">b</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="skolem">p'</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword1"><span class="command">note</span></span> assms<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">b</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> sig_of_pair <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_D7<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> lt_p' sig_of_p<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sig_of_pair <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> sig_of_p lt_p'<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> q_in <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> sig_of_pair <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_merge<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">b</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> sig_of_pair <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
    <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">p'</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">p'</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"is_regular_spair <span class="skolem">a</span> <span class="skolem">b</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> 6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_RB_in <span class="free">dgrad</span> rword <span class="main">(</span>set <span class="main">(</span><span class="skolem">p'</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>lt <span class="main">(</span>spair <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> rb <span class="keyword1"><span class="command">have</span></span> neq<span class="main">:</span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span>spair <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">≠</span> lt <span class="main">(</span>poly_of_pair <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sig_of_p<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Inl <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">∉</span> set <span class="main">(</span>add_spairs <span class="free">ps</span> <span class="free">bs</span> <span class="skolem">p'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> 40<span class="main">:</span> <span class="quoted"><span class="quoted">"Inl <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">∉</span> set <span class="main">(</span>new_spairs <span class="free">bs</span> <span class="skolem">p'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Inl <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">∉</span> set <span class="free">ps</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_spairs_def set_merge_wrt<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span> neq <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"Inl <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">∉</span> set <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Inl <span class="main">(</span><span class="skolem">b</span><span class="main">,</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">∉</span> set <span class="main">(</span>add_spairs <span class="free">ps</span> <span class="free">bs</span> <span class="skolem">p'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> 50<span class="main">:</span> <span class="quoted"><span class="quoted">"Inl <span class="main">(</span><span class="skolem">b</span><span class="main">,</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">∉</span> set <span class="main">(</span>new_spairs <span class="free">bs</span> <span class="skolem">p'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Inl <span class="main">(</span><span class="skolem">b</span><span class="main">,</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">∉</span> set <span class="free">ps</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_spairs_def set_merge_wrt<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span> neq <span class="keyword1"><span class="command">have</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"Inl <span class="main">(</span><span class="skolem">b</span><span class="main">,</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">∉</span> set <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> spair_comm<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> <span class="skolem">p'</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">p'</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> 3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">≠</span> <span class="skolem">p'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_regular_spair_def<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> 2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Inl <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>new_spairs <span class="free">bs</span> <span class="skolem">p'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 3 <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">p'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> in_new_spairsI<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> 40 <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">≠</span> <span class="skolem">p'</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> <span class="skolem">p'</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> 3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> <span class="skolem">p'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_regular_spair_def<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> 3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_regular_spair <span class="skolem">b</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_regular_spair_sym<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Inl <span class="main">(</span><span class="skolem">b</span><span class="main">,</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>new_spairs <span class="free">bs</span> <span class="skolem">p'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">=</span> <span class="skolem">p'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> in_new_spairsI<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> 50 <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">with</span></span> 2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> lt_sp<span class="main">:</span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span>spair <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="skolem">p'</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ord_term_lin.linorder_cases<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span>spair <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">=</span> lt <span class="skolem">p'</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> neq <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lt_p'<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">p'</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="main">(</span>spair <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sig_of_pair <span class="free">p</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="main">(</span>spair <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> lt_p' sig_of_p<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> set <span class="free">bs</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> set <span class="free">bs</span>›</span></span> 3 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_D6_1<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Inl <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> 4 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Inl <span class="main">(</span><span class="skolem">b</span><span class="main">,</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> 5 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_RB_in <span class="free">dgrad</span> rword <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="main">(</span>lt <span class="main">(</span>spair <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_RB_in <span class="free">dgrad</span> rword <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="main">(</span>lt <span class="main">(</span>spair <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_RB_in <span class="free">dgrad</span> rword <span class="main">(</span>set <span class="main">(</span><span class="skolem">p'</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>lt <span class="main">(</span>spair <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> set_simps <span class="keyword1"><span class="command">using</span></span> lt_sp
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_RB_in_insertI<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> 6 <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> set <span class="free">bs</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> set <span class="free">bs</span>›</span></span> 3 4 5
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 8<span class="main">:</span> <span class="quoted"><span class="quoted">"sig_of_pair <span class="skolem">q</span> <span class="main">=</span> lt <span class="main">(</span>spair <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> sig_crit' <span class="free">bs</span> <span class="skolem">q</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_D8<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">,</span> 2<span class="main">)</span> lt_sp <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lt_p' sig_of_p<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">q</span><span class="main">∈</span>set <span class="main">(</span>add_spairs <span class="free">ps</span> <span class="free">bs</span> <span class="skolem">p'</span><span class="main">)</span><span class="main">.</span> sig_of_pair <span class="bound">q</span> <span class="main">=</span> lt <span class="main">(</span>spair <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> sig_crit' <span class="main">(</span><span class="skolem">p'</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span> <span class="bound">q</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> bexI conjI<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> sig_crit' <span class="main">(</span><span class="skolem">p'</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span> <span class="skolem">q</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"sig_crit' <span class="main">(</span><span class="skolem">p'</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span> <span class="skolem">q</span>"</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> lt_sp <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sig_of_pair <span class="skolem">q</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="skolem">p'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> 8<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sig_crit' <span class="free">bs</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_crit'_ConsD<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> 9 <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">∈</span> set <span class="free">ps</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> set <span class="main">(</span>add_spairs <span class="free">ps</span> <span class="free">bs</span> <span class="skolem">p'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_spairs_def set_merge_wrt<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">fs</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Inr <span class="skolem">j</span> <span class="main">∉</span> set <span class="main">(</span>add_spairs <span class="free">ps</span> <span class="free">bs</span> <span class="skolem">p'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Inr <span class="skolem">j</span> <span class="main">∉</span> set <span class="free">ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_spairs_def set_merge_wrt<span class="main">)</span>

    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_RB_in <span class="free">dgrad</span> rword <span class="main">(</span>set <span class="main">(</span><span class="skolem">p'</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> sig_of_pair <span class="free">p</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">with</span></span> rb <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹Inr <span class="skolem">j</span> <span class="main">∉</span> set <span class="free">ps</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Inr <span class="skolem">j</span> <span class="main">∉</span> set <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">fs</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> rb'<span class="main">:</span> <span class="quoted"><span class="quoted">"is_RB_in <span class="free">dgrad</span> rword <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_D9<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="skolem">p'</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ord_term_lin.linorder_cases<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> lt <span class="skolem">p'</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> False <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lt_p' sig_of_p<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">p'</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sig_of_pair <span class="free">p</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> lt_p' sig_of_p<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">fs</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Inr <span class="skolem">j</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_D6_2<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹Inr <span class="skolem">j</span> <span class="main">∉</span> set <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">with</span></span> rb' <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> set_simps <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_RB_in_insertI<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="main">(</span>monomial <span class="main">1</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> ideal <span class="main">(</span>rep_list <span class="main">`</span> set <span class="main">(</span><span class="skolem">p'</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> Inr <span class="skolem">j</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_zero_idealI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> sig_red_zeroI<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> p_red <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>monomial <span class="main">1</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">p'</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="free">bs</span> <span class="main">⊆</span> set <span class="main">(</span><span class="skolem">p'</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="main">(</span>set <span class="main">(</span><span class="skolem">p'</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>monomial <span class="main">1</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">p'</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_rtrancl_mono<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sig_red <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="main">(</span>set <span class="main">(</span><span class="skolem">p'</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>monomial <span class="main">1</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">p'</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_rtrancl_sing_regI<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sig_red <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="main">(</span>set <span class="main">(</span><span class="skolem">p'</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span><span class="main">)</span> <span class="skolem">p'</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sig_red_def
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI bexI<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="skolem">p'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p'_def<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sig_red_single <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="skolem">p'</span> <span class="main">0</span> <span class="skolem">p'</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_singleI<span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="skolem">p'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹rep_list <span class="skolem">p'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span> <span class="main">∈</span> keys <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.lt_in_keys<span class="main">)</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span> <span class="main">∈</span> keys <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹rep_list <span class="skolem">p'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.lc <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.lc_not_0<span class="main">)</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">=</span> <span class="skolem">p'</span> <span class="main">-</span> monom_mult <span class="main">(</span>lookup <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span> <span class="main">(</span><span class="main">0</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> punit.lc <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span><span class="main">)</span> <span class="main">0</span> <span class="skolem">p'</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> punit.lc_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">term_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sig_red <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="main">(</span>set <span class="main">(</span><span class="skolem">p'</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>monomial <span class="main">1</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">fact</span> rep_list_zero<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹Inr <span class="skolem">j</span> <span class="main">∉</span> set <span class="free">ps</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Inr <span class="skolem">j</span> <span class="main">∉</span> set <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">fs</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="main">(</span>monomial <span class="main">1</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> ideal <span class="main">(</span>rep_list <span class="main">`</span> set <span class="free">bs</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_D9<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⊆</span> ideal <span class="main">(</span>rep_list <span class="main">`</span> set <span class="main">(</span><span class="skolem">p'</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal.span_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">p'</span> <span class="main">∉</span> lt <span class="main">`</span> set <span class="free">bs</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> lt_p'
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span>poly_of_pair <span class="free">p</span><span class="main">)</span> <span class="main">∈</span> lt <span class="main">`</span> set <span class="free">bs</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span>poly_of_pair <span class="free">p</span><span class="main">)</span> <span class="main">=</span> lt <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">note</span></span> this<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> set <span class="free">bs</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">b</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="main">(</span>poly_of_pair <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lt_p_gr<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-rb_aux_inv_init"><span class="command">lemma</span></span> rb_aux_inv_init<span class="main">:</span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span><span class="main">[]</span><span class="main">,</span> Koszul_syz_sigs <span class="free">fs</span><span class="main">,</span> map Inr <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">fs</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rb_aux_inv.simps rb_aux_inv1_def o_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI ballI allI impI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> set <span class="main">(</span>Koszul_syz_sigs <span class="free">fs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> dgrad fs_distinct fs_nonzero <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_syz_sig <span class="free">dgrad</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Koszul_syz_sigs_is_syz_sig<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Inl <span class="main">(</span><span class="skolem">p</span><span class="main">,</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">∉</span> Inr <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">fs</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Inr <span class="skolem">j</span> <span class="main">∈</span> Inr <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">fs</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">fs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
  <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="skolem">j</span> <span class="main">=</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> term_of_pair_injective<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">fs</span><span class="main">]</span><span class="main">)</span> <span class="main">≤</span> Suc <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sorted_wrt pair_ord <span class="main">(</span>map Inr <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">fs</span><span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sorted_wrt_map pair_ord_def sorted_wrt_upt_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> allI impI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="main">::</span> <span class="quoted">nat</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="skolem">j</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≤</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">i</span><span class="main">)</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ord_termI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">term_simps</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">≤</span> <span class="skolem">j</span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> rb_aux_inv_init_fst<span class="main">:</span>
  <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span>fst <span class="main">(</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span> Koszul_syz_sigs <span class="free">fs</span><span class="main">,</span> map Inr <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">fs</span><span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> rb_aux_inv_init <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">function</span></span> <span class="main">(</span>domintros<span class="main">)</span> <span class="entity">rb_aux</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span> list <span class="main">×</span> <span class="tfree">'t</span> list <span class="main">×</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> nat<span class="main">)</span> list<span class="main">)</span> <span class="main">×</span> nat<span class="main">)</span> <span class="main">⇒</span>
                                    <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span> list <span class="main">×</span> <span class="tfree">'t</span> list <span class="main">×</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> nat<span class="main">)</span> list<span class="main">)</span> <span class="main">×</span> nat<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">rb_aux</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">bs</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">ss</span></span></span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">bs</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">ss</span></span></span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
    <span class="quoted"><span class="quoted">"<span class="free">rb_aux</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">bs</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">ss</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">)</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span> <span class="main">=</span>
      <span class="main">(</span><span class="keyword1">let</span> <span class="bound">ss'</span> <span class="main">=</span> new_syz_sigs <span class="free"><span class="bound"><span class="entity">ss</span></span></span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1">in</span>
        <span class="keyword1">if</span> sig_crit <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="bound">ss'</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1">then</span>
          <span class="free">rb_aux</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">bs</span></span></span><span class="main">,</span> <span class="bound">ss'</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">)</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span>
        <span class="keyword1">else</span>
          <span class="keyword1">let</span> <span class="bound">p'</span> <span class="main">=</span> sig_trd <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="main">(</span>poly_of_pair <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="keyword1">in</span>
            <span class="keyword1">if</span> rep_list <span class="bound">p'</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span>
              <span class="free">rb_aux</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">bs</span></span></span><span class="main">,</span> lt <span class="bound">p'</span> <span class="main">#</span> <span class="bound">ss'</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">)</span><span class="main">,</span> Suc <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span>
            <span class="keyword1">else</span>
              <span class="free">rb_aux</span> <span class="main">(</span><span class="main">(</span><span class="bound">p'</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span><span class="main">,</span> <span class="bound">ss'</span><span class="main">,</span> add_spairs <span class="free"><span class="bound"><span class="entity">ps</span></span></span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="bound">p'</span><span class="main">)</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">pat_completeness</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rb</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span> list <span class="main">×</span> nat"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">rb</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="main">(</span><span class="main">(</span><span class="bound">bs</span><span class="main">,</span> <span class="main"><span class="bound">_</span></span><span class="main">,</span> <span class="main"><span class="bound">_</span></span><span class="main">)</span><span class="main">,</span> <span class="bound">z</span><span class="main">)</span> <span class="main">=</span> rb_aux <span class="main">(</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span> Koszul_syz_sigs <span class="free">fs</span><span class="main">,</span> map Inr <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">fs</span><span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="keyword1">in</span> <span class="main">(</span><span class="bound">bs</span><span class="main">,</span> <span class="bound">z</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> rb<span class="antiquote"><span class="antiquote">}</span></span></span></span> is only an auxiliary function used for stating some theorems about rewrite bases
  and their computation in a readable way. Actual computations (of Gr\"obner bases) are performed
  by function <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>sig_gb›</span></span></span></span>, defined below.
  The second return value of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> rb<span class="antiquote"><span class="antiquote">}</span></span></span></span> is the number of zero-reductions. It is only needed for
  proving that under certain assumptions, there are no such zero-reductions.›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Termination›</span></span>

<span class="keyword2"><span class="keyword">qualified</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">rb_aux_term1</span> <span class="main">≡</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound">z</span><span class="main">.</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">z</span> <span class="main">#</span> <span class="bound">y</span><span class="main">}</span>"</span></span>

<span class="keyword2"><span class="keyword">qualified</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">rb_aux_term2</span> <span class="main">≡</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>fst <span class="bound">x</span><span class="main">,</span> fst <span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> rb_aux_term1 <span class="main">∨</span>
                    <span class="main">(</span>fst <span class="bound">x</span> <span class="main">=</span> fst <span class="bound">y</span> <span class="main">∧</span> length <span class="main">(</span>snd <span class="main">(</span>snd <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="main">(</span>snd <span class="main">(</span>snd <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword2"><span class="keyword">qualified</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">rb_aux_term</span> <span class="main">≡</span> rb_aux_term2 <span class="main">∩</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> rb_aux_inv <span class="bound">x</span> <span class="main">∧</span> rb_aux_inv <span class="bound">y</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Signature_Groebner-wfp_on_rb_aux_term1"><span class="command">lemma</span></span> wfp_on_rb_aux_term1<span class="main">:</span> <span class="quoted"><span class="quoted">"wfp_on <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> rb_aux_term1<span class="main">)</span> <span class="main">(</span>Collect rb_aux_inv1<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> wfp_onI_chain<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">elim</span> exE<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">seq'</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">seq'</span> <span class="bound">i</span> <span class="main">∈</span> Collect rb_aux_inv1 <span class="main">∧</span> <span class="main">(</span><span class="skolem">seq'</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span><span class="main">,</span> <span class="skolem">seq'</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∈</span> rb_aux_term1"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> inv<span class="main">:</span> <span class="quoted"><span class="quoted">"rb_aux_inv1 <span class="main">(</span><span class="skolem">seq'</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> cons<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">b</span><span class="main">.</span> <span class="skolem">seq'</span> <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="bound">b</span> <span class="main">#</span> <span class="skolem">seq'</span> <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">j</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rb_aux_term1_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="skolem">thesis0</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">j</span><span class="main">.</span> <span class="skolem">i</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">seq'</span> <span class="bound">j</span><span class="main">)</span> <span class="main">⟹</span> <span class="skolem">thesis0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">thesis0</span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> list_seq_indexE_length<span class="main">)</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">seq</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">seq</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">let</span> <span class="bound">j</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">k</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">seq'</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">in</span> rev <span class="main">(</span><span class="skolem">seq'</span> <span class="bound">j</span><span class="main">)</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">seq</span> <span class="skolem">i</span> <span class="main">=</span> rev <span class="main">(</span><span class="skolem">seq'</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">seq'</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">k</span><span class="main">.</span> <span class="skolem">i</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">seq'</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> that <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">seq'</span> <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> k_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> someI<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> cons that <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rev <span class="main">(</span><span class="skolem">seq'</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> rev <span class="main">(</span><span class="skolem">seq'</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> list_seq_nth'<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> seq_def k_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">seq</span> <span class="skolem">i</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">seq'</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">seq'</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> that <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="main">(</span>rev <span class="main">(</span><span class="skolem">seq'</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> that <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">seq</span> <span class="skolem">i</span> <span class="main">=</span> rev <span class="main">(</span><span class="skolem">seq'</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 2<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">seq</span> <span class="skolem">i</span> <span class="main">∈</span> set <span class="main">(</span>rev <span class="main">(</span><span class="skolem">seq'</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> nth_mem<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">seq</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">i</span><span class="main">}</span> <span class="main">=</span> set <span class="main">(</span>take <span class="skolem">i</span> <span class="main">(</span>rev <span class="main">(</span><span class="skolem">seq'</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">seq'</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> refl <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">seq</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">i</span><span class="main">}</span> <span class="main">=</span> <span class="main">(!)</span> <span class="main">(</span>rev <span class="main">(</span><span class="skolem">seq'</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">i</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> image_cong<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i'</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i'</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">i</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i'</span> <span class="main">&lt;</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i'</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">seq'</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">seq</span> <span class="skolem">i'</span> <span class="main">=</span> rev <span class="main">(</span><span class="skolem">seq'</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 2<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> set <span class="main">(</span>take <span class="skolem">i</span> <span class="main">(</span>rev <span class="main">(</span><span class="skolem">seq'</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nth_image<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> that less_imp_le_nat<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> dgrad <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> rb_termination<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">seq</span> <span class="skolem">i</span> <span class="main">∈</span> dgrad_sig_set <span class="free">dgrad</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">seq'</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 1<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">seq</span> <span class="skolem">i</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">seq'</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 3<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> inv <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="skolem">seq'</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">⊆</span> dgrad_sig_set <span class="free">dgrad</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv1_D1<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"range <span class="skolem">seq</span> <span class="main">⊆</span> dgrad_sig_set <span class="free">dgrad</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="main">(</span><span class="skolem">seq</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">seq'</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 1<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">seq</span> <span class="skolem">i</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">seq'</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 3<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> inv <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> rep_list <span class="main">`</span> set <span class="main">(</span><span class="skolem">seq'</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv1_D2<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> rep_list <span class="main">`</span> range <span class="skolem">seq</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i1</span> <span class="skolem">i2</span> <span class="main">::</span> <span class="quoted">nat</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i1</span> <span class="main">&lt;</span> <span class="skolem">i2</span>"</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> i2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i2</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">seq'</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 1<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> i1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i1</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">seq'</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">from</span></span> i1 <span class="keyword1"><span class="command">have</span></span> s1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">seq</span> <span class="skolem">i1</span> <span class="main">=</span> rev <span class="main">(</span><span class="skolem">seq'</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 2<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> i2 <span class="keyword1"><span class="command">have</span></span> s2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">seq</span> <span class="skolem">i2</span> <span class="main">=</span> rev <span class="main">(</span><span class="skolem">seq'</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 2<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> inv <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sorted_wrt <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> lt <span class="bound">y</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">seq'</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv1_D3<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sorted_wrt <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> lt <span class="bound">x</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="bound">y</span><span class="main">)</span> <span class="main">(</span>rev <span class="main">(</span><span class="skolem">seq'</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sorted_wrt_rev<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i1</span> <span class="main">&lt;</span> <span class="skolem">i2</span>›</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> i2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i2</span> <span class="main">&lt;</span> length <span class="main">(</span>rev <span class="main">(</span><span class="skolem">seq'</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span>rev <span class="main">(</span><span class="skolem">seq'</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i1</span><span class="main">)</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="main">(</span>rev <span class="main">(</span><span class="skolem">seq'</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sorted_wrt_nth_less<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span><span class="skolem">seq</span> <span class="skolem">i1</span><span class="main">)</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="main">(</span><span class="skolem">seq</span> <span class="skolem">i2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> s1 s2<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">seq'</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 1<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> eq1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">seq</span> <span class="skolem">i</span> <span class="main">=</span> rev <span class="main">(</span><span class="skolem">seq'</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> eq2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">seq</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">i</span><span class="main">}</span> <span class="main">=</span> set <span class="main">(</span>take <span class="skolem">i</span> <span class="main">(</span>rev <span class="main">(</span><span class="skolem">seq'</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 2<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> 4<span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?i</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">seq'</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">-</span> Suc <span class="skolem">i</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> i <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?i</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">seq'</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> inv <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="main">(</span>set <span class="main">(</span>drop <span class="main">(</span>Suc <span class="var">?i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">seq'</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="skolem">seq'</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">!</span> <span class="var">?i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv1_D4<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="main">(</span><span class="skolem">seq</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">i</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="skolem">seq</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq1 eq2 rev_nth take_rev Suc_diff_Suc<span class="main">)</span>
 
    <span class="keyword1"><span class="command">from</span></span> inv <span class="quoted"><span class="quoted">‹<span class="var">?i</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">seq'</span> <span class="skolem">j</span><span class="main">)</span>›</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span>length <span class="free">fs</span><span class="main">.</span> lt <span class="main">(</span><span class="skolem">seq</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> lt <span class="main">(</span>monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'b</span><span class="main">)</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
             punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="skolem">seq</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">≼</span></span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span>monomial <span class="main">1</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span>
         <span class="main">(</span><span class="main">∃</span><span class="bound">j</span> <span class="bound">k</span><span class="main">.</span> is_regular_spair <span class="main">(</span><span class="skolem">seq</span> <span class="bound">j</span><span class="main">)</span> <span class="main">(</span><span class="skolem">seq</span> <span class="bound">k</span><span class="main">)</span> <span class="main">∧</span> rep_list <span class="main">(</span>spair <span class="main">(</span><span class="skolem">seq</span> <span class="bound">j</span><span class="main">)</span> <span class="main">(</span><span class="skolem">seq</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span>
                lt <span class="main">(</span><span class="skolem">seq</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> lt <span class="main">(</span>spair <span class="main">(</span><span class="skolem">seq</span> <span class="bound">j</span><span class="main">)</span> <span class="main">(</span><span class="skolem">seq</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="skolem">seq</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">≼</span></span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span>spair <span class="main">(</span><span class="skolem">seq</span> <span class="bound">j</span><span class="main">)</span> <span class="main">(</span><span class="skolem">seq</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">∨</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv1_E<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j0</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j0</span> <span class="main">&lt;</span> length <span class="free">fs</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span><span class="skolem">seq'</span> <span class="skolem">j</span> <span class="main">!</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">seq'</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">-</span> Suc <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> lt <span class="main">(</span>monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'b</span><span class="main">)</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="skolem">seq'</span> <span class="skolem">j</span> <span class="main">!</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">seq'</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">-</span> Suc <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">≼</span></span>
             punit.lt <span class="main">(</span>rep_list <span class="main">(</span>monomial <span class="main">1</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span> <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eq1 eq2 rev_nth take_rev Suc_diff_Suc<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">q</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">seq'</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">pi</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">pi</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">seq'</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">seq'</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">pi</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> in_set_conv_nth<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="skolem">seq</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">seq'</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">-</span> Suc <span class="skolem">pi</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"2"</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">seq'</span> <span class="skolem">j</span><span class="main">)</span>›</span></span> diff_Suc_less length_pos_if_in_set length_rev rev_nth rev_rev_ident<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">seq'</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">qi</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qi</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">seq'</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">seq'</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">qi</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> in_set_conv_nth<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="skolem">seq</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">seq'</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">-</span> Suc <span class="skolem">qi</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"2"</span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">seq'</span> <span class="skolem">j</span><span class="main">)</span>›</span></span> diff_Suc_less length_pos_if_in_set length_rev rev_nth rev_rev_ident<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_regular_spair <span class="skolem">p</span> <span class="skolem">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="main">(</span>spair <span class="skolem">p</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span><span class="skolem">seq'</span> <span class="skolem">j</span> <span class="main">!</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">seq'</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">-</span> Suc <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> lt <span class="main">(</span>spair <span class="skolem">p</span> <span class="skolem">q</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="skolem">seq'</span> <span class="skolem">j</span> <span class="main">!</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">seq'</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">-</span> Suc <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">≼</span></span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span>spair <span class="skolem">p</span> <span class="skolem">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eq1 eq2 p q rev_nth take_rev Suc_diff_Suc<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1"><span class="command">from</span></span> inv <span class="quoted"><span class="quoted">‹<span class="var">?i</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">seq'</span> <span class="skolem">j</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_RB_upt <span class="free">dgrad</span> rword <span class="main">(</span>set <span class="main">(</span>drop <span class="main">(</span>Suc <span class="var">?i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">seq'</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>lt <span class="main">(</span><span class="main">(</span><span class="skolem">seq'</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">!</span> <span class="var">?i</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv1_D5<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> dgrad <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_sig_GB_upt <span class="free">dgrad</span> <span class="main">(</span>set <span class="main">(</span>drop <span class="main">(</span>Suc <span class="var">?i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">seq'</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>lt <span class="main">(</span><span class="main">(</span><span class="skolem">seq'</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">!</span> <span class="var">?i</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_RB_upt_is_sig_GB_upt<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"is_sig_GB_upt <span class="free">dgrad</span> <span class="main">(</span><span class="skolem">seq</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">i</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span>lt <span class="main">(</span><span class="skolem">seq</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq1 eq2 rev_nth take_rev Suc_diff_Suc<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-wfp_on_rb_aux_term2"><span class="command">lemma</span></span> wfp_on_rb_aux_term2<span class="main">:</span> <span class="quoted"><span class="quoted">"wfp_on <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> rb_aux_term2<span class="main">)</span> <span class="main">(</span>Collect rb_aux_inv<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> wfp_onI_min<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">Q</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Q_sub<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">⊆</span> Collect rb_aux_inv"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fst <span class="skolem">x</span> <span class="main">∈</span> fst <span class="main">`</span> <span class="skolem">Q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> imageI<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="skolem">Q</span> <span class="main">⊆</span> Collect rb_aux_inv1"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> fst <span class="main">`</span> <span class="skolem">Q</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="skolem">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> fst <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">bs</span></span> <span class="skolem"><span class="skolem">ss</span></span> <span class="skolem"><span class="skolem">ps</span></span> <span class="keyword2"><span class="keyword">where</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">bs</span><span class="main">,</span> <span class="skolem">ss</span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv.cases<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">∈</span> <span class="skolem">Q</span>›</span></span> Q_sub <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> Collect rb_aux_inv1"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> y z rb_aux_inv.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> wfp_on_rb_aux_term1 <span class="quoted"><span class="quoted">‹fst <span class="skolem">x</span> <span class="main">∈</span> fst <span class="main">`</span> <span class="skolem">Q</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z'</span> <span class="main">∈</span> fst <span class="main">`</span> <span class="skolem">Q</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> z'_min<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="skolem">z'</span><span class="main">)</span> <span class="main">∈</span> rb_aux_term1 <span class="main">⟹</span> <span class="bound">y</span> <span class="main">∉</span> fst <span class="main">`</span> <span class="skolem">Q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> wfp_onE_min<span class="main">)</span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z0</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z0</span> <span class="main">∈</span> <span class="skolem">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> z'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z'</span> <span class="main">=</span> fst <span class="skolem">z0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Q0</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q0</span> <span class="main">=</span> <span class="main">{</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> <span class="skolem">Q</span> <span class="main">∧</span> fst <span class="bound">z</span> <span class="main">=</span> fst <span class="skolem">z0</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z0</span> <span class="main">∈</span> <span class="skolem">Q</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z0</span> <span class="main">∈</span> <span class="skolem">Q0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Q0_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>snd <span class="main">(</span>snd <span class="skolem">z0</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> length <span class="main">`</span> snd <span class="main">`</span> snd <span class="main">`</span> <span class="skolem">Q0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> imageI<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> wf_less <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> n1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> length <span class="main">`</span> snd <span class="main">`</span> snd <span class="main">`</span> <span class="skolem">Q0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> n2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n'</span><span class="main">.</span> <span class="bound">n'</span> <span class="main">&lt;</span> <span class="skolem">n</span> <span class="main">⟹</span> <span class="bound">n'</span> <span class="main">∉</span> length <span class="main">`</span> snd <span class="main">`</span> snd <span class="main">`</span> <span class="skolem">Q0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> wfE_min<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> n1 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="skolem">Q0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> n3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> length <span class="main">(</span>snd <span class="main">(</span>snd <span class="skolem">z</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> z_min<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∉</span> <span class="skolem">Q0</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>snd <span class="main">(</span>snd <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="main">(</span>snd <span class="main">(</span>snd <span class="skolem">z</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">y</span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">Q0</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>snd <span class="main">(</span>snd <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> length <span class="main">`</span> snd <span class="main">`</span> snd <span class="main">`</span> <span class="skolem">Q0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> imageI<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> n2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> length <span class="main">(</span>snd <span class="main">(</span>snd <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="main">(</span>snd <span class="main">(</span>snd <span class="skolem">z</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> n3<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">z</span><span class="main">∈</span><span class="skolem">Q</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span>Collect rb_aux_inv<span class="main">.</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">z</span><span class="main">)</span> <span class="main">∈</span> rb_aux_term2 <span class="main">⟶</span> <span class="bound">y</span> <span class="main">∉</span> <span class="skolem">Q</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> bexI ballI impI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> Collect rb_aux_inv"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">y</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">∈</span> rb_aux_term2"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>fst <span class="skolem">y</span><span class="main">,</span> fst <span class="skolem">z</span><span class="main">)</span> <span class="main">∈</span> rb_aux_term1 <span class="main">∨</span> <span class="main">(</span>fst <span class="skolem">y</span> <span class="main">=</span> fst <span class="skolem">z</span> <span class="main">∧</span> length <span class="main">(</span>snd <span class="main">(</span>snd <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="main">(</span>snd <span class="main">(</span>snd <span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rb_aux_term2_def<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∉</span> <span class="skolem">Q</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>fst <span class="skolem">y</span><span class="main">,</span> fst <span class="skolem">z</span><span class="main">)</span> <span class="main">∈</span> rb_aux_term1"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">∈</span> <span class="skolem">Q0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fst <span class="skolem">z</span> <span class="main">=</span> fst <span class="skolem">z0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Q0_def<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>fst <span class="skolem">y</span><span class="main">,</span> <span class="skolem">z'</span><span class="main">)</span> <span class="main">∈</span> rb_aux_term1"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rb_aux_term1_def z'<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"fst <span class="skolem">y</span> <span class="main">∉</span> fst <span class="main">`</span> <span class="skolem">Q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> z'_min<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"fst <span class="skolem">y</span> <span class="main">=</span> fst <span class="skolem">z</span> <span class="main">∧</span> length <span class="main">(</span>snd <span class="main">(</span>snd <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="main">(</span>snd <span class="main">(</span>snd <span class="skolem">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"fst <span class="skolem">y</span> <span class="main">=</span> fst <span class="skolem">z</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>snd <span class="main">(</span>snd <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="main">(</span>snd <span class="main">(</span>snd <span class="skolem">z</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∉</span> <span class="skolem">Q0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> z_min<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">∈</span> <span class="skolem">Q0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fst <span class="skolem">y</span> <span class="main">=</span> fst <span class="skolem">z0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Q0_def <span class="quoted"><span class="quoted">‹fst <span class="skolem">y</span> <span class="main">=</span> fst <span class="skolem">z</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Q0_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">∈</span> <span class="skolem">Q0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="skolem">Q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Q0_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> wf_rb_aux_term<span class="main">:</span> <span class="quoted"><span class="quoted">"wf rb_aux_term"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> wfI_min<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span> list <span class="main">×</span> <span class="tfree">'t</span> list <span class="main">×</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> nat<span class="main">)</span> list"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">Q</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">Q</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">z</span><span class="main">∈</span><span class="skolem">Q</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">z</span><span class="main">)</span> <span class="main">∈</span> rb_aux_term <span class="main">⟶</span> <span class="bound">y</span> <span class="main">∉</span> <span class="skolem">Q</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="skolem">x</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Q</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">∩</span> Collect rb_aux_inv"</span></span>
    <span class="keyword1"><span class="command">note</span></span> wfp_on_rb_aux_term2
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">Q</span>›</span></span> True <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?Q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="main">⊆</span> Collect rb_aux_inv"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="var">?Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> z_min<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">∈</span> rb_aux_term2 <span class="main">⟹</span> <span class="bound">y</span> <span class="main">∉</span> <span class="var">?Q</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> wfp_onE_min<span class="main">)</span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> bexI allI impI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">y</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">∈</span> rb_aux_term"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">y</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">∈</span> rb_aux_term2"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rb_aux_term_def<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∉</span> <span class="var">?Q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> z_min<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹rb_aux_inv <span class="skolem">y</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∉</span> <span class="skolem">Q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">∈</span> <span class="var">?Q</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="skolem">Q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> bexI allI impI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">y</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> rb_aux_term"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rb_aux_term_def<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> False <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∉</span> <span class="skolem">Q</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-rb_aux_domI"><span class="command">lemma</span></span> rb_aux_domI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span>fst <span class="free">args</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rb_aux_dom <span class="free">args</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?rel</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"rb_aux_term <span class="keyword1">&lt;*lex*&gt;</span> <span class="main">(</span><span class="main">{}</span><span class="main">::</span><span class="main">(</span>nat <span class="main">×</span> nat<span class="main">)</span> set<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> wf_rb_aux_term wf_empty <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"wf <span class="var">?rel</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">args</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>less <span class="skolem">args</span><span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">bs</span></span> <span class="skolem"><span class="skolem">ss</span></span> <span class="skolem"><span class="skolem">ps0</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> args<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">args</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="skolem">bs</span><span class="main">,</span> <span class="skolem">ss</span><span class="main">,</span> <span class="skolem">ps0</span><span class="main">)</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> prod.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ps0</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> Nil
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> args Nil <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux.domintros<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">p</span> <span class="skolem">ps</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> less<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="main">(</span><span class="main">(</span><span class="skolem">bs</span><span class="main">,</span> <span class="skolem">ss</span><span class="main">,</span> <span class="skolem">p</span> <span class="main">#</span> <span class="skolem">ps</span><span class="main">)</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?rel</span> <span class="main">⟹</span> rb_aux_inv <span class="main">(</span>fst <span class="bound">y</span><span class="main">)</span> <span class="main">⟹</span> rb_aux_dom <span class="bound">y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> args Cons<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> less<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span><span class="skolem">bs</span><span class="main">,</span> <span class="skolem">ss</span><span class="main">,</span> <span class="skolem">p</span> <span class="main">#</span> <span class="skolem">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> args Cons fst_conv<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> args Cons
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux.domintros<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"sig_crit <span class="skolem">bs</span> <span class="main">(</span>new_syz_sigs <span class="skolem">ss</span> <span class="skolem">bs</span> <span class="skolem">p</span><span class="main">)</span> <span class="skolem">p</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> 2 <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span><span class="skolem">bs</span><span class="main">,</span> <span class="main">(</span>new_syz_sigs <span class="skolem">ss</span> <span class="skolem">bs</span> <span class="skolem">p</span><span class="main">)</span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_preserved_1<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> 2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">bs</span><span class="main">,</span> <span class="main">(</span>new_syz_sigs <span class="skolem">ss</span> <span class="skolem">bs</span> <span class="skolem">p</span><span class="main">)</span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span><span class="main">,</span> <span class="skolem">bs</span><span class="main">,</span> <span class="skolem">ss</span><span class="main">,</span> <span class="skolem">p</span> <span class="main">#</span> <span class="skolem">ps</span><span class="main">)</span> <span class="main">∈</span> rb_aux_term"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rb_aux_term_def rb_aux_term2_def<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">bs</span><span class="main">,</span> <span class="main">(</span>new_syz_sigs <span class="skolem">ss</span> <span class="skolem">bs</span> <span class="skolem">p</span><span class="main">)</span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="skolem">bs</span><span class="main">,</span> <span class="skolem">ss</span><span class="main">,</span> <span class="skolem">p</span> <span class="main">#</span> <span class="skolem">ps</span><span class="main">)</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?rel</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> a <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span>fst <span class="main">(</span><span class="main">(</span><span class="skolem">bs</span><span class="main">,</span> <span class="main">(</span>new_syz_sigs <span class="skolem">ss</span> <span class="skolem">bs</span> <span class="skolem">p</span><span class="main">)</span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> fst_conv<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rb_aux_dom <span class="main">(</span><span class="main">(</span><span class="skolem">bs</span><span class="main">,</span> <span class="main">(</span>new_syz_sigs <span class="skolem">ss</span> <span class="skolem">bs</span> <span class="skolem">p</span><span class="main">)</span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 1<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="main">(</span>sig_trd <span class="skolem">bs</span> <span class="main">(</span>poly_of_pair <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> 2 <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span><span class="skolem">bs</span><span class="main">,</span> lt <span class="main">(</span>sig_trd <span class="skolem">bs</span> <span class="main">(</span>poly_of_pair <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">#</span> new_syz_sigs <span class="skolem">ss</span> <span class="skolem">bs</span> <span class="skolem">p</span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_preserved_2<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> 2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">bs</span><span class="main">,</span> lt <span class="main">(</span>sig_trd <span class="skolem">bs</span> <span class="main">(</span>poly_of_pair <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">#</span> new_syz_sigs <span class="skolem">ss</span> <span class="skolem">bs</span> <span class="skolem">p</span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span><span class="main">,</span> <span class="skolem">bs</span><span class="main">,</span> <span class="skolem">ss</span><span class="main">,</span> <span class="skolem">p</span> <span class="main">#</span> <span class="skolem">ps</span><span class="main">)</span> <span class="main">∈</span>
                      rb_aux_term"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rb_aux_term_def rb_aux_term2_def<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">bs</span><span class="main">,</span> lt <span class="main">(</span>sig_trd <span class="skolem">bs</span> <span class="main">(</span>poly_of_pair <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">#</span> new_syz_sigs <span class="skolem">ss</span> <span class="skolem">bs</span> <span class="skolem">p</span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span><span class="main">,</span> Suc <span class="skolem">z</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="skolem">bs</span><span class="main">,</span> <span class="skolem">ss</span><span class="main">,</span> <span class="skolem">p</span> <span class="main">#</span> <span class="skolem">ps</span><span class="main">)</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">∈</span>
                      <span class="var">?rel</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> a <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span>fst <span class="main">(</span><span class="main">(</span><span class="skolem">bs</span><span class="main">,</span> lt <span class="main">(</span>sig_trd <span class="skolem">bs</span> <span class="main">(</span>poly_of_pair <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">#</span> new_syz_sigs <span class="skolem">ss</span> <span class="skolem">bs</span> <span class="skolem">p</span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span><span class="main">,</span> Suc <span class="skolem">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> fst_conv<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rb_aux_dom <span class="main">(</span><span class="main">(</span><span class="skolem">bs</span><span class="main">,</span> lt <span class="main">(</span>sig_trd <span class="skolem">bs</span> <span class="main">(</span>poly_of_pair <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">#</span> new_syz_sigs <span class="skolem">ss</span> <span class="skolem">bs</span> <span class="skolem">p</span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span><span class="main">,</span> Suc <span class="skolem">z</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 1<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?args</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sig_trd <span class="skolem">bs</span> <span class="main">(</span>poly_of_pair <span class="skolem">p</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">bs</span><span class="main">,</span> new_syz_sigs <span class="skolem">ss</span> <span class="skolem">bs</span> <span class="skolem">p</span><span class="main">,</span> add_spairs <span class="skolem">ps</span> <span class="skolem">bs</span> <span class="main">(</span>sig_trd <span class="skolem">bs</span> <span class="main">(</span>poly_of_pair <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> sig_crit <span class="skolem">bs</span> <span class="main">(</span>new_syz_sigs <span class="skolem">ss</span> <span class="skolem">bs</span> <span class="skolem">p</span><span class="main">)</span> <span class="skolem">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="main">(</span>sig_trd <span class="skolem">bs</span> <span class="main">(</span>poly_of_pair <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> 2 <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="var">?args</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_preserved_3<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> 2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?args</span><span class="main">,</span> <span class="skolem">bs</span><span class="main">,</span> <span class="skolem">ss</span><span class="main">,</span> <span class="skolem">p</span> <span class="main">#</span> <span class="skolem">ps</span><span class="main">)</span> <span class="main">∈</span> rb_aux_term"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rb_aux_term_def rb_aux_term2_def rb_aux_term1_def<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="var">?args</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="skolem">bs</span><span class="main">,</span> <span class="skolem">ss</span><span class="main">,</span> <span class="skolem">p</span> <span class="main">#</span> <span class="skolem">ps</span><span class="main">)</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?rel</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> a <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span>fst <span class="main">(</span><span class="var">?args</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> fst_conv<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rb_aux_dom <span class="main">(</span><span class="var">?args</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 1<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Invariant›</span></span>

<span class="keyword1" id="Signature_Groebner-rb_aux_inv_invariant"><span class="command">lemma</span></span> rb_aux_inv_invariant<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span>fst <span class="free">args</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span>fst <span class="main">(</span>rb_aux <span class="free">args</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rb_aux_dom <span class="free">args</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_domI<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">args</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rb_aux.pinduct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">bs</span> <span class="skolem">ss</span> <span class="skolem">z</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> rb_aux.psimps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">bs</span> <span class="skolem">ss</span> <span class="skolem">p</span> <span class="skolem">ps</span> <span class="skolem">z</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> 2<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span><span class="skolem">bs</span><span class="main">,</span> <span class="skolem">ss</span><span class="main">,</span> <span class="skolem">p</span> <span class="main">#</span> <span class="skolem">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> fst_conv<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rb_aux.psimps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> 2<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">]</span></span> Let_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI impI<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"sig_crit <span class="skolem">bs</span> <span class="main">(</span>new_syz_sigs <span class="skolem">ss</span> <span class="skolem">bs</span> <span class="skolem">p</span><span class="main">)</span> <span class="skolem">p</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> * <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span><span class="skolem">bs</span><span class="main">,</span> new_syz_sigs <span class="skolem">ss</span> <span class="skolem">bs</span> <span class="skolem">p</span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_preserved_1<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span>fst <span class="main">(</span><span class="main">(</span><span class="skolem">bs</span><span class="main">,</span> new_syz_sigs <span class="skolem">ss</span> <span class="skolem">bs</span> <span class="skolem">p</span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> fst_conv<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> refl a <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span>fst <span class="main">(</span>rb_aux <span class="main">(</span><span class="main">(</span><span class="skolem">bs</span><span class="main">,</span> new_syz_sigs <span class="skolem">ss</span> <span class="skolem">bs</span> <span class="skolem">p</span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 2<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span>fst <span class="main">(</span>rb_aux <span class="main">(</span><span class="main">(</span><span class="skolem">bs</span><span class="main">,</span> new_syz_sigs <span class="skolem">ss</span> <span class="skolem">bs</span> <span class="skolem">p</span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> sig_crit <span class="skolem">bs</span> <span class="main">(</span>new_syz_sigs <span class="skolem">ss</span> <span class="skolem">bs</span> <span class="skolem">p</span><span class="main">)</span> <span class="skolem">p</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"rep_list <span class="main">(</span>sig_trd <span class="skolem">bs</span> <span class="main">(</span>poly_of_pair <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> * <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span><span class="skolem">bs</span><span class="main">,</span> lt <span class="main">(</span>sig_trd <span class="skolem">bs</span> <span class="main">(</span>poly_of_pair <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">#</span> new_syz_sigs <span class="skolem">ss</span> <span class="skolem">bs</span> <span class="skolem">p</span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_preserved_2<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span>fst <span class="main">(</span><span class="main">(</span><span class="skolem">bs</span><span class="main">,</span> lt <span class="main">(</span>sig_trd <span class="skolem">bs</span> <span class="main">(</span>poly_of_pair <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">#</span> new_syz_sigs <span class="skolem">ss</span> <span class="skolem">bs</span> <span class="skolem">p</span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span><span class="main">,</span> Suc <span class="skolem">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> fst_conv<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> refl a refl b
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span>fst <span class="main">(</span>rb_aux <span class="main">(</span><span class="main">(</span><span class="skolem">bs</span><span class="main">,</span> lt <span class="main">(</span>sig_trd <span class="skolem">bs</span> <span class="main">(</span>poly_of_pair <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">#</span> new_syz_sigs <span class="skolem">ss</span> <span class="skolem">bs</span> <span class="skolem">p</span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span><span class="main">,</span> Suc <span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 2<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?args</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sig_trd <span class="skolem">bs</span> <span class="main">(</span>poly_of_pair <span class="skolem">p</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">bs</span><span class="main">,</span> new_syz_sigs <span class="skolem">ss</span> <span class="skolem">bs</span> <span class="skolem">p</span><span class="main">,</span>
                       add_spairs <span class="skolem">ps</span> <span class="skolem">bs</span> <span class="main">(</span>sig_trd <span class="skolem">bs</span> <span class="main">(</span>poly_of_pair <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> sig_crit <span class="skolem">bs</span> <span class="main">(</span>new_syz_sigs <span class="skolem">ss</span> <span class="skolem">bs</span> <span class="skolem">p</span><span class="main">)</span> <span class="skolem">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"rep_list <span class="main">(</span>sig_trd <span class="skolem">bs</span> <span class="main">(</span>poly_of_pair <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> * <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="var">?args</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_preserved_3<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span>fst <span class="main">(</span><span class="var">?args</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> fst_conv<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> refl a refl b
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span>fst <span class="main">(</span>rb_aux <span class="main">(</span><span class="var">?args</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 2<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-rb_aux_inv_last_Nil"><span class="command">lemma</span></span> rb_aux_inv_last_Nil<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rb_aux_dom <span class="free">args</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>snd <span class="main">(</span>fst <span class="main">(</span>rb_aux <span class="free">args</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">args</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rb_aux.pinduct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">bs</span> <span class="skolem">ss</span> <span class="skolem">z</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rb_aux.psimps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">bs</span> <span class="skolem">ss</span> <span class="skolem">p</span> <span class="skolem">ps</span> <span class="skolem">z</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rb_aux.psimps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> 2<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">]</span></span> Let_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI impI<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"sig_crit <span class="skolem">bs</span> <span class="main">(</span>new_syz_sigs <span class="skolem">ss</span> <span class="skolem">bs</span> <span class="skolem">p</span><span class="main">)</span> <span class="skolem">p</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> refl <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>snd <span class="main">(</span>fst <span class="main">(</span>rb_aux <span class="main">(</span><span class="main">(</span><span class="skolem">bs</span><span class="main">,</span> new_syz_sigs <span class="skolem">ss</span> <span class="skolem">bs</span> <span class="skolem">p</span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>snd <span class="main">(</span>fst <span class="main">(</span>rb_aux <span class="main">(</span><span class="main">(</span><span class="skolem">bs</span><span class="main">,</span> new_syz_sigs <span class="skolem">ss</span> <span class="skolem">bs</span> <span class="skolem">p</span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 2<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> sig_crit <span class="skolem">bs</span> <span class="main">(</span>new_syz_sigs <span class="skolem">ss</span> <span class="skolem">bs</span> <span class="skolem">p</span><span class="main">)</span> <span class="skolem">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"rep_list <span class="main">(</span>sig_trd <span class="skolem">bs</span> <span class="main">(</span>poly_of_pair <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> refl a refl b
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>snd <span class="main">(</span>fst <span class="main">(</span>rb_aux <span class="main">(</span><span class="main">(</span><span class="skolem">bs</span><span class="main">,</span> lt <span class="main">(</span>sig_trd <span class="skolem">bs</span> <span class="main">(</span>poly_of_pair <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">#</span> new_syz_sigs <span class="skolem">ss</span> <span class="skolem">bs</span> <span class="skolem">p</span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span><span class="main">,</span> Suc <span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 2<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> sig_crit <span class="skolem">bs</span> <span class="main">(</span>new_syz_sigs <span class="skolem">ss</span> <span class="skolem">bs</span> <span class="skolem">p</span><span class="main">)</span> <span class="skolem">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"rep_list <span class="main">(</span>sig_trd <span class="skolem">bs</span> <span class="main">(</span>poly_of_pair <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> refl a refl b
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>snd <span class="main">(</span>fst <span class="main">(</span>rb_aux <span class="main">(</span><span class="main">(</span>sig_trd <span class="skolem">bs</span> <span class="main">(</span>poly_of_pair <span class="skolem">p</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">bs</span><span class="main">,</span> new_syz_sigs <span class="skolem">ss</span> <span class="skolem">bs</span> <span class="skolem">p</span><span class="main">,</span>
                                add_spairs <span class="skolem">ps</span> <span class="skolem">bs</span> <span class="main">(</span>sig_trd <span class="skolem">bs</span> <span class="main">(</span>poly_of_pair <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 2<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> rb_aux_shape<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rb_aux_dom <span class="free">args</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">bs</span> <span class="free">ss</span> <span class="free">z</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"rb_aux <span class="free">args</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">bs</span><span class="main">,</span> <span class="free">ss</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span><span class="main">,</span> <span class="free">z</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">bs</span></span> <span class="skolem"><span class="skolem">ss</span></span> <span class="skolem"><span class="skolem">ps</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"rb_aux <span class="free">args</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="skolem">bs</span><span class="main">,</span> <span class="skolem">ss</span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> prod.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>snd <span class="main">(</span>fst <span class="main">(</span>rb_aux <span class="free">args</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_last_Nil<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rb_aux <span class="free">args</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="skolem">bs</span><span class="main">,</span> <span class="skolem">ss</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-rb_aux_is_RB_upt"><span class="command">lemma</span></span> rb_aux_is_RB_upt<span class="main">:</span>
  <span class="quoted"><span class="quoted">"is_RB_upt <span class="free">dgrad</span> rword <span class="main">(</span>set <span class="main">(</span>fst <span class="main">(</span>fst <span class="main">(</span>rb_aux <span class="main">(</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span> Koszul_syz_sigs <span class="free">fs</span><span class="main">,</span> map Inr <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">fs</span><span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">u</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?args</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span> Koszul_syz_sigs <span class="free">fs</span><span class="main">,</span> map Inr <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">fs</span><span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> rb_aux_inv_init_fst <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rb_aux_dom <span class="var">?args</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_domI<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">bs</span></span> <span class="skolem"><span class="skolem">ss</span></span> <span class="skolem"><span class="skolem">z'</span></span> <span class="keyword2"><span class="keyword">where</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"rb_aux <span class="var">?args</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="skolem">bs</span><span class="main">,</span> <span class="skolem">ss</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span><span class="main">,</span> <span class="skolem">z'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_shape<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> rb_aux_inv_init_fst <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span>fst <span class="main">(</span>rb_aux <span class="var">?args</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_invariant<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span><span class="skolem">bs</span><span class="main">,</span> <span class="skolem">ss</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_RB_upt <span class="free">dgrad</span> rword <span class="main">(</span>set <span class="skolem">bs</span><span class="main">)</span> <span class="free">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_is_RB_upt<span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> rb_is_RB_upt<span class="main">:</span> <span class="quoted"><span class="quoted">"is_RB_upt <span class="free">dgrad</span> rword <span class="main">(</span>set <span class="main">(</span>fst rb<span class="main">)</span><span class="main">)</span> <span class="free">u</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> rb_aux_is_RB_upt<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="free">u</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rb_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> rb_aux_is_sig_GB_upt<span class="main">:</span>
  <span class="quoted"><span class="quoted">"is_sig_GB_upt <span class="free">dgrad</span> <span class="main">(</span>set <span class="main">(</span>fst <span class="main">(</span>fst <span class="main">(</span>rb_aux <span class="main">(</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span> Koszul_syz_sigs <span class="free">fs</span><span class="main">,</span> map Inr <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">fs</span><span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">u</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> dgrad rb_aux_is_RB_upt <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_RB_upt_is_sig_GB_upt<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> rb_aux_is_sig_GB_in<span class="main">:</span>
  <span class="quoted"><span class="quoted">"is_sig_GB_in <span class="free">dgrad</span> <span class="main">(</span>set <span class="main">(</span>fst <span class="main">(</span>fst <span class="main">(</span>rb_aux <span class="main">(</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span> Koszul_syz_sigs <span class="free">fs</span><span class="main">,</span> map Inr <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">fs</span><span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">u</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?u</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">term_of_pair</span> <span class="main">(</span>pp_of_term <span class="free">u</span><span class="main">,</span> Suc <span class="main">(</span>component_of_term <span class="free">u</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="var">?u</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ord_term_lin.le_neq_trans<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="var">?u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ord_termI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">term_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> <span class="var">?u</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">=</span> <span class="var">?u</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"component_of_term <span class="free">u</span> <span class="main">=</span> component_of_term <span class="var">?u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">term_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> rb_aux_is_sig_GB_upt <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_GB_uptD2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> rb_aux_is_Groebner_basis<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"hom_grading <span class="free">dgrad</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"punit.is_Groebner_basis <span class="main">(</span>set <span class="main">(</span>map rep_list <span class="main">(</span>fst <span class="main">(</span>fst <span class="main">(</span>rb_aux <span class="main">(</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span> Koszul_syz_sigs <span class="free">fs</span><span class="main">,</span> map Inr <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">fs</span><span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?args</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span> Koszul_syz_sigs <span class="free">fs</span><span class="main">,</span> map Inr <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">fs</span><span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> rb_aux_inv_init_fst <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rb_aux_dom <span class="var">?args</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_domI<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">bs</span></span> <span class="skolem"><span class="skolem">ss</span></span> <span class="skolem"><span class="skolem">z'</span></span> <span class="keyword2"><span class="keyword">where</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"rb_aux <span class="var">?args</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="skolem">bs</span><span class="main">,</span> <span class="skolem">ss</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span><span class="main">,</span> <span class="skolem">z'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_shape<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> rb_aux_inv_init_fst <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span>fst <span class="main">(</span>rb_aux <span class="var">?args</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_invariant<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span><span class="skolem">bs</span><span class="main">,</span> <span class="skolem">ss</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv1 <span class="skolem">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_D1<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">bs</span> <span class="main">⊆</span> dgrad_sig_set <span class="free">dgrad</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv1_D1<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>fst <span class="main">(</span>fst <span class="main">(</span>rb_aux <span class="var">?args</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> dgrad_max_set <span class="free">dgrad</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq dgrad_sig_set'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> dgrad assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.is_Groebner_basis <span class="main">(</span>rep_list <span class="main">`</span> set <span class="main">(</span>fst <span class="main">(</span>fst <span class="main">(</span>rb_aux <span class="var">?args</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> rb_aux_is_sig_GB_in <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_GB_is_Groebner_basis<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-ideal_rb_aux"><span class="command">lemma</span></span> ideal_rb_aux<span class="main">:</span>
  <span class="quoted"><span class="quoted">"ideal <span class="main">(</span>set <span class="main">(</span>map rep_list <span class="main">(</span>fst <span class="main">(</span>fst <span class="main">(</span>rb_aux <span class="main">(</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span> Koszul_syz_sigs <span class="free">fs</span><span class="main">,</span> map Inr <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">fs</span><span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
   ideal <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"ideal <span class="var">?l</span> <span class="main">=</span> ideal <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ideal <span class="var">?l</span> <span class="main">⊆</span> ideal <span class="var">?r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal.span_subset_spanI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rep_list_in_ideal<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ideal <span class="var">?r</span> <span class="main">⊆</span> ideal <span class="var">?l</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ideal.span_subset_spanI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> subsetI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> set <span class="free">fs</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">fs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="free">fs</span> <span class="main">!</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> in_set_conv_nth<span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?args</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span> Koszul_syz_sigs <span class="free">fs</span><span class="main">,</span> map Inr <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">fs</span><span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> rb_aux_inv_init_fst <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rb_aux_dom <span class="var">?args</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_domI<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">bs</span></span> <span class="skolem"><span class="skolem">ss</span></span> <span class="skolem"><span class="skolem">z'</span></span> <span class="keyword2"><span class="keyword">where</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"rb_aux <span class="var">?args</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="skolem">bs</span><span class="main">,</span> <span class="skolem">ss</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span><span class="main">,</span> <span class="skolem">z'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_shape<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> rb_aux_inv_init_fst <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span>fst <span class="main">(</span>rb_aux <span class="var">?args</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_invariant<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span><span class="skolem">bs</span><span class="main">,</span> <span class="skolem">ss</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">fs</span>›</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Inr <span class="skolem">j</span> <span class="main">∉</span> set <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="main">(</span>monomial <span class="main">1</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> ideal <span class="var">?l</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> eq set_map fst_conv <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_D9<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> ideal <span class="var">?l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rep_list_monomial' <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">fs</span>›</span></span> f<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> ideal_rb<span class="main">:</span> <span class="quoted"><span class="quoted">"ideal <span class="main">(</span>rep_list <span class="main">`</span> set <span class="main">(</span>fst rb<span class="main">)</span><span class="main">)</span> <span class="main">=</span> ideal <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ideal <span class="main">(</span>rep_list <span class="main">`</span> set <span class="main">(</span>fst rb<span class="main">)</span><span class="main">)</span> <span class="main">=</span>
        ideal <span class="main">(</span>set <span class="main">(</span>map rep_list <span class="main">(</span>fst <span class="main">(</span>fst <span class="main">(</span>rb_aux <span class="main">(</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span> Koszul_syz_sigs <span class="free">fs</span><span class="main">,</span> map Inr <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">fs</span><span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rb_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.splits<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> ideal <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> ideal_rb_aux<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> dgrad_max_set_closed_rb_aux<span class="main">:</span>
    <span class="quoted"><span class="quoted">"set <span class="main">(</span>map rep_list <span class="main">(</span>fst <span class="main">(</span>fst <span class="main">(</span>rb_aux <span class="main">(</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span> Koszul_syz_sigs <span class="free">fs</span><span class="main">,</span> map Inr <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">fs</span><span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span>
      punit_dgrad_max_set <span class="free">dgrad</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?thesis1</span></span></span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span> rb_aux_nonzero<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> set <span class="main">(</span>map rep_list <span class="main">(</span>fst <span class="main">(</span>fst <span class="main">(</span>rb_aux <span class="main">(</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span> Koszul_syz_sigs <span class="free">fs</span><span class="main">,</span> map Inr <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">fs</span><span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?thesis2</span></span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?args</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span> Koszul_syz_sigs <span class="free">fs</span><span class="main">,</span> map Inr <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">fs</span><span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> rb_aux_inv_init_fst <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rb_aux_dom <span class="var">?args</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_domI<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">bs</span></span> <span class="skolem"><span class="skolem">ss</span></span> <span class="skolem"><span class="skolem">z'</span></span> <span class="keyword2"><span class="keyword">where</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"rb_aux <span class="var">?args</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="skolem">bs</span><span class="main">,</span> <span class="skolem">ss</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span><span class="main">,</span> <span class="skolem">z'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_shape<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> rb_aux_inv_init_fst <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span>fst <span class="main">(</span>rb_aux <span class="var">?args</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_invariant<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span><span class="skolem">bs</span><span class="main">,</span> <span class="skolem">ss</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv1 <span class="skolem">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_D1<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">bs</span> <span class="main">⊆</span> dgrad_sig_set <span class="free">dgrad</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> rep_list <span class="main">`</span> set <span class="skolem">bs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv1_D1<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> rb_aux_inv1_D2<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">bs</span> <span class="main">⊆</span> dgrad_max_set <span class="free">dgrad</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dgrad_sig_set'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> dgrad <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis1</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq dgrad_max_3<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> * <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis2</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Minimality of the Computed Basis›</span></span>

<span class="keyword1" id="Signature_Groebner-rb_aux_top_irred'"><span class="command">lemma</span></span> rb_aux_top_irred'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">rword_strict</span> <span class="main">=</span> rw_rat_strict"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span><span class="free">bs</span><span class="main">,</span> <span class="free">ss</span><span class="main">,</span> <span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> sig_crit <span class="free">bs</span> <span class="main">(</span>new_syz_sigs <span class="free">ss</span> <span class="free">bs</span> <span class="free">p</span><span class="main">)</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="main">(</span>sig_trd <span class="free">bs</span> <span class="main">(</span>poly_of_pair <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rword <span class="main">=</span> rw_rat"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> rword_def rw_rat_alt<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> lt_p<span class="main">:</span> <span class="quoted"><span class="quoted">"sig_of_pair <span class="free">p</span> <span class="main">=</span> lt <span class="main">(</span>poly_of_pair <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pair_list_sig_of_pair<span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">=</span> sig_trd <span class="free">bs</span> <span class="main">(</span>poly_of_pair <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> red_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>poly_of_pair <span class="free">p</span><span class="main">)</span> <span class="skolem">p'</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> p'_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_trd_red_rtrancl<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> lt_p'<span class="main">:</span> <span class="quoted"><span class="quoted">"lt <span class="skolem">p'</span> <span class="main">=</span> sig_of_pair <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> lt_p''<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span> <span class="main"><span class="free">≼</span></span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span>poly_of_pair <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> lt_p <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_regular_rtrancl_lt<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> sig_red_rtrancl_lt_rep_list<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="skolem">p'</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="main">(=)</span> <span class="main">(=)</span> <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="skolem">p'</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="skolem">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="skolem">p'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="skolem">b</span><span class="main">)</span> <span class="keyword1">adds</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">b</span> <span class="main">=</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">b</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">p'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_red_top_addsE<span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> this<span class="main">(</span>3<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> red_p <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>punit.red <span class="main">(</span>rep_list <span class="main">`</span> set <span class="free">bs</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>rep_list <span class="main">(</span>poly_of_pair <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_red_rtrancl<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="main">(</span>poly_of_pair <span class="free">p</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> punit.rtrancl_0<span class="main">)</span>

    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> 1 2 <span class="keyword1"><span class="command">have</span></span> x1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊕</span> lt <span class="skolem">b</span> <span class="main">=</span> lt <span class="skolem">p'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> term_is_le_rel_minus x_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">b</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> sig_of_pair <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> lt_p' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> adds_termI<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword1"><span class="command">have</span></span> x2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">b</span><span class="main">)</span> <span class="main">=</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x_def adds_minus<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹rep_list <span class="skolem">b</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rep_list_zero<span class="main">)</span>

    <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum_prodE<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a0</span> <span class="skolem">b0</span>
      <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> Inl <span class="main">(</span><span class="skolem">a0</span><span class="main">,</span> <span class="skolem">b0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Inl <span class="main">(</span><span class="skolem">a0</span><span class="main">,</span> <span class="skolem">b0</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> reg<span class="main">:</span> <span class="quoted"><span class="quoted">"is_regular_spair <span class="skolem">a0</span> <span class="skolem">b0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a0</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b0</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_D3<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> inv1<span class="main">:</span> <span class="quoted"><span class="quoted">"rb_aux_inv1 <span class="free">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_D1<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> rep_list <span class="main">`</span> set <span class="free">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv1_D2<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a0</span> <span class="main">∈</span> set <span class="free">bs</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b0</span> <span class="main">∈</span> set <span class="free">bs</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="skolem">a0</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="skolem">b0</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a0</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b0</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rep_list_zero<span class="main">)</span>

      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="skolem">a0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="skolem">b0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"lcs <span class="var">?t1</span> <span class="var">?t2</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹rep_list <span class="main">(</span>poly_of_pair <span class="free">p</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.spoly <span class="main">(</span>rep_list <span class="skolem">a0</span><span class="main">)</span> <span class="main">(</span>rep_list <span class="skolem">b0</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p rep_list_spair<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹rep_list <span class="skolem">a0</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹rep_list <span class="skolem">b0</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>punit.spoly <span class="main">(</span>rep_list <span class="skolem">a0</span><span class="main">)</span> <span class="main">(</span>rep_list <span class="skolem">b0</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">≺</span></span> <span class="var">?l</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.lt_spoly_less_lcs<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b'</span></span> <span class="keyword2"><span class="keyword">where</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"is_canon_rewriter rword <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="main">(</span>sig_of_pair <span class="free">p</span><span class="main">)</span> <span class="skolem">b'</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="main">(</span>poly_of_pair <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">≺</span></span>
                      <span class="main">(</span>pp_of_term <span class="main">(</span>sig_of_pair <span class="free">p</span><span class="main">)</span> <span class="main">-</span> lp <span class="skolem">b'</span><span class="main">)</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">b'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?l</span> <span class="main">-</span> <span class="var">?t1</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">a0</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="main">(</span><span class="var">?l</span> <span class="main">-</span> <span class="var">?t2</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">b0</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sig_of_pair <span class="free">p</span> <span class="main">=</span> lt <span class="main">(</span>spair <span class="skolem">a0</span> <span class="skolem">b0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> lt_p <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> reg <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="var">?l</span> <span class="main">-</span> <span class="var">?t2</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">b0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True is_regular_spair_lt ord_term_lin.max_def<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> eq1<span class="main">:</span> <span class="quoted"><span class="quoted">"sig_of_pair <span class="free">p</span> <span class="main">=</span> <span class="main">(</span><span class="var">?l</span> <span class="main">-</span> <span class="var">?t2</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">b0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">b0</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> sig_of_pair <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> adds_termI<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_rewritable <span class="free">bs</span> <span class="skolem">b0</span> <span class="main">(</span><span class="main">(</span><span class="var">?l</span> <span class="main">-</span> <span class="var">?t2</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">b0</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p spair_sigs_def Let_def<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_canon_rewriter rword <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="main">(</span>sig_of_pair <span class="free">p</span><span class="main">)</span> <span class="skolem">b0</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> eq1<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> inv1 <span class="quoted"><span class="quoted">‹<span class="skolem">b0</span> <span class="main">∈</span> set <span class="free">bs</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b0</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> is_rewritableI_is_canon_rewriter
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="main">(</span>poly_of_pair <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> punit.lt <span class="main">(</span>punit.spoly <span class="main">(</span>rep_list <span class="skolem">a0</span><span class="main">)</span> <span class="main">(</span>rep_list <span class="skolem">b0</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p rep_list_spair<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main"><span class="free">≺</span></span> <span class="var">?l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="var">?l</span> <span class="main">-</span> <span class="var">?t2</span><span class="main">)</span> <span class="main">+</span> <span class="var">?t2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> adds_minus adds_lcs_2<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>pp_of_term <span class="main">(</span>sig_of_pair <span class="free">p</span><span class="main">)</span> <span class="main">-</span> lp <span class="skolem">b0</span><span class="main">)</span> <span class="main">+</span> <span class="var">?t2</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> eq1 pp_of_term_splus add_diff_cancel_right'<span class="main">)</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="main">(</span>poly_of_pair <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">≺</span></span> pp_of_term <span class="main">(</span>sig_of_pair <span class="free">p</span><span class="main">)</span> <span class="main">-</span> lp <span class="skolem">b0</span> <span class="main">+</span> <span class="var">?t2</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sig_of_pair <span class="free">p</span> <span class="main">=</span> lt <span class="main">(</span>spair <span class="skolem">a0</span> <span class="skolem">b0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> lt_p <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> reg <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="var">?l</span> <span class="main">-</span> <span class="var">?t1</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">a0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> False is_regular_spair_lt ord_term_lin.max_def<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> eq1<span class="main">:</span> <span class="quoted"><span class="quoted">"sig_of_pair <span class="free">p</span> <span class="main">=</span> <span class="main">(</span><span class="var">?l</span> <span class="main">-</span> <span class="var">?t1</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">a0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">a0</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> sig_of_pair <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> adds_termI<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_rewritable <span class="free">bs</span> <span class="skolem">a0</span> <span class="main">(</span><span class="main">(</span><span class="var">?l</span> <span class="main">-</span> <span class="var">?t1</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">a0</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p spair_sigs_def Let_def<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_canon_rewriter rword <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="main">(</span>sig_of_pair <span class="free">p</span><span class="main">)</span> <span class="skolem">a0</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> eq1<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> inv1 <span class="quoted"><span class="quoted">‹<span class="skolem">a0</span> <span class="main">∈</span> set <span class="free">bs</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a0</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> is_rewritableI_is_canon_rewriter
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="main">(</span>poly_of_pair <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> punit.lt <span class="main">(</span>punit.spoly <span class="main">(</span>rep_list <span class="skolem">a0</span><span class="main">)</span> <span class="main">(</span>rep_list <span class="skolem">b0</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p rep_list_spair<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main"><span class="free">≺</span></span> <span class="var">?l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="var">?l</span> <span class="main">-</span> <span class="var">?t1</span><span class="main">)</span> <span class="main">+</span> <span class="var">?t1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> adds_minus adds_lcs<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>pp_of_term <span class="main">(</span>sig_of_pair <span class="free">p</span><span class="main">)</span> <span class="main">-</span> lp <span class="skolem">a0</span><span class="main">)</span> <span class="main">+</span> <span class="var">?t1</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> eq1 pp_of_term_splus add_diff_cancel_right'<span class="main">)</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="main">(</span>poly_of_pair <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">≺</span></span> pp_of_term <span class="main">(</span>sig_of_pair <span class="free">p</span><span class="main">)</span> <span class="main">-</span> lp <span class="skolem">a0</span> <span class="main">+</span> <span class="var">?t1</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>

      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> pp_of_term <span class="main">(</span>sig_of_pair <span class="free">p</span><span class="main">)</span> <span class="main">-</span> lp <span class="skolem">b'</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> lt_p'' 4 <span class="keyword1"><span class="command">have</span></span> y2<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span> <span class="main"><span class="free">≺</span></span> <span class="skolem">y</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">b'</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> y_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ordered_powerprod_lin.le_less_trans<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> 3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">b'</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> sig_of_pair <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_canon_rewriterD3<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lp <span class="skolem">b'</span> <span class="keyword1">adds</span> lp <span class="skolem">p'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"component_of_term <span class="main">(</span>lt <span class="skolem">b'</span><span class="main">)</span> <span class="main">=</span> component_of_term <span class="main">(</span>lt <span class="skolem">p'</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> adds_term_def lt_p'<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> y1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">⊕</span> lt <span class="skolem">b'</span> <span class="main">=</span> lt <span class="skolem">p'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> y_def splus_def lt_p' adds_minus <span class="dynamic"><span class="dynamic">term_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> 3 <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> set <span class="free">bs</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹lt <span class="skolem">b</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> sig_of_pair <span class="free">p</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rword <span class="main">(</span>spp_of <span class="skolem">b</span><span class="main">)</span> <span class="main">(</span>spp_of <span class="skolem">b'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_canon_rewriterD<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="skolem">b'</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">b</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> punit.lt <span class="main">(</span>rep_list <span class="skolem">b</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">b'</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹rword <span class="main">=</span> rw_rat›</span></span> rw_rat_def Let_def spp_of_def<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="skolem">b'</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">b</span><span class="main">)</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="skolem">b</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">b'</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> splus_mono<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">y</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">b'</span><span class="main">)</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊕</span> lt <span class="skolem">b</span><span class="main">)</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">b</span><span class="main">)</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">⊕</span> lt <span class="skolem">b'</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">y</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">b'</span><span class="main">)</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">p'</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> punit.lt <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">p'</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> x1 x2 y1<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">b'</span><span class="main">)</span> <span class="main"><span class="free">≼</span></span> punit.lt <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ord_term_canc_left<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> y2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
      <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> Inr <span class="skolem">j</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">p'</span> <span class="main">=</span> <span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lt_p'<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> x1 term_of_pair_pair<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"lt <span class="skolem">b</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">b</span> <span class="main">=</span> <span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> splus_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> term_of_pair_injective plus_eq_zero_2<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">b</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_D4<span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p<span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span><span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="skolem">p'</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="skolem">p'</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="skolem">p'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_sig_red_top_tail_cases<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> sig_trd_irred <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">unfolding</span></span> p'_def <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p'_def is_sig_red_sing_reg_cases<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-rb_aux_top_irred"><span class="command">lemma</span></span> rb_aux_top_irred<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">rword_strict</span> <span class="main">=</span> rw_rat_strict"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span>fst <span class="free">args</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> set <span class="main">(</span>fst <span class="main">(</span>fst <span class="main">(</span>rb_aux <span class="free">args</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">b0</span><span class="main">.</span> <span class="bound">b0</span> <span class="main">∈</span> set <span class="main">(</span>fst <span class="main">(</span>fst <span class="free">args</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="main">(</span>set <span class="main">(</span>fst <span class="main">(</span>fst <span class="free">args</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="bound">b0</span><span class="main">}</span><span class="main">)</span> <span class="bound">b0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="main">(</span>set <span class="main">(</span>fst <span class="main">(</span>fst <span class="main">(</span>rb_aux <span class="free">args</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rb_aux_dom <span class="free">args</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_domI<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">,</span> 3<span class="main">,</span> 4<span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">args</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rb_aux.pinduct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">bs</span> <span class="skolem">ss</span> <span class="skolem">z</span><span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?nil</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">[]</span><span class="main">::</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> nat<span class="main">)</span> list"</span></span>
    <span class="keyword1"><span class="command">from</span></span> 1<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> set <span class="main">(</span>fst <span class="main">(</span>fst <span class="main">(</span><span class="main">(</span><span class="skolem">bs</span><span class="main">,</span> <span class="skolem">ss</span><span class="main">,</span> <span class="var">?nil</span><span class="main">)</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rb_aux.psimps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> 1<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="main">(</span>set <span class="main">(</span>fst <span class="main">(</span>fst <span class="main">(</span><span class="main">(</span><span class="skolem">bs</span><span class="main">,</span> <span class="skolem">ss</span><span class="main">,</span> <span class="var">?nil</span><span class="main">)</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 1<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rb_aux.psimps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> 1<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">bs</span> <span class="skolem">ss</span> <span class="skolem">p</span> <span class="skolem">ps</span> <span class="skolem">z</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> 2<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span><span class="skolem">bs</span><span class="main">,</span> <span class="skolem">ss</span><span class="main">,</span> <span class="skolem">p</span> <span class="main">#</span> <span class="skolem">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> fst_conv<span class="main">)</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">=</span> sig_trd <span class="skolem">bs</span> <span class="main">(</span>poly_of_pair <span class="skolem">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> 2<span class="main">(</span>6<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rb_aux.psimps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> 2<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">]</span></span> Let_def p'_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
      <span class="keyword1"><span class="command">note</span></span> refl
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"sig_crit <span class="skolem">bs</span> <span class="main">(</span>new_syz_sigs <span class="skolem">ss</span> <span class="skolem">bs</span> <span class="skolem">p</span><span class="main">)</span> <span class="skolem">p</span>"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> * this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span>fst <span class="main">(</span><span class="main">(</span><span class="skolem">bs</span><span class="main">,</span> new_syz_sigs <span class="skolem">ss</span> <span class="skolem">bs</span> <span class="skolem">p</span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> fst_conv <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_preserved_1<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> set <span class="main">(</span>fst <span class="main">(</span>fst <span class="main">(</span>rb_aux <span class="main">(</span><span class="main">(</span><span class="skolem">bs</span><span class="main">,</span> new_syz_sigs <span class="skolem">ss</span> <span class="skolem">bs</span> <span class="skolem">p</span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="main">(</span>set <span class="main">(</span>fst <span class="main">(</span>fst <span class="main">(</span>rb_aux <span class="main">(</span><span class="main">(</span><span class="skolem">bs</span><span class="main">,</span> new_syz_sigs <span class="skolem">ss</span> <span class="skolem">bs</span> <span class="skolem">p</span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="free">b</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> 2<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b0</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b0</span> <span class="main">∈</span> set <span class="main">(</span>fst <span class="main">(</span>fst <span class="main">(</span><span class="main">(</span><span class="skolem">bs</span><span class="main">,</span> new_syz_sigs <span class="skolem">ss</span> <span class="skolem">bs</span> <span class="skolem">p</span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b0</span> <span class="main">∈</span> set <span class="main">(</span>fst <span class="main">(</span>fst <span class="main">(</span><span class="main">(</span><span class="skolem">bs</span><span class="main">,</span> <span class="skolem">ss</span><span class="main">,</span> <span class="skolem">p</span> <span class="main">#</span> <span class="skolem">ps</span><span class="main">)</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="main">(</span>set <span class="main">(</span>fst <span class="main">(</span>fst <span class="main">(</span><span class="main">(</span><span class="skolem">bs</span><span class="main">,</span> <span class="skolem">ss</span><span class="main">,</span> <span class="skolem">p</span> <span class="main">#</span> <span class="skolem">ps</span><span class="main">)</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">b0</span><span class="main">}</span><span class="main">)</span> <span class="skolem">b0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 2<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="main">(</span>set <span class="main">(</span>fst <span class="main">(</span>fst <span class="main">(</span><span class="main">(</span><span class="skolem">bs</span><span class="main">,</span> new_syz_sigs <span class="skolem">ss</span> <span class="skolem">bs</span> <span class="skolem">p</span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">b0</span><span class="main">}</span><span class="main">)</span> <span class="skolem">b0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">note</span></span> refl
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> sig_crit <span class="skolem">bs</span> <span class="main">(</span>new_syz_sigs <span class="skolem">ss</span> <span class="skolem">bs</span> <span class="skolem">p</span><span class="main">)</span> <span class="skolem">p</span>"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> refl
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="skolem">p'</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> * this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span>fst <span class="main">(</span><span class="main">(</span><span class="skolem">bs</span><span class="main">,</span> lt <span class="skolem">p'</span> <span class="main">#</span> new_syz_sigs <span class="skolem">ss</span> <span class="skolem">bs</span> <span class="skolem">p</span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span><span class="main">,</span> Suc <span class="skolem">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> p'_def fst_conv <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_preserved_2<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> set <span class="main">(</span>fst <span class="main">(</span>fst <span class="main">(</span>rb_aux <span class="main">(</span><span class="main">(</span><span class="skolem">bs</span><span class="main">,</span> lt <span class="skolem">p'</span> <span class="main">#</span> new_syz_sigs <span class="skolem">ss</span> <span class="skolem">bs</span> <span class="skolem">p</span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span><span class="main">,</span> Suc <span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="main">(</span>set <span class="main">(</span>fst <span class="main">(</span>fst <span class="main">(</span>rb_aux <span class="main">(</span><span class="main">(</span><span class="skolem">bs</span><span class="main">,</span>
                                                        lt <span class="skolem">p'</span> <span class="main">#</span> new_syz_sigs <span class="skolem">ss</span> <span class="skolem">bs</span> <span class="skolem">p</span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span><span class="main">,</span> Suc <span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="free">b</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> 2<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">simplified</span> p'_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b0</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b0</span> <span class="main">∈</span> set <span class="main">(</span>fst <span class="main">(</span>fst <span class="main">(</span><span class="main">(</span><span class="skolem">bs</span><span class="main">,</span> lt <span class="skolem">p'</span> <span class="main">#</span> new_syz_sigs <span class="skolem">ss</span> <span class="skolem">bs</span> <span class="skolem">p</span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span><span class="main">,</span> Suc <span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b0</span> <span class="main">∈</span> set <span class="main">(</span>fst <span class="main">(</span>fst <span class="main">(</span><span class="main">(</span><span class="skolem">bs</span><span class="main">,</span> <span class="skolem">ss</span><span class="main">,</span> <span class="skolem">p</span> <span class="main">#</span> <span class="skolem">ps</span><span class="main">)</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="main">(</span>set <span class="main">(</span>fst <span class="main">(</span>fst <span class="main">(</span><span class="main">(</span><span class="skolem">bs</span><span class="main">,</span> <span class="skolem">ss</span><span class="main">,</span> <span class="skolem">p</span> <span class="main">#</span> <span class="skolem">ps</span><span class="main">)</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">b0</span><span class="main">}</span><span class="main">)</span> <span class="skolem">b0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 2<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="main">(</span>set <span class="main">(</span>fst <span class="main">(</span>fst <span class="main">(</span><span class="main">(</span><span class="skolem">bs</span><span class="main">,</span> lt <span class="skolem">p'</span> <span class="main">#</span> new_syz_sigs <span class="skolem">ss</span> <span class="skolem">bs</span> <span class="skolem">p</span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span><span class="main">,</span> Suc <span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">b0</span><span class="main">}</span><span class="main">)</span> <span class="skolem">b0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">note</span></span> refl
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> sig_crit <span class="skolem">bs</span> <span class="main">(</span>new_syz_sigs <span class="skolem">ss</span> <span class="skolem">bs</span> <span class="skolem">p</span><span class="main">)</span> <span class="skolem">p</span>"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> refl
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="skolem">p'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> * <span class="quoted"><span class="quoted">‹<span class="main">¬</span> sig_crit <span class="skolem">bs</span> <span class="main">(</span>new_syz_sigs <span class="skolem">ss</span> <span class="skolem">bs</span> <span class="skolem">p</span><span class="main">)</span> <span class="skolem">p</span>›</span></span> this
      <span class="keyword1"><span class="command">have</span></span> inv<span class="main">:</span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span>fst <span class="main">(</span><span class="main">(</span><span class="skolem">p'</span> <span class="main">#</span> <span class="skolem">bs</span><span class="main">,</span> new_syz_sigs <span class="skolem">ss</span> <span class="skolem">bs</span> <span class="skolem">p</span><span class="main">,</span> add_spairs <span class="skolem">ps</span> <span class="skolem">bs</span> <span class="skolem">p'</span><span class="main">)</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> p'_def fst_conv <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_preserved_3<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> set <span class="main">(</span>fst <span class="main">(</span>fst <span class="main">(</span>rb_aux <span class="main">(</span><span class="main">(</span><span class="skolem">p'</span> <span class="main">#</span> <span class="skolem">bs</span><span class="main">,</span> new_syz_sigs <span class="skolem">ss</span> <span class="skolem">bs</span> <span class="skolem">p</span><span class="main">,</span> add_spairs <span class="skolem">ps</span> <span class="skolem">bs</span> <span class="skolem">p'</span><span class="main">)</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="main">(</span>set <span class="main">(</span>fst <span class="main">(</span>fst <span class="main">(</span>rb_aux <span class="main">(</span><span class="main">(</span><span class="skolem">p'</span> <span class="main">#</span> <span class="skolem">bs</span><span class="main">,</span>
                                              new_syz_sigs <span class="skolem">ss</span> <span class="skolem">bs</span> <span class="skolem">p</span><span class="main">,</span> add_spairs <span class="skolem">ps</span> <span class="skolem">bs</span> <span class="skolem">p'</span><span class="main">)</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span><span class="main">)</span> <span class="free">b</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> 2<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">simplified</span> p'_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b0</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b0</span> <span class="main">∈</span> set <span class="main">(</span>fst <span class="main">(</span>fst <span class="main">(</span><span class="main">(</span><span class="skolem">p'</span> <span class="main">#</span> <span class="skolem">bs</span><span class="main">,</span> new_syz_sigs <span class="skolem">ss</span> <span class="skolem">bs</span> <span class="skolem">p</span><span class="main">,</span> add_spairs <span class="skolem">ps</span> <span class="skolem">bs</span> <span class="skolem">p'</span><span class="main">)</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b0</span> <span class="main">=</span> <span class="skolem">p'</span> <span class="main">∨</span> <span class="skolem">b0</span> <span class="main">∈</span> set <span class="skolem">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="main">(</span><span class="main">(</span><span class="main">{</span><span class="skolem">p'</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">b0</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>set <span class="skolem">bs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">b0</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="skolem">b0</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b0</span> <span class="main">=</span> <span class="skolem">p'</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="main">(</span>set <span class="skolem">bs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">b0</span><span class="main">}</span><span class="main">)</span> <span class="skolem">p'</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="main">(</span>set <span class="skolem">bs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">b0</span><span class="main">}</span><span class="main">)</span> <span class="skolem">p'</span>"</span></span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">bs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">b0</span><span class="main">}</span> <span class="main">⊆</span> set <span class="skolem">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="main">(</span>set <span class="skolem">bs</span><span class="main">)</span> <span class="skolem">p'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_red_mono<span class="main">)</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="main">(</span>set <span class="skolem">bs</span><span class="main">)</span> <span class="skolem">p'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p'_def
              <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> * <span class="quoted"><span class="quoted">‹<span class="main">¬</span> sig_crit <span class="skolem">bs</span> <span class="main">(</span>new_syz_sigs <span class="skolem">ss</span> <span class="skolem">bs</span> <span class="skolem">p</span><span class="main">)</span> <span class="skolem">p</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_top_irred'<span class="main">)</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b0</span> <span class="main">=</span> <span class="skolem">p'</span>›</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b0</span> <span class="main">∈</span> set <span class="skolem">bs</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b0</span> <span class="main">∈</span> set <span class="main">(</span>fst <span class="main">(</span>fst <span class="main">(</span><span class="main">(</span><span class="skolem">bs</span><span class="main">,</span> <span class="skolem">ss</span><span class="main">,</span> <span class="skolem">p</span> <span class="main">#</span> <span class="skolem">ps</span><span class="main">)</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="main">(</span>set <span class="main">(</span>fst <span class="main">(</span>fst <span class="main">(</span><span class="main">(</span><span class="skolem">bs</span><span class="main">,</span> <span class="skolem">ss</span><span class="main">,</span> <span class="skolem">p</span> <span class="main">#</span> <span class="skolem">ps</span><span class="main">)</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">b0</span><span class="main">}</span><span class="main">)</span> <span class="skolem">b0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 2<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="main">(</span>set <span class="skolem">bs</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">b0</span><span class="main">}</span><span class="main">)</span> <span class="skolem">b0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="main">(</span><span class="main">{</span><span class="skolem">p'</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">b0</span><span class="main">}</span><span class="main">)</span> <span class="skolem">b0</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="main">(</span><span class="main">{</span><span class="skolem">p'</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">b0</span><span class="main">}</span><span class="main">)</span> <span class="skolem">b0</span>"</span></span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">p'</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">b0</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="skolem">p'</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="main">{</span><span class="skolem">p'</span><span class="main">}</span> <span class="skolem">b0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_red_mono<span class="main">)</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">p'</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="skolem">b0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_redD_lt<span class="main">)</span>

            <span class="keyword1"><span class="command">from</span></span> inv <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span><span class="skolem">p'</span> <span class="main">#</span> <span class="skolem">bs</span><span class="main">,</span> new_syz_sigs <span class="skolem">ss</span> <span class="skolem">bs</span> <span class="skolem">p</span><span class="main">,</span> add_spairs <span class="skolem">ps</span> <span class="skolem">bs</span> <span class="skolem">p'</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> fst_conv<span class="main">)</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv1 <span class="main">(</span><span class="skolem">p'</span> <span class="main">#</span> <span class="skolem">bs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_D1<span class="main">)</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sorted_wrt <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> lt <span class="bound">y</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="skolem">p'</span> <span class="main">#</span> <span class="skolem">bs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv1_D3<span class="main">)</span>
            <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b0</span> <span class="main">∈</span> set <span class="skolem">bs</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">b0</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="skolem">p'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹lt <span class="skolem">p'</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="skolem">b0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_sig_red_Un<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="main">(</span>set <span class="main">(</span>fst <span class="main">(</span>fst <span class="main">(</span><span class="main">(</span><span class="skolem">p'</span> <span class="main">#</span> <span class="skolem">bs</span><span class="main">,</span> new_syz_sigs <span class="skolem">ss</span> <span class="skolem">bs</span> <span class="skolem">p</span><span class="main">,</span> add_spairs <span class="skolem">ps</span> <span class="skolem">bs</span> <span class="skolem">p'</span><span class="main">)</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">b0</span><span class="main">}</span><span class="main">)</span> <span class="skolem">b0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Un_Diff<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> rb_aux_is_min_sig_GB<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">rword_strict</span> <span class="main">=</span> rw_rat_strict"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_min_sig_GB <span class="free">dgrad</span> <span class="main">(</span>set <span class="main">(</span>fst <span class="main">(</span>fst <span class="main">(</span>rb_aux <span class="main">(</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span> Koszul_syz_sigs <span class="free">fs</span><span class="main">,</span> map Inr <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">fs</span><span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"is_min_sig_GB <span class="main">_</span> <span class="main">(</span>set <span class="main">(</span>fst <span class="main">(</span>fst <span class="main">(</span>rb_aux <span class="var">?args</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">unfolding</span></span> is_min_sig_GB_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI allI ballI impI<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> rb_aux_inv_init_fst <span class="keyword1"><span class="command">have</span></span> inv<span class="main">:</span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span>fst <span class="main">(</span>rb_aux <span class="var">?args</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rb_aux_dom <span class="var">?args</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_invariant<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> rb_aux_domI<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">bs</span></span> <span class="skolem"><span class="skolem">ss</span></span> <span class="skolem"><span class="skolem">z'</span></span> <span class="keyword2"><span class="keyword">where</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"rb_aux <span class="var">?args</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="skolem">bs</span><span class="main">,</span> <span class="skolem">ss</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span><span class="main">,</span> <span class="skolem">z'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_shape<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> inv <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span><span class="skolem">bs</span><span class="main">,</span> <span class="skolem">ss</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> eq fst_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv1 <span class="skolem">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_D1<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">bs</span> <span class="main">⊆</span> dgrad_sig_set <span class="free">dgrad</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv1_D1<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>fst <span class="main">(</span>fst <span class="main">(</span>rb_aux <span class="var">?args</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> dgrad_sig_set <span class="free">dgrad</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_sig_GB_in <span class="free">dgrad</span> <span class="main">(</span>set <span class="main">(</span>fst <span class="main">(</span>fst <span class="main">(</span>rb_aux <span class="var">?args</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> rb_aux_is_sig_GB_in<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">g</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> set <span class="main">(</span>fst <span class="main">(</span>fst <span class="main">(</span>rb_aux <span class="var">?args</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> rb_aux_inv_init_fst
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="main">(</span>set <span class="main">(</span>fst <span class="main">(</span>fst <span class="main">(</span>rb_aux <span class="var">?args</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">g</span><span class="main">}</span><span class="main">)</span> <span class="skolem">g</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_top_irred<span class="main">)</span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> rb_is_min_sig_GB<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">rword_strict</span> <span class="main">=</span> rw_rat_strict"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_min_sig_GB <span class="free">dgrad</span> <span class="main">(</span>set <span class="main">(</span>fst rb<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> rb_aux_is_min_sig_GB<span class="main">[</span><span class="operator">OF</span> assms<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rb_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split<span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹No Zero-Reductions›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">rb_aux_inv2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span> list <span class="main">×</span> <span class="tfree">'t</span> list <span class="main">×</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> nat<span class="main">)</span> list<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">rb_aux_inv2</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">bs</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">ss</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">)</span> <span class="main">=</span>
          <span class="main">(</span>rb_aux_inv <span class="main">(</span><span class="free"><span class="bound"><span class="entity">bs</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">ss</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span>length <span class="free">fs</span><span class="main">.</span> Inr <span class="bound">j</span> <span class="main">∉</span> set <span class="free"><span class="bound"><span class="entity">ps</span></span></span> <span class="main">⟶</span>
               <span class="main">(</span><span class="free">fs</span> <span class="main">!</span> <span class="bound">j</span> <span class="main">∈</span> ideal <span class="main">(</span>rep_list <span class="main">`</span> set <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> component_of_term <span class="main">(</span>lt <span class="bound">b</span><span class="main">)</span> <span class="main">&lt;</span> Suc <span class="bound">j</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
               <span class="main">(</span><span class="main">∀</span><span class="bound">b</span><span class="main">∈</span>set <span class="free"><span class="bound"><span class="entity">bs</span></span></span><span class="main">.</span> component_of_term <span class="main">(</span>lt <span class="bound">b</span><span class="main">)</span> <span class="main">&lt;</span> <span class="bound">j</span> <span class="main">⟶</span>
                  <span class="main">(</span><span class="main">∃</span><span class="bound">s</span><span class="main">∈</span>set <span class="free"><span class="bound"><span class="entity">ss</span></span></span><span class="main">.</span> <span class="bound">s</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">term_of_pair</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="bound">b</span><span class="main">)</span><span class="main">,</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Signature_Groebner-rb_aux_inv2_D1"><span class="command">lemma</span></span> rb_aux_inv2_D1<span class="main">:</span> <span class="quoted"><span class="quoted">"rb_aux_inv2 <span class="free">args</span> <span class="main">⟹</span> rb_aux_inv <span class="free">args</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> prod.exhaust rb_aux_inv2.simps<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-rb_aux_inv2_D2"><span class="command">lemma</span></span> rb_aux_inv2_D2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"rb_aux_inv2 <span class="main">(</span><span class="free">bs</span><span class="main">,</span> <span class="free">ss</span><span class="main">,</span> <span class="free">ps</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">j</span> <span class="main">&lt;</span> length <span class="free">fs</span> <span class="main">⟹</span> Inr <span class="free">j</span> <span class="main">∉</span> set <span class="free">ps</span> <span class="main">⟹</span>
    <span class="free">fs</span> <span class="main">!</span> <span class="free">j</span> <span class="main">∈</span> ideal <span class="main">(</span>rep_list <span class="main">`</span> set <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> component_of_term <span class="main">(</span>lt <span class="bound">b</span><span class="main">)</span> <span class="main">&lt;</span> Suc <span class="free">j</span><span class="main">)</span> <span class="free">bs</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Signature_Groebner-rb_aux_inv2_E"><span class="command">lemma</span></span> rb_aux_inv2_E<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv2 <span class="main">(</span><span class="free">bs</span><span class="main">,</span> <span class="free">ss</span><span class="main">,</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> length <span class="free">fs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Inr <span class="free">j</span> <span class="main">∉</span> set <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"component_of_term <span class="main">(</span>lt <span class="free">b</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">j</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">s</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> set <span class="free">ss</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">term_of_pair</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">b</span><span class="main">)</span><span class="main">,</span> <span class="free">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> pot<span class="main">:</span> <span class="quoted"><span class="quoted">"is_pot_ord"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Signature_Groebner-sig_red_zero_filter"><span class="command">lemma</span></span> sig_red_zero_filter<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sig_red_zero <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"component_of_term <span class="main">(</span>lt <span class="free">r</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">j</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sig_red_zero <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(</span>set <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> component_of_term <span class="main">(</span>lt <span class="bound">b</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">j</span><span class="main">)</span> <span class="free">bs</span><span class="main">)</span><span class="main">)</span> <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">=</span> <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">∨</span> <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">=</span> <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sig_red_zero <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">{</span><span class="bound"><span class="bound">b</span></span><span class="main">∈</span>set <span class="free">bs</span><span class="main">.</span> lt <span class="bound">b</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="free">r</span><span class="main">}</span> <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_zero_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">b</span></span><span class="main">∈</span>set <span class="free">bs</span><span class="main">.</span> lt <span class="bound">b</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="free">r</span><span class="main">}</span> <span class="main">⊆</span> set <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> component_of_term <span class="main">(</span>lt <span class="bound">b</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">j</span><span class="main">)</span> <span class="free">bs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">b</span></span><span class="main">∈</span>set <span class="free">bs</span><span class="main">.</span> lt <span class="bound">b</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="free">r</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">b</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">from</span></span> pot this<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"component_of_term <span class="main">(</span>lt <span class="skolem">b</span><span class="main">)</span> <span class="main">≤</span> component_of_term <span class="main">(</span>lt <span class="free">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_pot_ordD2<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">&lt;</span> <span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"component_of_term <span class="main">(</span>lt <span class="skolem">b</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> set <span class="free">bs</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> set <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> component_of_term <span class="main">(</span>lt <span class="bound">b</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">j</span><span class="main">)</span> <span class="free">bs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_zero_mono<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-rb_aux_inv2_preserved_0"><span class="command">lemma</span></span> rb_aux_inv2_preserved_0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv2 <span class="main">(</span><span class="free">bs</span><span class="main">,</span> <span class="free">ss</span><span class="main">,</span> <span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> length <span class="free">fs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Inr <span class="free">j</span> <span class="main">∉</span> set <span class="free">ps</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"component_of_term <span class="main">(</span>lt <span class="free">b</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">j</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">s</span><span class="main">∈</span>set <span class="main">(</span>new_syz_sigs <span class="free">ss</span> <span class="free">bs</span> <span class="free">p</span><span class="main">)</span><span class="main">.</span> <span class="bound">s</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">term_of_pair</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">b</span><span class="main">)</span><span class="main">,</span> <span class="free">j</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum_prodE<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
  <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> Inl <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Inr <span class="free">j</span> <span class="main">∉</span> set <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">,</span> 2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> set <span class="free">ss</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">term_of_pair</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">b</span><span class="main">)</span><span class="main">,</span> <span class="free">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">,</span> 5<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv2_E<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> set <span class="main">(</span>new_syz_sigs <span class="free">ss</span> <span class="free">bs</span> <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> * <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
  <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> Inr <span class="skolem">i</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> trans<span class="main">:</span> <span class="quoted"><span class="quoted">"transp <span class="keyword1">(adds<span class="hidden">⇩</span><sub>t</sub>)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> transpI<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule</span> adds_term_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> adds_term_refl <span class="keyword1"><span class="command">have</span></span> refl<span class="main">:</span> <span class="quoted"><span class="quoted">"reflp <span class="keyword1">(adds<span class="hidden">⇩</span><sub>t</sub>)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> reflpI<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?v</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">term_of_pair</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">b</span><span class="main">)</span><span class="main">,</span> <span class="free">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">b</span><span class="main">.</span> <span class="free">term_of_pair</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="bound">b</span><span class="main">)</span><span class="main">,</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ss'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ss'</span> <span class="main">=</span> filter_min <span class="keyword1">(adds<span class="hidden">⇩</span><sub>t</sub>)</span> <span class="main">(</span>map <span class="var">?f</span> <span class="free">bs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"new_syz_sigs <span class="free">ss</span> <span class="free">bs</span> <span class="free">p</span> <span class="main">=</span> filter_min_append <span class="keyword1">(adds<span class="hidden">⇩</span><sub>t</sub>)</span> <span class="free">ss</span> <span class="skolem">ss'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p ss'_def pot<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="free">j</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> set <span class="free">bs</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?v</span> <span class="main">∈</span> <span class="var">?f</span> <span class="main">`</span> set <span class="free">bs</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">=</span> <span class="free">j</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> imageI<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?v</span> <span class="main">∈</span> set <span class="free">ss</span> <span class="main">∪</span> set <span class="main">(</span>map <span class="var">?f</span> <span class="free">bs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?v</span> <span class="main">∈</span> set <span class="free">ss</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?v</span> <span class="main">∈</span> set <span class="free">ss</span> <span class="main">∪</span> set <span class="skolem">ss'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> trans refl <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> set <span class="main">(</span>new_syz_sigs <span class="free">ss</span> <span class="free">bs</span> <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="var">?v</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> eq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> filter_min_append_relE<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?v</span> <span class="main">∈</span> set <span class="main">(</span>map <span class="var">?f</span> <span class="free">bs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> trans refl <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> set <span class="skolem">ss'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="var">?v</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> ss'_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> filter_min_relE<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> set <span class="free">ss</span> <span class="main">∪</span> set <span class="skolem">ss'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> trans refl <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s'</span></span> <span class="keyword2"><span class="keyword">where</span></span> s'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">∈</span> set <span class="main">(</span>new_syz_sigs <span class="free">ss</span> <span class="free">bs</span> <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="skolem">s</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> eq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> filter_min_append_relE<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="var">?v</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="var">?v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> adds_term_trans<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> s' <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Inr <span class="free">j</span> <span class="main">∉</span> set <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">,</span> 2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> set <span class="free">ss</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="var">?v</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">,</span> 5<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv2_E<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> set <span class="free">ss</span> <span class="main">∪</span> set <span class="main">(</span>map <span class="var">?f</span> <span class="free">bs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> set <span class="free">ss</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> set <span class="free">ss</span> <span class="main">∪</span> set <span class="skolem">ss'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> trans refl <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s'</span></span> <span class="keyword2"><span class="keyword">where</span></span> s'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">∈</span> set <span class="main">(</span>new_syz_sigs <span class="free">ss</span> <span class="free">bs</span> <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="skolem">s</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> eq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> filter_min_append_relE<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="var">?v</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="var">?v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> adds_term_trans<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> s' <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> set <span class="main">(</span>map <span class="var">?f</span> <span class="free">bs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> trans refl <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">∈</span> set <span class="skolem">ss'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="skolem">s</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> ss'_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> filter_min_relE<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">∈</span> set <span class="free">ss</span> <span class="main">∪</span> set <span class="skolem">ss'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> trans refl <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s''</span></span> <span class="keyword2"><span class="keyword">where</span></span> s''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s''</span> <span class="main">∈</span> set <span class="main">(</span>new_syz_sigs <span class="free">ss</span> <span class="free">bs</span> <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s''</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="skolem">s'</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> eq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> filter_min_append_relE<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">s'</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="skolem">s</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s''</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> adds_term_trans<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s''</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="var">?v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="var">?v</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> adds_term_trans<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> s'' <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-rb_aux_inv2_preserved_1"><span class="command">lemma</span></span> rb_aux_inv2_preserved_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv2 <span class="main">(</span><span class="free">bs</span><span class="main">,</span> <span class="free">ss</span><span class="main">,</span> <span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"sig_crit <span class="free">bs</span> <span class="main">(</span>new_syz_sigs <span class="free">ss</span> <span class="free">bs</span> <span class="free">p</span><span class="main">)</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv2 <span class="main">(</span><span class="free">bs</span><span class="main">,</span> new_syz_sigs <span class="free">ss</span> <span class="free">bs</span> <span class="free">p</span><span class="main">,</span> <span class="free">ps</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rb_aux_inv2.simps
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI conjI impI ballI<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> inv<span class="main">:</span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span><span class="free">bs</span><span class="main">,</span> <span class="free">ss</span><span class="main">,</span> <span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv2_D1<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span><span class="free">bs</span><span class="main">,</span> new_syz_sigs <span class="free">ss</span> <span class="free">bs</span> <span class="free">p</span><span class="main">,</span> <span class="free">ps</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_preserved_1<span class="main">)</span>

  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">fs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Inr <span class="skolem">j</span> <span class="main">∉</span> set <span class="free">ps</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">fs</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">∈</span> ideal <span class="main">(</span>rep_list <span class="main">`</span> set <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> component_of_term <span class="main">(</span>lt <span class="bound">b</span><span class="main">)</span> <span class="main">&lt;</span> Suc <span class="skolem">j</span><span class="main">)</span> <span class="free">bs</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> Inr <span class="skolem">j</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_pred_syz <span class="main">(</span>new_syz_sigs <span class="free">ss</span> <span class="free">bs</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?X</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> component_of_term <span class="main">(</span>lt <span class="bound">b</span><span class="main">)</span> <span class="main">&lt;</span> Suc <span class="skolem">j</span><span class="main">)</span> <span class="free">bs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="main">(</span>monomial <span class="main">1</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> ideal <span class="main">(</span>rep_list <span class="main">`</span> <span class="var">?X</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_zero_idealI<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sig_red_zero <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="main">(</span>monomial <span class="main">1</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> syzygy_crit<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> inv <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_RB_upt <span class="free">dgrad</span> rword <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="main">(</span>sig_of_pair <span class="free">p</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_is_RB_upt_Cons<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> dgrad <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_sig_GB_upt <span class="free">dgrad</span> <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="main">(</span>sig_of_pair <span class="free">p</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_RB_upt_is_sig_GB_upt<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"is_sig_GB_upt <span class="free">dgrad</span> <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">=</span> Inr <span class="skolem">j</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"monomial <span class="main">1</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> dgrad_sig_set <span class="free">dgrad</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dgrad_sig_set_closed_monomial<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">term_simps</span></span> dgrad_max_0 <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">fs</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span>monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'b</span><span class="main">)</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lt_monomial<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword1"><span class="command">from</span></span> inv assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sig_crit' <span class="free">bs</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_crit'I_sig_crit<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"is_syz_sig <span class="free">dgrad</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">=</span> Inr <span class="skolem">j</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">fact</span> dgrad<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sig_red_zero <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="main">(</span>monomial <span class="main">1</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_zero_sing_regI<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"component_of_term <span class="main">(</span>lt <span class="main">(</span>monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'b</span><span class="main">)</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> Suc <span class="skolem">j</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lt_monomial component_of_term_of_pair<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sig_red_zero <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="var">?X</span> <span class="main">(</span>monomial <span class="main">1</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_zero_filter<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rep_list_monomial' <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">fs</span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹Inr <span class="skolem">j</span> <span class="main">∉</span> set <span class="free">ps</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Inr <span class="skolem">j</span> <span class="main">∉</span> set <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">fs</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv2_D2<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span> <span class="skolem">b</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">fs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Inr <span class="skolem">j</span> <span class="main">∉</span> set <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"component_of_term <span class="main">(</span>lt <span class="skolem">b</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">j</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">s</span><span class="main">∈</span>set <span class="main">(</span>new_syz_sigs <span class="free">ss</span> <span class="free">bs</span> <span class="free">p</span><span class="main">)</span><span class="main">.</span> <span class="bound">s</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">term_of_pair</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="skolem">b</span><span class="main">)</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv2_preserved_0<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-rb_aux_inv2_preserved_3"><span class="command">lemma</span></span> rb_aux_inv2_preserved_3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv2 <span class="main">(</span><span class="free">bs</span><span class="main">,</span> <span class="free">ss</span><span class="main">,</span> <span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> sig_crit <span class="free">bs</span> <span class="main">(</span>new_syz_sigs <span class="free">ss</span> <span class="free">bs</span> <span class="free">p</span><span class="main">)</span> <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="main">(</span>sig_trd <span class="free">bs</span> <span class="main">(</span>poly_of_pair <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv2 <span class="main">(</span>sig_trd <span class="free">bs</span> <span class="main">(</span>poly_of_pair <span class="free">p</span><span class="main">)</span> <span class="main">#</span> <span class="free">bs</span><span class="main">,</span> new_syz_sigs <span class="free">ss</span> <span class="free">bs</span> <span class="free">p</span><span class="main">,</span>
                          add_spairs <span class="free">ps</span> <span class="free">bs</span> <span class="main">(</span>sig_trd <span class="free">bs</span> <span class="main">(</span>poly_of_pair <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> inv<span class="main">:</span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span><span class="free">bs</span><span class="main">,</span> <span class="free">ss</span><span class="main">,</span> <span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv2_D1<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">=</span> sig_trd <span class="free">bs</span> <span class="main">(</span>poly_of_pair <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> sig_trd_red_rtrancl<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">bs</span></span> <span class="quoted"><span class="quoted">"poly_of_pair <span class="free">p</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">p'</span> <span class="main">=</span> lt <span class="main">(</span>poly_of_pair <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> p'_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_regular_rtrancl_lt<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sig_of_pair <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> pair_list_sig_of_pair<span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span> inv<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> lt_p'<span class="main">:</span> <span class="quoted"><span class="quoted">"lt <span class="skolem">p'</span> <span class="main">=</span> sig_of_pair <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> rb_aux_inv2.simps p'_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI conjI impI ballI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span><span class="skolem">p'</span> <span class="main">#</span> <span class="free">bs</span><span class="main">,</span> new_syz_sigs <span class="free">ss</span> <span class="free">bs</span> <span class="free">p</span><span class="main">,</span> add_spairs <span class="free">ps</span> <span class="free">bs</span> <span class="skolem">p'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> p'_def <span class="keyword1"><span class="command">using</span></span> inv assms<span class="main">(</span>2<span class="main">,</span> 3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_preserved_3<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">fs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"Inr <span class="skolem">j</span> <span class="main">∉</span> set <span class="main">(</span>add_spairs <span class="free">ps</span> <span class="free">bs</span> <span class="skolem">p'</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">fs</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">∈</span> ideal <span class="main">(</span>rep_list <span class="main">`</span> set <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> component_of_term <span class="main">(</span>lt <span class="bound">b</span><span class="main">)</span> <span class="main">&lt;</span> Suc <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span><span class="skolem">p'</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> Inr <span class="skolem">j</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?X</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> component_of_term <span class="main">(</span>lt <span class="bound">b</span><span class="main">)</span> <span class="main">&lt;</span> Suc <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span><span class="skolem">p'</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="main">(</span>monomial <span class="main">1</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> ideal <span class="main">(</span>rep_list <span class="main">`</span> <span class="var">?X</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_zero_idealI<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sig_red_zero <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(</span>set <span class="main">(</span><span class="skolem">p'</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>monomial <span class="main">1</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_zeroI<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>monomial <span class="main">1</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">p'</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> sig_trd_red_rtrancl<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">bs</span></span> <span class="quoted"><span class="quoted">"poly_of_pair <span class="free">p</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True p'_def<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="free">bs</span> <span class="main">⊆</span> set <span class="main">(</span><span class="skolem">p'</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="main">(</span>set <span class="main">(</span><span class="skolem">p'</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>monomial <span class="main">1</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">p'</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_rtrancl_mono<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sig_red <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="main">(</span>set <span class="main">(</span><span class="skolem">p'</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>monomial <span class="main">1</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">p'</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_rtrancl_sing_regI<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sig_red <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="main">(</span>set <span class="main">(</span><span class="skolem">p'</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span><span class="main">)</span> <span class="skolem">p'</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sig_red_def
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI bexI<span class="main">)</span>
            <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="skolem">p'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p'_def<span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sig_red_single <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="skolem">p'</span> <span class="main">0</span> <span class="skolem">p'</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_singleI<span class="main">)</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="skolem">p'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹rep_list <span class="skolem">p'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span> <span class="main">∈</span> keys <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.lt_in_keys<span class="main">)</span>
              <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span> <span class="main">∈</span> keys <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹rep_list <span class="skolem">p'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.lc <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.lc_not_0<span class="main">)</span>
              <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">=</span> <span class="skolem">p'</span> <span class="main">-</span> monom_mult <span class="main">(</span>lookup <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span> <span class="main">(</span><span class="main">0</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> punit.lc <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span><span class="main">)</span> <span class="main">0</span> <span class="skolem">p'</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> punit.lc_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">term_simps</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sig_red <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="main">(</span>set <span class="main">(</span><span class="skolem">p'</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>monomial <span class="main">1</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">fact</span> rep_list_zero<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"component_of_term <span class="main">(</span>lt <span class="main">(</span>monomial <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="tfree">'b</span><span class="main">)</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> Suc <span class="skolem">j</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lt_monomial component_of_term_of_pair<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sig_red_zero <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="var">?X</span> <span class="main">(</span>monomial <span class="main">1</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_zero_filter<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rep_list_monomial' <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">fs</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">from</span></span> * <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Inr <span class="skolem">j</span> <span class="main">∉</span> set <span class="free">ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_spairs_def set_merge_wrt<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Inr <span class="skolem">j</span> <span class="main">∉</span> set <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">fs</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">fs</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">∈</span> ideal <span class="main">(</span>rep_list <span class="main">`</span> set <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> component_of_term <span class="main">(</span>lt <span class="bound">b</span><span class="main">)</span> <span class="main">&lt;</span> Suc <span class="skolem">j</span><span class="main">)</span> <span class="free">bs</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv2_D2<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⊆</span> ideal <span class="main">(</span>rep_list <span class="main">`</span> set <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> component_of_term <span class="main">(</span>lt <span class="bound">b</span><span class="main">)</span> <span class="main">&lt;</span> Suc <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span><span class="skolem">p'</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ideal.span_mono image_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">b</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">fs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"component_of_term <span class="main">(</span>lt <span class="skolem">b</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">j</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Inr <span class="skolem">j</span> <span class="main">∉</span> set <span class="main">(</span>add_spairs <span class="free">ps</span> <span class="free">bs</span> <span class="skolem">p'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Inr <span class="skolem">j</span> <span class="main">∉</span> set <span class="free">ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_spairs_def set_merge_wrt<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">p'</span> <span class="main">#</span> <span class="free">bs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> <span class="skolem">p'</span> <span class="main">∨</span> <span class="skolem">b</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">s</span><span class="main">∈</span>set <span class="main">(</span>new_syz_sigs <span class="free">ss</span> <span class="free">bs</span> <span class="free">p</span><span class="main">)</span><span class="main">.</span> <span class="bound">s</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">term_of_pair</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="skolem">b</span><span class="main">)</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> <span class="skolem">p'</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> * <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"component_of_term <span class="main">(</span>sig_of_pair <span class="free">p</span><span class="main">)</span> <span class="main">&lt;</span> component_of_term <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> lt_p' component_of_term_of_pair<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> pot <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"sig_of_pair <span class="free">p</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_pot_ordD<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> inv <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Inr <span class="skolem">j</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">fs</span>›</span></span> ** <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_D6_2<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹Inr <span class="skolem">j</span> <span class="main">∉</span> set <span class="free">ps</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> Inr <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> ** <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">fs</span>›</span></span> <span class="quoted"><span class="quoted">‹Inr <span class="skolem">j</span> <span class="main">∉</span> set <span class="free">ps</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv2_preserved_0<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-rb_aux_inv2_ideal_subset"><span class="command">lemma</span></span> rb_aux_inv2_ideal_subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv2 <span class="main">(</span><span class="free">bs</span><span class="main">,</span> <span class="free">ss</span><span class="main">,</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p0</span><span class="main">.</span> <span class="bound">p0</span> <span class="main">∈</span> set <span class="free">ps</span> <span class="main">⟹</span> <span class="free">j</span> <span class="main">≤</span> component_of_term <span class="main">(</span>sig_of_pair <span class="bound">p0</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ideal <span class="main">(</span>set <span class="main">(</span>take <span class="free">j</span> <span class="free">fs</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> ideal <span class="main">(</span>rep_list <span class="main">`</span> set <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> component_of_term <span class="main">(</span>lt <span class="bound">b</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">j</span><span class="main">)</span> <span class="free">bs</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"ideal <span class="var">?B</span> <span class="main">⊆</span> ideal <span class="var">?A</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ideal.span_subset_spanI subsetI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="var">?B</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="main">(</span>take <span class="free">j</span> <span class="free">fs</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="main">(</span>take <span class="free">j</span> <span class="free">fs</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> in_set_conv_nth<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">fs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">j</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="free">fs</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">i</span> <span class="main">≤</span> <span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> ideal <span class="main">(</span>rep_list <span class="main">`</span> set <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> component_of_term <span class="main">(</span>lt <span class="bound">b</span><span class="main">)</span> <span class="main">&lt;</span> Suc <span class="skolem">i</span><span class="main">)</span> <span class="free">bs</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> f <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">fs</span>›</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv2_D2<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Inr <span class="skolem">i</span> <span class="main">∉</span> set <span class="free">ps</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Inr <span class="skolem">i</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">≤</span> component_of_term <span class="main">(</span>sig_of_pair <span class="main">(</span>Inr <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">≤</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> component_of_term_of_pair<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">j</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⊆</span> ideal <span class="var">?A</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ideal.span_mono image_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> order_less_le_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ <span class="quoted"><span class="quoted">‹Suc <span class="skolem">i</span> <span class="main">≤</span> <span class="free">j</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> ideal <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-rb_aux_inv_is_Groebner_basis"><span class="command">lemma</span></span> rb_aux_inv_is_Groebner_basis<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"hom_grading <span class="free">dgrad</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span><span class="free">bs</span><span class="main">,</span> <span class="free">ss</span><span class="main">,</span> <span class="free">ps</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p0</span><span class="main">.</span> <span class="bound">p0</span> <span class="main">∈</span> set <span class="free">ps</span> <span class="main">⟹</span> <span class="free">j</span> <span class="main">≤</span> component_of_term <span class="main">(</span>sig_of_pair <span class="bound">p0</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"punit.is_Groebner_basis <span class="main">(</span>rep_list <span class="main">`</span> set <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> component_of_term <span class="main">(</span>lt <span class="bound">b</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">j</span><span class="main">)</span> <span class="free">bs</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"punit.is_Groebner_basis <span class="main">(</span>rep_list <span class="main">`</span> set <span class="var">?bs</span><span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> dgrad assms<span class="main">(</span>1<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_GB_upt_is_Groebner_basis<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set <span class="var">?bs</span> <span class="main">⊆</span> dgrad_sig_set' <span class="free">j</span> <span class="free">dgrad</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> set <span class="var">?bs</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"component_of_term <span class="main">(</span>lt <span class="skolem">b</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> dgrad_sig_set' <span class="free">j</span> <span class="free">dgrad</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dgrad_sig_set'_def
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv1 <span class="free">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_D1<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"set <span class="free">bs</span> <span class="main">⊆</span> dgrad_sig_set <span class="free">dgrad</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv1_D1<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> set <span class="free">bs</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> dgrad_sig_set <span class="free">dgrad</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> dgrad_max_set <span class="free">dgrad</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dgrad_sig_set'_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> sig_inv_set' <span class="free">j</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sig_inv_setI'<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> keys <span class="skolem">b</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lt_max_keys<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> pot <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"component_of_term <span class="skolem">v</span> <span class="main">≤</span> component_of_term <span class="main">(</span>lt <span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_pot_ordD2<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">&lt;</span> <span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"component_of_term <span class="skolem">v</span> <span class="main">&lt;</span> <span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span>
  <span class="keyword3"><span class="command">assume</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"component_of_term <span class="skolem">u</span> <span class="main">&lt;</span> <span class="free">j</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> dgrad <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_sig_GB_upt <span class="free">dgrad</span> <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> is_RB_upt_is_sig_GB_upt<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_RB_upt <span class="free">dgrad</span> rword <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="main">(</span><span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_is_RB_upt<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">≤</span> component_of_term <span class="main">(</span>sig_of_pair <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> pot <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">j</span><span class="main">)</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> sig_of_pair <span class="skolem">p</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_pot_ord <span class="dynamic"><span class="dynamic">term_simps</span></span> zero_min<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> pot <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_pot_ordD<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> u component_of_term_of_pair<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"is_sig_GB_in <span class="free">dgrad</span> <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="skolem">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_GB_uptD2<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_sig_GB_in <span class="free">dgrad</span> <span class="main">(</span>set <span class="var">?bs</span><span class="main">)</span> <span class="skolem">u</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_GB_inI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">r</span> <span class="main">=</span> <span class="skolem">u</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> dgrad_sig_set <span class="free">dgrad</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sig_red_zero <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹lt <span class="skolem">r</span> <span class="main">=</span> <span class="skolem">u</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_GB_inD<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> u <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"component_of_term <span class="main">(</span>lt <span class="skolem">r</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹lt <span class="skolem">r</span> <span class="main">=</span> <span class="skolem">u</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sig_red_zero <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(</span>set <span class="var">?bs</span><span class="main">)</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_zero_filter<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-rb_aux_inv2_no_zero_red"><span class="command">lemma</span></span> rb_aux_inv2_no_zero_red<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"hom_grading <span class="free">dgrad</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_regular_sequence <span class="free">fs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv2 <span class="main">(</span><span class="free">bs</span><span class="main">,</span> <span class="free">ss</span><span class="main">,</span> <span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> sig_crit <span class="free">bs</span> <span class="main">(</span>new_syz_sigs <span class="free">ss</span> <span class="free">bs</span> <span class="free">p</span><span class="main">)</span> <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="main">(</span>sig_trd <span class="free">bs</span> <span class="main">(</span>poly_of_pair <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> inv<span class="main">:</span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span><span class="free">bs</span><span class="main">,</span> <span class="free">ss</span><span class="main">,</span> <span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv2_D1<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> sig_p<span class="main">:</span> <span class="quoted"><span class="quoted">"sig_of_pair <span class="free">p</span> <span class="main">=</span> lt <span class="main">(</span>poly_of_pair <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"poly_of_pair <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> p_in<span class="main">:</span> <span class="quoted"><span class="quoted">"poly_of_pair <span class="free">p</span> <span class="main">∈</span> dgrad_sig_set <span class="free">dgrad</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pair_list_sig_of_pair<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> pair_list_nonzero<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> pair_list_dgrad_sig_set<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lc <span class="main">(</span>poly_of_pair <span class="free">p</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lc_not_0<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> inv <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv1 <span class="free">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_D1<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> bs_sub<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">bs</span> <span class="main">⊆</span> dgrad_sig_set <span class="free">dgrad</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv1_D1<span class="main">)</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">=</span> sig_trd <span class="free">bs</span> <span class="main">(</span>poly_of_pair <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">=</span> component_of_term <span class="main">(</span>lt <span class="skolem">p'</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> lookup <span class="main">(</span>vectorize_poly <span class="skolem">p'</span><span class="main">)</span> <span class="skolem">j</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?bs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"filter <span class="main">(</span><span class="main">λ</span><span class="bound">b</span><span class="main">.</span> component_of_term <span class="main">(</span>lt <span class="bound">b</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">j</span><span class="main">)</span> <span class="free">bs</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?fs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span> <span class="free">fs</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">∈</span> dgrad_sig_set <span class="free">dgrad</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p'_def <span class="keyword1"><span class="command">using</span></span> dgrad bs_sub p_in sig_trd_red_rtrancl
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dgrad_sig_set_closed_sig_red_rtrancl<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">∈</span> sig_inv_set"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dgrad_sig_set'_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> lt_p'<span class="main">:</span> <span class="quoted"><span class="quoted">"lt <span class="skolem">p'</span> <span class="main">=</span> lt <span class="main">(</span>poly_of_pair <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"lc <span class="skolem">p'</span> <span class="main">=</span> lc <span class="main">(</span>poly_of_pair <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> p'_def <span class="keyword1"><span class="command">using</span></span> sig_trd_red_rtrancl
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_regular_rtrancl_lt<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> sig_red_regular_rtrancl_lc<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">‹lc <span class="main">(</span>poly_of_pair <span class="free">p</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lc_eq_zero_iff<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">p'</span> <span class="main">∈</span> keys <span class="skolem">p'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lt_in_keys<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> keys <span class="main">(</span>vectorize_poly <span class="skolem">p'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> keys_vectorize_poly j_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> q_def in_keys_iff<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p'</span> <span class="main">∈</span> sig_inv_set›</span></span> <span class="quoted"><span class="quoted">‹lt <span class="skolem">p'</span> <span class="main">∈</span> keys <span class="skolem">p'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">fs</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> j_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_inv_setD'<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> le_refl <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">fs</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">∈</span> set <span class="main">(</span>drop <span class="skolem">j</span> <span class="free">fs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nth_in_set_dropI<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> fs_distinct le_refl <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">fs</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">∉</span> set <span class="main">(</span>take <span class="skolem">j</span> <span class="free">fs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> set_take_disj_set_drop_if_distinct<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">≤</span> component_of_term <span class="main">(</span>sig_of_pair <span class="skolem">p0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p0</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">p0</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> that <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p0</span> <span class="main">=</span> <span class="free">p</span> <span class="main">∨</span> <span class="skolem">p0</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p0</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> j_def lt_p' sig_p<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p0</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> inv <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sorted_wrt pair_ord <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_D5<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Ball <span class="main">(</span>set <span class="free">ps</span><span class="main">)</span> <span class="main">(</span>pair_ord <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"pair_ord <span class="free">p</span> <span class="skolem">p0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p0</span> <span class="main">∈</span> set <span class="free">ps</span>›</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">p'</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> sig_of_pair <span class="skolem">p0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pair_ord_def lt_p' sig_p<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> pot <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_pot_ord j_def <span class="dynamic"><span class="dynamic">term_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> inv <span class="keyword1"><span class="command">have</span></span> gb<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.is_Groebner_basis <span class="main">(</span>rep_list <span class="main">`</span> set <span class="var">?bs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_is_Groebner_basis<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">∈</span> sig_inv_set' <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sig_inv_setI'<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> keys <span class="skolem">p'</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> lt <span class="skolem">p'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lt_max_keys<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> pot <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"component_of_term <span class="skolem">v</span> <span class="main">≤</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> j_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_pot_ordD2<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"component_of_term <span class="skolem">v</span> <span class="main">&lt;</span> Suc <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"keys <span class="main">(</span>vectorize_poly <span class="skolem">p'</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>Suc <span class="skolem">j</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_inv_setD<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="skolem">p'</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span>keys <span class="main">(</span>pm_of_idx_pm <span class="var">?fs</span> <span class="main">(</span>vectorize_poly <span class="skolem">p'</span><span class="main">)</span><span class="main">)</span><span class="main">.</span>
                              lookup <span class="main">(</span>pm_of_idx_pm <span class="var">?fs</span> <span class="main">(</span>vectorize_poly <span class="skolem">p'</span><span class="main">)</span><span class="main">)</span> <span class="bound">k</span> <span class="main">*</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rep_list_def ideal.rep_def pm_of_idx_pm_take<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span>set <span class="var">?fs</span><span class="main">.</span> lookup <span class="main">(</span>pm_of_idx_pm <span class="var">?fs</span> <span class="main">(</span>vectorize_poly <span class="skolem">p'</span><span class="main">)</span><span class="main">)</span> <span class="bound">k</span> <span class="main">*</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> finite_set keys_pm_of_idx_pm_subset <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum.mono_neutral_left<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_keys_iff<span class="main">)</span>

  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> 2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span>set <span class="var">?fs</span><span class="main">.</span> lookup <span class="main">(</span>pm_of_idx_pm <span class="free">fs</span> <span class="main">(</span>vectorize_poly <span class="skolem">p'</span><span class="main">)</span><span class="main">)</span> <span class="bound">k</span> <span class="main">*</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> pm_of_idx_pm_take<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> lookup <span class="main">(</span>pm_of_idx_pm <span class="free">fs</span> <span class="main">(</span>vectorize_poly <span class="skolem">p'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">fs</span> <span class="main">!</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">*</span> <span class="free">fs</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">+</span>
                    <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span>set <span class="main">(</span>take <span class="skolem">j</span> <span class="free">fs</span><span class="main">)</span><span class="main">.</span> lookup <span class="main">(</span>pm_of_idx_pm <span class="free">fs</span> <span class="main">(</span>vectorize_poly <span class="skolem">p'</span><span class="main">)</span><span class="main">)</span> <span class="bound">k</span> <span class="main">*</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">fs</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> take_Suc_conv_app_nth q_def sum.insert<span class="main"><span class="main">[</span></span><span class="operator">OF</span> finite_set 0<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">*</span> <span class="free">fs</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">+</span> <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span>set <span class="main">(</span>take <span class="skolem">j</span> <span class="free">fs</span><span class="main">)</span><span class="main">.</span> lookup <span class="main">(</span>pm_of_idx_pm <span class="free">fs</span> <span class="main">(</span>vectorize_poly <span class="skolem">p'</span><span class="main">)</span><span class="main">)</span> <span class="bound">k</span> <span class="main">*</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fs_distinct <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">fs</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> lookup_pm_of_idx_pm_distinct q_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">(</span><span class="skolem">q</span> <span class="main">*</span> <span class="free">fs</span> <span class="main">!</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span>
                          <span class="main">(</span><span class="main">∑</span><span class="bound">k</span><span class="main">∈</span>set <span class="main">(</span>take <span class="skolem">j</span> <span class="free">fs</span><span class="main">)</span><span class="main">.</span> lookup <span class="main">(</span>pm_of_idx_pm <span class="free">fs</span> <span class="main">(</span>vectorize_poly <span class="skolem">p'</span><span class="main">)</span><span class="main">)</span> <span class="bound">k</span> <span class="main">*</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_eq_0_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">(</span><span class="skolem">q</span> <span class="main">*</span> <span class="free">fs</span> <span class="main">!</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">∈</span> ideal <span class="main">(</span>set <span class="main">(</span>take <span class="skolem">j</span> <span class="free">fs</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ideal.sum_in_spanI<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="skolem">q</span> <span class="main">*</span> <span class="free">fs</span> <span class="main">!</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> ideal <span class="main">(</span>set <span class="main">(</span>take <span class="skolem">j</span> <span class="free">fs</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ideal.span_neg<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">*</span> <span class="free">fs</span> <span class="main">!</span> <span class="skolem">j</span> <span class="main">∈</span> ideal <span class="main">(</span>set <span class="main">(</span>take <span class="skolem">j</span> <span class="free">fs</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">fs</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> ideal <span class="main">(</span>set <span class="main">(</span>take <span class="skolem">j</span> <span class="free">fs</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_regular_sequenceD<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⊆</span> ideal <span class="main">(</span>rep_list <span class="main">`</span> set <span class="var">?bs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv2_ideal_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> ideal <span class="main">(</span>rep_list <span class="main">`</span> set <span class="var">?bs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">with</span></span> gb <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> rep_list <span class="main">`</span> set <span class="var">?bs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="skolem">g</span> <span class="keyword1">adds</span> punit.lt <span class="skolem">q</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.GB_adds_lt<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"component_of_term <span class="main">(</span>lt <span class="skolem">b</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> rep_list <span class="skolem">b</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">fs</span>›</span></span> _ this<span class="main">(</span>1<span class="main">,</span> 2<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">s</span><span class="main">∈</span>set <span class="main">(</span>new_syz_sigs <span class="free">ss</span> <span class="free">bs</span> <span class="free">p</span><span class="main">)</span><span class="main">.</span> <span class="bound">s</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">term_of_pair</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="skolem">b</span><span class="main">)</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv2_preserved_0<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Inr <span class="skolem">j</span> <span class="main">∉</span> set <span class="free">ps</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Inr <span class="skolem">j</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> inv <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sig_of_pair <span class="free">p</span> <span class="main">≠</span> <span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Inr_in_tailD<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">p'</span> <span class="main">≠</span> <span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lt_p' sig_p<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> inv <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sorted_wrt pair_ord <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_D5<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Ball <span class="main">(</span>set <span class="free">ps</span><span class="main">)</span> <span class="main">(</span>pair_ord <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"pair_ord <span class="free">p</span> <span class="main">(</span>Inr <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Inr <span class="skolem">j</span> <span class="main">∈</span> set <span class="free">ps</span>›</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">p'</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pair_ord_def lt_p' sig_p<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lp <span class="skolem">p'</span> <span class="main"><span class="free">≼</span></span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pot <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_pot_ord j_def <span class="dynamic"><span class="dynamic">term_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lp <span class="skolem">p'</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> zero_min <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ordered_powerprod_lin.order_antisym<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">p'</span> <span class="main">=</span> <span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> j_def term_of_pair_pair<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹lt <span class="skolem">p'</span> <span class="main">≠</span> <span class="free">term_of_pair</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> s_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> set <span class="main">(</span>new_syz_sigs <span class="free">ss</span> <span class="free">bs</span> <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">term_of_pair</span> <span class="main">(</span>punit.lt <span class="skolem">g</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> g <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">‹punit.lt <span class="skolem">g</span> <span class="keyword1">adds</span> punit.lt <span class="skolem">q</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> <span class="free">term_of_pair</span> <span class="main">(</span>punit.lt <span class="skolem">q</span><span class="main">,</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> adds_minus_splus adds_term_splus component_of_term_of_pair pp_of_term_of_pair<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> lt <span class="skolem">p'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> q_def j_def lt_lookup_vectorize <span class="dynamic"><span class="dynamic">term_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="keyword1">adds<span class="hidden">⇩</span><sub>t</sub></span> sig_of_pair <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> lt_p' sig_p<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> s_in <span class="keyword1"><span class="command">have</span></span> pred<span class="main">:</span> <span class="quoted"><span class="quoted">"is_pred_syz <span class="main">(</span>new_syz_sigs <span class="free">ss</span> <span class="free">bs</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span>sig_of_pair <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_pred_syz_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sig_crit <span class="free">bs</span> <span class="main">(</span>new_syz_sigs <span class="free">ss</span> <span class="free">bs</span> <span class="free">p</span><span class="main">)</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum_prodE<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> Inl <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> pred <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ord_term_lin.max_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> Inr <span class="skolem">i</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> pred <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> rb_aux_no_zero_red'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"hom_grading <span class="free">dgrad</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_regular_sequence <span class="free">fs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv2 <span class="main">(</span>fst <span class="free">args</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>rb_aux <span class="free">args</span><span class="main">)</span> <span class="main">=</span> snd <span class="free">args</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span>fst <span class="free">args</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv2_D1<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"rb_aux_dom <span class="free">args</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_domI<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">args</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rb_aux.pinduct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">bs</span> <span class="skolem">ss</span> <span class="skolem">z</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> rb_aux.psimps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> 1<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">bs</span> <span class="skolem">ss</span> <span class="skolem">p</span> <span class="skolem">ps</span> <span class="skolem">z</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> 2<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"rb_aux_inv2 <span class="main">(</span><span class="skolem">bs</span><span class="main">,</span> <span class="skolem">ss</span><span class="main">,</span> <span class="skolem">p</span> <span class="main">#</span> <span class="skolem">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> fst_conv<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rb_aux.psimps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> 2<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">]</span></span> Let_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI impI<span class="main">)</span>
      <span class="keyword1"><span class="command">note</span></span> refl
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"sig_crit <span class="skolem">bs</span> <span class="main">(</span>new_syz_sigs <span class="skolem">ss</span> <span class="skolem">bs</span> <span class="skolem">p</span><span class="main">)</span> <span class="skolem">p</span>"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> * this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv2 <span class="main">(</span>fst <span class="main">(</span><span class="main">(</span><span class="skolem">bs</span><span class="main">,</span> new_syz_sigs <span class="skolem">ss</span> <span class="skolem">bs</span> <span class="skolem">p</span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> fst_conv <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv2_preserved_1<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>rb_aux <span class="main">(</span><span class="main">(</span><span class="skolem">bs</span><span class="main">,</span> new_syz_sigs <span class="skolem">ss</span> <span class="skolem">bs</span> <span class="skolem">p</span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                        snd <span class="main">(</span><span class="main">(</span><span class="skolem">bs</span><span class="main">,</span> new_syz_sigs <span class="skolem">ss</span> <span class="skolem">bs</span> <span class="skolem">p</span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 2<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>rb_aux <span class="main">(</span><span class="main">(</span><span class="skolem">bs</span><span class="main">,</span> new_syz_sigs <span class="skolem">ss</span> <span class="skolem">bs</span> <span class="skolem">p</span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> snd_conv<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>rb_aux <span class="main">(</span><span class="main">(</span><span class="skolem">bs</span><span class="main">,</span> new_syz_sigs <span class="skolem">ss</span> <span class="skolem">bs</span> <span class="skolem">p</span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> sig_crit <span class="skolem">bs</span> <span class="main">(</span>new_syz_sigs <span class="skolem">ss</span> <span class="skolem">bs</span> <span class="skolem">p</span><span class="main">)</span> <span class="skolem">p</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">,</span> 2<span class="main">)</span> * <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="main">(</span>sig_trd <span class="skolem">bs</span> <span class="main">(</span>poly_of_pair <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv2_no_zero_red<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="main">(</span>sig_trd <span class="skolem">bs</span> <span class="main">(</span>poly_of_pair <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>rb_aux <span class="main">(</span><span class="main">(</span><span class="skolem">bs</span><span class="main">,</span> lt <span class="main">(</span>sig_trd <span class="skolem">bs</span> <span class="main">(</span>poly_of_pair <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">#</span>
                          new_syz_sigs <span class="skolem">ss</span> <span class="skolem">bs</span> <span class="skolem">p</span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span><span class="main">,</span> Suc <span class="skolem">z</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">=</span> sig_trd <span class="skolem">bs</span> <span class="main">(</span>poly_of_pair <span class="skolem">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">note</span></span> refl
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> sig_crit <span class="skolem">bs</span> <span class="main">(</span>new_syz_sigs <span class="skolem">ss</span> <span class="skolem">bs</span> <span class="skolem">p</span><span class="main">)</span> <span class="skolem">p</span>"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> p'_def
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"rep_list <span class="skolem">p'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv2 <span class="main">(</span>fst <span class="main">(</span><span class="main">(</span><span class="skolem">p'</span> <span class="main">#</span> <span class="skolem">bs</span><span class="main">,</span> new_syz_sigs <span class="skolem">ss</span> <span class="skolem">bs</span> <span class="skolem">p</span><span class="main">,</span> add_spairs <span class="skolem">ps</span> <span class="skolem">bs</span> <span class="skolem">p'</span><span class="main">)</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> * a b <span class="keyword1"><span class="command">unfolding</span></span> fst_conv p'_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv2_preserved_3<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>rb_aux <span class="main">(</span><span class="main">(</span><span class="skolem">p'</span> <span class="main">#</span> <span class="skolem">bs</span><span class="main">,</span> new_syz_sigs <span class="skolem">ss</span> <span class="skolem">bs</span> <span class="skolem">p</span><span class="main">,</span> add_spairs <span class="skolem">ps</span> <span class="skolem">bs</span> <span class="skolem">p'</span><span class="main">)</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
            snd <span class="main">(</span><span class="main">(</span><span class="skolem">p'</span> <span class="main">#</span> <span class="skolem">bs</span><span class="main">,</span> new_syz_sigs <span class="skolem">ss</span> <span class="skolem">bs</span> <span class="skolem">p</span><span class="main">,</span> add_spairs <span class="skolem">ps</span> <span class="skolem">bs</span> <span class="skolem">p'</span><span class="main">)</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 2<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>rb_aux <span class="main">(</span><span class="main">(</span><span class="skolem">p'</span> <span class="main">#</span> <span class="skolem">bs</span><span class="main">,</span> new_syz_sigs <span class="skolem">ss</span> <span class="skolem">bs</span> <span class="skolem">p</span><span class="main">,</span> add_spairs <span class="skolem">ps</span> <span class="skolem">bs</span> <span class="skolem">p'</span><span class="main">)</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">z</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> snd_conv<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> rb_aux_no_zero_red<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"hom_grading <span class="free">dgrad</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_regular_sequence <span class="free">fs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>rb_aux <span class="main">(</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span> Koszul_syz_sigs <span class="free">fs</span><span class="main">,</span> map Inr <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">fs</span><span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?args</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">[]</span><span class="main">::</span><span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span> list<span class="main">,</span> Koszul_syz_sigs <span class="free">fs</span><span class="main">,</span>
                  <span class="main">(</span>map Inr <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">fs</span><span class="main">]</span><span class="main">)</span><span class="main">::</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> nat<span class="main">)</span> list<span class="main">)</span><span class="main">,</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> rb_aux_inv_init <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv2 <span class="main">(</span>fst <span class="var">?args</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>rb_aux <span class="var">?args</span><span class="main">)</span> <span class="main">=</span> snd <span class="var">?args</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_no_zero_red'<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> snd_conv<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> rb_no_zero_red<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"hom_grading <span class="free">dgrad</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_regular_sequence <span class="free">fs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"snd rb <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> rb_aux_no_zero_red<span class="main">[</span><span class="operator">OF</span> assms<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rb_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Sig-Poly-Pairs›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We now prove that the algorithms defined for sig-poly-pairs (i.\,e. those whose names end with
  <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>_spp›</span></span></span></span>) behave exactly as those defined for module elements. More precisely, if <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>A›</span></span></span></span> is some
  algorithm defined for module elements, we prove something like
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">prop</span></span> <span class="quoted"><span class="quoted">"spp_of <span class="main"><span class="main">(</span></span><span class="free"><span class="free">A</span></span> <span class="free"><span class="free">x</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">=</span></span> <span class="free"><span class="free">A_spp</span></span> <span class="main"><span class="main">(</span></span>spp_of <span class="free"><span class="free">x</span></span><span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">spp_inv_pair</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> nat<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">spp_inv_pair</span> <span class="main">(</span>Inl <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>spp_inv <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">∧</span> spp_inv <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">spp_inv_pair</span> <span class="main">(</span>Inr <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span> <span class="main">=</span> True"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">app_pair</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒</span> <span class="tfree">'y</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">×</span> <span class="tfree">'x</span><span class="main">)</span> <span class="main">+</span> nat<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'y</span> <span class="main">×</span> <span class="tfree">'y</span><span class="main">)</span> <span class="main">+</span> nat<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">app_pair</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span>Inl <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Inl <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">app_pair</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span>Inr <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">)</span> <span class="main">=</span> Inr <span class="free"><span class="bound"><span class="entity">j</span></span></span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">app_args</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'x</span> <span class="main">⇒</span> <span class="tfree">'y</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'x</span> list <span class="main">×</span> <span class="tfree">'z</span> <span class="main">×</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'x</span> <span class="main">×</span> <span class="tfree">'x</span><span class="main">)</span> <span class="main">+</span> nat<span class="main">)</span> list<span class="main">)</span><span class="main">)</span> <span class="main">×</span> nat<span class="main">)</span> <span class="main">⇒</span>
                     <span class="main">(</span><span class="main">(</span><span class="tfree">'y</span> list <span class="main">×</span> <span class="tfree">'z</span> <span class="main">×</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'y</span> <span class="main">×</span> <span class="tfree">'y</span><span class="main">)</span> <span class="main">+</span> nat<span class="main">)</span> list<span class="main">)</span><span class="main">)</span> <span class="main">×</span> nat<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">app_args</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">as</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">)</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>map <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">as</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span><span class="main">,</span> map <span class="main">(</span>app_pair <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span><span class="main">)</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Signature_Groebner-app_pair_spp_of_vec_of"><span class="command">lemma</span></span> app_pair_spp_of_vec_of<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"spp_inv_pair <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"app_pair spp_of <span class="main">(</span>app_pair vec_of <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum_prodE<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
  <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> Inl <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"spp_inv <span class="skolem">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"spp_inv <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p spp_of_vec_of<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Signature_Groebner-map_app_pair_spp_of_vec_of"><span class="command">lemma</span></span> map_app_pair_spp_of_vec_of<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"list_all spp_inv_pair <span class="free">ps</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span>app_pair spp_of <span class="main">∘</span> app_pair vec_of<span class="main">)</span> <span class="free">ps</span> <span class="main">=</span> <span class="free">ps</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> map_idI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"spp_inv_pair <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_all_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"app_pair spp_of <span class="main">(</span>app_pair vec_of <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> app_pair_spp_of_vec_of<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>app_pair spp_of <span class="main">∘</span> app_pair vec_of<span class="main">)</span> <span class="skolem">p</span> <span class="main">=</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-snd_app_args"><span class="command">lemma</span></span> snd_app_args<span class="main">:</span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>app_args <span class="free">f</span> <span class="free">args</span><span class="main">)</span> <span class="main">=</span> snd <span class="free">args</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> prod.exhaust app_args.simps snd_conv<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-new_syz_sigs_alt_spp"><span class="command">lemma</span></span> new_syz_sigs_alt_spp<span class="main">:</span>
  <span class="quoted"><span class="quoted">"new_syz_sigs <span class="free">ss</span> <span class="free">bs</span> <span class="free">p</span> <span class="main">=</span> new_syz_sigs_spp <span class="free">ss</span> <span class="main">(</span>map spp_of <span class="free">bs</span><span class="main">)</span> <span class="main">(</span>app_pair spp_of <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum_prodE<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> Inl <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> Inr <span class="skolem">j</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_def spp_of_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-is_rewritable_alt_spp"><span class="command">lemma</span></span> is_rewritable_alt_spp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> set <span class="free">bs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_rewritable <span class="free">bs</span> <span class="free">p</span> <span class="free">u</span> <span class="main">=</span> is_rewritable_spp <span class="main">(</span>map spp_of <span class="free">bs</span><span class="main">)</span> <span class="main">(</span>spp_of <span class="free">p</span><span class="main">)</span> <span class="free">u</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> set <span class="free">bs</span> <span class="main">⟹</span> <span class="skolem">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">b</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_rewritable_def is_rewritable_spp_def fst_spp_of<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-spair_sigs_alt_spp"><span class="command">lemma</span></span> spair_sigs_alt_spp<span class="main">:</span> <span class="quoted"><span class="quoted">"spair_sigs <span class="free">p</span> <span class="free">q</span> <span class="main">=</span> spair_sigs_spp <span class="main">(</span>spp_of <span class="free">p</span><span class="main">)</span> <span class="main">(</span>spp_of <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> spair_sigs_def spair_sigs_spp_def Let_def fst_spp_of snd_spp_of<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-sig_crit_alt_spp"><span class="command">lemma</span></span> sig_crit_alt_spp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> set <span class="free">bs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sig_crit <span class="free">bs</span> <span class="free">ss</span> <span class="free">p</span> <span class="main">=</span> sig_crit_spp <span class="main">(</span>map spp_of <span class="free">bs</span><span class="main">)</span> <span class="free">ss</span> <span class="main">(</span>app_pair spp_of <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum_prodE<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
  <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> Inl <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p spair_sigs_alt_spp is_rewritable_alt_spp<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Signature_Groebner-spair_alt_spp"><span class="command">lemma</span></span> spair_alt_spp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_regular_spair <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"spp_of <span class="main">(</span>spair <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> spair_spp <span class="main">(</span>spp_of <span class="free">p</span><span class="main">)</span> <span class="main">(</span>spp_of <span class="free">q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"lcs <span class="var">?t1</span> <span class="var">?t2</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"rep_list <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"rep_list <span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_regular_spairD1<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> is_regular_spairD2<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.lc <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.lc <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rep_list_zero punit.lc_eq_zero_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span>monom_mult <span class="main">(</span><span class="main">1</span> <span class="main">/</span> punit.lc <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="var">?l</span> <span class="main">-</span> <span class="var">?t1</span><span class="main">)</span> <span class="free">p</span><span class="main">)</span> <span class="main">≠</span>
                    lt <span class="main">(</span>monom_mult <span class="main">(</span><span class="main">1</span> <span class="main">/</span> punit.lc <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="var">?l</span> <span class="main">-</span> <span class="var">?t2</span><span class="main">)</span> <span class="free">q</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?u</span> <span class="main">≠</span> <span class="var">?v</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_regular_spairD3<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span>monom_mult <span class="main">(</span><span class="main">1</span> <span class="main">/</span> punit.lc <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="var">?l</span> <span class="main">-</span> <span class="var">?t1</span><span class="main">)</span> <span class="free">p</span> <span class="main">-</span> monom_mult <span class="main">(</span><span class="main">1</span> <span class="main">/</span> punit.lc <span class="main">(</span>rep_list <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="var">?l</span> <span class="main">-</span> <span class="var">?t2</span><span class="main">)</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span>
          ord_term_lin.max <span class="var">?u</span> <span class="var">?v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lt_minus_distinct_eq_max<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?u</span> <span class="main">=</span> <span class="main">(</span><span class="var">?l</span> <span class="main">-</span> <span class="var">?t1</span><span class="main">)</span> <span class="main">⊕</span> fst <span class="main">(</span>spp_of <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lt_monom_mult fst_spp_of<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> 2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?v</span> <span class="main">=</span> <span class="main">(</span><span class="var">?l</span> <span class="main">-</span> <span class="var">?t2</span><span class="main">)</span> <span class="main">⊕</span> fst <span class="main">(</span>spp_of <span class="free">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lt_monom_mult fst_spp_of<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> spair_spp_def spair_def Let_def spp_of_def rep_list_minus rep_list_monom_mult<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-sig_trd_spp_body_alt_Some"><span class="command">lemma</span></span> sig_trd_spp_body_alt_Some<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"find_sig_reducer <span class="main">(</span>map spp_of <span class="free">bs</span><span class="main">)</span> <span class="free">v</span> <span class="main">(</span>punit.lt <span class="free">p</span><span class="main">)</span> <span class="main">0</span> <span class="main">=</span> Some <span class="free">i</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sig_trd_spp_body <span class="main">(</span>map spp_of <span class="free">bs</span><span class="main">)</span> <span class="free">v</span> <span class="main">(</span><span class="free">p</span><span class="main">,</span> <span class="free">r</span><span class="main">)</span> <span class="main">=</span>
          <span class="main">(</span>punit.lower <span class="main">(</span><span class="free">p</span> <span class="main">-</span> local.punit.monom_mult <span class="main">(</span>punit.lc <span class="free">p</span> <span class="main">/</span> punit.lc <span class="main">(</span>rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                  <span class="main">(</span>punit.lt <span class="free">p</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>punit.lt <span class="free">p</span><span class="main">)</span><span class="main">,</span> <span class="free">r</span><span class="main">)</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?thesis1</span></span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"sig_trd_spp_body <span class="main">(</span>map spp_of <span class="free">bs</span><span class="main">)</span> <span class="free">v</span> <span class="main">(</span><span class="free">p</span><span class="main">,</span> <span class="free">r</span><span class="main">)</span> <span class="main">=</span>
          <span class="main">(</span><span class="free">p</span> <span class="main">-</span> local.punit.monom_mult <span class="main">(</span>punit.lc <span class="free">p</span> <span class="main">/</span> punit.lc <span class="main">(</span>rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                  <span class="main">(</span>punit.lt <span class="free">p</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="free">r</span><span class="main">)</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?thesis2</span></span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?thesis1</span> <span class="main">∧</span> <span class="var">?thesis2</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="free">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> find_sig_reducer_SomeD<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> eq1<span class="main">:</span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>map spp_of <span class="free">bs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> snd_spp_of<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">adds</span> punit.lt <span class="free">p</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> find_sig_reducer_SomeD<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">hence</span></span> nz<span class="main">:</span> <span class="quoted"><span class="quoted">"rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> adds<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">adds</span> punit.lt <span class="free">p</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> snd_spp_of<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> nz <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.lc <span class="main">(</span>rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.lc_not_0<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> False <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.lc <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.lc_not_0<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> eq2<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>punit.monom_mult <span class="main">(</span>punit.lc <span class="free">p</span> <span class="main">/</span> punit.lc <span class="main">(</span>rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                        <span class="main">(</span>punit.lt <span class="free">p</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> punit.lt <span class="free">p</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="var">?p</span> <span class="main">=</span> <span class="main">_</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> nz adds <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lp_monom_mult adds_minus<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis1</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms Let_def eq1 punit.lower_minus punit.tail_monom_mult<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
                      <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> punit.tail_def eq2<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis2</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?thesis1</span>›</span></span> punit.lower_id_iff disj_commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="var">?p</span>"</span></span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> sig_trd_spp_body.simps<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="var">?p</span><span class="main">)</span> <span class="main"><span class="free">≺</span></span> punit.lt <span class="free">p</span> <span class="main">∨</span> <span class="free">p</span> <span class="main">=</span> <span class="var">?p</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> disjCI<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="var">?p</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">-</span> <span class="var">?p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> eq2
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹punit.lc <span class="main">(</span>rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.lc <span class="var">?p</span> <span class="main">=</span> punit.lc <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="var">?p</span><span class="main">)</span> <span class="main"><span class="free">≺</span></span> punit.lt <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.lt_minus_lessI<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis1</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?thesis2</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-sig_trd_aux_alt_spp"><span class="command">lemma</span></span> sig_trd_aux_alt_spp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"fst <span class="free">args</span> <span class="main">∈</span> keys <span class="main">(</span>rep_list <span class="main">(</span>snd <span class="free">args</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="main">(</span>sig_trd_aux <span class="free">bs</span> <span class="free">args</span><span class="main">)</span> <span class="main">=</span>
              sig_trd_spp_aux <span class="main">(</span>map spp_of <span class="free">bs</span><span class="main">)</span> <span class="main">(</span>lt <span class="main">(</span>snd <span class="free">args</span><span class="main">)</span><span class="main">)</span>
                <span class="main">(</span>rep_list <span class="main">(</span>snd <span class="free">args</span><span class="main">)</span> <span class="main">-</span> punit.higher <span class="main">(</span>rep_list <span class="main">(</span>snd <span class="free">args</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fst <span class="free">args</span><span class="main">)</span><span class="main">,</span>
                 punit.higher <span class="main">(</span>rep_list <span class="main">(</span>snd <span class="free">args</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fst <span class="free">args</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sig_trd_aux_dom <span class="free">bs</span> <span class="free">args</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_trd_aux_domI<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">args</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> sig_trd_aux.pinduct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">t</span> <span class="skolem">p</span><span class="main">)</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> find_sig_reducer <span class="main">(</span>map spp_of <span class="free">bs</span><span class="main">)</span> <span class="main">(</span>lt <span class="skolem">p</span><span class="main">)</span> <span class="skolem">t</span> <span class="main">0</span> <span class="keyword1">of</span>
                              None <span class="main">⇒</span> <span class="skolem">p</span>
                            <span class="main">|</span> Some <span class="bound">i</span> <span class="main">⇒</span> <span class="skolem">p</span> <span class="main">-</span>
                                monom_mult <span class="main">(</span>lookup <span class="main">(</span>rep_list <span class="skolem">p</span><span class="main">)</span> <span class="skolem">t</span> <span class="main">/</span> punit.lc <span class="main">(</span>rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                                 <span class="main">(</span><span class="skolem">t</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p''</span> <span class="main">=</span> punit.lower <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span> <span class="skolem">t</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> 1<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> t_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> keys <span class="main">(</span>rep_list <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> keys <span class="main">(</span>rep_list <span class="skolem">p</span> <span class="main">-</span> punit.higher <span class="main">(</span>rep_list <span class="skolem">p</span><span class="main">)</span> <span class="skolem">t</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">∈</span> keys <span class="var">?p</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> punit.keys_minus_higher<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> eq1<span class="main">:</span> <span class="quoted"><span class="quoted">"sig_trd_spp_aux <span class="skolem">bs0</span> <span class="skolem">v0</span> <span class="main">(</span><span class="var">?p</span><span class="main">,</span> <span class="skolem">r0</span><span class="main">)</span> <span class="main">=</span> sig_trd_spp_aux <span class="skolem">bs0</span> <span class="skolem">v0</span> <span class="main">(</span>sig_trd_spp_body <span class="skolem">bs0</span> <span class="skolem">v0</span> <span class="main">(</span><span class="var">?p</span><span class="main">,</span> <span class="skolem">r0</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">bs0</span> <span class="skolem">v0</span> <span class="skolem">r0</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sig_trd_spp_aux_simps <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> sig_trd_spp_body.simps<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> t_in <span class="keyword1"><span class="command">have</span></span> lt_p<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.lt <span class="var">?p</span> <span class="main">=</span> <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> lc_p<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.lc <span class="var">?p</span> <span class="main">=</span> lookup <span class="main">(</span>rep_list <span class="skolem">p</span><span class="main">)</span> <span class="skolem">t</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> tail_p<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.tail <span class="var">?p</span> <span class="main">=</span> punit.lower <span class="main">(</span>rep_list <span class="skolem">p</span><span class="main">)</span> <span class="skolem">t</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.lt_minus_higher<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> punit.lc_minus_higher<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> punit.tail_minus_higher<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="skolem">p'</span> <span class="main">=</span> lt <span class="skolem">p</span> <span class="main">∧</span> punit.higher <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span> <span class="skolem">t</span> <span class="main">=</span> punit.higher <span class="main">(</span>rep_list <span class="skolem">p</span><span class="main">)</span> <span class="skolem">t</span> <span class="main">∧</span>
          <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> find_sig_reducer <span class="main">(</span>map spp_of <span class="free">bs</span><span class="main">)</span> <span class="main">(</span>lt <span class="skolem">p</span><span class="main">)</span> <span class="skolem">t</span> <span class="main">0</span> <span class="main">=</span> Some <span class="bound">i</span> <span class="main">⟶</span> lookup <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span> <span class="skolem">t</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">∧</span> <span class="var">?B</span> <span class="main">∧</span> <span class="var">?C</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"find_sig_reducer <span class="main">(</span>map spp_of <span class="free">bs</span><span class="main">)</span> <span class="main">(</span>lt <span class="skolem">p</span><span class="main">)</span> <span class="skolem">t</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> None
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p'_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Some <span class="skolem">i</span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> p'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">=</span> <span class="skolem">p</span> <span class="main">-</span> monom_mult <span class="main">(</span>lookup <span class="main">(</span>rep_list <span class="skolem">p</span><span class="main">)</span> <span class="skolem">t</span> <span class="main">/</span> punit.lc <span class="main">(</span>rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                            <span class="main">(</span><span class="skolem">t</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p'_def<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> Some <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">adds</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> find_sig_reducer_SomeD<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> adds_minus<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> t_in Some <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"sig_red_single <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="skolem">p</span> <span class="skolem">p'</span> <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> p' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> find_sig_reducer_SomeD_red_single<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.red_single <span class="main">(</span>rep_list <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span> <span class="main">(</span>rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_single_red_single<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> * <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_single_regular_lt<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> punit.red_single_higher<span class="main">[</span><span class="operator">OF</span> **<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI impI<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> punit.red_single_lookup<span class="main">[</span><span class="operator">OF</span> **<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lookup <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span> <span class="skolem">t</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">hence</span></span> lt_p'<span class="main">:</span> <span class="quoted"><span class="quoted">"lt <span class="skolem">p'</span> <span class="main">=</span> lt <span class="skolem">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> higher_p'<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.higher <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span> <span class="skolem">t</span> <span class="main">=</span> punit.higher <span class="main">(</span>rep_list <span class="skolem">p</span><span class="main">)</span> <span class="skolem">t</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> lookup_p'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> find_sig_reducer <span class="main">(</span>map spp_of <span class="free">bs</span><span class="main">)</span> <span class="main">(</span>lt <span class="skolem">p</span><span class="main">)</span> <span class="skolem">t</span> <span class="main">0</span> <span class="main">=</span> Some <span class="bound">i</span> <span class="main">⟹</span> lookup <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span> <span class="skolem">t</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sig_trd_aux.psimps<span class="main"><span class="main">[</span></span><span class="operator">OF</span> 1<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">]</span></span> Let_def p'_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> p''_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI impI<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p''</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> p'_decomp<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.higher <span class="main">(</span>rep_list <span class="skolem">p</span><span class="main">)</span> <span class="skolem">t</span> <span class="main">+</span> monomial <span class="main">(</span>lookup <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span> <span class="skolem">t</span><span class="main">)</span> <span class="skolem">t</span> <span class="main">=</span> rep_list <span class="skolem">p'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> punit.higher_lower_decomp<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"rep_list <span class="skolem">p'</span>"</span></span> <span class="quoted"><span class="skolem">t</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p''_def higher_p'<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="skolem">p'</span> <span class="main">=</span> sig_trd_spp_aux <span class="main">(</span>map spp_of <span class="free">bs</span><span class="main">)</span> <span class="main">(</span>lt <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span><span class="var">?p</span><span class="main">,</span> punit.higher <span class="main">(</span>rep_list <span class="skolem">p</span><span class="main">)</span> <span class="skolem">t</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"find_sig_reducer <span class="main">(</span>map spp_of <span class="free">bs</span><span class="main">)</span> <span class="main">(</span>lt <span class="skolem">p</span><span class="main">)</span> <span class="skolem">t</span> <span class="main">0</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> None
        <span class="keyword1"><span class="command">hence</span></span> p'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">=</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p'_def<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p''</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> eq2<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.tail <span class="var">?p</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tail_p p''_def p'<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> p'_decomp <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p' eq1 lt_p lc_p None eq2 sig_trd_spp_aux_simps<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Some <span class="skolem">i</span><span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> p'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">=</span> <span class="skolem">p</span> <span class="main">-</span> monom_mult <span class="main">(</span>lookup <span class="main">(</span>rep_list <span class="skolem">p</span><span class="main">)</span> <span class="skolem">t</span> <span class="main">/</span> punit.lc <span class="main">(</span>rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                            <span class="main">(</span><span class="skolem">t</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p'_def<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p''</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> eq2<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.lower <span class="main">(</span>rep_list <span class="skolem">p</span> <span class="main">-</span> punit.higher <span class="main">(</span>rep_list <span class="skolem">p</span><span class="main">)</span> <span class="skolem">t</span> <span class="main">-</span>
                punit.monom_mult <span class="main">(</span>lookup <span class="main">(</span>rep_list <span class="skolem">p</span><span class="main">)</span> <span class="skolem">t</span> <span class="main">/</span> punit.lc <span class="main">(</span>rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                  <span class="main">(</span><span class="skolem">t</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                <span class="skolem">t</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p''_def p' rep_list_minus rep_list_monom_mult punit.lower_minus punit.lower_higher_zeroI<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> Some <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lookup <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span> <span class="skolem">t</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lookup_p'<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> p'_decomp <span class="keyword1"><span class="command">have</span></span> eq3<span class="main">:</span> <span class="quoted"><span class="quoted">"rep_list <span class="skolem">p'</span> <span class="main">=</span> punit.higher <span class="main">(</span>rep_list <span class="skolem">p</span><span class="main">)</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sig_trd_spp_body_alt_Some<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> eq1 eq2 lt_p lc_p Some <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> sig_trd_spp_body.simps<span class="main"><span class="keyword3">,</span></span>
                         <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sig_trd_spp_aux_simps eq3<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p''</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="skolem">p''</span> <span class="main"><span class="free">≺</span></span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p''_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.lt_lower_less<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> higher_p'_2<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.higher <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span> <span class="main">(</span>punit.lt <span class="skolem">p''</span><span class="main">)</span> <span class="main">=</span>
                          punit.higher <span class="main">(</span>rep_list <span class="skolem">p</span><span class="main">)</span> <span class="skolem">t</span> <span class="main">+</span> monomial <span class="main">(</span>lookup <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span> <span class="skolem">t</span><span class="main">)</span> <span class="skolem">t</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> higher_p'<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> poly_mapping_eqI<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lookup <span class="main">(</span>punit.higher <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span> <span class="main">(</span>punit.lt <span class="skolem">p''</span><span class="main">)</span><span class="main">)</span> <span class="skolem">s</span> <span class="main">=</span>
              lookup <span class="main">(</span>punit.higher <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span> <span class="skolem">t</span> <span class="main">+</span> monomial <span class="main">(</span>lookup <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span> <span class="skolem">t</span><span class="main">)</span> <span class="skolem">t</span><span class="main">)</span> <span class="skolem">s</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ordered_powerprod_lin.linorder_cases<span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main"><span class="free">≺</span></span> <span class="skolem">s</span>"</span></span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹punit.lt <span class="skolem">p''</span> <span class="main"><span class="free">≺</span></span> <span class="skolem">t</span>›</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="skolem">p''</span> <span class="main"><span class="free">≺</span></span> <span class="skolem">s</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ordered_powerprod_lin.less_trans<span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lookup_add punit.lookup_higher_when lookup_single<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> <span class="skolem">s</span>"</span></span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹punit.lt <span class="skolem">p''</span> <span class="main"><span class="free">≺</span></span> <span class="skolem">t</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lookup_add punit.lookup_higher_when<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main"><span class="free">≺</span></span> <span class="skolem">t</span>"</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"punit.lt <span class="skolem">p''</span> <span class="main"><span class="free">≺</span></span> <span class="skolem">s</span>"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lookup <span class="main">(</span>punit.higher <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span> <span class="main">(</span>punit.lt <span class="skolem">p''</span><span class="main">)</span><span class="main">)</span> <span class="skolem">s</span> <span class="main">=</span> lookup <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span> <span class="skolem">s</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> punit.lookup_higher_when<span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main"><span class="free">≺</span></span> <span class="skolem">t</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> lookup <span class="skolem">p''</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p''_def punit.lookup_lower_when<span class="main">)</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> True <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> punit.lt_le_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main"><span class="free">≺</span></span> <span class="skolem">t</span>›</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lookup_add lookup_single punit.lookup_higher_when<span class="main">)</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main"><span class="free">≺</span></span> <span class="skolem">t</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lookup_add punit.lookup_higher_when lookup_single<span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="main">(</span>sig_trd_aux <span class="free">bs</span> <span class="main">(</span>punit.lt <span class="skolem">p''</span><span class="main">,</span> <span class="skolem">p'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
              sig_trd_spp_aux <span class="main">(</span>map spp_of <span class="free">bs</span><span class="main">)</span> <span class="main">(</span>lt <span class="main">(</span>snd <span class="main">(</span>punit.lt <span class="skolem">p''</span><span class="main">,</span> <span class="skolem">p'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
               <span class="main">(</span>rep_list <span class="main">(</span>snd <span class="main">(</span>punit.lt <span class="skolem">p''</span><span class="main">,</span> <span class="skolem">p'</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span>
                punit.higher <span class="main">(</span>rep_list <span class="main">(</span>snd <span class="main">(</span>punit.lt <span class="skolem">p''</span><span class="main">,</span> <span class="skolem">p'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span>punit.lt <span class="skolem">p''</span><span class="main">,</span> <span class="skolem">p'</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
                punit.higher <span class="main">(</span>rep_list <span class="main">(</span>snd <span class="main">(</span>punit.lt <span class="skolem">p''</span><span class="main">,</span> <span class="skolem">p'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span>punit.lt <span class="skolem">p''</span><span class="main">,</span> <span class="skolem">p'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> p'_def p''_def <span class="quoted"><span class="quoted">‹<span class="skolem">p''</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> 1<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p''</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="skolem">p''</span> <span class="main">∈</span> keys <span class="skolem">p''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.lt_in_keys<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⊆</span> keys <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> p''_def punit.keys_lower<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>punit.lt <span class="skolem">p''</span><span class="main">,</span> <span class="skolem">p'</span><span class="main">)</span> <span class="main">∈</span> keys <span class="main">(</span>rep_list <span class="main">(</span>snd <span class="main">(</span>punit.lt <span class="skolem">p''</span><span class="main">,</span> <span class="skolem">p'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sig_trd_spp_aux <span class="main">(</span>map spp_of <span class="free">bs</span><span class="main">)</span> <span class="main">(</span>lt <span class="skolem">p</span><span class="main">)</span>
                         <span class="main">(</span>rep_list <span class="skolem">p'</span> <span class="main">-</span> punit.higher <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span> <span class="main">(</span>punit.lt <span class="skolem">p''</span><span class="main">)</span><span class="main">,</span>
                          punit.higher <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span> <span class="main">(</span>punit.lt <span class="skolem">p''</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> lt_p' fst_conv snd_conv<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sig_trd_spp_aux <span class="main">(</span>map spp_of <span class="free">bs</span><span class="main">)</span> <span class="main">(</span>lt <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span><span class="var">?p</span><span class="main">,</span> punit.higher <span class="main">(</span>rep_list <span class="skolem">p</span><span class="main">)</span> <span class="skolem">t</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"find_sig_reducer <span class="main">(</span>map spp_of <span class="free">bs</span><span class="main">)</span> <span class="main">(</span>lt <span class="skolem">p</span><span class="main">)</span> <span class="skolem">t</span> <span class="main">0</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> None
        <span class="keyword1"><span class="command">hence</span></span> p'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">=</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p'_def<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="skolem">p</span> <span class="main">-</span> <span class="main">(</span>punit.higher <span class="main">(</span>rep_list <span class="skolem">p</span><span class="main">)</span> <span class="skolem">t</span> <span class="main">+</span> monomial <span class="main">(</span>lookup <span class="main">(</span>rep_list <span class="skolem">p</span><span class="main">)</span> <span class="skolem">t</span><span class="main">)</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span>
              punit.lower <span class="main">(</span>rep_list <span class="skolem">p</span><span class="main">)</span> <span class="skolem">t</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> punit.higher_lower_decomp<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"rep_list <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="skolem">t</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> diff_eq_eq <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> higher_p'_2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq1 lt_p lc_p tail_p p' None<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Some <span class="skolem">i</span><span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> p'<span class="main">:</span> <span class="quoted"><span class="quoted">"rep_list <span class="skolem">p</span> <span class="main">-</span> punit.monom_mult <span class="main">(</span>lookup <span class="main">(</span>rep_list <span class="skolem">p</span><span class="main">)</span> <span class="skolem">t</span> <span class="main">/</span> punit.lc <span class="main">(</span>rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                          <span class="main">(</span><span class="skolem">t</span> <span class="main">-</span> punit.lt <span class="main">(</span>rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>rep_list <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> rep_list <span class="skolem">p'</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p'_def rep_list_minus rep_list_monom_mult<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> Some <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lookup <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span> <span class="skolem">t</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> lookup_p'<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> higher_p'_2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sig_trd_spp_body_alt_Some<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> eq1 lt_p lc_p tail_p Some
              diff_right_commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"rep_list <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"punit.higher <span class="main">(</span>rep_list <span class="skolem">p</span><span class="main">)</span> <span class="skolem">t</span>"</span></span><span class="main"><span class="main">]</span></span> p' <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> sig_trd_spp_body.simps<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="main">(</span>sig_trd_aux <span class="free">bs</span> <span class="main">(</span>punit.lt <span class="skolem">p''</span><span class="main">,</span> <span class="skolem">p'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                     sig_trd_spp_aux <span class="main">(</span>map spp_of <span class="free">bs</span><span class="main">)</span> <span class="main">(</span>lt <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span><span class="var">?p</span><span class="main">,</span> punit.higher <span class="main">(</span>rep_list <span class="skolem">p</span><span class="main">)</span> <span class="skolem">t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-sig_trd_alt_spp"><span class="command">lemma</span></span> sig_trd_alt_spp<span class="main">:</span> <span class="quoted"><span class="quoted">"spp_of <span class="main">(</span>sig_trd <span class="free">bs</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> sig_trd_spp <span class="main">(</span>map spp_of <span class="free">bs</span><span class="main">)</span> <span class="main">(</span>spp_of <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sig_trd_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">split</span> if_split<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI impI<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"spp_of <span class="free">p</span> <span class="main">=</span> sig_trd_spp <span class="main">(</span>map spp_of <span class="free">bs</span><span class="main">)</span> <span class="main">(</span>spp_of <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> spp_of_def sig_trd_spp_aux_simps<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?args</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span><span class="main">,</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="var">?args</span> <span class="main">∈</span> keys <span class="main">(</span>rep_list <span class="main">(</span>snd <span class="var">?args</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> punit.lt_in_keys<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sig_red <span class="keyword1"><span class="free">(≺<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main"><span class="free">(≼)</span></span> <span class="main">(</span>set <span class="free">bs</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">(</span>snd <span class="var">?args</span><span class="main">)</span> <span class="main">(</span>sig_trd_aux <span class="free">bs</span> <span class="var">?args</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_trd_aux_red_rtrancl<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> eq1<span class="main">:</span> <span class="quoted"><span class="quoted">"lt <span class="main">(</span>sig_trd_aux <span class="free">bs</span> <span class="var">?args</span><span class="main">)</span> <span class="main">=</span> lt <span class="main">(</span>snd <span class="var">?args</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sig_red_regular_rtrancl_lt<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> eq2<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.higher <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> punit.higher_eq_zero_iff punit.lt_max <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> not_in_keys_iff_lookup_eq_zero
            <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> punit.lt_max_keys<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"spp_of <span class="main">(</span>sig_trd_aux <span class="free">bs</span> <span class="main">(</span>punit.lt <span class="main">(</span>rep_list <span class="free">p</span><span class="main">)</span><span class="main">,</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> sig_trd_spp <span class="main">(</span>map spp_of <span class="free">bs</span><span class="main">)</span> <span class="main">(</span>spp_of <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> spp_of_def eq1 eq2 sig_trd_aux_alt_spp<span class="main"><span class="main">[</span></span><span class="operator">OF</span> a<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-is_regular_spair_alt_spp"><span class="command">lemma</span></span> is_regular_spair_alt_spp<span class="main">:</span> <span class="quoted"><span class="quoted">"is_regular_spair <span class="free">p</span> <span class="free">q</span> <span class="main">⟷</span> is_regular_spair_spp <span class="main">(</span>spp_of <span class="free">p</span><span class="main">)</span> <span class="main">(</span>spp_of <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_regular_spair_spp_def fst_spp_of snd_spp_of <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> is_regular_spairI
          <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> is_regular_spairD1 is_regular_spairD2 is_regular_spairD3<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-sig_of_spair_alt_spp"><span class="command">lemma</span></span> sig_of_spair_alt_spp<span class="main">:</span> <span class="quoted"><span class="quoted">"sig_of_pair <span class="free">p</span> <span class="main">=</span> sig_of_pair_spp <span class="main">(</span>app_pair spp_of <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum_prodE<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
  <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> Inl <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p spair_sigs_def spair_sigs_spp_def spp_of_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Signature_Groebner-pair_ord_alt_spp"><span class="command">lemma</span></span> pair_ord_alt_spp<span class="main">:</span> <span class="quoted"><span class="quoted">"pair_ord <span class="free">x</span> <span class="free">y</span> <span class="main">⟷</span> pair_ord_spp <span class="main">(</span>app_pair spp_of <span class="free">x</span><span class="main">)</span> <span class="main">(</span>app_pair spp_of <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pair_ord_spp_def pair_ord_def sig_of_spair_alt_spp<span class="main">)</span>

<span class="keyword1" id="Signature_Groebner-new_spairs_alt_spp"><span class="command">lemma</span></span> new_spairs_alt_spp<span class="main">:</span>
  <span class="quoted"><span class="quoted">"map <span class="main">(</span>app_pair spp_of<span class="main">)</span> <span class="main">(</span>new_spairs <span class="free">bs</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> new_spairs_spp <span class="main">(</span>map spp_of <span class="free">bs</span><span class="main">)</span> <span class="main">(</span>spp_of <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">bs</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">b</span> <span class="skolem">bs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span>app_pair spp_of<span class="main">)</span> <span class="main">(</span>insort_wrt pair_ord <span class="main">(</span>Inl <span class="main">(</span><span class="free">p</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>new_spairs <span class="skolem">bs</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
        insort_wrt pair_ord_spp <span class="main">(</span>app_pair spp_of <span class="main">(</span>Inl <span class="main">(</span><span class="free">p</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>map <span class="main">(</span>app_pair spp_of<span class="main">)</span> <span class="main">(</span>new_spairs <span class="skolem">bs</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> map_insort_wrt<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> pair_ord_alt_spp<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_regular_spair_alt_spp Cons<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-add_spairs_alt_spp"><span class="command">lemma</span></span> add_spairs_alt_spp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="free">bs</span> <span class="main">⟹</span> Inl <span class="main">(</span>spp_of <span class="free">p</span><span class="main">,</span> spp_of <span class="bound">x</span><span class="main">)</span> <span class="main">∉</span> app_pair spp_of <span class="main">`</span> set <span class="free">ps</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span>app_pair spp_of<span class="main">)</span> <span class="main">(</span>add_spairs <span class="free">ps</span> <span class="free">bs</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span>
          add_spairs_spp <span class="main">(</span>map <span class="main">(</span>app_pair spp_of<span class="main">)</span> <span class="free">ps</span><span class="main">)</span> <span class="main">(</span>map spp_of <span class="free">bs</span><span class="main">)</span> <span class="main">(</span>spp_of <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span>app_pair spp_of<span class="main">)</span> <span class="main">(</span>merge_wrt pair_ord <span class="main">(</span>new_spairs <span class="free">bs</span> <span class="free">p</span><span class="main">)</span> <span class="free">ps</span><span class="main">)</span> <span class="main">=</span>
        merge_wrt pair_ord_spp <span class="main">(</span>map <span class="main">(</span>app_pair spp_of<span class="main">)</span> <span class="main">(</span>new_spairs <span class="free">bs</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>map <span class="main">(</span>app_pair spp_of<span class="main">)</span> <span class="free">ps</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> map_merge_wrt<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"app_pair spp_of <span class="main">`</span> set <span class="main">(</span>new_spairs <span class="free">bs</span> <span class="free">p</span><span class="main">)</span> <span class="main">∩</span> app_pair spp_of <span class="main">`</span> set <span class="free">ps</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q'</span> <span class="main">∈</span> app_pair spp_of <span class="main">`</span> set <span class="main">(</span>new_spairs <span class="free">bs</span> <span class="free">p</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> q'_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q'</span> <span class="main">∈</span> app_pair spp_of <span class="main">`</span> set <span class="free">ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> set <span class="main">(</span>new_spairs <span class="free">bs</span> <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> q'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q'</span> <span class="main">=</span> app_pair spp_of <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> x_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> Inl <span class="main">(</span><span class="free">p</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> in_new_spairsE<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> q'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q'</span> <span class="main">=</span> Inl <span class="main">(</span>spp_of <span class="free">p</span><span class="main">,</span> spp_of <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> q q'<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q'</span> <span class="main">∉</span> app_pair spp_of <span class="main">`</span> set <span class="free">ps</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> q' <span class="keyword1"><span class="command">using</span></span> x_in <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> q'_in <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> pair_ord_alt_spp<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_spairs_def add_spairs_spp_def new_spairs_alt_spp<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-rb_aux_invD_app_args"><span class="command">lemma</span></span> rb_aux_invD_app_args<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span>fst <span class="main">(</span>app_args vec_of <span class="main">(</span><span class="main">(</span><span class="free">bs</span><span class="main">,</span> <span class="free">ss</span><span class="main">,</span> <span class="free">ps</span><span class="main">)</span><span class="main">,</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"list_all spp_inv <span class="free">bs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"list_all spp_inv_pair <span class="free">ps</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> inv<span class="main">:</span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span>map vec_of <span class="free">bs</span><span class="main">,</span> <span class="free">ss</span><span class="main">,</span> map <span class="main">(</span>app_pair vec_of<span class="main">)</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv1 <span class="main">(</span>map vec_of <span class="free">bs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_D1<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> rep_list <span class="main">`</span> set <span class="main">(</span>map vec_of <span class="free">bs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv1_D2<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> vec_of <span class="main">`</span> set <span class="free">bs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rep_list_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> set <span class="free">bs</span> <span class="main">⟹</span> spp_inv <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">b</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> spp_inv_alt<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"list_all spp_inv <span class="free">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_all_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"vec_of <span class="skolem">x</span> <span class="main">∈</span> set <span class="main">(</span>map vec_of <span class="free">bs</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> that <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vec_of <span class="skolem">x</span> <span class="main">∈</span> vec_of <span class="main">`</span> set <span class="free">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> set <span class="free">bs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"vec_of <span class="skolem">x</span> <span class="main">=</span> vec_of <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"spp_inv <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 1<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vec_of <span class="skolem">y</span> <span class="main">=</span> vec_of <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> eq<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> vec_of_inj<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> set <span class="free">bs</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"list_all spp_inv_pair <span class="free">ps</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> list_all_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ballI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"spp_inv_pair <span class="skolem">p</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum_prodE<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
      <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> Inl <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">∈</span> set <span class="free">ps</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Inl <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> p<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"app_pair vec_of <span class="main">(</span>Inl <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> app_pair vec_of <span class="main">`</span> set <span class="free">ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> imageI<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Inl <span class="main">(</span>vec_of <span class="skolem">a</span><span class="main">,</span> vec_of <span class="skolem">b</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>map <span class="main">(</span>app_pair vec_of<span class="main">)</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> inv <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vec_of <span class="skolem">a</span> <span class="main">∈</span> set <span class="main">(</span>map vec_of <span class="free">bs</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"vec_of <span class="skolem">b</span> <span class="main">∈</span> set <span class="main">(</span>map vec_of <span class="free">bs</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_D3<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"spp_inv <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 1<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> 2<span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span><span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"spp_inv <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 1<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> 2<span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span><span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-app_args_spp_of_vec_of"><span class="command">lemma</span></span> app_args_spp_of_vec_of<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span>fst <span class="main">(</span>app_args vec_of <span class="free">args</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"app_args spp_of <span class="main">(</span>app_args vec_of <span class="free">args</span><span class="main">)</span> <span class="main">=</span> <span class="free">args</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">bs</span></span> <span class="skolem"><span class="skolem">ss</span></span> <span class="skolem"><span class="skolem">ps</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> args<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">args</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="skolem">bs</span><span class="main">,</span> <span class="skolem">ss</span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> prod.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"list_all spp_inv <span class="skolem">bs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"list_all spp_inv_pair <span class="skolem">ps</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> args
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_invD_app_args<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span>spp_of <span class="main">∘</span> vec_of<span class="main">)</span> <span class="skolem">bs</span> <span class="main">=</span> <span class="skolem">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> map_spp_of_vec_of<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> * <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span>app_pair spp_of <span class="main">∘</span> app_pair vec_of<span class="main">)</span> <span class="skolem">ps</span> <span class="main">=</span> <span class="skolem">ps</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> map_app_pair_spp_of_vec_of<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> args<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-poly_of_pair_alt_spp"><span class="command">lemma</span></span> poly_of_pair_alt_spp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"distinct <span class="free">fs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span><span class="free">bs</span><span class="main">,</span> <span class="free">ss</span><span class="main">,</span> <span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"spp_of <span class="main">(</span>poly_of_pair <span class="free">p</span><span class="main">)</span> <span class="main">=</span> spp_of_pair <span class="main">(</span>app_pair spp_of <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum_prodE<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
    <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> Inl <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Inl <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_regular_spair <span class="skolem">a</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_D3<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p spair_alt_spp<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
    <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> Inr <span class="skolem">j</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Inr <span class="skolem">j</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">&lt;</span> length <span class="free">fs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_D4<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p spp_of_def lt_monomial rep_list_monomial<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">]</span></span> <span class="dynamic"><span class="dynamic">term_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Groebner-rb_aux_alt_spp"><span class="command">lemma</span></span> rb_aux_alt_spp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span>fst <span class="free">args</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"app_args spp_of <span class="main">(</span>rb_aux <span class="free">args</span><span class="main">)</span> <span class="main">=</span> rb_spp_aux <span class="main">(</span>app_args spp_of <span class="free">args</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rb_aux_dom <span class="free">args</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_domI<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">args</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rb_aux.pinduct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">bs</span> <span class="skolem">ss</span> <span class="skolem">z</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rb_aux.psimps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> 1<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">]</span></span> rb_spp_aux_Nil<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">bs</span> <span class="skolem">ss</span> <span class="skolem">p</span> <span class="skolem">ps</span> <span class="skolem">z</span><span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?q</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"sig_trd <span class="skolem">bs</span> <span class="main">(</span>poly_of_pair <span class="skolem">p</span><span class="main">)</span>"</span></span>

    <span class="keyword1"><span class="command">from</span></span> 2<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span><span class="skolem">bs</span><span class="main">,</span> <span class="skolem">ss</span><span class="main">,</span> <span class="skolem">p</span> <span class="main">#</span> <span class="skolem">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> fst_conv<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv1 <span class="skolem">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_D1<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> rep_list <span class="main">`</span> set <span class="skolem">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv1_D2<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> set <span class="skolem">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rep_list_zero<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> eq1<span class="main">:</span> <span class="quoted"><span class="quoted">"sig_crit_spp <span class="main">(</span>map spp_of <span class="skolem">bs</span><span class="main">)</span> <span class="skolem">ss'</span> <span class="main">(</span>app_pair spp_of <span class="skolem">p</span><span class="main">)</span> <span class="main">⟷</span> sig_crit <span class="skolem">bs</span> <span class="skolem">ss'</span> <span class="skolem">p</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">ss'</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sig_crit_alt_spp<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> fs_distinct * <span class="keyword1"><span class="command">have</span></span> eq2<span class="main">:</span> <span class="quoted"><span class="quoted">"sig_trd_spp <span class="main">(</span>map spp_of <span class="skolem">bs</span><span class="main">)</span> <span class="main">(</span>spp_of_pair <span class="main">(</span>app_pair spp_of <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> spp_of <span class="var">?q</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> sig_trd_alt_spp poly_of_pair_alt_spp<span class="main">)</span>

    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rb_aux.psimps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> 2<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">]</span></span> Let_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI impI<span class="main">)</span>
      <span class="keyword1"><span class="command">note</span></span> refl
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"sig_crit <span class="skolem">bs</span> <span class="main">(</span>new_syz_sigs <span class="skolem">ss</span> <span class="skolem">bs</span> <span class="skolem">p</span><span class="main">)</span> <span class="skolem">p</span>"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> * this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span>fst <span class="main">(</span><span class="main">(</span><span class="skolem">bs</span><span class="main">,</span> new_syz_sigs <span class="skolem">ss</span> <span class="skolem">bs</span> <span class="skolem">p</span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> fst_conv <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_preserved_1<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"app_args spp_of <span class="main">(</span>rb_aux <span class="main">(</span><span class="main">(</span><span class="skolem">bs</span><span class="main">,</span> new_syz_sigs <span class="skolem">ss</span> <span class="skolem">bs</span> <span class="skolem">p</span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                        rb_spp_aux <span class="main">(</span>app_args spp_of <span class="main">(</span><span class="main">(</span><span class="skolem">bs</span><span class="main">,</span> new_syz_sigs <span class="skolem">ss</span> <span class="skolem">bs</span> <span class="skolem">p</span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 2<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> rb_spp_aux <span class="main">(</span><span class="main">(</span>map spp_of <span class="skolem">bs</span><span class="main">,</span> <span class="skolem">ss</span><span class="main">,</span> app_pair spp_of <span class="skolem">p</span> <span class="main">#</span> map <span class="main">(</span>app_pair spp_of<span class="main">)</span> <span class="skolem">ps</span><span class="main">)</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rb_spp_aux_Cons eq1 a new_syz_sigs_alt_spp<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"app_args spp_of <span class="main">(</span>rb_aux <span class="main">(</span><span class="main">(</span><span class="skolem">bs</span><span class="main">,</span> new_syz_sigs <span class="skolem">ss</span> <span class="skolem">bs</span> <span class="skolem">p</span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
            rb_spp_aux <span class="main">(</span><span class="main">(</span>map spp_of <span class="skolem">bs</span><span class="main">,</span> <span class="skolem">ss</span><span class="main">,</span> app_pair spp_of <span class="skolem">p</span> <span class="main">#</span> map <span class="main">(</span>app_pair spp_of<span class="main">)</span> <span class="skolem">ps</span><span class="main">)</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"app_args spp_of <span class="main">(</span>rb_aux <span class="main">(</span><span class="main">(</span><span class="skolem">bs</span><span class="main">,</span> new_syz_sigs <span class="skolem">ss</span> <span class="skolem">bs</span> <span class="skolem">p</span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
            rb_spp_aux <span class="main">(</span><span class="main">(</span>map spp_of <span class="skolem">bs</span><span class="main">,</span> <span class="skolem">ss</span><span class="main">,</span> app_pair spp_of <span class="skolem">p</span> <span class="main">#</span> map <span class="main">(</span>app_pair spp_of<span class="main">)</span> <span class="skolem">ps</span><span class="main">)</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> sig_crit <span class="skolem">bs</span> <span class="main">(</span>new_syz_sigs <span class="skolem">ss</span> <span class="skolem">bs</span> <span class="skolem">p</span><span class="main">)</span> <span class="skolem">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"rep_list <span class="var">?q</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> * b <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span>fst <span class="main">(</span><span class="main">(</span><span class="skolem">bs</span><span class="main">,</span> lt <span class="var">?q</span> <span class="main">#</span> new_syz_sigs <span class="skolem">ss</span> <span class="skolem">bs</span> <span class="skolem">p</span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span><span class="main">,</span> Suc <span class="skolem">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> fst_conv <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_preserved_2<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> refl a refl b <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"app_args spp_of <span class="main">(</span>rb_aux <span class="main">(</span><span class="main">(</span><span class="skolem">bs</span><span class="main">,</span> lt <span class="var">?q</span> <span class="main">#</span> new_syz_sigs <span class="skolem">ss</span> <span class="skolem">bs</span> <span class="skolem">p</span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span><span class="main">,</span> Suc <span class="skolem">z</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                               rb_spp_aux <span class="main">(</span>app_args spp_of <span class="main">(</span><span class="main">(</span><span class="skolem">bs</span><span class="main">,</span> lt <span class="var">?q</span> <span class="main">#</span> new_syz_sigs <span class="skolem">ss</span> <span class="skolem">bs</span> <span class="skolem">p</span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span><span class="main">,</span> Suc <span class="skolem">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 2<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> rb_spp_aux <span class="main">(</span><span class="main">(</span>map spp_of <span class="skolem">bs</span><span class="main">,</span> <span class="skolem">ss</span><span class="main">,</span> app_pair spp_of <span class="skolem">p</span> <span class="main">#</span> map <span class="main">(</span>app_pair spp_of<span class="main">)</span> <span class="skolem">ps</span><span class="main">)</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rb_spp_aux_Cons eq1 a Let_def eq2 snd_spp_of b fst_spp_of new_syz_sigs_alt_spp<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"app_args spp_of <span class="main">(</span>rb_aux <span class="main">(</span><span class="main">(</span><span class="skolem">bs</span><span class="main">,</span> lt <span class="var">?q</span> <span class="main">#</span> new_syz_sigs <span class="skolem">ss</span> <span class="skolem">bs</span> <span class="skolem">p</span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span><span class="main">,</span> Suc <span class="skolem">z</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                    rb_spp_aux <span class="main">(</span><span class="main">(</span>map spp_of <span class="skolem">bs</span><span class="main">,</span> <span class="skolem">ss</span><span class="main">,</span> app_pair spp_of <span class="skolem">p</span> <span class="main">#</span> map <span class="main">(</span>app_pair spp_of<span class="main">)</span> <span class="skolem">ps</span><span class="main">)</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> sig_crit <span class="skolem">bs</span> <span class="main">(</span>new_syz_sigs <span class="skolem">ss</span> <span class="skolem">bs</span> <span class="skolem">p</span><span class="main">)</span> <span class="skolem">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"rep_list <span class="var">?q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Inl <span class="main">(</span>spp_of <span class="var">?q</span><span class="main">,</span> spp_of <span class="skolem">x</span><span class="main">)</span> <span class="main">∉</span> app_pair spp_of <span class="main">`</span> set <span class="skolem">ps</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Inl <span class="main">(</span>spp_of <span class="var">?q</span><span class="main">,</span> spp_of <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> app_pair spp_of <span class="main">`</span> set <span class="skolem">ps</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> set <span class="skolem">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> eq0<span class="main">:</span> <span class="quoted"><span class="quoted">"Inl <span class="main">(</span>spp_of <span class="var">?q</span><span class="main">,</span> spp_of <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> app_pair spp_of <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> Inl <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"spp_of <span class="var">?q</span> <span class="main">=</span> spp_of <span class="skolem">a</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sum_prodE<span class="main">)</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> Inl <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> eq0 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"spp_of <span class="var">?q</span> <span class="main">=</span> spp_of <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">=</span> Inl <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span>›</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> Inr <span class="skolem">j</span>"</span></span>
          <span class="keyword1"><span class="command">with</span></span> eq0 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="var">?q</span> <span class="main">=</span> lt <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> spp_of_def<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> set <span class="skolem">ps</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">p</span> <span class="main">#</span> <span class="skolem">ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> * <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> set <span class="skolem">bs</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> y <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_D3<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"lt <span class="var">?q</span> <span class="main">∈</span> lt <span class="main">`</span> set <span class="skolem">bs</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹lt <span class="var">?q</span> <span class="main">=</span> lt <span class="skolem">a</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> imageI<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> * a b <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lt <span class="var">?q</span> <span class="main">∉</span> lt <span class="main">`</span> set <span class="skolem">bs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_preserved_3<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">hence</span></span> eq3<span class="main">:</span> <span class="quoted"><span class="quoted">"add_spairs_spp <span class="main">(</span>map <span class="main">(</span>app_pair spp_of<span class="main">)</span> <span class="skolem">ps</span><span class="main">)</span> <span class="main">(</span>map spp_of <span class="skolem">bs</span><span class="main">)</span> <span class="main">(</span>spp_of <span class="var">?q</span><span class="main">)</span> <span class="main">=</span>
                  map <span class="main">(</span>app_pair spp_of<span class="main">)</span> <span class="main">(</span>add_spairs <span class="skolem">ps</span> <span class="skolem">bs</span> <span class="var">?q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_spairs_alt_spp<span class="main">)</span>

      <span class="keyword1"><span class="command">from</span></span> * a b <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span>fst <span class="main">(</span><span class="main">(</span><span class="var">?q</span> <span class="main">#</span> <span class="skolem">bs</span><span class="main">,</span> new_syz_sigs <span class="skolem">ss</span> <span class="skolem">bs</span> <span class="skolem">p</span><span class="main">,</span> add_spairs <span class="skolem">ps</span> <span class="skolem">bs</span> <span class="var">?q</span><span class="main">)</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> fst_conv <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_inv_preserved_3<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> refl a refl b
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"app_args spp_of <span class="main">(</span>rb_aux <span class="main">(</span><span class="main">(</span><span class="var">?q</span> <span class="main">#</span> <span class="skolem">bs</span><span class="main">,</span> new_syz_sigs <span class="skolem">ss</span> <span class="skolem">bs</span> <span class="skolem">p</span><span class="main">,</span> add_spairs <span class="skolem">ps</span> <span class="skolem">bs</span> <span class="var">?q</span><span class="main">)</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
            rb_spp_aux <span class="main">(</span>app_args spp_of <span class="main">(</span><span class="main">(</span><span class="var">?q</span> <span class="main">#</span> <span class="skolem">bs</span><span class="main">,</span> new_syz_sigs <span class="skolem">ss</span> <span class="skolem">bs</span> <span class="skolem">p</span><span class="main">,</span> add_spairs <span class="skolem">ps</span> <span class="skolem">bs</span> <span class="var">?q</span><span class="main">)</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 2<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> rb_spp_aux <span class="main">(</span><span class="main">(</span>map spp_of <span class="skolem">bs</span><span class="main">,</span> <span class="skolem">ss</span><span class="main">,</span> app_pair spp_of <span class="skolem">p</span> <span class="main">#</span> map <span class="main">(</span>app_pair spp_of<span class="main">)</span> <span class="skolem">ps</span><span class="main">)</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rb_spp_aux_Cons eq1 a Let_def eq2 fst_spp_of snd_spp_of b eq3 new_syz_sigs_alt_spp<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"app_args spp_of <span class="main">(</span>rb_aux <span class="main">(</span><span class="main">(</span><span class="var">?q</span> <span class="main">#</span> <span class="skolem">bs</span><span class="main">,</span> new_syz_sigs <span class="skolem">ss</span> <span class="skolem">bs</span> <span class="skolem">p</span><span class="main">,</span> add_spairs <span class="skolem">ps</span> <span class="skolem">bs</span> <span class="var">?q</span><span class="main">)</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
                     rb_spp_aux <span class="main">(</span><span class="main">(</span>map spp_of <span class="skolem">bs</span><span class="main">,</span> <span class="skolem">ss</span><span class="main">,</span> app_pair spp_of <span class="skolem">p</span> <span class="main">#</span> map <span class="main">(</span>app_pair spp_of<span class="main">)</span> <span class="skolem">ps</span><span class="main">)</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> rb_spp_aux_alt<span class="main">:</span>
  <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span>fst <span class="main">(</span>app_args vec_of <span class="free">args</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
    rb_spp_aux <span class="free">args</span> <span class="main">=</span> app_args spp_of <span class="main">(</span>rb_aux <span class="main">(</span>app_args vec_of <span class="free">args</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> rb_aux_alt_spp app_args_spp_of_vec_of<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> rb_spp_aux<span class="main">:</span>
  <span class="quoted"><span class="quoted">"hom_grading <span class="free">dgrad</span> <span class="main">⟹</span>
    punit.is_Groebner_basis <span class="main">(</span>set <span class="main">(</span>map snd <span class="main">(</span>fst <span class="main">(</span>fst <span class="main">(</span>rb_spp_aux <span class="main">(</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span> Koszul_syz_sigs <span class="free">fs</span><span class="main">,</span> map Inr <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">fs</span><span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⟹</span> <span class="var">?thesis1</span>"</span></span><span class="main">)</span>
  <span class="quoted"><span class="quoted">"ideal <span class="main">(</span>set <span class="main">(</span>map snd <span class="main">(</span>fst <span class="main">(</span>fst <span class="main">(</span>rb_spp_aux <span class="main">(</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span> Koszul_syz_sigs <span class="free">fs</span><span class="main">,</span> map Inr <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">fs</span><span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> ideal <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span>"</span></span>
          <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?thesis2</span>"</span></span><span class="main">)</span>
  <span class="quoted"><span class="quoted">"set <span class="main">(</span>map snd <span class="main">(</span>fst <span class="main">(</span>fst <span class="main">(</span>rb_spp_aux <span class="main">(</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span> Koszul_syz_sigs <span class="free">fs</span><span class="main">,</span> map Inr <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">fs</span><span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> punit_dgrad_max_set <span class="free">dgrad</span>"</span></span>
          <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?thesis3</span>"</span></span><span class="main">)</span>
  <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> set <span class="main">(</span>map snd <span class="main">(</span>fst <span class="main">(</span>fst <span class="main">(</span>rb_spp_aux <span class="main">(</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span> Koszul_syz_sigs <span class="free">fs</span><span class="main">,</span> map Inr <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">fs</span><span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?thesis4</span>"</span></span><span class="main">)</span>
  <span class="quoted"><span class="quoted">"hom_grading <span class="free">dgrad</span> <span class="main">⟹</span> is_pot_ord <span class="main">⟹</span> is_regular_sequence <span class="free">fs</span> <span class="main">⟹</span>
    snd <span class="main">(</span>rb_spp_aux <span class="main">(</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span> Koszul_syz_sigs <span class="free">fs</span><span class="main">,</span> map Inr <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">fs</span><span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">z</span>"</span></span>
          <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⟹</span> <span class="main">_</span> <span class="main">⟹</span> <span class="main">_</span> <span class="main">⟹</span> <span class="var">?thesis5</span>"</span></span><span class="main">)</span>
  <span class="quoted"><span class="quoted">"<span class="free">rword_strict</span> <span class="main">=</span> rw_rat_strict <span class="main">⟹</span> <span class="free">p</span> <span class="main">∈</span> set <span class="main">(</span>fst <span class="main">(</span>fst <span class="main">(</span>rb_spp_aux <span class="main">(</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span> Koszul_syz_sigs <span class="free">fs</span><span class="main">,</span> map Inr <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">fs</span><span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
    <span class="free">q</span> <span class="main">∈</span> set <span class="main">(</span>fst <span class="main">(</span>fst <span class="main">(</span>rb_spp_aux <span class="main">(</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span> Koszul_syz_sigs <span class="free">fs</span><span class="main">,</span> map Inr <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">fs</span><span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">≠</span> <span class="free">q</span> <span class="main">⟹</span>
    punit.lt <span class="main">(</span>snd <span class="free">p</span><span class="main">)</span> <span class="keyword1">adds</span> punit.lt <span class="main">(</span>snd <span class="free">q</span><span class="main">)</span> <span class="main">⟹</span> punit.lt <span class="main">(</span>snd <span class="free">p</span><span class="main">)</span> <span class="main">⊕</span> fst <span class="free">q</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> punit.lt <span class="main">(</span>snd <span class="free">q</span><span class="main">)</span> <span class="main">⊕</span> fst <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?args</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span> Koszul_syz_sigs <span class="free">fs</span><span class="main">,</span> map Inr <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">fs</span><span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> eq0<span class="main">:</span> <span class="quoted"><span class="quoted">"app_pair vec_of <span class="main">∘</span> Inr <span class="main">=</span> Inr"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> eq1<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>fst <span class="main">(</span>app_args spp_of <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> map spp_of <span class="main">(</span>fst <span class="main">(</span>fst <span class="skolem">a</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">_</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'t</span> list<span class="main">)</span> <span class="main">×</span> <span class="main">_</span><span class="main">)</span> <span class="main">×</span> <span class="main">_</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">bs</span></span> <span class="skolem"><span class="skolem">ss</span></span> <span class="skolem"><span class="skolem">ps</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="skolem">bs</span><span class="main">,</span> <span class="skolem">ss</span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> prod.exhaust <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> eq2<span class="main">:</span> <span class="quoted"><span class="quoted">"snd <span class="main">∘</span> spp_of <span class="main">=</span> rep_list"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> snd_spp_of<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rb_aux_inv <span class="main">(</span>fst <span class="main">(</span>app_args vec_of <span class="var">?args</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq0 rb_aux_inv_init<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> eq3<span class="main">:</span> <span class="quoted"><span class="quoted">"rb_spp_aux <span class="var">?args</span> <span class="main">=</span> app_args spp_of <span class="main">(</span>rb_aux <span class="main">(</span>app_args vec_of <span class="var">?args</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_spp_aux_alt<span class="main">)</span>

  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"hom_grading <span class="free">dgrad</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> rb_aux_is_Groebner_basis <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis1</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq0 eq1 eq2 eq3 <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> set_map<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">from</span></span> ideal_rb_aux <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis2</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq0 eq1 eq2 eq3 <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> set_map<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> dgrad_max_set_closed_rb_aux <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis3</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq0 eq1 eq2 eq3 <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> set_map<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> rb_aux_nonzero <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis4</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq0 eq1 eq2 eq3 <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> set_map<span class="main">)</span>

  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_pot_ord"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"hom_grading <span class="free">dgrad</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_regular_sequence <span class="free">fs</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>rb_aux <span class="var">?args</span><span class="main">)</span> <span class="main">=</span> <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_no_zero_red<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis5</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> snd_app_args eq0 eq3<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword1"><span class="command">from</span></span> rb_aux_nonzero <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> rep_list <span class="main">`</span> set <span class="main">(</span>fst <span class="main">(</span>fst <span class="main">(</span>rb_aux <span class="var">?args</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> rep_list <span class="main">`</span> <span class="var">?G</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">rword_strict</span> <span class="main">=</span> rw_rat_strict"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_min_sig_GB <span class="free">dgrad</span> <span class="var">?G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_aux_is_min_sig_GB<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> rl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">g</span><span class="main">.</span> <span class="bound">g</span> <span class="main">∈</span> <span class="var">?G</span> <span class="main">⟹</span> <span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="main">(</span><span class="var">?G</span> <span class="main">-</span> <span class="main">{</span><span class="bound">g</span><span class="main">}</span><span class="main">)</span> <span class="bound">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_min_sig_GB_def<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> set <span class="main">(</span>fst <span class="main">(</span>fst <span class="main">(</span>rb_spp_aux <span class="var">?args</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> spp_of <span class="main">`</span> <span class="var">?G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq0 eq1 eq3<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">∈</span> <span class="var">?G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> spp_of <span class="skolem">p'</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> set <span class="main">(</span>fst <span class="main">(</span>fst <span class="main">(</span>rb_spp_aux <span class="var">?args</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> spp_of <span class="main">`</span> <span class="var">?G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq0 eq1 eq3<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q'</span> <span class="main">∈</span> <span class="var">?G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> spp_of <span class="skolem">q'</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_sig_red <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="main">(</span><span class="var">?G</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">q'</span><span class="main">}</span><span class="main">)</span> <span class="skolem">q'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rl<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>snd <span class="free">p</span><span class="main">)</span> <span class="keyword1">adds</span> punit.lt <span class="main">(</span>snd <span class="free">q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">≠</span> <span class="skolem">q'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> adds<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span> <span class="keyword1">adds</span> punit.lt <span class="main">(</span>rep_list <span class="skolem">q'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> p q snd_spp_of<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>snd <span class="free">p</span><span class="main">)</span> <span class="main">⊕</span> fst <span class="free">q</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> punit.lt <span class="main">(</span>snd <span class="free">q</span><span class="main">)</span> <span class="main">⊕</span> fst <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> punit.lt <span class="main">(</span>snd <span class="free">p</span><span class="main">)</span> <span class="main">⊕</span> fst <span class="free">q</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> punit.lt <span class="main">(</span>snd <span class="free">q</span><span class="main">)</span> <span class="main">⊕</span> fst <span class="free">p</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> le<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>rep_list <span class="skolem">q'</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">p'</span> <span class="keyword1"><span class="free">≼<span class="hidden">⇩</span><sub>t</sub></span></span> punit.lt <span class="main">(</span>rep_list <span class="skolem">p'</span><span class="main">)</span> <span class="main">⊕</span> lt <span class="skolem">q'</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p q spp_of_def<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p'</span> <span class="main">≠</span> <span class="skolem">q'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p'</span> <span class="main">∈</span> <span class="var">?G</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">∈</span> <span class="var">?G</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">q'</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p'</span> <span class="main">∈</span> <span class="var">?G</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">∉</span> rep_list <span class="main">`</span> <span class="var">?G</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="skolem">p'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q'</span> <span class="main">∈</span> <span class="var">?G</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">∉</span> rep_list <span class="main">`</span> <span class="var">?G</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rep_list <span class="skolem">q'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> adds
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ord_term_lin.is_le_rel <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_sig_red <span class="keyword1"><span class="free">(≼<span class="hidden">⇩</span><sub>t</sub>)</span></span> <span class="main">(=)</span> <span class="main">(</span><span class="var">?G</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">q'</span><span class="main">}</span><span class="main">)</span> <span class="skolem">q'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> le <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_sig_red_top_addsI<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">gb_sig_z</span> <span class="main">::</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span> list <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">::</span>field<span class="main">)</span><span class="main">)</span> list <span class="main">×</span> nat<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">gb_sig_z</span> <span class="free"><span class="bound"><span class="entity">rword_strict</span></span></span> <span class="free"><span class="bound"><span class="entity">fs0</span></span></span> <span class="main">=</span>
              <span class="main">(</span><span class="keyword1">let</span> <span class="bound">fs</span> <span class="main">=</span> rev <span class="main">(</span>remdups <span class="main">(</span>rev <span class="main">(</span>removeAll <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">fs0</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
                   <span class="bound">res</span> <span class="main">=</span> rb_spp_aux <span class="bound">fs</span> <span class="free"><span class="bound"><span class="entity">rword_strict</span></span></span> <span class="main">(</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span> Koszul_syz_sigs <span class="bound">fs</span><span class="main">,</span> map Inr <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="bound">fs</span><span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="keyword1">in</span>
                  <span class="main">(</span>fst <span class="main">(</span>fst <span class="bound">res</span><span class="main">)</span><span class="main">,</span> snd <span class="bound">res</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The second return value of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> gb_sig_z<span class="antiquote"><span class="antiquote">}</span></span></span></span> is the total number of zero-reductions.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">gb_sig</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">)</span> list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> <span class="tfree">'b</span><span class="main">::</span>field<span class="main">)</span> list"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">gb_sig</span> <span class="free"><span class="bound"><span class="entity">rword_strict</span></span></span> <span class="free"><span class="bound"><span class="entity">fs0</span></span></span> <span class="main">=</span> map snd <span class="main">(</span>fst <span class="main">(</span>gb_sig_z <span class="free"><span class="bound"><span class="entity">rword_strict</span></span></span> <span class="free"><span class="bound"><span class="entity">fs0</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">theorem</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">fs</span><span class="main">.</span> is_strict_rewrite_ord <span class="bound">fs</span> <span class="free">rword_strict</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> gb_sig_isGB<span class="main">:</span> <span class="quoted"><span class="quoted">"punit.is_Groebner_basis <span class="main">(</span>set <span class="main">(</span>gb_sig <span class="free">rword_strict</span> <span class="free">fs</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?thesis1</span></span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> gb_sig_ideal<span class="main">:</span> <span class="quoted"><span class="quoted">"ideal <span class="main">(</span>set <span class="main">(</span>gb_sig <span class="free">rword_strict</span> <span class="free">fs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> ideal <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?thesis2</span></span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> dgrad_p_set_closed_gb_sig<span class="main">:</span>
        <span class="quoted"><span class="quoted">"dickson_grading <span class="free">d</span> <span class="main">⟹</span> set <span class="free">fs</span> <span class="main">⊆</span> punit.dgrad_p_set <span class="free">d</span> <span class="free">m</span> <span class="main">⟹</span> set <span class="main">(</span>gb_sig <span class="free">rword_strict</span> <span class="free">fs</span><span class="main">)</span> <span class="main">⊆</span> punit.dgrad_p_set <span class="free">d</span> <span class="free">m</span>"</span></span>
          <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⟹</span> <span class="main">_</span> <span class="main">⟹</span> <span class="var">?thesis3</span>"</span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> gb_sig_nonzero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> set <span class="main">(</span>gb_sig <span class="free">rword_strict</span> <span class="free">fs</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?thesis4</span></span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> gb_sig_no_zero_red<span class="main">:</span> <span class="quoted"><span class="quoted">"is_pot_ord <span class="main">⟹</span> is_regular_sequence <span class="free">fs</span> <span class="main">⟹</span> snd <span class="main">(</span>gb_sig_z <span class="free">rword_strict</span> <span class="free">fs</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> ex_hgrad <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d0</span></span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"dickson_grading <span class="skolem">d0</span> <span class="main">∧</span> hom_grading <span class="skolem">d0</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">hence</span></span> dg<span class="main">:</span> <span class="quoted"><span class="quoted">"dickson_grading <span class="skolem">d0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> hg<span class="main">:</span> <span class="quoted"><span class="quoted">"hom_grading <span class="skolem">d0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">fs1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fs1</span> <span class="main">=</span> rev <span class="main">(</span>remdups <span class="main">(</span>rev <span class="main">(</span>removeAll <span class="main">0</span> <span class="free">fs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">note</span></span> assms dg
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"distinct <span class="skolem">fs1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> set <span class="skolem">fs1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fs1_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ideal <span class="main">(</span>set <span class="main">(</span>gb_sig <span class="free">rword_strict</span> <span class="free">fs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> ideal <span class="main">(</span>set <span class="skolem">fs1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?thesis4</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> gb_sig_def gb_sig_z_def fst_conv fs1_def Let_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_spp_aux<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis2</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?thesis4</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fs1_def ideal.span_Diff_zero<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> assms dg <span class="quoted"><span class="quoted">‹distinct <span class="skolem">fs1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">∉</span> set <span class="skolem">fs1</span>›</span></span> hg <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis1</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> gb_sig_def gb_sig_z_def fst_conv fs1_def Let_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_spp_aux<span class="main">)</span>

  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> dg<span class="main">:</span> <span class="quoted"><span class="quoted">"dickson_grading <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">fs</span> <span class="main">⊆</span> punit.dgrad_p_set <span class="free">d</span> <span class="free">m</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis3</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"set <span class="free">fs</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"removeAll <span class="main">0</span> <span class="free">fs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Diff_iff ex_in_conv set_empty2 set_removeAll subset_singleton_iff<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gb_sig_def gb_sig_z_def Let_def rb_spp_aux_Nil<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">fs1</span> <span class="main">⊆</span> set <span class="free">fs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fs1_def<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Keys <span class="main">(</span>set <span class="skolem">fs1</span><span class="main">)</span> <span class="main">⊆</span> Keys <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Keys_mono<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">`</span> Keys <span class="main">(</span>set <span class="skolem">fs1</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">d</span> <span class="main">`</span> Keys <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> image_mono<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"insert <span class="main">(</span><span class="free">d</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="free">d</span> <span class="main">`</span> Keys <span class="main">(</span>set <span class="skolem">fs1</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> insert <span class="main">(</span><span class="free">d</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="free">d</span> <span class="main">`</span> Keys <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> insert_mono<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insert <span class="main">(</span><span class="free">d</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="free">d</span> <span class="main">`</span> Keys <span class="main">(</span>set <span class="skolem">fs1</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>insert <span class="main">(</span><span class="free">d</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="free">d</span> <span class="main">`</span> Keys <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> finite_Keys<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> le<span class="main">:</span> <span class="quoted"><span class="quoted">"Max <span class="main">(</span>insert <span class="main">(</span><span class="free">d</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="free">d</span> <span class="main">`</span> Keys <span class="main">(</span>set <span class="skolem">fs1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span>
                            Max <span class="main">(</span>insert <span class="main">(</span><span class="free">d</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="free">d</span> <span class="main">`</span> Keys <span class="main">(</span>set <span class="free">fs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Max_mono<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> assms dg <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>gb_sig <span class="free">rword_strict</span> <span class="free">fs</span><span class="main">)</span> <span class="main">⊆</span> punit_dgrad_max_set <span class="main">(</span><span class="keyword1">TYPE</span><span class="main">(</span><span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> <span class="skolem">fs1</span> <span class="free">d</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹distinct <span class="skolem">fs1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">∉</span> set <span class="skolem">fs1</span>›</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> gb_sig_def gb_sig_z_def fst_conv fs1_def Let_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_spp_aux<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"punit_dgrad_max_set <span class="main">(</span><span class="keyword1">TYPE</span><span class="main">(</span><span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> <span class="skolem">fs1</span> <span class="free">d</span> <span class="main">⊆</span> punit_dgrad_max_set <span class="main">(</span><span class="keyword1">TYPE</span><span class="main">(</span><span class="tfree">'b</span><span class="main">)</span><span class="main">)</span> <span class="free">fs</span> <span class="free">d</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit.dgrad_p_set_subset<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dgrad_max_def le<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> dg * False <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⊆</span> punit.dgrad_p_set <span class="free">d</span> <span class="free">m</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> punit_dgrad_max_set_subset_dgrad_p_set<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_regular_sequence <span class="free">fs</span>"</span></span>
    <span class="keyword1"><span class="command">note</span></span> assms dg <span class="quoted"><span class="quoted">‹distinct <span class="skolem">fs1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">∉</span> set <span class="skolem">fs1</span>›</span></span> hg
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_pot_ord"</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹is_regular_sequence <span class="free">fs</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_regular_sequence <span class="skolem">fs1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> fs1_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> is_regular_sequence_remdups is_regular_sequence_removeAll_zero<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>gb_sig_z <span class="free">rword_strict</span> <span class="free">fs</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> gb_sig_def gb_sig_z_def snd_conv fs1_def Let_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_spp_aux<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> gb_sig_z_is_min_sig_GB<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> set <span class="main">(</span>fst <span class="main">(</span>gb_sig_z rw_rat_strict <span class="free">fs</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> set <span class="main">(</span>fst <span class="main">(</span>gb_sig_z rw_rat_strict <span class="free">fs</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>snd <span class="free">p</span><span class="main">)</span> <span class="keyword1">adds</span> punit.lt <span class="main">(</span>snd <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"punit.lt <span class="main">(</span>snd <span class="free">p</span><span class="main">)</span> <span class="main">⊕</span> fst <span class="free">q</span> <span class="keyword1"><span class="free">≺<span class="hidden">⇩</span><sub>t</sub></span></span> punit.lt <span class="main">(</span>snd <span class="free">q</span><span class="main">)</span> <span class="main">⊕</span> fst <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">fs1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fs1</span> <span class="main">=</span> rev <span class="main">(</span>remdups <span class="main">(</span>rev <span class="main">(</span>removeAll <span class="main">0</span> <span class="free">fs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> ex_hgrad <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d0</span></span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"dickson_grading <span class="skolem">d0</span> <span class="main">∧</span> hom_grading <span class="skolem">d0</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"dickson_grading <span class="skolem">d0</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">note</span></span> rw_rat_strict_is_strict_rewrite_ord this
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"distinct <span class="skolem">fs1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∉</span> set <span class="skolem">fs1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fs1_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> refl assms
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> gb_sig_z_def fst_conv fs1_def Let_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rb_spp_aux<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Summarizing, these are the four main results proved in this theory:
  <span class="antiquoted"><span class="antiquoted">▪</span></span> <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> gb_sig_isGB<span class="antiquote"><span class="antiquote">}</span></span></span></span>,
  <span class="antiquoted"><span class="antiquoted">▪</span></span> <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> gb_sig_ideal<span class="antiquote"><span class="antiquote">}</span></span></span></span>,
  <span class="antiquoted"><span class="antiquoted">▪</span></span> <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> gb_sig_no_zero_red<span class="antiquote"><span class="antiquote">}</span></span></span></span>, and
  <span class="antiquoted"><span class="antiquoted">▪</span></span> <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> gb_sig_z_is_min_sig_GB<span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* qpm_inf_term *)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* theory *)</span>
</pre>
</div><div id="Signature_Examples">
<div class="head">
<h1>Theory Signature_Examples</h1>
</div>
<pre class="source"><span class="comment1">(* Author: Alexander Maletzky *)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Sample Computations with Signature-Based Algorithms›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Signature_Examples
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="#Signature_Groebner">Signature_Groebner</a> <a href="../../groebner_bases/theories/#Benchmarks">Groebner_Bases.Benchmarks</a> <a href="../../groebner_bases/theories/#Code_Target_Rat">Groebner_Bases.Code_Target_Rat</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Setup›</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> except_pp <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> pp <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">::</span>zero<span class="main">)</span> pp"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">except</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1" id="Signature_Examples-hom_grading_varnum_pp"><span class="command">lemma</span></span> hom_grading_varnum_pp<span class="main">:</span> <span class="quoted"><span class="quoted">"hom_grading <span class="main">(</span>varnum_pp<span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>countable<span class="main">,</span> <span class="tfree">'b</span><span class="main">::</span>add_wellorder<span class="main">)</span> pp <span class="main">⇒</span> nat<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span> <span class="bound">t</span><span class="main">.</span> <span class="main">(</span>except_pp <span class="bound">t</span> <span class="main">(</span><span class="main">-</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> elem_index <span class="bound">x</span> <span class="main">&lt;</span> <span class="bound">n</span><span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> pp<span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> hom_grading_def hom_grading_fun_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI allI conjI impI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="skolem">s</span> <span class="skolem">t</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">n</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">f</span> <span class="skolem">n</span> <span class="skolem">s</span> <span class="main">+</span> <span class="skolem">f</span> <span class="skolem">n</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">rule</span> except_plus<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="skolem">t</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"varnum_pp <span class="main">(</span><span class="skolem">f</span> <span class="skolem">n</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> f_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> varnum_le_iff keys_except<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="skolem">t</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"varnum_pp <span class="skolem">t</span> <span class="main">≤</span> <span class="skolem">n</span> <span class="main">⟹</span> <span class="skolem">f</span> <span class="skolem">n</span> <span class="skolem">t</span> <span class="main">=</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> f_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> except_id_iff varnum_le_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">instance</span></span> pp <span class="main">::</span> <span class="main">(</span><span class="quoted">countable</span><span class="main">,</span> <span class="quoted">add_wellorder</span><span class="main">)</span> <span class="quoted">quasi_pm_powerprod</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> exI conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span> dickson_grading_varnum_pp<span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span> hom_grading_varnum_pp<span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Projections of Term Orders to Orders on Power-Products›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">proj_comp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>nat<span class="main">,</span> <span class="tfree">'b</span><span class="main">::</span>nat<span class="main">)</span> pp <span class="main">×</span> nat<span class="main">)</span> nat_term_order <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> pp <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> pp <span class="main">⇒</span> order"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">proj_comp</span> <span class="free"><span class="bound"><span class="entity">cmp</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> nat_term_compare <span class="free"><span class="bound"><span class="entity">cmp</span></span></span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">proj_ord</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>nat<span class="main">,</span> <span class="tfree">'b</span><span class="main">::</span>nat<span class="main">)</span> pp <span class="main">×</span> nat<span class="main">)</span> nat_term_order <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> pp nat_term_order"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">proj_ord</span> <span class="free"><span class="bound"><span class="entity">cmp</span></span></span> <span class="main">=</span> Abs_nat_term_order <span class="main">(</span>proj_comp <span class="free"><span class="bound"><span class="entity">cmp</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In principle, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> proj_comp<span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> proj_ord<span class="antiquote"><span class="antiquote">}</span></span></span></span> could be defined more generally on type
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">"<span class="tfree"><span class="tfree">'a</span></span> <span class="main"><span class="main">×</span></span> nat"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, but then <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> would have to belong to some new type-class which is the
  intersection of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">class</span></span> nat_pp_term<span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">class</span></span> nat_pp_compare<span class="antiquote"><span class="antiquote">}</span></span></span></span> and additionally requires
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">prop</span></span> <span class="quoted"><span class="quoted">"rep_nat_term <span class="free"><span class="free">x</span></span> <span class="main"><span class="main">=</span></span> <span class="main"><span class="main">(</span></span>rep_nat_pp <span class="free"><span class="free">x</span></span><span class="main"><span class="main">,</span></span> <span class="main"><span class="main">0</span></span><span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword1" id="Signature_Examples-comparator_proj_comp"><span class="command">lemma</span></span> comparator_proj_comp<span class="main">:</span> <span class="quoted"><span class="quoted">"comparator <span class="main">(</span>proj_comp <span class="free">cmp</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> cmp<span class="main">:</span> comparator <span class="quoted"><span class="quoted">"nat_term_compare <span class="free">cmp</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> comparator_nat_term_compare<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> proj_comp_def
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> pp"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"invert_order <span class="main">(</span>nat_term_compare <span class="free">cmp</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="skolem">y</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> nat_term_compare <span class="free">cmp</span> <span class="main">(</span><span class="skolem">y</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> cmp.sym<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> pp"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"nat_term_compare <span class="free">cmp</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="skolem">y</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> Eq"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">y</span><span class="main">,</span> <span class="main">0</span><span class="main">::</span>nat<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cmp.weak_eq<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> pp"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"nat_term_compare <span class="free">cmp</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="skolem">y</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> Lt"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"nat_term_compare <span class="free">cmp</span> <span class="main">(</span><span class="skolem">y</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="skolem">z</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> Lt"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"nat_term_compare <span class="free">cmp</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="skolem">z</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> Lt"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cmp.comp_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Examples-nat_term_comp_proj_comp"><span class="command">lemma</span></span> nat_term_comp_proj_comp<span class="main">:</span> <span class="quoted"><span class="quoted">"nat_term_comp <span class="main">(</span>proj_comp <span class="free">cmp</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>rep_nat_term <span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> rep_nat_pp <span class="skolem">u</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">u</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> pp"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">i</span><span class="main">::</span><span class="quoted">nat</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rep_nat_term_prod_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>rep_nat_term <span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">u</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> pp"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">i</span><span class="main">::</span><span class="quoted">nat</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rep_nat_term_prod_def rep_nat_nat_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> nat_term_compI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="skolem">v</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> pp"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>rep_nat_term <span class="skolem">u</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">note</span></span> nat_term_comp_nat_term_compare
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>rep_nat_term <span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="main">0</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span> <span class="main">=</span> snd <span class="main">(</span>rep_nat_term <span class="main">(</span><span class="skolem">v</span><span class="main">,</span> <span class="main">0</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> 2<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> a <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>rep_nat_term <span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="main">0</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> 1 rep_nat_term_pp_def<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nat_term_compare <span class="free">cmp</span> <span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="skolem">v</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">≠</span> Gt"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nat_term_compD1<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"proj_comp <span class="free">cmp</span> <span class="skolem">u</span> <span class="skolem">v</span> <span class="main">≠</span> Gt"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj_comp_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="skolem">v</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> pp"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>rep_nat_term <span class="skolem">u</span><span class="main">)</span> <span class="main">&lt;</span> snd <span class="main">(</span>rep_nat_term <span class="skolem">v</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"proj_comp <span class="free">cmp</span> <span class="skolem">u</span> <span class="skolem">v</span> <span class="main">=</span> Lt"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rep_nat_term_pp_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">v</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> pp"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"proj_comp <span class="free">cmp</span> <span class="skolem">u</span> <span class="skolem">v</span> <span class="main">=</span> Lt"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"nat_term_compare <span class="free">cmp</span> <span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="skolem">v</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> Lt"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj_comp_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> nat_term_comp_nat_term_compare <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nat_term_compare <span class="free">cmp</span> <span class="main">(</span>splus <span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>splus <span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="skolem">v</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Lt"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nat_term_compD3<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"proj_comp <span class="free">cmp</span> <span class="main">(</span>splus <span class="skolem">t</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">(</span>splus <span class="skolem">t</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">=</span> Lt"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj_comp_def splus_prod_def pprod.splus_def splus_pp_term<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="skolem">v</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> pp"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>rep_nat_term <span class="skolem">u</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span>rep_nat_term <span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>rep_nat_term <span class="skolem">v</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span>rep_nat_term <span class="skolem">b</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"proj_comp <span class="free">cmp</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">=</span> Lt"</span></span>
    <span class="keyword1"><span class="command">note</span></span> nat_term_comp_nat_term_compare
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> u <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>rep_nat_term <span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="main">0</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span>rep_nat_term <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="main">0</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> 1 rep_nat_term_pp_def<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> v <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>rep_nat_term <span class="main">(</span><span class="skolem">v</span><span class="main">,</span> <span class="main">0</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span>rep_nat_term <span class="main">(</span><span class="skolem">b</span><span class="main">,</span> <span class="main">0</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> 1 rep_nat_term_pp_def<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>rep_nat_term <span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="main">0</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span> <span class="main">=</span> snd <span class="main">(</span>rep_nat_term <span class="main">(</span><span class="skolem">v</span><span class="main">,</span> <span class="main">0</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>rep_nat_term <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="main">0</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span> <span class="main">=</span> snd <span class="main">(</span>rep_nat_term <span class="main">(</span><span class="skolem">b</span><span class="main">,</span> <span class="main">0</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> 2<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> a <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nat_term_compare <span class="free">cmp</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="skolem">b</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> Lt"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj_comp_def<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nat_term_compare <span class="free">cmp</span> <span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="skolem">v</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> Lt"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nat_term_compD4<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"proj_comp <span class="free">cmp</span> <span class="skolem">u</span> <span class="skolem">v</span> <span class="main">=</span> Lt"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proj_comp_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> nat_term_compare_proj_ord<span class="main">:</span> <span class="quoted"><span class="quoted">"nat_term_compare <span class="main">(</span>proj_ord <span class="free">cmp</span><span class="main">)</span> <span class="main">=</span> proj_comp <span class="free">cmp</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> proj_ord_def <span class="keyword1"><span class="command">using</span></span> comparator_proj_comp nat_term_comp_proj_comp
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nat_term_compare_Abs_nat_term_order_id<span class="main">)</span>

<span class="keyword1" id="Signature_Examples-proj_ord_LEX"><span class="command">lemma</span></span> proj_ord_LEX <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"proj_ord LEX <span class="main">=</span> LEX"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nat_term_compare <span class="main">(</span>proj_ord LEX<span class="main">)</span> <span class="main">=</span> nat_term_compare LEX"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nat_term_compare_proj_ord nat_term_compare_LEX proj_comp_def lex_comp
        lex_comp_aux_def rep_nat_term_prod_def rep_nat_term_pp_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> ext <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> order.split<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> nat_term_compare_inject<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Examples-proj_ord_DRLEX"><span class="command">lemma</span></span> proj_ord_DRLEX <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"proj_ord DRLEX <span class="main">=</span> DRLEX"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nat_term_compare <span class="main">(</span>proj_ord DRLEX<span class="main">)</span> <span class="main">=</span> nat_term_compare DRLEX"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nat_term_compare_proj_ord nat_term_compare_DRLEX proj_comp_def deg_comp pot_comp
        lex_comp lex_comp_aux_def rep_nat_term_prod_def rep_nat_term_pp_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> ext <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> order.split<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> nat_term_compare_inject<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Examples-proj_ord_DEG"><span class="command">lemma</span></span> proj_ord_DEG <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"proj_ord <span class="main">(</span>DEG <span class="free">to</span><span class="main">)</span> <span class="main">=</span> DEG <span class="main">(</span>proj_ord <span class="free">to</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nat_term_compare <span class="main">(</span>proj_ord <span class="main">(</span>DEG <span class="free">to</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> nat_term_compare <span class="main">(</span>DEG <span class="main">(</span>proj_ord <span class="free">to</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_term_compare_proj_ord nat_term_compare_DEG proj_comp_def deg_comp
        rep_nat_term_prod_def rep_nat_term_pp_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> nat_term_compare_inject<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Signature_Examples-proj_ord_POT"><span class="command">lemma</span></span> proj_ord_POT <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"proj_ord <span class="main">(</span>POT <span class="free">to</span><span class="main">)</span> <span class="main">=</span> proj_ord <span class="free">to</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nat_term_compare <span class="main">(</span>proj_ord <span class="main">(</span>POT <span class="free">to</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> nat_term_compare <span class="main">(</span>proj_ord <span class="free">to</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_term_compare_proj_ord nat_term_compare_POT proj_comp_def pot_comp
        rep_nat_term_prod_def rep_nat_term_pp_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> nat_term_compare_inject<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Locale Interpretation›</span></span>

<span class="keyword1"><span class="command">locale</span></span> qpm_nat_inf_term <span class="main">=</span> gd_nat_term <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span>"</span></span> <span class="quoted"><span class="free">to</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">to</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>nat<span class="main">,</span> <span class="tfree">'b</span><span class="main">::</span>nat<span class="main">)</span> pp <span class="main">×</span> nat<span class="main">)</span> nat_term_order"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> aux<span class="main">:</span> qpm_inf_term <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span>"</span></span>
        <span class="quoted"><span class="quoted">"le_of_nat_term_order <span class="main">(</span>proj_ord <span class="free">to</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"lt_of_nat_term_order <span class="main">(</span>proj_ord <span class="free">to</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"le_of_nat_term_order <span class="free">to</span>"</span></span>
        <span class="quoted"><span class="quoted">"lt_of_nat_term_order <span class="free">to</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">intro_locales</span>
<span class="comment1">(*
  show "class.preorder (le_of_nat_term_order (proj_ord to)) (lt_of_nat_term_order (proj_ord to))"
    and "class.order_axioms (le_of_nat_term_order (proj_ord to))"
    and "class.linorder_axioms (le_of_nat_term_order (proj_ord to))"
    using linorder_le_of_nat_term_order[of "proj_ord to"] by (simp_all add: class.linorder_def class.order_def)
next*)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ordered_powerprod_axioms <span class="main">(</span>le_of_nat_term_order <span class="main">(</span>proj_ord <span class="free">to</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span> le_of_nat_term_order_zero_min<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> le_of_nat_term_order_plus_monotone <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ordered_term_axioms <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>le_of_nat_term_order <span class="main">(</span>proj_ord <span class="free">to</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>le_of_nat_term_order <span class="free">to</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="skolem">w</span> <span class="skolem">t</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"le_of_nat_term_order <span class="free">to</span> <span class="skolem">v</span> <span class="skolem">w</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"le_of_nat_term_order <span class="free">to</span> <span class="main">(</span>local.splus <span class="skolem">t</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">(</span>local.splus <span class="skolem">t</span> <span class="skolem">w</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_of_nat_term_order nat_term_compare_splus splus_eq_splus<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="skolem">w</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"le_of_nat_term_order <span class="main">(</span>proj_ord <span class="free">to</span><span class="main">)</span> <span class="main">(</span>pp_of_term <span class="skolem">v</span><span class="main">)</span> <span class="main">(</span>pp_of_term <span class="skolem">w</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"component_of_term <span class="skolem">v</span> <span class="main">≤</span> component_of_term <span class="skolem">w</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"nat_term_compare <span class="free">to</span> <span class="main">(</span>fst <span class="skolem">v</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>fst <span class="skolem">w</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">≠</span> Gt"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"snd <span class="skolem">v</span> <span class="main">≤</span> snd <span class="skolem">w</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_of_nat_term_order nat_term_compare_proj_ord proj_comp_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> comparator_nat_term_compare nat_term_comp_nat_term_compare _ _ _ _ this<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"nat_term_compare <span class="free">to</span> <span class="skolem">v</span> <span class="skolem">w</span> <span class="main">≠</span> Gt"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nat_term_compD4''<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rep_nat_term_prod_def ord_iff<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> <span class="quoted"><span class="quoted">‹snd <span class="skolem">v</span> <span class="main">≤</span> snd <span class="skolem">w</span>›</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"le_of_nat_term_order <span class="free">to</span> <span class="skolem">v</span> <span class="skolem">w</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_of_nat_term_order<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We must define the following two constants outside the global interpretation, since otherwise
  their types are too general.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">splus_pprod</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>nat<span class="main">,</span> <span class="tfree">'b</span><span class="main">::</span>nat<span class="main">)</span> pp <span class="main">⇒</span> <span class="main">_</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">splus_pprod</span> <span class="main">=</span> pprod.splus"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">adds_term_pprod</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>nat<span class="main">,</span> <span class="tfree">'b</span><span class="main">::</span>nat<span class="main">)</span> pp <span class="main">×</span> <span class="main">_</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">_</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">adds_term_pprod</span> <span class="main">=</span> pprod.adds_term"</span></span>

<span class="keyword1"><span class="command">global_interpretation</span></span> pprod'<span class="main">:</span> qpm_nat_inf_term <span class="quoted"><span class="free">to</span></span>
  <span class="keyword2"><span class="keyword">rewrites</span></span> <span class="quoted"><span class="quoted">"pprod.pp_of_term <span class="main">=</span> fst"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"pprod.component_of_term <span class="main">=</span> snd"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"pprod.splus <span class="main">=</span> splus_pprod"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"pprod.adds_term <span class="main">=</span> adds_term_pprod"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"punit.monom_mult <span class="main">=</span> monom_mult_punit"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"pprod'.aux.punit.lt <span class="main">=</span> lt_punit <span class="main">(</span>proj_ord <span class="free">to</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"pprod'.aux.punit.lc <span class="main">=</span> lc_punit <span class="main">(</span>proj_ord <span class="free">to</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"pprod'.aux.punit.tail <span class="main">=</span> tail_punit <span class="main">(</span>proj_ord <span class="free">to</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">to</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>nat<span class="main">,</span> <span class="tfree">'b</span><span class="main">::</span>nat<span class="main">)</span> pp <span class="main">×</span> nat<span class="main">)</span> nat_term_order"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> max_pprod <span class="main">=</span> <span class="quoted">pprod'.ord_term_lin.max</span>
  <span class="keyword2"><span class="keyword">and</span></span> Koszul_syz_sigs_aux_pprod <span class="main">=</span> <span class="quoted">pprod'.aux.Koszul_syz_sigs_aux</span>
  <span class="keyword2"><span class="keyword">and</span></span> Koszul_syz_sigs_pprod <span class="main">=</span> <span class="quoted">pprod'.aux.Koszul_syz_sigs</span>
  <span class="keyword2"><span class="keyword">and</span></span> find_sig_reducer_pprod <span class="main">=</span> <span class="quoted">pprod'.aux.find_sig_reducer</span>
  <span class="keyword2"><span class="keyword">and</span></span> sig_trd_spp_body_pprod <span class="main">=</span> <span class="quoted">pprod'.aux.sig_trd_spp_body</span>
  <span class="keyword2"><span class="keyword">and</span></span> sig_trd_spp_aux_pprod <span class="main">=</span> <span class="quoted">pprod'.aux.sig_trd_spp_aux</span>
  <span class="keyword2"><span class="keyword">and</span></span> sig_trd_spp_pprod <span class="main">=</span> <span class="quoted">pprod'.aux.sig_trd_spp</span>
  <span class="keyword2"><span class="keyword">and</span></span> spair_sigs_spp_pprod <span class="main">=</span> <span class="quoted">pprod'.aux.spair_sigs_spp</span>
  <span class="keyword2"><span class="keyword">and</span></span> is_pred_syz_pprod <span class="main">=</span> <span class="quoted">pprod'.aux.is_pred_syz</span>
  <span class="keyword2"><span class="keyword">and</span></span> is_rewritable_spp_pprod <span class="main">=</span> <span class="quoted">pprod'.aux.is_rewritable_spp</span>
  <span class="keyword2"><span class="keyword">and</span></span> sig_crit_spp_pprod <span class="main">=</span> <span class="quoted">pprod'.aux.sig_crit_spp</span>
  <span class="keyword2"><span class="keyword">and</span></span> spair_spp_pprod <span class="main">=</span> <span class="quoted">pprod'.aux.spair_spp</span>
  <span class="keyword2"><span class="keyword">and</span></span> spp_of_pair_pprod <span class="main">=</span> <span class="quoted">pprod'.aux.spp_of_pair</span>
  <span class="keyword2"><span class="keyword">and</span></span> pair_ord_spp_pprod <span class="main">=</span> <span class="quoted">pprod'.aux.pair_ord_spp</span>
  <span class="keyword2"><span class="keyword">and</span></span> sig_of_pair_spp_pprod <span class="main">=</span> <span class="quoted">pprod'.aux.sig_of_pair_spp</span>
  <span class="keyword2"><span class="keyword">and</span></span> new_spairs_spp_pprod <span class="main">=</span> <span class="quoted">pprod'.aux.new_spairs_spp</span>
  <span class="keyword2"><span class="keyword">and</span></span> is_regular_spair_spp_pprod <span class="main">=</span> <span class="quoted">pprod'.aux.is_regular_spair_spp</span>
  <span class="keyword2"><span class="keyword">and</span></span> add_spairs_spp_pprod <span class="main">=</span> <span class="quoted">pprod'.aux.add_spairs_spp</span>
  <span class="keyword2"><span class="keyword">and</span></span> is_pot_ord_pprod <span class="main">=</span> <span class="quoted">pprod'.is_pot_ord</span>
  <span class="keyword2"><span class="keyword">and</span></span> new_syz_sigs_spp_pprod <span class="main">=</span> <span class="quoted">pprod'.aux.new_syz_sigs_spp</span>
  <span class="keyword2"><span class="keyword">and</span></span> rb_spp_body_pprod <span class="main">=</span> <span class="quoted">pprod'.aux.rb_spp_body</span>
  <span class="keyword2"><span class="keyword">and</span></span> rb_spp_aux_pprod <span class="main">=</span> <span class="quoted">pprod'.aux.rb_spp_aux</span>
  <span class="keyword2"><span class="keyword">and</span></span> gb_sig_z_pprod' <span class="main">=</span> <span class="quoted">pprod'.aux.gb_sig_z</span>
  <span class="keyword2"><span class="keyword">and</span></span> gb_sig_pprod' <span class="main">=</span> <span class="quoted">pprod'.aux.gb_sig</span>
  <span class="keyword2"><span class="keyword">and</span></span> rw_rat_strict_pprod <span class="main">=</span> <span class="quoted">pprod'.aux.rw_rat_strict</span>
  <span class="keyword2"><span class="keyword">and</span></span> rw_add_strict_pprod <span class="main">=</span> <span class="quoted">pprod'.aux.rw_add_strict</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> qpm_nat_inf_term.intro<span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span> gd_nat_term_id<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> pprod_pp_of_term<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> pprod_component_of_term<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> splus_pprod_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> adds_term_pprod_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> monom_mult_punit_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> lt_punit_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> lc_punit_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> tail_punit_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹More Lemmas and Definitions›</span></span>

<span class="keyword1" id="Signature_Examples-compute_adds_term_pprod"><span class="command">lemma</span></span> compute_adds_term_pprod <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"adds_term_pprod <span class="free">u</span> <span class="free">v</span> <span class="main">=</span> <span class="main">(</span>snd <span class="free">u</span> <span class="main">=</span> snd <span class="free">v</span> <span class="main">∧</span> adds_pp_add_linorder <span class="main">(</span>fst <span class="free">u</span><span class="main">)</span> <span class="main">(</span>fst <span class="free">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> adds_term_pprod_def pprod.adds_term_def adds_pp_add_linorder_def<span class="main">)</span>

<span class="keyword1" id="Signature_Examples-compute_splus_pprod"><span class="command">lemma</span></span> compute_splus_pprod <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"splus_pprod <span class="free">t</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span> <span class="free">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">t</span> <span class="main">+</span> <span class="free">s</span><span class="main">,</span> <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> splus_pprod_def pprod.splus_def<span class="main">)</span>

<span class="keyword1" id="Signature_Examples-compute_sig_trd_spp_body_pprod"><span class="command">lemma</span></span> compute_sig_trd_spp_body_pprod <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"sig_trd_spp_body_pprod <span class="free">to</span> <span class="free">bs</span> <span class="free">v</span> <span class="main">(</span><span class="free">p</span><span class="main">,</span> <span class="free">r</span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">case</span> find_sig_reducer_pprod <span class="free">to</span> <span class="free">bs</span> <span class="free">v</span> <span class="main">(</span>lt_punit <span class="main">(</span>proj_ord <span class="free">to</span><span class="main">)</span> <span class="free">p</span><span class="main">)</span> <span class="main">0</span> <span class="keyword1">of</span>
        None   <span class="main">⇒</span> <span class="main">(</span>tail_punit <span class="main">(</span>proj_ord <span class="free">to</span><span class="main">)</span> <span class="free">p</span><span class="main">,</span> plus_monomial_less <span class="free">r</span> <span class="main">(</span>lc_punit <span class="main">(</span>proj_ord <span class="free">to</span><span class="main">)</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span>lt_punit <span class="main">(</span>proj_ord <span class="free">to</span><span class="main">)</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span>
      <span class="main">|</span> Some <span class="bound">i</span> <span class="main">⇒</span> <span class="keyword1">let</span> <span class="bound">b</span> <span class="main">=</span> snd <span class="main">(</span><span class="free">bs</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span> <span class="keyword1">in</span>
          <span class="main">(</span>tail_punit <span class="main">(</span>proj_ord <span class="free">to</span><span class="main">)</span> <span class="free">p</span> <span class="main">-</span> monom_mult_punit <span class="main">(</span>lc_punit <span class="main">(</span>proj_ord <span class="free">to</span><span class="main">)</span> <span class="free">p</span> <span class="main">/</span> lc_punit <span class="main">(</span>proj_ord <span class="free">to</span><span class="main">)</span> <span class="bound">b</span><span class="main">)</span>
              <span class="main">(</span>lt_punit <span class="main">(</span>proj_ord <span class="free">to</span><span class="main">)</span> <span class="free">p</span> <span class="main">-</span> lt_punit <span class="main">(</span>proj_ord <span class="free">to</span><span class="main">)</span> <span class="bound">b</span><span class="main">)</span> <span class="main">(</span>tail_punit <span class="main">(</span>proj_ord <span class="free">to</span><span class="main">)</span> <span class="bound">b</span><span class="main">)</span><span class="main">,</span> <span class="free">r</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_monomial_less_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.split<span class="main">)</span>

<span class="keyword1" id="Signature_Examples-compute_sig_trd_spp_pprod"><span class="command">lemma</span></span> compute_sig_trd_spp_pprod <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"sig_trd_spp_pprod <span class="free">to</span> <span class="free">bs</span> <span class="main">(</span><span class="free">v</span><span class="main">,</span> <span class="free">p</span><span class="main">)</span> <span class="main">≡</span> <span class="main">(</span><span class="free">v</span><span class="main">,</span> sig_trd_spp_aux_pprod <span class="free">to</span> <span class="free">bs</span> <span class="free">v</span> <span class="main">(</span><span class="free">p</span><span class="main">,</span> change_ord <span class="main">(</span>proj_ord <span class="free">to</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> change_ord_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> <span class="main">[</span><span class="operator">code</span><span class="main">]</span> <span class="main">=</span> conversep_iff

<span class="keyword1" id="Signature_Examples-compute_is_pot_ord"><span class="command">lemma</span></span> compute_is_pot_ord <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"is_pot_ord_pprod <span class="main">(</span>LEX<span class="main">::</span><span class="main">(</span><span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>nat<span class="main">,</span> <span class="tfree">'b</span><span class="main">::</span>nat<span class="main">)</span> pp <span class="main">×</span> nat<span class="main">)</span> nat_term_order<span class="main">)</span> <span class="main">=</span> False"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"is_pot_ord_pprod <span class="var">?lex</span> <span class="main">=</span> <span class="main">_</span>"</span></span><span class="main">)</span>
  <span class="quoted"><span class="quoted">"is_pot_ord_pprod <span class="main">(</span>DRLEX<span class="main">::</span><span class="main">(</span><span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>nat<span class="main">,</span> <span class="tfree">'b</span><span class="main">::</span>nat<span class="main">)</span> pp <span class="main">×</span> nat<span class="main">)</span> nat_term_order<span class="main">)</span> <span class="main">=</span> False"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"is_pot_ord_pprod <span class="var">?drlex</span> <span class="main">=</span> <span class="main">_</span>"</span></span><span class="main">)</span>
  <span class="quoted"><span class="quoted">"is_pot_ord_pprod <span class="main">(</span>DEG <span class="main">(</span><span class="free">to</span><span class="main">::</span><span class="main">(</span><span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>nat<span class="main">,</span> <span class="tfree">'b</span><span class="main">::</span>nat<span class="main">)</span> pp <span class="main">×</span> nat<span class="main">)</span> nat_term_order<span class="main">)</span><span class="main">)</span> <span class="main">=</span> False"</span></span>
  <span class="quoted"><span class="quoted">"is_pot_ord_pprod <span class="main">(</span>POT <span class="main">(</span><span class="free">to</span><span class="main">::</span><span class="main">(</span><span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>nat<span class="main">,</span> <span class="tfree">'b</span><span class="main">::</span>nat<span class="main">)</span> pp <span class="main">×</span> nat<span class="main">)</span> nat_term_order<span class="main">)</span><span class="main">)</span> <span class="main">=</span> True"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> eq1<span class="main">:</span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span><span class="main">(</span>Term_Order.of_exps <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">i</span><span class="main">)</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> pp <span class="main">×</span> nat<span class="main">)</span> <span class="main">=</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">i</span><span class="main">::</span><span class="quoted">nat</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span><span class="main">(</span>Term_Order.of_exps <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">i</span><span class="main">)</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> pp <span class="main">×</span> nat<span class="main">)</span> <span class="main">=</span>
          snd <span class="main">(</span>rep_nat_term <span class="main">(</span><span class="main">(</span>Term_Order.of_exps <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">i</span><span class="main">)</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> pp <span class="main">×</span> nat<span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rep_nat_term_prod_def rep_nat_nat_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">i</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> snd_of_exps<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>rep_nat_term <span class="main">(</span>undefined<span class="main">,</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rep_nat_term_prod_def rep_nat_nat_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?u</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Term_Order.of_exps <span class="main">1</span> <span class="main">0</span> <span class="main">0</span><span class="main">)</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> pp <span class="main">×</span> nat"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?v</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Term_Order.of_exps <span class="main">0</span> <span class="main">0</span> <span class="main">1</span><span class="main">)</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> pp <span class="main">×</span> nat"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_pot_ord_pprod <span class="var">?lex</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_pot_ord_pprod <span class="var">?lex</span>"</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"le_of_nat_term_order <span class="var">?lex</span> <span class="var">?v</span> <span class="var">?u</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_of_nat_term_order nat_term_compare_LEX lex_comp lex_comp_aux_def
            comp_of_ord_def lex_pp_of_exps eq_of_exps<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"snd <span class="var">?v</span> <span class="main">≤</span> snd <span class="var">?u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pprod'.is_pot_ordD2<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq1<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"is_pot_ord_pprod <span class="var">?lex</span> <span class="main">=</span> False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_pot_ord_pprod <span class="var">?drlex</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_pot_ord_pprod <span class="var">?drlex</span>"</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"le_of_nat_term_order <span class="var">?drlex</span> <span class="var">?v</span> <span class="var">?u</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_of_nat_term_order nat_term_compare_DRLEX deg_comp comparator_of_def<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"snd <span class="var">?v</span> <span class="main">≤</span> snd <span class="var">?u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pprod'.is_pot_ordD2<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq1<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"is_pot_ord_pprod <span class="var">?drlex</span> <span class="main">=</span> False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_pot_ord_pprod <span class="main">(</span>DEG <span class="free">to</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_pot_ord_pprod <span class="main">(</span>DEG <span class="free">to</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"le_of_nat_term_order <span class="main">(</span>DEG <span class="free">to</span><span class="main">)</span> <span class="var">?v</span> <span class="var">?u</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_of_nat_term_order nat_term_compare_DEG deg_comp comparator_of_def<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"snd <span class="var">?v</span> <span class="main">≤</span> snd <span class="var">?u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pprod'.is_pot_ordD2<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq1<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"is_pot_ord_pprod <span class="main">(</span>DEG <span class="free">to</span><span class="main">)</span> <span class="main">=</span> False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_pot_ord_pprod <span class="main">(</span>POT <span class="free">to</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pprod'.is_pot_ordI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lt_of_nat_term_order nat_term_compare_POT pot_comp rep_nat_term_prod_def<span class="main"><span class="keyword3">,</span></span>
        <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comparator_of_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"is_pot_ord_pprod <span class="main">(</span>POT <span class="free">to</span><span class="main">)</span> <span class="main">=</span> True"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> is_pot_ord_POT<span class="main">:</span> <span class="quoted"><span class="quoted">"is_pot_ord_pprod <span class="main">(</span>POT <span class="free">to</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> compute_is_pot_ord<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">gb_sig_z_pprod</span> <span class="free"><span class="bound"><span class="entity">to</span></span></span> <span class="free"><span class="bound"><span class="entity">rword_strict</span></span></span> <span class="free"><span class="bound"><span class="entity">fs</span></span></span> <span class="main">≡</span>
                  <span class="main">(</span><span class="keyword1">let</span> <span class="bound">res</span> <span class="main">=</span> gb_sig_z_pprod' <span class="free"><span class="bound"><span class="entity">to</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">rword_strict</span></span></span> <span class="free"><span class="bound"><span class="entity">to</span></span></span><span class="main">)</span> <span class="main">(</span>map <span class="main">(</span>change_ord <span class="main">(</span>proj_ord <span class="free"><span class="bound"><span class="entity">to</span></span></span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">fs</span></span></span><span class="main">)</span> <span class="keyword1">in</span>
                    <span class="main">(</span>length <span class="main">(</span>fst <span class="bound">res</span><span class="main">)</span><span class="main">,</span> snd <span class="bound">res</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">gb_sig_pprod</span> <span class="free"><span class="bound"><span class="entity">to</span></span></span> <span class="free"><span class="bound"><span class="entity">rword_strict</span></span></span> <span class="free"><span class="bound"><span class="entity">fs</span></span></span> <span class="main">≡</span> gb_sig_pprod' <span class="free"><span class="bound"><span class="entity">to</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">rword_strict</span></span></span> <span class="free"><span class="bound"><span class="entity">to</span></span></span><span class="main">)</span> <span class="main">(</span>map <span class="main">(</span>change_ord <span class="main">(</span>proj_ord <span class="free"><span class="bound"><span class="entity">to</span></span></span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">fs</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Signature_Examples-snd_gb_sig_z_pprod'_eq_gb_sig_z_pprod"><span class="command">lemma</span></span> snd_gb_sig_z_pprod'_eq_gb_sig_z_pprod<span class="main">:</span>
  <span class="quoted"><span class="quoted">"snd <span class="main">(</span>gb_sig_z_pprod' <span class="free">to</span> <span class="main">(</span><span class="free">rword_strict</span> <span class="free">to</span><span class="main">)</span> <span class="free">fs</span><span class="main">)</span> <span class="main">=</span> snd <span class="main">(</span>gb_sig_z_pprod <span class="free">to</span> <span class="free">rword_strict</span> <span class="free">fs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gb_sig_z_pprod_def change_ord_def Let_def<span class="main">)</span>

<span class="keyword1" id="Signature_Examples-gb_sig_pprod'_eq_gb_sig_pprod"><span class="command">lemma</span></span> gb_sig_pprod'_eq_gb_sig_pprod<span class="main">:</span>
  <span class="quoted"><span class="quoted">"gb_sig_pprod' <span class="free">to</span> <span class="main">(</span><span class="free">rword_strict</span> <span class="free">to</span><span class="main">)</span> <span class="free">fs</span> <span class="main">=</span> gb_sig_pprod <span class="free">to</span> <span class="free">rword_strict</span> <span class="free">fs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gb_sig_pprod_def change_ord_def<span class="main">)</span>

<span class="keyword1"><span class="command">thm</span></span> pprod'.aux.gb_sig_isGB<span class="main">[</span><span class="operator">OF</span> pprod'.aux.rw_rat_strict_is_strict_rewrite_ord<span class="main">,</span> <span class="operator">simplified</span> gb_sig_pprod'_eq_gb_sig_pprod<span class="main">]</span>
<span class="keyword1"><span class="command">thm</span></span> pprod'.aux.gb_sig_no_zero_red<span class="main">[</span><span class="operator">OF</span> pprod'.aux.rw_rat_strict_is_strict_rewrite_ord is_pot_ord_POT<span class="main">,</span> <span class="operator">simplified</span> snd_gb_sig_z_pprod'_eq_gb_sig_z_pprod<span class="main">]</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Computations›</span></span>

<span class="keyword1"><span class="command">experiment</span></span> <span class="keyword2"><span class="keyword">begin</span></span> <span class="keyword1"><span class="command">interpretation</span></span> trivariate<span class="hidden">⇩</span><sub>0</sub>_rat <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="quoted"><span class="quoted">"gb_sig_pprod DRLEX rw_rat_strict_pprod <span class="main">[</span>X<span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> Z <span class="main">^</span> <span class="numeral">3</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">*</span> X<span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> Y<span class="main">,</span> X <span class="main">*</span> Y <span class="main">*</span> Z <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> Y<span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">]</span> <span class="main">=</span>
    <span class="main">[</span>C<span class="hidden">⇩</span><sub>0</sub> <span class="main">(</span><span class="numeral">3</span> <span class="main">/</span> <span class="numeral">4</span><span class="main">)</span> <span class="main">*</span> X <span class="main">^</span> <span class="numeral">3</span> <span class="main">*</span> Y<span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> Y <span class="main">^</span> <span class="numeral">4</span><span class="main">,</span> <span class="main">-</span> <span class="numeral">4</span> <span class="main">*</span> Y <span class="main">^</span> <span class="numeral">3</span> <span class="main">*</span> Z <span class="main">-</span> <span class="numeral">3</span> <span class="main">*</span> X<span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> Y<span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">,</span> X <span class="main">*</span> Y <span class="main">*</span> Z <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> Y<span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">,</span> X<span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> Z <span class="main">^</span> <span class="numeral">3</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">*</span> X<span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> Y<span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Recall that the first return value of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> gb_sig_z_pprod<span class="antiquote"><span class="antiquote">}</span></span></span></span> is the size of the computed
  Gr\"obner basis, and the second return value is the total number of useless zero-reductions:›</span></span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="quoted"><span class="quoted">"gb_sig_z_pprod <span class="main">(</span>POT DRLEX<span class="main">)</span> rw_rat_strict_pprod <span class="main">(</span><span class="main">(</span>cyclic DRLEX <span class="numeral">6</span><span class="main">)</span><span class="main">::</span><span class="main">(</span><span class="main">_</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> rat<span class="main">)</span> list<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">155</span><span class="main">,</span> <span class="numeral">8</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="quoted"><span class="quoted">"gb_sig_z_pprod <span class="main">(</span>POT DRLEX<span class="main">)</span> rw_rat_strict_pprod <span class="main">(</span><span class="main">(</span>katsura DRLEX <span class="numeral">5</span><span class="main">)</span><span class="main">::</span><span class="main">(</span><span class="main">_</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> rat<span class="main">)</span> list<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">29</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="quoted"><span class="quoted">"gb_sig_z_pprod <span class="main">(</span>POT DRLEX<span class="main">)</span> rw_rat_strict_pprod <span class="main">(</span><span class="main">(</span>eco DRLEX <span class="numeral">8</span><span class="main">)</span><span class="main">::</span><span class="main">(</span><span class="main">_</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> rat<span class="main">)</span> list<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">76</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="quoted"><span class="quoted">"gb_sig_z_pprod <span class="main">(</span>POT DRLEX<span class="main">)</span> rw_rat_strict_pprod <span class="main">(</span><span class="main">(</span>noon DRLEX <span class="numeral">5</span><span class="main">)</span><span class="main">::</span><span class="main">(</span><span class="main">_</span> <span class="main">⇒<span class="hidden">⇩</span><sub>0</sub></span> rat<span class="main">)</span> list<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">83</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* theory *)</span>
</pre>
</div>