<div id="Ferraris_Formula">
<div class="head">
<h1>Theory Ferraris_Formula</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Ferrari's formula for solving quartic equations›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Ferraris_Formula
  <span class="keyword2"><span class="keyword">imports</span></span> 
    <a href="../../polynomial_factorization/theories/#Explicit_Roots">Polynomial_Factorization.Explicit_Roots</a>
    <a href="../../polynomial_interpolation/theories/#Ring_Hom_Poly">Polynomial_Interpolation.Ring_Hom_Poly</a>
    <a href="../../complex_geometry/theories/#More_Complex">Complex_Geometry.More_Complex</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Translation to depressed case›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Solving an arbitrary quartic equation can easily be turned into the depressed case, i.e., where
  there is no cubic part.›</span></span>

<span class="keyword1" id="Ferraris_Formula-to_depressed_quartic"><span class="command">lemma</span></span> to_depressed_quartic<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a4</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> field_char_0"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a4</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="free">a3</span> <span class="main">/</span> <span class="free">a4</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">=</span> <span class="free">a2</span> <span class="main">/</span> <span class="free">a4</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">=</span> <span class="free">a1</span> <span class="main">/</span> <span class="free">a4</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> <span class="free">a0</span> <span class="main">/</span> <span class="free">a4</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="free">c</span> <span class="main">-</span> <span class="main">(</span><span class="numeral">3</span><span class="main">/</span><span class="numeral">8</span><span class="main">)</span> <span class="main">*</span> <span class="free">b</span><span class="main">^</span><span class="numeral">2</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="main">(</span><span class="free">b</span><span class="main">^</span><span class="numeral">3</span> <span class="main">-</span> <span class="numeral">4</span><span class="main">*</span><span class="free">b</span><span class="main">*</span><span class="free">c</span> <span class="main">+</span> <span class="numeral">8</span> <span class="main">*</span> <span class="free">d</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">8</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">=</span> <span class="main">(</span> <span class="main">-</span><span class="numeral">3</span> <span class="main">*</span> <span class="free">b</span><span class="main">^</span><span class="numeral">4</span> <span class="main">+</span> <span class="numeral">256</span> <span class="main">*</span> <span class="free">e</span> <span class="main">-</span> <span class="numeral">64</span> <span class="main">*</span> <span class="free">b</span> <span class="main">*</span> <span class="free">d</span> <span class="main">+</span> <span class="numeral">16</span> <span class="main">*</span> <span class="free">b</span><span class="main">^</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">c</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">256</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">y</span> <span class="main">-</span> <span class="free">b</span><span class="main">/</span><span class="numeral">4</span>"</span></span> 
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a4</span> <span class="main">*</span> <span class="free">x</span><span class="main">^</span><span class="numeral">4</span> <span class="main">+</span> <span class="free">a3</span> <span class="main">*</span> <span class="free">x</span><span class="main">^</span><span class="numeral">3</span> <span class="main">+</span> <span class="free">a2</span> <span class="main">*</span> <span class="free">x</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">a1</span> <span class="main">*</span> <span class="free">x</span> <span class="main">+</span> <span class="free">a0</span> <span class="main">=</span> <span class="main">0</span> 
  <span class="main">⟷</span> <span class="free">y</span><span class="main">^</span><span class="numeral">4</span> <span class="main">+</span> <span class="free">p</span> <span class="main">*</span> <span class="free">y</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">q</span> <span class="main">*</span> <span class="free">y</span> <span class="main">+</span> <span class="free">r</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a4</span> <span class="main">*</span> <span class="free">x</span><span class="main">^</span><span class="numeral">4</span> <span class="main">+</span> <span class="free">a3</span> <span class="main">*</span> <span class="free">x</span><span class="main">^</span><span class="numeral">3</span> <span class="main">+</span> <span class="free">a2</span> <span class="main">*</span> <span class="free">x</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">a1</span> <span class="main">*</span> <span class="free">x</span> <span class="main">+</span> <span class="free">a0</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span>
    <span class="main">(</span><span class="free">a4</span> <span class="main">*</span> <span class="free">x</span><span class="main">^</span><span class="numeral">4</span> <span class="main">+</span> <span class="free">a3</span> <span class="main">*</span> <span class="free">x</span><span class="main">^</span><span class="numeral">3</span> <span class="main">+</span> <span class="free">a2</span> <span class="main">*</span> <span class="free">x</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">a1</span> <span class="main">*</span> <span class="free">x</span> <span class="main">+</span> <span class="free">a0</span><span class="main">)</span> <span class="main">/</span> <span class="free">a4</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a4</span> <span class="main">*</span> <span class="free">x</span><span class="main">^</span><span class="numeral">4</span> <span class="main">+</span> <span class="free">a3</span> <span class="main">*</span> <span class="free">x</span><span class="main">^</span><span class="numeral">3</span> <span class="main">+</span> <span class="free">a2</span> <span class="main">*</span> <span class="free">x</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">a1</span> <span class="main">*</span> <span class="free">x</span> <span class="main">+</span> <span class="free">a0</span><span class="main">)</span> <span class="main">/</span> <span class="free">a4</span>
    <span class="main">=</span> <span class="free">x</span><span class="main">^</span><span class="numeral">4</span> <span class="main">+</span> <span class="free">b</span> <span class="main">*</span> <span class="free">x</span><span class="main">^</span><span class="numeral">3</span> <span class="main">+</span> <span class="free">c</span> <span class="main">*</span> <span class="free">x</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">d</span> <span class="main">*</span> <span class="free">x</span> <span class="main">+</span> <span class="free">e</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> b c d e <span class="keyword1"><span class="command">using</span></span> a4 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">y</span><span class="main">^</span><span class="numeral">4</span> <span class="main">+</span> <span class="free">p</span> <span class="main">*</span> <span class="free">y</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">q</span> <span class="main">*</span> <span class="free">y</span> <span class="main">+</span> <span class="free">r</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> x p q r
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> power4_eq_xxxx power3_eq_cube power2_eq_square<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Ferraris_Formula-biquadratic_solution"><span class="command">lemma</span></span> biquadratic_solution<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> field_char_0"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main">^</span><span class="numeral">4</span> <span class="main">+</span> <span class="free">p</span> <span class="main">*</span> <span class="free">y</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">q</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">z</span><span class="main">.</span> <span class="bound">z</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">p</span> <span class="main">*</span> <span class="bound">z</span> <span class="main">+</span> <span class="free">q</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">=</span> <span class="free">y</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> power4_eq_xxxx power2_eq_square<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Solving the depressed case via Ferrari's formula›</span></span>

<span class="keyword1" id="Ferraris_Formula-depressed_quartic_Ferrari"><span class="command">lemma</span></span> depressed_quartic_Ferrari<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span> <span class="free">r</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> field_char_0"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> cubic_root<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">8</span><span class="main">*</span><span class="free">m</span><span class="main">^</span><span class="numeral">3</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">8</span> <span class="main">*</span> <span class="free">p</span><span class="main">)</span> <span class="main">*</span> <span class="free">m</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">p</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="numeral">8</span> <span class="main">*</span> <span class="free">r</span><span class="main">)</span> <span class="main">*</span> <span class="free">m</span> <span class="main">-</span> <span class="free">q</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> q0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>  <span class="comment1">― ‹otherwise m might be zero, so a is zero and then there is a division by zero in b1 and b2›</span>
  <span class="keyword2"><span class="keyword">and</span></span> sqrt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">*</span> <span class="free">a</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">m</span>"</span></span>  <span class="comment1">(* a = sqrt(2m), where the square-root might not be defined *)</span>
  <span class="keyword2"><span class="keyword">and</span></span> b1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b1</span> <span class="main">=</span> <span class="free">p</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span> <span class="free">m</span> <span class="main">-</span> <span class="free">q</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">a</span><span class="main">)</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> b2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b2</span> <span class="main">=</span> <span class="free">p</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span> <span class="free">m</span> <span class="main">+</span> <span class="free">q</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">a</span><span class="main">)</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main">^</span><span class="numeral">4</span> <span class="main">+</span> <span class="free">p</span> <span class="main">*</span> <span class="free">y</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">q</span> <span class="main">*</span> <span class="free">y</span> <span class="main">+</span> <span class="free">r</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> poly <span class="main">[:</span><span class="free">b1</span><span class="main">,</span><span class="free">a</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> poly <span class="main">[:</span><span class="free">b2</span><span class="main">,</span><span class="main">-</span><span class="free">a</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?N</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">p</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span> <span class="free">m</span>"</span></span> 
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">*</span> <span class="free">y</span> <span class="main">-</span> <span class="free">q</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">a</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">from</span></span> cubic_root q0 <span class="keyword1"><span class="command">have</span></span> m0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> sqrt m0 <span class="keyword1"><span class="command">have</span></span> a0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">N</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">=</span> <span class="var">?N</span>"</span></span> 
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">M</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">=</span> <span class="var">?M</span>"</span></span> 
  <span class="keyword1"><span class="command">note</span></span> powers <span class="main">=</span> <span class="dynamic"><span class="dynamic">field_simps</span></span> power4_eq_xxxx power3_eq_cube power2_eq_square
  <span class="keyword1"><span class="command">from</span></span> cubic_root <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">8</span><span class="main">*</span><span class="free">m</span><span class="main">^</span><span class="numeral">3</span> <span class="main">=</span> <span class="main">-</span> <span class="main">(</span><span class="numeral">8</span> <span class="main">*</span> <span class="free">p</span><span class="main">)</span> <span class="main">*</span> <span class="free">m</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">p</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="numeral">8</span> <span class="main">*</span> <span class="free">r</span><span class="main">)</span> <span class="main">*</span> <span class="free">m</span> <span class="main">+</span> <span class="free">q</span><span class="main">^</span><span class="numeral">2</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powers<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> arg_cong<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(*)</span> <span class="numeral">4</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">32</span> <span class="main">*</span> <span class="free">m</span><span class="main">^</span><span class="numeral">3</span> <span class="main">=</span> <span class="numeral">4</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span> <span class="main">(</span><span class="numeral">8</span> <span class="main">*</span> <span class="free">p</span><span class="main">)</span> <span class="main">*</span> <span class="free">m</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">p</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="numeral">8</span> <span class="main">*</span> <span class="free">r</span><span class="main">)</span> <span class="main">*</span> <span class="free">m</span> <span class="main">+</span> <span class="free">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?add</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="free">y</span><span class="main">^</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">m</span> <span class="main">+</span> <span class="free">p</span> <span class="main">*</span> <span class="free">m</span> <span class="main">+</span> <span class="free">m</span><span class="main">^</span><span class="numeral">2</span>"</span></span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main">^</span><span class="numeral">4</span> <span class="main">+</span> <span class="free">p</span> <span class="main">*</span> <span class="free">y</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">q</span> <span class="main">*</span> <span class="free">y</span> <span class="main">+</span> <span class="free">r</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span>
      <span class="main">(</span><span class="free">y</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">p</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="main">-</span><span class="free">q</span> <span class="main">*</span> <span class="free">y</span> <span class="main">-</span> <span class="free">r</span> <span class="main">+</span> <span class="free">p</span><span class="main">^</span><span class="numeral">2</span> <span class="main">/</span> <span class="numeral">4</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powers<span class="main"><span class="keyword3">,</span></span> <span class="operator">algebra</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">y</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">p</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="var">?add</span> <span class="main">=</span> <span class="main">-</span><span class="free">q</span> <span class="main">*</span> <span class="free">y</span> <span class="main">-</span> <span class="free">r</span> <span class="main">+</span> <span class="free">p</span><span class="main">^</span><span class="numeral">2</span> <span class="main">/</span> <span class="numeral">4</span> <span class="main">+</span> <span class="var">?add</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="var">?N</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">m</span> <span class="main">*</span> <span class="free">y</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="free">q</span> <span class="main">*</span> <span class="free">y</span> <span class="main">+</span> <span class="free">m</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="free">p</span> <span class="main">+</span> <span class="free">p</span><span class="main">^</span><span class="numeral">2</span> <span class="main">/</span> <span class="numeral">4</span> <span class="main">-</span> <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powers<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="free">m</span> <span class="main">*</span> <span class="free">y</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="free">q</span> <span class="main">*</span> <span class="free">y</span> <span class="main">+</span> <span class="free">m</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">m</span> <span class="main">*</span> <span class="free">p</span> <span class="main">+</span> <span class="free">p</span><span class="main">^</span><span class="numeral">2</span> <span class="main">/</span> <span class="numeral">4</span> <span class="main">-</span> <span class="free">r</span> <span class="main">=</span> 
         <span class="var">?M</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> m0 id a0 sqrt <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powers<span class="main"><span class="keyword3">,</span></span> <span class="operator">algebra</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?N</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="var">?M</span><span class="main">^</span><span class="numeral">2</span> <span class="main">⟷</span> <span class="main">(</span><span class="var">?N</span> <span class="main">+</span> <span class="var">?M</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="var">?N</span> <span class="main">-</span> <span class="var">?M</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> N_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> M_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">algebra</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="var">?N</span> <span class="main">+</span> <span class="var">?M</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="var">?N</span> <span class="main">-</span> <span class="var">?M</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?N</span> <span class="main">+</span> <span class="var">?M</span> <span class="main">=</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="free">y</span> <span class="main">+</span> <span class="free">b1</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> b1<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?N</span> <span class="main">-</span> <span class="var">?M</span> <span class="main">=</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="free">a</span> <span class="main">*</span> <span class="free">y</span> <span class="main">+</span> <span class="free">b2</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> b2<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="free">y</span> <span class="main">+</span> <span class="free">b1</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> poly <span class="main">[:</span><span class="free">b1</span><span class="main">,</span><span class="free">a</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powers<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="free">a</span> <span class="main">*</span> <span class="free">y</span> <span class="main">+</span> <span class="free">b2</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> poly <span class="main">[:</span><span class="free">b2</span><span class="main">,</span><span class="main">-</span><span class="free">a</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powers<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Cardanos_Formula">
<div class="head">
<h1>Theory Cardanos_Formula</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Cardano's formula for solving cubic equations›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Cardanos_Formula
  <span class="keyword2"><span class="keyword">imports</span></span> 
    <a href="../../polynomial_factorization/theories/#Explicit_Roots">Polynomial_Factorization.Explicit_Roots</a>
    <a href="../../polynomial_interpolation/theories/#Ring_Hom_Poly">Polynomial_Interpolation.Ring_Hom_Poly</a>
    <a href="../../complex_geometry/theories/#More_Complex">Complex_Geometry.More_Complex</a>
    <a href="../../algebraic_numbers/theories/#Complex_Roots_Real_Poly">Algebraic_Numbers.Complex_Roots_Real_Poly</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Translation to depressed case›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Solving an arbitrary cubic equation can easily be turned into the depressed case, i.e., where
  there is no quadratic part.›</span></span>

<span class="keyword1" id="Cardanos_Formula-to_depressed_cubic"><span class="command">lemma</span></span> to_depressed_cubic<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> field_char_0"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">y</span> <span class="main">-</span> <span class="free">b</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">3</span> <span class="main">*</span> <span class="free">a</span><span class="main">)</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> <span class="main">(</span><span class="free">c</span> <span class="main">-</span> <span class="free">b</span><span class="main">^</span><span class="numeral">2</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">3</span> <span class="main">*</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="free">a</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="free">d</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">b</span><span class="main">^</span><span class="numeral">3</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">27</span> <span class="main">*</span> <span class="free">a</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="free">b</span> <span class="main">*</span> <span class="free">c</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">3</span> <span class="main">*</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="free">a</span>"</span></span> 
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="free">x</span> <span class="main">^</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free">b</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="free">c</span> <span class="main">*</span> <span class="free">x</span> <span class="main">+</span> <span class="free">d</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">y</span><span class="main">^</span><span class="numeral">3</span> <span class="main">+</span> <span class="free">e</span> <span class="main">*</span> <span class="free">y</span> <span class="main">+</span> <span class="free">f</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?yexp</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main">^</span><span class="numeral">3</span> <span class="main">+</span> <span class="free">e</span> <span class="main">*</span> <span class="free">y</span> <span class="main">+</span> <span class="free">f</span>"</span></span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">*</span> <span class="free">x</span><span class="main">^</span><span class="numeral">3</span> <span class="main">+</span> <span class="free">b</span> <span class="main">*</span> <span class="free">x</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">c</span> <span class="main">*</span> <span class="free">x</span> <span class="main">+</span> <span class="free">d</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="free">x</span><span class="main">^</span><span class="numeral">3</span> <span class="main">+</span> <span class="free">b</span> <span class="main">*</span> <span class="free">x</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">c</span> <span class="main">*</span> <span class="free">x</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span> <span class="main">/</span> <span class="free">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="free">x</span><span class="main">^</span><span class="numeral">3</span> <span class="main">+</span> <span class="free">b</span> <span class="main">*</span> <span class="free">x</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">c</span> <span class="main">*</span> <span class="free">x</span> <span class="main">+</span> <span class="free">d</span><span class="main">)</span> <span class="main">/</span> <span class="free">a</span> <span class="main">=</span> <span class="var">?yexp</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> xy e f power3_eq_cube power2_eq_square <span class="keyword1"><span class="command">using</span></span> a
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Solving the depressed case in arbitrary fields›</span></span>

<span class="keyword1" id="Cardanos_Formula-cubic_depressed"><span class="command">lemma</span></span> cubic_depressed<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">e</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> field_char_0"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> yz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">z</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="free">y</span> <span class="main">*</span> <span class="free">z</span> <span class="main">-</span> <span class="free">e</span> <span class="main">/</span> <span class="numeral">3</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">u</span> <span class="main">=</span> <span class="free">z</span><span class="main">^</span><span class="numeral">3</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> <span class="main">-</span> <span class="main">(</span><span class="free">e</span> <span class="main">^</span> <span class="numeral">3</span> <span class="main">/</span> <span class="numeral">27</span><span class="main">)</span>"</span></span> 
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main">^</span><span class="numeral">3</span> <span class="main">+</span> <span class="free">e</span> <span class="main">*</span> <span class="free">y</span> <span class="main">+</span> <span class="free">f</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">e</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="free">y</span><span class="main">^</span><span class="numeral">3</span> <span class="main">=</span> <span class="main">-</span><span class="free">f</span> <span class="keyword1">else</span> <span class="free">u</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="free">f</span> <span class="main">*</span> <span class="free">u</span> <span class="main">+</span> <span class="free">v</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?yexp</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main">^</span><span class="numeral">3</span> <span class="main">+</span> <span class="free">e</span> <span class="main">*</span> <span class="free">y</span> <span class="main">+</span> <span class="free">f</span>"</span></span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">note</span></span> yz <span class="main">=</span> yz<span class="main">[</span><span class="operator">OF</span> False<span class="main">]</span>
    <span class="keyword1"><span class="command">from</span></span> yz <span class="keyword1"><span class="command">have</span></span> eyz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> <span class="numeral">3</span> <span class="main">*</span> <span class="main">(</span><span class="free">z</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="free">y</span> <span class="main">*</span> <span class="free">z</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> yz False <span class="keyword1"><span class="command">have</span></span> z0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?yexp</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">z</span><span class="main">^</span><span class="numeral">3</span> <span class="main">*</span> <span class="var">?yexp</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> z0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span><span class="main">^</span><span class="numeral">3</span> <span class="main">*</span> <span class="var">?yexp</span> <span class="main">=</span> <span class="free">z</span><span class="main">^</span><span class="numeral">6</span> <span class="main">+</span> <span class="free">f</span> <span class="main">*</span> <span class="free">z</span><span class="main">^</span><span class="numeral">3</span> <span class="main">-</span> <span class="free">e</span><span class="main">^</span><span class="numeral">3</span><span class="main">/</span><span class="numeral">27</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> eyz <span class="keyword1"><span class="command">by</span></span> <span class="operator">algebra</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">u</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">f</span> <span class="main">*</span> <span class="free">u</span> <span class="main">+</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> u<span class="main">[</span><span class="operator">OF</span> False<span class="main">]</span> v <span class="keyword1"><span class="command">by</span></span> <span class="operator">algebra</span>  
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">algebra</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Solving the depressed case for complex numbers›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In the complex-numbers-case, the quadratic equation for u is always solvable,
  and the main challenge here is prove that it does not matter which solution of 
  the quadratic equation is considered (this is the diff:False case in the proof below.)›</span></span>
<span class="keyword1" id="Cardanos_Formula-solve_cubic_depressed_Cardano_complex"><span class="command">lemma</span></span> solve_cubic_depressed_Cardano_complex<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">e</span> <span class="main">::</span> <span class="quoted">complex</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> e0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> <span class="main">-</span> <span class="main">(</span><span class="free">e</span> <span class="main">^</span> <span class="numeral">3</span> <span class="main">/</span> <span class="numeral">27</span><span class="main">)</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">f</span> <span class="main">*</span> <span class="free">u</span> <span class="main">+</span> <span class="free">v</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main">^</span><span class="numeral">3</span> <span class="main">+</span> <span class="free">e</span> <span class="main">*</span> <span class="free">y</span> <span class="main">+</span> <span class="free">f</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">z</span><span class="main">.</span> <span class="bound">z</span><span class="main">^</span><span class="numeral">3</span> <span class="main">=</span> <span class="free">u</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">=</span> <span class="bound">z</span> <span class="main">-</span> <span class="free">e</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">3</span> <span class="main">*</span> <span class="bound">z</span><span class="main">)</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> v e0 <span class="keyword1"><span class="command">have</span></span> v0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> e0 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> <span class="free">e</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="skolem">x</span> <span class="keyword1">else</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">::</span> <span class="quoted">bool</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">note</span></span> main <span class="main">=</span> cubic_depressed<span class="main">[</span><span class="operator">OF</span> _ _ v<span class="main">,</span> <span class="operator">unfolded</span> this<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span><span class="main">^</span><span class="numeral">3</span> <span class="main">=</span> <span class="free">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="skolem">z</span> <span class="main">-</span> <span class="free">e</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">3</span> <span class="main">*</span> <span class="skolem">z</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> u v0 <span class="keyword1"><span class="command">have</span></span> u0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> z u0 <span class="keyword1"><span class="command">have</span></span> z0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> main<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="free">f</span> <span class="main">*</span> <span class="free">u</span> <span class="main">+</span> <span class="free">v</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">=</span> <span class="skolem">z</span><span class="main">^</span><span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> z <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="free">y</span> <span class="main">*</span> <span class="skolem">z</span> <span class="main">-</span> <span class="free">e</span> <span class="main">/</span> <span class="numeral">3</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> y <span class="keyword1"><span class="command">using</span></span> z0
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> power2_eq_square<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?yexp</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main">^</span><span class="numeral">3</span> <span class="main">+</span> <span class="free">e</span> <span class="main">*</span> <span class="free">y</span> <span class="main">+</span> <span class="free">f</span>"</span></span> 
    <span class="keyword1"><span class="command">have</span></span> y0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?yexp</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?l</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="main">[:</span> <span class="main">-</span><span class="free">e</span><span class="main">/</span><span class="numeral">3</span><span class="main">,</span> <span class="main">-</span><span class="free">y</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span>"</span></span> 
    <span class="keyword1"><span class="command">have</span></span> deg<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">p</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> hd <span class="main">(</span>croots2 <span class="skolem">p</span><span class="main">)</span>"</span></span>  
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> set <span class="main">(</span>croots2 <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> croots2_def Let_def z_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> croots2<span class="main">[</span><span class="operator">OF</span> deg<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> pz<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="skolem">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> pz e0 <span class="keyword1"><span class="command">have</span></span> z0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> pz <span class="keyword1"><span class="command">have</span></span> yz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">*</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">z</span> <span class="main">*</span> <span class="skolem">z</span> <span class="main">-</span> <span class="free">e</span> <span class="main">/</span> <span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> arg_cong<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">/</span> <span class="skolem">z</span>"</span></span><span class="main">]</span> z0 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="skolem">z</span> <span class="main">-</span> <span class="free">e</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">3</span> <span class="main">*</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">u</span> <span class="bound">z</span><span class="main">.</span> <span class="bound">u</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="free">f</span> <span class="main">*</span> <span class="bound">u</span> <span class="main">+</span> <span class="free">v</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">z</span><span class="main">^</span><span class="numeral">3</span> <span class="main">=</span> <span class="bound">u</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">=</span> <span class="bound">z</span> <span class="main">-</span> <span class="free">e</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">3</span> <span class="main">*</span> <span class="bound">z</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI conjI<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="skolem">z</span> <span class="main">-</span> <span class="free">e</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">3</span> <span class="main">*</span> <span class="skolem">z</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
      <span class="keyword1"><span class="command">from</span></span> y0 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">=</span> <span class="var">?yexp</span> <span class="main">*</span> <span class="skolem">z</span><span class="main">^</span><span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="skolem">z</span><span class="main">)</span><span class="main">^</span><span class="numeral">3</span> <span class="main">+</span> <span class="free">e</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">z</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">f</span> <span class="main">*</span> <span class="skolem">z</span><span class="main">^</span><span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">algebra</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">z</span><span class="main">^</span><span class="numeral">3</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">f</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">z</span><span class="main">^</span><span class="numeral">3</span><span class="main">)</span> <span class="main">+</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> yz v <span class="keyword1"><span class="command">by</span></span> <span class="operator">algebra</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">z</span><span class="main">^</span><span class="numeral">3</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">f</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">z</span><span class="main">^</span><span class="numeral">3</span><span class="main">)</span> <span class="main">+</span> <span class="free">v</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">uu</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span>
       *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">uu</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="free">f</span> <span class="main">*</span> <span class="skolem">uu</span> <span class="main">+</span> <span class="free">v</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">^</span> <span class="numeral">3</span> <span class="main">=</span> <span class="skolem">uu</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="skolem">z</span> <span class="main">-</span> <span class="free">e</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">3</span> <span class="main">*</span> <span class="skolem">z</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">uu</span> <span class="main">=</span> <span class="free">u</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> diff<span class="main">:</span> False
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="main">[:</span><span class="free">v</span><span class="main">,</span><span class="free">f</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span>"</span></span> 
      <span class="keyword1"><span class="command">have</span></span> p2<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">p</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> poly<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="free">u</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="skolem">uu</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> u *<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> p_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> power2_eq_square<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> u0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">uu</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> poly v0 <span class="keyword1"><span class="command">unfolding</span></span> p_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword1"><span class="command">from</span></span> poly<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="main">-</span><span class="free">u</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="keyword1">dvd</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> poly_eq_0_iff_dvd<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> pq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">*</span> <span class="main">[:</span><span class="main">-</span><span class="free">u</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> poly<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> pq poly_mult<span class="main">]</span> diff <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">q</span> <span class="skolem">uu</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="main">-</span><span class="skolem">uu</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="keyword1">dvd</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> poly_eq_0_iff_dvd<span class="main">)</span>      
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q'</span></span> <span class="keyword2"><span class="keyword">where</span></span> qq'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="skolem">q'</span> <span class="main">*</span> <span class="main">[:</span><span class="main">-</span><span class="skolem">uu</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> pq <span class="keyword1"><span class="command">have</span></span> pq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="skolem">q'</span> <span class="main">*</span> <span class="main">[:</span><span class="main">-</span><span class="skolem">uu</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="main">[:</span><span class="main">-</span><span class="free">u</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> pq<span class="main">[</span><span class="operator">unfolded</span> p_def<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> q'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> arg_cong<span class="main">[</span><span class="operator">OF</span> pq<span class="main">,</span> <span class="operator">of</span> <span class="quoted">degree</span><span class="main">,</span> <span class="operator">unfolded</span> p2<span class="main">]</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">=</span> degree <span class="main">(</span><span class="skolem">q'</span> <span class="main">*</span> <span class="main">[:</span><span class="main">-</span> <span class="skolem">uu</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="main">[:</span><span class="main">-</span> <span class="free">u</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> degree <span class="skolem">q'</span> <span class="main">+</span> degree <span class="main">[:</span><span class="main">-</span> <span class="skolem">uu</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">+</span> degree <span class="main">[:</span><span class="main">-</span> <span class="free">u</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span>"</span></span> 
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> degree_mult_eq<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> q' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult_eq_0_iff pCons_eq_0_iff zero_neq_one<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> degree_mult_eq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> q'<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> degree <span class="skolem">q'</span> <span class="main">+</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> dq<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">q'</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">from</span></span> dq <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> q'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q'</span> <span class="main">=</span> <span class="main">[:</span> <span class="skolem">c</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> degree_eq_zeroE<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> pq<span class="main">[</span><span class="operator">unfolded</span> q' p_def<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> q' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q'</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> pq <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span> <span class="main">-</span><span class="free">u</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="main">[:</span> <span class="main">-</span><span class="skolem">uu</span><span class="main">,</span> <span class="main">1</span> <span class="main">:]</span> <span class="main">=</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">unfolded</span> p_def<span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> prod<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">uu</span> <span class="main">*</span> <span class="free">u</span> <span class="main">=</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> uu<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">=</span> <span class="free">v</span> <span class="main">/</span> <span class="skolem">uu</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> u0 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">zz</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">zz</span> <span class="main">=</span> <span class="main">-</span> <span class="free">e</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">3</span> <span class="main">*</span> <span class="skolem">z</span><span class="main">)</span>"</span></span> 
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="keyword1"><span class="command">using</span></span> *<span class="main">(</span>2-<span class="main">)</span> uu <span class="keyword1"><span class="command">unfolding</span></span> v <span class="keyword1"><span class="command">using</span></span> u0
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">zz</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> zz_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Solving the depressed case for real numbers›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">discriminant_cubic_depressed</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> comm_ring_1 <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">discriminant_cubic_depressed</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> <span class="main">-</span> <span class="main">(</span><span class="numeral">4</span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">^</span><span class="numeral">3</span> <span class="main">+</span> <span class="numeral">27</span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Cardanos_Formula-discriminant_cubic_depressed"><span class="command">lemma</span></span> discriminant_cubic_depressed<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="main">-</span><span class="free">x</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="main">[:</span><span class="main">-</span><span class="free">y</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="main">[:</span><span class="main">-</span><span class="free">z</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="main">=</span> <span class="main">[:</span><span class="free">f</span><span class="main">,</span><span class="free">e</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"discriminant_cubic_depressed <span class="free">e</span> <span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="main">-</span><span class="free">y</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> <span class="main">-</span> <span class="main">(</span><span class="free">z</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> <span class="free">y</span> <span class="main">*</span> <span class="free">x</span> <span class="main">-</span> <span class="free">z</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span> <span class="free">y</span> <span class="main">-</span> <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
      z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">=</span> <span class="main">-</span> <span class="free">y</span> <span class="main">-</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> discriminant_cubic_depressed_def e f z
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square power3_eq_cube <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹If the discriminant is negative, then there is exactly one real root›</span></span>

<span class="keyword1" id="Cardanos_Formula-solve_cubic_depressed_Cardano_real"><span class="command">lemma</span></span> solve_cubic_depressed_Cardano_real<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">e</span> <span class="free">f</span> <span class="free">v</span> <span class="free">u</span> <span class="main">::</span> <span class="quoted">real</span> 
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">y1</span> <span class="main">≡</span> root <span class="numeral">3</span> <span class="free">u</span> <span class="main">-</span> <span class="free">e</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">3</span> <span class="main">*</span> root <span class="numeral">3</span> <span class="free">u</span><span class="main">)</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">Δ</span> <span class="main">≡</span> discriminant_cubic_depressed <span class="free">e</span> <span class="free">f</span>"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> e0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> <span class="main">-</span> <span class="main">(</span><span class="free">e</span> <span class="main">^</span> <span class="numeral">3</span> <span class="main">/</span> <span class="numeral">27</span><span class="main">)</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="free">f</span> <span class="main">*</span> <span class="free">u</span> <span class="main">+</span> <span class="free">v</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="comment1">(* this implies Δ ≤ 0 *)</span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">y1</span><span class="main">^</span><span class="numeral">3</span> <span class="main">+</span> <span class="free">e</span> <span class="main">*</span> <span class="free">y1</span> <span class="main">+</span> <span class="free">f</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Δ</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">y</span><span class="main">^</span><span class="numeral">3</span> <span class="main">+</span> <span class="free">e</span> <span class="main">*</span> <span class="free">y</span> <span class="main">+</span> <span class="free">f</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">=</span> <span class="free">y1</span>"</span></span> <span class="comment1">(* this is the case Δ &lt; 0 *)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c</span></span></span> <span class="main">=</span> <span class="quoted">complex_of_real</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?y</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?c</span> <span class="free">y</span>"</span></span> 
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?e</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?c</span> <span class="free">e</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?u</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?c</span> <span class="free">u</span>"</span></span> 
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?v</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?c</span> <span class="free">v</span>"</span></span> 
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?c</span> <span class="free">f</span>"</span></span> 
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="main">::</span> <span class="quoted">real</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?y</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?c</span> <span class="skolem">y</span>"</span></span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">^</span><span class="numeral">3</span> <span class="main">+</span> <span class="free">e</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">+</span> <span class="free">f</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="var">?c</span> <span class="main">(</span><span class="skolem">y</span><span class="main">^</span><span class="numeral">3</span> <span class="main">+</span> <span class="free">e</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">+</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="var">?c</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> of_real_eq_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="var">?y</span><span class="main">^</span><span class="numeral">3</span> <span class="main">+</span> <span class="var">?e</span> <span class="main">*</span> <span class="var">?y</span> <span class="main">+</span> <span class="var">?f</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">z</span><span class="main">.</span> <span class="bound">z</span><span class="main">^</span><span class="numeral">3</span> <span class="main">=</span> <span class="var">?u</span> <span class="main">∧</span> <span class="var">?y</span> <span class="main">=</span> <span class="bound">z</span> <span class="main">-</span> <span class="var">?e</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">3</span> <span class="main">*</span> <span class="bound">z</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> solve_cubic_depressed_Cardano_complex<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?e</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> e0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?v</span> <span class="main">=</span> <span class="main">-</span> <span class="main">(</span><span class="var">?e</span> <span class="main">^</span> <span class="numeral">3</span> <span class="main">/</span> <span class="numeral">27</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> v <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?u</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="var">?f</span> <span class="main">*</span> <span class="var">?u</span> <span class="main">+</span> <span class="var">?v</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> arg_cong<span class="main">[</span><span class="operator">OF</span> u<span class="main">,</span> <span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?c</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">^</span><span class="numeral">3</span> <span class="main">+</span> <span class="free">e</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">+</span> <span class="free">f</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">z</span><span class="main">.</span> <span class="bound">z</span><span class="main">^</span><span class="numeral">3</span> <span class="main">=</span> <span class="var">?u</span> <span class="main">∧</span> <span class="var">?y</span> <span class="main">=</span> <span class="bound">z</span> <span class="main">-</span> <span class="var">?e</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">3</span> <span class="main">*</span> <span class="bound">z</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> pre <span class="main">=</span> this
  <span class="keyword3"><span class="command">show</span></span> y1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y1</span><span class="main">^</span><span class="numeral">3</span> <span class="main">+</span> <span class="free">e</span> <span class="main">*</span> <span class="free">y1</span> <span class="main">+</span> <span class="free">f</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> pre y1_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="var"><span class="var"><span class="var">?c</span></span></span> <span class="main"><span class="main"><span class="main">(</span></span></span>root <span class="numeral"><span class="numeral"><span class="numeral">3</span></span></span> <span class="free"><span class="free"><span class="free">u</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> of_real_power<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
        <span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> of_real_power <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> odd_real_root_pow<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> u <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">z</span><span class="main">.</span> poly <span class="main">[:</span><span class="free">v</span><span class="main">,</span><span class="free">f</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="bound">z</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> power2_eq_square<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>rroots2 <span class="main">[:</span><span class="free">v</span><span class="main">,</span><span class="free">f</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> rroots2<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"rroots2 <span class="main">[:</span><span class="free">v</span><span class="main">,</span><span class="free">f</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">unfolded</span> rroots2_def Let_def<span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="numeral">4</span> <span class="main">*</span> <span class="free">v</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> numeral_2_eq_2 <span class="dynamic"><span class="dynamic">field_simps</span></span> power2_eq_square<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> delta_le_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Δ</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Δ_def discriminant_cubic_depressed_def v <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">assume</span></span> Delta_non_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Δ</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
  <span class="keyword1"><span class="command">with</span></span> delta_le_0 <span class="keyword1"><span class="command">have</span></span> delta_neg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Δ</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="free">f</span><span class="main">,</span><span class="free">e</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span>"</span></span> 
  <span class="keyword1"><span class="command">have</span></span> poly<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="var">?p</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="skolem">y</span><span class="main">^</span><span class="numeral">3</span> <span class="main">+</span> <span class="free">e</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">+</span> <span class="free">f</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">y</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> power2_eq_square power3_eq_cube<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> y1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="var">?p</span> <span class="free">y1</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> poly <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="main">-</span><span class="free">y1</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="keyword1">dvd</span> <span class="var">?p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> poly_eq_0_iff_dvd <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> pq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">=</span> <span class="main">[:</span><span class="main">-</span><span class="free">y1</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y2</span> 
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"poly <span class="var">?p</span> <span class="skolem">y2</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y2</span> <span class="main">≠</span> <span class="free">y1</span>"</span></span> 
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">unfolded</span> pq<span class="main">]</span> poly_mult <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">q</span> <span class="skolem">y2</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">unfolded</span> poly_eq_0_iff_dvd<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> qr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="main">[:</span><span class="main">-</span><span class="skolem">y2</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword1"><span class="command">have</span></span> r0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pq <span class="keyword1"><span class="command">unfolding</span></span> qr poly_mult <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="main">=</span> degree <span class="var">?p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">+</span> degree <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> pq qr
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> degree_mult_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> r0 pq qr <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> degree_mult_eq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ r0<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">r</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> degree1_coeffs<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">yy</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> <span class="main">[:</span><span class="skolem">yy</span><span class="main">,</span><span class="skolem">a</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">y3</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y3</span> <span class="main">=</span> <span class="main">-</span><span class="skolem">yy</span>"</span></span> 
      <span class="keyword1"><span class="command">with</span></span> r <span class="keyword1"><span class="command">have</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> <span class="main">[:</span><span class="main">-</span><span class="skolem">y3</span><span class="main">,</span><span class="skolem">a</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> pq<span class="main">[</span><span class="operator">unfolded</span> qr r<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> r <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">y3</span><span class="main">.</span> <span class="skolem">r</span> <span class="main">=</span> <span class="main">[:</span><span class="main">-</span><span class="bound">y3</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y3</span></span> <span class="keyword2"><span class="keyword">where</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> <span class="main">[:</span><span class="main">-</span><span class="skolem">y3</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> py<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">=</span> <span class="main">[:</span><span class="main">-</span><span class="free">y1</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="main">[:</span><span class="main">-</span><span class="skolem">y2</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="main">[:</span><span class="main">-</span><span class="skolem">y3</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> pq qr r <span class="keyword1"><span class="command">by</span></span> <span class="operator">algebra</span>
    <span class="keyword1"><span class="command">from</span></span> discriminant_cubic_depressed<span class="main">[</span><span class="operator">OF</span> this<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">folded</span> Δ_def<span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> delta<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Δ</span> <span class="main">=</span> <span class="main">(</span><span class="free">y1</span> <span class="main">-</span> <span class="skolem">y2</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">y1</span> <span class="main">-</span> <span class="skolem">y3</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="main">(</span><span class="skolem">y2</span> <span class="main">-</span> <span class="skolem">y3</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">have</span></span> d0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Δ</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> delta <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> delta_neg <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">with</span></span> y1 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main">^</span><span class="numeral">3</span> <span class="main">+</span> <span class="free">e</span> <span class="main">*</span> <span class="free">y</span> <span class="main">+</span> <span class="free">f</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">=</span> <span class="free">y1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> poly <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹If the discriminant is non-negative, then all roots are real›</span></span>

<span class="keyword1" id="Cardanos_Formula-solve_cubic_depressed_Cardano_all_real_roots"><span class="command">lemma</span></span> solve_cubic_depressed_Cardano_all_real_roots<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">e</span> <span class="free">f</span> <span class="free">v</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">y</span> <span class="main">::</span> <span class="quoted">complex</span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">Δ</span> <span class="main">≡</span> discriminant_cubic_depressed <span class="free">e</span> <span class="free">f</span>"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> Delta<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Δ</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> rt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main">^</span><span class="numeral">3</span> <span class="main">+</span> <span class="free">e</span> <span class="main">*</span> <span class="free">y</span> <span class="main">+</span> <span class="free">f</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="main">ℝ</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">note</span></span> powers <span class="main">=</span> <span class="dynamic"><span class="dynamic">field_simps</span></span> power3_eq_cube power2_eq_square
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c</span></span></span> <span class="main">=</span> <span class="quoted">complex_of_real</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?e</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?c</span> <span class="free">e</span>"</span></span> 
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?c</span> <span class="free">f</span>"</span></span> 
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cp</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="var">?f</span><span class="main">,</span><span class="var">?e</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span>"</span></span> 
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="free">f</span><span class="main">,</span><span class="free">e</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span>"</span></span> 
  <span class="keyword1"><span class="command">from</span></span> odd_degree_imp_real_root<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"poly <span class="var">?p</span> <span class="skolem">x1</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="main">-</span><span class="skolem">x1</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="keyword1">dvd</span> <span class="var">?p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> poly_eq_0_iff_dvd <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> pq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">=</span> <span class="main">[:</span><span class="main">-</span><span class="skolem">x1</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> arg_cong<span class="main">[</span><span class="operator">OF</span> pq<span class="main">,</span> <span class="operator">of</span> <span class="quoted">degree</span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="main">=</span> degree <span class="main">(</span><span class="main">[:</span><span class="main">-</span><span class="skolem">x1</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="skolem">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> degree <span class="skolem">q</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> degree_mult_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> pq<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> dq<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">q</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cc</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"map_poly <span class="var">?c</span>"</span></span> 
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?q</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?cc</span> <span class="skolem">q</span>"</span></span> 
  <span class="keyword1"><span class="command">have</span></span> cpq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?cc</span> <span class="var">?p</span> <span class="main">=</span> <span class="var">?cc</span> <span class="main">[:</span><span class="main">-</span><span class="skolem">x1</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="var">?q</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> pq <span class="dynamic"><span class="dynamic">hom_distribs</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?c</span> <span class="skolem">x1</span>"</span></span> 
  <span class="keyword1"><span class="command">have</span></span> dq'<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="var">?q</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> constant <span class="main">(</span>poly <span class="var">?q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> constant_degree<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> fundamental_theorem_of_algebra<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x2</span></span> <span class="keyword2"><span class="keyword">where</span></span> x2<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="var">?q</span> <span class="skolem">x2</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x2</span> <span class="main">∈</span> <span class="main">ℝ</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> x2r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x2</span> <span class="main">∉</span> <span class="main">ℝ</span>"</span></span> 
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x3</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x3</span> <span class="main">=</span> cnj <span class="skolem">x2</span>"</span></span> 
    <span class="keyword1"><span class="command">from</span></span> x2r <span class="keyword1"><span class="command">have</span></span> x23<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x2</span> <span class="main">≠</span> <span class="skolem">x3</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> x3_def <span class="keyword1"><span class="command">using</span></span> Reals_cnj_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">have</span></span> x3<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="var">?q</span> <span class="skolem">x3</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> x3_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> complex_conjugate_root<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ x2<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> x2<span class="main">[</span><span class="operator">unfolded</span> poly_eq_0_iff_dvd<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> qr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?q</span> <span class="main">=</span> <span class="main">[:</span><span class="main">-</span><span class="skolem">x2</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> arg_cong<span class="main">[</span><span class="operator">OF</span> this<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> poly <span class="bound">x</span> <span class="skolem">x3</span>"</span></span><span class="main">,</span> <span class="operator">unfolded</span> poly_mult x3 mult_eq_0_iff<span class="main">]</span> x23
    <span class="keyword1"><span class="command">have</span></span> x3<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="skolem">r</span> <span class="skolem">x3</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> arg_cong<span class="main">[</span><span class="operator">OF</span> qr<span class="main">,</span> <span class="operator">of</span> <span class="quoted">degree</span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">=</span> degree <span class="main">(</span><span class="main">[:</span><span class="main">-</span><span class="skolem">x2</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dq' <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> degree <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> degree_mult_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> pq qr<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">r</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> degree1_coeffs<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> <span class="main">[:</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> cpq<span class="main">[</span><span class="operator">unfolded</span> qr r<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> b1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> x3 r <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">+</span> <span class="skolem">x3</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="main">-</span> <span class="skolem">x3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">algebra</span>
    <span class="keyword1"><span class="command">with</span></span> b1 r <span class="keyword1"><span class="command">have</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> <span class="main">[:</span><span class="main">-</span><span class="skolem">x3</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?cc</span> <span class="var">?p</span> <span class="main">=</span> <span class="var">?cc</span> <span class="main">[:</span><span class="main">-</span><span class="skolem">x1</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="main">[:</span><span class="main">-</span><span class="skolem">x2</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="main">[:</span><span class="main">-</span><span class="skolem">x3</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> cpq qr r <span class="keyword1"><span class="command">by</span></span> <span class="operator">algebra</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?cc</span> <span class="main">[:</span><span class="main">-</span><span class="skolem">x1</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="main">=</span> <span class="main">[:</span><span class="main">-</span><span class="var">?x1</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?cc</span> <span class="var">?p</span> <span class="main">=</span> <span class="var">?cp</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="main">-</span><span class="var">?x1</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="main">[:</span><span class="main">-</span><span class="skolem">x2</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="main">[:</span><span class="main">-</span><span class="skolem">x3</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="main">=</span> <span class="var">?cp</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x23</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x23</span> <span class="main">=</span> <span class="main">-</span> <span class="numeral">4</span> <span class="main">*</span> <span class="main">(</span>Im <span class="skolem">x2</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span>"</span></span> 
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x12c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x12c</span> <span class="main">=</span> <span class="var">?x1</span> <span class="main">-</span> <span class="skolem">x2</span>"</span></span> 
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x12</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x12</span> <span class="main">=</span> <span class="main">(</span>Re <span class="skolem">x12c</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">(</span>Im <span class="skolem">x12c</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span>"</span></span> 
    <span class="keyword1"><span class="command">have</span></span> x23_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x23</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> x23_def <span class="keyword1"><span class="command">using</span></span> x2r <span class="keyword1"><span class="command">using</span></span> complex_is_Real_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Im <span class="skolem">x12c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> x12c_def <span class="keyword1"><span class="command">using</span></span> x2r <span class="keyword1"><span class="command">using</span></span> complex_is_Real_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Im <span class="skolem">x12c</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> x12<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x12</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> x12_def <span class="keyword1"><span class="command">using</span></span> sum_power2_gt_zero_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> discriminant_cubic_depressed<span class="main">[</span><span class="operator">OF</span> id<span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?c</span> <span class="free">Δ</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="var">?x1</span> <span class="main">-</span> <span class="skolem">x2</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="main">(</span><span class="var">?x1</span> <span class="main">-</span> <span class="skolem">x3</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">x2</span> <span class="main">-</span> <span class="skolem">x3</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> Δ_def discriminant_cubic_depressed_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x2</span> <span class="main">-</span> <span class="skolem">x3</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="var">?c</span> <span class="skolem">x23</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> x3_def x23_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> complex_eq_iff power2_eq_square<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?x1</span> <span class="main">-</span> <span class="skolem">x2</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="main">(</span><span class="var">?x1</span> <span class="main">-</span> <span class="skolem">x3</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="var">?x1</span> <span class="main">-</span> <span class="skolem">x2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="var">?x1</span> <span class="main">-</span> <span class="skolem">x3</span><span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="numeral">2</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?x1</span> <span class="main">-</span> <span class="skolem">x3</span> <span class="main">=</span> cnj <span class="main">(</span><span class="var">?x1</span> <span class="main">-</span> <span class="skolem">x2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> x3_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?x1</span> <span class="main">-</span> <span class="skolem">x2</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x12c</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> x12c_def <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x12c</span> <span class="main">*</span> cnj <span class="skolem">x12c</span> <span class="main">=</span> <span class="var">?c</span> <span class="skolem">x12</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x12_def complex_eq_iff power2_eq_square<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?c</span> <span class="free">Δ</span> <span class="main">=</span> <span class="var">?c</span> <span class="main">(</span><span class="skolem">x12</span><span class="main">^</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">x23</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">Δ</span> <span class="main">=</span> <span class="skolem">x12</span><span class="main">^</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">x23</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> of_real_hom.injectivity<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x12 x23_0 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> mult_pos_neg zero_less_power<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> Delta <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> x2 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"poly <span class="var">?q</span> <span class="main">(</span><span class="var">?c</span> <span class="skolem">x2</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Reals_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> x2<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="skolem">q</span> <span class="skolem">x2</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> x2<span class="main">[</span><span class="operator">unfolded</span> poly_eq_0_iff_dvd<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> qr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="main">[:</span><span class="main">-</span><span class="skolem">x2</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> arg_cong<span class="main">[</span><span class="operator">OF</span> qr<span class="main">,</span> <span class="operator">of</span> <span class="quoted">degree</span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">=</span> degree <span class="main">(</span><span class="main">[:</span><span class="main">-</span><span class="skolem">x2</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="skolem">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dq' <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> degree <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> degree_mult_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> pq qr<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"degree <span class="skolem">r</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> degree1_coeffs<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> <span class="main">[:</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> pq<span class="main">[</span><span class="operator">unfolded</span> qr r<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> b1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x3</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x3</span> <span class="main">=</span> <span class="main">-</span><span class="skolem">a</span>"</span></span> 
  <span class="keyword1"><span class="command">have</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> <span class="main">[:</span><span class="main">-</span><span class="skolem">x3</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> r b1 x3_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?pp</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="main">-</span><span class="skolem">x1</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="main">[:</span><span class="main">-</span><span class="skolem">x2</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="main">[:</span><span class="main">-</span><span class="skolem">x3</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span>"</span></span> 
  <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">=</span> <span class="var">?pp</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> pq qr r <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"True <span class="main">⟷</span> <span class="free">y</span><span class="main">^</span><span class="numeral">3</span> <span class="main">+</span> <span class="free">e</span> <span class="main">*</span> <span class="free">y</span> <span class="main">+</span> <span class="free">f</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> rt <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main">^</span><span class="numeral">3</span> <span class="main">+</span> <span class="free">e</span> <span class="main">*</span> <span class="free">y</span> <span class="main">+</span> <span class="free">f</span> <span class="main">=</span> poly <span class="main">(</span><span class="var">?cc</span> <span class="var">?p</span><span class="main">)</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powers<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> poly <span class="main">(</span><span class="var">?cc</span> <span class="var">?pp</span><span class="main">)</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> id <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?cc</span> <span class="var">?pp</span> <span class="main">=</span> <span class="main">[:</span><span class="main">-</span><span class="var">?c</span> <span class="skolem">x1</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="main">[:</span><span class="main">-</span><span class="var">?c</span> <span class="skolem">x2</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="main">[:</span><span class="main">-</span> <span class="var">?c</span> <span class="skolem">x3</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="main">…</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">y</span> <span class="main">=</span> <span class="var">?c</span> <span class="skolem">x1</span> <span class="main">∨</span> <span class="free">y</span> <span class="main">=</span> <span class="var">?c</span> <span class="skolem">x2</span> <span class="main">∨</span> <span class="free">y</span> <span class="main">=</span> <span class="var">?c</span> <span class="skolem">x3</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> poly_mult mult_eq_0_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="main">ℝ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Min_Int_Poly_Impl">
<div class="head">
<h1>Theory Min_Int_Poly_Impl</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Implementation of the minimal polynomial of a real or complex algebraic number›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This theory provides implementation of the minimal-representing-polynomial of an algebraic
  number, for both the real-numbers and the complex-numbers.›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Min_Int_Poly_Impl
  <span class="keyword2"><span class="keyword">imports</span></span>     
    <a href="../../hermite_lindemann/theories/#Min_Int_Poly">Hermite_Lindemann.Min_Int_Poly</a>
    <a href="../../algebraic_numbers/theories/#Real_Algebraic_Numbers">Algebraic_Numbers.Real_Algebraic_Numbers</a>
    <a href="../../algebraic_numbers/theories/#Complex_Algebraic_Numbers">Algebraic_Numbers.Complex_Algebraic_Numbers</a>
<span class="keyword2"><span class="keyword">begin</span></span>
 
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">min_int_poly_real_alg</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real_alg <span class="main">⇒</span> int poly"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">min_int_poly_real_alg</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> info_real_alg <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">of</span> Inl <span class="bound">r</span> <span class="main">⇒</span> poly_rat <span class="bound">r</span> <span class="main">|</span> Inr <span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="main"><span class="bound">_</span></span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span><span class="main">)</span>"</span></span> 

<span class="keyword1" id="Min_Int_Poly_Impl-min_int_poly_of_rat"><span class="command">lemma</span></span> min_int_poly_of_rat<span class="main">:</span> <span class="quoted"><span class="quoted">"min_int_poly <span class="main">(</span>of_rat <span class="free">r</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>field_char_0<span class="main">,</span> field_gcd<span class="main">}</span><span class="main">)</span> <span class="main">=</span> poly_rat <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> min_int_poly_unique<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  
<span class="keyword1" id="Min_Int_Poly_Impl-min_int_poly_real_alg"><span class="command">lemma</span></span> min_int_poly_real_alg<span class="main">:</span> <span class="quoted"><span class="quoted">"min_int_poly_real_alg <span class="free">x</span> <span class="main">=</span> min_int_poly <span class="main">(</span>real_of <span class="free">x</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"info_real_alg <span class="free">x</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Inl <span class="skolem">r</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> info_real_alg<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> Inl<span class="main">]</span> min_int_poly_real_alg_def Inl
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_int_poly_of_rat<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Inr <span class="skolem">pair</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> Inr<span class="main">:</span> <span class="quoted"><span class="quoted">"info_real_alg <span class="free">x</span> <span class="main">=</span> Inr <span class="main">(</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">pair</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poly_cond <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> info_2_card<span class="main">)</span>  
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"min_int_poly <span class="main">(</span>real_of <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> info_real_alg<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> Inr<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> min_int_poly_unique<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> min_int_poly_real_alg_def Inr <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">min_int_poly_real</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> int poly"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">min_int_poly_real</span> <span class="main">=</span> min_int_poly"</span></span> 

<span class="keyword1" id="Min_Int_Poly_Impl-min_int_poly_real_code_unfold"><span class="command">lemma</span></span> min_int_poly_real_code_unfold <span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"min_int_poly <span class="main">=</span> min_int_poly_real"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Min_Int_Poly_Impl-min_int_poly_real_code"><span class="command">lemma</span></span> min_int_poly_real_code<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"min_int_poly_real <span class="main">(</span>real_of <span class="free">x</span><span class="main">)</span> <span class="main">=</span> min_int_poly_real_alg <span class="free">x</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_int_poly_real_alg<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Now let us head for the complex numbers›</span></span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">complex_poly</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int poly <span class="main">⇒</span> int poly <span class="main">⇒</span> int poly list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">complex_poly</span> <span class="free"><span class="bound"><span class="entity">re</span></span></span> <span class="free"><span class="bound"><span class="entity">im</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">i</span> <span class="main">=</span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> 
     <span class="keyword1">in</span> factors_of_int_poly <span class="main">(</span>poly_add <span class="free"><span class="bound"><span class="entity">re</span></span></span> <span class="main">(</span>poly_mult <span class="free"><span class="bound"><span class="entity">im</span></span></span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 

<span class="keyword1" id="Min_Int_Poly_Impl-complex_poly"><span class="command">lemma</span></span> complex_poly<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> re<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">re</span> <span class="keyword1">represents</span> <span class="main">(</span>Re <span class="free">x</span><span class="main">)</span>"</span></span> 
   <span class="keyword2"><span class="keyword">and</span></span> im<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">im</span> <span class="keyword1">represents</span> <span class="main">(</span>Im <span class="free">x</span><span class="main">)</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">f</span> <span class="main">∈</span> set <span class="main">(</span>complex_poly <span class="free">re</span> <span class="free">im</span><span class="main">)</span><span class="main">.</span> <span class="bound">f</span> <span class="keyword1">represents</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> set <span class="main">(</span>complex_poly <span class="free">re</span> <span class="free">im</span><span class="main">)</span> <span class="main">⟹</span> poly_cond <span class="bound">f</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"poly_add <span class="free">re</span> <span class="main">(</span>poly_mult <span class="free">im</span> <span class="main">[:</span><span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">from</span></span> re <span class="keyword1"><span class="command">have</span></span> re<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">re</span> <span class="keyword1">represents</span> complex_of_real <span class="main">(</span>Re <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> im <span class="keyword1"><span class="command">have</span></span> im<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">im</span> <span class="keyword1">represents</span> complex_of_real <span class="main">(</span>Im <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="keyword1">represents</span> <span class="keyword1">𝗂</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> represents_add<span class="main">[</span><span class="operator">OF</span> re represents_mult<span class="main"><span class="main">[</span></span><span class="operator">OF</span> im this<span class="main"><span class="main">]</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="keyword1">represents</span> of_real <span class="main">(</span>Re <span class="free">x</span><span class="main">)</span> <span class="main">+</span> complex_of_real <span class="main">(</span>Im <span class="free">x</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">𝗂</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_real <span class="main">(</span>Re <span class="free">x</span><span class="main">)</span> <span class="main">+</span> complex_of_real <span class="main">(</span>Im <span class="free">x</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> complex_eq mult.commute<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="keyword1">represents</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"factors_of_int_poly <span class="var">?p</span> <span class="main">=</span> complex_poly <span class="free">re</span> <span class="free">im</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> complex_poly_def Let_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> factors_of_int_poly<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> factors_of_int_poly<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> p
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">f</span> <span class="main">∈</span> set <span class="main">(</span>complex_poly <span class="free">re</span> <span class="free">im</span><span class="main">)</span><span class="main">.</span> <span class="bound">f</span> <span class="keyword1">represents</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> set <span class="main">(</span>complex_poly <span class="free">re</span> <span class="free">im</span><span class="main">)</span> <span class="main">⟹</span> poly_cond <span class="bound">f</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> represents_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
 

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">algebraic_real</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">algebraic_real</span> <span class="main">=</span> algebraic"</span></span> 

<span class="keyword1" id="Min_Int_Poly_Impl-algebraic_real_iff"><span class="command">lemma</span></span> algebraic_real_iff<span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"algebraic <span class="main">=</span> algebraic_real"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Min_Int_Poly_Impl-algebraic_real_code"><span class="command">lemma</span></span> algebraic_real_code<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"algebraic_real <span class="main">(</span>real_of <span class="free">x</span><span class="main">)</span> <span class="main">=</span> True"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"info_real_alg <span class="free">x</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Inl <span class="skolem">r</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> info_real_alg<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> Inl<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> algebraic_of_rat<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Inr <span class="skolem">pair</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> Inr<span class="main">:</span> <span class="quoted"><span class="quoted">"info_real_alg <span class="free">x</span> <span class="main">=</span> Inr <span class="main">(</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">pair</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> info_real_alg<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> Inr<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">represents</span> <span class="main">(</span>real_of <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> algebraic_altdef_ipoly<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Min_Int_Poly_Impl-algebraic_complex_iff"><span class="command">lemma</span></span> algebraic_complex_iff<span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"algebraic <span class="free">x</span> <span class="main">⟷</span> algebraic <span class="main">(</span>Re <span class="free">x</span><span class="main">)</span> <span class="main">∧</span> algebraic <span class="main">(</span>Im <span class="free">x</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"algebraic <span class="free">x</span>"</span></span> 
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">unfolded</span> algebraic_altdef_ipoly<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"ipoly <span class="skolem">p</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> represents_root_poly<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"algebraic <span class="main">(</span>Re <span class="free">x</span><span class="main">)</span> <span class="main">∧</span> algebraic <span class="main">(</span>Im <span class="free">x</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> represents_def algebraic_altdef_ipoly <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"algebraic <span class="main">(</span>Re <span class="free">x</span><span class="main">)</span> <span class="main">∧</span> algebraic <span class="main">(</span>Im <span class="free">x</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">unfolded</span> algebraic_altdef_ipoly<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">re</span></span> <span class="skolem"><span class="skolem">im</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
    <span class="quoted"><span class="quoted">"<span class="skolem">re</span> <span class="keyword1">represents</span> <span class="main">(</span>Re <span class="free">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">im</span> <span class="keyword1">represents</span> <span class="main">(</span>Im <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> complex_poly<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"algebraic <span class="free">x</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> represents_def algebraic_altdef_ipoly <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Min_Int_Poly_Impl-algebraic_0"><span class="command">lemma</span></span> algebraic_0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"algebraic <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> algebraic_altdef_ipoly
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">[:</span></span></span><span class="main"><span class="main"><span class="main">0</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span><span class="main"><span class="main"><span class="main">1</span></span></span><span class="main"><span class="main"><span class="main">:]</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Min_Int_Poly_Impl-min_int_poly_complex_of_real"><span class="command">lemma</span></span> min_int_poly_complex_of_real<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"min_int_poly <span class="main">(</span>complex_of_real <span class="free">x</span><span class="main">)</span> <span class="main">=</span> min_int_poly <span class="free">x</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"algebraic <span class="free">x</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> algebraic <span class="main">(</span>complex_of_real <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> algebraic_complex_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> False <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> min_int_poly_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">from</span></span> min_int_poly_represents<span class="main">[</span><span class="operator">OF</span> True<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"min_int_poly <span class="free">x</span> <span class="keyword1">represents</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> min_int_poly_unique<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lead_coeff_min_int_poly_pos<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
  


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹TODO: the implemention might be tuned, since the search process should be faster when
  using interval arithmetic to figure out the correct factor.
  (One might also implement the search via checking <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"ipoly <span class="free"><span class="free">f</span></span> <span class="free"><span class="free">x</span></span> <span class="main"><span class="main">=</span></span> <span class="main"><span class="main">0</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, but because of complex-algebraic-number
   arithmetic, I think that search would be slower than the current one via "<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">x</span></span> <span class="main"><span class="main">∈</span></span> set <span class="main"><span class="main">(</span></span>complex_roots_of_int_poly <span class="free"><span class="free">f</span></span><span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">min_int_poly_complex</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex <span class="main">⇒</span> int poly"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">min_int_poly_complex</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> algebraic <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">then</span> <span class="keyword1">if</span> Im <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> min_int_poly_real <span class="main">(</span>Re <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>
     <span class="keyword1">else</span> the <span class="main">(</span>find <span class="main">(</span><span class="main">λ</span> <span class="bound">f</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∈</span> set <span class="main">(</span>complex_roots_of_int_poly <span class="bound">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>complex_poly <span class="main">(</span>min_int_poly <span class="main">(</span>Re <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>min_int_poly <span class="main">(</span>Im <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
     <span class="keyword1">else</span> <span class="main">[:</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span> 
 
<span class="keyword1" id="Min_Int_Poly_Impl-min_int_poly_complex"><span class="command">lemma</span></span> min_int_poly_complex<span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"min_int_poly <span class="main">=</span> min_int_poly_complex"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">fs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fs</span> <span class="main">=</span> complex_poly <span class="main">(</span>min_int_poly <span class="main">(</span>Re <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>min_int_poly <span class="main">(</span>Im <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"min_int_poly_complex <span class="skolem">x</span>"</span></span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"min_int_poly <span class="skolem">x</span> <span class="main">=</span> <span class="var">?f</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"algebraic <span class="skolem">x</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> min_int_poly_def min_int_poly_complex_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Im <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> *<span class="main">:</span> True
      <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">=</span> min_int_poly_real <span class="main">(</span>Re <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> min_int_poly_complex_def * <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> id min_int_poly_real_code_unfold<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> min_int_poly_complex_of_real<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
        <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> arg_cong<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">min_int_poly</span></span></span><span class="main"><span class="main">]</span></span> complex_eqI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False  
      <span class="keyword1"><span class="command">from</span></span> True<span class="main">[</span><span class="operator">unfolded</span> algebraic_complex_iff<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"algebraic <span class="main">(</span>Re <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"algebraic <span class="main">(</span>Im <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> complex_poly<span class="main">[</span><span class="operator">OF</span> min_int_poly_represents<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator"><span class="operator">OF</span></span> this<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main"><span class="main">]</span></span></span> min_int_poly_represents<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator"><span class="operator">OF</span></span> this<span class="main"><span class="main"><span class="main">(</span></span></span>2<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> fs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">f</span> <span class="main">∈</span> set <span class="skolem">fs</span><span class="main">.</span> ipoly <span class="bound">f</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> set <span class="skolem">fs</span> <span class="main">⟹</span> poly_cond <span class="bound">f</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> fs_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?fs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"find <span class="main">(</span><span class="main">λ</span> <span class="bound">f</span><span class="main">.</span> ipoly <span class="bound">f</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="skolem">fs</span>"</span></span> 
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?fs'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"find <span class="main">(</span><span class="main">λ</span> <span class="bound">f</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">∈</span> set <span class="main">(</span>complex_roots_of_int_poly <span class="bound">f</span><span class="main">)</span><span class="main">)</span> <span class="skolem">fs</span>"</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">=</span> the <span class="var">?fs'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> min_int_poly_complex_def fs_def
        <span class="keyword1"><span class="command">using</span></span> True False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?fs'</span> <span class="main">=</span> <span class="var">?fs</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> find_cong<span class="main"><span class="main">[</span></span><span class="operator">OF</span> refl<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> complex_roots_of_int_poly<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> fs<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">=</span> the <span class="var">?fs</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">from</span></span> fs<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?fs</span> <span class="main">≠</span> None"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> find_None_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> Some<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?fs</span> <span class="main">=</span> Some <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> find_Some_D<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> fs<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">f</span></span><span class="main">]</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> id Some
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> min_int_poly_unique<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* outcommented tests, since time-consuming:

value (code) "min_int_poly (sqrt 2 + 3)" 
value (code) "min_int_poly (sqrt 2 + 𝗂)" 

*)</span>
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Complex_Roots">
<div class="head">
<h1>Theory Complex_Roots</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹$n$-th roots of complex numbers›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Complex_Roots
  <span class="keyword2"><span class="keyword">imports</span></span> 
    <a href="../../complex_geometry/theories/#More_Complex">Complex_Geometry.More_Complex</a>
    <a href="#Min_Int_Poly_Impl">Min_Int_Poly_Impl</a>
    <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Library/Product_Lexorder.html">HOL-Library.Product_Lexorder</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹An algorithm to compute all complex roots of (algebraic) complex numbers›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹TODO: The filter instruction might be tuned by using interval arithmetic instead.›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">all_croots</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> complex <span class="main">⇒</span> complex list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">all_croots</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">[]</span> <span class="keyword1">else</span>
     <span class="keyword1">if</span> algebraic <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">then</span>
       <span class="main">(</span><span class="keyword1">let</span> <span class="bound">p</span> <span class="main">=</span> min_int_poly <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">;</span>
         <span class="bound">q</span> <span class="main">=</span> poly_nth_root <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="bound">p</span><span class="main">;</span>
         <span class="bound">xs</span> <span class="main">=</span> complex_roots_of_int_poly <span class="bound">q</span>
         <span class="keyword1">in</span> filter <span class="main">(</span><span class="main">λ</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span><span class="main">^</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="bound">xs</span><span class="main">)</span>
     <span class="keyword1">else</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">ys</span><span class="main">.</span> set <span class="bound">ys</span> <span class="main">=</span> <span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span><span class="main">^</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span> 

<span class="keyword1" id="Complex_Roots-all_croots_code"><span class="command">lemma</span></span> all_croots_code<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"all_croots <span class="free">n</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">n</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">[]</span> <span class="keyword1">else</span>
     <span class="keyword1">if</span> algebraic <span class="free">x</span> <span class="keyword1">then</span>
       <span class="main">(</span><span class="keyword1">let</span> <span class="bound">p</span> <span class="main">=</span> min_int_poly <span class="free">x</span><span class="main">;</span>
         <span class="bound">q</span> <span class="main">=</span> poly_nth_root <span class="free">n</span> <span class="bound">p</span><span class="main">;</span>
         <span class="bound">xs</span> <span class="main">=</span> complex_roots_of_int_poly <span class="bound">q</span>
         <span class="keyword1">in</span> filter <span class="main">(</span><span class="main">λ</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span><span class="main">^</span><span class="free">n</span> <span class="main">=</span> <span class="free">x</span><span class="main">)</span> <span class="bound">xs</span><span class="main">)</span>
     <span class="keyword1">else</span> Code.abort <span class="main">(</span><span class="keyword1">STR</span> <span class="inner_quoted">''all_croots invoked on non-algebraic number''</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span> <span class="main"><span class="bound">_</span></span><span class="main">.</span> all_croots <span class="free">n</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> all_croots_def<span class="main">)</span>

<span class="keyword1" id="Complex_Roots-all_croots"><span class="command">lemma</span></span> all_croots<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> n0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>all_croots <span class="free">n</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span><span class="main">^</span><span class="free">n</span> <span class="main">=</span> <span class="free">x</span><span class="main">}</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"algebraic <span class="free">x</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">hence</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> <span class="free">n</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="skolem">y</span> <span class="keyword1">else</span> <span class="keyword1">if</span> algebraic <span class="free">x</span> <span class="keyword1">then</span> <span class="skolem">z</span> <span class="keyword1">else</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">z</span>"</span></span> 
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="skolem">u</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex list"</span></span> <span class="keyword1"><span class="command">using</span></span> n0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> poly_nth_root <span class="free">n</span> <span class="main">(</span>min_int_poly <span class="free">x</span><span class="main">)</span>"</span></span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> Let_def p_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> all_croots_def id
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span>
    <span class="keyword3"><span class="command">assume</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">^</span><span class="free">n</span>  <span class="main">=</span> <span class="free">x</span>"</span></span>     
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"min_int_poly <span class="free">x</span> <span class="keyword1">represents</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> represents_nth_root<span class="main">[</span><span class="operator">OF</span> n0 y this<span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="keyword1">represents</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> set <span class="main">(</span>complex_roots_of_int_poly <span class="skolem">p</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> complex_roots_of_int_poly<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">hence</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> <span class="free">n</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="skolem">y</span> <span class="keyword1">else</span> <span class="keyword1">if</span> algebraic <span class="free">x</span> <span class="keyword1">then</span> <span class="skolem">z</span> <span class="keyword1">else</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">u</span>"</span></span> 
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="skolem">u</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex list"</span></span> <span class="keyword1"><span class="command">using</span></span> n0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> Let_def all_croots_def id
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> someI_ex<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> finite_list<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> n0<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹A definition of \emph{the} complex root of a complex number›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹While the definition of the complex root is quite natural and easy,
  the main task is a criterion to determine which of all possible roots of a
  complex number is the chosen one.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">croot</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> complex <span class="main">⇒</span> complex"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">croot</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span>rcis <span class="main">(</span>root <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">(</span>cmod <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>arg <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">/</span> of_nat <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span> 

<span class="keyword1" id="Complex_Roots-croot_0"><span class="command">lemma</span></span> croot_0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"croot <span class="free">n</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"croot <span class="main">0</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> croot_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Complex_Roots-croot_power"><span class="command">lemma</span></span> croot_power<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>croot <span class="free">n</span> <span class="free">x</span><span class="main">)</span> <span class="main">^</span> <span class="free">n</span> <span class="main">=</span> <span class="free">x</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> croot_def DeMoivre2
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> real_root_pow_pos2<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> n<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rcis_cmod_arg<span class="main">)</span>

<span class="keyword1" id="Complex_Roots-arg_of_real"><span class="command">lemma</span></span> arg_of_real<span class="main">:</span> <span class="quoted"><span class="quoted">"arg <span class="main">(</span>of_real <span class="free">x</span><span class="main">)</span> <span class="main">=</span> 
  <span class="main">(</span><span class="keyword1">if</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="keyword1">then</span> pi <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> arg_unique<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span>
      <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> complex_sgn_def scaleR_complex.ctr complex_eq_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> arg_def<span class="main">)</span>


<span class="keyword1" id="Complex_Roots-arg_rcis_cis"><span class="command">lemma</span></span> arg_rcis_cis<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"arg <span class="main">(</span>rcis <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> arg <span class="main">(</span>cis <span class="free">y</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> rcis_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Complex_Roots-cis_arg_1"><span class="command">lemma</span></span> cis_arg_1<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"cis <span class="main">(</span>arg <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> arg_of_real<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Complex_Roots-cis_arg_power"><span class="command">lemma</span></span> cis_arg_power<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cis <span class="main">(</span>arg <span class="main">(</span><span class="free">x</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> cis <span class="main">(</span>arg <span class="free">x</span> <span class="main">*</span> real <span class="free">n</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> power.simps
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> cis_arg_mult<span class="main">)</span>    
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cis <span class="main">(</span>arg <span class="free">x</span> <span class="main">+</span> arg <span class="main">(</span><span class="free">x</span> <span class="main">^</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> cis <span class="main">(</span>arg <span class="free">x</span> <span class="main">*</span> real <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> mult.commute<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"arg <span class="free">x</span>"</span></span><span class="main">]</span> DeMoivre<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
      <span class="keyword1"><span class="command">unfolding</span></span> power.simps <span class="keyword1"><span class="command">using</span></span> Suc
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> DeMoivre cis_mult mult.commute<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">x</span> <span class="main">^</span> <span class="skolem">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Complex_Roots-arg_croot"><span class="command">lemma</span></span> arg_croot<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"arg <span class="main">(</span>croot <span class="free">n</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> arg <span class="free">x</span> <span class="main">/</span> real <span class="free">n</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> arg_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">hence</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?root</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"croot <span class="free">n</span> <span class="free">x</span>"</span></span> 
  <span class="keyword1"><span class="command">from</span></span> n <span class="keyword1"><span class="command">have</span></span> n1<span class="main">:</span> <span class="quoted"><span class="quoted">"real <span class="free">n</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"real <span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"real <span class="free">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> bounded<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span> pi <span class="main">&lt;</span> arg <span class="free">x</span> <span class="main">/</span> real <span class="free">n</span> <span class="main">∧</span> arg <span class="free">x</span> <span class="main">/</span> real <span class="free">n</span> <span class="main">≤</span> pi"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"arg <span class="free">x</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">from</span></span> arg_bounded<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> pi <span class="main">&lt;</span> arg <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> arg <span class="free">x</span> <span class="main">/</span> real <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n1 True
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> div_by_1 divide_minus_left frac_le<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> one<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span> pi <span class="main">&lt;</span> arg <span class="free">x</span> <span class="main">/</span> real <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"arg <span class="free">x</span> <span class="main">/</span> real <span class="free">n</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> True n1 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">)</span></span> divide_less_0_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> pi"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> one <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> ax<span class="main">:</span> <span class="quoted"><span class="quoted">"arg <span class="free">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"arg <span class="free">x</span> <span class="main">/</span> real <span class="free">n</span> <span class="main">≤</span> arg <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n1 ax
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">)</span></span> div_by_1 frac_le<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> pi"</span></span> <span class="keyword1"><span class="command">using</span></span> arg_bounded<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> one<span class="main">:</span> <span class="quoted"><span class="quoted">"arg <span class="free">x</span> <span class="main">/</span> real <span class="free">n</span> <span class="main">≤</span> pi"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span>pi <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> arg <span class="free">x</span> <span class="main">/</span> real <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ax n1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> one <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"arg <span class="var">?root</span> <span class="main">=</span> arg <span class="main">(</span>cis <span class="main">(</span>arg <span class="free">x</span> <span class="main">/</span> real <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> croot_def <span class="keyword1"><span class="command">using</span></span> x n <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> arg <span class="free">x</span> <span class="main">/</span> real <span class="free">n</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> arg_unique<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> bounded<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Complex_Roots-cos_abs"><span class="command">lemma</span></span> cos_abs<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"cos <span class="main">(</span>abs <span class="free">x</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">=</span> cos <span class="free">x</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">hence</span></span> abs<span class="main">:</span> <span class="quoted"><span class="quoted">"abs <span class="free">x</span> <span class="main">=</span> <span class="main">-</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> abs <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Complex_Roots-cos_mono_le"><span class="command">lemma</span></span> cos_mono_le<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"abs <span class="free">x</span> <span class="main">≤</span> pi"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"abs <span class="free">y</span> <span class="main">≤</span> pi"</span></span> 
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cos <span class="free">x</span> <span class="main">≤</span> cos <span class="free">y</span> <span class="main">⟷</span> abs <span class="free">y</span> <span class="main">≤</span> abs <span class="free">x</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cos <span class="free">x</span> <span class="main">≤</span> cos <span class="free">y</span> <span class="main">⟷</span> cos <span class="main">(</span>abs <span class="free">x</span><span class="main">)</span> <span class="main">≤</span> cos <span class="main">(</span>abs <span class="free">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> abs <span class="free">y</span> <span class="main">≤</span> abs <span class="free">x</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> cos_mono_le_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Complex_Roots-abs_add_2_mult_bound"><span class="command">lemma</span></span> abs_add_2_mult_bound<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> linordered_idom"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="free">y</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="main">¦</span><span class="free">x</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> of_int <span class="free">i</span> <span class="main">*</span> <span class="free">y</span><span class="main">¦</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> i<span class="main">:</span> False
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?oi</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"of_int <span class="main">::</span> int <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> 
  <span class="keyword1"><span class="command">from</span></span> xy <span class="keyword1"><span class="command">have</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">consider</span></span> <span class="main">(</span>pp<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> 
    <span class="main">|</span> <span class="main">(</span>nn<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> 
    <span class="main">|</span> <span class="main">(</span>pn<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> 
    <span class="main">|</span> <span class="main">(</span>np<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">case</span></span> pp
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> y <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> nn 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="free">x</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="var">?oi</span> <span class="free">i</span> <span class="main">*</span> <span class="free">y</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> nn y <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_nonneg_nonpos2<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> nn <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> pn
    <span class="keyword1"><span class="command">with</span></span> i <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">=</span> nat <span class="main">(</span><span class="main">-</span><span class="free">i</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span> 
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> <span class="free">x</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">y</span>"</span></span> 
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="var">?oi</span> <span class="main">(</span>nat <span class="skolem">j</span><span class="main">)</span> <span class="main">*</span> <span class="free">y</span>"</span></span> 
    <span class="keyword1"><span class="command">have</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> u_def <span class="keyword1"><span class="command">using</span></span> y <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> <span class="main">-</span> int <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">i</span> <span class="main">&lt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> j_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="var">?oi</span> <span class="free">i</span> <span class="main">*</span> <span class="free">y</span> <span class="main">=</span> <span class="skolem">z</span> <span class="main">-</span> <span class="skolem">u</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> i z_def u_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"abs <span class="skolem">z</span> <span class="main">≥</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> xy y pn<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">unfolding</span></span> z_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> id <span class="keyword1"><span class="command">using</span></span> pn<span class="main">(</span>1<span class="main">)</span> z u <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> np
    <span class="keyword1"><span class="command">with</span></span> i <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≥</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">=</span> nat <span class="free">i</span> <span class="main">-</span> <span class="main">1</span>"</span></span> 
    <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> int <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">i</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> j_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="var">?oi</span> <span class="main">(</span>nat <span class="skolem">j</span><span class="main">)</span> <span class="main">*</span> <span class="free">y</span>"</span></span> 
    <span class="keyword1"><span class="command">have</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> u_def <span class="keyword1"><span class="command">using</span></span> y <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> <span class="main">-</span> <span class="free">x</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">y</span>"</span></span> 
    <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="var">?oi</span> <span class="free">i</span> <span class="main">*</span> <span class="free">y</span> <span class="main">=</span> <span class="main">-</span> <span class="skolem">z</span> <span class="main">+</span> <span class="skolem">u</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> i z_def u_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"abs <span class="skolem">z</span> <span class="main">≥</span> <span class="main">-</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> xy y np<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">unfolding</span></span> z_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> id <span class="keyword1"><span class="command">using</span></span> np<span class="main">(</span>1<span class="main">)</span> z u <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Complex_Roots-abs_eq_add_2_mult"><span class="command">lemma</span></span> abs_eq_add_2_mult<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> linordered_idom"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> abs_id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">x</span><span class="main">¦</span> <span class="main">=</span> <span class="main">¦</span><span class="free">x</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> of_int <span class="free">i</span> <span class="main">*</span> <span class="free">y</span><span class="main">¦</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="free">y</span> <span class="main">&lt;</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">y</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>  
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?oi</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"of_int <span class="main">::</span> int <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> 
  <span class="keyword1"><span class="command">from</span></span> xy <span class="keyword1"><span class="command">have</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">consider</span></span> <span class="main">(</span>pp<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> 
    <span class="main">|</span> <span class="main">(</span>nn<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> 
    <span class="main">|</span> <span class="main">(</span>pn<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> 
    <span class="main">|</span> <span class="main">(</span>np<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?thesis</span> <span class="main">∨</span> <span class="free">x</span> <span class="main">=</span> <span class="var">?oi</span> <span class="main">(</span><span class="main">-</span> <span class="free">i</span><span class="main">)</span> <span class="main">*</span> <span class="free">y</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">case</span></span> pp
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> y abs_id xy i <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> nn
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">x</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="var">?oi</span> <span class="free">i</span> <span class="main">*</span> <span class="free">y</span><span class="main">¦</span> <span class="main">=</span> 
      <span class="main">-</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="var">?oi</span> <span class="free">i</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> y nn
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> abs_of_nonpos add_nonpos_nonpos<span class="main"><span class="keyword3">,</span></span> 
          <span class="operator">force</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> mult_nonneg_nonpos<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> y abs_id xy i nn
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> pn
    <span class="keyword1"><span class="command">with</span></span> i <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">=</span> nat <span class="main">(</span><span class="main">-</span><span class="free">i</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span> 
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> <span class="free">x</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">y</span>"</span></span> 
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="var">?oi</span> <span class="main">(</span>nat <span class="skolem">j</span><span class="main">)</span> <span class="main">*</span> <span class="free">y</span>"</span></span> 
    <span class="keyword1"><span class="command">have</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> u_def <span class="keyword1"><span class="command">using</span></span> y <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> <span class="main">-</span> int <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">i</span> <span class="main">&lt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> j_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="var">?oi</span> <span class="free">i</span> <span class="main">*</span> <span class="free">y</span> <span class="main">=</span> <span class="skolem">z</span> <span class="main">-</span> <span class="skolem">u</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> i z_def u_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"abs <span class="skolem">z</span> <span class="main">≥</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> xy y pn<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">unfolding</span></span> z_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> abs_id<span class="main">[</span><span class="operator">unfolded</span> id<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">-</span> <span class="skolem">u</span> <span class="main">=</span> <span class="main">-</span><span class="free">x</span> "</span></span> 
      <span class="keyword1"><span class="command">using</span></span> z u pn <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">folded</span> id<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> of_int <span class="main">(</span><span class="main">-</span><span class="free">i</span><span class="main">)</span> <span class="main">*</span> <span class="free">y</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> np
    <span class="keyword1"><span class="command">with</span></span> i <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≥</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">=</span> nat <span class="free">i</span> <span class="main">-</span> <span class="main">1</span>"</span></span> 
    <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> int <span class="main">(</span>Suc <span class="skolem">j</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">i</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> j_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="var">?oi</span> <span class="main">(</span>nat <span class="skolem">j</span><span class="main">)</span> <span class="main">*</span> <span class="free">y</span>"</span></span> 
    <span class="keyword1"><span class="command">have</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> u_def <span class="keyword1"><span class="command">using</span></span> y <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> <span class="main">-</span> <span class="free">x</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">y</span>"</span></span> 
    <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="var">?oi</span> <span class="free">i</span> <span class="main">*</span> <span class="free">y</span> <span class="main">=</span> <span class="main">-</span> <span class="skolem">z</span> <span class="main">+</span> <span class="skolem">u</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> i z_def u_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> xy y np<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> z_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> abs_id<span class="main">[</span><span class="operator">unfolded</span> id<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="skolem">z</span> <span class="main">+</span> <span class="skolem">u</span> <span class="main">=</span> <span class="main">-</span> <span class="free">x</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> u z np <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">folded</span> id<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> of_int <span class="main">(</span><span class="main">-</span> <span class="free">i</span><span class="main">)</span> <span class="main">*</span> <span class="free">y</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="var">?oi</span> <span class="main">(</span><span class="main">-</span> <span class="free">i</span><span class="main">)</span> <span class="main">*</span> <span class="free">y</span>"</span></span> 
    <span class="keyword1"><span class="command">with</span></span> xy i y
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> ccfv_SIG<span class="main"><span class="main">)</span></span> less_le minus_less_iff mult_le_cancel_right2 mult_minus1_right mult_minus_left mult_of_int_commute of_int_hom.hom_one of_int_le_1_iff of_int_minus<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This is the core lemma. It tells us that <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> croot<span class="antiquote"><span class="antiquote">}</span></span></span></span> will choose the 
  principal root, i.e. the root with
  largest real part and if there are two roots with identical real part, then the largest imaginary part.
  This criterion will be crucial for implementing <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> croot<span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword1" id="Complex_Roots-croot_principal"><span class="command">lemma</span></span> croot_principal<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">^</span> <span class="free">n</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> neq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≠</span> croot <span class="free">n</span> <span class="free">x</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">y</span> <span class="main">&lt;</span> Re <span class="main">(</span>croot <span class="free">n</span> <span class="free">x</span><span class="main">)</span> <span class="main">∨</span> Re <span class="free">y</span> <span class="main">=</span> Re <span class="main">(</span>croot <span class="free">n</span> <span class="free">x</span><span class="main">)</span> <span class="main">∧</span> Im <span class="free">y</span> <span class="main">&lt;</span> Im <span class="main">(</span>croot <span class="free">n</span> <span class="free">x</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">with</span></span> neq y <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> x<span class="main">:</span> False
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?root</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"croot <span class="free">n</span> <span class="free">x</span>"</span></span> 
  <span class="keyword1"><span class="command">from</span></span> n <span class="keyword1"><span class="command">have</span></span> n1<span class="main">:</span> <span class="quoted"><span class="quoted">"real <span class="free">n</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"real <span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"real <span class="free">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> x y n <span class="keyword1"><span class="command">have</span></span> y0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> croot_power<span class="main">[</span><span class="operator">OF</span> n<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> y
  <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?root</span> <span class="main">^</span> <span class="free">n</span> <span class="main">=</span> <span class="free">y</span> <span class="main">^</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cmod <span class="main">(</span><span class="var">?root</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> cmod <span class="main">(</span><span class="free">y</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> norm_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"cmod <span class="var">?root</span> <span class="main">=</span> cmod <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n <span class="keyword1"><span class="command">unfolding</span></span> norm_power
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> gr_zeroI norm_ge_zero power_eq_imp_eq_base<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cis <span class="main">(</span>arg <span class="free">y</span> <span class="main">*</span> real <span class="free">n</span><span class="main">)</span> <span class="main">=</span> cis <span class="main">(</span>arg <span class="main">(</span><span class="free">y</span><span class="main">^</span><span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> cis_arg_power<span class="main"><span class="main">[</span></span><span class="operator">OF</span> y0<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> cis <span class="main">(</span>arg <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> y <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> ciseq<span class="main">:</span> <span class="quoted"><span class="quoted">"cis <span class="main">(</span>arg <span class="free">y</span> <span class="main">*</span> real <span class="free">n</span><span class="main">)</span> <span class="main">=</span> cis <span class="main">(</span>arg <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> cis_eq<span class="main">[</span><span class="operator">OF</span> ciseq<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"arg <span class="free">y</span> <span class="main">*</span> real <span class="free">n</span> <span class="main">-</span> arg <span class="free">x</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> real_of_int <span class="skolem">i</span> <span class="main">*</span> pi"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"arg <span class="free">y</span> <span class="main">*</span> real <span class="free">n</span> <span class="main">=</span> arg <span class="free">x</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> real_of_int <span class="skolem">i</span> <span class="main">*</span> pi"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> arg_cong<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">/</span> real <span class="free">n</span>"</span></span><span class="main">]</span> n1
  <span class="keyword1"><span class="command">have</span></span> argy<span class="main">:</span> <span class="quoted"><span class="quoted">"arg <span class="free">y</span> <span class="main">=</span> arg <span class="var">?root</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> real_of_int <span class="skolem">i</span> <span class="main">*</span> pi <span class="main">/</span> real <span class="free">n</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> i0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"arg <span class="free">y</span> <span class="main">=</span> arg <span class="var">?root</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> argy <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> norm_eq <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?root</span> <span class="main">=</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rcis_cmod_arg<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> neq <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> y0 <span class="keyword1"><span class="command">have</span></span> cy0<span class="main">:</span> <span class="quoted"><span class="quoted">"cmod <span class="free">y</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> arg_bounded<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> abs_pi<span class="main">:</span> <span class="quoted"><span class="quoted">"abs <span class="main">(</span>arg <span class="free">x</span><span class="main">)</span> <span class="main">≤</span> pi"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">y</span> <span class="main">≤</span> Re <span class="var">?root</span> <span class="main">⟷</span> Re <span class="free">y</span> <span class="main">/</span> cmod <span class="free">y</span> <span class="main">≤</span> Re <span class="var">?root</span> <span class="main">/</span> cmod <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cy0 <span class="keyword1"><span class="command">unfolding</span></span> divide_le_cancel <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> cosy<span class="main">:</span> <span class="quoted"><span class="quoted">"Re <span class="free">y</span> <span class="main">/</span> cmod <span class="free">y</span> <span class="main">=</span> cos <span class="main">(</span>arg <span class="free">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> cos_arg<span class="main">[</span><span class="operator">OF</span> y0<span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> cosrt<span class="main">:</span> <span class="quoted"><span class="quoted">"Re <span class="var">?root</span> <span class="main">/</span> cmod <span class="free">y</span> <span class="main">=</span> cos <span class="main">(</span>arg <span class="var">?root</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> norm_eq<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> cos_arg<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> norm_eq cy0<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cos <span class="main">(</span>arg <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> cos <span class="main">(</span>arg <span class="var">?root</span><span class="main">)</span> <span class="main">⟷</span> abs <span class="main">(</span>arg <span class="var">?root</span><span class="main">)</span> <span class="main">≤</span> abs <span class="main">(</span>arg <span class="free">y</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cos_mono_le<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> arg_bounded<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">y</span></span></span></span></span></span><span class="main"><span class="main">]</span></span> arg_bounded<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?root</span></span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> abs <span class="main">(</span>arg <span class="var">?root</span><span class="main">)</span> <span class="main">*</span> real <span class="free">n</span> <span class="main">≤</span> abs <span class="main">(</span>arg <span class="free">y</span><span class="main">)</span> <span class="main">*</span> real <span class="free">n</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> mult_le_cancel_right <span class="keyword1"><span class="command">using</span></span> n1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> abs <span class="main">(</span>arg <span class="free">x</span><span class="main">)</span> <span class="main">≤</span> <span class="main">¦</span>arg <span class="free">x</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> real_of_int <span class="skolem">i</span> <span class="main">*</span> pi<span class="main">¦</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> argy <span class="keyword1"><span class="command">using</span></span> n1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> abs_pi
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> abs_add_2_mult_bound<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> le<span class="main">:</span> <span class="quoted"><span class="quoted">"Re <span class="free">y</span> <span class="main">≤</span> Re <span class="main">(</span>croot <span class="free">n</span> <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Re <span class="free">y</span> <span class="main">=</span> Re <span class="main">(</span>croot <span class="free">n</span> <span class="free">x</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> le <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">y</span> <span class="main">/</span> cmod <span class="free">y</span> <span class="main">=</span> Re <span class="var">?root</span> <span class="main">/</span> cmod <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cos <span class="main">(</span>arg <span class="free">y</span><span class="main">)</span> <span class="main">=</span> cos <span class="main">(</span>arg <span class="var">?root</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> cosy cosrt <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cos <span class="main">(</span>abs <span class="main">(</span>arg <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> cos <span class="main">(</span>abs <span class="main">(</span>arg <span class="var">?root</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> cos_abs <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">from</span></span> cos_inj_pi<span class="main">[</span><span class="operator">OF</span> _ _ _ _ this<span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"abs <span class="main">(</span>arg <span class="free">y</span><span class="main">)</span> <span class="main">=</span> abs <span class="main">(</span>arg <span class="var">?root</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> arg_bounded<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">y</span></span><span class="main">]</span> arg_bounded<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?root</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"abs <span class="main">(</span>arg <span class="free">y</span><span class="main">)</span> <span class="main">*</span> real <span class="free">n</span> <span class="main">=</span> abs <span class="main">(</span>arg <span class="var">?root</span><span class="main">)</span> <span class="main">*</span> real <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"abs <span class="main">(</span>arg <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">¦</span>arg <span class="free">x</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> real_of_int <span class="skolem">i</span> <span class="main">*</span> pi<span class="main">¦</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> argy 
      <span class="keyword1"><span class="command">using</span></span> n1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> abs_eq_add_2_mult<span class="main">[</span><span class="operator">OF</span> this _ _ <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">]</span> arg_bounded<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span>  
    <span class="keyword1"><span class="command">have</span></span> argx<span class="main">:</span> <span class="quoted"><span class="quoted">"arg <span class="free">x</span> <span class="main">=</span> pi"</span></span> <span class="keyword2"><span class="keyword">and</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> argy<span class="main">:</span> <span class="quoted"><span class="quoted">"arg <span class="free">y</span> <span class="main">=</span> <span class="main">-</span>pi <span class="main">/</span> real <span class="free">n</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> argy arg_croot i argx <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Im <span class="var">?root</span> <span class="main">&gt;</span> Im <span class="free">y</span> <span class="main">⟷</span> Im <span class="var">?root</span> <span class="main">/</span> cmod <span class="var">?root</span> <span class="main">&gt;</span> Im <span class="free">y</span> <span class="main">/</span> cmod <span class="free">y</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> norm_eq <span class="keyword1"><span class="command">using</span></span> cy0
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> divide_less_cancel divide_strict_right_mono<span class="main">)</span> 
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> sin <span class="main">(</span>arg <span class="var">?root</span><span class="main">)</span> <span class="main">&gt;</span> sin <span class="main">(</span>arg <span class="free">y</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>1 2<span class="main"><span class="main">)</span></span> sin_arg<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> y0 norm_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> sin <span class="main">(</span><span class="main">-</span> pi <span class="main">/</span> real <span class="free">n</span><span class="main">)</span> <span class="main">&lt;</span> sin <span class="main">(</span>pi <span class="main">/</span> real <span class="free">n</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> argy arg_croot argx <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="main">…</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sin <span class="main">(</span><span class="main">-</span> pi <span class="main">/</span> real <span class="free">n</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> n1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">)</span></span> arg_bounded argy divide_neg_pos sin_gt_zero sin_minus<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> sin <span class="main">(</span>pi <span class="main">/</span> real <span class="free">n</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> n1 calculation <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> le <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Complex_Roots-croot_unique"><span class="command">lemma</span></span> croot_unique<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">^</span> <span class="free">n</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> y_max_Re_Im<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">^</span> <span class="free">n</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⟹</span>
      Re <span class="bound">z</span> <span class="main">&lt;</span> Re <span class="free">y</span> <span class="main">∨</span> Re <span class="bound">z</span> <span class="main">=</span> Re <span class="free">y</span> <span class="main">∧</span> Im <span class="bound">z</span> <span class="main">≤</span> Im <span class="free">y</span>"</span></span> 
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"croot <span class="free">n</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"croot <span class="free">n</span> <span class="free">x</span> <span class="main">≠</span> <span class="free">y</span>"</span></span> 
  <span class="keyword1"><span class="command">from</span></span> croot_principal<span class="main">[</span><span class="operator">OF</span> n y this<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">y</span> <span class="main">&lt;</span> Re <span class="main">(</span>croot <span class="free">n</span> <span class="free">x</span><span class="main">)</span> <span class="main">∨</span>
    Re <span class="free">y</span> <span class="main">=</span> Re <span class="main">(</span>croot <span class="free">n</span> <span class="free">x</span><span class="main">)</span> <span class="main">∧</span> Im <span class="free">y</span> <span class="main">&lt;</span> Im <span class="main">(</span>croot <span class="free">n</span> <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">with</span></span> y_max_Re_Im<span class="main">[</span><span class="operator">OF</span> croot_power<span class="main"><span class="main">[</span></span><span class="operator">OF</span> n<span class="main"><span class="main">]</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Complex_Roots-csqrt_is_croot_2"><span class="command">lemma</span></span> csqrt_is_croot_2<span class="main">:</span> <span class="quoted"><span class="quoted">"csqrt <span class="main">=</span> croot <span class="numeral">2</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"csqrt <span class="skolem">x</span> <span class="main">=</span> croot <span class="numeral">2</span> <span class="skolem">x</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> croot_unique<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="main">-</span><span class="skolem">x</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span>"</span></span> 
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cx</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"csqrt <span class="skolem">x</span>"</span></span> 
    <span class="keyword1"><span class="command">have</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?p</span> <span class="main">=</span> <span class="main">[:</span><span class="var">?cx</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="main">*</span> <span class="main">[:</span><span class="main">-</span><span class="var">?cx</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> 
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"True <span class="main">⟷</span> poly <span class="var">?p</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">-</span> <span class="var">?cx</span> <span class="main">∨</span> <span class="skolem">y</span> <span class="main">=</span> <span class="var">?cx</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> p poly_mult mult_eq_0_iff poly_root_factor <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="main">-</span> <span class="var">?cx</span> <span class="main">∨</span> <span class="skolem">y</span> <span class="main">=</span> <span class="var">?cx</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">y</span> <span class="main">&lt;</span> Re <span class="var">?cx</span> <span class="main">∨</span> Re <span class="skolem">y</span> <span class="main">=</span> Re <span class="var">?cx</span> <span class="main">∧</span> Im <span class="skolem">y</span> <span class="main">≤</span> Im <span class="var">?cx</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="main">-</span> <span class="var">?cx</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Re <span class="var">?cx</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">with</span></span> csqrt_principal<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="var">?cx</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> y <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">with</span></span> csqrt_principal<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Im <span class="var">?cx</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> y <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Complex_Roots-croot_via_root_selection"><span class="command">lemma</span></span> croot_via_root_selection<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> roots<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">ys</span> <span class="main">=</span> <span class="main">{</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span><span class="main">^</span><span class="free">n</span> <span class="main">=</span> <span class="free">x</span><span class="main">}</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"croot <span class="free">n</span> <span class="free">x</span> <span class="main">=</span> arg_min_list <span class="main">(</span><span class="main">λ</span> <span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span> Re <span class="bound">y</span><span class="main">,</span> <span class="main">-</span> Im <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="free">ys</span>"</span></span> 
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> arg_min_list <span class="var">?f</span> <span class="free">ys</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> croot_unique<span class="main"><span class="main">[</span></span><span class="operator">OF</span> n<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?y</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"arg_min_list <span class="var">?f</span> <span class="free">ys</span>"</span></span> 
  <span class="keyword1"><span class="command">have</span></span> rt<span class="main">:</span> <span class="quoted"><span class="quoted">"croot <span class="free">n</span> <span class="free">x</span> <span class="main">^</span> <span class="free">n</span> <span class="main">=</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> croot_power<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"croot <span class="free">n</span> <span class="free">x</span> <span class="main">∈</span> set <span class="free">ys</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> roots <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> ys<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ys</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> arg_min_list_in<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?y</span> <span class="main">∈</span> set <span class="free">ys</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">unfolded</span> roots<span class="main">]</span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?y</span><span class="main">^</span><span class="free">n</span> <span class="main">=</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span><span class="main">^</span><span class="free">n</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> set <span class="free">ys</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> roots <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> f_arg_min_list_f<span class="main">[</span><span class="operator">OF</span> ys<span class="main">,</span> <span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span><span class="main">]</span> z 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="var">?y</span> <span class="main">≤</span> <span class="var">?f</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">z</span> <span class="main">&lt;</span> Re <span class="var">?y</span> <span class="main">∨</span> Re <span class="skolem">z</span> <span class="main">=</span> Re <span class="var">?y</span> <span class="main">∧</span> Im <span class="skolem">z</span> <span class="main">≤</span> Im <span class="var">?y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Complex_Roots-croot_impl"><span class="command">lemma</span></span> croot_impl<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"croot <span class="free">n</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">n</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> 
  arg_min_list <span class="main">(</span><span class="main">λ</span> <span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="main">-</span> Re <span class="bound">y</span><span class="main">,</span> <span class="main">-</span> Im <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>all_croots <span class="free">n</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> n0<span class="main">:</span> False
  <span class="keyword1"><span class="command">hence</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> <span class="free">n</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="skolem">y</span> <span class="keyword1">else</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">z</span>"</span></span> 
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="skolem">u</span> <span class="main">::</span> <span class="quoted">complex</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> id Let_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> croot_via_root_selection<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ n0<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> all_croots<span class="main"><span class="main">[</span></span><span class="operator">OF</span> n0<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Cubic_Polynomials">
<div class="head">
<h1>Theory Cubic_Polynomials</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Algorithms to compute all complex and real roots of a cubic polynomial›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Cubic_Polynomials
  <span class="keyword2"><span class="keyword">imports</span></span> 
    <a href="#Cardanos_Formula">Cardanos_Formula</a>
    <a href="#Complex_Roots">Complex_Roots</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> MPoly_Type.degree
<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> MPoly_Type.coeffs

<span class="comment1">(* TODO: this should be integrated into distribution *)</span>
<span class="keyword1" id="Cubic_Polynomials-complex_of_real_code"><span class="command">lemma</span></span> complex_of_real_code<span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"complex_of_real <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> Complex <span class="bound">x</span> <span class="main">0</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> complex_eq_iff<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The real case where a result is only delivered if the discriminant is negative›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">solve_depressed_cubic_Cardano_real</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real <span class="main">⇒</span> real option"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">solve_depressed_cubic_Cardano_real</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> <span class="main">(</span>
    <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> Some <span class="main">(</span>root <span class="numeral">3</span> <span class="main">(</span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span>
     <span class="keyword1">let</span> <span class="bound">v</span> <span class="main">=</span> <span class="main">-</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">^</span> <span class="numeral">3</span> <span class="main">/</span> <span class="numeral">27</span><span class="main">)</span> <span class="keyword1">in</span>
     <span class="keyword1">case</span> rroots2 <span class="main">[:</span><span class="bound">v</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="keyword1">of</span> 
       <span class="main">[</span><span class="bound">u</span><span class="main">,</span><span class="main"><span class="bound">_</span></span><span class="main">]</span> <span class="main">⇒</span> <span class="keyword1">let</span> <span class="bound">rt</span> <span class="main">=</span> root <span class="numeral">3</span> <span class="bound">u</span> <span class="keyword1">in</span> Some <span class="main">(</span><span class="bound">rt</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">/</span> <span class="main">(</span><span class="numeral">3</span> <span class="main">*</span> <span class="bound">rt</span><span class="main">)</span><span class="main">)</span>
     <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> None<span class="main">)</span>"</span></span> 

<span class="keyword1" id="Cubic_Polynomials-solve_depressed_cubic_Cardano_real"><span class="command">lemma</span></span> solve_depressed_cubic_Cardano_real<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"solve_depressed_cubic_Cardano_real <span class="free">e</span> <span class="free">f</span> <span class="main">=</span> Some <span class="free">y</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span><span class="main">^</span><span class="numeral">3</span> <span class="main">+</span> <span class="free">e</span> <span class="main">*</span> <span class="bound">y</span> <span class="main">+</span> <span class="free">f</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="free">y</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span><span class="main">^</span><span class="numeral">3</span> <span class="main">+</span> <span class="free">e</span> <span class="main">*</span> <span class="bound">y</span> <span class="main">+</span> <span class="free">f</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span><span class="main">^</span><span class="numeral">3</span> <span class="main">=</span> <span class="main">-</span><span class="free">f</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> True 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">{</span>root <span class="numeral">3</span> <span class="main">(</span><span class="main">-</span><span class="free">f</span><span class="main">)</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> odd_real_root_unique<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">3</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">f</span>"</span></span><span class="main">]</span> odd_real_root_pow<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">3</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"root <span class="numeral">3</span> <span class="main">(</span><span class="main">-</span><span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> True solve_depressed_cubic_Cardano_real_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="main">-</span> <span class="main">(</span><span class="free">e</span> <span class="main">^</span> <span class="numeral">3</span> <span class="main">/</span> <span class="numeral">27</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">note</span></span> * <span class="main">=</span> assms<span class="main">[</span><span class="operator">unfolded</span> solve_depressed_cubic_Cardano_real_def Let_def<span class="main">,</span> <span class="operator">folded</span> v_def<span class="main">]</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?rr</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"rroots2 <span class="main">[:</span><span class="skolem">v</span><span class="main">,</span><span class="free">f</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span>"</span></span> 
  <span class="keyword1"><span class="command">from</span></span> * False <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">u'</span></span> <span class="keyword2"><span class="keyword">where</span></span> rr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?rr</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">u'</span><span class="main">]</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="var"><span class="quoted"><span class="var">?rr</span></span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"tl <span class="var">?rr</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"tl <span class="main">(</span>tl <span class="var">?rr</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> *<span class="main">[</span><span class="operator">unfolded</span> rr list.simps<span class="main">]</span> False 
  <span class="keyword1"><span class="command">have</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> root <span class="numeral">3</span> <span class="skolem">u</span> <span class="main">-</span> <span class="free">e</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">3</span> <span class="main">*</span> root <span class="numeral">3</span> <span class="skolem">u</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> set <span class="main">(</span>rroots2 <span class="main">[:</span><span class="skolem">v</span><span class="main">,</span><span class="free">f</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> rr <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>rroots2 <span class="main">[:</span><span class="skolem">v</span><span class="main">,</span><span class="free">f</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">u</span><span class="main">.</span> poly <span class="main">[:</span><span class="skolem">v</span><span class="main">,</span><span class="free">f</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="bound">u</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> rroots2<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">f</span> <span class="main">*</span> <span class="skolem">u</span> <span class="main">+</span> <span class="skolem">v</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> power2_eq_square<span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> Cardano <span class="main">=</span> solve_cubic_depressed_Cardano_real<span class="main">[</span><span class="operator">OF</span> False v_def u<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">=</span> Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> rr <span class="keyword1"><span class="command">have</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="numeral">4</span> <span class="main">*</span> <span class="skolem">v</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> rroots2_def Let_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> 2<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"discriminant_cubic_depressed <span class="free">e</span> <span class="free">f</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> discriminant_cubic_depressed_def v_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Cardano<span class="main">(</span>1<span class="main">)</span> Cardano<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> 0<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> y<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The complex case›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">solve_depressed_cubic_complex</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex <span class="main">⇒</span> complex <span class="main">⇒</span> complex list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">solve_depressed_cubic_complex</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span>
          <span class="bound">ys</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> all_croots <span class="numeral">3</span> <span class="main">(</span><span class="main">-</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">(</span><span class="keyword1">let</span>
       <span class="bound">u</span> <span class="main">=</span> hd <span class="main">(</span>croots2 <span class="main">[:</span> <span class="main">-</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">^</span> <span class="numeral">3</span> <span class="main">/</span> <span class="numeral">27</span><span class="main">)</span> <span class="main">,</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">,</span><span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">;</span> 
       <span class="bound">zs</span> <span class="main">=</span> all_croots <span class="numeral">3</span> <span class="bound">u</span> 
       <span class="keyword1">in</span> map <span class="main">(</span><span class="main">λ</span> <span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">/</span> <span class="main">(</span><span class="numeral">3</span> <span class="main">*</span> <span class="bound">z</span><span class="main">)</span><span class="main">)</span> <span class="bound">zs</span><span class="main">)</span><span class="main">)</span>
      <span class="keyword1">in</span> remdups <span class="bound">ys</span><span class="main">)</span>"</span></span> 

<span class="keyword1" id="Cubic_Polynomials-solve_depressed_cubic_complex_code"><span class="command">lemma</span></span> solve_depressed_cubic_complex_code<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"solve_depressed_cubic_complex <span class="free">e</span> <span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span>
          <span class="bound">ys</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">e</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> all_croots <span class="numeral">3</span> <span class="main">(</span><span class="main">-</span> <span class="free">f</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">(</span><span class="keyword1">let</span>
            <span class="bound">f2</span> <span class="main">=</span> <span class="free">f</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">;</span>
            <span class="bound">u</span> <span class="main">=</span> <span class="main">-</span> <span class="bound">f2</span> <span class="main">+</span> csqrt <span class="main">(</span><span class="bound">f2</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">e</span> <span class="main">^</span> <span class="numeral">3</span> <span class="main">/</span> <span class="numeral">27</span><span class="main">)</span><span class="main">;</span>
            <span class="bound">zs</span> <span class="main">=</span> all_croots <span class="numeral">3</span> <span class="bound">u</span> 
            <span class="keyword1">in</span> map <span class="main">(</span><span class="main">λ</span> <span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">-</span> <span class="free">e</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">3</span> <span class="main">*</span> <span class="bound">z</span><span class="main">)</span><span class="main">)</span> <span class="bound">zs</span><span class="main">)</span><span class="main">)</span>
      <span class="keyword1">in</span> remdups <span class="bound">ys</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> solve_depressed_cubic_complex_def Let_def croots2_def 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> numeral_2_eq_2<span class="main">)</span>


<span class="keyword1" id="Cubic_Polynomials-solve_depressed_cubic_complex"><span class="command">lemma</span></span> solve_depressed_cubic_complex<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> set <span class="main">(</span>solve_depressed_cubic_complex <span class="free">e</span> <span class="free">f</span><span class="main">)</span> 
  <span class="main">⟷</span> <span class="main">(</span><span class="free">y</span><span class="main">^</span><span class="numeral">3</span> <span class="main">+</span> <span class="free">e</span> <span class="main">*</span> <span class="free">y</span> <span class="main">+</span> <span class="free">f</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> solve_depressed_cubic_complex_def Let_def all_croots eq_neg_iff_add_eq_0<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> e0<span class="main">:</span> False
  <span class="keyword1"><span class="command">hence</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> <span class="free">e</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="skolem">x</span> <span class="keyword1">else</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex list"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="main">-</span> <span class="main">(</span><span class="free">e</span> <span class="main">^</span> <span class="numeral">3</span> <span class="main">/</span> <span class="numeral">27</span><span class="main">)</span>"</span></span> 
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="main">[:</span><span class="skolem">v</span><span class="main">,</span> <span class="free">f</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span>"</span></span> 
  <span class="keyword1"><span class="command">have</span></span> p2<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="skolem">p</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?u</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span>croots2 <span class="skolem">p</span><span class="main">)</span>"</span></span> 
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="var">?u</span>"</span></span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> set <span class="main">(</span>croots2 <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> croots2_def Let_def u_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> croots2<span class="main">[</span><span class="operator">OF</span> p2<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="skolem">p</span> <span class="skolem">u</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">f</span> <span class="main">*</span> <span class="skolem">u</span> <span class="main">+</span> <span class="skolem">v</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> power2_eq_square<span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> cube_roots <span class="main">=</span> all_croots<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">3</span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> solve_depressed_cubic_complex_def Let_def set_remdups set_map id cube_roots
    <span class="keyword1"><span class="command">unfolding</span></span> v_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> p_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> set_concat set_map
      u_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
    <span class="keyword1"><span class="command">have</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="skolem">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">f</span> <span class="main">*</span> <span class="bound">u</span> <span class="main">+</span> <span class="skolem">v</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> power2_eq_square<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> cube<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span> <span class="main">(</span>set <span class="main">`</span> all_croots <span class="numeral">3</span> <span class="main">`</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="skolem">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">z</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">u</span><span class="main">.</span> <span class="bound">u</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="free">f</span> <span class="main">*</span> <span class="bound">u</span> <span class="main">+</span> <span class="skolem">v</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">^</span> <span class="numeral">3</span> <span class="main">=</span> <span class="bound">u</span><span class="main">}</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> p <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cube_roots<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">y</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">-</span> <span class="free">e</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">3</span> <span class="main">*</span> <span class="bound">z</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">^</span> <span class="numeral">3</span> <span class="main">=</span> <span class="skolem">u</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">y</span> <span class="main">^</span> <span class="numeral">3</span> <span class="main">+</span> <span class="free">e</span> <span class="main">*</span> <span class="free">y</span> <span class="main">+</span> <span class="free">f</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> solve_cubic_depressed_Cardano_complex<span class="main">[</span><span class="operator">OF</span> e0 v_def u<span class="main">]</span> cube <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹For the general real case, we first try Cardano with negative discrimiant and only if it is not applicable,
   then we go for the calculation using complex numbers. Note that for for non-negative delta 
   no filter is required to identify the real roots from the list of complex roots, since in that case we 
   already know that all roots are real.›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">solve_depressed_cubic_real</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real <span class="main">⇒</span> real list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">solve_depressed_cubic_real</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> solve_depressed_cubic_Cardano_real <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> 
      <span class="keyword1">of</span> Some <span class="bound">y</span> <span class="main">⇒</span> <span class="main">[</span><span class="bound">y</span><span class="main">]</span> 
       <span class="main">|</span> None <span class="main">⇒</span> map Re <span class="main">(</span>solve_depressed_cubic_complex <span class="main">(</span>of_real <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="main">(</span>of_real <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Cubic_Polynomials-solve_depressed_cubic_real_code"><span class="command">lemma</span></span> solve_depressed_cubic_real_code<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"solve_depressed_cubic_real <span class="free">e</span> <span class="free">f</span> <span class="main">=</span>
  <span class="main">(</span><span class="keyword1">if</span> <span class="free">e</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">[</span>root <span class="numeral">3</span> <span class="main">(</span><span class="main">-</span><span class="free">f</span><span class="main">)</span><span class="main">]</span> <span class="keyword1">else</span> 
   <span class="keyword1">let</span> <span class="bound">v</span> <span class="main">=</span> <span class="free">e</span> <span class="main">^</span> <span class="numeral">3</span> <span class="main">/</span> <span class="numeral">27</span><span class="main">;</span> 
       <span class="bound">f2</span> <span class="main">=</span> <span class="free">f</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">;</span>
       <span class="bound">f2v</span> <span class="main">=</span> <span class="bound">f2</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="bound">v</span> <span class="keyword1">in</span>
   <span class="keyword1">if</span> <span class="bound">f2v</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="keyword1">then</span> 
     <span class="keyword1">let</span> <span class="bound">u</span> <span class="main">=</span> <span class="main">-</span><span class="bound">f2</span> <span class="main">+</span> sqrt <span class="bound">f2v</span><span class="main">;</span>
         <span class="bound">rt</span> <span class="main">=</span> root <span class="numeral">3</span> <span class="bound">u</span>
      <span class="keyword1">in</span> <span class="main">[</span><span class="bound">rt</span> <span class="main">-</span> <span class="free">e</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">3</span> <span class="main">*</span> <span class="bound">rt</span><span class="main">)</span><span class="main">]</span>
  <span class="keyword1">else</span> 
  <span class="keyword1">let</span> <span class="bound">ce3</span> <span class="main">=</span> of_real <span class="free">e</span> <span class="main">/</span> <span class="numeral">3</span><span class="main">;</span> 
      <span class="bound">u</span> <span class="main">=</span> <span class="main">-</span> of_real <span class="bound">f2</span> <span class="main">+</span> csqrt <span class="main">(</span>of_real <span class="bound">f2v</span><span class="main">)</span> <span class="keyword1">in</span>
   map Re <span class="main">(</span>remdups <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">rt</span><span class="main">.</span> <span class="bound">rt</span> <span class="main">-</span> <span class="bound">ce3</span> <span class="main">/</span> <span class="bound">rt</span><span class="main">)</span> <span class="main">(</span>all_croots <span class="numeral">3</span> <span class="bound">u</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"rroots2 <span class="main">[:</span><span class="skolem">v</span><span class="main">,</span> <span class="free">f</span><span class="main">,</span> <span class="main">1</span><span class="main">:]</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> 
     <span class="bound">f2</span> <span class="main">=</span> <span class="free">f</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">;</span>
     <span class="bound">bac</span> <span class="main">=</span> <span class="bound">f2</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="skolem">v</span> <span class="keyword1">in</span> 
     <span class="keyword1">if</span> <span class="bound">bac</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">[</span><span class="main">-</span> <span class="bound">f2</span><span class="main">]</span> <span class="keyword1">else</span> 
     <span class="keyword1">if</span> <span class="bound">bac</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">[]</span> <span class="keyword1">else</span> <span class="keyword1">let</span> <span class="bound">e</span> <span class="main">=</span> sqrt <span class="bound">bac</span> <span class="keyword1">in</span> <span class="main">[</span><span class="main">-</span> <span class="bound">f2</span> <span class="main">+</span> <span class="bound">e</span><span class="main">,</span> <span class="main">-</span> <span class="bound">f2</span> <span class="main">-</span> <span class="bound">e</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">v</span>
    <span class="keyword1"><span class="command">unfolding</span></span> rroots2_def Let_def numeral_2_eq_2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">foo</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real <span class="main">⇒</span> real option"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
    <span class="quoted"><span class="quoted">"<span class="skolem">foo</span> <span class="skolem">f2v</span> <span class="skolem">f2</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">f2v</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">[</span><span class="main">-</span> <span class="skolem">f2</span><span class="main">]</span> <span class="keyword1">else</span> <span class="main">[]</span><span class="main">)</span> <span class="keyword1">of</span> <span class="main">[]</span> <span class="main">⇒</span> None <span class="main">|</span> <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> None<span class="main">)</span>"</span></span> 
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">f2v</span> <span class="skolem">f2</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"solve_depressed_cubic_real <span class="free">e</span> <span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">e</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">[</span>root <span class="numeral">3</span> <span class="main">(</span><span class="main">-</span><span class="free">f</span><span class="main">)</span><span class="main">]</span> <span class="keyword1">else</span> 
   <span class="keyword1">let</span> <span class="bound">v</span> <span class="main">=</span> <span class="free">e</span> <span class="main">^</span> <span class="numeral">3</span> <span class="main">/</span> <span class="numeral">27</span><span class="main">;</span> 
       <span class="bound">f2</span> <span class="main">=</span> <span class="free">f</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">;</span>
       <span class="bound">f2v</span> <span class="main">=</span> <span class="bound">f2</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="bound">v</span> <span class="keyword1">in</span>
   <span class="keyword1">if</span> <span class="bound">f2v</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="keyword1">then</span> 
     <span class="keyword1">let</span> <span class="bound">u</span> <span class="main">=</span> <span class="main">-</span><span class="bound">f2</span> <span class="main">+</span> sqrt <span class="bound">f2v</span><span class="main">;</span>
         <span class="bound">rt</span> <span class="main">=</span> root <span class="numeral">3</span> <span class="bound">u</span>
      <span class="keyword1">in</span> <span class="main">[</span><span class="bound">rt</span> <span class="main">-</span> <span class="free">e</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">3</span> <span class="main">*</span> <span class="bound">rt</span><span class="main">)</span><span class="main">]</span>
  <span class="keyword1">else</span> 
  <span class="main">(</span><span class="keyword1">case</span> <span class="skolem">foo</span> <span class="bound">f2v</span> <span class="bound">f2</span> <span class="keyword1">of</span>
     None <span class="main">⇒</span> <span class="keyword1">let</span> <span class="bound">u</span> <span class="main">=</span> <span class="main">-</span> cor <span class="bound">f2</span> <span class="main">+</span> csqrt <span class="main">(</span>cor <span class="bound">f2v</span><span class="main">)</span> <span class="keyword1">in</span>
   map Re
    <span class="main">(</span>remdups <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">-</span> cor <span class="free">e</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">3</span> <span class="main">*</span> <span class="bound">z</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>all_croots <span class="numeral">3</span> <span class="bound">u</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
   <span class="main">|</span> Some <span class="bound">y</span> <span class="main">⇒</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> solve_depressed_cubic_real_def solve_depressed_cubic_Cardano_real_def 
      solve_depressed_cubic_complex_code
      Let_def id foo_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">foo</span> <span class="skolem">f2v</span> <span class="skolem">f2</span> <span class="main">=</span> None"</span></span> 
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">f2v</span> <span class="skolem">f2</span> <span class="keyword1"><span class="command">unfolding</span></span> foo_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Cubic_Polynomials-solve_depressed_cubic_real"><span class="command">lemma</span></span> solve_depressed_cubic_real<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> set <span class="main">(</span>solve_depressed_cubic_real <span class="free">e</span> <span class="free">f</span><span class="main">)</span> 
  <span class="main">⟷</span> <span class="main">(</span><span class="free">y</span><span class="main">^</span><span class="numeral">3</span> <span class="main">+</span> <span class="free">e</span> <span class="main">*</span> <span class="free">y</span> <span class="main">+</span> <span class="free">f</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"solve_depressed_cubic_Cardano_real <span class="free">e</span> <span class="free">f</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Some <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> solve_depressed_cubic_real_def Some option.simps
    <span class="keyword1"><span class="command">using</span></span> solve_depressed_cubic_Cardano_real<span class="main">[</span><span class="operator">OF</span> Some<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> None
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">unfolded</span> solve_depressed_cubic_Cardano_real_def Let_def rroots2_def<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> disc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> discriminant_cubic_depressed <span class="free">e</span> <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> discriminant_cubic_depressed_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> numeral_2_eq_2<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"complex_of_real"</span></span> 
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?y</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?c</span> <span class="free">y</span>"</span></span> 
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?e</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?c</span> <span class="free">e</span>"</span></span> 
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?c</span> <span class="free">f</span>"</span></span> 
  <span class="keyword1"><span class="command">have</span></span> sub<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>solve_depressed_cubic_complex <span class="var">?e</span> <span class="var">?f</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">ℝ</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> 
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span>
    <span class="keyword3"><span class="command">assume</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> set <span class="main">(</span>solve_depressed_cubic_complex <span class="var">?e</span> <span class="var">?f</span><span class="main">)</span>"</span></span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="main">ℝ</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> solve_cubic_depressed_Cardano_all_real_roots<span class="main"><span class="main">[</span></span><span class="operator">OF</span> disc y<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> solve_depressed_cubic_complex<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main">^</span><span class="numeral">3</span> <span class="main">+</span> <span class="free">e</span> <span class="main">*</span> <span class="free">y</span> <span class="main">+</span> <span class="free">f</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="main">(</span><span class="var">?c</span> <span class="main">(</span><span class="free">y</span><span class="main">^</span><span class="numeral">3</span> <span class="main">+</span> <span class="free">e</span> <span class="main">*</span> <span class="free">y</span> <span class="main">+</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="var">?c</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> of_real_eq_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="var">?y</span><span class="main">^</span><span class="numeral">3</span> <span class="main">+</span> <span class="var">?e</span> <span class="main">*</span> <span class="var">?y</span> <span class="main">+</span> <span class="var">?f</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="var">?y</span> <span class="main">∈</span> set <span class="main">(</span>solve_depressed_cubic_complex <span class="var">?e</span> <span class="var">?f</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> solve_depressed_cubic_complex <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="free">y</span> <span class="main">∈</span> Re <span class="main">`</span> set <span class="main">(</span>solve_depressed_cubic_complex <span class="var">?e</span> <span class="var">?f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sub <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> solve_depressed_cubic_real_def None <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Combining the various algorithms›</span></span>

<span class="keyword1" id="Cubic_Polynomials-degree3_coeffs"><span class="command">lemma</span></span> degree3_coeffs<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">=</span> <span class="numeral">3</span> <span class="main">⟹</span>
  <span class="main">∃</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">.</span> <span class="free">p</span> <span class="main">=</span> <span class="main">[:</span> <span class="bound">d</span><span class="main">,</span> <span class="bound">c</span><span class="main">,</span> <span class="bound">b</span><span class="main">,</span> <span class="bound">a</span> <span class="main">:]</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def Suc_1 degree2_coeffs degree_pCons_eq_if nat.inject numeral_3_eq_3 pCons_cases zero_neq_numeral<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">roots3_generic</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span> field_char_0 <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> list<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> poly <span class="main">⇒</span> <span class="tfree">'a</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">roots3_generic</span> <span class="free"><span class="bound"><span class="entity">depressed_solver</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> 
     <span class="bound">cs</span> <span class="main">=</span> coeffs <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">;</span> 
     <span class="bound">a</span> <span class="main">=</span> <span class="bound">cs</span> <span class="main">!</span> <span class="numeral">3</span><span class="main">;</span> <span class="bound">b</span> <span class="main">=</span> <span class="bound">cs</span> <span class="main">!</span> <span class="numeral">2</span><span class="main">;</span> <span class="bound">c</span> <span class="main">=</span> <span class="bound">cs</span> <span class="main">!</span> <span class="main">1</span><span class="main">;</span> <span class="bound">d</span> <span class="main">=</span> <span class="bound">cs</span> <span class="main">!</span> <span class="main">0</span><span class="main">;</span>
     <span class="bound">a3</span> <span class="main">=</span> <span class="numeral">3</span> <span class="main">*</span> <span class="bound">a</span><span class="main">;</span>
     <span class="bound">ba3</span> <span class="main">=</span> <span class="bound">b</span> <span class="main">/</span> <span class="bound">a3</span><span class="main">;</span>
     <span class="bound">b2</span> <span class="main">=</span> <span class="bound">b</span> <span class="main">*</span> <span class="bound">b</span><span class="main">;</span>
     <span class="bound">b3</span> <span class="main">=</span> <span class="bound">b2</span> <span class="main">*</span> <span class="bound">b</span><span class="main">;</span>
     <span class="bound">e</span> <span class="main">=</span> <span class="main">(</span><span class="bound">c</span> <span class="main">-</span> <span class="bound">b2</span> <span class="main">/</span> <span class="bound">a3</span><span class="main">)</span> <span class="main">/</span> <span class="bound">a</span><span class="main">;</span>
     <span class="bound">f</span> <span class="main">=</span> <span class="main">(</span><span class="bound">d</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="bound">b3</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">27</span> <span class="main">*</span> <span class="bound">a</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="bound">b</span> <span class="main">*</span> <span class="bound">c</span> <span class="main">/</span> <span class="bound">a3</span><span class="main">)</span> <span class="main">/</span> <span class="bound">a</span><span class="main">;</span>
     <span class="bound">roots</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">depressed_solver</span></span></span> <span class="bound">e</span> <span class="bound">f</span>
     <span class="keyword1">in</span> map <span class="main">(</span><span class="main">λ</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">-</span> <span class="bound">ba3</span><span class="main">)</span> <span class="bound">roots</span><span class="main">)</span>"</span></span> 

<span class="keyword1" id="Cubic_Polynomials-roots3_generic"><span class="command">lemma</span></span> roots3_generic<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> deg<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">=</span> <span class="numeral">3</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> solver<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">e</span> <span class="bound">f</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">depressed_solver</span> <span class="bound">e</span> <span class="bound">f</span><span class="main">)</span> <span class="main">⟷</span> <span class="bound">y</span><span class="main">^</span><span class="numeral">3</span> <span class="main">+</span> <span class="bound">e</span> <span class="main">*</span> <span class="bound">y</span> <span class="main">+</span> <span class="bound">f</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>roots3_generic <span class="free">depressed_solver</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">note</span></span> powers <span class="main">=</span> <span class="dynamic"><span class="dynamic">field_simps</span></span> power3_eq_cube power2_eq_square
  <span class="keyword1"><span class="command">from</span></span> degree3_coeffs<span class="main">[</span><span class="operator">OF</span> deg<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">[:</span><span class="skolem">d</span><span class="main">,</span><span class="skolem">c</span><span class="main">,</span><span class="skolem">b</span><span class="main">,</span><span class="skolem">a</span><span class="main">:]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> coeffs<span class="main">:</span> <span class="quoted"><span class="quoted">"coeffs <span class="free">p</span> <span class="main">!</span> <span class="numeral">3</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span> <span class="quoted"><span class="quoted">"coeffs <span class="free">p</span> <span class="main">!</span> <span class="numeral">2</span> <span class="main">=</span> <span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"coeffs <span class="free">p</span> <span class="main">!</span> <span class="main">1</span> <span class="main">=</span> <span class="skolem">c</span>"</span></span> <span class="quoted"><span class="quoted">"coeffs <span class="free">p</span> <span class="main">!</span> <span class="main">0</span> <span class="main">=</span> <span class="skolem">d</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> p <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">c</span> <span class="main">-</span> <span class="skolem">b</span><span class="main">^</span><span class="numeral">2</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">3</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">a</span>"</span></span> 
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">d</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">^</span><span class="numeral">3</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">27</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">b</span> <span class="main">*</span> <span class="skolem">c</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">3</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">a</span>"</span></span> 
  <span class="keyword1"><span class="command">note</span></span> def <span class="main">=</span> roots3_generic_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">depressed_solver</span></span> <span class="quoted"><span class="free">p</span></span><span class="main">,</span> <span class="operator">unfolded</span> Let_def coeffs<span class="main">,</span>
      <span class="operator">folded</span> power3_eq_cube<span class="main">,</span> <span class="operator">folded</span> power2_eq_square<span class="main">,</span>  <span class="operator">folded</span> e_def f_def<span class="main">]</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">b</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">3</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">have</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">-</span> <span class="skolem">b</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">3</span> <span class="main">*</span> <span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> y_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">^</span><span class="numeral">3</span> <span class="main">+</span> <span class="skolem">b</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="skolem">c</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">d</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powers<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">^</span> <span class="numeral">3</span> <span class="main">+</span> <span class="skolem">e</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">+</span> <span class="skolem">f</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> to_depressed_cubic<span class="main">[</span><span class="operator">OF</span> a xy e_def f_def<span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="skolem">y</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">depressed_solver</span> <span class="skolem">e</span> <span class="skolem">f</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> solver <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="skolem">x</span> <span class="main">∈</span> set <span class="main">(</span>roots3_generic <span class="free">depressed_solver</span> <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> xy def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="free">p</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="skolem">x</span> <span class="main">∈</span> set <span class="main">(</span>roots3_generic <span class="free">depressed_solver</span> <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">croots3</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex poly <span class="main">⇒</span> complex list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">croots3</span> <span class="main">=</span> roots3_generic solve_depressed_cubic_complex"</span></span>

<span class="keyword1" id="Cubic_Polynomials-croots3"><span class="command">lemma</span></span> croots3<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> deg<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">=</span> <span class="numeral">3</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>croots3 <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span> <span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> croots3_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> roots3_generic<span class="main"><span class="main">[</span></span><span class="operator">OF</span> deg solve_depressed_cubic_complex<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rroots3</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real poly <span class="main">⇒</span> real list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">rroots3</span> <span class="main">=</span> roots3_generic solve_depressed_cubic_real"</span></span>

<span class="keyword1" id="Cubic_Polynomials-rroots3"><span class="command">lemma</span></span> rroots3<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> deg<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">=</span> <span class="numeral">3</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>rroots3 <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span> <span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> rroots3_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> roots3_generic<span class="main"><span class="main">[</span></span><span class="operator">OF</span> deg solve_depressed_cubic_real<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Quartic_Polynomials">
<div class="head">
<h1>Theory Quartic_Polynomials</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Algorithms to compute all complex and real roots of a quartic polynomial›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Quartic_Polynomials
  <span class="keyword2"><span class="keyword">imports</span></span> 
    <a href="#Ferraris_Formula">Ferraris_Formula</a>
    <a href="#Cubic_Polynomials">Cubic_Polynomials</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The complex case is straight-forward›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">solve_depressed_quartic_complex</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex <span class="main">⇒</span> complex <span class="main">⇒</span> complex <span class="main">⇒</span> complex list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">solve_depressed_quartic_complex</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">=</span> remdups <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> 
     <span class="main">(</span>concat <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span> <span class="bound">z</span><span class="main">.</span> <span class="keyword1">let</span> <span class="bound">y</span> <span class="main">=</span> csqrt <span class="bound">z</span> <span class="keyword1">in</span> <span class="main">[</span><span class="bound">y</span><span class="main">,</span><span class="main">-</span><span class="bound">y</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span>croots2 <span class="main">[:</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span><span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span>
     <span class="keyword1">let</span> <span class="bound">cubics</span> <span class="main">=</span> croots3 <span class="main">[:</span> <span class="main">-</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="numeral">8</span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">,</span> <span class="numeral">8</span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span> <span class="numeral">8</span><span class="main">:]</span><span class="main">;</span>
         <span class="bound">m</span> <span class="main">=</span> hd <span class="bound">cubics</span><span class="main">;</span> <span class="comment1">― ‹select any root of the cubic polynomial›</span>
         <span class="bound">a</span> <span class="main">=</span> csqrt <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">m</span><span class="main">)</span><span class="main">;</span>
         <span class="bound">p2m</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span> <span class="bound">m</span><span class="main">;</span>
         <span class="bound">q2a</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">a</span><span class="main">)</span><span class="main">;</span>
         <span class="bound">b1</span> <span class="main">=</span> <span class="bound">p2m</span> <span class="main">-</span> <span class="bound">q2a</span><span class="main">;</span>
         <span class="bound">b2</span> <span class="main">=</span> <span class="bound">p2m</span> <span class="main">+</span> <span class="bound">q2a</span>
       <span class="keyword1">in</span> <span class="main">(</span>croots2 <span class="main">[:</span><span class="bound">b1</span><span class="main">,</span><span class="bound">a</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="main">@</span> croots2 <span class="main">[:</span><span class="bound">b2</span><span class="main">,</span><span class="main">-</span><span class="bound">a</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span>"</span></span> 

<span class="keyword1" id="Quartic_Polynomials-solve_depressed_quartic_complex"><span class="command">lemma</span></span> solve_depressed_quartic_complex<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set <span class="main">(</span>solve_depressed_quartic_complex <span class="free">p</span> <span class="free">q</span> <span class="free">r</span><span class="main">)</span> 
  <span class="main">⟷</span> <span class="main">(</span><span class="free">x</span><span class="main">^</span><span class="numeral">4</span> <span class="main">+</span> <span class="free">p</span> <span class="main">*</span> <span class="free">x</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">q</span> <span class="main">*</span> <span class="free">x</span> <span class="main">+</span> <span class="free">r</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">note</span></span> powers <span class="main">=</span> <span class="dynamic"><span class="dynamic">field_simps</span></span> power4_eq_xxxx power3_eq_cube power2_eq_square
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> csqrt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> <span class="free">x</span><span class="main">^</span><span class="numeral">2</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">x</span> <span class="main">=</span> csqrt <span class="skolem">z</span> <span class="main">∨</span> <span class="free">x</span> <span class="main">=</span> <span class="main">-</span> csqrt <span class="skolem">z</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">z</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> power2_csqrt power2_eq_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">^</span> <span class="numeral">4</span> <span class="main">+</span> <span class="free">p</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="free">q</span> <span class="main">*</span> <span class="free">x</span> <span class="main">+</span> <span class="free">r</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">x</span> <span class="main">^</span> <span class="numeral">4</span> <span class="main">+</span> <span class="free">p</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="free">r</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="free">p</span> <span class="main">*</span> <span class="bound">z</span> <span class="main">+</span> <span class="free">r</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> biquadratic_solution <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">z</span><span class="main">.</span> poly <span class="main">[:</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="bound">z</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">=</span> <span class="free">x</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powers<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">z</span> <span class="main">∈</span> set <span class="main">(</span>croots2 <span class="main">[:</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">.</span> <span class="bound">z</span> <span class="main">=</span> <span class="free">x</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> croots2<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">z</span> <span class="main">∈</span> set <span class="main">(</span>croots2 <span class="main">[:</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">.</span> <span class="free">x</span> <span class="main">=</span> csqrt <span class="bound">z</span> <span class="main">∨</span> <span class="free">x</span> <span class="main">=</span> <span class="main">-</span> csqrt <span class="bound">z</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> csqrt <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">x</span> <span class="main">∈</span> set <span class="main">(</span>solve_depressed_quartic_complex <span class="free">p</span> <span class="free">q</span> <span class="free">r</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> solve_depressed_quartic_complex_def id <span class="keyword1"><span class="command">unfolding</span></span> True Let_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> q0<span class="main">:</span> False
    <span class="keyword1"><span class="command">hence</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> <span class="free">q</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="skolem">x</span> <span class="keyword1">else</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex list"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">note</span></span> powers <span class="main">=</span> <span class="dynamic"><span class="dynamic">field_simps</span></span> power4_eq_xxxx power3_eq_cube power2_eq_square
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?poly</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="main">-</span> <span class="free">q</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">,</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">p</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="numeral">8</span> <span class="main">*</span> <span class="free">r</span><span class="main">,</span> <span class="numeral">8</span> <span class="main">*</span> <span class="free">p</span><span class="main">,</span> <span class="numeral">8</span><span class="main">:]</span>"</span></span> 
    <span class="keyword1"><span class="command">from</span></span> croots3<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?poly</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> croots<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>croots3 <span class="var">?poly</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="var">?poly</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> fundamental_theorem_of_algebra_alt<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?poly</span></span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="var">?poly</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> croots <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"croots3 <span class="var">?poly</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="skolem"><span class="skolem">rest</span></span> <span class="keyword2"><span class="keyword">where</span></span> rts<span class="main">:</span> <span class="quoted"><span class="quoted">"croots3 <span class="var">?poly</span> <span class="main">=</span> <span class="skolem">m</span> <span class="main">#</span> <span class="skolem">rest</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"croots3 <span class="var">?poly</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> hd<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span>croots3 <span class="var">?poly</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> croots<span class="main">[</span><span class="operator">unfolded</span> rts<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="var">?poly</span> <span class="skolem">m</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> mrt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">8</span><span class="main">*</span><span class="skolem">m</span><span class="main">^</span><span class="numeral">3</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">8</span> <span class="main">*</span> <span class="free">p</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">m</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">p</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="numeral">8</span> <span class="main">*</span> <span class="free">r</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">m</span> <span class="main">-</span> <span class="free">q</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> m0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> q0
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> powers<span class="main">)</span>  
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">b1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b1</span> <span class="main">=</span> <span class="free">p</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span> <span class="skolem">m</span> <span class="main">-</span> <span class="free">q</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> csqrt <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">b2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b2</span> <span class="main">=</span> <span class="free">p</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span> <span class="skolem">m</span> <span class="main">+</span> <span class="free">q</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> csqrt <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">have</span></span> csqrt<span class="main">:</span> <span class="quoted"><span class="quoted">"csqrt <span class="skolem">x</span> <span class="main">*</span> csqrt <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> power2_csqrt power2_eq_square<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> solve_depressed_quartic_complex_def id Let_def set_remdups set_append hd
      <span class="keyword1"><span class="command">unfolding</span></span> b1_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> b2_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> depressed_quartic_Ferrari<span class="main"><span class="main">[</span></span><span class="operator">OF</span> mrt q0 csqrt b1_def b2_def<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>1 2<span class="main"><span class="main">)</span></span> croots2<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The main difference in the real case is that a specific cubic root has to be used, namely
  a positive one. In the soundness proof we show that such a cubic root always exists.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">solve_depressed_quartic_real</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real <span class="main">⇒</span> real <span class="main">⇒</span> real list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">solve_depressed_quartic_real</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">=</span> remdups <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> 
     <span class="main">(</span>concat <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span> <span class="bound">z</span><span class="main">.</span> rroots2 <span class="main">[:</span><span class="main">-</span><span class="bound">z</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span><span class="main">)</span> <span class="main">(</span>rroots2 <span class="main">[:</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span><span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span>
     <span class="keyword1">let</span> <span class="bound">cubics</span> <span class="main">=</span> rroots3 <span class="main">[:</span> <span class="main">-</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="numeral">8</span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">,</span> <span class="numeral">8</span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span> <span class="numeral">8</span><span class="main">:]</span><span class="main">;</span>
         <span class="bound">m</span> <span class="main">=</span> the <span class="main">(</span>find <span class="main">(</span><span class="main">λ</span> <span class="bound">m</span><span class="main">.</span> <span class="bound">m</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> <span class="bound">cubics</span><span class="main">)</span><span class="main">;</span>  <span class="comment1">― ‹select any positive root of the cubic polynomial›</span>
         <span class="bound">a</span> <span class="main">=</span> sqrt <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">m</span><span class="main">)</span><span class="main">;</span> 
         <span class="bound">p2m</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span> <span class="bound">m</span><span class="main">;</span>
         <span class="bound">q2a</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="bound">a</span><span class="main">)</span><span class="main">;</span>
         <span class="bound">b1</span> <span class="main">=</span> <span class="bound">p2m</span> <span class="main">-</span> <span class="bound">q2a</span><span class="main">;</span>
         <span class="bound">b2</span> <span class="main">=</span> <span class="bound">p2m</span> <span class="main">+</span> <span class="bound">q2a</span>
       <span class="keyword1">in</span> <span class="main">(</span>rroots2 <span class="main">[:</span><span class="bound">b1</span><span class="main">,</span><span class="bound">a</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="main">@</span> rroots2 <span class="main">[:</span><span class="bound">b2</span><span class="main">,</span><span class="main">-</span><span class="bound">a</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span>"</span></span> 

<span class="keyword1" id="Quartic_Polynomials-solve_depressed_quartic_real"><span class="command">lemma</span></span> solve_depressed_quartic_real<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set <span class="main">(</span>solve_depressed_quartic_real <span class="free">p</span> <span class="free">q</span> <span class="free">r</span><span class="main">)</span> 
  <span class="main">⟷</span> <span class="main">(</span><span class="free">x</span><span class="main">^</span><span class="numeral">4</span> <span class="main">+</span> <span class="free">p</span> <span class="main">*</span> <span class="free">x</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="free">q</span> <span class="main">*</span> <span class="free">x</span> <span class="main">+</span> <span class="free">r</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">note</span></span> powers <span class="main">=</span> <span class="dynamic"><span class="dynamic">field_simps</span></span> power4_eq_xxxx power3_eq_cube power2_eq_square
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> sqrt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> <span class="free">x</span><span class="main">^</span><span class="numeral">2</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">x</span> <span class="main">∈</span> set <span class="main">(</span>rroots2 <span class="main">[:</span><span class="main">-</span><span class="skolem">z</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">z</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> rroots2<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> powers<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">^</span> <span class="numeral">4</span> <span class="main">+</span> <span class="free">p</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="free">q</span> <span class="main">*</span> <span class="free">x</span> <span class="main">+</span> <span class="free">r</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">x</span> <span class="main">^</span> <span class="numeral">4</span> <span class="main">+</span> <span class="free">p</span> <span class="main">*</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="free">r</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="free">p</span> <span class="main">*</span> <span class="bound">z</span> <span class="main">+</span> <span class="free">r</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> biquadratic_solution <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">z</span><span class="main">.</span> poly <span class="main">[:</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span> <span class="bound">z</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">=</span> <span class="free">x</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powers<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">z</span> <span class="main">∈</span> set <span class="main">(</span>rroots2 <span class="main">[:</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">.</span> <span class="bound">z</span> <span class="main">=</span> <span class="free">x</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> rroots2<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">z</span> <span class="main">∈</span> set <span class="main">(</span>rroots2 <span class="main">[:</span><span class="free">r</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">.</span> <span class="free">x</span> <span class="main">∈</span> set <span class="main">(</span>rroots2 <span class="main">[:</span><span class="main">-</span><span class="bound">z</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">:]</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> sqrt <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">x</span> <span class="main">∈</span> set <span class="main">(</span>solve_depressed_quartic_real <span class="free">p</span> <span class="free">q</span> <span class="free">r</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> solve_depressed_quartic_real_def id <span class="keyword1"><span class="command">unfolding</span></span> True Let_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> q0<span class="main">:</span> False
    <span class="keyword1"><span class="command">hence</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> <span class="free">q</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="skolem">x</span> <span class="keyword1">else</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real list"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">note</span></span> powers <span class="main">=</span> <span class="dynamic"><span class="dynamic">field_simps</span></span> power4_eq_xxxx power3_eq_cube power2_eq_square
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?poly</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">[:</span><span class="main">-</span> <span class="free">q</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">,</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">p</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="numeral">8</span> <span class="main">*</span> <span class="free">r</span><span class="main">,</span> <span class="numeral">8</span> <span class="main">*</span> <span class="free">p</span><span class="main">,</span> <span class="numeral">8</span><span class="main">:]</span>"</span></span> 
    
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">cubics</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cubics</span> <span class="main">=</span> rroots3 <span class="var">?poly</span>"</span></span> 
    <span class="keyword1"><span class="command">from</span></span> rroots3<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?poly</span></span></span><span class="main">,</span> <span class="operator">folded</span> cubics_def<span class="main">]</span> 
    <span class="keyword1"><span class="command">have</span></span> rroots<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">cubics</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="var">?poly</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> odd_degree_imp_real_root<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?poly</span></span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="var">?poly</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> rroots <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cubics</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">m</span><span class="main">.</span> <span class="bound">m</span> <span class="main">∈</span> set <span class="skolem">cubics</span> <span class="main">∧</span> <span class="bound">m</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?thesis</span>"</span></span> 
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">unfolded</span> rroots<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> rt<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="var">?poly</span> <span class="skolem">m</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="skolem">m</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">m</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="var">?poly</span> <span class="main">0</span> <span class="main">=</span> <span class="main">-</span> <span class="main">(</span><span class="free">q</span><span class="main">^</span><span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> q0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> lt<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="var">?poly</span> <span class="main">0</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> poly_pinfty_gt_lc<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?poly</span></span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n0</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">≥</span> <span class="skolem">n0</span> <span class="main">⟹</span> <span class="numeral">8</span> <span class="main">≤</span> poly <span class="var">?poly</span> <span class="bound">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"max <span class="skolem">n0</span> <span class="main">0</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="var">?poly</span> <span class="main">(</span>max <span class="skolem">n0</span> <span class="main">0</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> IVT<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"poly <span class="var">?poly</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> lt this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> poly<span class="main">:</span> <span class="quoted"><span class="quoted">"poly <span class="var">?poly</span> <span class="skolem">m</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> rt<span class="main">[</span><span class="operator">OF</span> this<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> this<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> poly q0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"find <span class="main">(</span><span class="main">λ</span> <span class="bound">m</span><span class="main">.</span> <span class="bound">m</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> <span class="skolem">cubics</span> <span class="main">≠</span> None"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> find_None_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> find<span class="main">:</span> <span class="quoted"><span class="quoted">"find <span class="main">(</span><span class="main">λ</span> <span class="bound">m</span><span class="main">.</span> <span class="bound">m</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> <span class="skolem">cubics</span> <span class="main">=</span> Some <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> find_Some_D<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> set <span class="skolem">cubics</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> m_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> rroots <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="var">?poly</span> <span class="skolem">m</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> mrt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">8</span><span class="main">*</span><span class="skolem">m</span><span class="main">^</span><span class="numeral">3</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">8</span> <span class="main">*</span> <span class="free">p</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">m</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">p</span><span class="main">^</span><span class="numeral">2</span> <span class="main">-</span> <span class="numeral">8</span> <span class="main">*</span> <span class="free">r</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">m</span> <span class="main">-</span> <span class="free">q</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> powers<span class="main">)</span>  
    <span class="keyword1"><span class="command">from</span></span> m_0 <span class="keyword1"><span class="command">have</span></span> sqrt<span class="main">:</span> <span class="quoted"><span class="quoted">"sqrt <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">*</span> sqrt <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">b1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b1</span> <span class="main">=</span> <span class="free">p</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span> <span class="skolem">m</span> <span class="main">-</span> <span class="free">q</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> sqrt <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">b2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b2</span> <span class="main">=</span> <span class="free">p</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span> <span class="skolem">m</span> <span class="main">+</span> <span class="free">q</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> sqrt <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> solve_depressed_quartic_real_def id Let_def set_remdups set_append 
        cubics_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> find option.sel
      <span class="keyword1"><span class="command">unfolding</span></span> b1_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> b2_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> depressed_quartic_Ferrari<span class="main"><span class="main">[</span></span><span class="operator">OF</span> mrt q0 sqrt b1_def b2_def<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>1 2<span class="main"><span class="main">)</span></span> rroots2<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Combining the various algorithms›</span></span>

<span class="keyword1" id="Quartic_Polynomials-numeral_4_eq_4"><span class="command">lemma</span></span> numeral_4_eq_4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">4</span> <span class="main">=</span> Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval_nat_numeral<span class="main">)</span>

<span class="keyword1" id="Quartic_Polynomials-degree4_coeffs"><span class="command">lemma</span></span> degree4_coeffs<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">=</span> <span class="numeral">4</span> <span class="main">⟹</span>
  <span class="main">∃</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span> <span class="bound">e</span><span class="main">.</span> <span class="free">p</span> <span class="main">=</span> <span class="main">[:</span> <span class="bound">e</span><span class="main">,</span> <span class="bound">d</span><span class="main">,</span> <span class="bound">c</span><span class="main">,</span> <span class="bound">b</span><span class="main">,</span> <span class="bound">a</span> <span class="main">:]</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> degree3_coeffs degree_pCons_eq_if nat.inject numeral_3_eq_3 numeral_4_eq_4 pCons_cases zero_neq_numeral
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">roots4_generic</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">::</span> field_char_0 <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> list<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> poly <span class="main">⇒</span> <span class="tfree">'a</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">roots4_generic</span> <span class="free"><span class="bound"><span class="entity">depressed_solver</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> 
     <span class="bound">cs</span> <span class="main">=</span> coeffs <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">;</span> 
     <span class="bound">cs</span> <span class="main">=</span> coeffs <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">;</span> 
     <span class="bound">a4</span> <span class="main">=</span> <span class="bound">cs</span> <span class="main">!</span> <span class="numeral">4</span><span class="main">;</span> <span class="bound">a3</span> <span class="main">=</span> <span class="bound">cs</span> <span class="main">!</span> <span class="numeral">3</span><span class="main">;</span> <span class="bound">a2</span> <span class="main">=</span> <span class="bound">cs</span> <span class="main">!</span> <span class="numeral">2</span><span class="main">;</span> <span class="bound">a1</span> <span class="main">=</span> <span class="bound">cs</span> <span class="main">!</span> <span class="main">1</span><span class="main">;</span> <span class="bound">a0</span> <span class="main">=</span> <span class="bound">cs</span> <span class="main">!</span> <span class="main">0</span><span class="main">;</span>
     <span class="bound">b</span> <span class="main">=</span> <span class="bound">a3</span> <span class="main">/</span> <span class="bound">a4</span><span class="main">;</span>
     <span class="bound">c</span> <span class="main">=</span> <span class="bound">a2</span> <span class="main">/</span> <span class="bound">a4</span><span class="main">;</span>
     <span class="bound">d</span> <span class="main">=</span> <span class="bound">a1</span> <span class="main">/</span> <span class="bound">a4</span><span class="main">;</span>
     <span class="bound">e</span> <span class="main">=</span> <span class="bound">a0</span> <span class="main">/</span> <span class="bound">a4</span><span class="main">;</span>
     <span class="bound">b2</span> <span class="main">=</span> <span class="bound">b</span> <span class="main">*</span> <span class="bound">b</span><span class="main">;</span>
     <span class="bound">b3</span> <span class="main">=</span> <span class="bound">b2</span> <span class="main">*</span> <span class="bound">b</span><span class="main">;</span>
     <span class="bound">b4</span> <span class="main">=</span> <span class="bound">b3</span> <span class="main">*</span> <span class="bound">b</span><span class="main">;</span>
     <span class="bound">b4'</span> <span class="main">=</span> <span class="bound">b</span> <span class="main">/</span> <span class="numeral">4</span><span class="main">;</span>
     <span class="bound">p</span> <span class="main">=</span> <span class="bound">c</span> <span class="main">-</span> <span class="numeral">3</span><span class="main">/</span><span class="numeral">8</span> <span class="main">*</span> <span class="bound">b2</span><span class="main">;</span>
     <span class="bound">q</span> <span class="main">=</span> <span class="main">(</span><span class="bound">b3</span> <span class="main">-</span> <span class="numeral">4</span><span class="main">*</span><span class="bound">b</span><span class="main">*</span><span class="bound">c</span> <span class="main">+</span> <span class="numeral">8</span> <span class="main">*</span> <span class="bound">d</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">8</span><span class="main">;</span>
     <span class="bound">r</span> <span class="main">=</span> <span class="main">(</span> <span class="main">-</span><span class="numeral">3</span> <span class="main">*</span> <span class="bound">b4</span> <span class="main">+</span> <span class="numeral">256</span> <span class="main">*</span> <span class="bound">e</span> <span class="main">-</span> <span class="numeral">64</span> <span class="main">*</span> <span class="bound">b</span> <span class="main">*</span> <span class="bound">d</span> <span class="main">+</span> <span class="numeral">16</span> <span class="main">*</span> <span class="bound">b2</span> <span class="main">*</span> <span class="bound">c</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">256</span><span class="main">;</span>
     <span class="bound">roots</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">depressed_solver</span></span></span> <span class="bound">p</span> <span class="bound">q</span> <span class="bound">r</span>
     <span class="keyword1">in</span> map <span class="main">(</span><span class="main">λ</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">-</span> <span class="bound">b4'</span><span class="main">)</span> <span class="bound">roots</span><span class="main">)</span>"</span></span> 

<span class="keyword1" id="Quartic_Polynomials-roots4_generic"><span class="command">lemma</span></span> roots4_generic<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> deg<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">=</span> <span class="numeral">4</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> solver<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">p</span> <span class="bound">q</span> <span class="bound">r</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">depressed_solver</span> <span class="bound">p</span> <span class="bound">q</span> <span class="bound">r</span><span class="main">)</span> <span class="main">⟷</span> <span class="bound">y</span><span class="main">^</span><span class="numeral">4</span> <span class="main">+</span> <span class="bound">p</span> <span class="main">*</span> <span class="bound">y</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="bound">q</span> <span class="main">*</span> <span class="bound">y</span> <span class="main">+</span> <span class="bound">r</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>roots4_generic <span class="free">depressed_solver</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">note</span></span> powers <span class="main">=</span> <span class="dynamic"><span class="dynamic">field_simps</span></span> power4_eq_xxxx power3_eq_cube power2_eq_square
  <span class="keyword1"><span class="command">from</span></span> degree4_coeffs<span class="main">[</span><span class="operator">OF</span> deg<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a4</span></span> <span class="skolem"><span class="skolem">a3</span></span> <span class="skolem"><span class="skolem">a2</span></span> <span class="skolem"><span class="skolem">a1</span></span> <span class="skolem"><span class="skolem">a0</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">[:</span><span class="skolem">a0</span><span class="main">,</span><span class="skolem">a1</span><span class="main">,</span><span class="skolem">a2</span><span class="main">,</span><span class="skolem">a3</span><span class="main">,</span><span class="skolem">a4</span><span class="main">:]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a4</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> coeffs<span class="main">:</span> <span class="quoted"><span class="quoted">"coeffs <span class="free">p</span> <span class="main">!</span> <span class="numeral">4</span> <span class="main">=</span> <span class="skolem">a4</span>"</span></span> <span class="quoted"><span class="quoted">"coeffs <span class="free">p</span> <span class="main">!</span> <span class="numeral">3</span> <span class="main">=</span> <span class="skolem">a3</span>"</span></span> <span class="quoted"><span class="quoted">"coeffs <span class="free">p</span> <span class="main">!</span> <span class="numeral">2</span> <span class="main">=</span> <span class="skolem">a2</span>"</span></span> <span class="quoted"><span class="quoted">"coeffs <span class="free">p</span> <span class="main">!</span> <span class="main">1</span> <span class="main">=</span> <span class="skolem">a1</span>"</span></span> <span class="quoted"><span class="quoted">"coeffs <span class="free">p</span> <span class="main">!</span> <span class="main">0</span> <span class="main">=</span> <span class="skolem">a0</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> p <span class="keyword1"><span class="command">using</span></span> a4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> <span class="skolem">a3</span> <span class="main">/</span> <span class="skolem">a4</span>"</span></span> 
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> <span class="skolem">a2</span> <span class="main">/</span> <span class="skolem">a4</span>"</span></span> 
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> <span class="skolem">a1</span> <span class="main">/</span> <span class="skolem">a4</span>"</span></span> 
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">=</span> <span class="skolem">a0</span> <span class="main">/</span> <span class="skolem">a4</span>"</span></span> 
  <span class="keyword1"><span class="command">note</span></span> def <span class="main">=</span> roots4_generic_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">depressed_solver</span></span> <span class="quoted"><span class="free">p</span></span><span class="main">,</span> <span class="operator">unfolded</span> Let_def coeffs<span class="main">,</span> <span class="operator">folded</span> b_def c_def d_def e_def<span class="main">,</span>
      <span class="operator">folded</span> power4_eq_xxxx<span class="main">,</span> <span class="operator">folded</span> power3_eq_cube<span class="main">,</span> <span class="operator">folded</span> power2_eq_square<span class="main">]</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="free">p</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">b</span> <span class="main">/</span> <span class="numeral">4</span>"</span></span> 
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="skolem">c</span> <span class="main">-</span> <span class="main">(</span><span class="numeral">3</span><span class="main">/</span><span class="numeral">8</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">^</span><span class="numeral">2</span>"</span></span> 
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">b</span><span class="main">^</span><span class="numeral">3</span> <span class="main">-</span> <span class="numeral">4</span><span class="main">*</span><span class="skolem">b</span><span class="main">*</span><span class="skolem">c</span> <span class="main">+</span> <span class="numeral">8</span> <span class="main">*</span> <span class="skolem">d</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">8</span>"</span></span> 
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> <span class="main">(</span> <span class="main">-</span><span class="numeral">3</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">^</span><span class="numeral">4</span> <span class="main">+</span> <span class="numeral">256</span> <span class="main">*</span> <span class="skolem">e</span> <span class="main">-</span> <span class="numeral">64</span> <span class="main">*</span> <span class="skolem">b</span> <span class="main">*</span> <span class="skolem">d</span> <span class="main">+</span> <span class="numeral">16</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">^</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">256</span>"</span></span> 
    <span class="keyword1"><span class="command">note</span></span> def <span class="main">=</span> def<span class="main">[</span><span class="operator">folded</span> p_def q_def r_def<span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">-</span> <span class="skolem">b</span> <span class="main">/</span> <span class="numeral">4</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> y_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="var">?p</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="skolem">a4</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">^</span><span class="numeral">4</span> <span class="main">+</span> <span class="skolem">a3</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">^</span><span class="numeral">3</span> <span class="main">+</span> <span class="skolem">a2</span> <span class="main">*</span> <span class="skolem">x</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> <span class="skolem">a1</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">a0</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powers<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">^</span> <span class="numeral">4</span> <span class="main">+</span> <span class="skolem">p</span> <span class="main">*</span> <span class="skolem">y</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="skolem">q</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">+</span> <span class="skolem">r</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> to_depressed_quartic<span class="main">[</span><span class="operator">OF</span> a4 b_def c_def d_def e_def p_def q_def r_def xy<span class="main">]</span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="skolem">y</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">depressed_solver</span> <span class="skolem">p</span> <span class="skolem">q</span> <span class="skolem">r</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> solver <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="skolem">x</span> <span class="main">∈</span> set <span class="main">(</span>roots4_generic <span class="free">depressed_solver</span> <span class="var">?p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> xy def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poly <span class="var">?p</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="skolem">x</span> <span class="main">∈</span> set <span class="main">(</span>roots4_generic <span class="free">depressed_solver</span> <span class="var">?p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">croots4</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex poly <span class="main">⇒</span> complex list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">croots4</span> <span class="main">=</span> roots4_generic solve_depressed_quartic_complex"</span></span>

<span class="keyword1" id="Quartic_Polynomials-croots4"><span class="command">lemma</span></span> croots4<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> deg<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">=</span> <span class="numeral">4</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>croots4 <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span> <span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> croots4_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> roots4_generic<span class="main"><span class="main">[</span></span><span class="operator">OF</span> deg solve_depressed_quartic_complex<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rroots4</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real poly <span class="main">⇒</span> real list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">rroots4</span> <span class="main">=</span> roots4_generic solve_depressed_quartic_real"</span></span>

<span class="keyword1" id="Quartic_Polynomials-rroots4"><span class="command">lemma</span></span> rroots4<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> deg<span class="main">:</span> <span class="quoted"><span class="quoted">"degree <span class="free">p</span> <span class="main">=</span> <span class="numeral">4</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>rroots4 <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span> <span class="bound">x</span><span class="main">.</span> poly <span class="free">p</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> rroots4_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> roots4_generic<span class="main"><span class="main">[</span></span><span class="operator">OF</span> deg solve_depressed_quartic_real<span class="main"><span class="main">]</span></span><span class="main">)</span>


<span class="keyword2"><span class="keyword">end</span></span></pre>
</div>