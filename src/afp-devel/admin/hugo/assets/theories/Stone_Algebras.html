<div id="Lattice_Basics">
<div class="head">
<h1>Theory Lattice_Basics</h1>
</div>
<pre class="source"><span class="comment1">(* Title:      Lattice Basics
   Author:     Walter Guttmann
   Maintainer: Walter Guttmann &lt;walter.guttmann at canterbury.ac.nz&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Lattice Basics›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
This theory provides notations, basic definitions and facts of lattice-related structures used throughout the subsequent development.
›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Lattice_Basics

<span class="keyword2"><span class="keyword">imports</span></span> <a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Main.html">Main</a>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹General Facts and Notations›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following results extend basic Isabelle/HOL facts.
›</span></span>

<span class="keyword1" id="Lattice_Basics-imp_as_conj"><span class="command">lemma</span></span> imp_as_conj<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">Q</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">x</span> <span class="main">∧</span> <span class="free">Q</span> <span class="free">x</span> <span class="main">⟷</span> <span class="free">P</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Lattice_Basics-if_distrib_2"><span class="command">lemma</span></span> if_distrib_2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">c</span> <span class="keyword1">then</span> <span class="free">x</span> <span class="keyword1">else</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">c</span> <span class="keyword1">then</span> <span class="free">z</span> <span class="keyword1">else</span> <span class="free">w</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">c</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="free">x</span> <span class="free">z</span> <span class="keyword1">else</span> <span class="free">f</span> <span class="free">y</span> <span class="free">w</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Lattice_Basics-left_invertible_inj"><span class="command">lemma</span></span> left_invertible_inj<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">.</span> <span class="free">g</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span> inj <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> injI<span class="main">)</span>

<span class="keyword1" id="Lattice_Basics-invertible_bij"><span class="command">lemma</span></span> invertible_bij<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">.</span> <span class="free">g</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="bound">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span> <span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="bound">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"bij <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms bijI'<span class="main">)</span>

<span class="keyword1" id="Lattice_Basics-finite_ne_subset_induct"><span class="command">lemma</span></span> finite_ne_subset_induct <span class="main">[</span><span class="operator">consumes</span> 3<span class="main">,</span> <span class="operator">case_names</span> singleton insert<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">F</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="free">S</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> singleton<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="main">.</span> <span class="free">P</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> insert<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">F</span> <span class="main">.</span> finite <span class="bound">F</span> <span class="main">⟹</span> <span class="bound">F</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="bound">F</span> <span class="main">⊆</span> <span class="free">S</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">∉</span> <span class="bound">F</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">F</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span>insert <span class="bound">x</span> <span class="bound">F</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1-3<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finite_ne_induct<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> singleton<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insert<span class="main">)</span>

<span class="keyword1" id="Lattice_Basics-finite_set_of_finite_funs_pred"><span class="command">lemma</span></span> finite_set_of_finite_funs_pred<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span> <span class="bound">x</span><span class="main">::</span><span class="tfree">'a</span> <span class="main">.</span> True <span class="main">}</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span> <span class="bound">y</span><span class="main">::</span><span class="tfree">'b</span> <span class="main">.</span> <span class="free">P</span> <span class="bound">y</span> <span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span> <span class="bound">f</span> <span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">::</span><span class="tfree">'a</span> <span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms finite_set_of_finite_funs <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We use the following notations for the join, meet and complement operations.
Changing the precedence of the unary complement allows us to write terms like <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>--x›</span></span></span></span> instead of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>-(-x)›</span></span></span></span>.
›</span></span>

<span class="keyword1"><span class="command">context</span></span> sup
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">notation</span></span> sup <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⊔</span>"</span> 65<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">additive</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">additive</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span> <span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span><span class="bound">x</span> <span class="main">⊔</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">x</span> <span class="main">⊔</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">y</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> inf
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">notation</span></span> inf <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⊓</span>"</span> 67<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> uminus
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">no_notation</span></span> uminus <span class="main">(</span><span class="quoted">"<span class="keyword1">-</span> _"</span> <span class="main">[</span>81<span class="main">]</span> 80<span class="main">)</span>

<span class="keyword1"><span class="command">notation</span></span> uminus <span class="main">(</span><span class="quoted">"<span class="keyword1">-</span> _"</span> <span class="main">[</span>80<span class="main">]</span> 80<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Orders›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We use the following definition of monotonicity for operations defined in classes.
The standard <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>mono›</span></span></span></span> places a sort constraint on the target type.
We also give basic properties of Galois connections and lift orders to functions.
›</span></span>

<span class="keyword1"><span class="command">context</span></span> ord
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">isotone</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">isotone</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">x</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">y</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">galois</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">galois</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span> <span class="main">.</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">⟷</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="bound">y</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">lifted_less_eq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword1">≤≤</span> _<span class="keyword3">)</span>"</span> <span class="main">[</span>51<span class="main">,</span> 51<span class="main">]</span> 50<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main"><span class="free">≤≤</span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">x</span> <span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">x</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">x</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> order
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Lattice_Basics-order_lesseq_imp"><span class="command">lemma</span></span> order_lesseq_imp<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">z</span> <span class="main">.</span> <span class="free">x</span> <span class="main">≤</span> <span class="bound">z</span> <span class="main">⟶</span> <span class="free">y</span> <span class="main">≤</span> <span class="bound">z</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> order_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Lattice_Basics-galois_char"><span class="command">lemma</span></span> galois_char<span class="main">:</span>
  <span class="quoted"><span class="quoted">"galois <span class="free">l</span> <span class="free">u</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">u</span> <span class="main">(</span><span class="free">l</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">.</span> <span class="free">l</span> <span class="main">(</span><span class="free">u</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> isotone <span class="free">l</span> <span class="main">∧</span> isotone <span class="free">u</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> galois_def isotone_def order_refl order_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> galois_def isotone_def order_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Lattice_Basics-galois_closure"><span class="command">lemma</span></span> galois_closure<span class="main">:</span>
  <span class="quoted"><span class="quoted">"galois <span class="free">l</span> <span class="free">u</span> <span class="main">⟹</span> <span class="free">l</span> <span class="free">x</span> <span class="main">=</span> <span class="free">l</span> <span class="main">(</span><span class="free">u</span> <span class="main">(</span><span class="free">l</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="free">u</span> <span class="free">x</span> <span class="main">=</span> <span class="free">u</span> <span class="main">(</span><span class="free">l</span> <span class="main">(</span><span class="free">u</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> galois_char isotone_def order.antisym<span class="main">)</span>

<span class="keyword1" id="Lattice_Basics-lifted_reflexive"><span class="command">lemma</span></span> lifted_reflexive<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> <span class="free">g</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">≤≤</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lifted_less_eq_def<span class="main">)</span>

<span class="keyword1" id="Lattice_Basics-lifted_transitive"><span class="command">lemma</span></span> lifted_transitive<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">≤≤</span> <span class="free">g</span> <span class="main">⟹</span> <span class="free">g</span> <span class="main">≤≤</span> <span class="free">h</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">≤≤</span> <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> lifted_less_eq_def order_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Lattice_Basics-lifted_antisymmetric"><span class="command">lemma</span></span> lifted_antisymmetric<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">≤≤</span> <span class="free">g</span> <span class="main">⟹</span> <span class="free">g</span> <span class="main">≤≤</span> <span class="free">f</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">=</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> order.antisym<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lifted_less_eq_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
If the image of a finite non-empty set under <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>f›</span></span></span></span> is a totally ordered, there is an element that minimises the value of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>f›</span></span></span></span>.
›</span></span>

<span class="keyword1" id="Lattice_Basics-finite_set_minimal"><span class="command">lemma</span></span> finite_set_minimal<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">s</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">s</span> <span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="free">s</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">∨</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">≤</span> <span class="free">f</span> <span class="bound">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span><span class="main">∈</span><span class="free">s</span> <span class="main">.</span> <span class="main">∀</span><span class="bound">z</span><span class="main">∈</span><span class="free">s</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">m</span> <span class="main">≤</span> <span class="free">f</span> <span class="bound">z</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> finite_ne_subset_induct<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> S<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free"><span class="quoted"><span class="free">s</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> insert_iff order_trans subsetD<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Semilattices›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following are basic facts in semilattices.
›</span></span>

<span class="keyword1"><span class="command">context</span></span> semilattice_sup
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Lattice_Basics-sup_left_isotone"><span class="command">lemma</span></span> sup_left_isotone<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">⊔</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⊔</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> sup.mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Lattice_Basics-sup_right_isotone"><span class="command">lemma</span></span> sup_right_isotone<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">z</span> <span class="main">⊔</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⊔</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> sup.mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Lattice_Basics-sup_left_divisibility"><span class="command">lemma</span></span> sup_left_divisibility<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">z</span> <span class="main">.</span> <span class="free">x</span> <span class="main">⊔</span> <span class="bound">z</span> <span class="main">=</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> sup.absorb2 sup.cobounded1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Lattice_Basics-sup_right_divisibility"><span class="command">lemma</span></span> sup_right_divisibility<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">z</span> <span class="main">.</span> <span class="bound">z</span> <span class="main">⊔</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sup.cobounded2 sup.orderE<span class="main">)</span>

<span class="keyword1" id="Lattice_Basics-sup_same_context"><span class="command">lemma</span></span> sup_same_context<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⊔</span> <span class="free">z</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⊔</span> <span class="free">z</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">⊔</span> <span class="free">z</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⊔</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_iff_sup sup_left_commute<span class="main">)</span>

<span class="keyword1" id="Lattice_Basics-sup_relative_same_increasing"><span class="command">lemma</span></span> sup_relative_same_increasing<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">⊔</span> <span class="free">z</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⊔</span> <span class="free">w</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">⊔</span> <span class="free">z</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⊔</span> <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> sup.assoc sup_right_divisibility <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Every bounded semilattice is a commutative monoid.
Finite sums defined in commutative monoids are available via the following sublocale.
›</span></span>

<span class="keyword1"><span class="command">context</span></span> bounded_semilattice_sup_bot
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> sup_monoid<span class="main">:</span> comm_monoid_add <span class="keyword2"><span class="keyword">where</span></span> plus <span class="main">=</span> <span class="quoted">sup</span> <span class="keyword2"><span class="keyword">and</span></span> zero <span class="main">=</span> <span class="quoted">bot</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> semilattice_inf
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Lattice_Basics-inf_same_context"><span class="command">lemma</span></span> inf_same_context<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⊓</span> <span class="free">z</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⊓</span> <span class="free">z</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">⊓</span> <span class="free">z</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⊓</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> order.antisym <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following class requires only the existence of upper bounds, which is a property common to bounded semilattices and (not necessarily bounded) lattices.
We use it in our development of filters.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> directed_semilattice_inf <span class="main">=</span> semilattice_inf <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ub<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">z</span> <span class="main">.</span> <span class="free">x</span> <span class="main">≤</span> <span class="bound">z</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">≤</span> <span class="bound">z</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We extend the <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>inf›</span></span></span></span> sublocale, which dualises the order in semilattices, to bounded semilattices.
›</span></span>

<span class="keyword1"><span class="command">context</span></span> bounded_semilattice_inf_top
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subclass</span></span> directed_semilattice_inf
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command">using</span></span> top_greatest <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">sublocale</span></span> inf<span class="main">:</span> bounded_semilattice_sup_bot <span class="keyword2"><span class="keyword">where</span></span> sup <span class="main">=</span> <span class="quoted">inf</span> <span class="keyword2"><span class="keyword">and</span></span> less_eq <span class="main">=</span> <span class="quoted">greater_eq</span> <span class="keyword2"><span class="keyword">and</span></span> less <span class="main">=</span> <span class="quoted">greater</span> <span class="keyword2"><span class="keyword">and</span></span> bot <span class="main">=</span> <span class="quoted">top</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_le_not_le<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Lattices›</span></span>

<span class="keyword1"><span class="command">context</span></span> lattice
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subclass</span></span> directed_semilattice_inf
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command">using</span></span> sup_ge1 sup_ge2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">dual_additive</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">dual_additive</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span> <span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span><span class="bound">x</span> <span class="main">⊔</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">x</span> <span class="main">⊓</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">y</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Not every bounded lattice has complements, but two elements might still be complements of each other as captured in the following definition.
In this situation we can apply, for example, the shunting property shown below.
We introduce most definitions using the <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>abbreviation›</span></span></span></span> command.
›</span></span>

<span class="keyword1"><span class="command">context</span></span> bounded_lattice
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">complement</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊔</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> top <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊓</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> bot"</span></span>

<span class="keyword1" id="Lattice_Basics-complement_symmetric"><span class="command">lemma</span></span> complement_symmetric<span class="main">:</span>
  <span class="quoted"><span class="quoted">"complement <span class="free">x</span> <span class="free">y</span> <span class="main">⟹</span> complement <span class="free">y</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf.commute sup.commute<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">conjugate</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">conjugate</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span> <span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">x</span> <span class="main">⊓</span> <span class="bound">y</span> <span class="main">=</span> bot <span class="main">⟷</span> <span class="bound">x</span> <span class="main">⊓</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">y</span> <span class="main">=</span> bot"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">class</span></span> dense_lattice <span class="main">=</span> bounded_lattice <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> bot_meet_irreducible<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">=</span> bot <span class="main">⟶</span> <span class="free">x</span> <span class="main">=</span> bot <span class="main">∨</span> <span class="free">y</span> <span class="main">=</span> bot"</span></span>

<span class="keyword1"><span class="command">context</span></span> distrib_lattice
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Lattice_Basics-relative_equality"><span class="command">lemma</span></span> relative_equality<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊔</span> <span class="free">z</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⊔</span> <span class="free">z</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">⊓</span> <span class="free">z</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⊓</span> <span class="free">z</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.commute inf_sup_absorb inf_sup_distrib2<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Distributive lattices with a greatest element are widely used in the construction theorem for Stone algebras.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> distrib_lattice_bot <span class="main">=</span> bounded_lattice_bot <span class="main">+</span> distrib_lattice

<span class="keyword1"><span class="command">class</span></span> distrib_lattice_top <span class="main">=</span> bounded_lattice_top <span class="main">+</span> distrib_lattice

<span class="keyword1"><span class="command">class</span></span> bounded_distrib_lattice <span class="main">=</span> bounded_lattice <span class="main">+</span> distrib_lattice
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subclass</span></span> distrib_lattice_bot <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">subclass</span></span> distrib_lattice_top <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1" id="Lattice_Basics-complement_shunting"><span class="command">lemma</span></span> complement_shunting<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"complement <span class="free">z</span> <span class="free">w</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">⊓</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">w</span> <span class="main">⊔</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">⊓</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">z</span> <span class="main">⊔</span> <span class="free">w</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊓</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 sup.commute sup.left_commute inf_sup_distrib2 sup_right_divisibility <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">w</span> <span class="main">⊔</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf.coboundedI1<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">w</span> <span class="main">⊔</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">w</span> <span class="main">⊔</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">⊓</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">w</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inf.sup_right_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">z</span> <span class="main">⊓</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms inf_sup_distrib1<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">⊓</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Linear Orders›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We next consider lattices with a linear order structure.
In such lattices, join and meet are selective operations, which give the maximum and the minimum of two elements, respectively.
Moreover, the lattice is automatically distributive.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> bounded_linorder <span class="main">=</span> linorder <span class="main">+</span> order_bot <span class="main">+</span> order_top

<span class="keyword1"><span class="command">class</span></span> linear_lattice <span class="main">=</span> lattice <span class="main">+</span> linorder
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Lattice_Basics-max_sup"><span class="command">lemma</span></span> max_sup<span class="main">:</span>
  <span class="quoted"><span class="quoted">"max <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> max.boundedI max.cobounded1 max.cobounded2 sup_unique<span class="main">)</span>

<span class="keyword1" id="Lattice_Basics-min_inf"><span class="command">lemma</span></span> min_inf<span class="main">:</span>
  <span class="quoted"><span class="quoted">"min <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf.absorb1 inf.absorb2 min_def<span class="main">)</span>

<span class="keyword1" id="Lattice_Basics-sup_inf_selective"><span class="command">lemma</span></span> sup_inf_selective<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">=</span> <span class="free">x</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">=</span> <span class="free">y</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">=</span> <span class="free">y</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">=</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> inf.absorb1 inf.absorb2 le_cases sup.absorb1 sup.absorb2<span class="main">)</span>

<span class="keyword1" id="Lattice_Basics-sup_selective"><span class="command">lemma</span></span> sup_selective<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">=</span> <span class="free">x</span> <span class="main">∨</span> <span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> sup_inf_selective <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Lattice_Basics-inf_selective"><span class="command">lemma</span></span> inf_selective<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">=</span> <span class="free">x</span> <span class="main">∨</span> <span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> sup_inf_selective <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">subclass</span></span> distrib_lattice
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">standard</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order.antisym<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_supI2<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> inf_selective inf.coboundedI1 inf.coboundedI2 order.eq_iff<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Lattice_Basics-sup_less_eq"><span class="command">lemma</span></span> sup_less_eq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⊔</span> <span class="free">z</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">∨</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_supI1 le_supI2 sup_selective<span class="main">)</span>

<span class="keyword1" id="Lattice_Basics-inf_less_eq"><span class="command">lemma</span></span> inf_less_eq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">∨</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.coboundedI1 inf.coboundedI2 inf_selective<span class="main">)</span>

<span class="keyword1" id="Lattice_Basics-sup_inf_sup"><span class="command">lemma</span></span> sup_inf_sup<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sup_commute sup_inf_absorb sup_left_commute<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following class derives additional properties if the linear order of the lattice has a least and a greatest element.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> linear_bounded_lattice <span class="main">=</span> bounded_lattice <span class="main">+</span> linorder
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subclass</span></span> linear_lattice <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">subclass</span></span> bounded_linorder <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">subclass</span></span> bounded_distrib_lattice <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1" id="Lattice_Basics-sup_dense"><span class="command">lemma</span></span> sup_dense<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> top <span class="main">⟹</span> <span class="free">y</span> <span class="main">≠</span> top <span class="main">⟹</span> <span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">≠</span> top"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sup_selective<span class="main">)</span>

<span class="keyword1" id="Lattice_Basics-inf_dense"><span class="command">lemma</span></span> inf_dense<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> bot <span class="main">⟹</span> <span class="free">y</span> <span class="main">≠</span> bot <span class="main">⟹</span> <span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">≠</span> bot"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_selective<span class="main">)</span>

<span class="keyword1" id="Lattice_Basics-sup_not_bot"><span class="command">lemma</span></span> sup_not_bot<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> bot <span class="main">⟹</span> <span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">≠</span> bot"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Lattice_Basics-inf_not_top"><span class="command">lemma</span></span> inf_not_top<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> top <span class="main">⟹</span> <span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">≠</span> top"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">subclass</span></span> dense_lattice
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command">using</span></span> inf_dense <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Every bounded linear order can be expanded to a bounded lattice.
Join and meet are maximum and minimum, respectively.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> linorder_lattice_expansion <span class="main">=</span> bounded_linorder <span class="main">+</span> sup <span class="main">+</span> inf <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> sup_def <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">=</span> max <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> inf_def <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">=</span> min <span class="free">x</span> <span class="free">y</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subclass</span></span> linear_bounded_lattice
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Non-trivial Algebras›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Some results, such as the existence of certain filters, require that the algebras are not trivial.
This is not an assumption of the order and lattice classes that come with Isabelle/HOL; for example, <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>bot = top›</span></span></span></span> may hold in bounded lattices.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> non_trivial <span class="main">=</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> consistent<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span> <span class="bound">y</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="bound">y</span>"</span></span>

<span class="keyword1"><span class="command">class</span></span> non_trivial_order <span class="main">=</span> non_trivial <span class="main">+</span> order

<span class="keyword1"><span class="command">class</span></span> non_trivial_order_bot <span class="main">=</span> non_trivial_order <span class="main">+</span> order_bot

<span class="keyword1"><span class="command">class</span></span> non_trivial_bounded_order <span class="main">=</span> non_trivial_order_bot <span class="main">+</span> order_top
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Lattice_Basics-bot_not_top"><span class="command">lemma</span></span> bot_not_top<span class="main">:</span>
  <span class="quoted"><span class="quoted">"bot <span class="main">≠</span> top"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> consistent <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bot_less top.extremum_strict<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Homomorphisms›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
This section gives definitions of lattice homomorphisms and isomorphisms and basic properties.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> sup_inf_top_bot_uminus <span class="main">=</span> sup <span class="main">+</span> inf <span class="main">+</span> top <span class="main">+</span> bot <span class="main">+</span> uminus
<span class="keyword1"><span class="command">class</span></span> sup_inf_top_bot_uminus_ord <span class="main">=</span> sup_inf_top_bot_uminus <span class="main">+</span> ord

<span class="keyword1"><span class="command">context</span></span> boolean_algebra
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subclass</span></span> sup_inf_top_bot_uminus_ord <span class="keyword1"><span class="command">.</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">sup_homomorphism</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>sup <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>sup<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">sup_homomorphism</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span> <span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span><span class="bound">x</span> <span class="main">⊔</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">x</span> <span class="main">⊔</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">y</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">inf_homomorphism</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>inf <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>inf<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">inf_homomorphism</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span> <span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span><span class="bound">x</span> <span class="main">⊓</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">x</span> <span class="main">⊓</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">y</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">bot_homomorphism</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>bot <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>bot<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">bot_homomorphism</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> bot <span class="main">=</span> bot"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">top_homomorphism</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>top <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>top<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">top_homomorphism</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> top <span class="main">=</span> top"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">minus_homomorphism</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>minus <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>minus<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">minus_homomorphism</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span> <span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span><span class="bound">x</span> <span class="main">-</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">x</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">y</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">uminus_homomorphism</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>uminus <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>uminus<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">uminus_homomorphism</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">x</span> <span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">x</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">sup_inf_homomorphism</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>sup<span class="main">,</span>inf<span class="main">}</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span><span class="main">{</span>sup<span class="main">,</span>inf<span class="main">}</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">sup_inf_homomorphism</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≡</span> sup_homomorphism <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">∧</span> inf_homomorphism <span class="free"><span class="bound"><span class="entity">f</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">sup_inf_top_homomorphism</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>sup<span class="main">,</span>inf<span class="main">,</span>top<span class="main">}</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span><span class="main">{</span>sup<span class="main">,</span>inf<span class="main">,</span>top<span class="main">}</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">sup_inf_top_homomorphism</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≡</span> sup_inf_homomorphism <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">∧</span> top_homomorphism <span class="free"><span class="bound"><span class="entity">f</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">sup_inf_top_bot_homomorphism</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>sup<span class="main">,</span>inf<span class="main">,</span>top<span class="main">,</span>bot<span class="main">}</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span><span class="main">{</span>sup<span class="main">,</span>inf<span class="main">,</span>top<span class="main">,</span>bot<span class="main">}</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">sup_inf_top_bot_homomorphism</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≡</span> sup_inf_top_homomorphism <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">∧</span> bot_homomorphism <span class="free"><span class="bound"><span class="entity">f</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">bounded_lattice_homomorphism</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>bounded_lattice <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>bounded_lattice<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">bounded_lattice_homomorphism</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≡</span> sup_inf_top_bot_homomorphism <span class="free"><span class="bound"><span class="entity">f</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">sup_inf_top_bot_uminus_homomorphism</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>sup_inf_top_bot_uminus <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>sup_inf_top_bot_uminus<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">sup_inf_top_bot_uminus_homomorphism</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≡</span> sup_inf_top_bot_homomorphism <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">∧</span> uminus_homomorphism <span class="free"><span class="bound"><span class="entity">f</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">sup_inf_top_bot_uminus_ord_homomorphism</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>sup_inf_top_bot_uminus_ord <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>sup_inf_top_bot_uminus_ord<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">sup_inf_top_bot_uminus_ord_homomorphism</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≡</span> sup_inf_top_bot_uminus_homomorphism <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">x</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">y</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">sup_inf_top_isomorphism</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>sup<span class="main">,</span>inf<span class="main">,</span>top<span class="main">}</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span><span class="main">{</span>sup<span class="main">,</span>inf<span class="main">,</span>top<span class="main">}</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">sup_inf_top_isomorphism</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≡</span> sup_inf_top_homomorphism <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">∧</span> bij <span class="free"><span class="bound"><span class="entity">f</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">bounded_lattice_top_isomorphism</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>bounded_lattice_top <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>bounded_lattice_top<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">bounded_lattice_top_isomorphism</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≡</span> sup_inf_top_isomorphism <span class="free"><span class="bound"><span class="entity">f</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">sup_inf_top_bot_uminus_isomorphism</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>sup_inf_top_bot_uminus <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>sup_inf_top_bot_uminus<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">sup_inf_top_bot_uminus_isomorphism</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≡</span> sup_inf_top_bot_uminus_homomorphism <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">∧</span> bij <span class="free"><span class="bound"><span class="entity">f</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">boolean_algebra_isomorphism</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>boolean_algebra <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>boolean_algebra<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">boolean_algebra_isomorphism</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≡</span> sup_inf_top_bot_uminus_isomorphism <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">∧</span> minus_homomorphism <span class="free"><span class="bound"><span class="entity">f</span></span></span>"</span></span>

<span class="keyword1" id="Lattice_Basics-sup_homomorphism_mono"><span class="command">lemma</span></span> sup_homomorphism_mono<span class="main">:</span>
  <span class="quoted"><span class="quoted">"sup_homomorphism <span class="main">(</span><span class="free">f</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>semilattice_sup <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>semilattice_sup<span class="main">)</span> <span class="main">⟹</span> mono <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_iff_sup monoI<span class="main">)</span>

<span class="keyword1" id="Lattice_Basics-sup_isomorphism_ord_isomorphism"><span class="command">lemma</span></span> sup_isomorphism_ord_isomorphism<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sup_homomorphism <span class="main">(</span><span class="free">f</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>semilattice_sup <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>semilattice_sup<span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"bij <span class="free">f</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟷</span> <span class="free">f</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">f</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">f</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> le_iff_sup<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">f</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> le_iff_sup<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> injD bij_is_inj assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_iff_sup<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Lattice_Basics-minus_homomorphism_default"><span class="command">lemma</span></span> minus_homomorphism_default<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>inf<span class="main">,</span>minus<span class="main">,</span>uminus<span class="main">}</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">-</span> <span class="bound">y</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="bound">y</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">::</span><span class="tfree">'b</span><span class="main">::</span><span class="main">{</span>inf<span class="main">,</span>minus<span class="main">,</span>uminus<span class="main">}</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">-</span> <span class="bound">y</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="bound">y</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"inf_homomorphism <span class="main">(</span><span class="free">f</span><span class="main">::</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"uminus_homomorphism <span class="free">f</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"minus_homomorphism <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

</pre>
</div><div id="P_Algebras">
<div class="head">
<h1>Theory P_Algebras</h1>
</div>
<pre class="source"><span class="comment1">(* Title:      Pseudocomplemented Algebras
   Author:     Walter Guttmann
   Maintainer: Walter Guttmann &lt;walter.guttmann at canterbury.ac.nz&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Pseudocomplemented Algebras›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
This theory expands lattices with a pseudocomplement operation.
In particular, we consider the following algebraic structures:
\begin{itemize}
\item pseudocomplemented lattices (p-algebras)
\item pseudocomplemented distributive lattices (distributive p-algebras)
\item Stone algebras
\item Heyting semilattices
\item Heyting lattices
\item Heyting algebras
\item Heyting-Stone algebras
\item Brouwer algebras
\item Boolean algebras
\end{itemize}
Most of these structures and many results in this theory are discussed in \cite{BalbesDwinger1974,Birkhoff1967,Blyth2005,Curry1977,Graetzer1971,Maddux1996}.
›</span></span>

<span class="keyword1"><span class="command">theory</span></span> P_Algebras

<span class="keyword2"><span class="keyword">imports</span></span> <a href="#Lattice_Basics">Lattice_Basics</a>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹P-Algebras›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
In this section we add a pseudocomplement operation to lattices and to distributive lattices.
›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Pseudocomplemented Lattices›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The pseudocomplement of an element <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>y›</span></span></span></span> is the greatest element whose meet with <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>y›</span></span></span></span> is the least element of the lattice.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> p_algebra <span class="main">=</span> bounded_lattice <span class="main">+</span> uminus <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> pseudo_complement<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">=</span> bot <span class="main">⟷</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">-</span><span class="free">y</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subclass</span></span> sup_inf_top_bot_uminus_ord <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Regular elements and dense elements are frequently used in pseudocomplemented algebras.
›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">regular</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">-</span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">dense</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="main">-</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> bot"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">complemented</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="main">∃</span><span class="bound">y</span> <span class="main">.</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊓</span> <span class="bound">y</span> <span class="main">=</span> bot <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊔</span> <span class="bound">y</span> <span class="main">=</span> top"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">in_p_image</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="main">∃</span><span class="bound">y</span> <span class="main">.</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">-</span><span class="bound">y</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">selection</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="main">-</span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">⊓</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">dense_elements</span> <span class="main">≡</span> <span class="main">{</span> <span class="bound">x</span> <span class="main">.</span> dense <span class="bound">x</span> <span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">regular_elements</span> <span class="main">≡</span> <span class="main">{</span> <span class="bound">x</span> <span class="main">.</span> in_p_image <span class="bound">x</span> <span class="main">}</span>"</span></span>

<span class="keyword1" id="P_Algebras-p_bot"><span class="command">lemma</span></span> p_bot <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">-</span>bot <span class="main">=</span> top"</span></span>
  <span class="keyword1"><span class="command">using</span></span> inf_top.left_neutral pseudo_complement top_unique <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="P_Algebras-p_top"><span class="command">lemma</span></span> p_top <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">-</span>top <span class="main">=</span> bot"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> eq_refl inf_top.comm_neutral pseudo_complement<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The pseudocomplement satisfies the following half of the requirements of a complement.
›</span></span>

<span class="keyword1" id="P_Algebras-inf_p"><span class="command">lemma</span></span> inf_p <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">x</span> <span class="main">=</span> bot"</span></span>
  <span class="keyword1"><span class="command">using</span></span> inf.commute pseudo_complement <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="P_Algebras-p_inf"><span class="command">lemma</span></span> p_inf <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">x</span> <span class="main">=</span> bot"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_commute<span class="main">)</span>

<span class="keyword1" id="P_Algebras-pp_inf_p"><span class="command">lemma</span></span> pp_inf_p<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">-</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">x</span> <span class="main">=</span> bot"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The double complement is a closure operation.
›</span></span>

<span class="keyword1" id="P_Algebras-pp_increasing"><span class="command">lemma</span></span> pp_increasing<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> inf_p pseudo_complement <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="P_Algebras-ppp"><span class="command">lemma</span></span> ppp <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">-</span><span class="main">-</span><span class="free">x</span> <span class="main">=</span> <span class="main">-</span><span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> order.antisym inf.commute order_trans pseudo_complement pp_increasing<span class="main">)</span>

<span class="keyword1" id="P_Algebras-pp_idempotent"><span class="command">lemma</span></span> pp_idempotent<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">-</span><span class="main">-</span><span class="main">-</span><span class="free">x</span> <span class="main">=</span> <span class="main">-</span><span class="main">-</span><span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="P_Algebras-regular_in_p_image_iff"><span class="command">lemma</span></span> regular_in_p_image_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"regular <span class="free">x</span> <span class="main">⟷</span> in_p_image <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="P_Algebras-pseudo_complement_pp"><span class="command">lemma</span></span> pseudo_complement_pp<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">=</span> bot <span class="main">⟷</span> <span class="main">-</span><span class="main">-</span><span class="free">x</span> <span class="main">≤</span> <span class="main">-</span><span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_commute pseudo_complement ppp<span class="main">)</span>

<span class="keyword1" id="P_Algebras-p_antitone"><span class="command">lemma</span></span> p_antitone<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="main">-</span><span class="free">y</span> <span class="main">≤</span> <span class="main">-</span><span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_commute order_trans pseudo_complement pp_increasing<span class="main">)</span>

<span class="keyword1" id="P_Algebras-p_antitone_sup"><span class="command">lemma</span></span> p_antitone_sup<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span><span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p_antitone<span class="main">)</span>

<span class="keyword1" id="P_Algebras-p_antitone_inf"><span class="command">lemma</span></span> p_antitone_inf<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">x</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p_antitone<span class="main">)</span>

<span class="keyword1" id="P_Algebras-p_antitone_iff"><span class="command">lemma</span></span> p_antitone_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="main">-</span><span class="free">y</span> <span class="main">⟷</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">-</span><span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> order_lesseq_imp p_antitone pp_increasing <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="P_Algebras-pp_isotone"><span class="command">lemma</span></span> pp_isotone<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="main">-</span><span class="main">-</span><span class="free">x</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p_antitone<span class="main">)</span>

<span class="keyword1" id="P_Algebras-pp_isotone_sup"><span class="command">lemma</span></span> pp_isotone_sup<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">-</span><span class="free">x</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p_antitone<span class="main">)</span>

<span class="keyword1" id="P_Algebras-pp_isotone_inf"><span class="command">lemma</span></span> pp_isotone_inf<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p_antitone<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
One of De Morgan's laws holds in pseudocomplemented lattices.
›</span></span>

<span class="keyword1" id="P_Algebras-p_dist_sup"><span class="command">lemma</span></span> p_dist_sup <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order.antisym<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p_antitone<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> inf_le1 inf_le2 le_sup_iff p_antitone_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="P_Algebras-p_supdist_inf"><span class="command">lemma</span></span> p_supdist_inf<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="free">y</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p_antitone<span class="main">)</span>

<span class="keyword1" id="P_Algebras-pp_dist_pp_sup"><span class="command">lemma</span></span> pp_dist_pp_sup <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="free">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="main">-</span><span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="P_Algebras-p_sup_p"><span class="command">lemma</span></span> p_sup_p <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="free">x</span><span class="main">)</span> <span class="main">=</span> bot"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="P_Algebras-pp_sup_p"><span class="command">lemma</span></span> pp_sup_p <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="free">x</span><span class="main">)</span> <span class="main">=</span> top"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="P_Algebras-dense_pp"><span class="command">lemma</span></span> dense_pp<span class="main">:</span>
  <span class="quoted"><span class="quoted">"dense <span class="free">x</span> <span class="main">⟷</span> <span class="main">-</span><span class="main">-</span><span class="free">x</span> <span class="main">=</span> top"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> p_bot p_top ppp<span class="main">)</span>

<span class="keyword1" id="P_Algebras-dense_sup_p"><span class="command">lemma</span></span> dense_sup_p<span class="main">:</span>
  <span class="quoted"><span class="quoted">"dense <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="P_Algebras-regular_char"><span class="command">lemma</span></span> regular_char<span class="main">:</span>
  <span class="quoted"><span class="quoted">"regular <span class="free">x</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">y</span> <span class="main">.</span> <span class="free">x</span> <span class="main">=</span> <span class="main">-</span><span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="P_Algebras-pp_inf_bot_iff"><span class="command">lemma</span></span> pp_inf_bot_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">=</span> bot <span class="main">⟷</span> <span class="main">-</span><span class="main">-</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">=</span> bot"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pseudo_complement_pp<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Weak forms of the shunting property hold.
Most require a pseudocomplemented element on the right-hand side.
›</span></span>

<span class="keyword1" id="P_Algebras-p_shunting_swap"><span class="command">lemma</span></span> p_shunting_swap<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">-</span><span class="free">z</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">⊓</span> <span class="free">z</span> <span class="main">≤</span> <span class="main">-</span><span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_assoc inf_commute pseudo_complement<span class="main">)</span>

<span class="keyword1" id="P_Algebras-pp_inf_below_iff"><span class="command">lemma</span></span> pp_inf_below_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">-</span><span class="free">z</span> <span class="main">⟷</span> <span class="main">-</span><span class="main">-</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">-</span><span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_commute p_shunting_swap<span class="main">)</span>

<span class="keyword1" id="P_Algebras-p_inf_pp"><span class="command">lemma</span></span> p_inf_pp <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order.antisym<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf.coboundedI2 p_antitone pp_increasing<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> inf_commute p_antitone_iff pp_inf_below_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="P_Algebras-p_inf_pp_pp"><span class="command">lemma</span></span> p_inf_pp_pp <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_commute<span class="main">)</span>

<span class="keyword1" id="P_Algebras-regular_closed_inf"><span class="command">lemma</span></span> regular_closed_inf<span class="main">:</span>
  <span class="quoted"><span class="quoted">"regular <span class="free">x</span> <span class="main">⟹</span> regular <span class="free">y</span> <span class="main">⟹</span> regular <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> p_dist_sup ppp<span class="main">)</span>

<span class="keyword1" id="P_Algebras-regular_closed_p"><span class="command">lemma</span></span> regular_closed_p<span class="main">:</span>
  <span class="quoted"><span class="quoted">"regular <span class="main">(</span><span class="main">-</span><span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="P_Algebras-regular_closed_pp"><span class="command">lemma</span></span> regular_closed_pp<span class="main">:</span>
  <span class="quoted"><span class="quoted">"regular <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="P_Algebras-regular_closed_bot"><span class="command">lemma</span></span> regular_closed_bot<span class="main">:</span>
  <span class="quoted"><span class="quoted">"regular bot"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="P_Algebras-regular_closed_top"><span class="command">lemma</span></span> regular_closed_top<span class="main">:</span>
  <span class="quoted"><span class="quoted">"regular top"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="P_Algebras-pp_dist_inf"><span class="command">lemma</span></span> pp_dist_inf <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">-</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> p_dist_sup p_inf_pp_pp ppp<span class="main">)</span>

<span class="keyword1" id="P_Algebras-inf_import_p"><span class="command">lemma</span></span> inf_import_p <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order.antisym<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> p_shunting_swap <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">using</span></span> inf.sup_right_isotone p_antitone <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Pseudocomplements are unique.
›</span></span>

<span class="keyword1" id="P_Algebras-p_unique"><span class="command">lemma</span></span> p_unique<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">=</span> bot <span class="main">⟷</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">z</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">z</span> <span class="main">=</span> <span class="main">-</span><span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> inf.order_eq_iff pseudo_complement <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="P_Algebras-maddux_3_5"><span class="command">lemma</span></span> maddux_3_5<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊔</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="main">(</span><span class="free">y</span> <span class="main">⊔</span> <span class="main">-</span><span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="P_Algebras-shunting_1_pp"><span class="command">lemma</span></span> shunting_1_pp<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="free">y</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">y</span> <span class="main">=</span> bot"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pseudo_complement<span class="main">)</span>

<span class="keyword1" id="P_Algebras-pp_pp_inf_bot_iff"><span class="command">lemma</span></span> pp_pp_inf_bot_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">=</span> bot <span class="main">⟷</span> <span class="main">-</span><span class="main">-</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="free">y</span> <span class="main">=</span> bot"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pseudo_complement_pp<span class="main">)</span>

<span class="keyword1" id="P_Algebras-inf_pp_semi_commute"><span class="command">lemma</span></span> inf_pp_semi_commute<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="free">y</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> inf.eq_refl p_antitone_iff p_inf_pp <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>

<span class="keyword1" id="P_Algebras-inf_pp_commute"><span class="command">lemma</span></span> inf_pp_commute<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">-</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="P_Algebras-sup_pp_semi_commute"><span class="command">lemma</span></span> sup_pp_semi_commute<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="main">-</span><span class="free">y</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p_antitone_iff<span class="main">)</span>

<span class="keyword1" id="P_Algebras-regular_sup"><span class="command">lemma</span></span> regular_sup<span class="main">:</span>
  <span class="quoted"><span class="quoted">"regular <span class="free">z</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⟷</span> <span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> le_supI pp_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> dual_order.trans sup_ge2 pp_increasing pp_isotone_sup <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="P_Algebras-dense_closed_inf"><span class="command">lemma</span></span> dense_closed_inf<span class="main">:</span>
  <span class="quoted"><span class="quoted">"dense <span class="free">x</span> <span class="main">⟹</span> dense <span class="free">y</span> <span class="main">⟹</span> dense <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dense_pp<span class="main">)</span>

<span class="keyword1" id="P_Algebras-dense_closed_sup"><span class="command">lemma</span></span> dense_closed_sup<span class="main">:</span>
  <span class="quoted"><span class="quoted">"dense <span class="free">x</span> <span class="main">⟹</span> dense <span class="free">y</span> <span class="main">⟹</span> dense <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="P_Algebras-dense_closed_pp"><span class="command">lemma</span></span> dense_closed_pp<span class="main">:</span>
  <span class="quoted"><span class="quoted">"dense <span class="free">x</span> <span class="main">⟹</span> dense <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="P_Algebras-dense_closed_top"><span class="command">lemma</span></span> dense_closed_top<span class="main">:</span>
  <span class="quoted"><span class="quoted">"dense top"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="P_Algebras-dense_up_closed"><span class="command">lemma</span></span> dense_up_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"dense <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> dense <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> dense_pp top_le pp_isotone <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="P_Algebras-regular_dense_top"><span class="command">lemma</span></span> regular_dense_top<span class="main">:</span>
  <span class="quoted"><span class="quoted">"regular <span class="free">x</span> <span class="main">⟹</span> dense <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">=</span> top"</span></span>
  <span class="keyword1"><span class="command">using</span></span> p_bot <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="P_Algebras-selection_char"><span class="command">lemma</span></span> selection_char<span class="main">:</span>
  <span class="quoted"><span class="quoted">"selection <span class="free">s</span> <span class="free">x</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">y</span> <span class="main">.</span> <span class="free">s</span> <span class="main">=</span> <span class="main">-</span><span class="bound">y</span> <span class="main">⊓</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_import_p inf_commute regular_closed_p<span class="main">)</span>

<span class="keyword1" id="P_Algebras-selection_closed_inf"><span class="command">lemma</span></span> selection_closed_inf<span class="main">:</span>
  <span class="quoted"><span class="quoted">"selection <span class="free">s</span> <span class="free">x</span> <span class="main">⟹</span> selection <span class="free">t</span> <span class="free">x</span> <span class="main">⟹</span> selection <span class="main">(</span><span class="free">s</span> <span class="main">⊓</span> <span class="free">t</span><span class="main">)</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_assoc inf_commute inf_idem pp_dist_inf<span class="main">)</span>

<span class="keyword1" id="P_Algebras-selection_closed_pp"><span class="command">lemma</span></span> selection_closed_pp<span class="main">:</span>
  <span class="quoted"><span class="quoted">"regular <span class="free">x</span> <span class="main">⟹</span> selection <span class="free">s</span> <span class="free">x</span> <span class="main">⟹</span> selection <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="free">s</span><span class="main">)</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> pp_dist_inf<span class="main">)</span>

<span class="keyword1" id="P_Algebras-selection_closed_bot"><span class="command">lemma</span></span> selection_closed_bot<span class="main">:</span>
  <span class="quoted"><span class="quoted">"selection bot <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="P_Algebras-selection_closed_id"><span class="command">lemma</span></span> selection_closed_id<span class="main">:</span>
  <span class="quoted"><span class="quoted">"selection <span class="free">x</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> inf.le_iff_sup pp_increasing <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Conjugates are usually studied for Boolean algebras, however, some of their properties generalise to pseudocomplemented algebras.
›</span></span>

<span class="keyword1" id="P_Algebras-conjugate_unique_p"><span class="command">lemma</span></span> conjugate_unique_p<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"conjugate <span class="free">f</span> <span class="free">g</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"conjugate <span class="free">f</span> <span class="free">h</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"uminus <span class="main">∘</span> <span class="free">g</span> <span class="main">=</span> uminus <span class="main">∘</span> <span class="free">h</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">⊓</span> <span class="free">g</span> <span class="bound">y</span> <span class="main">=</span> bot <span class="main">⟷</span> <span class="bound">x</span> <span class="main">⊓</span> <span class="free">h</span> <span class="bound">y</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms conjugate_def inf.commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="free">g</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⟷</span> <span class="bound">x</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="free">h</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inf.commute pseudo_complement <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span> <span class="main">.</span> <span class="main">-</span><span class="main">(</span><span class="free">g</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="free">h</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> order.eq_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="P_Algebras-conjugate_symmetric"><span class="command">lemma</span></span> conjugate_symmetric<span class="main">:</span>
  <span class="quoted"><span class="quoted">"conjugate <span class="free">f</span> <span class="free">g</span> <span class="main">⟹</span> conjugate <span class="free">g</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conjugate_def inf_commute<span class="main">)</span>

<span class="keyword1" id="P_Algebras-additive_isotone"><span class="command">lemma</span></span> additive_isotone<span class="main">:</span>
  <span class="quoted"><span class="quoted">"additive <span class="free">f</span> <span class="main">⟹</span> isotone <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> additive_def isotone_def le_iff_sup<span class="main">)</span>

<span class="keyword1" id="P_Algebras-dual_additive_antitone"><span class="command">lemma</span></span> dual_additive_antitone<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dual_additive <span class="free">f</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"isotone <span class="main">(</span>uminus <span class="main">∘</span> <span class="free">f</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span> <span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">x</span> <span class="main">⊔</span> <span class="bound">y</span><span class="main">)</span> <span class="main">≤</span> <span class="free">f</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms dual_additive_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">⟶</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">≤</span> <span class="free">f</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sup_absorb2<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">⟶</span> <span class="main">-</span><span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="free">f</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p_antitone<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> isotone_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="P_Algebras-conjugate_dual_additive"><span class="command">lemma</span></span> conjugate_dual_additive<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"conjugate <span class="free">f</span> <span class="free">g</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"dual_additive <span class="main">(</span>uminus <span class="main">∘</span> <span class="free">f</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span> <span class="main">.</span> <span class="main">-</span><span class="bound">z</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="bound">x</span> <span class="main">⊔</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">-</span><span class="bound">z</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> <span class="main">-</span><span class="bound">z</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="free">f</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span><span class="skolem">z</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">-</span><span class="skolem">z</span> <span class="main">=</span> bot<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p_antitone_iff pseudo_complement<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">g</span><span class="main">(</span><span class="main">-</span><span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> bot<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms conjugate_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="free">g</span><span class="main">(</span><span class="main">-</span><span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pseudo_complement<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="free">g</span><span class="main">(</span><span class="main">-</span><span class="skolem">z</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="free">g</span><span class="main">(</span><span class="main">-</span><span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_sup_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊓</span> <span class="free">g</span><span class="main">(</span><span class="main">-</span><span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> bot <span class="main">∧</span> <span class="skolem">y</span> <span class="main">⊓</span> <span class="free">g</span><span class="main">(</span><span class="main">-</span><span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> bot<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pseudo_complement<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="skolem">z</span> <span class="main">=</span> bot <span class="main">∧</span> <span class="free">f</span> <span class="skolem">y</span> <span class="main">⊓</span> <span class="main">-</span><span class="skolem">z</span> <span class="main">=</span> bot<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms conjugate_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="skolem">z</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∧</span> <span class="main">-</span><span class="skolem">z</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="free">f</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p_antitone_iff pseudo_complement<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">z</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">-</span><span class="skolem">z</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∧</span> <span class="main">-</span><span class="skolem">z</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="free">f</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span> <span class="main">.</span> <span class="main">-</span><span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="bound">x</span> <span class="main">⊔</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">f</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">f</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">f</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">f</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_le1 inf_le2<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">f</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 order.antisym <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> dual_additive_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="P_Algebras-conjugate_isotone_pp"><span class="command">lemma</span></span> conjugate_isotone_pp<span class="main">:</span>
  <span class="quoted"><span class="quoted">"conjugate <span class="free">f</span> <span class="free">g</span> <span class="main">⟹</span> isotone <span class="main">(</span>uminus <span class="main">∘</span> uminus <span class="main">∘</span> <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comp_assoc conjugate_dual_additive dual_additive_antitone<span class="main">)</span>

<span class="keyword1" id="P_Algebras-conjugate_char_1_pp"><span class="command">lemma</span></span> conjugate_char_1_pp<span class="main">:</span>
  <span class="quoted"><span class="quoted">"conjugate <span class="free">f</span> <span class="free">g</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span> <span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">g</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="free">f</span> <span class="bound">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="bound">y</span> <span class="main">∧</span> <span class="free">g</span><span class="main">(</span><span class="bound">y</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="free">g</span> <span class="bound">y</span> <span class="main">⊓</span> <span class="main">-</span><span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"conjugate <span class="free">f</span> <span class="free">g</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span> <span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">g</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="free">f</span> <span class="bound">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="bound">y</span> <span class="main">∧</span> <span class="free">g</span><span class="main">(</span><span class="bound">y</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="free">g</span> <span class="bound">y</span> <span class="main">⊓</span> <span class="main">-</span><span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
    <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">(</span><span class="skolem">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">g</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span><span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conjugate_def pseudo_complement<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">(</span><span class="skolem">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">g</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="free">f</span><span class="main">(</span><span class="skolem">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">g</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pp_increasing<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="free">f</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 conjugate_isotone_pp isotone_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">(</span><span class="skolem">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">g</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="free">f</span> <span class="skolem">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"isotone <span class="main">(</span>uminus <span class="main">∘</span> uminus <span class="main">∘</span> <span class="free">g</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 conjugate_isotone_pp conjugate_symmetric <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span><span class="main">(</span><span class="skolem">y</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span><span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conjugate_def inf.cobounded2 inf_commute pseudo_complement<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span><span class="main">(</span><span class="skolem">y</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="free">g</span><span class="main">(</span><span class="skolem">y</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pp_increasing<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="free">g</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 4 isotone_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span><span class="main">(</span><span class="skolem">y</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="free">g</span> <span class="skolem">y</span> <span class="main">⊓</span> <span class="main">-</span><span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main">(</span><span class="skolem">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">g</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="free">f</span> <span class="skolem">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="skolem">y</span> <span class="main">∧</span> <span class="free">g</span><span class="main">(</span><span class="skolem">y</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="free">g</span> <span class="skolem">y</span> <span class="main">⊓</span> <span class="main">-</span><span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> 6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span> <span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">g</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="free">f</span> <span class="bound">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="bound">y</span> <span class="main">∧</span> <span class="free">g</span><span class="main">(</span><span class="bound">y</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="free">g</span> <span class="bound">y</span> <span class="main">⊓</span> <span class="main">-</span><span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> 7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">⊓</span> <span class="bound">y</span> <span class="main">=</span> bot <span class="main">⟶</span> <span class="bound">x</span> <span class="main">⊓</span> <span class="free">g</span> <span class="bound">y</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.le_iff_sup inf.le_sup_iff inf_commute pseudo_complement<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">⊓</span> <span class="free">g</span> <span class="bound">y</span> <span class="main">=</span> bot <span class="main">⟶</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">⊓</span> <span class="bound">y</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 6 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.le_iff_sup inf.le_sup_iff inf_commute pseudo_complement<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"conjugate <span class="free">f</span> <span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 7 conjugate_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="P_Algebras-conjugate_char_1_isotone"><span class="command">lemma</span></span> conjugate_char_1_isotone<span class="main">:</span>
  <span class="quoted"><span class="quoted">"conjugate <span class="free">f</span> <span class="free">g</span> <span class="main">⟹</span> isotone <span class="free">f</span> <span class="main">⟹</span> isotone <span class="free">g</span> <span class="main">⟹</span> <span class="free">f</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">g</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">f</span> <span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">y</span> <span class="main">∧</span> <span class="free">g</span><span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">f</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">g</span> <span class="free">y</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conjugate_char_1_pp ord.isotone_def<span class="main">)</span>

<span class="keyword1" id="P_Algebras-dense_lattice_char_1"><span class="command">lemma</span></span> dense_lattice_char_1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">⊓</span> <span class="bound">y</span> <span class="main">=</span> bot <span class="main">⟶</span> <span class="bound">x</span> <span class="main">=</span> bot <span class="main">∨</span> <span class="bound">y</span> <span class="main">=</span> bot<span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> bot <span class="main">⟶</span> dense <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_top.left_neutral p_bot p_inf pp_inf_bot_iff<span class="main">)</span>

<span class="keyword1" id="P_Algebras-dense_lattice_char_2"><span class="command">lemma</span></span> dense_lattice_char_2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">⊓</span> <span class="bound">y</span> <span class="main">=</span> bot <span class="main">⟶</span> <span class="bound">x</span> <span class="main">=</span> bot <span class="main">∨</span> <span class="bound">y</span> <span class="main">=</span> bot<span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">.</span> regular <span class="bound">x</span> <span class="main">⟶</span> <span class="bound">x</span> <span class="main">=</span> bot <span class="main">∨</span> <span class="bound">x</span> <span class="main">=</span> top<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dense_lattice_char_1 inf_top.left_neutral p_inf regular_closed_p regular_closed_top<span class="main">)</span>

<span class="keyword1" id="P_Algebras-restrict_below_Rep_eq"><span class="command">lemma</span></span> restrict_below_Rep_eq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="free">y</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⊓</span> <span class="free">z</span> <span class="main">⊓</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.absorb2 inf.commute inf.left_commute pp_increasing<span class="main">)</span>

<span class="comment1">(*
lemma p_inf_sup_below: "-x ⊓ (x ⊔ y) ≤ y" nitpick [expect=genuine] oops
lemma complement_p: "x ⊓ y = bot ∧ x ⊔ y = top ⟶ -x = y" nitpick [expect=genuine] oops
lemma complemented_regular: "complemented x ⟶ regular x" nitpick [expect=genuine] oops
*)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following class gives equational axioms for the pseudocomplement operation.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> p_algebra_eq <span class="main">=</span> bounded_lattice <span class="main">+</span> uminus <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p_bot_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span>bot <span class="main">=</span> top"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p_top_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span>top <span class="main">=</span> bot"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> inf_import_p_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">y</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="P_Algebras-inf_p_eq"><span class="command">lemma</span></span> inf_p_eq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">x</span> <span class="main">=</span> bot"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_bot_right inf_import_p_eq inf_top_right p_top_eq<span class="main">)</span>

<span class="keyword1"><span class="command">subclass</span></span> p_algebra
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> inf.orderI inf_import_p_eq inf_top.right_neutral p_bot_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> inf.left_commute inf.orderE inf_bot_right inf_commute inf_p_eq<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Pseudocomplemented Distributive Lattices›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We obtain further properties if we assume that the lattice operations are distributive.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> pd_algebra <span class="main">=</span> p_algebra <span class="main">+</span> bounded_distrib_lattice
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="P_Algebras-p_inf_sup_below"><span class="command">lemma</span></span> p_inf_sup_below<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_sup_distrib1<span class="main">)</span>

<span class="keyword1" id="P_Algebras-pp_inf_sup_p"><span class="command">lemma</span></span> pp_inf_sup_p <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">-</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> inf.absorb2 inf_sup_distrib1 pp_increasing <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="P_Algebras-complement_p"><span class="command">lemma</span></span> complement_p<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">=</span> bot <span class="main">⟹</span> <span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">=</span> top <span class="main">⟹</span> <span class="main">-</span><span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> pseudo_complement inf.commute inf_top.left_neutral sup.absorb_iff1 sup.commute sup_bot.right_neutral sup_inf_distrib2 p_inf<span class="main">)</span>

<span class="keyword1" id="P_Algebras-complemented_regular"><span class="command">lemma</span></span> complemented_regular<span class="main">:</span>
  <span class="quoted"><span class="quoted">"complemented <span class="free">x</span> <span class="main">⟹</span> regular <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> complement_p inf.commute sup.commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="P_Algebras-regular_inf_dense"><span class="command">lemma</span></span> regular_inf_dense<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">y</span> <span class="bound">z</span> <span class="main">.</span> regular <span class="bound">y</span> <span class="main">∧</span> dense <span class="bound">z</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">=</span> <span class="bound">y</span> <span class="main">⊓</span> <span class="bound">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> pp_inf_sup_p dense_sup_p ppp<span class="main">)</span>

<span class="keyword1" id="P_Algebras-maddux_3_12"><span class="command">lemma</span></span> maddux_3_12 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="free">y</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> p_inf sup_bot_right sup_inf_distrib1<span class="main">)</span>

<span class="keyword1" id="P_Algebras-maddux_3_13"><span class="command">lemma</span></span> maddux_3_13 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">x</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_sup_distrib2<span class="main">)</span>

<span class="keyword1" id="P_Algebras-maddux_3_20"><span class="command">lemma</span></span> maddux_3_20<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">v</span> <span class="main">⊓</span> <span class="free">w</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">-</span><span class="free">v</span> <span class="main">⊓</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="main">(</span><span class="free">v</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">-</span><span class="free">v</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">v</span> <span class="main">⊓</span> <span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">y</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">-</span><span class="free">v</span> <span class="main">⊓</span> <span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">z</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">⊓</span> <span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">v</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="main">-</span><span class="free">v</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="free">v</span> <span class="main">⊓</span> <span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">v</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> inf.cobounded1 inf_absorb1 le_infI1 p_antitone_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">v</span> <span class="main">⊓</span> <span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inf.sup_relative_same_increasing inf_import_p inf_le1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">⊓</span> <span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">v</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="main">-</span><span class="free">v</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="free">v</span> <span class="main">⊓</span> <span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">v</span> <span class="main">⊓</span> <span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">v</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="main">-</span><span class="free">v</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="free">v</span> <span class="main">⊓</span> <span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="main">-</span><span class="free">v</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf.absorb1 le_infI1 p_antitone_inf<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">-</span><span class="free">v</span> <span class="main">⊓</span> <span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf.assoc inf_left_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">v</span> <span class="main">⊓</span> <span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">v</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="main">-</span><span class="free">v</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="free">v</span> <span class="main">⊓</span> <span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">v</span> <span class="main">⊓</span> <span class="free">w</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">-</span><span class="free">v</span> <span class="main">⊓</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="main">(</span><span class="free">v</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">-</span><span class="free">v</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">v</span> <span class="main">⊓</span> <span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">v</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="main">-</span><span class="free">v</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">-</span><span class="free">v</span> <span class="main">⊓</span> <span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">v</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="main">-</span><span class="free">v</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_assoc inf_sup_distrib2<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">v</span> <span class="main">⊓</span> <span class="free">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">y</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">-</span><span class="free">v</span> <span class="main">⊓</span> <span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="P_Algebras-order_char_1"><span class="command">lemma</span></span> order_char_1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⊔</span> <span class="main">-</span><span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.sup_left_isotone inf_sup_absorb le_supI1 maddux_3_12 sup_commute<span class="main">)</span>

<span class="keyword1" id="P_Algebras-order_char_2"><span class="command">lemma</span></span> order_char_2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⊔</span> <span class="main">-</span><span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> order_char_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="comment1">(*
lemma pp_dist_sup [simp]: "--(x ⊔ y) = --x ⊔ --y" nitpick [expect=genuine] oops
lemma regular_closed_sup: "regular x ∧ regular y ⟶ regular (x ⊔ y)" nitpick [expect=genuine] oops
lemma regular_complemented_iff: "regular x ⟷ complemented x" nitpick [expect=genuine] oops
lemma selection_closed_sup: "selection s x ∧ selection t x ⟶ selection (s ⊔ t) x" nitpick [expect=genuine] oops
lemma stone [simp]: "-x ⊔ --x = top" nitpick [expect=genuine] oops
*)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Stone Algebras›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
A Stone algebra is a distributive lattice with a pseudocomplement that satisfies the following equation.
We thus obtain the other half of the requirements of a complement at least for the regular elements.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> stone_algebra <span class="main">=</span> pd_algebra <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> stone <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="main">-</span><span class="free">x</span> <span class="main">=</span> top"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
As a consequence, we obtain both De Morgan's laws for all elements.
›</span></span>

<span class="keyword1" id="P_Algebras-p_dist_inf"><span class="command">lemma</span></span> p_dist_inf <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="free">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> p_unique<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> iffI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">w</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> bot"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inf_commute inf_left_commute pseudo_complement <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="free">x</span> <span class="main">≤</span> <span class="main">-</span><span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pseudo_complement<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">x</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="skolem">w</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> distrib_imp2 sup_inf_distrib1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">≤</span> <span class="main">-</span><span class="free">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_le2 sup.mono<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">w</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">≤</span> <span class="main">-</span><span class="free">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="free">y</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">using</span></span> order_trans p_supdist_inf pseudo_complement <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="P_Algebras-pp_dist_sup"><span class="command">lemma</span></span> pp_dist_sup <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">-</span><span class="free">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="main">-</span><span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="P_Algebras-regular_closed_sup"><span class="command">lemma</span></span> regular_closed_sup<span class="main">:</span>
  <span class="quoted"><span class="quoted">"regular <span class="free">x</span> <span class="main">⟹</span> regular <span class="free">y</span> <span class="main">⟹</span> regular <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The regular elements are precisely the ones having a complement.
›</span></span>

<span class="keyword1" id="P_Algebras-regular_complemented_iff"><span class="command">lemma</span></span> regular_complemented_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"regular <span class="free">x</span> <span class="main">⟷</span> complemented <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_p stone complemented_regular<span class="main">)</span>

<span class="keyword1" id="P_Algebras-selection_closed_sup"><span class="command">lemma</span></span> selection_closed_sup<span class="main">:</span>
  <span class="quoted"><span class="quoted">"selection <span class="free">s</span> <span class="free">x</span> <span class="main">⟹</span> selection <span class="free">t</span> <span class="free">x</span> <span class="main">⟹</span> selection <span class="main">(</span><span class="free">s</span> <span class="main">⊔</span> <span class="free">t</span><span class="main">)</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_sup_distrib2<span class="main">)</span>

<span class="keyword1" id="P_Algebras-huntington_3_pp"><span class="command">lemma</span></span> huntington_3_pp <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="main">-</span><span class="free">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="free">y</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">-</span><span class="main">(</span><span class="main">-</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">-</span><span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> p_dist_inf p_inf sup.commute sup_bot_left sup_inf_distrib1<span class="main">)</span>

<span class="keyword1" id="P_Algebras-maddux_3_3"><span class="command">lemma</span></span> maddux_3_3 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup_commute sup_inf_distrib1<span class="main">)</span>

<span class="keyword1" id="P_Algebras-maddux_3_11_pp"><span class="command">lemma</span></span> maddux_3_11_pp<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">y</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_sup_distrib1 inf_top_right stone<span class="main">)</span>

<span class="keyword1" id="P_Algebras-maddux_3_19_pp"><span class="command">lemma</span></span> maddux_3_19_pp<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="main">-</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">z</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="main">-</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">x</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf.commute inf_sup_distrib1 sup.assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">x</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">z</span> <span class="main">⊓</span> <span class="main">(</span><span class="main">-</span><span class="free">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="main">-</span><span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">x</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">z</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inf_sup_distrib1 sup_assoc inf_commute inf_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">x</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">z</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">z</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_assoc inf_commute sup.left_commute sup_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_commute sup_commute<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="P_Algebras-compl_inter_eq_pp"><span class="command">lemma</span></span> compl_inter_eq_pp<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">-</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">=</span> <span class="main">-</span><span class="main">-</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">z</span> <span class="main">⟹</span> <span class="main">-</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">=</span> <span class="main">-</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">z</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">=</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_commute inf_p inf_sup_distrib1 inf_top.right_neutral p_bot p_dist_inf<span class="main">)</span>

<span class="keyword1" id="P_Algebras-maddux_3_21_pp"><span class="command">lemma</span></span> maddux_3_21_pp <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">-</span><span class="free">x</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">-</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">-</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup.commute sup_inf_distrib1<span class="main">)</span>

<span class="keyword1" id="P_Algebras-shunting_2_pp"><span class="command">lemma</span></span> shunting_2_pp<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="free">y</span> <span class="main">⟷</span> <span class="main">-</span><span class="free">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="main">-</span><span class="free">y</span> <span class="main">=</span> top"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_top_left p_bot p_dist_inf pseudo_complement<span class="main">)</span>

<span class="keyword1" id="P_Algebras-shunting_p"><span class="command">lemma</span></span> shunting_p<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">-</span><span class="free">z</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">-</span><span class="free">z</span> <span class="main">⊔</span> <span class="main">-</span><span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.assoc p_dist_inf p_shunting_swap pseudo_complement<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following weak shunting property is interesting as it does not require the element <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>z›</span></span></span></span> on the right-hand side to be regular.
›</span></span>

<span class="keyword1" id="P_Algebras-shunting_var_p"><span class="command">lemma</span></span> shunting_var_p<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">y</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⊔</span> <span class="main">-</span><span class="main">-</span><span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">y</span> <span class="main">≤</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">⊔</span> <span class="main">-</span><span class="main">-</span><span class="free">y</span> <span class="main">=</span> <span class="main">-</span><span class="main">-</span><span class="free">y</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">z</span> <span class="main">⊔</span> <span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup.absorb1 sup.commute<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⊔</span> <span class="main">-</span><span class="main">-</span><span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_commute maddux_3_21_pp sup.commute sup.left_commute sup_left_divisibility<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⊔</span> <span class="main">-</span><span class="main">-</span><span class="free">y</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">y</span> <span class="main">≤</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.mono maddux_3_12 sup_ge2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* Whether conjugate_char_2_pp can be proved in pd_algebra or in p_algebra is unknown. *)</span>
<span class="keyword1" id="P_Algebras-conjugate_char_2_pp"><span class="command">lemma</span></span> conjugate_char_2_pp<span class="main">:</span>
  <span class="quoted"><span class="quoted">"conjugate <span class="free">f</span> <span class="free">g</span> <span class="main">⟷</span> <span class="free">f</span> bot <span class="main">=</span> bot <span class="main">∧</span> <span class="free">g</span> bot <span class="main">=</span> bot <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">⊓</span> <span class="bound">y</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="free">g</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="free">g</span> <span class="bound">y</span> <span class="main">⊓</span> <span class="bound">x</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="free">g</span><span class="main">(</span><span class="bound">y</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"conjugate <span class="free">f</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"dual_additive <span class="main">(</span>uminus <span class="main">∘</span> <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> conjugate_symmetric conjugate_dual_additive <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> bot <span class="main">=</span> bot <span class="main">∧</span> <span class="free">g</span> bot <span class="main">=</span> bot <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">⊓</span> <span class="bound">y</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="free">g</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="free">g</span> <span class="bound">y</span> <span class="main">⊓</span> <span class="bound">x</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="free">g</span><span class="main">(</span><span class="bound">y</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> bot <span class="main">=</span> bot"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conjugate_def inf_idem inf_bot_left<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> bot <span class="main">=</span> bot"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conjugate_def inf_idem inf_bot_right<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">⊓</span> <span class="bound">y</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="free">g</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="free">g</span> <span class="bound">y</span> <span class="main">⊓</span> <span class="bound">x</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="free">g</span><span class="main">(</span><span class="bound">y</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
      <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="skolem">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">g</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conjugate_def pseudo_complement inf_commute<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="free">g</span><span class="main">(</span><span class="skolem">y</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 1 conjugate_def inf.commute pseudo_complement <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="skolem">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="free">g</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="skolem">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">g</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="skolem">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="free">g</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf.le_iff_sup inf_commute<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="main">(</span><span class="skolem">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">g</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="free">g</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 1 conjugate_dual_additive dual_additive_def inf_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> maddux_3_11_pp<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">⊓</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="skolem">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="free">g</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_commute p_shunting_swap<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">g</span><span class="main">(</span><span class="skolem">y</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">g</span><span class="main">(</span><span class="skolem">y</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">g</span><span class="main">(</span><span class="skolem">y</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 4 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf.le_iff_sup inf_commute<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">g</span><span class="main">(</span><span class="main">(</span><span class="skolem">y</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dual_additive_def inf_assoc<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">g</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> maddux_3_11_pp<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="free">g</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="skolem">y</span> <span class="main">⊓</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="free">g</span><span class="main">(</span><span class="skolem">y</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_commute p_shunting_swap<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">⊓</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="skolem">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="free">g</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="free">g</span> <span class="skolem">y</span> <span class="main">⊓</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="free">g</span><span class="main">(</span><span class="skolem">y</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> bot <span class="main">=</span> bot <span class="main">∧</span> <span class="free">g</span> bot <span class="main">=</span> bot <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">⊓</span> <span class="bound">y</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="free">g</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="free">g</span> <span class="bound">y</span> <span class="main">⊓</span> <span class="bound">x</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="free">g</span><span class="main">(</span><span class="bound">y</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"conjugate <span class="free">f</span> <span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> conjugate_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> inf_commute le_bot pp_inf_bot_iff regular_closed_bot<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="P_Algebras-conjugate_char_2_pp_additive"><span class="command">lemma</span></span> conjugate_char_2_pp_additive<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"conjugate <span class="free">f</span> <span class="free">g</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"additive <span class="free">f</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"additive <span class="free">g</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">f</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="free">g</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="free">g</span> <span class="free">y</span> <span class="main">⊓</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">g</span><span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="free">f</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="free">g</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">g</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup.commute sup_inf_distrib1<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="free">g</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">g</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> additive_def inf_sup_distrib2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="free">g</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> conjugate_def inf_le2 pseudo_complement sup_bot.right_neutral<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">f</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="free">g</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="free">y</span> <span class="main">⊓</span> <span class="free">x</span> <span class="main">=</span> <span class="free">g</span> <span class="main">(</span><span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="free">f</span> <span class="free">x</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">f</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup.commute sup_inf_distrib1<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">g</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="free">f</span> <span class="free">x</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">x</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">g</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">f</span> <span class="free">x</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> additive_def inf_sup_distrib2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">g</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="free">f</span> <span class="free">x</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> conjugate_def inf.cobounded2 pseudo_complement sup_bot.right_neutral inf_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="free">y</span> <span class="main">⊓</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">g</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="free">f</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(*
lemma compl_le_swap2_iff: "-x ≤ y ⟷ -y ≤ x" nitpick [expect=genuine] oops
lemma huntington_3: "x = -(-x ⊔ -y) ⊔ -(-x ⊔ y)" nitpick [expect=genuine] oops
lemma maddux_3_1: "x ⊔ -x = y ⊔ -y" nitpick [expect=genuine] oops
lemma maddux_3_4: "x ⊔ (y ⊔ -y) = z ⊔ -z" nitpick [expect=genuine] oops
lemma maddux_3_11: "x = (x ⊓ y) ⊔ (x ⊓ -y)" nitpick [expect=genuine] oops
lemma maddux_3_19: "(-x ⊓ y) ⊔ (x ⊓ z) = (x ⊔ y) ⊓ (-x ⊔ z)" nitpick [expect=genuine] oops
lemma compl_inter_eq: "x ⊓ y = x ⊓ z ∧ -x ⊓ y = -x ⊓ z ⟶ y = z" nitpick [expect=genuine] oops
lemma maddux_3_21: "x ⊔ y = x ⊔ (-x ⊓ y)" nitpick [expect=genuine] oops
lemma shunting_1: "x ≤ y ⟷ x ⊓ -y = bot" nitpick [expect=genuine] oops
lemma shunting_2: "x ≤ y ⟷ -x ⊔ y = top" nitpick [expect=genuine] oops
lemma conjugate_unique: "conjugate f g ∧ conjugate f h ⟶ g = h" nitpick [expect=genuine] oops
lemma conjugate_isotone_pp: "conjugate f g ⟶ isotone f" nitpick [expect=genuine] oops
lemma conjugate_char_1: "conjugate f g ⟷ (∀x y . f(x ⊓ -(g y)) ≤ f x ⊓ -y ∧ g(y ⊓ -(f x)) ≤ g y ⊓ -x)" nitpick [expect=genuine] oops
lemma conjugate_char_2: "conjugate f g ⟷ f bot = bot ∧ g bot = bot ∧ (∀x y . f x ⊓ y ≤ f(x ⊓ g y) ∧ g y ⊓ x ≤ g(y ⊓ f x))" nitpick [expect=genuine] oops
lemma shunting: "x ⊓ y ≤ z ⟷ x ≤ z ⊔ -y" nitpick [expect=genuine] oops
lemma shunting_var: "x ⊓ -y ≤ z ⟷ x ≤ z ⊔ y" nitpick [expect=genuine] oops
lemma sup_compl_top: "x ⊔ -x = top" nitpick [expect=genuine] oops
lemma selection_closed_p: "selection s x ⟶ selection (-s) x" nitpick [expect=genuine] oops
lemma selection_closed_pp: "selection s x ⟶ selection (--s) x" nitpick [expect=genuine] oops
*)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">stone_algebra_isomorphism</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>stone_algebra <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>stone_algebra<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">stone_algebra_isomorphism</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≡</span> sup_inf_top_bot_uminus_isomorphism <span class="free"><span class="bound"><span class="entity">f</span></span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Every bounded linear order can be expanded to a Stone algebra.
The pseudocomplement takes <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>bot›</span></span></span></span> to the <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>top›</span></span></span></span> and every other element to <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>bot›</span></span></span></span>.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> linorder_stone_algebra_expansion <span class="main">=</span> linorder_lattice_expansion <span class="main">+</span> uminus <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> uminus_def <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">x</span> <span class="main">=</span> bot <span class="keyword1">then</span> top <span class="keyword1">else</span> bot<span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subclass</span></span> stone_algebra
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command">using</span></span> bot_unique min_def top_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The regular elements are the least and greatest elements.
All elements except the least element are dense.
›</span></span>

<span class="keyword1" id="P_Algebras-regular_bot_top"><span class="command">lemma</span></span> regular_bot_top<span class="main">:</span>
  <span class="quoted"><span class="quoted">"regular <span class="free">x</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> bot <span class="main">∨</span> <span class="free">x</span> <span class="main">=</span> top"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="P_Algebras-not_bot_dense"><span class="command">lemma</span></span> not_bot_dense<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> bot <span class="main">⟹</span> <span class="main">-</span><span class="main">-</span><span class="free">x</span> <span class="main">=</span> top"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Heyting Algebras›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
In this section we add a relative pseudocomplement operation to semilattices and to lattices.
›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Heyting Semilattices›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The pseudocomplement of an element <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>y›</span></span></span></span> relative to an element <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>z›</span></span></span></span> is the least element whose meet with <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>y›</span></span></span></span> is below <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>z›</span></span></span></span>.
This can be stated as a Galois connection.
Specialising <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>z = bot›</span></span></span></span> gives (non-relative) pseudocomplements.
Many properties can already be shown if the underlying structure is just a semilattice.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> implies <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">implies</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1">↝</span></span></span>"</span> 65<span class="main">)</span>

<span class="keyword1"><span class="command">class</span></span> heyting_semilattice <span class="main">=</span> semilattice_inf <span class="main">+</span> implies <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> implies_galois<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">↝</span> <span class="free">z</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="P_Algebras-implies_below_eq"><span class="command">lemma</span></span> implies_below_eq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">x</span> <span class="main">↝</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> implies_galois inf.absorb_iff1 inf.cobounded1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="P_Algebras-implies_increasing"><span class="command">lemma</span></span> implies_increasing<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">↝</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf.orderI<span class="main">)</span>

<span class="keyword1" id="P_Algebras-implies_galois_swap"><span class="command">lemma</span></span> implies_galois_swap<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">↝</span> <span class="free">z</span> <span class="main">⟷</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">↝</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> implies_galois inf_commute<span class="main">)</span>

<span class="keyword1" id="P_Algebras-implies_galois_var"><span class="command">lemma</span></span> implies_galois_var<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⟷</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">↝</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> implies_galois_swap implies_galois<span class="main">)</span>

<span class="keyword1" id="P_Algebras-implies_galois_increasing"><span class="command">lemma</span></span> implies_galois_increasing<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">↝</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> implies_galois <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="P_Algebras-implies_galois_decreasing"><span class="command">lemma</span></span> implies_galois_decreasing<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">y</span> <span class="main">↝</span> <span class="free">x</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> implies_galois <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="P_Algebras-implies_mp_below"><span class="command">lemma</span></span> implies_mp_below<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">x</span> <span class="main">↝</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> implies_galois_decreasing inf_commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="P_Algebras-implies_isotone"><span class="command">lemma</span></span> implies_isotone<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">z</span> <span class="main">↝</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">↝</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> implies_galois order_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="P_Algebras-implies_antitone"><span class="command">lemma</span></span> implies_antitone<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">↝</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">↝</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> implies_galois_swap order_lesseq_imp<span class="main">)</span>

<span class="keyword1" id="P_Algebras-implies_isotone_inf"><span class="command">lemma</span></span> implies_isotone_inf<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">↝</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">↝</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> implies_isotone<span class="main">)</span>

<span class="keyword1" id="P_Algebras-implies_antitone_inf"><span class="command">lemma</span></span> implies_antitone_inf<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">↝</span> <span class="free">z</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">↝</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> implies_antitone<span class="main">)</span>

<span class="keyword1" id="P_Algebras-implies_curry"><span class="command">lemma</span></span> implies_curry<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">↝</span> <span class="main">(</span><span class="free">y</span> <span class="main">↝</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">↝</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> implies_galois_decreasing implies_galois inf_assoc order.antisym<span class="main">)</span>

<span class="keyword1" id="P_Algebras-implies_curry_flip"><span class="command">lemma</span></span> implies_curry_flip<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">↝</span> <span class="main">(</span><span class="free">y</span> <span class="main">↝</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="free">y</span> <span class="main">↝</span> <span class="main">(</span><span class="free">x</span> <span class="main">↝</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> implies_curry inf_commute<span class="main">)</span>

<span class="keyword1" id="P_Algebras-triple_implies"><span class="command">lemma</span></span> triple_implies <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">↝</span> <span class="free">y</span><span class="main">)</span> <span class="main">↝</span> <span class="free">y</span><span class="main">)</span> <span class="main">↝</span> <span class="free">y</span> <span class="main">=</span> <span class="free">x</span> <span class="main">↝</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> implies_antitone implies_galois_swap order.eq_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="P_Algebras-implies_mp_eq"><span class="command">lemma</span></span> implies_mp_eq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">x</span> <span class="main">↝</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> implies_below_eq implies_mp_below inf_left_commute inf.absorb2<span class="main">)</span>

<span class="keyword1" id="P_Algebras-implies_dist_implies"><span class="command">lemma</span></span> implies_dist_implies<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">↝</span> <span class="main">(</span><span class="free">y</span> <span class="main">↝</span> <span class="free">z</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">↝</span> <span class="free">y</span><span class="main">)</span> <span class="main">↝</span> <span class="main">(</span><span class="free">x</span> <span class="main">↝</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> implies_curry implies_curry_flip <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="P_Algebras-implies_import_inf"><span class="command">lemma</span></span> implies_import_inf <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊓</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">↝</span> <span class="main">(</span><span class="free">x</span> <span class="main">↝</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">y</span> <span class="main">↝</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> implies_curry implies_mp_eq inf_commute<span class="main">)</span>

<span class="keyword1" id="P_Algebras-implies_dist_inf"><span class="command">lemma</span></span> implies_dist_inf<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">↝</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">↝</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">x</span> <span class="main">↝</span> <span class="free">z</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">↝</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">x</span> <span class="main">↝</span> <span class="free">z</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⊓</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> implies_galois<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">↝</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">x</span> <span class="main">↝</span> <span class="free">z</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">↝</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> implies_galois <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> implies_isotone order.eq_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="P_Algebras-implies_itself_top"><span class="command">lemma</span></span> implies_itself_top<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">↝</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> implies_galois_swap implies_increasing<span class="main">)</span>

<span class="keyword1" id="P_Algebras-inf_implies_top"><span class="command">lemma</span></span> inf_implies_top<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">↝</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> implies_galois_var le_infI1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="P_Algebras-inf_inf_implies"><span class="command">lemma</span></span> inf_inf_implies <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">⊓</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">↝</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_implies_top inf_absorb1<span class="main">)</span>

<span class="keyword1" id="P_Algebras-le_implies_top"><span class="command">lemma</span></span> le_implies_top<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">↝</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> implies_antitone implies_itself_top order.trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="P_Algebras-le_iff_le_implies"><span class="command">lemma</span></span> le_iff_le_implies<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">↝</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> implies_galois inf_idem <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="P_Algebras-implies_inf_isotone"><span class="command">lemma</span></span> implies_inf_isotone<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">↝</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span> <span class="main">↝</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> implies_curry implies_galois_increasing implies_isotone<span class="main">)</span>

<span class="keyword1" id="P_Algebras-implies_transitive"><span class="command">lemma</span></span> implies_transitive<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">↝</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">y</span> <span class="main">↝</span> <span class="free">z</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">↝</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> implies_dist_implies implies_galois_var implies_increasing order_lesseq_imp <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="P_Algebras-implies_inf_absorb"><span class="command">lemma</span></span> implies_inf_absorb <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">↝</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="main">↝</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> implies_dist_inf implies_itself_top inf.absorb_iff2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="P_Algebras-implies_implies_absorb"><span class="command">lemma</span></span> implies_implies_absorb <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">↝</span> <span class="main">(</span><span class="free">x</span> <span class="main">↝</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="main">↝</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> implies_curry<span class="main">)</span>

<span class="keyword1" id="P_Algebras-implies_inf_identity"><span class="command">lemma</span></span> implies_inf_identity<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">↝</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_commute<span class="main">)</span>

<span class="keyword1" id="P_Algebras-implies_itself_same"><span class="command">lemma</span></span> implies_itself_same<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">↝</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span> <span class="main">↝</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_implies_top order.eq_iff<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following class gives equational axioms for the relative pseudocomplement operation (inequalities can be written as equations).
›</span></span>

<span class="keyword1"><span class="command">class</span></span> heyting_semilattice_eq <span class="main">=</span> semilattice_inf <span class="main">+</span> implies <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> implies_mp_below<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">x</span> <span class="main">↝</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> implies_galois_increasing<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">↝</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> implies_isotone_inf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">↝</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">↝</span> <span class="free">y</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subclass</span></span> heyting_semilattice
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> implies_galois_increasing implies_isotone_inf inf.absorb2 order_lesseq_imp<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> implies_mp_below inf_commute order_trans inf_mono order_refl<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following class allows us to explicitly give the pseudocomplement of an element relative to itself.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> bounded_heyting_semilattice <span class="main">=</span> bounded_semilattice_inf_top <span class="main">+</span> heyting_semilattice
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="P_Algebras-implies_itself"><span class="command">lemma</span></span> implies_itself <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">↝</span> <span class="free">x</span> <span class="main">=</span> top"</span></span>
  <span class="keyword1"><span class="command">using</span></span> implies_galois inf_le2 top_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="P_Algebras-implies_order"><span class="command">lemma</span></span> implies_order<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">↝</span> <span class="free">y</span> <span class="main">=</span> top"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> implies_galois inf_top.left_neutral top_unique<span class="main">)</span>

<span class="keyword1" id="P_Algebras-inf_implies"><span class="command">lemma</span></span> inf_implies <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">↝</span> <span class="free">x</span> <span class="main">=</span> top"</span></span>
  <span class="keyword1"><span class="command">using</span></span> implies_order inf_le1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="P_Algebras-top_implies"><span class="command">lemma</span></span> top_implies <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"top <span class="main">↝</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> implies_mp_eq inf_top.left_neutral<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Heyting Lattices›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We obtain further properties if the underlying structure is a lattice.
In particular, the lattice operations are automatically distributive in this case.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> heyting_lattice <span class="main">=</span> lattice <span class="main">+</span> heyting_semilattice
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="P_Algebras-sup_distrib_inf_le"><span class="command">lemma</span></span> sup_distrib_inf_le<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">z</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊔</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">↝</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> implies_galois_var implies_increasing sup.bounded_iff sup.cobounded2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">z</span><span class="main">)</span> <span class="main">↝</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> implies_galois_swap implies_increasing le_sup_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> implies_galois<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subclass</span></span> distrib_lattice
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command">using</span></span> distrib_sup_le order.eq_iff sup_distrib_inf_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="P_Algebras-implies_isotone_sup"><span class="command">lemma</span></span> implies_isotone_sup<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">↝</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">↝</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊔</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> implies_isotone<span class="main">)</span>

<span class="keyword1" id="P_Algebras-implies_antitone_sup"><span class="command">lemma</span></span> implies_antitone_sup<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">↝</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">↝</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> implies_antitone<span class="main">)</span>

<span class="keyword1" id="P_Algebras-implies_sup"><span class="command">lemma</span></span> implies_sup<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">↝</span> <span class="free">z</span> <span class="main">≤</span> <span class="main">(</span><span class="free">y</span> <span class="main">↝</span> <span class="free">z</span><span class="main">)</span> <span class="main">↝</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">↝</span> <span class="free">z</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">↝</span> <span class="free">z</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">y</span> <span class="main">↝</span> <span class="free">z</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> implies_galois<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">↝</span> <span class="free">z</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">y</span> <span class="main">↝</span> <span class="free">z</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> implies_galois_swap implies_galois_var <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> implies_galois<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="P_Algebras-implies_dist_sup"><span class="command">lemma</span></span> implies_dist_sup<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">↝</span> <span class="free">z</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">↝</span> <span class="free">z</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">y</span> <span class="main">↝</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order.antisym<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> implies_antitone<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> implies_sup implies_galois<span class="main">)</span>

<span class="keyword1" id="P_Algebras-implies_antitone_isotone"><span class="command">lemma</span></span> implies_antitone_isotone<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">↝</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">↝</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> implies_antitone_sup implies_dist_inf le_infI2<span class="main">)</span>

<span class="keyword1" id="P_Algebras-implies_antisymmetry"><span class="command">lemma</span></span> implies_antisymmetry<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">↝</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">y</span> <span class="main">↝</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">↝</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> implies_dist_sup implies_inf_absorb inf.commute<span class="main">)</span>

<span class="keyword1" id="P_Algebras-sup_inf_implies"><span class="command">lemma</span></span> sup_inf_implies <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">x</span> <span class="main">↝</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_sup_distrib2 sup.absorb2<span class="main">)</span>

<span class="keyword1" id="P_Algebras-implies_subdist_sup"><span class="command">lemma</span></span> implies_subdist_sup<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">↝</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">x</span> <span class="main">↝</span> <span class="free">z</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">↝</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊔</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> implies_isotone<span class="main">)</span>

<span class="keyword1" id="P_Algebras-implies_subdist_inf"><span class="command">lemma</span></span> implies_subdist_inf<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">↝</span> <span class="free">z</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">y</span> <span class="main">↝</span> <span class="free">z</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">↝</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> implies_antitone<span class="main">)</span>

<span class="keyword1" id="P_Algebras-implies_sup_absorb"><span class="command">lemma</span></span> implies_sup_absorb<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">↝</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊔</span> <span class="free">z</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">z</span><span class="main">)</span> <span class="main">↝</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊔</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> implies_dist_sup implies_isotone_sup implies_increasing inf_inf_implies le_sup_iff sup_inf_implies<span class="main">)</span>

<span class="keyword1" id="P_Algebras-sup_below_implies_implies"><span class="command">lemma</span></span> sup_below_implies_implies<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">↝</span> <span class="free">y</span><span class="main">)</span> <span class="main">↝</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> implies_dist_sup implies_galois_swap implies_increasing<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">class</span></span> bounded_heyting_lattice <span class="main">=</span> bounded_lattice <span class="main">+</span> heyting_lattice
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subclass</span></span> bounded_heyting_semilattice <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1" id="P_Algebras-implies_bot"><span class="command">lemma</span></span> implies_bot <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"bot <span class="main">↝</span> <span class="free">x</span> <span class="main">=</span> top"</span></span>
  <span class="keyword1"><span class="command">using</span></span> implies_galois top_unique <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Heyting Algebras›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The pseudocomplement operation can be defined in Heyting algebras, but it is typically not part of their signature.
We add the definition as an axiom so that we can use the class hierarchy, for example, to inherit results from the class <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>pd_algebra›</span></span></span></span>.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> heyting_algebra <span class="main">=</span> bounded_heyting_lattice <span class="main">+</span> uminus <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> uminus_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">x</span> <span class="main">=</span> <span class="free">x</span> <span class="main">↝</span> bot"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subclass</span></span> pd_algebra
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command">using</span></span> bot_unique implies_galois uminus_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="P_Algebras-boolean_implies_below"><span class="command">lemma</span></span> boolean_implies_below<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">↝</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> implies_increasing implies_isotone uminus_eq<span class="main">)</span>

<span class="keyword1" id="P_Algebras-negation_implies"><span class="command">lemma</span></span> negation_implies<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">↝</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">-</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> order.antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">↝</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> boolean_implies_below p_antitone <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">y</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">x</span> <span class="main">↝</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> implies_mp_eq inf_p inf_bot_left inf_commute inf_left_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">-</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">y</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">x</span> <span class="main">↝</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">using</span></span> pp_inf_bot_iff inf_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">-</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">y</span> <span class="main">≤</span> <span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">↝</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pseudo_complement<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="P_Algebras-double_negation_dist_implies"><span class="command">lemma</span></span> double_negation_dist_implies<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">↝</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">-</span><span class="free">x</span> <span class="main">↝</span> <span class="main">-</span><span class="main">-</span><span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order.antisym<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> pp_inf_below_iff implies_galois_decreasing implies_galois negation_implies ppp<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p_antitone_iff negation_implies<span class="main">)</span>

<span class="comment1">(*
lemma stone: "-x ⊔ --x = top" nitpick [expect=genuine] oops
*)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following class gives equational axioms for Heyting algebras.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> heyting_algebra_eq <span class="main">=</span> bounded_lattice <span class="main">+</span> implies <span class="main">+</span> uminus <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> implies_mp_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">x</span> <span class="main">↝</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> implies_import_inf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊓</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">↝</span> <span class="main">(</span><span class="free">x</span> <span class="main">↝</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">y</span> <span class="main">↝</span> <span class="free">z</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> inf_inf_implies<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">⊓</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">↝</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">z</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> uminus_eq_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">x</span> <span class="main">=</span> <span class="free">x</span> <span class="main">↝</span> bot"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subclass</span></span> heyting_algebra
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> implies_import_inf inf.sup_left_divisibility inf_inf_implies le_iff_inf<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> implies_mp_eq inf.commute inf.le_sup_iff inf.sup_right_isotone<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> uminus_eq_eq<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
A relative pseudocomplement is not enough to obtain the Stone equation, so we add it in the following class.
›</span></span>

<span class="keyword1"><span class="command">class</span></span> heyting_stone_algebra <span class="main">=</span> heyting_algebra <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> heyting_stone<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="main">-</span><span class="free">x</span> <span class="main">=</span> top"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subclass</span></span> stone_algebra
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> heyting_stone<span class="main">)</span>

<span class="comment1">(*
lemma pre_linear: "(x ↝ y) ⊔ (y ↝ x) = top" nitpick [expect=genuine] oops
*)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Brouwer Algebras›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Brouwer algebras are dual to Heyting algebras.
The dual pseudocomplement of an element <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>y›</span></span></span></span> relative to an element <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>x›</span></span></span></span> is the least element whose join with <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>y›</span></span></span></span> is above <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>x›</span></span></span></span>.
We can now use the binary operation provided by Boolean algebras in Isabelle/HOL because it is compatible with dual relative pseudocomplements (not relative pseudocomplements).
›</span></span>

<span class="keyword1"><span class="command">class</span></span> brouwer_algebra <span class="main">=</span> bounded_lattice <span class="main">+</span> minus <span class="main">+</span> uminus <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> minus_galois<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⊔</span> <span class="free">z</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">-</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> uminus_eq_minus<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">x</span> <span class="main">=</span> top <span class="main">-</span> <span class="free">x</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> brouwer<span class="main">:</span> heyting_algebra <span class="keyword2"><span class="keyword">where</span></span> inf <span class="main">=</span> <span class="quoted">sup</span> <span class="keyword2"><span class="keyword">and</span></span> less_eq <span class="main">=</span> <span class="quoted">greater_eq</span> <span class="keyword2"><span class="keyword">and</span></span> less <span class="main">=</span> <span class="quoted">greater</span> <span class="keyword2"><span class="keyword">and</span></span> sup <span class="main">=</span> <span class="quoted">inf</span> <span class="keyword2"><span class="keyword">and</span></span> bot <span class="main">=</span> <span class="quoted">top</span> <span class="keyword2"><span class="keyword">and</span></span> top <span class="main">=</span> <span class="quoted">bot</span> <span class="keyword2"><span class="keyword">and</span></span> implies <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span> <span class="main">.</span> <span class="bound">y</span> <span class="main">-</span> <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> minus_galois sup_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> uminus_eq_minus<span class="main">)</span>

<span class="keyword1" id="P_Algebras-curry_minus"><span class="command">lemma</span></span> curry_minus<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">-</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊔</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">y</span><span class="main">)</span> <span class="main">-</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> brouwer.implies_curry sup_commute<span class="main">)</span>

<span class="keyword1" id="P_Algebras-minus_subdist_sup"><span class="command">lemma</span></span> minus_subdist_sup<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">y</span> <span class="main">-</span> <span class="free">z</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">-</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> brouwer.implies_dist_inf<span class="main">)</span>

<span class="keyword1" id="P_Algebras-inf_sup_minus"><span class="command">lemma</span></span> inf_sup_minus<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf.absorb1 brouwer.inf_sup_distrib2<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Boolean Algebras›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
This section integrates Boolean algebras in the above hierarchy.
In particular, we strengthen several results shown above.
›</span></span>

<span class="keyword1"><span class="command">context</span></span> boolean_algebra
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Every Boolean algebra is a Stone algebra, a Heyting algebra and a Brouwer algebra.
›</span></span>

<span class="keyword1"><span class="command">subclass</span></span> stone_algebra
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> compl_sup_top inf.orderI inf_bot_right inf_sup_distrib1 inf_top_right sup_inf_absorb<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> inf.commute inf.sup_right_divisibility <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">sublocale</span></span> heyting<span class="main">:</span> heyting_algebra <span class="keyword2"><span class="keyword">where</span></span> implies <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span> <span class="main">.</span> <span class="main">-</span><span class="bound">x</span> <span class="main">⊔</span> <span class="bound">y</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> shunting_var_p sup_commute <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">using</span></span> shunting_var_p sup_commute <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">subclass</span></span> brouwer_algebra
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> diff_eq shunting_var_p sup.commute<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> diff_eq<span class="main">)</span>

<span class="keyword1" id="P_Algebras-huntington_3"><span class="command">lemma</span></span> huntington_3 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="main">-</span><span class="free">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="free">y</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">-</span><span class="main">(</span><span class="main">-</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> huntington_3_pp <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="P_Algebras-maddux_3_1"><span class="command">lemma</span></span> maddux_3_1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="free">x</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⊔</span> <span class="main">-</span><span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="P_Algebras-maddux_3_4"><span class="command">lemma</span></span> maddux_3_4<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">y</span> <span class="main">⊔</span> <span class="main">-</span><span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">z</span> <span class="main">⊔</span> <span class="main">-</span><span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="P_Algebras-maddux_3_11"><span class="command">lemma</span></span> maddux_3_11 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> brouwer.maddux_3_12 sup.commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="P_Algebras-maddux_3_19"><span class="command">lemma</span></span> maddux_3_19<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="main">-</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> maddux_3_19_pp <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="P_Algebras-compl_inter_eq"><span class="command">lemma</span></span> compl_inter_eq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⊓</span> <span class="free">z</span> <span class="main">⟹</span> <span class="main">-</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">=</span> <span class="main">-</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">z</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">=</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_commute maddux_3_11<span class="main">)</span>

<span class="keyword1" id="P_Algebras-maddux_3_21"><span class="command">lemma</span></span> maddux_3_21 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">-</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup_inf_distrib1<span class="main">)</span>

<span class="keyword1" id="P_Algebras-shunting_1"><span class="command">lemma</span></span> shunting_1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">y</span> <span class="main">=</span> bot"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pseudo_complement<span class="main">)</span>

<span class="keyword1" id="P_Algebras-uminus_involutive"><span class="command">lemma</span></span> uminus_involutive<span class="main">:</span>
  <span class="quoted"><span class="quoted">"uminus <span class="main">∘</span> uminus <span class="main">=</span> id"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="P_Algebras-uminus_injective"><span class="command">lemma</span></span> uminus_injective<span class="main">:</span>
  <span class="quoted"><span class="quoted">"uminus <span class="main">∘</span> <span class="free">f</span> <span class="main">=</span> uminus <span class="main">∘</span> <span class="free">g</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">=</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_assoc id_o minus_comp_minus<span class="main">)</span>

<span class="keyword1" id="P_Algebras-conjugate_unique"><span class="command">lemma</span></span> conjugate_unique<span class="main">:</span>
  <span class="quoted"><span class="quoted">"conjugate <span class="free">f</span> <span class="free">g</span> <span class="main">⟹</span> conjugate <span class="free">f</span> <span class="free">h</span> <span class="main">⟹</span> <span class="free">g</span> <span class="main">=</span> <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> conjugate_unique_p uminus_injective <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="P_Algebras-dual_additive_additive"><span class="command">lemma</span></span> dual_additive_additive<span class="main">:</span>
  <span class="quoted"><span class="quoted">"dual_additive <span class="main">(</span>uminus <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="main">⟹</span> additive <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> additive_def compl_eq_compl_iff dual_additive_def p_dist_sup o_def<span class="main">)</span>

<span class="keyword1" id="P_Algebras-conjugate_additive"><span class="command">lemma</span></span> conjugate_additive<span class="main">:</span>
  <span class="quoted"><span class="quoted">"conjugate <span class="free">f</span> <span class="free">g</span> <span class="main">⟹</span> additive <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conjugate_dual_additive dual_additive_additive<span class="main">)</span>

<span class="keyword1" id="P_Algebras-conjugate_isotone"><span class="command">lemma</span></span> conjugate_isotone<span class="main">:</span>
  <span class="quoted"><span class="quoted">"conjugate <span class="free">f</span> <span class="free">g</span> <span class="main">⟹</span> isotone <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conjugate_additive additive_isotone<span class="main">)</span>

<span class="keyword1" id="P_Algebras-conjugate_char_1"><span class="command">lemma</span></span> conjugate_char_1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"conjugate <span class="free">f</span> <span class="free">g</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span> <span class="main">.</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">g</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="bound">y</span> <span class="main">∧</span> <span class="free">g</span><span class="main">(</span><span class="bound">y</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">g</span> <span class="bound">y</span> <span class="main">⊓</span> <span class="main">-</span><span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conjugate_char_1_pp<span class="main">)</span>

<span class="keyword1" id="P_Algebras-conjugate_char_2"><span class="command">lemma</span></span> conjugate_char_2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"conjugate <span class="free">f</span> <span class="free">g</span> <span class="main">⟷</span> <span class="free">f</span> bot <span class="main">=</span> bot <span class="main">∧</span> <span class="free">g</span> bot <span class="main">=</span> bot <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">⊓</span> <span class="bound">y</span> <span class="main">≤</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span> <span class="main">⊓</span> <span class="free">g</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∧</span> <span class="free">g</span> <span class="bound">y</span> <span class="main">⊓</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">g</span><span class="main">(</span><span class="bound">y</span> <span class="main">⊓</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conjugate_char_2_pp<span class="main">)</span>

<span class="keyword1" id="P_Algebras-shunting"><span class="command">lemma</span></span> shunting<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⊔</span> <span class="main">-</span><span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> heyting.implies_galois sup.commute<span class="main">)</span>

<span class="keyword1" id="P_Algebras-shunting_var"><span class="command">lemma</span></span> shunting_var<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="free">y</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⊔</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> shunting<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">class</span></span> non_trivial_stone_algebra <span class="main">=</span> non_trivial_bounded_order <span class="main">+</span> stone_algebra

<span class="keyword1"><span class="command">class</span></span> non_trivial_boolean_algebra <span class="main">=</span> non_trivial_stone_algebra <span class="main">+</span> boolean_algebra

<span class="keyword2"><span class="keyword">end</span></span>

</pre>
</div><div id="Filters">
<div class="head">
<h1>Theory Filters</h1>
</div>
<pre class="source"><span class="comment1">(* Title:      Filters
   Author:     Walter Guttmann
   Maintainer: Walter Guttmann &lt;walter.guttmann at canterbury.ac.nz&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Filters›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
This theory develops filters based on orders, semilattices, lattices and distributive lattices.
We prove the ultrafilter lemma for orders with a least element.
We show the following structure theorems:
\begin{itemize}
\item The set of filters over a directed semilattice forms a lattice with a greatest element.
\item The set of filters over a bounded semilattice forms a bounded lattice.
\item The set of filters over a distributive lattice with a greatest element forms a bounded distributive lattice.
\end{itemize}
Another result is that in a distributive lattice ultrafilters are prime filters.
We also prove a lemma of Gr\"atzer and Schmidt about principal filters.

We apply these results in proving the construction theorem for Stone algebras (described in a separate theory).
See, for example, \cite{BalbesDwinger1974,Birkhoff1967,Blyth2005,DaveyPriestley2002,Graetzer1971} for further results about filters.
›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Filters

<span class="keyword2"><span class="keyword">imports</span></span> <a href="#Lattice_Basics">Lattice_Basics</a>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Orders›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
This section gives the basic definitions related to filters in terms of orders.
The main result is the ultrafilter lemma.
›</span></span>

<span class="keyword1"><span class="command">context</span></span> ord
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">down</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">↓</span>_"</span> <span class="main">[</span>81<span class="main">]</span> 80<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">↓</span></span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="main">{</span> <span class="bound">y</span> <span class="main">.</span> <span class="bound">y</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">down_set</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⇓</span>_"</span> <span class="main">[</span>81<span class="main">]</span> 80<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">⇓</span></span><span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">≡</span> <span class="main">{</span> <span class="bound">y</span> <span class="main">.</span> <span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">.</span> <span class="bound">y</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">is_down_set</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_down_set</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">.</span> <span class="main">∀</span><span class="bound">y</span> <span class="main">.</span> <span class="bound">y</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">⟶</span> <span class="bound">y</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">X</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">is_principal_down</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_principal_down</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">≡</span> <span class="main">∃</span><span class="bound">x</span> <span class="main">.</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">=</span> <span class="main">↓</span><span class="bound">x</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">up</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">↑</span>_"</span> <span class="main">[</span>81<span class="main">]</span> 80<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">↑</span></span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="main">{</span> <span class="bound">y</span> <span class="main">.</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">up_set</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⇑</span>_"</span> <span class="main">[</span>81<span class="main">]</span> 80<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">⇑</span></span><span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">≡</span> <span class="main">{</span> <span class="bound">y</span> <span class="main">.</span> <span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">is_up_set</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_up_set</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">.</span> <span class="main">∀</span><span class="bound">y</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">⟶</span> <span class="bound">y</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">X</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">is_principal_up</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_principal_up</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">≡</span> <span class="main">∃</span><span class="bound">x</span> <span class="main">.</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">=</span> <span class="main">↑</span><span class="bound">x</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
A filter is a non-empty, downward directed, up-closed set.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">filter</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">filter</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">≠</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">.</span> <span class="main">∃</span><span class="bound">z</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">.</span> <span class="bound">z</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">≤</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∧</span> is_up_set <span class="free"><span class="bound"><span class="entity">F</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">proper_filter</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">proper_filter</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">≡</span> filter <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">≠</span> UNIV"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">ultra_filter</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">ultra_filter</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">≡</span> proper_filter <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">G</span> <span class="main">.</span> proper_filter <span class="bound">G</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">⊆</span> <span class="bound">G</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">=</span> <span class="bound">G</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">filters</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">filters</span> <span class="main">≡</span> <span class="main">{</span> <span class="bound">F</span><span class="main">::</span><span class="tfree">'a</span> set <span class="main">.</span> filter <span class="bound">F</span> <span class="main">}</span>"</span></span>

<span class="keyword1" id="Filters-filter_map_filter"><span class="command">lemma</span></span> filter_map_filter<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"filter <span class="free">F</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"mono <span class="free">f</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">z</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">z</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">z</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"filter <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">F</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> ord_class.filter_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="free">F</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> ord_class.filter_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">f</span> <span class="main">`</span> <span class="free">F</span> <span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="free">f</span> <span class="main">`</span> <span class="free">F</span> <span class="main">.</span> <span class="main">∃</span><span class="bound">z</span><span class="main">∈</span><span class="free">f</span> <span class="main">`</span> <span class="free">F</span> <span class="main">.</span> <span class="bound">z</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">≤</span> <span class="bound">y</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ballI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">u</span> <span class="main">∧</span> <span class="skolem">u</span> <span class="main">∈</span> <span class="free">F</span> <span class="main">∧</span> <span class="skolem">y</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">v</span> <span class="main">∧</span> <span class="skolem">v</span> <span class="main">∈</span> <span class="free">F</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">≤</span> <span class="skolem">u</span> <span class="main">∧</span> <span class="skolem">w</span> <span class="main">≤</span> <span class="skolem">v</span> <span class="main">∧</span> <span class="skolem">w</span> <span class="main">∈</span> <span class="free">F</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> ord_class.filter_def<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">z</span><span class="main">∈</span><span class="free">f</span> <span class="main">`</span> <span class="free">F</span> <span class="main">.</span> <span class="bound">z</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 assms<span class="main">(</span>2<span class="main">)</span> mono_def image_eqI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_up_set <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">F</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">u</span> <span class="main">∧</span> <span class="skolem">u</span> <span class="main">∈</span> <span class="free">F</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span> <span class="main">.</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">u</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≤</span> <span class="skolem">z</span> <span class="main">∧</span> <span class="skolem">y</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">z</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="free">F</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> 1 assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> image_iff ord_class.filter_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> order
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Filters-self_in_downset"><span class="command">lemma</span></span> self_in_downset <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">↓</span><span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Filters-self_in_upset"><span class="command">lemma</span></span> self_in_upset <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">↑</span><span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Filters-up_filter"><span class="command">lemma</span></span> up_filter <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"filter <span class="main">(</span><span class="main">↑</span><span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> filter_def order_lesseq_imp <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Filters-up_set_up_set"><span class="command">lemma</span></span> up_set_up_set <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"is_up_set <span class="main">(</span><span class="main">⇑</span><span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> order.trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Filters-up_injective"><span class="command">lemma</span></span> up_injective<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">↑</span><span class="free">x</span> <span class="main">=</span> <span class="main">↑</span><span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> order.antisym <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Filters-up_antitone"><span class="command">lemma</span></span> up_antitone<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟷</span> <span class="main">↑</span><span class="free">y</span> <span class="main">⊆</span> <span class="main">↑</span><span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> order_bot
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Filters-bot_in_downset"><span class="command">lemma</span></span> bot_in_downset <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"bot <span class="main">∈</span> <span class="main">↓</span><span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Filters-down_bot"><span class="command">lemma</span></span> down_bot <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">↓</span>bot <span class="main">=</span> <span class="main">{</span>bot<span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bot_unique<span class="main">)</span>

<span class="keyword1" id="Filters-up_bot"><span class="command">lemma</span></span> up_bot <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">↑</span>bot <span class="main">=</span> UNIV"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following result is the ultrafilter lemma, generalised from \cite[10.17]{DaveyPriestley2002} to orders with a least element.
Its proof uses Isabelle/HOL's <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Zorn_Lemma›</span></span></span></span>, which requires closure under union of arbitrary (possibly empty) chains.
Actually, the proof does not use any of the underlying order properties except <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>bot_least›</span></span></span></span>.
›</span></span>

<span class="keyword1" id="Filters-ultra_filter"><span class="command">lemma</span></span> ultra_filter<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"proper_filter <span class="free">F</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">G</span> <span class="main">.</span> ultra_filter <span class="bound">G</span> <span class="main">∧</span> <span class="free">F</span> <span class="main">⊆</span> <span class="bound">G</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span> <span class="bound">G</span> <span class="main">.</span> <span class="main">(</span>proper_filter <span class="bound">G</span> <span class="main">∧</span> <span class="free">F</span> <span class="main">⊆</span> <span class="bound">G</span><span class="main">)</span> <span class="main">∨</span> <span class="bound">G</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">C</span> <span class="main">∈</span> chains <span class="var">?A</span> <span class="main">.</span> <span class="main">⋃</span><span class="bound">C</span> <span class="main">∈</span> <span class="var">?A</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">C</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set set"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?D</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">-</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">∈</span> chains <span class="var">?A</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">⋃</span><span class="var">?D</span> <span class="main">.</span> <span class="main">∃</span><span class="bound">H</span><span class="main">∈</span><span class="var">?D</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="bound">H</span> <span class="main">∧</span> proper_filter <span class="bound">H</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> chainsD2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="var">?D</span> <span class="main">=</span> <span class="main">⋃</span><span class="skolem">C</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="var">?D</span> <span class="main">∈</span> <span class="var">?A</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="var">?D</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?D</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?D</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">G</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">∈</span> <span class="var">?D</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="main">⋃</span><span class="var">?D</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 1 chainsD2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> 6<span class="main">:</span> <span class="quoted"><span class="quoted">"is_up_set <span class="main">(</span><span class="main">⋃</span><span class="var">?D</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">⋃</span><span class="var">?D</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">H</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">H</span> <span class="main">∧</span> <span class="skolem">H</span> <span class="main">∈</span> <span class="var">?D</span> <span class="main">∧</span> filter <span class="skolem">H</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span> <span class="main">.</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">⟶</span> <span class="bound">y</span><span class="main">∈</span><span class="main">⋃</span><span class="var">?D</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> filter_def UnionI <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> 7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="var">?D</span> <span class="main">≠</span> UNIV"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">⋃</span><span class="var">?D</span> <span class="main">≠</span> UNIV"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">H</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"bot <span class="main">∈</span> <span class="skolem">H</span> <span class="main">∧</span> proper_filter <span class="skolem">H</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> UNIV_I bot_least filter_def subsetI subset_antisym<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="main">⋃</span><span class="var">?D</span> <span class="main">∧</span> <span class="skolem">y</span><span class="main">∈</span><span class="main">⋃</span><span class="var">?D</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">H</span></span> <span class="skolem"><span class="skolem">I</span></span> <span class="keyword2"><span class="keyword">where</span></span> 8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">H</span> <span class="main">∧</span> <span class="skolem">H</span> <span class="main">∈</span> <span class="var">?D</span> <span class="main">∧</span> filter <span class="skolem">H</span> <span class="main">∧</span> <span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">I</span> <span class="main">∧</span> <span class="skolem">I</span> <span class="main">∈</span> <span class="var">?D</span> <span class="main">∧</span> filter <span class="skolem">I</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">z</span><span class="main">∈</span><span class="main">⋃</span><span class="var">?D</span> <span class="main">.</span> <span class="bound">z</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">⊆</span> <span class="skolem">I</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">⊆</span> <span class="skolem">I</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">z</span><span class="main">∈</span><span class="skolem">I</span> <span class="main">.</span> <span class="bound">z</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> 8 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> subsetCE filter_def<span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> 8 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> UnionI<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="skolem">H</span> <span class="main">⊆</span> <span class="skolem">I</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span> <span class="main">⊆</span> <span class="skolem">H</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> 1 8 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> DiffE chainsD<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">z</span><span class="main">∈</span><span class="skolem">H</span> <span class="main">.</span> <span class="bound">z</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> 8 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> subsetCE filter_def<span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> 8 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> UnionI<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> 4 5 6 7 filter_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="skolem">C</span> <span class="main">∈</span> <span class="var">?A</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">M</span><span class="main">∈</span><span class="var">?A</span> <span class="main">.</span> <span class="main">∀</span><span class="bound">X</span><span class="main">∈</span><span class="var">?A</span> <span class="main">.</span> <span class="bound">M</span> <span class="main">⊆</span> <span class="bound">X</span> <span class="main">⟶</span> <span class="bound">X</span> <span class="main">=</span> <span class="bound">M</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Zorn_Lemma<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">M</span></span> <span class="keyword2"><span class="keyword">where</span></span> 9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">∈</span> <span class="var">?A</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">X</span><span class="main">∈</span><span class="var">?A</span> <span class="main">.</span> <span class="skolem">M</span> <span class="main">⊆</span> <span class="bound">X</span> <span class="main">⟶</span> <span class="bound">X</span> <span class="main">=</span> <span class="skolem">M</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> 10<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms filter_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">G</span>
    <span class="keyword3"><span class="command">assume</span></span> 11<span class="main">:</span> <span class="quoted"><span class="quoted">"proper_filter <span class="skolem">G</span> <span class="main">∧</span> <span class="skolem">M</span> <span class="main">⊆</span> <span class="skolem">G</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="skolem">G</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 9 10 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">=</span> <span class="skolem">G</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 9 11 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> 9 10 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> order_top
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Filters-down_top"><span class="command">lemma</span></span> down_top <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">↓</span>top <span class="main">=</span> UNIV"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Filters-top_in_upset"><span class="command">lemma</span></span> top_in_upset <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"top <span class="main">∈</span> <span class="main">↑</span><span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Filters-up_top"><span class="command">lemma</span></span> up_top <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">↑</span>top <span class="main">=</span> <span class="main">{</span>top<span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> top_unique<span class="main">)</span>

<span class="keyword1" id="Filters-filter_top"><span class="command">lemma</span></span> filter_top <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"filter <span class="main">{</span>top<span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> filter_def top_unique <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Filters-top_in_filter"><span class="command">lemma</span></span> top_in_filter <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"filter <span class="free">F</span> <span class="main">⟹</span> top <span class="main">∈</span> <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> filter_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The existence of proper filters and ultrafilters requires that the underlying order contains at least two elements.
›</span></span>

<span class="keyword1"><span class="command">context</span></span> non_trivial_order
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Filters-proper_filter_exists"><span class="command">lemma</span></span> proper_filter_exists<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">F</span> <span class="main">.</span> proper_filter <span class="bound">F</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> consistent <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">↑</span><span class="skolem">x</span> <span class="main">≠</span> UNIV <span class="main">∨</span> <span class="main">↑</span><span class="skolem">y</span> <span class="main">≠</span> UNIV"</span></span>
    <span class="keyword1"><span class="command">using</span></span> order.antisym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"proper_filter <span class="main">(</span><span class="main">↑</span><span class="skolem">x</span><span class="main">)</span> <span class="main">∨</span> proper_filter <span class="main">(</span><span class="main">↑</span><span class="skolem">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> non_trivial_order_bot
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Filters-ultra_filter_exists"><span class="command">lemma</span></span> ultra_filter_exists<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">F</span> <span class="main">.</span> ultra_filter <span class="bound">F</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ultra_filter proper_filter_exists <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> non_trivial_bounded_order
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Filters-proper_filter_top"><span class="command">lemma</span></span> proper_filter_top<span class="main">:</span>
  <span class="quoted"><span class="quoted">"proper_filter <span class="main">{</span>top<span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> bot_not_top filter_top <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Filters-ultra_filter_top"><span class="command">lemma</span></span> ultra_filter_top<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">G</span> <span class="main">.</span> ultra_filter <span class="bound">G</span> <span class="main">∧</span> top <span class="main">∈</span> <span class="bound">G</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ultra_filter proper_filter_top <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Lattices›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
This section develops the lattice structure of filters based on a semilattice structure of the underlying order.
The main results are that filters over a directed semilattice form a lattice with a greatest element and that filters over a bounded semilattice form a bounded lattice.
›</span></span>

<span class="keyword1"><span class="command">context</span></span> semilattice_sup
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">prime_filter</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">prime_filter</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">≡</span> proper_filter <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">⊔</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">⟶</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">∨</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> semilattice_inf
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Filters-filter_inf_closed"><span class="command">lemma</span></span> filter_inf_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"filter <span class="free">F</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">F</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">F</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> filter_def inf.boundedI<span class="main">)</span>

<span class="keyword1" id="Filters-filter_univ"><span class="command">lemma</span></span> filter_univ<span class="main">:</span>
  <span class="quoted"><span class="quoted">"filter UNIV"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> UNIV_I UNIV_not_empty filter_def inf.cobounded1 inf.cobounded2<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The operation <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>filter_sup›</span></span></span></span> is the join operation in the lattice of filters.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">filter_sup</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">≡</span> <span class="main">{</span> <span class="bound">z</span> <span class="main">.</span> <span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">.</span> <span class="main">∃</span><span class="bound">y</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">.</span> <span class="bound">x</span> <span class="main">⊓</span> <span class="bound">y</span> <span class="main">≤</span> <span class="bound">z</span> <span class="main">}</span>"</span></span>

<span class="keyword1" id="Filters-filter_sup"><span class="command">lemma</span></span> filter_sup<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"filter <span class="free">F</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"filter <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"filter <span class="main">(</span>filter_sup <span class="free">F</span> <span class="free">G</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> <span class="free">G</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms filter_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"filter_sup <span class="free">F</span> <span class="free">G</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> filter_sup_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>filter_sup <span class="free">F</span> <span class="free">G</span> <span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span>filter_sup <span class="free">F</span> <span class="free">G</span> <span class="main">.</span> <span class="main">∃</span><span class="bound">z</span><span class="main">∈</span>filter_sup <span class="free">F</span> <span class="free">G</span> <span class="main">.</span> <span class="bound">z</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">≤</span> <span class="bound">y</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span>filter_sup <span class="free">F</span> <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="free">F</span> <span class="main">∧</span> <span class="skolem">u</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">∧</span> <span class="skolem">t</span> <span class="main">⊓</span> <span class="skolem">u</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> filter_sup_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">∈</span>filter_sup <span class="free">F</span> <span class="free">G</span> <span class="main">.</span> <span class="main">∃</span><span class="bound">z</span><span class="main">∈</span>filter_sup <span class="free">F</span> <span class="free">G</span> <span class="main">.</span> <span class="bound">z</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">≤</span> <span class="bound">y</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">∈</span>filter_sup <span class="free">F</span> <span class="free">G</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="keyword2"><span class="keyword">where</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="free">F</span> <span class="main">∧</span> <span class="skolem">w</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">∧</span> <span class="skolem">v</span> <span class="main">⊓</span> <span class="skolem">w</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> filter_sup_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?z</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span> <span class="main">⊓</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="skolem">u</span> <span class="main">⊓</span> <span class="skolem">w</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?z</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">∧</span> <span class="var">?z</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 3 4 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> order.trans inf.cobounded1 inf.cobounded2 inf_mono<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?z</span> <span class="main">∈</span> filter_sup <span class="free">F</span> <span class="free">G</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> filter_sup_def <span class="keyword1"><span class="command">using</span></span> assms 3 4 filter_inf_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">z</span><span class="main">∈</span>filter_sup <span class="free">F</span> <span class="free">G</span> <span class="main">.</span> <span class="bound">z</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>filter_sup <span class="free">F</span> <span class="free">G</span> <span class="main">.</span> <span class="main">∀</span><span class="bound">y</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">∈</span> filter_sup <span class="free">F</span> <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> filter_sup_def <span class="keyword1"><span class="command">using</span></span> order_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 2 filter_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Filters-filter_sup_left_upper_bound"><span class="command">lemma</span></span> filter_sup_left_upper_bound<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"filter <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> filter_sup <span class="free">F</span> <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">∈</span><span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> all_not_in_conv filter_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> filter_sup_def <span class="keyword1"><span class="command">using</span></span> inf.cobounded1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Filters-filter_sup_symmetric"><span class="command">lemma</span></span> filter_sup_symmetric<span class="main">:</span>
  <span class="quoted"><span class="quoted">"filter_sup <span class="free">F</span> <span class="free">G</span> <span class="main">=</span> filter_sup <span class="free">G</span> <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> filter_sup_def <span class="keyword1"><span class="command">using</span></span> inf.commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Filters-filter_sup_right_upper_bound"><span class="command">lemma</span></span> filter_sup_right_upper_bound<span class="main">:</span>
  <span class="quoted"><span class="quoted">"filter <span class="free">F</span> <span class="main">⟹</span> <span class="free">G</span> <span class="main">⊆</span> filter_sup <span class="free">F</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> filter_sup_symmetric filter_sup_left_upper_bound <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Filters-filter_sup_least_upper_bound"><span class="command">lemma</span></span> filter_sup_least_upper_bound<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"filter <span class="free">H</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="free">H</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">⊆</span> <span class="free">H</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"filter_sup <span class="free">F</span> <span class="free">G</span> <span class="main">⊆</span> <span class="free">H</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> filter_sup <span class="free">F</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">F</span> <span class="main">∧</span> <span class="skolem">z</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">∧</span> <span class="skolem">y</span> <span class="main">⊓</span> <span class="skolem">z</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> filter_sup_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">H</span> <span class="main">∧</span> <span class="skolem">z</span> <span class="main">∈</span> <span class="free">H</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2-3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">⊓</span> <span class="skolem">z</span> <span class="main">∈</span> <span class="free">H</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> filter_inf_closed<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">H</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 assms<span class="main">(</span>1<span class="main">)</span> filter_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Filters-filter_sup_left_isotone"><span class="command">lemma</span></span> filter_sup_left_isotone<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">⊆</span> <span class="free">H</span> <span class="main">⟹</span> filter_sup <span class="free">G</span> <span class="free">F</span> <span class="main">⊆</span> filter_sup <span class="free">H</span> <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> filter_sup_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Filters-filter_sup_right_isotone"><span class="command">lemma</span></span> filter_sup_right_isotone<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">⊆</span> <span class="free">H</span> <span class="main">⟹</span> filter_sup <span class="free">F</span> <span class="free">G</span> <span class="main">⊆</span> filter_sup <span class="free">F</span> <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> filter_sup_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Filters-filter_sup_right_isotone_var"><span class="command">lemma</span></span> filter_sup_right_isotone_var<span class="main">:</span>
  <span class="quoted"><span class="quoted">"filter_sup <span class="free">F</span> <span class="main">(</span><span class="free">G</span> <span class="main">∩</span> <span class="free">H</span><span class="main">)</span> <span class="main">⊆</span> filter_sup <span class="free">F</span> <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> filter_sup_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Filters-up_dist_inf"><span class="command">lemma</span></span> up_dist_inf<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">↑</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> filter_sup <span class="main">(</span><span class="main">↑</span><span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="main">↑</span><span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">↑</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">⊆</span> filter_sup <span class="main">(</span><span class="main">↑</span><span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="main">↑</span><span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> filter_sup_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"filter_sup <span class="main">(</span><span class="main">↑</span><span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="main">↑</span><span class="free">y</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">↑</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> filter_sup <span class="main">(</span><span class="main">↑</span><span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="main">↑</span><span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span><span class="main">∈</span><span class="main">↑</span><span class="free">x</span> <span class="main">∧</span> <span class="skolem">v</span><span class="main">∈</span><span class="main">↑</span><span class="free">y</span> <span class="main">∧</span> <span class="skolem">u</span> <span class="main">⊓</span> <span class="skolem">v</span> <span class="main">≤</span> <span class="skolem">z</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> filter_sup_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">≤</span> <span class="skolem">z</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> order.trans inf_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="main">↑</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following result is part of \cite[Exercise 2.23]{DaveyPriestley2002}.
›</span></span>

<span class="keyword1" id="Filters-filter_inf_filter"><span class="command">lemma</span></span> filter_inf_filter <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"filter <span class="free">F</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"filter <span class="main">(</span><span class="main">⇑</span><span class="main">{</span> <span class="bound">y</span> <span class="main">.</span> <span class="main">∃</span><span class="bound">z</span><span class="main">∈</span><span class="free">F</span> <span class="main">.</span> <span class="free">x</span> <span class="main">⊓</span> <span class="bound">z</span> <span class="main">=</span> <span class="bound">y</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?G</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⇑</span><span class="main">{</span> <span class="bound">y</span> <span class="main">.</span> <span class="main">∃</span><span class="bound">z</span><span class="main">∈</span><span class="free">F</span> <span class="main">.</span> <span class="free">x</span> <span class="main">⊓</span> <span class="bound">z</span> <span class="main">=</span> <span class="bound">y</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms filter_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?G</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"is_up_set <span class="var">?G</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="skolem">z</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="var">?G</span> <span class="main">∧</span> <span class="skolem">z</span> <span class="main">∈</span> <span class="var">?G</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="free">F</span> <span class="main">∧</span> <span class="skolem">w</span> <span class="main">∈</span> <span class="free">F</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">⊓</span> <span class="skolem">v</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">⊓</span> <span class="skolem">w</span> <span class="main">≤</span> <span class="skolem">z</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">⊓</span> <span class="skolem">w</span> <span class="main">∈</span> <span class="free">F</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">⊓</span> <span class="main">(</span><span class="skolem">v</span> <span class="main">⊓</span> <span class="skolem">w</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">⊓</span> <span class="skolem">z</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms filter_inf_closed order.trans inf.boundedI inf.cobounded1 inf.cobounded2<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">u</span><span class="main">∈</span><span class="var">?G</span> <span class="main">.</span> <span class="bound">u</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">≤</span> <span class="skolem">z</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="var">?G</span> <span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="var">?G</span> <span class="main">.</span> <span class="main">∃</span><span class="bound">z</span><span class="main">∈</span><span class="var">?G</span> <span class="main">.</span> <span class="bound">z</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">≤</span> <span class="bound">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 2 filter_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> directed_semilattice_inf
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Set intersection is the meet operation in the lattice of filters.
›</span></span>

<span class="keyword1" id="Filters-filter_inf"><span class="command">lemma</span></span> filter_inf<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"filter <span class="free">F</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"filter <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"filter <span class="main">(</span><span class="free">F</span> <span class="main">∩</span> <span class="free">G</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> filter_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="free">F</span> <span class="main">∧</span> <span class="skolem">y</span><span class="main">∈</span><span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> all_not_in_conv filter_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> ub <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">z</span> <span class="main">∧</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="free">F</span> <span class="main">∩</span> <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms Int_iff filter_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">∩</span> <span class="free">G</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_up_set <span class="main">(</span><span class="free">F</span> <span class="main">∩</span> <span class="free">G</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms Int_iff filter_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">F</span> <span class="main">∩</span> <span class="free">G</span> <span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="free">F</span> <span class="main">∩</span> <span class="free">G</span> <span class="main">.</span> <span class="main">∃</span><span class="bound">z</span><span class="main">∈</span><span class="free">F</span> <span class="main">∩</span> <span class="free">G</span> <span class="main">.</span> <span class="bound">z</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">≤</span> <span class="bound">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms Int_iff filter_inf_closed inf.cobounded2 inf.commute<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We introduce the following type of filters to instantiate the lattice classes and thereby inherit the results shown about lattices.
›</span></span>

<span class="keyword1"><span class="command">typedef</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">overloaded</span></span><span class="main">)</span> <span class="tfree">'a</span> filter <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span> <span class="bound">F</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>order set <span class="main">.</span> filter <span class="bound">F</span> <span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> mem_Collect_eq up_filter<span class="main">)</span>

<span class="keyword1" id="Filters-simp_filter"><span class="command">lemma</span></span> simp_filter <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"filter <span class="main">(</span>Rep_filter <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Rep_filter <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">setup_lifting</span></span> type_definition_filter

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The set of filters over a directed semilattice forms a lattice with a greatest element.
›</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> filter <span class="main">::</span> <span class="main">(</span><span class="quoted">directed_semilattice_inf</span><span class="main">)</span> <span class="quoted">bounded_lattice_top</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">top_filter</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> filter"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">UNIV</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> filter_univ<span class="main">)</span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">sup_filter</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> filter <span class="main">⇒</span> <span class="tfree">'a</span> filter <span class="main">⇒</span> <span class="tfree">'a</span> filter"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">filter_sup</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> filter_sup<span class="main">)</span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">inf_filter</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> filter <span class="main">⇒</span> <span class="tfree">'a</span> filter <span class="main">⇒</span> <span class="tfree">'a</span> filter"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">inter</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> filter_inf<span class="main">)</span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">less_eq_filter</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> filter <span class="main">⇒</span> <span class="tfree">'a</span> filter <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">subset_eq</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">less_filter</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> filter <span class="main">⇒</span> <span class="tfree">'a</span> filter <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">subset</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">intro_classes</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_le_not_le<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> filter_sup_left_upper_bound<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> filter_sup_right_upper_bound<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> filter_sup_least_upper_bound<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> bounded_semilattice_inf_top
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">filter_complements</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">≡</span> filter <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">∧</span> filter <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">∧</span> filter_sup <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">=</span> UNIV <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">∩</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">=</span> <span class="main">{</span>top<span class="main">}</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The set of filters over a bounded semilattice forms a bounded lattice.
›</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> filter <span class="main">::</span> <span class="main">(</span><span class="quoted">bounded_semilattice_inf_top</span><span class="main">)</span> <span class="quoted">bounded_lattice</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">bot_filter</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> filter"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span>top<span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">intro_classes</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> lattice
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Filters-up_dist_sup"><span class="command">lemma</span></span> up_dist_sup<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">↑</span><span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">↑</span><span class="free">x</span> <span class="main">∩</span> <span class="main">↑</span><span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
For convenience, the following function injects principal filters into the filter type.
We cannot define it in the <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>order›</span></span></span></span> class since the type filter requires the sort constraint <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>order›</span></span></span></span> that is not available in the class.
The result of the function is a filter by lemma <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>up_filter›</span></span></span></span>.
›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">up_filter</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>order <span class="main">⇒</span> <span class="tfree">'a</span> filter"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">up_filter</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> Abs_filter <span class="main">(</span><span class="main">↑</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Filters-up_filter_dist_inf"><span class="command">lemma</span></span> up_filter_dist_inf<span class="main">:</span>
  <span class="quoted"><span class="quoted">"up_filter <span class="main">(</span><span class="main">(</span><span class="free">x</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>lattice<span class="main">)</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> up_filter <span class="free">x</span> <span class="main">⊔</span> up_filter <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_onp_def sup_filter.abs_eq up_dist_inf<span class="main">)</span>

<span class="keyword1" id="Filters-up_filter_dist_sup"><span class="command">lemma</span></span> up_filter_dist_sup<span class="main">:</span>
  <span class="quoted"><span class="quoted">"up_filter <span class="main">(</span><span class="main">(</span><span class="free">x</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>lattice<span class="main">)</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> up_filter <span class="free">x</span> <span class="main">⊓</span> up_filter <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> eq_onp_def inf_filter.abs_eq up_dist_sup up_filter<span class="main">)</span>

<span class="keyword1" id="Filters-up_filter_injective"><span class="command">lemma</span></span> up_filter_injective<span class="main">:</span>
  <span class="quoted"><span class="quoted">"up_filter <span class="free">x</span> <span class="main">=</span> up_filter <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Abs_filter_inject mem_Collect_eq up_filter up_injective<span class="main">)</span>

<span class="keyword1" id="Filters-up_filter_antitone"><span class="command">lemma</span></span> up_filter_antitone<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟷</span> up_filter <span class="free">y</span> <span class="main">≤</span> up_filter <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> eq_onp_same_args less_eq_filter.abs_eq up_antitone up_filter<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following definition applies a function to each element of a filter.
The subsequent lemma gives conditions under which the result of this application is a filter.
›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">filter_map</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>order <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>order<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> filter <span class="main">⇒</span> <span class="tfree">'b</span> filter"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">filter_map</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">≡</span> Abs_filter <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">`</span> Rep_filter <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Filters-filter_map_filter"><span class="command">lemma</span></span> filter_map_filter<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mono <span class="free">f</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">z</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">z</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">z</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"filter <span class="main">(</span><span class="free">f</span> <span class="main">`</span> Rep_filter <span class="free">F</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms inf.filter_map_filter<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Distributive Lattices›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
In this section we additionally assume that the underlying order forms a distributive lattice.
Then filters form a bounded distributive lattice if the underlying order has a greatest element.
Moreover ultrafilters are prime filters.
We also prove a lemma of Gr\"atzer and Schmidt about principal filters.
›</span></span>

<span class="keyword1"><span class="command">context</span></span> distrib_lattice
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Filters-filter_sup_left_dist_inf"><span class="command">lemma</span></span> filter_sup_left_dist_inf<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"filter <span class="free">F</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"filter <span class="free">G</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"filter <span class="free">H</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"filter_sup <span class="free">F</span> <span class="main">(</span><span class="free">G</span> <span class="main">∩</span> <span class="free">H</span><span class="main">)</span> <span class="main">=</span> filter_sup <span class="free">F</span> <span class="free">G</span> <span class="main">∩</span> filter_sup <span class="free">F</span> <span class="free">H</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"filter_sup <span class="free">F</span> <span class="main">(</span><span class="free">G</span> <span class="main">∩</span> <span class="free">H</span><span class="main">)</span> <span class="main">⊆</span> filter_sup <span class="free">F</span> <span class="free">G</span> <span class="main">∩</span> filter_sup <span class="free">F</span> <span class="free">H</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> filter_sup_def <span class="keyword1"><span class="command">using</span></span> filter_sup_right_isotone_var <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"filter_sup <span class="free">F</span> <span class="free">G</span> <span class="main">∩</span> filter_sup <span class="free">F</span> <span class="free">H</span> <span class="main">⊆</span> filter_sup <span class="free">F</span> <span class="main">(</span><span class="free">G</span> <span class="main">∩</span> <span class="free">H</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> filter_sup <span class="free">F</span> <span class="free">G</span> <span class="main">∩</span> filter_sup <span class="free">F</span> <span class="free">H</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="keyword2"><span class="keyword">where</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="free">F</span> <span class="main">∧</span> <span class="skolem">u</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">∧</span> <span class="skolem">v</span> <span class="main">∈</span> <span class="free">F</span> <span class="main">∧</span> <span class="skolem">w</span> <span class="main">∈</span> <span class="free">H</span> <span class="main">∧</span> <span class="skolem">t</span> <span class="main">⊓</span> <span class="skolem">u</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">∧</span> <span class="skolem">v</span> <span class="main">⊓</span> <span class="skolem">w</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> filter_sup_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?y</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">⊓</span> <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?z</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">⊔</span> <span class="skolem">w</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?y</span> <span class="main">∈</span> <span class="free">F</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> filter_inf_closed<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?z</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">∩</span> <span class="free">H</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>2-3<span class="main"><span class="main">)</span></span> Int_iff filter_def sup_ge1 sup_ge2<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?y</span> <span class="main">⊓</span> <span class="var">?z</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">⊓</span> <span class="skolem">v</span> <span class="main">⊓</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">⊓</span> <span class="skolem">v</span> <span class="main">⊓</span> <span class="skolem">w</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_sup_distrib1<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">⊓</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="skolem">v</span> <span class="main">⊓</span> <span class="skolem">w</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.cobounded1 inf.cobounded2 inf.left_idem inf_mono sup.mono<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_supI<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> filter_sup <span class="free">F</span> <span class="main">(</span><span class="free">G</span> <span class="main">∩</span> <span class="free">H</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> filter_sup_def <span class="keyword1"><span class="command">using</span></span> 2 3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Filters-filter_inf_principal_rep"><span class="command">lemma</span></span> filter_inf_principal_rep<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">∩</span> <span class="free">G</span> <span class="main">=</span> <span class="main">↑</span><span class="free">z</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="free">F</span> <span class="main">.</span> <span class="main">∃</span><span class="bound">y</span><span class="main">∈</span><span class="free">G</span> <span class="main">.</span> <span class="free">z</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">⊔</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="Filters-filter_sup_principal_rep"><span class="command">lemma</span></span> filter_sup_principal_rep<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"filter <span class="free">F</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"filter <span class="free">G</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"filter_sup <span class="free">F</span> <span class="free">G</span> <span class="main">=</span> <span class="main">↑</span><span class="free">z</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="free">F</span> <span class="main">.</span> <span class="main">∃</span><span class="bound">y</span><span class="main">∈</span><span class="free">G</span> <span class="main">.</span> <span class="free">z</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">⊓</span> <span class="bound">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="free">F</span> <span class="main">∧</span> <span class="skolem">y</span><span class="main">∈</span><span class="free">G</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">⊓</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> filter_sup_def <span class="keyword1"><span class="command">using</span></span> order_refl <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊔</span> <span class="free">z</span> <span class="main">∈</span> <span class="free">F</span> <span class="main">∧</span> <span class="skolem">y</span> <span class="main">⊔</span> <span class="free">z</span> <span class="main">∈</span> <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>1-2<span class="main"><span class="main">)</span></span> sup_ge1 filter_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="free">z</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">⊔</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 sup_absorb2 sup_inf_distrib2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Filters-inf_sup_principal_aux"><span class="command">lemma</span></span> inf_sup_principal_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"filter <span class="free">F</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"filter <span class="free">G</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_principal_up <span class="main">(</span>filter_sup <span class="free">F</span> <span class="free">G</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_principal_up <span class="main">(</span><span class="free">F</span> <span class="main">∩</span> <span class="free">G</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_principal_up <span class="free">F</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3-4<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"filter_sup <span class="free">F</span> <span class="free">G</span> <span class="main">=</span> <span class="main">↑</span><span class="skolem">x</span> <span class="main">∧</span> <span class="free">F</span> <span class="main">∩</span> <span class="free">G</span> <span class="main">=</span> <span class="main">↑</span><span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> filter_inf_principal_rep <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">∈</span><span class="free">F</span> <span class="main">∧</span> <span class="skolem">u</span><span class="main">∈</span><span class="free">G</span> <span class="main">∧</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">t</span> <span class="main">⊔</span> <span class="skolem">u</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
  <span class="keyword1"><span class="command">from</span></span> filter_sup_principal_rep <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="keyword2"><span class="keyword">where</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">∈</span><span class="free">F</span> <span class="main">∧</span> <span class="skolem">w</span><span class="main">∈</span><span class="free">G</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">v</span> <span class="main">⊓</span> <span class="skolem">w</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>1-2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> filter_sup <span class="free">F</span> <span class="free">G</span> <span class="main">∧</span> <span class="skolem">u</span> <span class="main">∈</span> filter_sup <span class="free">F</span> <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> filter_sup_def <span class="keyword1"><span class="command">using</span></span> 2 inf.cobounded1 inf.cobounded2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">t</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">u</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span> <span class="main">⊓</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="skolem">u</span> <span class="main">⊓</span> <span class="skolem">w</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf.absorb2 inf.assoc inf.left_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span> <span class="main">⊓</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="skolem">u</span> <span class="main">⊓</span> <span class="skolem">w</span><span class="main">)</span> <span class="main">∈</span> <span class="free">F</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">⊓</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="skolem">u</span> <span class="main">⊓</span> <span class="skolem">w</span><span class="main">)</span> <span class="main">∈</span> <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 2 3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>1-2<span class="main"><span class="main">)</span></span> filter_inf_closed sup.cobounded1 sup.cobounded2 filter_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">⊓</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="skolem">u</span> <span class="main">⊓</span> <span class="skolem">w</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 Int_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span> <span class="main">⊓</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="skolem">u</span> <span class="main">⊓</span> <span class="skolem">w</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> order.antisym inf.coboundedI1<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">=</span> <span class="main">↑</span><span class="main">(</span><span class="skolem">t</span> <span class="main">⊓</span> <span class="skolem">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="main">↑</span><span class="main">(</span><span class="skolem">t</span> <span class="main">⊓</span> <span class="skolem">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span>
      <span class="keyword3"><span class="command">assume</span></span> 6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="free">F</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> filter_sup <span class="free">F</span> <span class="free">G</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> filter_sup_def <span class="keyword1"><span class="command">using</span></span> 2 inf.cobounded1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">z</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> 7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span> <span class="main">⊓</span> <span class="skolem">v</span> <span class="main">⊓</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="skolem">u</span> <span class="main">⊓</span> <span class="skolem">w</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 4 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.absorb1 inf.assoc inf.commute<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">⊔</span> <span class="skolem">u</span> <span class="main">∈</span> <span class="free">F</span> <span class="main">∧</span> <span class="skolem">z</span> <span class="main">⊔</span> <span class="skolem">u</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">∧</span> <span class="skolem">z</span> <span class="main">⊔</span> <span class="skolem">w</span> <span class="main">∈</span> <span class="free">F</span> <span class="main">∧</span> <span class="skolem">z</span> <span class="main">⊔</span> <span class="skolem">w</span> <span class="main">∈</span> <span class="free">G</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 2 3 6 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>1-2<span class="main"><span class="main">)</span></span> filter_def sup_ge1 sup_ge2<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">z</span> <span class="main">⊔</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="skolem">z</span> <span class="main">⊔</span> <span class="skolem">w</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 1 Int_iff filter_inf_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> 8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span> <span class="main">⊓</span> <span class="skolem">v</span> <span class="main">⊓</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="skolem">u</span> <span class="main">⊓</span> <span class="skolem">w</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 5 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.absorb1 sup.commute sup_inf_distrib2<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">⊓</span> <span class="skolem">v</span> <span class="main">⊓</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">t</span> <span class="main">⊓</span> <span class="skolem">v</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 4 5 7 8 relative_equality <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="main">↑</span><span class="main">(</span><span class="skolem">t</span> <span class="main">⊓</span> <span class="skolem">v</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf.orderI<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">↑</span><span class="main">(</span><span class="skolem">t</span> <span class="main">⊓</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span>
      <span class="keyword1"><span class="command">have</span></span> 9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">⊓</span> <span class="skolem">v</span> <span class="main">∈</span> <span class="free">F</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 2 3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> filter_inf_closed<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="main">↑</span><span class="main">(</span><span class="skolem">t</span> <span class="main">⊓</span> <span class="skolem">v</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">⊓</span> <span class="skolem">v</span> <span class="main">≤</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="free">F</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> 9 filter_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following result is \cite[Lemma II]{GraetzerSchmidt1958}.
If both join and meet of two filters are principal filters, both filters are principal filters.
›</span></span>

<span class="keyword1" id="Filters-inf_sup_principal"><span class="command">lemma</span></span> inf_sup_principal<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"filter <span class="free">F</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"filter <span class="free">G</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_principal_up <span class="main">(</span>filter_sup <span class="free">F</span> <span class="free">G</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_principal_up <span class="main">(</span><span class="free">F</span> <span class="main">∩</span> <span class="free">G</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_principal_up <span class="free">F</span> <span class="main">∧</span> is_principal_up <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filter <span class="free">G</span> <span class="main">∧</span> filter <span class="free">F</span> <span class="main">∧</span> is_principal_up <span class="main">(</span>filter_sup <span class="free">G</span> <span class="free">F</span><span class="main">)</span> <span class="main">∧</span> is_principal_up <span class="main">(</span><span class="free">G</span> <span class="main">∩</span> <span class="free">F</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms Int_commute filter_sup_symmetric<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> inf_sup_principal_aux <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Filters-filter_sup_absorb_inf"><span class="command">lemma</span></span> filter_sup_absorb_inf<span class="main">:</span> <span class="quoted"><span class="quoted">"filter <span class="free">F</span> <span class="main">⟹</span> filter <span class="free">G</span> <span class="main">⟹</span> filter_sup <span class="main">(</span><span class="free">F</span> <span class="main">∩</span> <span class="free">G</span><span class="main">)</span> <span class="free">G</span> <span class="main">=</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> filter_inf filter_sup_least_upper_bound filter_sup_left_upper_bound filter_sup_symmetric subset_antisym<span class="main">)</span>

<span class="keyword1" id="Filters-filter_inf_absorb_sup"><span class="command">lemma</span></span> filter_inf_absorb_sup<span class="main">:</span> <span class="quoted"><span class="quoted">"filter <span class="free">F</span> <span class="main">⟹</span> filter <span class="free">G</span> <span class="main">⟹</span> filter_sup <span class="free">F</span> <span class="free">G</span> <span class="main">∩</span> <span class="free">G</span> <span class="main">=</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subset_antisym<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> filter_sup_right_upper_bound<span class="main">)</span>

<span class="keyword1" id="Filters-filter_inf_right_dist_sup"><span class="command">lemma</span></span> filter_inf_right_dist_sup<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"filter <span class="free">F</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"filter <span class="free">G</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"filter <span class="free">H</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"filter_sup <span class="free">F</span> <span class="free">G</span> <span class="main">∩</span> <span class="free">H</span> <span class="main">=</span> filter_sup <span class="main">(</span><span class="free">F</span> <span class="main">∩</span> <span class="free">H</span><span class="main">)</span> <span class="main">(</span><span class="free">G</span> <span class="main">∩</span> <span class="free">H</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filter_sup <span class="main">(</span><span class="free">F</span> <span class="main">∩</span> <span class="free">H</span><span class="main">)</span> <span class="main">(</span><span class="free">G</span> <span class="main">∩</span> <span class="free">H</span><span class="main">)</span> <span class="main">=</span> filter_sup <span class="main">(</span><span class="free">F</span> <span class="main">∩</span> <span class="free">H</span><span class="main">)</span> <span class="free">G</span> <span class="main">∩</span> filter_sup <span class="main">(</span><span class="free">F</span> <span class="main">∩</span> <span class="free">H</span><span class="main">)</span> <span class="free">H</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms filter_sup_left_dist_inf filter_inf<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> filter_sup <span class="main">(</span><span class="free">F</span> <span class="main">∩</span> <span class="free">H</span><span class="main">)</span> <span class="free">G</span> <span class="main">∩</span> <span class="free">H</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span> filter_sup_absorb_inf <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> filter_sup <span class="free">F</span> <span class="free">G</span> <span class="main">∩</span> filter_sup <span class="free">G</span> <span class="free">H</span> <span class="main">∩</span> <span class="free">H</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms filter_sup_left_dist_inf filter_sup_symmetric <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> filter_sup <span class="free">F</span> <span class="free">G</span> <span class="main">∩</span> <span class="free">H</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2-3<span class="main"><span class="main">)</span></span> filter_inf_absorb_sup semilattice_inf_class.inf_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following result generalises \cite[10.11]{DaveyPriestley2002} to distributive lattices as remarked after that section.
›</span></span>

<span class="keyword1" id="Filters-ultra_filter_prime"><span class="command">lemma</span></span> ultra_filter_prime<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ultra_filter <span class="free">F</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"prime_filter <span class="free">F</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
    <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span> <span class="main">∈</span> <span class="free">F</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">∉</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?G</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⇑</span><span class="main">{</span> <span class="bound">z</span> <span class="main">.</span> <span class="main">∃</span><span class="bound">w</span><span class="main">∈</span><span class="free">F</span> <span class="main">.</span> <span class="skolem">x</span> <span class="main">⊓</span> <span class="bound">w</span> <span class="main">=</span> <span class="bound">z</span> <span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"filter <span class="var">?G</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms filter_inf_filter <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?G</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">≠</span> <span class="var">?G</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="var">?G</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> inf_le2 order_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?G</span> <span class="main">=</span> UNIV"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 2 3 assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="free">F</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">⊓</span> <span class="skolem">z</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">⊓</span> <span class="skolem">z</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">⊓</span> <span class="skolem">z</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_sup_distrib2 sup_absorb2<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">∈</span> <span class="free">F</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 4 assms filter_inf_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">F</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> filter_def<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Filters-up_dist_inf_inter"><span class="command">lemma</span></span> up_dist_inf_inter<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_up_set <span class="free">S</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">↑</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">∩</span> <span class="free">S</span> <span class="main">=</span> filter_sup <span class="main">(</span><span class="main">↑</span><span class="free">x</span> <span class="main">∩</span> <span class="free">S</span><span class="main">)</span> <span class="main">(</span><span class="main">↑</span><span class="free">y</span> <span class="main">∩</span> <span class="free">S</span><span class="main">)</span> <span class="main">∩</span> <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">↑</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">∩</span> <span class="free">S</span> <span class="main">⊆</span> filter_sup <span class="main">(</span><span class="main">↑</span><span class="free">x</span> <span class="main">∩</span> <span class="free">S</span><span class="main">)</span> <span class="main">(</span><span class="main">↑</span><span class="free">y</span> <span class="main">∩</span> <span class="free">S</span><span class="main">)</span> <span class="main">∩</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊔</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?y</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">⊔</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="main">↑</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">∩</span> <span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">≤</span> <span class="skolem">z</span> <span class="main">∧</span> <span class="skolem">z</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">↑</span><span class="free">x</span> <span class="main">∩</span> <span class="free">S</span><span class="main">)</span> <span class="main">∧</span> <span class="var">?y</span> <span class="main">∈</span> <span class="main">(</span><span class="main">↑</span><span class="free">y</span> <span class="main">∩</span> <span class="free">S</span><span class="main">)</span> <span class="main">∧</span> <span class="var">?x</span> <span class="main">⊓</span> <span class="var">?y</span> <span class="main">≤</span> <span class="skolem">z</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms sup_absorb2 sup_inf_distrib2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> filter_sup <span class="main">(</span><span class="main">↑</span><span class="free">x</span> <span class="main">∩</span> <span class="free">S</span><span class="main">)</span> <span class="main">(</span><span class="main">↑</span><span class="free">y</span> <span class="main">∩</span> <span class="free">S</span><span class="main">)</span> <span class="main">∩</span> <span class="free">S</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> filter_sup_def 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"filter_sup <span class="main">(</span><span class="main">↑</span><span class="free">x</span> <span class="main">∩</span> <span class="free">S</span><span class="main">)</span> <span class="main">(</span><span class="main">↑</span><span class="free">y</span> <span class="main">∩</span> <span class="free">S</span><span class="main">)</span> <span class="main">∩</span> <span class="free">S</span> <span class="main">⊆</span> <span class="main">↑</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">∩</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> filter_sup <span class="main">(</span><span class="main">↑</span><span class="free">x</span> <span class="main">∩</span> <span class="free">S</span><span class="main">)</span> <span class="main">(</span><span class="main">↑</span><span class="free">y</span> <span class="main">∩</span> <span class="free">S</span><span class="main">)</span> <span class="main">∩</span> <span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span><span class="main">∈</span><span class="main">↑</span><span class="free">x</span> <span class="main">∧</span> <span class="skolem">v</span><span class="main">∈</span><span class="main">↑</span><span class="free">y</span> <span class="main">∧</span> <span class="skolem">u</span> <span class="main">⊓</span> <span class="skolem">v</span> <span class="main">≤</span> <span class="skolem">z</span> <span class="main">∧</span> <span class="skolem">z</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> filter_sup_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">≤</span> <span class="skolem">z</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> order.trans inf_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="main">↑</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">∩</span> <span class="free">S</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> distrib_lattice_bot
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Filters-prime_filter"><span class="command">lemma</span></span> prime_filter<span class="main">:</span>
  <span class="quoted"><span class="quoted">"proper_filter <span class="free">F</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">G</span> <span class="main">.</span> prime_filter <span class="bound">G</span> <span class="main">∧</span> <span class="free">F</span> <span class="main">⊆</span> <span class="bound">G</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ultra_filter ultra_filter_prime<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> distrib_lattice_top
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Filters-complemented_filter_inf_principal"><span class="command">lemma</span></span> complemented_filter_inf_principal<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"filter_complements <span class="free">F</span> <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_principal_up <span class="main">(</span><span class="free">F</span> <span class="main">∩</span> <span class="main">↑</span><span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"filter <span class="free">F</span> <span class="main">∧</span> filter <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"filter <span class="main">(</span><span class="free">F</span> <span class="main">∩</span> <span class="main">↑</span><span class="free">x</span><span class="main">)</span> <span class="main">∧</span> filter <span class="main">(</span><span class="free">G</span> <span class="main">∩</span> <span class="main">↑</span><span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> filter_inf<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">F</span> <span class="main">∩</span> <span class="main">↑</span><span class="free">x</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span><span class="free">G</span> <span class="main">∩</span> <span class="main">↑</span><span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span>top<span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms Int_assoc Int_insert_left_if1 inf_bot_left inf_sup_aci<span class="main">(</span>3<span class="main">)</span> top_in_upset inf.idem <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"is_principal_up <span class="main">(</span><span class="main">(</span><span class="free">F</span> <span class="main">∩</span> <span class="main">↑</span><span class="free">x</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span><span class="free">G</span> <span class="main">∩</span> <span class="main">↑</span><span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> up_top <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filter_sup <span class="main">(</span><span class="free">F</span> <span class="main">∩</span> <span class="main">↑</span><span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="free">G</span> <span class="main">∩</span> <span class="main">↑</span><span class="free">x</span><span class="main">)</span> <span class="main">=</span> filter_sup <span class="free">F</span> <span class="free">G</span> <span class="main">∩</span> <span class="main">↑</span><span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 filter_inf_right_dist_sup up_filter <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">↑</span><span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_principal_up <span class="main">(</span>filter_sup <span class="main">(</span><span class="free">F</span> <span class="main">∩</span> <span class="main">↑</span><span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="free">G</span> <span class="main">∩</span> <span class="main">↑</span><span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 2 3 inf_sup_principal_aux <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The set of filters over a distributive lattice with a greatest element forms a bounded distributive lattice.
›</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> filter <span class="main">::</span> <span class="main">(</span><span class="quoted">distrib_lattice_top</span><span class="main">)</span> <span class="quoted">bounded_distrib_lattice</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">intro_classes</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> filter_sup_left_dist_inf<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

</pre>
</div><div id="Stone_Construction">
<div class="head">
<h1>Theory Stone_Construction</h1>
</div>
<pre class="source"><span class="comment1">(* Title:      Construction of Stone Algebras
   Author:     Walter Guttmann
   Maintainer: Walter Guttmann &lt;walter.guttmann at canterbury.ac.nz&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Stone Construction›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
This theory proves the uniqueness theorem for the triple representation of Stone algebras and the construction theorem of Stone algebras \cite{ChenGraetzer1969,Katrinak1973}.
Every Stone algebra $S$ has an associated triple consisting of
\begin{itemize}
\item the set of regular elements $B(S)$ of $S$,
\item the set of dense elements $D(S)$ of $S$, and
\item the structure map $\varphi(S) : B(S) \to F(D(S))$ defined by $\varphi(x) = {\uparrow} x \cap D(S)$.
\end{itemize}
Here $F(X)$ is the set of filters of a partially ordered set $X$.
We first show that
\begin{itemize}
\item $B(S)$ is a Boolean algebra,
\item $D(S)$ is a distributive lattice with a greatest element, whence $F(D(S))$ is a bounded distributive lattice, and
\item $\varphi(S)$ is a bounded lattice homomorphism.
\end{itemize}
Next, from a triple $T = (B,D,\varphi)$ such that $B$ is a Boolean algebra, $D$ is a distributive lattice with a greatest element and $\varphi : B \to F(D)$ is a bounded lattice homomorphism, we construct a Stone algebra $S(T)$.
The elements of $S(T)$ are pairs taken from $B \times F(D)$ following the construction of \cite{Katrinak1973}.
We need to represent $S(T)$ as a type to be able to instantiate the Stone algebra class.
Because the pairs must satisfy a condition depending on $\varphi$, this would require dependent types.
Since Isabelle/HOL does not have dependent types, we use a function lifting instead.
The lifted pairs form a Stone algebra.

Next, we specialise the construction to start with the triple associated with a Stone algebra $S$, that is, we construct $S(B(S),D(S),\varphi(S))$.
In this case, we can instantiate the lifted pairs to obtain a type of pairs (that no longer implements a dependent type).
To achieve this, we construct an embedding of the type of pairs into the lifted pairs, so that we inherit the Stone algebra axioms (using a technique of universal algebra that works for universally quantified equations and equational implications).

Next, we show that the Stone algebras $S(B(S),D(S),\varphi(S))$ and $S$ are isomorphic.
We give explicit mappings in both directions.
This implies the uniqueness theorem for the triple representation of Stone algebras.

Finally, we show that the triples $(B(S(T)),D(S(T)),\varphi(S(T)))$ and $T$ are isomorphic.
This requires an isomorphism of the Boolean algebras $B$ and $B(S(T))$, an isomorphism of the distributive lattices $D$ and $D(S(T))$, and a proof that they preserve the structure maps.
We give explicit mappings of the Boolean algebra isomorphism and the distributive lattice isomorphism in both directions.
This implies the construction theorem of Stone algebras.
Because $S(T)$ is implemented by lifted pairs, so are $B(S(T))$ and $D(S(T))$; we therefore also lift $B$ and $D$ to establish the isomorphisms.
›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Stone_Construction

<span class="keyword2"><span class="keyword">imports</span></span> <a href="#P_Algebras">P_Algebras</a> <a href="#Filters">Filters</a>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
A triple consists of a Boolean algebra, a distributive lattice with a greatest element, and a structure map.
The Boolean algebra and the distributive lattice are represented as HOL types.
Because both occur in the type of the structure map, the triple is determined simply by the structure map and its HOL type.
The structure map needs to be a bounded lattice homomorphism.
›</span></span>

<span class="keyword1"><span class="command">locale</span></span> triple <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">phi</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>boolean_algebra <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>distrib_lattice_top filter"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> hom<span class="main">:</span> <span class="quoted"><span class="quoted">"bounded_lattice_homomorphism <span class="free">phi</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The Triple of a Stone Algebra›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
In this section we construct the triple associated to a Stone algebra.
›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Regular Elements›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The regular elements of a Stone algebra form a Boolean subalgebra.
›</span></span>

<span class="keyword1"><span class="command">typedef</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">overloaded</span></span><span class="main">)</span> <span class="tfree">'a</span> regular <span class="main">=</span> <span class="quoted"><span class="quoted">"regular_elements<span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>stone_algebra set"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Stone_Construction-simp_regular"><span class="command">lemma</span></span> simp_regular <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">y</span> <span class="main">.</span> Rep_regular <span class="free">x</span> <span class="main">=</span> <span class="main">-</span><span class="bound">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Rep_regular <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">setup_lifting</span></span> type_definition_regular

<span class="keyword1"><span class="command">instantiation</span></span> regular <span class="main">::</span> <span class="main">(</span><span class="quoted">stone_algebra</span><span class="main">)</span> <span class="quoted">boolean_algebra</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">sup_regular</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> regular <span class="main">⇒</span> <span class="tfree">'a</span> regular <span class="main">⇒</span> <span class="tfree">'a</span> regular"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">sup</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> regular_in_p_image_iff regular_closed_sup<span class="main">)</span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">inf_regular</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> regular <span class="main">⇒</span> <span class="tfree">'a</span> regular <span class="main">⇒</span> <span class="tfree">'a</span> regular"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">inf</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> regular_in_p_image_iff regular_closed_inf<span class="main">)</span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">minus_regular</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> regular <span class="main">⇒</span> <span class="tfree">'a</span> regular <span class="main">⇒</span> <span class="tfree">'a</span> regular"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">⊓</span> <span class="main">-</span><span class="bound">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> regular_in_p_image_iff regular_closed_inf<span class="main">)</span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">uminus_regular</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> regular <span class="main">⇒</span> <span class="tfree">'a</span> regular"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">uminus</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">bot_regular</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> regular"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">bot</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> regular_in_p_image_iff regular_closed_bot<span class="main">)</span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">top_regular</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> regular"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">top</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> regular_in_p_image_iff regular_closed_top<span class="main">)</span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">less_eq_regular</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> regular <span class="main">⇒</span> <span class="tfree">'a</span> regular <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">less_eq</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">less_regular</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> regular <span class="main">⇒</span> <span class="tfree">'a</span> regular <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">less</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">intro_classes</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_le_not_le<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup_inf_distrib1<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> regular <span class="main">::</span> <span class="main">(</span><span class="quoted">non_trivial_stone_algebra</span><span class="main">)</span> <span class="quoted">non_trivial_boolean_algebra</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">instance</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro_classes</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">x</span> <span class="bound">y</span><span class="main">::</span><span class="tfree">'a</span> regular <span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>bot<span class="main">::</span><span class="tfree">'a</span> regular<span class="main">)</span> <span class="main">=</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>bot<span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">=</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bot_regular.rep_eq top_regular.rep_eq<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bot_not_top<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Dense Elements›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The dense elements of a Stone algebra form a distributive lattice with a greatest element.
›</span></span>

<span class="keyword1"><span class="command">typedef</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">overloaded</span></span><span class="main">)</span> <span class="tfree">'a</span> dense <span class="main">=</span> <span class="quoted"><span class="quoted">"dense_elements<span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>stone_algebra set"</span></span>
  <span class="keyword1"><span class="command">using</span></span> dense_closed_top <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Stone_Construction-simp_dense"><span class="command">lemma</span></span> simp_dense <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">-</span>Rep_dense <span class="free">x</span> <span class="main">=</span> bot"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Rep_dense <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">setup_lifting</span></span> type_definition_dense

<span class="keyword1"><span class="command">instantiation</span></span> dense <span class="main">::</span> <span class="main">(</span><span class="quoted">stone_algebra</span><span class="main">)</span> <span class="quoted">distrib_lattice_top</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">sup_dense</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> dense <span class="main">⇒</span> <span class="tfree">'a</span> dense <span class="main">⇒</span> <span class="tfree">'a</span> dense"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">sup</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">inf_dense</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> dense <span class="main">⇒</span> <span class="tfree">'a</span> dense <span class="main">⇒</span> <span class="tfree">'a</span> dense"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">inf</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">top_dense</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> dense"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">top</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">less_eq_dense</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> dense <span class="main">⇒</span> <span class="tfree">'a</span> dense <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">less_eq</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">less_dense</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> dense <span class="main">⇒</span> <span class="tfree">'a</span> dense <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">less</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">intro_classes</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf.less_le_not_le<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup_inf_distrib1<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="Stone_Construction-up_filter_dense_antitone_dense"><span class="command">lemma</span></span> up_filter_dense_antitone_dense<span class="main">:</span>
  <span class="quoted"><span class="quoted">"dense <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">∧</span> dense <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">⊔</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Stone_Construction-up_filter_dense_antitone"><span class="command">lemma</span></span> up_filter_dense_antitone<span class="main">:</span>
  <span class="quoted"><span class="quoted">"up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span> <span class="main">⊔</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> up_filter_antitone<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_dense_inverse less_eq_dense.rep_eq<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The filters of dense elements of a Stone algebra form a bounded distributive lattice.
›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> dense_filter <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> dense filter"</span></span>

<span class="keyword1"><span class="command">typedef</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">overloaded</span></span><span class="main">)</span> <span class="tfree">'a</span> dense_filter_type <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span> <span class="bound">x</span><span class="main">::</span><span class="tfree">'a</span> dense_filter <span class="main">.</span> True <span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> filter_top <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">setup_lifting</span></span> type_definition_dense_filter_type

<span class="keyword1"><span class="command">instantiation</span></span> dense_filter_type <span class="main">::</span> <span class="main">(</span><span class="quoted">stone_algebra</span><span class="main">)</span> <span class="quoted">bounded_distrib_lattice</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">sup_dense_filter_type</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> dense_filter_type <span class="main">⇒</span> <span class="tfree">'a</span> dense_filter_type <span class="main">⇒</span> <span class="tfree">'a</span> dense_filter_type"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">sup</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">inf_dense_filter_type</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> dense_filter_type <span class="main">⇒</span> <span class="tfree">'a</span> dense_filter_type <span class="main">⇒</span> <span class="tfree">'a</span> dense_filter_type"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">inf</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">bot_dense_filter_type</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> dense_filter_type"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">bot</span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">top_dense_filter_type</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> dense_filter_type"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">top</span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">less_eq_dense_filter_type</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> dense_filter_type <span class="main">⇒</span> <span class="tfree">'a</span> dense_filter_type <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">less_eq</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">less_dense_filter_type</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> dense_filter_type <span class="main">⇒</span> <span class="tfree">'a</span> dense_filter_type <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">less</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">intro_classes</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf.less_le_not_le<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup_inf_distrib1<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹The Structure Map›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The structure map of a Stone algebra is a bounded lattice homomorphism.
It maps a regular element <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>x›</span></span></span></span> to the set of all dense elements above <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>-x›</span></span></span></span>.
This set is a filter.
›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">stone_phi_base</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>stone_algebra regular <span class="main">⇒</span> <span class="tfree">'a</span> dense set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">stone_phi_base</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="main">{</span> <span class="bound">y</span> <span class="main">.</span> <span class="main">-</span>Rep_regular <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≤</span> Rep_dense <span class="bound">y</span> <span class="main">}</span>"</span></span>

<span class="keyword1" id="Stone_Construction-stone_phi_base_filter"><span class="command">lemma</span></span> stone_phi_base_filter<span class="main">:</span>
  <span class="quoted"><span class="quoted">"filter <span class="main">(</span>stone_phi_base <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> filter_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Collect_empty_eq top_dense.rep_eq top_greatest<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> inf_dense.rep_eq inf_le2 le_inf_iff mem_Collect_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> order_trans less_eq_dense.rep_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">stone_phi</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>stone_algebra regular <span class="main">⇒</span> <span class="tfree">'a</span> dense_filter"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">stone_phi</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> Abs_filter <span class="main">(</span>stone_phi_base <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
To show that we obtain a triple, we only need to prove that <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>stone_phi›</span></span></span></span> is a bounded lattice homomorphism.
The Boolean algebra and the distributive lattice requirements are taken care of by the type system.
›</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> stone_phi<span class="main">:</span> triple <span class="quoted"><span class="quoted">"stone_phi"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"Rep_regular <span class="main">(</span>Abs_regular bot<span class="main">)</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bot_regular.rep_eq bot_regular_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"stone_phi bot <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> stone_phi_def bot_regular_def 1 p_bot bot_filter_def<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Collect_cong Rep_dense_inject order_refl singleton_conv top.extremum_uniqueI top_dense.rep_eq<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"stone_phi top <span class="main">=</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Collect_cong stone_phi_def UNIV_I bot.extremum dense_closed_top top_empty_eq top_filter.abs_eq top_regular.rep_eq top_set_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">::</span><span class="tfree">'a</span> regular <span class="main">.</span> stone_phi <span class="main">(</span><span class="bound">x</span> <span class="main">⊔</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> stone_phi <span class="bound">x</span> <span class="main">⊔</span> stone_phi <span class="bound">y</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> regular"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"stone_phi_base <span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> filter_sup <span class="main">(</span>stone_phi_base <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>stone_phi_base <span class="skolem">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> set_eqI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> iffI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span>
      <span class="keyword3"><span class="command">assume</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> stone_phi_base <span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">-</span>Rep_regular <span class="skolem">x</span> <span class="main">⊔</span> Rep_dense <span class="skolem">z</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?u</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">-</span>Rep_regular <span class="skolem">y</span> <span class="main">⊔</span> Rep_dense <span class="skolem">z</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?v</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Abs_dense <span class="var">?t</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?w</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Abs_dense <span class="var">?u</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?v</span> <span class="main">∈</span> stone_phi_base <span class="skolem">x</span> <span class="main">∧</span> <span class="var">?w</span> <span class="main">∈</span> stone_phi_base <span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_dense_inverse<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?v</span> <span class="main">⊓</span> <span class="var">?w</span> <span class="main">=</span> Abs_dense <span class="main">(</span><span class="var">?t</span> <span class="main">⊓</span> <span class="var">?u</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_onp_def inf_dense.abs_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Abs_dense <span class="main">(</span><span class="main">-</span>Rep_regular <span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">⊔</span> Rep_dense <span class="skolem">z</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distrib<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> sup_commute sup_regular.rep_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Abs_dense <span class="main">(</span>Rep_dense <span class="skolem">z</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_iff_sup<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">z</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Rep_dense_inverse<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> filter_sup <span class="main">(</span>stone_phi_base <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>stone_phi_base <span class="skolem">y</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 3 mem_Collect_eq order_refl filter_sup_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> filter_sup <span class="main">(</span>stone_phi_base <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>stone_phi_base <span class="skolem">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="keyword2"><span class="keyword">where</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> stone_phi_base <span class="skolem">x</span> <span class="main">∧</span> <span class="skolem">w</span> <span class="main">∈</span> stone_phi_base <span class="skolem">y</span> <span class="main">∧</span> <span class="skolem">v</span> <span class="main">⊓</span> <span class="skolem">w</span> <span class="main">≤</span> <span class="skolem">z</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> filter_sup_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span>Rep_regular <span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> Rep_regular <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> uminus_regular.rep_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">-</span>Rep_regular <span class="skolem">x</span> <span class="main">⊓</span> <span class="main">-</span>Rep_regular <span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_regular.rep_eq uminus_regular.rep_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> Rep_dense <span class="skolem">v</span> <span class="main">⊓</span> Rep_dense <span class="skolem">w</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 4 inf_mono mem_Collect_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Rep_dense <span class="main">(</span><span class="skolem">v</span> <span class="main">⊓</span> <span class="skolem">w</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_dense.rep_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> Rep_dense <span class="skolem">z</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 4 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_dense.rep_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> stone_phi_base <span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"stone_phi <span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> stone_phi <span class="skolem">x</span> <span class="main">⊔</span> stone_phi <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stone_phi_def eq_onp_same_args stone_phi_base_filter sup_filter.abs_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">::</span><span class="tfree">'a</span> regular <span class="main">.</span> stone_phi <span class="main">(</span><span class="bound">x</span> <span class="main">⊓</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> stone_phi <span class="bound">x</span> <span class="main">⊓</span> stone_phi <span class="bound">y</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> regular"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">z</span> <span class="main">.</span> <span class="main">-</span>Rep_regular <span class="main">(</span><span class="skolem">x</span> <span class="main">⊓</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">≤</span> Rep_dense <span class="bound">z</span> <span class="main">⟷</span> <span class="main">-</span>Rep_regular <span class="skolem">x</span> <span class="main">≤</span> Rep_dense <span class="bound">z</span> <span class="main">∧</span> <span class="main">-</span>Rep_regular <span class="skolem">y</span> <span class="main">≤</span> Rep_dense <span class="bound">z</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_regular.rep_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"stone_phi_base <span class="main">(</span><span class="skolem">x</span> <span class="main">⊓</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>stone_phi_base <span class="skolem">x</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>stone_phi_base <span class="skolem">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"stone_phi <span class="main">(</span><span class="skolem">x</span> <span class="main">⊓</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> stone_phi <span class="skolem">x</span> <span class="main">⊓</span> stone_phi <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stone_phi_def eq_onp_same_args stone_phi_base_filter inf_filter.abs_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Properties of Triples›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
In this section we construct a certain set of pairs from a triple, introduce operations on these pairs and develop their properties.
The given set and operations will form a Stone algebra.
›</span></span>

<span class="keyword1"><span class="command">context</span></span> triple
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Stone_Construction-phi_bot"><span class="command">lemma</span></span> phi_bot<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">phi</span> bot <span class="main">=</span> Abs_filter <span class="main">{</span>top<span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hom bot_filter_def<span class="main">)</span>

<span class="keyword1" id="Stone_Construction-phi_top"><span class="command">lemma</span></span> phi_top<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">phi</span> top <span class="main">=</span> Abs_filter UNIV"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hom top_filter_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The occurrence of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>phi›</span></span></span></span> in the following definition of the pairs creates a need for dependent types.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">pairs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'b</span> filter<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">pairs</span> <span class="main">=</span> <span class="main">{</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">.</span> <span class="main">∃</span><span class="bound">z</span> <span class="main">.</span> <span class="bound">y</span> <span class="main">=</span> <span class="free">phi</span> <span class="main">(</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="bound">z</span> <span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Operations on pairs are defined in the following.
They will be used to establish that the pairs form a Stone algebra.
›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">pairs_less_eq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'b</span> filter<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'b</span> filter<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">pairs_less_eq</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">pairs_less</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'b</span> filter<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'b</span> filter<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">pairs_less</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>pairs_less_eq <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> pairs_less_eq <span class="main">(</span><span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">pairs_sup</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'b</span> filter<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'b</span> filter<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'b</span> filter<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">pairs_sup</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊔</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">⊓</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">pairs_inf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'b</span> filter<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'b</span> filter<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'b</span> filter<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">pairs_inf</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊓</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">⊔</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">pairs_minus</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'b</span> filter<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'b</span> filter<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'b</span> filter<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">pairs_minus</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊓</span> <span class="main">-</span><span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">⊔</span> <span class="free">phi</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">pairs_uminus</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'b</span> filter<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'b</span> filter<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">pairs_uminus</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">,</span><span class="free">phi</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">pairs_bot</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'b</span> filter<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">pairs_bot</span> <span class="main">≡</span> <span class="main">(</span>bot<span class="main">,</span>Abs_filter UNIV<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">pairs_top</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'b</span> filter<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">pairs_top</span> <span class="main">≡</span> <span class="main">(</span>top<span class="main">,</span>Abs_filter <span class="main">{</span>top<span class="main">}</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Stone_Construction-pairs_top_in_set"><span class="command">lemma</span></span> pairs_top_in_set<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">∈</span> pairs <span class="main">⟹</span> top <span class="main">∈</span> Rep_filter <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Stone_Construction-phi_complemented"><span class="command">lemma</span></span> phi_complemented<span class="main">:</span>
  <span class="quoted"><span class="quoted">"complement <span class="main">(</span><span class="free">phi</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="free">phi</span> <span class="main">(</span><span class="main">-</span><span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hom inf_compl_bot sup_compl_top<span class="main">)</span>

<span class="keyword1" id="Stone_Construction-phi_inf_principal"><span class="command">lemma</span></span> phi_inf_principal<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">z</span> <span class="main">.</span> up_filter <span class="bound">z</span> <span class="main">=</span> <span class="free">phi</span> <span class="free">x</span> <span class="main">⊓</span> up_filter <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?F</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Rep_filter <span class="main">(</span><span class="free">phi</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?G</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Rep_filter <span class="main">(</span><span class="free">phi</span> <span class="main">(</span><span class="main">-</span><span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"eq_onp filter <span class="var">?F</span> <span class="var">?F</span> <span class="main">∧</span> eq_onp filter <span class="main">(</span><span class="main">↑</span><span class="free">y</span><span class="main">)</span> <span class="main">(</span><span class="main">↑</span><span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_onp_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filter_complements <span class="var">?F</span> <span class="var">?G</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> phi_complemented sup_filter.rep_eq top_filter.rep_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> phi_complemented inf_filter.rep_eq bot_filter.rep_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_principal_up <span class="main">(</span><span class="var">?F</span> <span class="main">∩</span> <span class="main">↑</span><span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> complemented_filter_inf_principal <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">↑</span><span class="skolem">z</span> <span class="main">=</span> <span class="var">?F</span> <span class="main">∩</span> <span class="main">↑</span><span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"up_filter <span class="skolem">z</span> <span class="main">=</span> Abs_filter <span class="main">(</span><span class="var">?F</span> <span class="main">∩</span> <span class="main">↑</span><span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Abs_filter <span class="var">?F</span> <span class="main">⊓</span> up_filter <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 inf_filter.abs_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">phi</span> <span class="free">x</span> <span class="main">⊓</span> up_filter <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Rep_filter_inverse<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Quite a bit of filter theory is involved in showing that the intersection of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>phi x›</span></span></span></span> with a principal filter is a principal filter, so the following function can extract its least element.
›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">rho</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">rho</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">z</span> <span class="main">.</span> up_filter <span class="bound">z</span> <span class="main">=</span> <span class="free">phi</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊓</span> up_filter <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Stone_Construction-rho_char"><span class="command">lemma</span></span> rho_char<span class="main">:</span>
  <span class="quoted"><span class="quoted">"up_filter <span class="main">(</span>rho <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">phi</span> <span class="free">x</span> <span class="main">⊓</span> up_filter <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> someI_ex rho.simps phi_inf_principal<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following results show that the pairs are closed under the given operations.
›</span></span>

<span class="keyword1" id="Stone_Construction-pairs_sup_closed"><span class="command">lemma</span></span> pairs_sup_closed<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">∈</span> pairs"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">z</span><span class="main">,</span><span class="free">w</span><span class="main">)</span> <span class="main">∈</span> pairs"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pairs_sup <span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">(</span><span class="free">z</span><span class="main">,</span><span class="free">w</span><span class="main">)</span> <span class="main">∈</span> pairs"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="free">phi</span> <span class="main">(</span><span class="main">-</span><span class="free">x</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="skolem">u</span> <span class="main">∧</span> <span class="free">w</span> <span class="main">=</span> <span class="free">phi</span> <span class="main">(</span><span class="main">-</span><span class="free">z</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> pairs_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"pairs_sup <span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">(</span><span class="free">z</span><span class="main">,</span><span class="free">w</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">z</span><span class="main">,</span><span class="main">(</span><span class="free">phi</span> <span class="main">(</span><span class="main">-</span><span class="free">x</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="skolem">u</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">phi</span> <span class="main">(</span><span class="main">-</span><span class="free">z</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="skolem">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">z</span><span class="main">,</span><span class="main">(</span><span class="free">phi</span> <span class="main">(</span><span class="main">-</span><span class="free">x</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">phi</span> <span class="main">(</span><span class="main">-</span><span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">phi</span> <span class="main">(</span><span class="main">-</span><span class="free">x</span><span class="main">)</span> <span class="main">⊓</span> up_filter <span class="skolem">v</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span>up_filter <span class="skolem">u</span> <span class="main">⊓</span> <span class="free">phi</span> <span class="main">(</span><span class="main">-</span><span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span>up_filter <span class="skolem">u</span> <span class="main">⊓</span> up_filter <span class="skolem">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf.sup_commute inf_sup_distrib1 sup_commute sup_left_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">z</span><span class="main">,</span><span class="free">phi</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">phi</span> <span class="main">(</span><span class="main">-</span><span class="free">x</span><span class="main">)</span> <span class="main">⊓</span> up_filter <span class="skolem">v</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span>up_filter <span class="skolem">u</span> <span class="main">⊓</span> <span class="free">phi</span> <span class="main">(</span><span class="main">-</span><span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span>up_filter <span class="skolem">u</span> <span class="main">⊓</span> up_filter <span class="skolem">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> hom <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">z</span><span class="main">,</span><span class="free">phi</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="main">(</span>rho <span class="main">(</span><span class="main">-</span><span class="free">x</span><span class="main">)</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="main">(</span>rho <span class="main">(</span><span class="main">-</span><span class="free">z</span><span class="main">)</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span>up_filter <span class="skolem">u</span> <span class="main">⊓</span> up_filter <span class="skolem">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.sup_commute rho_char<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">z</span><span class="main">,</span><span class="free">phi</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="main">(</span>rho <span class="main">(</span><span class="main">-</span><span class="free">x</span><span class="main">)</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="main">(</span>rho <span class="main">(</span><span class="main">-</span><span class="free">z</span><span class="main">)</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="main">(</span><span class="skolem">u</span> <span class="main">⊔</span> <span class="skolem">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> up_filter_dist_sup<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">z</span><span class="main">,</span><span class="free">phi</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="main">(</span>rho <span class="main">(</span><span class="main">-</span><span class="free">x</span><span class="main">)</span> <span class="skolem">v</span> <span class="main">⊓</span> rho <span class="main">(</span><span class="main">-</span><span class="free">z</span><span class="main">)</span> <span class="skolem">u</span> <span class="main">⊓</span> <span class="main">(</span><span class="skolem">u</span> <span class="main">⊔</span> <span class="skolem">v</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup_commute sup_left_commute up_filter_dist_inf<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> pairs_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Stone_Construction-pairs_inf_closed"><span class="command">lemma</span></span> pairs_inf_closed<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">∈</span> pairs"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">z</span><span class="main">,</span><span class="free">w</span><span class="main">)</span> <span class="main">∈</span> pairs"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pairs_inf <span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">(</span><span class="free">z</span><span class="main">,</span><span class="free">w</span><span class="main">)</span> <span class="main">∈</span> pairs"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="free">phi</span> <span class="main">(</span><span class="main">-</span><span class="free">x</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="skolem">u</span> <span class="main">∧</span> <span class="free">w</span> <span class="main">=</span> <span class="free">phi</span> <span class="main">(</span><span class="main">-</span><span class="free">z</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> pairs_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"pairs_inf <span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">(</span><span class="free">z</span><span class="main">,</span><span class="free">w</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">,</span><span class="main">(</span><span class="free">phi</span> <span class="main">(</span><span class="main">-</span><span class="free">x</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="skolem">u</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="free">phi</span> <span class="main">(</span><span class="main">-</span><span class="free">z</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="skolem">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">,</span><span class="main">(</span><span class="free">phi</span> <span class="main">(</span><span class="main">-</span><span class="free">x</span><span class="main">)</span> <span class="main">⊔</span> <span class="free">phi</span> <span class="main">(</span><span class="main">-</span><span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span>up_filter <span class="skolem">u</span> <span class="main">⊔</span> up_filter <span class="skolem">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup_commute sup_left_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">,</span><span class="free">phi</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span>up_filter <span class="skolem">u</span> <span class="main">⊔</span> up_filter <span class="skolem">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> hom <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">,</span><span class="free">phi</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="main">(</span><span class="skolem">u</span> <span class="main">⊓</span> <span class="skolem">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> up_filter_dist_inf<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> pairs_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Stone_Construction-pairs_uminus_closed"><span class="command">lemma</span></span> pairs_uminus_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"pairs_uminus <span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">∈</span> pairs"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pairs_uminus <span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="free">x</span><span class="main">,</span><span class="free">phi</span> <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="free">x</span><span class="main">)</span> <span class="main">⊔</span> bot<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="free">x</span><span class="main">,</span><span class="free">phi</span> <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="free">x</span><span class="main">)</span> <span class="main">⊔</span> up_filter top<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bot_filter.abs_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> mem_Collect_eq old.prod.case pairs_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Stone_Construction-pairs_bot_closed"><span class="command">lemma</span></span> pairs_bot_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"pairs_bot <span class="main">∈</span> pairs"</span></span>
  <span class="keyword1"><span class="command">using</span></span> pairs_def phi_top triple.hom triple_axioms <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Stone_Construction-pairs_top_closed"><span class="command">lemma</span></span> pairs_top_closed<span class="main">:</span>
  <span class="quoted"><span class="quoted">"pairs_top <span class="main">∈</span> pairs"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> p_bot pairs_uminus.simps pairs_uminus_closed phi_bot<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We prove enough properties of the pair operations so that we can later show they form a Stone algebra.
›</span></span>

<span class="keyword1" id="Stone_Construction-pairs_sup_dist_inf"><span class="command">lemma</span></span> pairs_sup_dist_inf<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">∈</span> pairs <span class="main">⟹</span> <span class="main">(</span><span class="free">z</span><span class="main">,</span><span class="free">w</span><span class="main">)</span> <span class="main">∈</span> pairs <span class="main">⟹</span> <span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">)</span> <span class="main">∈</span> pairs <span class="main">⟹</span> pairs_sup <span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">(</span>pairs_inf <span class="main">(</span><span class="free">z</span><span class="main">,</span><span class="free">w</span><span class="main">)</span> <span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> pairs_inf <span class="main">(</span>pairs_sup <span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">(</span><span class="free">z</span><span class="main">,</span><span class="free">w</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>pairs_sup <span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> sup_inf_distrib1 inf_sup_distrib1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Stone_Construction-pairs_phi_less_eq"><span class="command">lemma</span></span> pairs_phi_less_eq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">∈</span> pairs <span class="main">⟹</span> <span class="free">phi</span> <span class="main">(</span><span class="main">-</span><span class="free">x</span><span class="main">)</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> pairs_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Stone_Construction-pairs_uminus_galois"><span class="command">lemma</span></span> pairs_uminus_galois<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">∈</span> pairs"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">z</span><span class="main">,</span><span class="free">w</span><span class="main">)</span> <span class="main">∈</span> pairs"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pairs_inf <span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">(</span><span class="free">z</span><span class="main">,</span><span class="free">w</span><span class="main">)</span> <span class="main">=</span> pairs_bot <span class="main">⟷</span> pairs_less_eq <span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">(</span>pairs_uminus <span class="main">(</span><span class="free">z</span><span class="main">,</span><span class="free">w</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊓</span> <span class="free">z</span> <span class="main">=</span> bot <span class="main">∧</span> <span class="free">y</span> <span class="main">⊔</span> <span class="free">w</span> <span class="main">=</span> Abs_filter UNIV <span class="main">⟶</span> <span class="free">phi</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> heyting.implies_inf_absorb hom le_supE pairs_phi_less_eq sup_bot_right<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="main">-</span><span class="free">z</span> <span class="main">∧</span> <span class="free">phi</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟶</span> <span class="free">y</span> <span class="main">⊔</span> <span class="free">w</span> <span class="main">=</span> Abs_filter UNIV"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="main">-</span><span class="free">z</span> <span class="main">∧</span> <span class="free">phi</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Abs_filter UNIV <span class="main">=</span> <span class="free">phi</span> <span class="free">z</span> <span class="main">⊔</span> <span class="free">phi</span> <span class="main">(</span><span class="main">-</span><span class="free">z</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> hom phi_complemented phi_top <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⊔</span> <span class="free">w</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 3 assms<span class="main">(</span>2<span class="main">)</span> sup_mono pairs_phi_less_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">⊔</span> <span class="free">w</span> <span class="main">=</span> Abs_filter UNIV"</span></span>
      <span class="keyword1"><span class="command">using</span></span> hom phi_top top.extremum_uniqueI <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊓</span> <span class="free">z</span> <span class="main">=</span> bot <span class="main">⟷</span> <span class="free">x</span> <span class="main">≤</span> <span class="main">-</span><span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> shunting_1<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 2 Pair_inject pairs_inf.simps pairs_less_eq.simps pairs_uminus.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Stone_Construction-pairs_stone"><span class="command">lemma</span></span> pairs_stone<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">∈</span> pairs <span class="main">⟹</span> pairs_sup <span class="main">(</span>pairs_uminus <span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>pairs_uminus <span class="main">(</span>pairs_uminus <span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> pairs_top"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hom pairs_sup.simps pairs_uminus.simps phi_bot phi_complemented stone<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following results show how the regular elements and the dense elements among the pairs look like.
›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">dense_pairs</span> <span class="main">≡</span> <span class="main">{</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> pairs <span class="main">∧</span> pairs_uminus <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">=</span> pairs_bot <span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">regular_pairs</span> <span class="main">≡</span> <span class="main">{</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> pairs <span class="main">∧</span> pairs_uminus <span class="main">(</span>pairs_uminus <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_principal_up_filter</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="main">∃</span><span class="bound">y</span> <span class="main">.</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> up_filter <span class="bound">y</span>"</span></span>

<span class="keyword1" id="Stone_Construction-dense_pairs"><span class="command">lemma</span></span> dense_pairs<span class="main">:</span>
  <span class="quoted"><span class="quoted">"dense_pairs <span class="main">=</span> <span class="main">{</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">=</span> top <span class="main">∧</span> is_principal_up_filter <span class="bound">y</span> <span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dense_pairs <span class="main">=</span> <span class="main">{</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> pairs <span class="main">∧</span> <span class="bound">x</span> <span class="main">=</span> top <span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Pair_inject compl_bot_eq double_compl pairs_uminus.simps phi_top<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">{</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">z</span> <span class="main">.</span> <span class="bound">y</span> <span class="main">=</span> up_filter <span class="bound">z</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">=</span> top <span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> hom pairs_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Stone_Construction-regular_pairs"><span class="command">lemma</span></span> regular_pairs<span class="main">:</span>
  <span class="quoted"><span class="quoted">"regular_pairs <span class="main">=</span> <span class="main">{</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">.</span> <span class="bound">y</span> <span class="main">=</span> <span class="free">phi</span> <span class="main">(</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span> <span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> pairs_def pairs_uminus_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following extraction function will be used in defining one direction of the Stone algebra isomorphism.
›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">rho_pair</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'b</span> filter <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">rho_pair</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">z</span> <span class="main">.</span> up_filter <span class="bound">z</span> <span class="main">=</span> <span class="free">phi</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊓</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Stone_Construction-get_rho_pair_char"><span class="command">lemma</span></span> get_rho_pair_char<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">∈</span> pairs"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"up_filter <span class="main">(</span>rho_pair <span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">phi</span> <span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="free">phi</span> <span class="main">(</span><span class="main">-</span><span class="free">x</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="skolem">w</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> pairs_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">phi</span> <span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span> <span class="main">=</span> <span class="free">phi</span> <span class="free">x</span> <span class="main">⊓</span> up_filter <span class="skolem">w</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_sup_distrib1 phi_complemented<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> rho_char <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Stone_Construction-sa_iso_pair"><span class="command">lemma</span></span> sa_iso_pair<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="free">x</span><span class="main">,</span><span class="free">phi</span> <span class="main">(</span><span class="main">-</span><span class="free">x</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="free">y</span><span class="main">)</span> <span class="main">∈</span> pairs"</span></span>
  <span class="keyword1"><span class="command">using</span></span> pairs_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The Stone Algebra of a Triple›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
In this section we prove that the set of pairs constructed in a triple forms a Stone Algebra.
The following type captures the parameter <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>phi›</span></span></span></span> on which the type of triples depends.
This parameter is the structure map that occurs in the definition of the set of pairs.
The set of all structure maps is the set of all bounded lattice homomorphisms (of appropriate type).
In order to make it a HOL type, we need to show that at least one such structure map exists.
To this end we use the ultrafilter lemma: the required bounded lattice homomorphism is essentially the characteristic map of an ultrafilter, but the latter must exist.
In particular, the underlying Boolean algebra must contain at least two elements.
›</span></span>

<span class="keyword1"><span class="command">typedef</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">overloaded</span></span><span class="main">)</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> phi <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span> <span class="bound">f</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>non_trivial_boolean_algebra <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>distrib_lattice_top filter <span class="main">.</span> bounded_lattice_homomorphism <span class="bound">f</span> <span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> ultra_filter_exists <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">F</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"ultra_filter <span class="skolem">F</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"prime_filter <span class="skolem">F</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ultra_filter_prime <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span> <span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span><span class="main">∈</span><span class="skolem">F</span> <span class="keyword1">then</span> top <span class="keyword1">else</span> bot<span class="main">::</span><span class="tfree">'b</span> filter"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bounded_lattice_homomorphism <span class="var">?f</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> bot <span class="main">=</span> bot"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> bot.extremum filter_def subset_eq top.extremum_unique<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> top <span class="main">=</span> top"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span> <span class="main">.</span> <span class="var">?f</span> <span class="main">(</span><span class="bound">x</span> <span class="main">⊔</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="var">?f</span> <span class="bound">x</span> <span class="main">⊔</span> <span class="var">?f</span> <span class="bound">y</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="var">?f</span> <span class="skolem">x</span> <span class="main">⊔</span> <span class="var">?f</span> <span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">F</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">F</span>"</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> 1 filter_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">using</span></span> 1 filter_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">using</span></span> 1 filter_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">using</span></span> 2 sup_bot_left <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span> <span class="main">.</span> <span class="var">?f</span> <span class="main">(</span><span class="bound">x</span> <span class="main">⊓</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="var">?f</span> <span class="bound">x</span> <span class="main">⊓</span> <span class="var">?f</span> <span class="bound">y</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊓</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="var">?f</span> <span class="skolem">x</span> <span class="main">⊓</span> <span class="var">?f</span> <span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">F</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">F</span>"</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> filter_inf_closed<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> brouwer.inf_sup_ord<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> inf_top_left filter_def<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> brouwer.inf_sup_ord<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> inf_top_right filter_def<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> 1 filter_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">f</span> <span class="main">.</span> bounded_lattice_homomorphism <span class="bound">f</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Stone_Construction-simp_phi"><span class="command">lemma</span></span> simp_phi <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"bounded_lattice_homomorphism <span class="main">(</span>Rep_phi <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Rep_phi <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">setup_lifting</span></span> type_definition_phi

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following implements the dependent type of pairs depending on structure maps.
It uses functions from structure maps to pairs with the requirement that, for each structure map, the corresponding pair is contained in the set of pairs constructed for a triple with that structure map.

If this type could be defined in the locale <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>triple›</span></span></span></span> and instantiated to Stone algebras there, there would be no need for the lifting and we could work with triples directly.
›</span></span>

<span class="keyword1"><span class="command">typedef</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">overloaded</span></span><span class="main">)</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> lifted_pair <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span> <span class="bound">pf</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>non_trivial_boolean_algebra<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>distrib_lattice_top<span class="main">)</span> phi <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'b</span> filter <span class="main">.</span> <span class="main">∀</span><span class="bound">f</span> <span class="main">.</span> <span class="bound">pf</span> <span class="bound">f</span> <span class="main">∈</span> triple.pairs <span class="main">(</span>Rep_phi <span class="bound">f</span><span class="main">)</span> <span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">f</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> phi <span class="main">.</span> triple.pairs_bot <span class="main">∈</span> triple.pairs <span class="main">(</span>Rep_phi <span class="bound">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> phi"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"triple <span class="main">(</span>Rep_phi <span class="skolem">f</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> triple_def<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"triple.pairs_bot <span class="main">∈</span> triple.pairs <span class="main">(</span>Rep_phi <span class="skolem">f</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> triple.regular_pairs triple.phi_top <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Stone_Construction-simp_lifted_pair"><span class="command">lemma</span></span> simp_lifted_pair <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">f</span> <span class="main">.</span> Rep_lifted_pair <span class="free">pf</span> <span class="bound">f</span> <span class="main">∈</span> triple.pairs <span class="main">(</span>Rep_phi <span class="bound">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Rep_lifted_pair <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">setup_lifting</span></span> type_definition_lifted_pair

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The lifted pairs form a Stone algebra.
›</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> lifted_pair <span class="main">::</span> <span class="main">(</span><span class="quoted">non_trivial_boolean_algebra</span><span class="main">,</span><span class="quoted">distrib_lattice_top</span><span class="main">)</span> <span class="quoted">stone_algebra</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
All operations are lifted point-wise.
›</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">sup_lifted_pair</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> lifted_pair <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> lifted_pair <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> lifted_pair"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">xf</span> <span class="bound">yf</span> <span class="bound">f</span> <span class="main">.</span> triple.pairs_sup <span class="main">(</span><span class="bound">xf</span> <span class="bound">f</span><span class="main">)</span> <span class="main">(</span><span class="bound">yf</span> <span class="bound">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> simp_phi triple_def triple.pairs_sup_closed prod.collapse<span class="main">)</span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">inf_lifted_pair</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> lifted_pair <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> lifted_pair <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> lifted_pair"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">xf</span> <span class="bound">yf</span> <span class="bound">f</span> <span class="main">.</span> triple.pairs_inf <span class="main">(</span><span class="bound">xf</span> <span class="bound">f</span><span class="main">)</span> <span class="main">(</span><span class="bound">yf</span> <span class="bound">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> simp_phi triple_def triple.pairs_inf_closed prod.collapse<span class="main">)</span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">uminus_lifted_pair</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> lifted_pair <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> lifted_pair"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">xf</span> <span class="bound">f</span> <span class="main">.</span> triple.pairs_uminus <span class="main">(</span>Rep_phi <span class="bound">f</span><span class="main">)</span> <span class="main">(</span><span class="bound">xf</span> <span class="bound">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> simp_phi triple_def triple.pairs_uminus_closed prod.collapse<span class="main">)</span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">bot_lifted_pair</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> lifted_pair"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> triple.pairs_bot"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> simp_phi triple_def triple.pairs_bot_closed<span class="main">)</span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">top_lifted_pair</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> lifted_pair"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> triple.pairs_top"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> simp_phi triple_def triple.pairs_top_closed<span class="main">)</span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">less_eq_lifted_pair</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> lifted_pair <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> lifted_pair <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">xf</span> <span class="bound">yf</span> <span class="main">.</span> <span class="main">∀</span><span class="bound">f</span> <span class="main">.</span> triple.pairs_less_eq <span class="main">(</span><span class="bound">xf</span> <span class="bound">f</span><span class="main">)</span> <span class="main">(</span><span class="bound">yf</span> <span class="bound">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">less_lifted_pair</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> lifted_pair <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> lifted_pair <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">xf</span> <span class="bound">yf</span> <span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">f</span> <span class="main">.</span> triple.pairs_less_eq <span class="main">(</span><span class="bound">xf</span> <span class="bound">f</span><span class="main">)</span> <span class="main">(</span><span class="bound">yf</span> <span class="bound">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> <span class="main">(</span><span class="main">∀</span><span class="bound">f</span> <span class="main">.</span> triple.pairs_less_eq <span class="main">(</span><span class="bound">yf</span> <span class="bound">f</span><span class="main">)</span> <span class="main">(</span><span class="bound">xf</span> <span class="bound">f</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">instance</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">intro_classes</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xf</span> <span class="skolem">yf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> lifted_pair"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xf</span> <span class="main">&lt;</span> <span class="skolem">yf</span> <span class="main">⟷</span> <span class="skolem">xf</span> <span class="main">≤</span> <span class="skolem">yf</span> <span class="main">∧</span> <span class="main">¬</span> <span class="skolem">yf</span> <span class="main">≤</span> <span class="skolem">xf</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_lifted_pair.rep_eq less_eq_lifted_pair.rep_eq<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> lifted_pair"</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> phi"</span></span>
    <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"triple <span class="main">(</span>Rep_phi <span class="skolem">f</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> triple_def<span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Rep_lifted_pair <span class="skolem">xf</span> <span class="skolem">f</span>"</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x1</span></span> <span class="skolem"><span class="skolem">x2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">)</span> <span class="main">=</span> <span class="var">?x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> prod.collapse <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"triple.pairs_less_eq <span class="var">?x</span> <span class="var">?x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> triple.pairs_less_eq.simps order_refl<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xf</span> <span class="main">≤</span> <span class="skolem">xf</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_lifted_pair.rep_eq<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xf</span> <span class="skolem">yf</span> <span class="skolem">zf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> lifted_pair"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xf</span> <span class="main">≤</span> <span class="skolem">yf</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">yf</span> <span class="main">≤</span> <span class="skolem">zf</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> phi"</span></span>
    <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"triple <span class="main">(</span>Rep_phi <span class="skolem">f</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> triple_def<span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Rep_lifted_pair <span class="skolem">xf</span> <span class="skolem">f</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?y</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Rep_lifted_pair <span class="skolem">yf</span> <span class="skolem">f</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?z</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Rep_lifted_pair <span class="skolem">zf</span> <span class="skolem">f</span>"</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x1</span></span> <span class="skolem"><span class="skolem">x2</span></span> <span class="skolem"><span class="skolem">y1</span></span> <span class="skolem"><span class="skolem">y2</span></span> <span class="skolem"><span class="skolem">z1</span></span> <span class="skolem"><span class="skolem">z2</span></span> <span class="keyword2"><span class="keyword">where</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">)</span> <span class="main">=</span> <span class="var">?x</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">y1</span><span class="main">,</span><span class="skolem">y2</span><span class="main">)</span> <span class="main">=</span> <span class="var">?y</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">z1</span><span class="main">,</span><span class="skolem">z2</span><span class="main">)</span> <span class="main">=</span> <span class="var">?z</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> prod.collapse <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"triple.pairs_less_eq <span class="var">?x</span> <span class="var">?y</span> <span class="main">∧</span> triple.pairs_less_eq <span class="var">?y</span> <span class="var">?z</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 2 3 less_eq_lifted_pair.rep_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"triple.pairs_less_eq <span class="var">?x</span> <span class="var">?z</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 3 4 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> triple.pairs_less_eq.simps order_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xf</span> <span class="main">≤</span> <span class="skolem">zf</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_lifted_pair.rep_eq<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xf</span> <span class="skolem">yf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> lifted_pair"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xf</span> <span class="main">≤</span> <span class="skolem">yf</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">yf</span> <span class="main">≤</span> <span class="skolem">xf</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> phi"</span></span>
    <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"triple <span class="main">(</span>Rep_phi <span class="skolem">f</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> triple_def<span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Rep_lifted_pair <span class="skolem">xf</span> <span class="skolem">f</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?y</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Rep_lifted_pair <span class="skolem">yf</span> <span class="skolem">f</span>"</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x1</span></span> <span class="skolem"><span class="skolem">x2</span></span> <span class="skolem"><span class="skolem">y1</span></span> <span class="skolem"><span class="skolem">y2</span></span> <span class="keyword2"><span class="keyword">where</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">)</span> <span class="main">=</span> <span class="var">?x</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">y1</span><span class="main">,</span><span class="skolem">y2</span><span class="main">)</span> <span class="main">=</span> <span class="var">?y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> prod.collapse <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"triple.pairs_less_eq <span class="var">?x</span> <span class="var">?y</span> <span class="main">∧</span> triple.pairs_less_eq <span class="var">?y</span> <span class="var">?x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 2 3 less_eq_lifted_pair.rep_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">=</span> <span class="var">?y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 3 4 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> triple.pairs_less_eq.simps antisym<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xf</span> <span class="main">=</span> <span class="skolem">yf</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Rep_lifted_pair_inverse ext<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xf</span> <span class="skolem">yf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> lifted_pair"</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> phi"</span></span>
    <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"triple <span class="main">(</span>Rep_phi <span class="skolem">f</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> triple_def<span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Rep_lifted_pair <span class="skolem">xf</span> <span class="skolem">f</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?y</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Rep_lifted_pair <span class="skolem">yf</span> <span class="skolem">f</span>"</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x1</span></span> <span class="skolem"><span class="skolem">x2</span></span> <span class="skolem"><span class="skolem">y1</span></span> <span class="skolem"><span class="skolem">y2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">)</span> <span class="main">=</span> <span class="var">?x</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">y1</span><span class="main">,</span><span class="skolem">y2</span><span class="main">)</span> <span class="main">=</span> <span class="var">?y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> prod.collapse <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"triple.pairs_less_eq <span class="main">(</span>triple.pairs_inf <span class="var">?x</span> <span class="var">?y</span><span class="main">)</span> <span class="var">?y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> inf_sup_ord<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> sup.cobounded2 triple.pairs_inf.simps triple.pairs_less_eq.simps inf_lifted_pair.rep_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xf</span> <span class="main">⊓</span> <span class="skolem">yf</span> <span class="main">≤</span> <span class="skolem">yf</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_lifted_pair.rep_eq inf_lifted_pair.rep_eq<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xf</span> <span class="skolem">yf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> lifted_pair"</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> phi"</span></span>
    <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"triple <span class="main">(</span>Rep_phi <span class="skolem">f</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> triple_def<span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Rep_lifted_pair <span class="skolem">xf</span> <span class="skolem">f</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?y</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Rep_lifted_pair <span class="skolem">yf</span> <span class="skolem">f</span>"</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x1</span></span> <span class="skolem"><span class="skolem">x2</span></span> <span class="skolem"><span class="skolem">y1</span></span> <span class="skolem"><span class="skolem">y2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">)</span> <span class="main">=</span> <span class="var">?x</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">y1</span><span class="main">,</span><span class="skolem">y2</span><span class="main">)</span> <span class="main">=</span> <span class="var">?y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> prod.collapse <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"triple.pairs_less_eq <span class="main">(</span>triple.pairs_inf <span class="var">?x</span> <span class="var">?y</span><span class="main">)</span> <span class="var">?x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> inf_sup_ord<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> sup.cobounded1 triple.pairs_inf.simps triple.pairs_less_eq.simps inf_lifted_pair.rep_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xf</span> <span class="main">⊓</span> <span class="skolem">yf</span> <span class="main">≤</span> <span class="skolem">xf</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_lifted_pair.rep_eq inf_lifted_pair.rep_eq<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xf</span> <span class="skolem">yf</span> <span class="skolem">zf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> lifted_pair"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xf</span> <span class="main">≤</span> <span class="skolem">yf</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xf</span> <span class="main">≤</span> <span class="skolem">zf</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> phi"</span></span>
    <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"triple <span class="main">(</span>Rep_phi <span class="skolem">f</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> triple_def<span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Rep_lifted_pair <span class="skolem">xf</span> <span class="skolem">f</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?y</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Rep_lifted_pair <span class="skolem">yf</span> <span class="skolem">f</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?z</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Rep_lifted_pair <span class="skolem">zf</span> <span class="skolem">f</span>"</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x1</span></span> <span class="skolem"><span class="skolem">x2</span></span> <span class="skolem"><span class="skolem">y1</span></span> <span class="skolem"><span class="skolem">y2</span></span> <span class="skolem"><span class="skolem">z1</span></span> <span class="skolem"><span class="skolem">z2</span></span> <span class="keyword2"><span class="keyword">where</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">)</span> <span class="main">=</span> <span class="var">?x</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">y1</span><span class="main">,</span><span class="skolem">y2</span><span class="main">)</span> <span class="main">=</span> <span class="var">?y</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">z1</span><span class="main">,</span><span class="skolem">z2</span><span class="main">)</span> <span class="main">=</span> <span class="var">?z</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> prod.collapse <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"triple.pairs_less_eq <span class="var">?x</span> <span class="var">?y</span> <span class="main">∧</span> triple.pairs_less_eq <span class="var">?x</span> <span class="var">?z</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 2 3 less_eq_lifted_pair.rep_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"triple.pairs_less_eq <span class="var">?x</span> <span class="main">(</span>triple.pairs_inf <span class="var">?y</span> <span class="var">?z</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 3 4 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> le_inf_iff sup.bounded_iff triple.pairs_inf.simps triple.pairs_less_eq.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xf</span> <span class="main">≤</span> <span class="skolem">yf</span> <span class="main">⊓</span> <span class="skolem">zf</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_lifted_pair.rep_eq inf_lifted_pair.rep_eq<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xf</span> <span class="skolem">yf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> lifted_pair"</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> phi"</span></span>
    <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"triple <span class="main">(</span>Rep_phi <span class="skolem">f</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> triple_def<span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Rep_lifted_pair <span class="skolem">xf</span> <span class="skolem">f</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?y</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Rep_lifted_pair <span class="skolem">yf</span> <span class="skolem">f</span>"</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x1</span></span> <span class="skolem"><span class="skolem">x2</span></span> <span class="skolem"><span class="skolem">y1</span></span> <span class="skolem"><span class="skolem">y2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">)</span> <span class="main">=</span> <span class="var">?x</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">y1</span><span class="main">,</span><span class="skolem">y2</span><span class="main">)</span> <span class="main">=</span> <span class="var">?y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> prod.collapse <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"triple.pairs_less_eq <span class="var">?x</span> <span class="main">(</span>triple.pairs_sup <span class="var">?x</span> <span class="var">?y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> inf_commute sup.cobounded1 inf.cobounded2 triple.pairs_sup.simps triple.pairs_less_eq.simps sup_lifted_pair.rep_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xf</span> <span class="main">≤</span> <span class="skolem">xf</span> <span class="main">⊔</span> <span class="skolem">yf</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_lifted_pair.rep_eq sup_lifted_pair.rep_eq<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xf</span> <span class="skolem">yf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> lifted_pair"</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> phi"</span></span>
    <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"triple <span class="main">(</span>Rep_phi <span class="skolem">f</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> triple_def<span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Rep_lifted_pair <span class="skolem">xf</span> <span class="skolem">f</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?y</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Rep_lifted_pair <span class="skolem">yf</span> <span class="skolem">f</span>"</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x1</span></span> <span class="skolem"><span class="skolem">x2</span></span> <span class="skolem"><span class="skolem">y1</span></span> <span class="skolem"><span class="skolem">y2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">)</span> <span class="main">=</span> <span class="var">?x</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">y1</span><span class="main">,</span><span class="skolem">y2</span><span class="main">)</span> <span class="main">=</span> <span class="var">?y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> prod.collapse <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"triple.pairs_less_eq <span class="var">?y</span> <span class="main">(</span>triple.pairs_sup <span class="var">?x</span> <span class="var">?y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> sup.cobounded2 inf.cobounded2 triple.pairs_sup.simps triple.pairs_less_eq.simps sup_lifted_pair.rep_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">yf</span> <span class="main">≤</span> <span class="skolem">xf</span> <span class="main">⊔</span> <span class="skolem">yf</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_lifted_pair.rep_eq sup_lifted_pair.rep_eq<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xf</span> <span class="skolem">yf</span> <span class="skolem">zf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> lifted_pair"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">yf</span> <span class="main">≤</span> <span class="skolem">xf</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">zf</span> <span class="main">≤</span> <span class="skolem">xf</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> phi"</span></span>
    <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"triple <span class="main">(</span>Rep_phi <span class="skolem">f</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> triple_def<span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Rep_lifted_pair <span class="skolem">xf</span> <span class="skolem">f</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?y</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Rep_lifted_pair <span class="skolem">yf</span> <span class="skolem">f</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?z</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Rep_lifted_pair <span class="skolem">zf</span> <span class="skolem">f</span>"</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x1</span></span> <span class="skolem"><span class="skolem">x2</span></span> <span class="skolem"><span class="skolem">y1</span></span> <span class="skolem"><span class="skolem">y2</span></span> <span class="skolem"><span class="skolem">z1</span></span> <span class="skolem"><span class="skolem">z2</span></span> <span class="keyword2"><span class="keyword">where</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">)</span> <span class="main">=</span> <span class="var">?x</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">y1</span><span class="main">,</span><span class="skolem">y2</span><span class="main">)</span> <span class="main">=</span> <span class="var">?y</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">z1</span><span class="main">,</span><span class="skolem">z2</span><span class="main">)</span> <span class="main">=</span> <span class="var">?z</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> prod.collapse <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"triple.pairs_less_eq <span class="var">?y</span> <span class="var">?x</span> <span class="main">∧</span> triple.pairs_less_eq <span class="var">?z</span> <span class="var">?x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 2 3 less_eq_lifted_pair.rep_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"triple.pairs_less_eq <span class="main">(</span>triple.pairs_sup <span class="var">?y</span> <span class="var">?z</span><span class="main">)</span> <span class="var">?x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 3 4 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> le_inf_iff sup.bounded_iff triple.pairs_sup.simps triple.pairs_less_eq.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">yf</span> <span class="main">⊔</span> <span class="skolem">zf</span> <span class="main">≤</span> <span class="skolem">xf</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_lifted_pair.rep_eq sup_lifted_pair.rep_eq<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> lifted_pair"</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> phi"</span></span>
    <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"triple <span class="main">(</span>Rep_phi <span class="skolem">f</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> triple_def<span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Rep_lifted_pair <span class="skolem">xf</span> <span class="skolem">f</span>"</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x1</span></span> <span class="skolem"><span class="skolem">x2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">)</span> <span class="main">=</span> <span class="var">?x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> prod.collapse <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"triple.pairs_less_eq triple.pairs_bot <span class="var">?x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bot.extremum top_greatest top_filter.abs_eq triple.pairs_less_eq.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"bot <span class="main">≤</span> <span class="skolem">xf</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_lifted_pair.rep_eq bot_lifted_pair.rep_eq<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> lifted_pair"</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> phi"</span></span>
    <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"triple <span class="main">(</span>Rep_phi <span class="skolem">f</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> triple_def<span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Rep_lifted_pair <span class="skolem">xf</span> <span class="skolem">f</span>"</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x1</span></span> <span class="skolem"><span class="skolem">x2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">)</span> <span class="main">=</span> <span class="var">?x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> prod.collapse <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"triple.pairs_less_eq <span class="var">?x</span> triple.pairs_top"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> top.extremum bot_least bot_filter.abs_eq triple.pairs_less_eq.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xf</span> <span class="main">≤</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_lifted_pair.rep_eq top_lifted_pair.rep_eq<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xf</span> <span class="skolem">yf</span> <span class="skolem">zf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> lifted_pair"</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> phi"</span></span>
    <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"triple <span class="main">(</span>Rep_phi <span class="skolem">f</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> triple_def<span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Rep_lifted_pair <span class="skolem">xf</span> <span class="skolem">f</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?y</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Rep_lifted_pair <span class="skolem">yf</span> <span class="skolem">f</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?z</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Rep_lifted_pair <span class="skolem">zf</span> <span class="skolem">f</span>"</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x1</span></span> <span class="skolem"><span class="skolem">x2</span></span> <span class="skolem"><span class="skolem">y1</span></span> <span class="skolem"><span class="skolem">y2</span></span> <span class="skolem"><span class="skolem">z1</span></span> <span class="skolem"><span class="skolem">z2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">)</span> <span class="main">=</span> <span class="var">?x</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">y1</span><span class="main">,</span><span class="skolem">y2</span><span class="main">)</span> <span class="main">=</span> <span class="var">?y</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">z1</span><span class="main">,</span><span class="skolem">z2</span><span class="main">)</span> <span class="main">=</span> <span class="var">?z</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> prod.collapse <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"triple.pairs_sup <span class="var">?x</span> <span class="main">(</span>triple.pairs_inf <span class="var">?y</span> <span class="var">?z</span><span class="main">)</span> <span class="main">=</span> triple.pairs_inf <span class="main">(</span>triple.pairs_sup <span class="var">?x</span> <span class="var">?y</span><span class="main">)</span> <span class="main">(</span>triple.pairs_sup <span class="var">?x</span> <span class="var">?z</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> sup_inf_distrib1 inf_sup_distrib1 triple.pairs_sup.simps triple.pairs_inf.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xf</span> <span class="main">⊔</span> <span class="main">(</span><span class="skolem">yf</span> <span class="main">⊓</span> <span class="skolem">zf</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">xf</span> <span class="main">⊔</span> <span class="skolem">yf</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="skolem">xf</span> <span class="main">⊔</span> <span class="skolem">zf</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Rep_lifted_pair_inverse ext sup_lifted_pair.rep_eq inf_lifted_pair.rep_eq<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xf</span> <span class="skolem">yf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> lifted_pair"</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> phi"</span></span>
    <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"triple <span class="main">(</span>Rep_phi <span class="skolem">f</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> triple_def<span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Rep_lifted_pair <span class="skolem">xf</span> <span class="skolem">f</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?y</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Rep_lifted_pair <span class="skolem">yf</span> <span class="skolem">f</span>"</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x1</span></span> <span class="skolem"><span class="skolem">x2</span></span> <span class="skolem"><span class="skolem">y1</span></span> <span class="skolem"><span class="skolem">y2</span></span> <span class="keyword2"><span class="keyword">where</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">)</span> <span class="main">=</span> <span class="var">?x</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">y1</span><span class="main">,</span><span class="skolem">y2</span><span class="main">)</span> <span class="main">=</span> <span class="var">?y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> prod.collapse <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">∈</span> triple.pairs <span class="main">(</span>Rep_phi <span class="skolem">f</span><span class="main">)</span> <span class="main">∧</span> <span class="var">?y</span> <span class="main">∈</span> triple.pairs <span class="main">(</span>Rep_phi <span class="skolem">f</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>triple.pairs_inf <span class="var">?x</span> <span class="var">?y</span> <span class="main">=</span> triple.pairs_bot<span class="main">)</span> <span class="main">⟷</span> triple.pairs_less_eq <span class="var">?x</span> <span class="main">(</span>triple.pairs_uminus <span class="main">(</span>Rep_phi <span class="skolem">f</span><span class="main">)</span> <span class="var">?y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> triple.pairs_uminus_galois<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">f</span> <span class="main">.</span> <span class="main">(</span>Rep_lifted_pair <span class="main">(</span><span class="skolem">xf</span> <span class="main">⊓</span> <span class="skolem">yf</span><span class="main">)</span> <span class="bound">f</span> <span class="main">=</span> Rep_lifted_pair bot <span class="bound">f</span><span class="main">)</span> <span class="main">⟷</span> triple.pairs_less_eq <span class="main">(</span>Rep_lifted_pair <span class="skolem">xf</span> <span class="bound">f</span><span class="main">)</span> <span class="main">(</span>Rep_lifted_pair <span class="main">(</span><span class="main">-</span><span class="skolem">yf</span><span class="main">)</span> <span class="bound">f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> bot_lifted_pair.rep_eq inf_lifted_pair.rep_eq uminus_lifted_pair.rep_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Rep_lifted_pair <span class="main">(</span><span class="skolem">xf</span> <span class="main">⊓</span> <span class="skolem">yf</span><span class="main">)</span> <span class="main">=</span> Rep_lifted_pair bot<span class="main">)</span> <span class="main">⟷</span> <span class="skolem">xf</span> <span class="main">≤</span> <span class="main">-</span><span class="skolem">yf</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> less_eq_lifted_pair.rep_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">xf</span> <span class="main">⊓</span> <span class="skolem">yf</span> <span class="main">=</span> bot<span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="skolem">xf</span> <span class="main">≤</span> <span class="main">-</span><span class="skolem">yf</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Rep_lifted_pair_inject<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> lifted_pair"</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> phi"</span></span>
    <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"triple <span class="main">(</span>Rep_phi <span class="skolem">f</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> triple_def<span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Rep_lifted_pair <span class="skolem">xf</span> <span class="skolem">f</span>"</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x1</span></span> <span class="skolem"><span class="skolem">x2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">)</span> <span class="main">=</span> <span class="var">?x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> prod.collapse <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"triple.pairs_sup <span class="main">(</span>triple.pairs_uminus <span class="main">(</span>Rep_phi <span class="skolem">f</span><span class="main">)</span> <span class="var">?x</span><span class="main">)</span> <span class="main">(</span>triple.pairs_uminus <span class="main">(</span>Rep_phi <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span>triple.pairs_uminus <span class="main">(</span>Rep_phi <span class="skolem">f</span><span class="main">)</span> <span class="var">?x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> triple.pairs_top"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> simp_lifted_pair triple.pairs_stone<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Rep_lifted_pair <span class="main">(</span><span class="main">-</span><span class="skolem">xf</span> <span class="main">⊔</span> <span class="main">-</span><span class="main">-</span><span class="skolem">xf</span><span class="main">)</span> <span class="main">=</span> Rep_lifted_pair top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sup_lifted_pair.rep_eq uminus_lifted_pair.rep_eq top_lifted_pair.rep_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">xf</span> <span class="main">⊔</span> <span class="main">-</span><span class="main">-</span><span class="skolem">xf</span> <span class="main">=</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Rep_lifted_pair_inject<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The Stone Algebra of the Triple of a Stone Algebra›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
In this section we specialise the above construction to a particular structure map, namely the one obtained in the triple of a Stone algebra.
For this particular structure map (as well as for any other particular structure map) the resulting type is no longer a dependent type.
It is just the set of pairs obtained for the given structure map.
›</span></span>

<span class="keyword1"><span class="command">typedef</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">overloaded</span></span><span class="main">)</span> <span class="tfree">'a</span> stone_phi_pair <span class="main">=</span> <span class="quoted"><span class="quoted">"triple.pairs <span class="main">(</span>stone_phi<span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>stone_algebra regular <span class="main">⇒</span> <span class="tfree">'a</span> dense_filter<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> stone_phi.pairs_bot_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">setup_lifting</span></span> type_definition_stone_phi_pair

<span class="keyword1"><span class="command">instantiation</span></span> stone_phi_pair <span class="main">::</span> <span class="main">(</span><span class="quoted">stone_algebra</span><span class="main">)</span> <span class="quoted">sup_inf_top_bot_uminus_ord</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">sup_stone_phi_pair</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> stone_phi_pair <span class="main">⇒</span> <span class="tfree">'a</span> stone_phi_pair <span class="main">⇒</span> <span class="tfree">'a</span> stone_phi_pair"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">triple.pairs_sup</span>
  <span class="keyword1"><span class="command">using</span></span> stone_phi.pairs_sup_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">inf_stone_phi_pair</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> stone_phi_pair <span class="main">⇒</span> <span class="tfree">'a</span> stone_phi_pair <span class="main">⇒</span> <span class="tfree">'a</span> stone_phi_pair"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">triple.pairs_inf</span>
  <span class="keyword1"><span class="command">using</span></span> stone_phi.pairs_inf_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">uminus_stone_phi_pair</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> stone_phi_pair <span class="main">⇒</span> <span class="tfree">'a</span> stone_phi_pair"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"triple.pairs_uminus stone_phi"</span></span>
  <span class="keyword1"><span class="command">using</span></span> stone_phi.pairs_uminus_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">bot_stone_phi_pair</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> stone_phi_pair"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"triple.pairs_bot"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> stone_phi.pairs_bot_closed<span class="main">)</span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">top_stone_phi_pair</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> stone_phi_pair"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"triple.pairs_top"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> stone_phi.pairs_top_closed<span class="main">)</span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">less_eq_stone_phi_pair</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> stone_phi_pair <span class="main">⇒</span> <span class="tfree">'a</span> stone_phi_pair <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">triple.pairs_less_eq</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">less_stone_phi_pair</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> stone_phi_pair <span class="main">⇒</span> <span class="tfree">'a</span> stone_phi_pair <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">triple.pairs_less</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="comment1">(*
instantiation stone_phi_pair :: (stone_algebra) stone_algebra
begin

instance
  apply intro_classes
  subgoal apply transfer by auto
  subgoal apply transfer by auto
  subgoal apply transfer by auto
  subgoal apply transfer by auto
  subgoal apply transfer by auto
  subgoal apply transfer by auto
  subgoal apply transfer by auto
  subgoal apply transfer by auto
  subgoal apply transfer by auto
  subgoal apply transfer by auto
  subgoal apply transfer by (metis (no_types, lifting) Pair_inject compl_bot_eq heyting.implies_order stone_phi.pairs_less_eq.elims(3) stone_phi.phi_top stone_phi.triple_axioms sup_top_left top_greatest triple_def)
  subgoal apply transfer by (metis (no_types, lifting) Pair_inject stone_phi.pairs_less_eq.elims(3) top.extremum bot_least bot_filter.abs_eq)
  subgoal apply transfer using stone_phi.triple_axioms triple.pairs_sup_dist_inf by fastforce
  subgoal apply transfer using stone_phi.pairs_uminus_galois by fastforce
  subgoal apply transfer using stone_phi.pairs_stone by fastforce
  done

end
*)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The result is a Stone algebra and could be proved so by repeating and specialising the above proof for lifted pairs.
We choose a different approach, namely by embedding the type of pairs into the lifted type.
The embedding injects a pair <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>x›</span></span></span></span> into a function as the value at the given structure map; this makes the embedding injective.
The value of the function at any other structure map needs to be carefully chosen so that the resulting function is a Stone algebra homomorphism.
We use <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>--x›</span></span></span></span>, which is essentially a projection to the regular element component of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>x›</span></span></span></span>, whence the image has the structure of a Boolean algebra.
›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">stone_phi_embed</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>non_trivial_stone_algebra stone_phi_pair <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> regular<span class="main">,</span><span class="tfree">'a</span> dense<span class="main">)</span> lifted_pair"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">stone_phi_embed</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> Abs_lifted_pair <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> <span class="keyword1">if</span> Rep_phi <span class="bound">f</span> <span class="main">=</span> stone_phi <span class="keyword1">then</span> Rep_stone_phi_pair <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">else</span> triple.pairs_uminus <span class="main">(</span>Rep_phi <span class="bound">f</span><span class="main">)</span> <span class="main">(</span>triple.pairs_uminus <span class="main">(</span>Rep_phi <span class="bound">f</span><span class="main">)</span> <span class="main">(</span>Rep_stone_phi_pair <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following lemma shows that in both cases the value of the function is a valid pair for the given structure map.
›</span></span>

<span class="keyword1" id="Stone_Construction-stone_phi_embed_triple_pair"><span class="command">lemma</span></span> stone_phi_embed_triple_pair<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> Rep_phi <span class="free">f</span> <span class="main">=</span> stone_phi <span class="keyword1">then</span> Rep_stone_phi_pair <span class="free">x</span> <span class="keyword1">else</span> triple.pairs_uminus <span class="main">(</span>Rep_phi <span class="free">f</span><span class="main">)</span> <span class="main">(</span>triple.pairs_uminus <span class="main">(</span>Rep_phi <span class="free">f</span><span class="main">)</span> <span class="main">(</span>Rep_stone_phi_pair <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> triple.pairs <span class="main">(</span>Rep_phi <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> Rep_stone_phi_pair simp_phi surj_pair triple.pairs_uminus_closed triple_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following result shows that the embedding preserves the operations of Stone algebras.
Of course, it is not (yet) a Stone algebra homomorphism as we do not know (yet) that the domain of the embedding is a Stone algebra.
To establish the latter is the purpose of the embedding.
›</span></span>

<span class="keyword1" id="Stone_Construction-stone_phi_embed_homomorphism"><span class="command">lemma</span></span> stone_phi_embed_homomorphism<span class="main">:</span>
  <span class="quoted"><span class="quoted">"sup_inf_top_bot_uminus_ord_homomorphism stone_phi_embed"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> triple.pairs_uminus <span class="main">(</span>Rep_phi <span class="bound">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?pp</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">f</span> <span class="bound">x</span> <span class="main">.</span> <span class="var">?p</span> <span class="bound">f</span> <span class="main">(</span><span class="var">?p</span> <span class="bound">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?q</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">f</span> <span class="bound">x</span> <span class="main">.</span> <span class="var">?pp</span> <span class="bound">f</span> <span class="main">(</span>Rep_stone_phi_pair <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">::</span><span class="tfree">'a</span> stone_phi_pair <span class="main">.</span> stone_phi_embed <span class="main">(</span><span class="bound">x</span> <span class="main">⊔</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> stone_phi_embed <span class="bound">x</span> <span class="main">⊔</span> stone_phi_embed <span class="bound">y</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> stone_phi_pair"</span></span>
    <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">f</span> <span class="main">.</span> triple.pairs_sup <span class="main">(</span><span class="var">?q</span> <span class="bound">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="var">?q</span> <span class="bound">f</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="var">?q</span> <span class="bound">f</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> regular<span class="main">,</span><span class="tfree">'a</span> dense<span class="main">)</span> phi"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Rep_phi <span class="skolem">f</span>"</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x1</span></span> <span class="skolem"><span class="skolem">x2</span></span> <span class="skolem"><span class="skolem">y1</span></span> <span class="skolem"><span class="skolem">y2</span></span> <span class="keyword2"><span class="keyword">where</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">)</span> <span class="main">=</span> Rep_stone_phi_pair <span class="skolem">x</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">y1</span><span class="main">,</span><span class="skolem">y2</span><span class="main">)</span> <span class="main">=</span> Rep_stone_phi_pair <span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> prod.collapse <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"triple.pairs_sup <span class="main">(</span><span class="var">?q</span> <span class="skolem">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="var">?q</span> <span class="skolem">f</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> triple.pairs_sup <span class="main">(</span><span class="var">?pp</span> <span class="skolem">f</span> <span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="var">?pp</span> <span class="skolem">f</span> <span class="main">(</span><span class="skolem">y1</span><span class="main">,</span><span class="skolem">y2</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> triple.pairs_sup <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="skolem">x1</span><span class="main">,</span><span class="var">?r</span> <span class="main">(</span><span class="main">-</span><span class="skolem">x1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="skolem">y1</span><span class="main">,</span><span class="var">?r</span> <span class="main">(</span><span class="main">-</span><span class="skolem">y1</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> triple.pairs_uminus.simps triple_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="skolem">x1</span> <span class="main">⊔</span> <span class="main">-</span><span class="main">-</span><span class="skolem">y1</span><span class="main">,</span><span class="var">?r</span> <span class="main">(</span><span class="main">-</span><span class="skolem">x1</span><span class="main">)</span> <span class="main">⊓</span> <span class="var">?r</span> <span class="main">(</span><span class="main">-</span><span class="skolem">y1</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="skolem">x1</span> <span class="main">⊔</span> <span class="skolem">y1</span><span class="main">)</span><span class="main">,</span><span class="var">?r</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="skolem">x1</span> <span class="main">⊔</span> <span class="skolem">y1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?pp</span> <span class="skolem">f</span> <span class="main">(</span><span class="skolem">x1</span> <span class="main">⊔</span> <span class="skolem">y1</span><span class="main">,</span><span class="skolem">x2</span> <span class="main">⊓</span> <span class="skolem">y2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> triple.pairs_uminus.simps triple_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?pp</span> <span class="skolem">f</span> <span class="main">(</span>triple.pairs_sup <span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">)</span> <span class="main">(</span><span class="skolem">y1</span><span class="main">,</span><span class="skolem">y2</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?q</span> <span class="skolem">f</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup_stone_phi_pair.rep_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"triple.pairs_sup <span class="main">(</span><span class="var">?q</span> <span class="skolem">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="var">?q</span> <span class="skolem">f</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="var">?q</span> <span class="skolem">f</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"stone_phi_embed <span class="skolem">x</span> <span class="main">⊔</span> stone_phi_embed <span class="skolem">y</span> <span class="main">=</span> Abs_lifted_pair <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> <span class="keyword1">if</span> Rep_phi <span class="bound">f</span> <span class="main">=</span> stone_phi <span class="keyword1">then</span> Rep_stone_phi_pair <span class="skolem">x</span> <span class="keyword1">else</span> <span class="var">?q</span> <span class="bound">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">⊔</span> Abs_lifted_pair <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> <span class="keyword1">if</span> Rep_phi <span class="bound">f</span> <span class="main">=</span> stone_phi <span class="keyword1">then</span> Rep_stone_phi_pair <span class="skolem">y</span> <span class="keyword1">else</span> <span class="var">?q</span> <span class="bound">f</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Abs_lifted_pair <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> triple.pairs_sup <span class="main">(</span><span class="keyword1">if</span> Rep_phi <span class="bound">f</span> <span class="main">=</span> stone_phi <span class="keyword1">then</span> Rep_stone_phi_pair <span class="skolem">x</span> <span class="keyword1">else</span> <span class="var">?q</span> <span class="bound">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">if</span> Rep_phi <span class="bound">f</span> <span class="main">=</span> stone_phi <span class="keyword1">then</span> Rep_stone_phi_pair <span class="skolem">y</span> <span class="keyword1">else</span> <span class="var">?q</span> <span class="bound">f</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sup_lifted_pair.abs_eq<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_onp_same_args stone_phi_embed_triple_pair<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Abs_lifted_pair <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> <span class="keyword1">if</span> Rep_phi <span class="bound">f</span> <span class="main">=</span> stone_phi <span class="keyword1">then</span> triple.pairs_sup <span class="main">(</span>Rep_stone_phi_pair <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>Rep_stone_phi_pair <span class="skolem">y</span><span class="main">)</span> <span class="keyword1">else</span> triple.pairs_sup <span class="main">(</span><span class="var">?q</span> <span class="bound">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="var">?q</span> <span class="bound">f</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> if_distrib_2<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Abs_lifted_pair <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> <span class="keyword1">if</span> Rep_phi <span class="bound">f</span> <span class="main">=</span> stone_phi <span class="keyword1">then</span> triple.pairs_sup <span class="main">(</span>Rep_stone_phi_pair <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>Rep_stone_phi_pair <span class="skolem">y</span><span class="main">)</span> <span class="keyword1">else</span> <span class="var">?q</span> <span class="bound">f</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Abs_lifted_pair <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> <span class="keyword1">if</span> Rep_phi <span class="bound">f</span> <span class="main">=</span> stone_phi <span class="keyword1">then</span> Rep_stone_phi_pair <span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span><span class="main">)</span> <span class="keyword1">else</span> <span class="var">?q</span> <span class="bound">f</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sup_stone_phi_pair.rep_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> stone_phi_embed <span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"stone_phi_embed <span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> stone_phi_embed <span class="skolem">x</span> <span class="main">⊔</span> stone_phi_embed <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> triple.pairs_uminus <span class="main">(</span>Rep_phi <span class="bound">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?pp</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">f</span> <span class="bound">x</span> <span class="main">.</span> <span class="var">?p</span> <span class="bound">f</span> <span class="main">(</span><span class="var">?p</span> <span class="bound">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?q</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">f</span> <span class="bound">x</span> <span class="main">.</span> <span class="var">?pp</span> <span class="bound">f</span> <span class="main">(</span>Rep_stone_phi_pair <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">::</span><span class="tfree">'a</span> stone_phi_pair <span class="main">.</span> stone_phi_embed <span class="main">(</span><span class="bound">x</span> <span class="main">⊓</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> stone_phi_embed <span class="bound">x</span> <span class="main">⊓</span> stone_phi_embed <span class="bound">y</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> stone_phi_pair"</span></span>
    <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">f</span> <span class="main">.</span> triple.pairs_inf <span class="main">(</span><span class="var">?q</span> <span class="bound">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="var">?q</span> <span class="bound">f</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="var">?q</span> <span class="bound">f</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊓</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> regular<span class="main">,</span><span class="tfree">'a</span> dense<span class="main">)</span> phi"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Rep_phi <span class="skolem">f</span>"</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x1</span></span> <span class="skolem"><span class="skolem">x2</span></span> <span class="skolem"><span class="skolem">y1</span></span> <span class="skolem"><span class="skolem">y2</span></span> <span class="keyword2"><span class="keyword">where</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">)</span> <span class="main">=</span> Rep_stone_phi_pair <span class="skolem">x</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">y1</span><span class="main">,</span><span class="skolem">y2</span><span class="main">)</span> <span class="main">=</span> Rep_stone_phi_pair <span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> prod.collapse <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"triple.pairs_inf <span class="main">(</span><span class="var">?q</span> <span class="skolem">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="var">?q</span> <span class="skolem">f</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> triple.pairs_inf <span class="main">(</span><span class="var">?pp</span> <span class="skolem">f</span> <span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="var">?pp</span> <span class="skolem">f</span> <span class="main">(</span><span class="skolem">y1</span><span class="main">,</span><span class="skolem">y2</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> triple.pairs_inf <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="skolem">x1</span><span class="main">,</span><span class="var">?r</span> <span class="main">(</span><span class="main">-</span><span class="skolem">x1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="skolem">y1</span><span class="main">,</span><span class="var">?r</span> <span class="main">(</span><span class="main">-</span><span class="skolem">y1</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> triple.pairs_uminus.simps triple_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="skolem">x1</span> <span class="main">⊓</span> <span class="main">-</span><span class="main">-</span><span class="skolem">y1</span><span class="main">,</span><span class="var">?r</span> <span class="main">(</span><span class="main">-</span><span class="skolem">x1</span><span class="main">)</span> <span class="main">⊔</span> <span class="var">?r</span> <span class="main">(</span><span class="main">-</span><span class="skolem">y1</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="skolem">x1</span> <span class="main">⊓</span> <span class="skolem">y1</span><span class="main">)</span><span class="main">,</span><span class="var">?r</span> <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="skolem">x1</span> <span class="main">⊓</span> <span class="skolem">y1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?pp</span> <span class="skolem">f</span> <span class="main">(</span><span class="skolem">x1</span> <span class="main">⊓</span> <span class="skolem">y1</span><span class="main">,</span><span class="skolem">x2</span> <span class="main">⊔</span> <span class="skolem">y2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> triple.pairs_uminus.simps triple_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?pp</span> <span class="skolem">f</span> <span class="main">(</span>triple.pairs_inf <span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">)</span> <span class="main">(</span><span class="skolem">y1</span><span class="main">,</span><span class="skolem">y2</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?q</span> <span class="skolem">f</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊓</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_stone_phi_pair.rep_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"triple.pairs_inf <span class="main">(</span><span class="var">?q</span> <span class="skolem">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="var">?q</span> <span class="skolem">f</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="var">?q</span> <span class="skolem">f</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊓</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"stone_phi_embed <span class="skolem">x</span> <span class="main">⊓</span> stone_phi_embed <span class="skolem">y</span> <span class="main">=</span> Abs_lifted_pair <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> <span class="keyword1">if</span> Rep_phi <span class="bound">f</span> <span class="main">=</span> stone_phi <span class="keyword1">then</span> Rep_stone_phi_pair <span class="skolem">x</span> <span class="keyword1">else</span> <span class="var">?q</span> <span class="bound">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">⊓</span> Abs_lifted_pair <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> <span class="keyword1">if</span> Rep_phi <span class="bound">f</span> <span class="main">=</span> stone_phi <span class="keyword1">then</span> Rep_stone_phi_pair <span class="skolem">y</span> <span class="keyword1">else</span> <span class="var">?q</span> <span class="bound">f</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Abs_lifted_pair <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> triple.pairs_inf <span class="main">(</span><span class="keyword1">if</span> Rep_phi <span class="bound">f</span> <span class="main">=</span> stone_phi <span class="keyword1">then</span> Rep_stone_phi_pair <span class="skolem">x</span> <span class="keyword1">else</span> <span class="var">?q</span> <span class="bound">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">if</span> Rep_phi <span class="bound">f</span> <span class="main">=</span> stone_phi <span class="keyword1">then</span> Rep_stone_phi_pair <span class="skolem">y</span> <span class="keyword1">else</span> <span class="var">?q</span> <span class="bound">f</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> inf_lifted_pair.abs_eq<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_onp_same_args stone_phi_embed_triple_pair<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Abs_lifted_pair <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> <span class="keyword1">if</span> Rep_phi <span class="bound">f</span> <span class="main">=</span> stone_phi <span class="keyword1">then</span> triple.pairs_inf <span class="main">(</span>Rep_stone_phi_pair <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>Rep_stone_phi_pair <span class="skolem">y</span><span class="main">)</span> <span class="keyword1">else</span> triple.pairs_inf <span class="main">(</span><span class="var">?q</span> <span class="bound">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="var">?q</span> <span class="bound">f</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> if_distrib_2<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Abs_lifted_pair <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> <span class="keyword1">if</span> Rep_phi <span class="bound">f</span> <span class="main">=</span> stone_phi <span class="keyword1">then</span> triple.pairs_inf <span class="main">(</span>Rep_stone_phi_pair <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>Rep_stone_phi_pair <span class="skolem">y</span><span class="main">)</span> <span class="keyword1">else</span> <span class="var">?q</span> <span class="bound">f</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊓</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Abs_lifted_pair <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> <span class="keyword1">if</span> Rep_phi <span class="bound">f</span> <span class="main">=</span> stone_phi <span class="keyword1">then</span> Rep_stone_phi_pair <span class="main">(</span><span class="skolem">x</span> <span class="main">⊓</span> <span class="skolem">y</span><span class="main">)</span> <span class="keyword1">else</span> <span class="var">?q</span> <span class="bound">f</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">⊓</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_stone_phi_pair.rep_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> stone_phi_embed <span class="main">(</span><span class="skolem">x</span> <span class="main">⊓</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"stone_phi_embed <span class="main">(</span><span class="skolem">x</span> <span class="main">⊓</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> stone_phi_embed <span class="skolem">x</span> <span class="main">⊓</span> stone_phi_embed <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"stone_phi_embed <span class="main">(</span>top<span class="main">::</span><span class="tfree">'a</span> stone_phi_pair<span class="main">)</span> <span class="main">=</span> Abs_lifted_pair <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> <span class="keyword1">if</span> Rep_phi <span class="bound">f</span> <span class="main">=</span> stone_phi <span class="keyword1">then</span> Rep_stone_phi_pair top <span class="keyword1">else</span> triple.pairs_uminus <span class="main">(</span>Rep_phi <span class="bound">f</span><span class="main">)</span> <span class="main">(</span>triple.pairs_uminus <span class="main">(</span>Rep_phi <span class="bound">f</span><span class="main">)</span> <span class="main">(</span>Rep_stone_phi_pair top<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Abs_lifted_pair <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> <span class="keyword1">if</span> Rep_phi <span class="bound">f</span> <span class="main">=</span> stone_phi <span class="keyword1">then</span> <span class="main">(</span>top<span class="main">,</span>bot<span class="main">)</span> <span class="keyword1">else</span> triple.pairs_uminus <span class="main">(</span>Rep_phi <span class="bound">f</span><span class="main">)</span> <span class="main">(</span>triple.pairs_uminus <span class="main">(</span>Rep_phi <span class="bound">f</span><span class="main">)</span> <span class="main">(</span>top<span class="main">,</span>bot<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> bot_filter.abs_eq top_stone_phi_pair.rep_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Abs_lifted_pair <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> <span class="keyword1">if</span> Rep_phi <span class="bound">f</span> <span class="main">=</span> stone_phi <span class="keyword1">then</span> <span class="main">(</span>top<span class="main">,</span>bot<span class="main">)</span> <span class="keyword1">else</span> triple.pairs_uminus <span class="main">(</span>Rep_phi <span class="bound">f</span><span class="main">)</span> <span class="main">(</span>bot<span class="main">,</span>top<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> dense_closed_top simp_phi triple.pairs_uminus.simps triple_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Abs_lifted_pair <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> <span class="keyword1">if</span> Rep_phi <span class="bound">f</span> <span class="main">=</span> stone_phi <span class="keyword1">then</span> <span class="main">(</span>top<span class="main">,</span>bot<span class="main">)</span> <span class="keyword1">else</span> <span class="main">(</span>top<span class="main">,</span>bot<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> p_bot simp_phi triple.pairs_uminus.simps triple_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Abs_lifted_pair <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> <span class="main">(</span>top<span class="main">,</span>Abs_filter <span class="main">{</span>top<span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bot_filter.abs_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> top_lifted_pair.abs_eq<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"stone_phi_embed <span class="main">(</span>top<span class="main">::</span><span class="tfree">'a</span> stone_phi_pair<span class="main">)</span> <span class="main">=</span> top"</span></span>
    <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"stone_phi_embed <span class="main">(</span>bot<span class="main">::</span><span class="tfree">'a</span> stone_phi_pair<span class="main">)</span> <span class="main">=</span> Abs_lifted_pair <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> <span class="keyword1">if</span> Rep_phi <span class="bound">f</span> <span class="main">=</span> stone_phi <span class="keyword1">then</span> Rep_stone_phi_pair bot <span class="keyword1">else</span> triple.pairs_uminus <span class="main">(</span>Rep_phi <span class="bound">f</span><span class="main">)</span> <span class="main">(</span>triple.pairs_uminus <span class="main">(</span>Rep_phi <span class="bound">f</span><span class="main">)</span> <span class="main">(</span>Rep_stone_phi_pair bot<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Abs_lifted_pair <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> <span class="keyword1">if</span> Rep_phi <span class="bound">f</span> <span class="main">=</span> stone_phi <span class="keyword1">then</span> <span class="main">(</span>bot<span class="main">,</span>top<span class="main">)</span> <span class="keyword1">else</span> triple.pairs_uminus <span class="main">(</span>Rep_phi <span class="bound">f</span><span class="main">)</span> <span class="main">(</span>triple.pairs_uminus <span class="main">(</span>Rep_phi <span class="bound">f</span><span class="main">)</span> <span class="main">(</span>bot<span class="main">,</span>top<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> top_filter.abs_eq bot_stone_phi_pair.rep_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Abs_lifted_pair <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> <span class="keyword1">if</span> Rep_phi <span class="bound">f</span> <span class="main">=</span> stone_phi <span class="keyword1">then</span> <span class="main">(</span>bot<span class="main">,</span>top<span class="main">)</span> <span class="keyword1">else</span> triple.pairs_uminus <span class="main">(</span>Rep_phi <span class="bound">f</span><span class="main">)</span> <span class="main">(</span>top<span class="main">,</span>bot<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> p_bot simp_phi triple.pairs_uminus.simps triple_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Abs_lifted_pair <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> <span class="keyword1">if</span> Rep_phi <span class="bound">f</span> <span class="main">=</span> stone_phi <span class="keyword1">then</span> <span class="main">(</span>bot<span class="main">,</span>top<span class="main">)</span> <span class="keyword1">else</span> <span class="main">(</span>bot<span class="main">,</span>top<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> p_top simp_phi triple.pairs_uminus.simps triple_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Abs_lifted_pair <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> <span class="main">(</span>bot<span class="main">,</span>Abs_filter UNIV<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> top_filter.abs_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bot_lifted_pair.abs_eq<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"stone_phi_embed <span class="main">(</span>bot<span class="main">::</span><span class="tfree">'a</span> stone_phi_pair<span class="main">)</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> triple.pairs_uminus <span class="main">(</span>Rep_phi <span class="bound">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?pp</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">f</span> <span class="bound">x</span> <span class="main">.</span> <span class="var">?p</span> <span class="bound">f</span> <span class="main">(</span><span class="var">?p</span> <span class="bound">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?q</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">f</span> <span class="bound">x</span> <span class="main">.</span> <span class="var">?pp</span> <span class="bound">f</span> <span class="main">(</span>Rep_stone_phi_pair <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">::</span><span class="tfree">'a</span> stone_phi_pair <span class="main">.</span> stone_phi_embed <span class="main">(</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span>stone_phi_embed <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> stone_phi_pair"</span></span>
    <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">f</span> <span class="main">.</span> triple.pairs_uminus <span class="main">(</span>Rep_phi <span class="bound">f</span><span class="main">)</span> <span class="main">(</span><span class="var">?q</span> <span class="bound">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="var">?q</span> <span class="bound">f</span> <span class="main">(</span><span class="main">-</span><span class="skolem">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> regular<span class="main">,</span><span class="tfree">'a</span> dense<span class="main">)</span> phi"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Rep_phi <span class="skolem">f</span>"</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x1</span></span> <span class="skolem"><span class="skolem">x2</span></span> <span class="keyword2"><span class="keyword">where</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">)</span> <span class="main">=</span> Rep_stone_phi_pair <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> prod.collapse <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"triple.pairs_uminus <span class="main">(</span>Rep_phi <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span><span class="var">?q</span> <span class="skolem">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> triple.pairs_uminus <span class="main">(</span>Rep_phi <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span><span class="var">?pp</span> <span class="skolem">f</span> <span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> triple.pairs_uminus <span class="main">(</span>Rep_phi <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="skolem">x1</span><span class="main">,</span><span class="var">?r</span> <span class="main">(</span><span class="main">-</span><span class="skolem">x1</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> triple.pairs_uminus.simps triple_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="main">-</span><span class="skolem">x1</span><span class="main">,</span><span class="var">?r</span> <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="skolem">x1</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> triple.pairs_uminus.simps triple_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?pp</span> <span class="skolem">f</span> <span class="main">(</span><span class="main">-</span><span class="skolem">x1</span><span class="main">,</span>stone_phi <span class="skolem">x1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> triple.pairs_uminus.simps triple_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?pp</span> <span class="skolem">f</span> <span class="main">(</span>triple.pairs_uminus stone_phi <span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?q</span> <span class="skolem">f</span> <span class="main">(</span><span class="main">-</span><span class="skolem">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> uminus_stone_phi_pair.rep_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"triple.pairs_uminus <span class="main">(</span>Rep_phi <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span><span class="var">?q</span> <span class="skolem">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="var">?q</span> <span class="skolem">f</span> <span class="main">(</span><span class="main">-</span><span class="skolem">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span>stone_phi_embed <span class="skolem">x</span> <span class="main">=</span> <span class="main">-</span>Abs_lifted_pair <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> <span class="keyword1">if</span> Rep_phi <span class="bound">f</span> <span class="main">=</span> stone_phi <span class="keyword1">then</span> Rep_stone_phi_pair <span class="skolem">x</span> <span class="keyword1">else</span> <span class="var">?q</span> <span class="bound">f</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Abs_lifted_pair <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> triple.pairs_uminus <span class="main">(</span>Rep_phi <span class="bound">f</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">if</span> Rep_phi <span class="bound">f</span> <span class="main">=</span> stone_phi <span class="keyword1">then</span> Rep_stone_phi_pair <span class="skolem">x</span> <span class="keyword1">else</span> <span class="var">?q</span> <span class="bound">f</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> uminus_lifted_pair.abs_eq<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_onp_same_args stone_phi_embed_triple_pair<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Abs_lifted_pair <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> <span class="keyword1">if</span> Rep_phi <span class="bound">f</span> <span class="main">=</span> stone_phi <span class="keyword1">then</span> triple.pairs_uminus <span class="main">(</span>Rep_phi <span class="bound">f</span><span class="main">)</span> <span class="main">(</span>Rep_stone_phi_pair <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">else</span> triple.pairs_uminus <span class="main">(</span>Rep_phi <span class="bound">f</span><span class="main">)</span> <span class="main">(</span><span class="var">?q</span> <span class="bound">f</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> if_distrib<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Abs_lifted_pair <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> <span class="keyword1">if</span> Rep_phi <span class="bound">f</span> <span class="main">=</span> stone_phi <span class="keyword1">then</span> triple.pairs_uminus <span class="main">(</span>Rep_phi <span class="bound">f</span><span class="main">)</span> <span class="main">(</span>Rep_stone_phi_pair <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">else</span> <span class="var">?q</span> <span class="bound">f</span> <span class="main">(</span><span class="main">-</span><span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Abs_lifted_pair <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> <span class="keyword1">if</span> Rep_phi <span class="bound">f</span> <span class="main">=</span> stone_phi <span class="keyword1">then</span> Rep_stone_phi_pair <span class="main">(</span><span class="main">-</span><span class="skolem">x</span><span class="main">)</span> <span class="keyword1">else</span> <span class="var">?q</span> <span class="bound">f</span> <span class="main">(</span><span class="main">-</span><span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> uminus_stone_phi_pair.rep_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> stone_phi_embed <span class="main">(</span><span class="main">-</span><span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"stone_phi_embed <span class="main">(</span><span class="main">-</span><span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span>stone_phi_embed <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> triple.pairs_uminus <span class="main">(</span>Rep_phi <span class="bound">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?pp</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">f</span> <span class="bound">x</span> <span class="main">.</span> <span class="var">?p</span> <span class="bound">f</span> <span class="main">(</span><span class="var">?p</span> <span class="bound">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?q</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">f</span> <span class="bound">x</span> <span class="main">.</span> <span class="var">?pp</span> <span class="bound">f</span> <span class="main">(</span>Rep_stone_phi_pair <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">::</span><span class="tfree">'a</span> stone_phi_pair <span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">⟶</span> stone_phi_embed <span class="bound">x</span> <span class="main">≤</span> stone_phi_embed <span class="bound">y</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> stone_phi_pair"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">f</span> <span class="main">.</span> triple.pairs_less_eq <span class="main">(</span><span class="keyword1">if</span> Rep_phi <span class="bound">f</span> <span class="main">=</span> stone_phi <span class="keyword1">then</span> Rep_stone_phi_pair <span class="skolem">x</span> <span class="keyword1">else</span> <span class="var">?q</span> <span class="bound">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">if</span> Rep_phi <span class="bound">f</span> <span class="main">=</span> stone_phi <span class="keyword1">then</span> Rep_stone_phi_pair <span class="skolem">y</span> <span class="keyword1">else</span> <span class="var">?q</span> <span class="bound">f</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> regular<span class="main">,</span><span class="tfree">'a</span> dense<span class="main">)</span> phi"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Rep_phi <span class="skolem">f</span>"</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x1</span></span> <span class="skolem"><span class="skolem">x2</span></span> <span class="skolem"><span class="skolem">y1</span></span> <span class="skolem"><span class="skolem">y2</span></span> <span class="keyword2"><span class="keyword">where</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">)</span> <span class="main">=</span> Rep_stone_phi_pair <span class="skolem">x</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">y1</span><span class="main">,</span><span class="skolem">y2</span><span class="main">)</span> <span class="main">=</span> Rep_stone_phi_pair <span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> prod.collapse <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span> <span class="main">≤</span> <span class="skolem">y1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 1 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_eq_stone_phi_pair.rep_eq stone_phi.pairs_less_eq.simps<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">-</span><span class="skolem">x1</span> <span class="main">≤</span> <span class="main">-</span><span class="main">-</span><span class="skolem">y1</span> <span class="main">∧</span> <span class="var">?r</span> <span class="main">(</span><span class="main">-</span><span class="skolem">y1</span><span class="main">)</span> <span class="main">≤</span> <span class="var">?r</span> <span class="main">(</span><span class="main">-</span><span class="skolem">x1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> compl_le_compl_iff le_iff_sup simp_phi<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"triple.pairs_less_eq <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="skolem">x1</span><span class="main">,</span><span class="var">?r</span> <span class="main">(</span><span class="main">-</span><span class="skolem">x1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="skolem">y1</span><span class="main">,</span><span class="var">?r</span> <span class="main">(</span><span class="main">-</span><span class="skolem">y1</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"triple.pairs_less_eq <span class="main">(</span><span class="var">?pp</span> <span class="skolem">f</span> <span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="var">?pp</span> <span class="skolem">f</span> <span class="main">(</span><span class="skolem">y1</span><span class="main">,</span><span class="skolem">y2</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> triple.pairs_uminus.simps triple_def<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"triple.pairs_less_eq <span class="main">(</span><span class="var">?q</span> <span class="skolem">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="var">?q</span> <span class="skolem">f</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">if</span> <span class="var">?r</span> <span class="main">=</span> stone_phi <span class="keyword1">then</span> triple.pairs_less_eq <span class="main">(</span>Rep_stone_phi_pair <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>Rep_stone_phi_pair <span class="skolem">y</span><span class="main">)</span> <span class="keyword1">else</span> triple.pairs_less_eq <span class="main">(</span><span class="var">?q</span> <span class="skolem">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="var">?q</span> <span class="skolem">f</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_stone_phi_pair.rep_eq<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"triple.pairs_less_eq <span class="main">(</span><span class="keyword1">if</span> <span class="var">?r</span> <span class="main">=</span> stone_phi <span class="keyword1">then</span> Rep_stone_phi_pair <span class="skolem">x</span> <span class="keyword1">else</span> <span class="var">?q</span> <span class="skolem">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">if</span> <span class="var">?r</span> <span class="main">=</span> stone_phi <span class="keyword1">then</span> Rep_stone_phi_pair <span class="skolem">y</span> <span class="keyword1">else</span> <span class="var">?q</span> <span class="skolem">f</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> if_distrib_2<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Abs_lifted_pair <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> <span class="keyword1">if</span> Rep_phi <span class="bound">f</span> <span class="main">=</span> stone_phi <span class="keyword1">then</span> Rep_stone_phi_pair <span class="skolem">x</span> <span class="keyword1">else</span> <span class="var">?q</span> <span class="bound">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≤</span> Abs_lifted_pair <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> <span class="keyword1">if</span> Rep_phi <span class="bound">f</span> <span class="main">=</span> stone_phi <span class="keyword1">then</span> Rep_stone_phi_pair <span class="skolem">y</span> <span class="keyword1">else</span> <span class="var">?q</span> <span class="bound">f</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> less_eq_lifted_pair.abs_eq<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_onp_same_args stone_phi_embed_triple_pair<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"stone_phi_embed <span class="skolem">x</span> <span class="main">≤</span> stone_phi_embed <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following lemmas show that the embedding is injective and reflects the order.
The latter allows us to easily inherit properties involving inequalities from the target of the embedding, without transforming them to equations.
›</span></span>

<span class="keyword1" id="Stone_Construction-stone_phi_embed_injective"><span class="command">lemma</span></span> stone_phi_embed_injective<span class="main">:</span>
  <span class="quoted"><span class="quoted">"inj stone_phi_embed"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> injI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> stone_phi_pair"</span></span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"Rep_phi <span class="main">(</span>Abs_phi stone_phi<span class="main">)</span> <span class="main">=</span> stone_phi"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_phi_inverse stone_phi.hom<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"stone_phi_embed <span class="skolem">x</span> <span class="main">=</span> stone_phi_embed <span class="skolem">y</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">::</span><span class="tfree">'a</span> stone_phi_pair <span class="main">.</span> Rep_lifted_pair <span class="main">(</span>stone_phi_embed <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> <span class="keyword1">if</span> Rep_phi <span class="bound">f</span> <span class="main">=</span> stone_phi <span class="keyword1">then</span> Rep_stone_phi_pair <span class="bound">x</span> <span class="keyword1">else</span> triple.pairs_uminus <span class="main">(</span>Rep_phi <span class="bound">f</span><span class="main">)</span> <span class="main">(</span>triple.pairs_uminus <span class="main">(</span>Rep_phi <span class="bound">f</span><span class="main">)</span> <span class="main">(</span>Rep_stone_phi_pair <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_lifted_pair_inverse stone_phi_embed_triple_pair<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> <span class="keyword1">if</span> Rep_phi <span class="bound">f</span> <span class="main">=</span> stone_phi <span class="keyword1">then</span> Rep_stone_phi_pair <span class="skolem">x</span> <span class="keyword1">else</span> triple.pairs_uminus <span class="main">(</span>Rep_phi <span class="bound">f</span><span class="main">)</span> <span class="main">(</span>triple.pairs_uminus <span class="main">(</span>Rep_phi <span class="bound">f</span><span class="main">)</span> <span class="main">(</span>Rep_stone_phi_pair <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> <span class="keyword1">if</span> Rep_phi <span class="bound">f</span> <span class="main">=</span> stone_phi <span class="keyword1">then</span> Rep_stone_phi_pair <span class="skolem">y</span> <span class="keyword1">else</span> triple.pairs_uminus <span class="main">(</span>Rep_phi <span class="bound">f</span><span class="main">)</span> <span class="main">(</span>triple.pairs_uminus <span class="main">(</span>Rep_phi <span class="bound">f</span><span class="main">)</span> <span class="main">(</span>Rep_stone_phi_pair <span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Rep_stone_phi_pair <span class="skolem">x</span> <span class="main">=</span> Rep_stone_phi_pair <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Rep_stone_phi_pair_inject<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Stone_Construction-stone_phi_embed_order_injective"><span class="command">lemma</span></span> stone_phi_embed_order_injective<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"stone_phi_embed <span class="free">x</span> <span class="main">≤</span> stone_phi_embed <span class="free">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Abs_phi stone_phi"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">f</span> <span class="main">.</span> triple.pairs_less_eq <span class="main">(</span><span class="keyword1">if</span> Rep_phi <span class="bound">f</span> <span class="main">=</span> stone_phi <span class="keyword1">then</span> Rep_stone_phi_pair <span class="free">x</span> <span class="keyword1">else</span> triple.pairs_uminus <span class="main">(</span>Rep_phi <span class="bound">f</span><span class="main">)</span> <span class="main">(</span>triple.pairs_uminus <span class="main">(</span>Rep_phi <span class="bound">f</span><span class="main">)</span> <span class="main">(</span>Rep_stone_phi_pair <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">if</span> Rep_phi <span class="bound">f</span> <span class="main">=</span> stone_phi <span class="keyword1">then</span> Rep_stone_phi_pair <span class="free">y</span> <span class="keyword1">else</span> triple.pairs_uminus <span class="main">(</span>Rep_phi <span class="bound">f</span><span class="main">)</span> <span class="main">(</span>triple.pairs_uminus <span class="main">(</span>Rep_phi <span class="bound">f</span><span class="main">)</span> <span class="main">(</span>Rep_stone_phi_pair <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> less_eq_lifted_pair.abs_eq<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_onp_same_args stone_phi_embed_triple_pair<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"triple.pairs_less_eq <span class="main">(</span><span class="keyword1">if</span> Rep_phi <span class="var">?f</span> <span class="main">=</span> <span class="main">(</span>stone_phi<span class="main">::</span><span class="tfree">'a</span> regular <span class="main">⇒</span> <span class="tfree">'a</span> dense_filter<span class="main">)</span> <span class="keyword1">then</span> Rep_stone_phi_pair <span class="free">x</span> <span class="keyword1">else</span> triple.pairs_uminus <span class="main">(</span>Rep_phi <span class="var">?f</span><span class="main">)</span> <span class="main">(</span>triple.pairs_uminus <span class="main">(</span>Rep_phi <span class="var">?f</span><span class="main">)</span> <span class="main">(</span>Rep_stone_phi_pair <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">if</span> Rep_phi <span class="var">?f</span> <span class="main">=</span> <span class="main">(</span>stone_phi<span class="main">::</span><span class="tfree">'a</span> regular <span class="main">⇒</span> <span class="tfree">'a</span> dense_filter<span class="main">)</span> <span class="keyword1">then</span> Rep_stone_phi_pair <span class="free">y</span> <span class="keyword1">else</span> triple.pairs_uminus <span class="main">(</span>Rep_phi <span class="var">?f</span><span class="main">)</span> <span class="main">(</span>triple.pairs_uminus <span class="main">(</span>Rep_phi <span class="var">?f</span><span class="main">)</span> <span class="main">(</span>Rep_stone_phi_pair <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"triple.pairs_less_eq <span class="main">(</span>Rep_stone_phi_pair <span class="free">x</span><span class="main">)</span> <span class="main">(</span>Rep_stone_phi_pair <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_phi_inverse stone_phi.hom<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_stone_phi_pair.rep_eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Stone_Construction-stone_phi_embed_strict_order_isomorphism"><span class="command">lemma</span></span> stone_phi_embed_strict_order_isomorphism<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> <span class="free">y</span> <span class="main">⟷</span> stone_phi_embed <span class="free">x</span> <span class="main">&lt;</span> stone_phi_embed <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> less_eq_stone_phi_pair.rep_eq less_le_not_le less_stone_phi_pair.rep_eq stone_phi.pairs_less.elims<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span> stone_phi_embed_homomorphism stone_phi_embed_order_injective<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Now all Stone algebra axioms can be inherited using the embedding.
This is due to the fact that the axioms are universally quantified equations or conditional equations (or inequalities); this is called a quasivariety in universal algebra.
It would be useful to have this construction available for arbitrary quasivarieties.
›</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> stone_phi_pair <span class="main">::</span> <span class="main">(</span><span class="quoted">non_trivial_stone_algebra</span><span class="main">)</span> <span class="quoted">stone_algebra</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">intro_classes</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> stone_phi_embed_homomorphism stone_phi_embed_strict_order_isomorphism stone_phi_embed_order_injective less_le_not_le<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stone_phi_embed_order_injective<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">meson</span> order.trans stone_phi_embed_homomorphism stone_phi_embed_order_injective<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">meson</span> stone_phi_embed_homomorphism antisym stone_phi_embed_injective injD<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> inf.sup_ge1 stone_phi_embed_homomorphism stone_phi_embed_order_injective<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> inf.sup_ge2 stone_phi_embed_homomorphism stone_phi_embed_order_injective<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> inf_greatest stone_phi_embed_homomorphism stone_phi_embed_order_injective<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> stone_phi_embed_homomorphism stone_phi_embed_order_injective sup_ge1<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> stone_phi_embed_homomorphism stone_phi_embed_order_injective sup.cobounded2<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> stone_phi_embed_homomorphism stone_phi_embed_order_injective sup_least<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> bot.extremum stone_phi_embed_homomorphism stone_phi_embed_order_injective<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> stone_phi_embed_homomorphism stone_phi_embed_order_injective top_greatest<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> stone_phi_embed_homomorphism sup_inf_distrib1 stone_phi_embed_injective injD<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> stone_phi_embed_homomorphism stone_phi_embed_injective injD stone_phi_embed_order_injective pseudo_complement<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> injD stone_phi_embed_homomorphism stone_phi_embed_injective stone<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Stone Algebra Isomorphism›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
In this section we prove that the Stone algebra of the triple of a Stone algebra is isomorphic to the original Stone algebra.
The following two definitions give the isomorphism.
›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">sa_iso_inv</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>non_trivial_stone_algebra stone_phi_pair <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">sa_iso_inv</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">p</span> <span class="main">.</span> Rep_regular <span class="main">(</span>fst <span class="main">(</span>Rep_stone_phi_pair <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">⊓</span> Rep_dense <span class="main">(</span>triple.rho_pair stone_phi <span class="main">(</span>Rep_stone_phi_pair <span class="bound">p</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">sa_iso</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>non_trivial_stone_algebra <span class="main">⇒</span> <span class="tfree">'a</span> stone_phi_pair"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">sa_iso</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">x</span> <span class="main">.</span> Abs_stone_phi_pair <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">,</span>stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="bound">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Stone_Construction-sa_iso_triple_pair"><span class="command">lemma</span></span> sa_iso_triple_pair<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="free">x</span><span class="main">)</span><span class="main">,</span>stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> triple.pairs stone_phi"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> double_compl eq_onp_same_args stone_phi.sa_iso_pair uminus_regular.abs_eq<span class="main">)</span>

<span class="keyword1" id="Stone_Construction-stone_phi_inf_dense"><span class="command">lemma</span></span> stone_phi_inf_dense<span class="main">:</span>
  <span class="quoted"><span class="quoted">"stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⊓</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="free">y</span> <span class="main">⊔</span> <span class="main">-</span><span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="free">y</span> <span class="main">⊔</span> <span class="main">-</span><span class="free">y</span> <span class="main">⊔</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Rep_filter <span class="main">(</span>stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⊓</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="free">y</span> <span class="main">⊔</span> <span class="main">-</span><span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">↑</span><span class="main">(</span>Abs_dense <span class="main">(</span><span class="free">y</span> <span class="main">⊔</span> <span class="main">-</span><span class="free">y</span> <span class="main">⊔</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> dense"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Rep_dense <span class="skolem">z</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> Rep_filter <span class="main">(</span>stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⊓</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="free">y</span> <span class="main">⊔</span> <span class="main">-</span><span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Rep_filter <span class="main">(</span>stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> Rep_filter <span class="main">(</span>up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="free">y</span> <span class="main">⊔</span> <span class="main">-</span><span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_filter.rep_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> stone_phi_base <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="main">↑</span><span class="main">(</span>Abs_dense <span class="main">(</span><span class="free">y</span> <span class="main">⊔</span> <span class="main">-</span><span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Abs_filter_inverse mem_Collect_eq up_filter stone_phi_base_filter stone_phi_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">-</span><span class="free">x</span> <span class="main">≤</span> <span class="var">?r</span> <span class="main">∧</span> Abs_dense <span class="main">(</span><span class="free">y</span> <span class="main">⊔</span> <span class="main">-</span><span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">z</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Abs_regular_inverse Int_Collect mem_Collect_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">-</span><span class="free">x</span> <span class="main">≤</span> <span class="var">?r</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">⊔</span> <span class="main">-</span><span class="free">y</span> <span class="main">≤</span> <span class="var">?r</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_dense_inverse less_eq_dense.rep_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">⊔</span> <span class="main">-</span><span class="free">y</span> <span class="main">⊔</span> <span class="free">x</span> <span class="main">≤</span> <span class="var">?r</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> order_trans pp_increasing <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Abs_dense <span class="main">(</span><span class="free">y</span> <span class="main">⊔</span> <span class="main">-</span><span class="free">y</span> <span class="main">⊔</span> <span class="free">x</span><span class="main">)</span> <span class="main">≤</span> Abs_dense <span class="var">?r</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> less_eq_dense.abs_eq<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_onp_same_args<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="main">↑</span><span class="main">(</span>Abs_dense <span class="main">(</span><span class="free">y</span> <span class="main">⊔</span> <span class="main">-</span><span class="free">y</span> <span class="main">⊔</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Rep_dense_inverse<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Abs_filter <span class="main">(</span>Rep_filter <span class="main">(</span>stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⊓</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="free">y</span> <span class="main">⊔</span> <span class="main">-</span><span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="free">y</span> <span class="main">⊔</span> <span class="main">-</span><span class="free">y</span> <span class="main">⊔</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_onp_same_args less_eq_filter.abs_eq<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Rep_filter_inverse<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Stone_Construction-stone_phi_complement"><span class="command">lemma</span></span> stone_phi_complement<span class="main">:</span>
  <span class="quoted"><span class="quoted">"complement <span class="main">(</span>stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> eq_onp_same_args stone_phi.phi_complemented uminus_regular.abs_eq<span class="main">)</span>

<span class="keyword1" id="Stone_Construction-up_dense_stone_phi"><span class="command">lemma</span></span> up_dense_stone_phi<span class="main">:</span>
  <span class="quoted"><span class="quoted">"up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">↑</span><span class="main">(</span>Abs_dense <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> stone_phi_base <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> dense"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Rep_dense <span class="skolem">z</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="main">↑</span><span class="main">(</span>Abs_dense <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">-</span><span class="main">-</span><span class="free">x</span> <span class="main">≤</span> <span class="var">?r</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_dense_inverse less_eq_dense.rep_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span>Rep_regular <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="var">?r</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Abs_regular_inverse mem_Collect_eq<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> stone_phi_base <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> stone_phi_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> less_eq_filter.abs_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_onp_same_args stone_phi_base_filter<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following two results prove that the isomorphisms are mutually inverse.
›</span></span>

<span class="keyword1" id="Stone_Construction-sa_iso_left_invertible"><span class="command">lemma</span></span> sa_iso_left_invertible<span class="main">:</span>
  <span class="quoted"><span class="quoted">"sa_iso_inv <span class="main">(</span>sa_iso <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"up_filter <span class="main">(</span>triple.rho_pair stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="free">x</span><span class="main">)</span><span class="main">,</span>stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span>stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sa_iso_triple_pair stone_phi.get_rho_pair_char <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⊓</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf.sup_commute inf_sup_distrib1 stone_phi_complement<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> up_dense_stone_phi inf.absorb2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"triple.rho_pair stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="free">x</span><span class="main">)</span><span class="main">,</span>stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Abs_dense <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> up_filter_injective <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sa_iso_inv <span class="main">(</span>sa_iso <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">p</span> <span class="main">.</span> Rep_regular <span class="main">(</span>fst <span class="bound">p</span><span class="main">)</span> <span class="main">⊓</span> Rep_dense <span class="main">(</span>triple.rho_pair stone_phi <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="free">x</span><span class="main">)</span><span class="main">,</span>stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_stone_phi_pair_inverse sa_iso_triple_pair<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Rep_regular <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⊓</span> Rep_dense <span class="main">(</span>triple.rho_pair stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="free">x</span><span class="main">)</span><span class="main">,</span>stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">-</span><span class="main">-</span><span class="free">x</span> <span class="main">⊓</span> Rep_dense <span class="main">(</span>Abs_dense <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> Abs_regular_inverse<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">-</span><span class="main">-</span><span class="free">x</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> Abs_dense_inverse<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Stone_Construction-sa_iso_right_invertible"><span class="command">lemma</span></span> sa_iso_right_invertible<span class="main">:</span>
  <span class="quoted"><span class="quoted">"sa_iso <span class="main">(</span>sa_iso_inv <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> Rep_stone_phi_pair <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> prod.collapse <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> triple.pairs stone_phi"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Rep_stone_phi_pair<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"stone_phi <span class="main">(</span><span class="main">-</span><span class="skolem">x</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stone_phi.pairs_phi_less_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">z</span> <span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> Rep_filter <span class="main">(</span>stone_phi <span class="skolem">x</span> <span class="main">⊓</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">-</span>Rep_regular <span class="skolem">x</span> <span class="main">≤</span> Rep_dense <span class="bound">z</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> dense"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Rep_dense <span class="skolem">z</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> Rep_filter <span class="main">(</span>stone_phi <span class="skolem">x</span> <span class="main">⊓</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> Rep_filter <span class="main">(</span>stone_phi <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_filter.rep_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> stone_phi_base <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stone_phi_def Abs_filter_inverse stone_phi_base_filter<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span>Rep_regular <span class="skolem">x</span> <span class="main">≤</span> <span class="var">?r</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"triple.rho_pair stone_phi <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="main">↑</span><span class="main">(</span>triple.rho_pair stone_phi <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Rep_filter <span class="main">(</span>Abs_filter <span class="main">(</span><span class="main">↑</span><span class="main">(</span>triple.rho_pair stone_phi <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_filter_inverse<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Rep_filter <span class="main">(</span>stone_phi <span class="skolem">x</span> <span class="main">⊓</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 2 stone_phi.get_rho_pair_char <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"triple.rho_pair stone_phi <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> Rep_filter <span class="main">(</span>stone_phi <span class="skolem">x</span> <span class="main">⊓</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span>Rep_regular <span class="skolem">x</span> <span class="main">≤</span> Rep_dense <span class="main">(</span>triple.rho_pair stone_phi <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> 6<span class="main">:</span> <span class="quoted"><span class="quoted">"sa_iso_inv <span class="free">p</span> <span class="main">=</span> Rep_regular <span class="skolem">x</span> <span class="main">⊓</span> Rep_dense <span class="main">(</span>triple.rho_pair stone_phi <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fstI<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span>sa_iso_inv <span class="free">p</span> <span class="main">=</span> <span class="main">-</span>Rep_regular <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sa_iso <span class="main">(</span>sa_iso_inv <span class="free">p</span><span class="main">)</span> <span class="main">=</span> Abs_stone_phi_pair <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="main">-</span>Rep_regular <span class="skolem">x</span><span class="main">)</span><span class="main">,</span>stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span>Rep_regular <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="main">(</span>Rep_regular <span class="skolem">x</span> <span class="main">⊓</span> Rep_dense <span class="main">(</span>triple.rho_pair stone_phi <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">-</span>Rep_regular <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 6 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Abs_stone_phi_pair <span class="main">(</span><span class="skolem">x</span><span class="main">,</span>stone_phi <span class="main">(</span><span class="main">-</span><span class="skolem">x</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="main">(</span>Rep_regular <span class="skolem">x</span> <span class="main">⊓</span> Rep_dense <span class="main">(</span>triple.rho_pair stone_phi <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">-</span>Rep_regular <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Rep_regular_inverse double_compl uminus_regular.rep_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Abs_stone_phi_pair <span class="main">(</span><span class="skolem">x</span><span class="main">,</span>stone_phi <span class="main">(</span><span class="main">-</span><span class="skolem">x</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span>Rep_dense <span class="main">(</span>triple.rho_pair stone_phi <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">-</span>Rep_regular <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_sup_aci<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> maddux_3_21_pp simp_regular<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Abs_stone_phi_pair <span class="main">(</span><span class="skolem">x</span><span class="main">,</span>stone_phi <span class="main">(</span><span class="main">-</span><span class="skolem">x</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span>Rep_dense <span class="main">(</span>triple.rho_pair stone_phi <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 5 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup.absorb1<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Abs_stone_phi_pair <span class="main">(</span><span class="skolem">x</span><span class="main">,</span>stone_phi <span class="main">(</span><span class="main">-</span><span class="skolem">x</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="main">(</span>triple.rho_pair stone_phi <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Rep_dense_inverse<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Abs_stone_phi_pair <span class="main">(</span><span class="skolem">x</span><span class="main">,</span>stone_phi <span class="main">(</span><span class="main">-</span><span class="skolem">x</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span>stone_phi <span class="skolem">x</span> <span class="main">⊓</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 2 stone_phi.get_rho_pair_char <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Abs_stone_phi_pair <span class="main">(</span><span class="skolem">x</span><span class="main">,</span>stone_phi <span class="main">(</span><span class="main">-</span><span class="skolem">x</span><span class="main">)</span> <span class="main">⊔</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stone_phi.phi_complemented sup.commute sup_inf_distrib1<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Abs_stone_phi_pair <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_iff_sup<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Rep_stone_phi_pair_inverse<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
It remains to show the homomorphism properties, which is done in the following result.
›</span></span>

<span class="keyword1" id="Stone_Construction-sa_iso"><span class="command">lemma</span></span> sa_iso<span class="main">:</span>
  <span class="quoted"><span class="quoted">"stone_algebra_isomorphism sa_iso"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Abs_stone_phi_pair <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="main">-</span>bot<span class="main">)</span><span class="main">,</span>stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span>bot<span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span>bot <span class="main">⊔</span> <span class="main">-</span>bot<span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Abs_stone_phi_pair <span class="main">(</span>bot<span class="main">,</span>stone_phi top <span class="main">⊔</span> up_filter top<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bot_regular.abs_eq top_regular.abs_eq top_dense.abs_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Abs_stone_phi_pair <span class="main">(</span>bot<span class="main">,</span>stone_phi top<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stone_phi.hom<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bot_stone_phi_pair_def stone_phi.phi_top<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sa_iso bot <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Abs_stone_phi_pair <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="main">-</span>top<span class="main">)</span><span class="main">,</span>stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span>top<span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span>top <span class="main">⊔</span> <span class="main">-</span>top<span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Abs_stone_phi_pair <span class="main">(</span>top<span class="main">,</span>stone_phi bot <span class="main">⊔</span> up_filter top<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bot_regular.abs_eq top_regular.abs_eq top_dense.abs_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stone_phi.phi_bot top_stone_phi_pair_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sa_iso top <span class="main">=</span> top"</span></span>
    <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">::</span><span class="tfree">'a</span> <span class="main">.</span> dense <span class="main">(</span><span class="bound">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="bound">x</span> <span class="main">⊔</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">::</span><span class="tfree">'a</span> <span class="main">.</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="bound">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="bound">x</span> <span class="main">⊔</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="bound">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span>stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="bound">y</span> <span class="main">⊔</span> <span class="main">-</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?u</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Abs_dense <span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?v</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Abs_dense <span class="main">(</span><span class="skolem">y</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">↑</span><span class="main">(</span>Abs_dense <span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> Rep_filter <span class="main">(</span>stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="var">?v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="main">↑</span><span class="main">(</span>Abs_dense <span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Abs_dense <span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">z</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span> <span class="main">≤</span> Rep_dense <span class="skolem">z</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_dense_inverse less_eq_dense.rep_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="main">-</span><span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_supI2 pp_increasing<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">-</span><span class="skolem">y</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_iff_sup sup_inf_distrib1<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">x</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">-</span><span class="skolem">y</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_commute inf_sup_distrib1<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> Rep_dense <span class="skolem">z</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> le_infI1 sup.bounded_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Abs_dense <span class="main">(</span><span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">z</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_dense_inverse less_eq_dense.rep_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?u</span> <span class="main">⊓</span> <span class="var">?v</span> <span class="main">≤</span> <span class="skolem">z</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_onp_same_args inf_dense.abs_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span>Rep_regular <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">-</span><span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> mem_Collect_eq Abs_regular_inverse<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> Rep_dense <span class="var">?u</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_dense_inverse<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?u</span> <span class="main">∈</span> stone_phi_base <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?u</span> <span class="main">∈</span> Rep_filter <span class="main">(</span>stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mem_Collect_eq stone_phi_def stone_phi_base_filter Abs_filter_inverse<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?v</span> <span class="main">∈</span> <span class="main">↑</span><span class="var">?v</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?v</span> <span class="main">∈</span> Rep_filter <span class="main">(</span>up_filter <span class="var">?v</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Abs_filter_inverse mem_Collect_eq up_filter<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> Rep_filter <span class="main">(</span>stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="var">?v</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 4 5 sup_filter.rep_eq filter_sup_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> Abs_filter <span class="main">(</span>Rep_filter <span class="main">(</span>stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="var">?v</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_onp_same_args less_eq_filter.abs_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="var">?v</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Rep_filter_inverse<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span>stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="skolem">y</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_infI le_supI2 sup_bot.right_neutral up_filter_dense_antitone<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> 6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">::</span><span class="tfree">'a</span> <span class="main">.</span> in_p_image <span class="main">(</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">::</span><span class="tfree">'a</span> <span class="main">.</span> sa_iso <span class="main">(</span><span class="bound">x</span> <span class="main">⊔</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> sa_iso <span class="bound">x</span> <span class="main">⊔</span> sa_iso <span class="bound">y</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
    <span class="keyword1"><span class="command">have</span></span> 7<span class="main">:</span> <span class="quoted"><span class="quoted">"up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⊓</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="skolem">y</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="skolem">y</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">y</span> <span class="main">⊔</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⊓</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="skolem">y</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">x</span><span class="main">)</span> <span class="main">⊔</span> Abs_dense <span class="main">(</span><span class="skolem">y</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> up_filter_dist_sup<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sup_dense.abs_eq<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_onp_same_args<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="skolem">y</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">y</span> <span class="main">⊔</span> <span class="skolem">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup_commute sup_left_commute<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="skolem">y</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">y</span> <span class="main">⊔</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> up_filter_dense_antitone <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Abs_dense <span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span> <span class="main">⊔</span> <span class="main">-</span><span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Abs_dense <span class="main">(</span><span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">y</span> <span class="main">⊔</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup_commute sup_inf_distrib1 sup_left_commute<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Abs_dense <span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">⊓</span> Abs_dense <span class="main">(</span><span class="skolem">y</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">y</span> <span class="main">⊔</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Abs_dense_inverse Rep_dense_inverse inf_dense.rep_eq mem_Collect_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 8<span class="main">:</span> <span class="quoted"><span class="quoted">"up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span> <span class="main">⊔</span> <span class="main">-</span><span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="skolem">y</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">y</span> <span class="main">⊔</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> up_filter_dist_inf<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span>stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span>stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="skolem">y</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf.sup_commute le_sup_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⊓</span> stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span> <span class="main">⊔</span> <span class="main">-</span><span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">...</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_supI1<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⊓</span> stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span>stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⊓</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="skolem">y</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">(</span>up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⊓</span> stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span>up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⊓</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="skolem">y</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> inf_sup_distrib1 inf_sup_distrib2<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span>stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⊓</span> stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="skolem">y</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">y</span> <span class="main">⊔</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">(</span>up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⊓</span> stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span>up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⊓</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="skolem">y</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> sup_left_isotone sup_right_isotone stone_phi_inf_dense<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span>stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⊓</span> stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="skolem">y</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">y</span> <span class="main">⊔</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span>up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span>up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⊓</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="skolem">y</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.commute sup_left_isotone sup_right_isotone stone_phi_inf_dense<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span>stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⊓</span> stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="skolem">y</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">y</span> <span class="main">⊔</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 7 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup.absorb1 sup_commute sup_left_commute<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⊓</span> stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span> <span class="main">⊔</span> <span class="main">-</span><span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 8 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup.commute sup.left_commute<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span>stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="skolem">y</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">...</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 9 <span class="keyword1"><span class="command">using</span></span> antisym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="skolem">x</span><span class="main">)</span> <span class="main">⊓</span> Abs_regular <span class="main">(</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span> <span class="main">⊔</span> <span class="main">-</span><span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stone_phi.hom<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span> <span class="main">⊔</span> <span class="main">-</span><span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 6 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> inf_regular.abs_eq<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_onp_same_args<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 10<span class="main">:</span> <span class="quoted"><span class="quoted">"stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span> <span class="main">⊔</span> <span class="main">-</span><span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span>stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="skolem">y</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Abs_regular <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Abs_regular <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="skolem">x</span><span class="main">)</span> <span class="main">⊔</span> Abs_regular <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 6 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sup_regular.abs_eq<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_onp_same_args<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Abs_stone_phi_pair <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span> <span class="main">⊔</span> <span class="main">-</span><span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Abs_stone_phi_pair <span class="main">(</span>triple.pairs_sup <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="skolem">x</span><span class="main">)</span><span class="main">,</span>stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">,</span>stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="skolem">y</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 10 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Abs_stone_phi_pair <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="skolem">x</span><span class="main">)</span><span class="main">,</span>stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> Abs_stone_phi_pair <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">,</span>stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="skolem">y</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sup_stone_phi_pair.abs_eq<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_onp_same_args sa_iso_triple_pair<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sa_iso <span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> sa_iso <span class="skolem">x</span> <span class="main">⊔</span> sa_iso <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">::</span><span class="tfree">'a</span> <span class="main">.</span> dense <span class="main">(</span><span class="bound">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="bound">x</span> <span class="main">⊔</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">::</span><span class="tfree">'a</span> <span class="main">.</span> in_p_image <span class="main">(</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">::</span><span class="tfree">'a</span> <span class="main">.</span> stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="bound">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="bound">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="bound">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
    <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> complement_shunting stone_phi_inf_dense stone_phi_complement complement_symmetric<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sup_idem up_filter_dense_antitone<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 4 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_iff_sup sup_commute sup_left_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">::</span><span class="tfree">'a</span> <span class="main">.</span> sa_iso <span class="main">(</span><span class="bound">x</span> <span class="main">⊓</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> sa_iso <span class="bound">x</span> <span class="main">⊓</span> sa_iso <span class="bound">y</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Abs_dense <span class="main">(</span><span class="main">(</span><span class="skolem">x</span> <span class="main">⊓</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">-</span><span class="main">(</span><span class="skolem">x</span> <span class="main">⊓</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Abs_dense <span class="main">(</span><span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">y</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">y</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup_commute sup_inf_distrib1 sup_left_commute<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Abs_dense <span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">y</span><span class="main">)</span> <span class="main">⊓</span> Abs_dense <span class="main">(</span><span class="skolem">y</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">y</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Abs_dense_inverse Rep_dense_inverse inf_dense.rep_eq mem_Collect_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="main">(</span><span class="skolem">x</span> <span class="main">⊓</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">-</span><span class="main">(</span><span class="skolem">x</span> <span class="main">⊓</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="skolem">y</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">y</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> up_filter_dist_inf<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span>stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="skolem">y</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span>stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="skolem">y</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_sup_aci<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> sup_left_commute<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span>stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="skolem">y</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">y</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span>up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="skolem">y</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">y</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_sup_aci<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> sup_left_commute<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="main">(</span><span class="skolem">x</span> <span class="main">⊓</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">-</span><span class="main">(</span><span class="skolem">x</span> <span class="main">⊓</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 5 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup.commute sup.left_commute<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span>stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="skolem">y</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">...</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="skolem">x</span><span class="main">)</span> <span class="main">⊔</span> Abs_regular <span class="main">(</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="main">(</span><span class="skolem">x</span> <span class="main">⊓</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">-</span><span class="main">(</span><span class="skolem">x</span> <span class="main">⊓</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stone_phi.hom<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="skolem">x</span> <span class="main">⊓</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="main">(</span><span class="skolem">x</span> <span class="main">⊓</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">-</span><span class="main">(</span><span class="skolem">x</span> <span class="main">⊓</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> sup_regular.abs_eq<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_onp_same_args<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 6<span class="main">:</span> <span class="quoted"><span class="quoted">"stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="skolem">x</span> <span class="main">⊓</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="main">(</span><span class="skolem">x</span> <span class="main">⊓</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">-</span><span class="main">(</span><span class="skolem">x</span> <span class="main">⊓</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span>stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="skolem">y</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Abs_regular <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="skolem">x</span> <span class="main">⊓</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Abs_regular <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="skolem">x</span><span class="main">)</span> <span class="main">⊓</span> Abs_regular <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> inf_regular.abs_eq<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_onp_same_args<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Abs_stone_phi_pair <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="main">(</span><span class="skolem">x</span> <span class="main">⊓</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="skolem">x</span> <span class="main">⊓</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="main">(</span><span class="skolem">x</span> <span class="main">⊓</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">⊔</span> <span class="main">-</span><span class="main">(</span><span class="skolem">x</span> <span class="main">⊓</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Abs_stone_phi_pair <span class="main">(</span>triple.pairs_inf <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="skolem">x</span><span class="main">)</span><span class="main">,</span>stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">,</span>stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="skolem">y</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 6 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Abs_stone_phi_pair <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="skolem">x</span><span class="main">)</span><span class="main">,</span>stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊓</span> Abs_stone_phi_pair <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">,</span>stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="skolem">y</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> inf_stone_phi_pair.abs_eq<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_onp_same_args sa_iso_triple_pair<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sa_iso <span class="main">(</span><span class="skolem">x</span> <span class="main">⊓</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> sa_iso <span class="skolem">x</span> <span class="main">⊓</span> sa_iso <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">::</span><span class="tfree">'a</span> <span class="main">.</span> sa_iso <span class="main">(</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span>sa_iso <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sa_iso <span class="main">(</span><span class="main">-</span><span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> Abs_stone_phi_pair <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="main">-</span><span class="skolem">x</span><span class="main">)</span><span class="main">,</span>stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> up_filter top<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> top_dense_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Abs_stone_phi_pair <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="main">-</span><span class="skolem">x</span><span class="main">)</span><span class="main">,</span>stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bot_filter.abs_eq sup_bot.right_neutral up_top<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Abs_stone_phi_pair <span class="main">(</span>triple.pairs_uminus stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="main">-</span><span class="skolem">x</span><span class="main">)</span><span class="main">,</span>stone_phi <span class="main">(</span>Abs_regular <span class="main">(</span><span class="main">-</span><span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="main">(</span>Abs_dense <span class="main">(</span><span class="skolem">x</span> <span class="main">⊔</span> <span class="main">-</span><span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> uminus_regular.abs_eq<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> eq_onp_same_args<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">-</span>sa_iso <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_onp_def sa_iso_triple_pair uminus_stone_phi_pair.abs_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sa_iso <span class="main">(</span><span class="main">-</span><span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span>sa_iso <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bij sa_iso"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> sa_iso_left_invertible sa_iso_right_invertible invertible_bij<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> g<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">sa_iso_inv</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Triple Isomorphism›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
In this section we prove that the triple of the Stone algebra of a triple is isomorphic to the original triple.
The notion of isomorphism for triples is described in \cite{ChenGraetzer1969}.
It amounts to an isomorphism of Boolean algebras, an isomorphism of distributive lattices with a greatest element, and a commuting diagram involving the structure maps.
›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Boolean Algebra Isomorphism›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We first define and prove the isomorphism of Boolean algebras.
Because the Stone algebra of a triple is implemented as a lifted pair, we also lift the Boolean algebra.
›</span></span>

<span class="keyword1"><span class="command">typedef</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">overloaded</span></span><span class="main">)</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> lifted_boolean_algebra <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span> <span class="bound">xf</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>non_trivial_boolean_algebra<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>distrib_lattice_top<span class="main">)</span> phi <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">.</span> True <span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">setup_lifting</span></span> type_definition_lifted_boolean_algebra

<span class="keyword1"><span class="command">instantiation</span></span> lifted_boolean_algebra <span class="main">::</span> <span class="main">(</span><span class="quoted">non_trivial_boolean_algebra</span><span class="main">,</span><span class="quoted">distrib_lattice_top</span><span class="main">)</span> <span class="quoted">boolean_algebra</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">sup_lifted_boolean_algebra</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> lifted_boolean_algebra <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> lifted_boolean_algebra <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> lifted_boolean_algebra"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">xf</span> <span class="bound">yf</span> <span class="bound">f</span> <span class="main">.</span> sup <span class="main">(</span><span class="bound">xf</span> <span class="bound">f</span><span class="main">)</span> <span class="main">(</span><span class="bound">yf</span> <span class="bound">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">inf_lifted_boolean_algebra</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> lifted_boolean_algebra <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> lifted_boolean_algebra <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> lifted_boolean_algebra"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">xf</span> <span class="bound">yf</span> <span class="bound">f</span> <span class="main">.</span> inf <span class="main">(</span><span class="bound">xf</span> <span class="bound">f</span><span class="main">)</span> <span class="main">(</span><span class="bound">yf</span> <span class="bound">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">minus_lifted_boolean_algebra</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> lifted_boolean_algebra <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> lifted_boolean_algebra <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> lifted_boolean_algebra"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">xf</span> <span class="bound">yf</span> <span class="bound">f</span> <span class="main">.</span> minus <span class="main">(</span><span class="bound">xf</span> <span class="bound">f</span><span class="main">)</span> <span class="main">(</span><span class="bound">yf</span> <span class="bound">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">uminus_lifted_boolean_algebra</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> lifted_boolean_algebra <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> lifted_boolean_algebra"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">xf</span> <span class="bound">f</span> <span class="main">.</span> uminus <span class="main">(</span><span class="bound">xf</span> <span class="bound">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">bot_lifted_boolean_algebra</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> lifted_boolean_algebra"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> bot"</span></span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">top_lifted_boolean_algebra</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> lifted_boolean_algebra"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> top"</span></span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">less_eq_lifted_boolean_algebra</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> lifted_boolean_algebra <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> lifted_boolean_algebra <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">xf</span> <span class="bound">yf</span> <span class="main">.</span> <span class="main">∀</span><span class="bound">f</span> <span class="main">.</span> less_eq <span class="main">(</span><span class="bound">xf</span> <span class="bound">f</span><span class="main">)</span> <span class="main">(</span><span class="bound">yf</span> <span class="bound">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">less_lifted_boolean_algebra</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> lifted_boolean_algebra <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> lifted_boolean_algebra <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">xf</span> <span class="bound">yf</span> <span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">f</span> <span class="main">.</span> less_eq <span class="main">(</span><span class="bound">xf</span> <span class="bound">f</span><span class="main">)</span> <span class="main">(</span><span class="bound">yf</span> <span class="bound">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> <span class="main">(</span><span class="main">∀</span><span class="bound">f</span> <span class="main">.</span> less_eq <span class="main">(</span><span class="bound">yf</span> <span class="bound">f</span><span class="main">)</span> <span class="main">(</span><span class="bound">xf</span> <span class="bound">f</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">intro_classes</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command">using</span></span> order_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command">using</span></span> antisym ext <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup_inf_distrib1<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> diff_eq<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following two definitions give the Boolean algebra isomorphism.
›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">ba_iso_inv</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>non_trivial_boolean_algebra<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>distrib_lattice_top<span class="main">)</span> lifted_boolean_algebra <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> lifted_pair regular"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">ba_iso_inv</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">xf</span> <span class="main">.</span> Abs_regular <span class="main">(</span>Abs_lifted_pair <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> <span class="main">(</span>Rep_lifted_boolean_algebra <span class="bound">xf</span> <span class="bound">f</span><span class="main">,</span>Rep_phi <span class="bound">f</span> <span class="main">(</span><span class="main">-</span>Rep_lifted_boolean_algebra <span class="bound">xf</span> <span class="bound">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">ba_iso</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>non_trivial_boolean_algebra<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>distrib_lattice_top<span class="main">)</span> lifted_pair regular <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> lifted_boolean_algebra"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">ba_iso</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">pf</span> <span class="main">.</span> Abs_lifted_boolean_algebra <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> fst <span class="main">(</span>Rep_lifted_pair <span class="main">(</span>Rep_regular <span class="bound">pf</span><span class="main">)</span> <span class="bound">f</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Stone_Construction-ba_iso_inv_lifted_pair"><span class="command">lemma</span></span> ba_iso_inv_lifted_pair<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>Rep_lifted_boolean_algebra <span class="free">xf</span> <span class="free">f</span><span class="main">,</span>Rep_phi <span class="free">f</span> <span class="main">(</span><span class="main">-</span>Rep_lifted_boolean_algebra <span class="free">xf</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> triple.pairs <span class="main">(</span>Rep_phi <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> double_compl simp_phi triple.pairs_uminus.simps triple_def triple.pairs_uminus_closed<span class="main">)</span>

<span class="keyword1" id="Stone_Construction-ba_iso_inv_regular"><span class="command">lemma</span></span> ba_iso_inv_regular<span class="main">:</span>
  <span class="quoted"><span class="quoted">"regular <span class="main">(</span>Abs_lifted_pair <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> <span class="main">(</span>Rep_lifted_boolean_algebra <span class="free">xf</span> <span class="bound">f</span><span class="main">,</span>Rep_phi <span class="bound">f</span> <span class="main">(</span><span class="main">-</span>Rep_lifted_boolean_algebra <span class="free">xf</span> <span class="bound">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">f</span> <span class="main">.</span> <span class="main">(</span>Rep_lifted_boolean_algebra <span class="free">xf</span> <span class="bound">f</span><span class="main">,</span>Rep_phi <span class="bound">f</span> <span class="main">(</span><span class="main">-</span>Rep_lifted_boolean_algebra <span class="free">xf</span> <span class="bound">f</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> triple.pairs_uminus <span class="main">(</span>Rep_phi <span class="bound">f</span><span class="main">)</span> <span class="main">(</span>triple.pairs_uminus <span class="main">(</span>Rep_phi <span class="bound">f</span><span class="main">)</span> <span class="main">(</span>Rep_lifted_boolean_algebra <span class="free">xf</span> <span class="bound">f</span><span class="main">,</span>Rep_phi <span class="bound">f</span> <span class="main">(</span><span class="main">-</span>Rep_lifted_boolean_algebra <span class="free">xf</span> <span class="bound">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> triple.pairs_uminus.simps triple_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Abs_lifted_pair <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> <span class="main">(</span>Rep_lifted_boolean_algebra <span class="free">xf</span> <span class="bound">f</span><span class="main">,</span>Rep_phi <span class="bound">f</span> <span class="main">(</span><span class="main">-</span>Rep_lifted_boolean_algebra <span class="free">xf</span> <span class="bound">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">-</span>Abs_lifted_pair <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> <span class="main">(</span>Rep_lifted_boolean_algebra <span class="free">xf</span> <span class="bound">f</span><span class="main">,</span>Rep_phi <span class="bound">f</span> <span class="main">(</span><span class="main">-</span>Rep_lifted_boolean_algebra <span class="free">xf</span> <span class="bound">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> triple.pairs_uminus_closed triple_def eq_onp_def uminus_lifted_pair.abs_eq ba_iso_inv_lifted_pair<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following two results prove that the isomorphisms are mutually inverse.
›</span></span>

<span class="keyword1" id="Stone_Construction-ba_iso_left_invertible"><span class="command">lemma</span></span> ba_iso_left_invertible<span class="main">:</span>
  <span class="quoted"><span class="quoted">"ba_iso_inv <span class="main">(</span>ba_iso <span class="free">pf</span><span class="main">)</span> <span class="main">=</span> <span class="free">pf</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">f</span> <span class="main">.</span> snd <span class="main">(</span>Rep_lifted_pair <span class="main">(</span>Rep_regular <span class="free">pf</span><span class="main">)</span> <span class="bound">f</span><span class="main">)</span> <span class="main">=</span> Rep_phi <span class="bound">f</span> <span class="main">(</span><span class="main">-</span>fst <span class="main">(</span>Rep_lifted_pair <span class="main">(</span>Rep_regular <span class="free">pf</span><span class="main">)</span> <span class="bound">f</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> phi"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Rep_phi <span class="skolem">f</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"triple <span class="var">?r</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> triple_def<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span> <span class="main">.</span> triple.pairs_uminus <span class="var">?r</span> <span class="bound">p</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span>fst <span class="bound">p</span><span class="main">,</span><span class="var">?r</span> <span class="main">(</span>fst <span class="bound">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> prod.collapse triple.pairs_uminus.simps<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"Rep_regular <span class="free">pf</span> <span class="main">=</span> <span class="main">-</span><span class="main">-</span>Rep_regular <span class="free">pf</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> regular_in_p_image_iff<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>Rep_lifted_pair <span class="main">(</span>Rep_regular <span class="free">pf</span><span class="main">)</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">=</span> <span class="var">?r</span> <span class="main">(</span><span class="main">-</span>fst <span class="main">(</span>Rep_lifted_pair <span class="main">(</span>Rep_regular <span class="free">pf</span><span class="main">)</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 2 3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fstI sndI uminus_lifted_pair.rep_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ba_iso_inv <span class="main">(</span>ba_iso <span class="free">pf</span><span class="main">)</span> <span class="main">=</span> Abs_regular <span class="main">(</span>Abs_lifted_pair <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> <span class="main">(</span>fst <span class="main">(</span>Rep_lifted_pair <span class="main">(</span>Rep_regular <span class="free">pf</span><span class="main">)</span> <span class="bound">f</span><span class="main">)</span><span class="main">,</span>Rep_phi <span class="bound">f</span> <span class="main">(</span><span class="main">-</span>fst <span class="main">(</span>Rep_lifted_pair <span class="main">(</span>Rep_regular <span class="free">pf</span><span class="main">)</span> <span class="bound">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_lifted_boolean_algebra_inverse<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Abs_regular <span class="main">(</span>Abs_lifted_pair <span class="main">(</span>Rep_lifted_pair <span class="main">(</span>Rep_regular <span class="free">pf</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> prod.collapse<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">pf</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Rep_regular_inverse Rep_lifted_pair_inverse<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Stone_Construction-ba_iso_right_invertible"><span class="command">lemma</span></span> ba_iso_right_invertible<span class="main">:</span>
  <span class="quoted"><span class="quoted">"ba_iso <span class="main">(</span>ba_iso_inv <span class="free">xf</span><span class="main">)</span> <span class="main">=</span> <span class="free">xf</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?rf</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Rep_lifted_boolean_algebra <span class="free">xf</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">f</span> <span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="var">?rf</span> <span class="bound">f</span><span class="main">,</span>Rep_phi <span class="bound">f</span> <span class="main">(</span><span class="var">?rf</span> <span class="bound">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> triple.pairs <span class="main">(</span>Rep_phi <span class="bound">f</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="var">?rf</span> <span class="bound">f</span><span class="main">,</span>Rep_phi <span class="bound">f</span> <span class="main">(</span><span class="main">-</span><span class="var">?rf</span> <span class="bound">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> triple.pairs <span class="main">(</span>Rep_phi <span class="bound">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"up_filter top <span class="main">=</span> bot"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bot_filter.abs_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">z</span> <span class="main">.</span> Rep_phi <span class="skolem">f</span> <span class="main">(</span><span class="var">?rf</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">=</span> Rep_phi <span class="skolem">f</span> <span class="main">(</span><span class="var">?rf</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="bound">z</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">z</span> <span class="main">.</span> Rep_phi <span class="skolem">f</span> <span class="main">(</span><span class="main">-</span><span class="var">?rf</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">=</span> Rep_phi <span class="skolem">f</span> <span class="main">(</span><span class="main">-</span><span class="var">?rf</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="bound">z</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sup_bot_right<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span><span class="var">?rf</span> <span class="skolem">f</span><span class="main">,</span>Rep_phi <span class="skolem">f</span> <span class="main">(</span><span class="var">?rf</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> triple.pairs <span class="main">(</span>Rep_phi <span class="skolem">f</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="var">?rf</span> <span class="skolem">f</span><span class="main">,</span>Rep_phi <span class="skolem">f</span> <span class="main">(</span><span class="main">-</span><span class="var">?rf</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> triple.pairs <span class="main">(</span>Rep_phi <span class="skolem">f</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> triple_def triple.pairs_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"regular <span class="main">(</span>Abs_lifted_pair <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> <span class="main">(</span><span class="var">?rf</span> <span class="bound">f</span><span class="main">,</span>Rep_phi <span class="bound">f</span> <span class="main">(</span><span class="main">-</span><span class="var">?rf</span> <span class="bound">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">-</span>Abs_lifted_pair <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> <span class="main">(</span><span class="var">?rf</span> <span class="bound">f</span><span class="main">,</span>Rep_phi <span class="bound">f</span> <span class="main">(</span><span class="main">-</span><span class="var">?rf</span> <span class="bound">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span>Abs_lifted_pair <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> triple.pairs_uminus <span class="main">(</span>Rep_phi <span class="bound">f</span><span class="main">)</span> <span class="main">(</span><span class="var">?rf</span> <span class="bound">f</span><span class="main">,</span>Rep_phi <span class="bound">f</span> <span class="main">(</span><span class="main">-</span><span class="var">?rf</span> <span class="bound">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_onp_same_args uminus_lifted_pair.abs_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">-</span>Abs_lifted_pair <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> <span class="main">(</span><span class="main">-</span><span class="var">?rf</span> <span class="bound">f</span><span class="main">,</span>Rep_phi <span class="bound">f</span> <span class="main">(</span><span class="var">?rf</span> <span class="bound">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> simp_phi triple_def triple.pairs_uminus.simps<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Abs_lifted_pair <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> triple.pairs_uminus <span class="main">(</span>Rep_phi <span class="bound">f</span><span class="main">)</span> <span class="main">(</span><span class="main">-</span><span class="var">?rf</span> <span class="bound">f</span><span class="main">,</span>Rep_phi <span class="bound">f</span> <span class="main">(</span><span class="var">?rf</span> <span class="bound">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_onp_same_args uminus_lifted_pair.abs_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Abs_lifted_pair <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> <span class="main">(</span><span class="var">?rf</span> <span class="bound">f</span><span class="main">,</span>Rep_phi <span class="bound">f</span> <span class="main">(</span><span class="main">-</span><span class="var">?rf</span> <span class="bound">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> simp_phi triple_def triple.pairs_uminus.simps double_compl<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"in_p_image <span class="main">(</span>Abs_lifted_pair <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> <span class="main">(</span><span class="var">?rf</span> <span class="bound">f</span><span class="main">,</span>Rep_phi <span class="bound">f</span> <span class="main">(</span><span class="main">-</span><span class="var">?rf</span> <span class="bound">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Rep_lifted_boolean_algebra_inverse Abs_lifted_pair_inverse Abs_regular_inverse<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The isomorphism is established by proving the remaining Boolean algebra homomorphism properties.
›</span></span>

<span class="keyword1" id="Stone_Construction-ba_iso"><span class="command">lemma</span></span> ba_iso<span class="main">:</span>
  <span class="quoted"><span class="quoted">"boolean_algebra_isomorphism ba_iso"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Abs_lifted_boolean_algebra <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> fst <span class="main">(</span>Rep_lifted_pair <span class="main">(</span>Rep_regular bot<span class="main">)</span> <span class="bound">f</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> bot"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bot_lifted_boolean_algebra_def bot_regular.rep_eq bot_lifted_pair.rep_eq<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Abs_lifted_boolean_algebra <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> fst <span class="main">(</span>Rep_lifted_pair <span class="main">(</span>Rep_regular top<span class="main">)</span> <span class="bound">f</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> top_lifted_boolean_algebra_def top_regular.rep_eq top_lifted_pair.rep_eq<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">pf</span> <span class="bound">qf</span> <span class="main">.</span> Abs_lifted_boolean_algebra <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> phi <span class="main">.</span> fst <span class="main">(</span>Rep_lifted_pair <span class="main">(</span>Rep_regular <span class="main">(</span><span class="bound">pf</span> <span class="main">⊔</span> <span class="bound">qf</span><span class="main">)</span><span class="main">)</span> <span class="bound">f</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Abs_lifted_boolean_algebra <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> fst <span class="main">(</span>Rep_lifted_pair <span class="main">(</span>Rep_regular <span class="bound">pf</span><span class="main">)</span> <span class="bound">f</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> Abs_lifted_boolean_algebra <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> fst <span class="main">(</span>Rep_lifted_pair <span class="main">(</span>Rep_regular <span class="bound">qf</span><span class="main">)</span> <span class="bound">f</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">pf</span> <span class="skolem">qf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> lifted_pair regular"</span></span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="keyword2"><span class="keyword">where</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> Rep_lifted_pair <span class="main">(</span>Rep_regular <span class="skolem">pf</span><span class="main">)</span> <span class="skolem">f</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">z</span><span class="main">,</span><span class="skolem">w</span><span class="main">)</span> <span class="main">=</span> Rep_lifted_pair <span class="main">(</span>Rep_regular <span class="skolem">qf</span><span class="main">)</span> <span class="skolem">f</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> prod.collapse <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"triple <span class="main">(</span>Rep_phi <span class="skolem">f</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> triple_def<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>triple.pairs_sup <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="main">(</span><span class="skolem">z</span><span class="main">,</span><span class="skolem">w</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="main">⊔</span> fst <span class="main">(</span><span class="skolem">z</span><span class="main">,</span><span class="skolem">w</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> triple.pairs_sup.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>triple.pairs_sup <span class="main">(</span>Rep_lifted_pair <span class="main">(</span>Rep_regular <span class="skolem">pf</span><span class="main">)</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span>Rep_lifted_pair <span class="main">(</span>Rep_regular <span class="skolem">qf</span><span class="main">)</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span>Rep_lifted_pair <span class="main">(</span>Rep_regular <span class="skolem">pf</span><span class="main">)</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">⊔</span> fst <span class="main">(</span>Rep_lifted_pair <span class="main">(</span>Rep_regular <span class="skolem">qf</span><span class="main">)</span> <span class="skolem">f</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>Rep_lifted_pair <span class="main">(</span>Rep_regular <span class="main">(</span><span class="skolem">pf</span> <span class="main">⊔</span> <span class="skolem">qf</span><span class="main">)</span><span class="main">)</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span>Rep_lifted_pair <span class="main">(</span>Rep_regular <span class="skolem">pf</span><span class="main">)</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">⊔</span> fst <span class="main">(</span>Rep_lifted_pair <span class="main">(</span>Rep_regular <span class="skolem">qf</span><span class="main">)</span> <span class="skolem">f</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> sup_regular.rep_eq sup_lifted_pair.rep_eq<span class="main">)</span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"Abs_lifted_boolean_algebra <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> fst <span class="main">(</span>Rep_lifted_pair <span class="main">(</span>Rep_regular <span class="main">(</span><span class="skolem">pf</span> <span class="main">⊔</span> <span class="skolem">qf</span><span class="main">)</span><span class="main">)</span> <span class="bound">f</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Abs_lifted_boolean_algebra <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> fst <span class="main">(</span>Rep_lifted_pair <span class="main">(</span>Rep_regular <span class="skolem">pf</span><span class="main">)</span> <span class="bound">f</span><span class="main">)</span><span class="main">)</span> <span class="main">⊔</span> Abs_lifted_boolean_algebra <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> fst <span class="main">(</span>Rep_lifted_pair <span class="main">(</span>Rep_regular <span class="skolem">qf</span><span class="main">)</span> <span class="bound">f</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_onp_same_args sup_lifted_boolean_algebra.abs_eq sup_regular.rep_eq sup_lifted_boolean_algebra.rep_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">pf</span> <span class="bound">qf</span> <span class="main">.</span> Abs_lifted_boolean_algebra <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> phi <span class="main">.</span> fst <span class="main">(</span>Rep_lifted_pair <span class="main">(</span>Rep_regular <span class="main">(</span><span class="bound">pf</span> <span class="main">⊓</span> <span class="bound">qf</span><span class="main">)</span><span class="main">)</span> <span class="bound">f</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Abs_lifted_boolean_algebra <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> fst <span class="main">(</span>Rep_lifted_pair <span class="main">(</span>Rep_regular <span class="bound">pf</span><span class="main">)</span> <span class="bound">f</span><span class="main">)</span><span class="main">)</span> <span class="main">⊓</span> Abs_lifted_boolean_algebra <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> fst <span class="main">(</span>Rep_lifted_pair <span class="main">(</span>Rep_regular <span class="bound">qf</span><span class="main">)</span> <span class="bound">f</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">pf</span> <span class="skolem">qf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> lifted_pair regular"</span></span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="keyword2"><span class="keyword">where</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> Rep_lifted_pair <span class="main">(</span>Rep_regular <span class="skolem">pf</span><span class="main">)</span> <span class="skolem">f</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">z</span><span class="main">,</span><span class="skolem">w</span><span class="main">)</span> <span class="main">=</span> Rep_lifted_pair <span class="main">(</span>Rep_regular <span class="skolem">qf</span><span class="main">)</span> <span class="skolem">f</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> prod.collapse <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"triple <span class="main">(</span>Rep_phi <span class="skolem">f</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> triple_def<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>triple.pairs_inf <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="main">(</span><span class="skolem">z</span><span class="main">,</span><span class="skolem">w</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="main">⊓</span> fst <span class="main">(</span><span class="skolem">z</span><span class="main">,</span><span class="skolem">w</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> triple.pairs_inf.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>triple.pairs_inf <span class="main">(</span>Rep_lifted_pair <span class="main">(</span>Rep_regular <span class="skolem">pf</span><span class="main">)</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span>Rep_lifted_pair <span class="main">(</span>Rep_regular <span class="skolem">qf</span><span class="main">)</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span>Rep_lifted_pair <span class="main">(</span>Rep_regular <span class="skolem">pf</span><span class="main">)</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">⊓</span> fst <span class="main">(</span>Rep_lifted_pair <span class="main">(</span>Rep_regular <span class="skolem">qf</span><span class="main">)</span> <span class="skolem">f</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>Rep_lifted_pair <span class="main">(</span>Rep_regular <span class="main">(</span><span class="skolem">pf</span> <span class="main">⊓</span> <span class="skolem">qf</span><span class="main">)</span><span class="main">)</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span>Rep_lifted_pair <span class="main">(</span>Rep_regular <span class="skolem">pf</span><span class="main">)</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">⊓</span> fst <span class="main">(</span>Rep_lifted_pair <span class="main">(</span>Rep_regular <span class="skolem">qf</span><span class="main">)</span> <span class="skolem">f</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> inf_regular.rep_eq inf_lifted_pair.rep_eq<span class="main">)</span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"Abs_lifted_boolean_algebra <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> fst <span class="main">(</span>Rep_lifted_pair <span class="main">(</span>Rep_regular <span class="main">(</span><span class="skolem">pf</span> <span class="main">⊓</span> <span class="skolem">qf</span><span class="main">)</span><span class="main">)</span> <span class="bound">f</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Abs_lifted_boolean_algebra <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> fst <span class="main">(</span>Rep_lifted_pair <span class="main">(</span>Rep_regular <span class="skolem">pf</span><span class="main">)</span> <span class="bound">f</span><span class="main">)</span><span class="main">)</span> <span class="main">⊓</span> Abs_lifted_boolean_algebra <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> fst <span class="main">(</span>Rep_lifted_pair <span class="main">(</span>Rep_regular <span class="skolem">qf</span><span class="main">)</span> <span class="bound">f</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_onp_same_args inf_lifted_boolean_algebra.abs_eq inf_regular.rep_eq inf_lifted_boolean_algebra.rep_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">pf</span> <span class="main">.</span> Abs_lifted_boolean_algebra <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> phi <span class="main">.</span> fst <span class="main">(</span>Rep_lifted_pair <span class="main">(</span>Rep_regular <span class="main">(</span><span class="main">-</span><span class="bound">pf</span><span class="main">)</span><span class="main">)</span> <span class="bound">f</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span>Abs_lifted_boolean_algebra <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> fst <span class="main">(</span>Rep_lifted_pair <span class="main">(</span>Rep_regular <span class="bound">pf</span><span class="main">)</span> <span class="bound">f</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">pf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> lifted_pair regular"</span></span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> Rep_lifted_pair <span class="main">(</span>Rep_regular <span class="skolem">pf</span><span class="main">)</span> <span class="skolem">f</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> prod.collapse <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"triple <span class="main">(</span>Rep_phi <span class="skolem">f</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> triple_def<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>triple.pairs_uminus <span class="main">(</span>Rep_phi <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span>fst <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> triple.pairs_uminus.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>triple.pairs_uminus <span class="main">(</span>Rep_phi <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span>Rep_lifted_pair <span class="main">(</span>Rep_regular <span class="skolem">pf</span><span class="main">)</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span>fst <span class="main">(</span>Rep_lifted_pair <span class="main">(</span>Rep_regular <span class="skolem">pf</span><span class="main">)</span> <span class="skolem">f</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>Rep_lifted_pair <span class="main">(</span>Rep_regular <span class="main">(</span><span class="main">-</span><span class="skolem">pf</span><span class="main">)</span><span class="main">)</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span>fst <span class="main">(</span>Rep_lifted_pair <span class="main">(</span>Rep_regular <span class="skolem">pf</span><span class="main">)</span> <span class="skolem">f</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> uminus_regular.rep_eq uminus_lifted_pair.rep_eq<span class="main">)</span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"Abs_lifted_boolean_algebra <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> fst <span class="main">(</span>Rep_lifted_pair <span class="main">(</span>Rep_regular <span class="main">(</span><span class="main">-</span><span class="skolem">pf</span><span class="main">)</span><span class="main">)</span> <span class="bound">f</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span>Abs_lifted_boolean_algebra <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> fst <span class="main">(</span>Rep_lifted_pair <span class="main">(</span>Rep_regular <span class="skolem">pf</span><span class="main">)</span> <span class="bound">f</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_onp_same_args uminus_lifted_boolean_algebra.abs_eq uminus_regular.rep_eq uminus_lifted_boolean_algebra.rep_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">pf</span> <span class="bound">qf</span> <span class="main">.</span> Abs_lifted_boolean_algebra <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> phi <span class="main">.</span> fst <span class="main">(</span>Rep_lifted_pair <span class="main">(</span>Rep_regular <span class="main">(</span><span class="bound">pf</span> <span class="main">-</span> <span class="bound">qf</span><span class="main">)</span><span class="main">)</span> <span class="bound">f</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Abs_lifted_boolean_algebra <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> fst <span class="main">(</span>Rep_lifted_pair <span class="main">(</span>Rep_regular <span class="bound">pf</span><span class="main">)</span> <span class="bound">f</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Abs_lifted_boolean_algebra <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> fst <span class="main">(</span>Rep_lifted_pair <span class="main">(</span>Rep_regular <span class="bound">qf</span><span class="main">)</span> <span class="bound">f</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> diff_eq<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bij ba_iso"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> invertible_bij<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> g<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">ba_iso_inv</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ba_iso_left_invertible ba_iso_right_invertible<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Distributive Lattice Isomorphism›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We carry out a similar development for the isomorphism of distributive lattices.
Again, the original distributive lattice with a greatest element needs to be lifted to match the lifted pairs.
›</span></span>

<span class="keyword1"><span class="command">typedef</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">overloaded</span></span><span class="main">)</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> lifted_distrib_lattice_top <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span> <span class="bound">xf</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>non_trivial_boolean_algebra<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>distrib_lattice_top<span class="main">)</span> phi <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">.</span> True <span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">setup_lifting</span></span> type_definition_lifted_distrib_lattice_top

<span class="keyword1"><span class="command">instantiation</span></span> lifted_distrib_lattice_top <span class="main">::</span> <span class="main">(</span><span class="quoted">non_trivial_boolean_algebra</span><span class="main">,</span><span class="quoted">distrib_lattice_top</span><span class="main">)</span> <span class="quoted">distrib_lattice_top</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">sup_lifted_distrib_lattice_top</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> lifted_distrib_lattice_top <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> lifted_distrib_lattice_top <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> lifted_distrib_lattice_top"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">xf</span> <span class="bound">yf</span> <span class="bound">f</span> <span class="main">.</span> sup <span class="main">(</span><span class="bound">xf</span> <span class="bound">f</span><span class="main">)</span> <span class="main">(</span><span class="bound">yf</span> <span class="bound">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">inf_lifted_distrib_lattice_top</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> lifted_distrib_lattice_top <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> lifted_distrib_lattice_top <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> lifted_distrib_lattice_top"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">xf</span> <span class="bound">yf</span> <span class="bound">f</span> <span class="main">.</span> inf <span class="main">(</span><span class="bound">xf</span> <span class="bound">f</span><span class="main">)</span> <span class="main">(</span><span class="bound">yf</span> <span class="bound">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">top_lifted_distrib_lattice_top</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> lifted_distrib_lattice_top"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> top"</span></span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">less_eq_lifted_distrib_lattice_top</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> lifted_distrib_lattice_top <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> lifted_distrib_lattice_top <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">xf</span> <span class="bound">yf</span> <span class="main">.</span> <span class="main">∀</span><span class="bound">f</span> <span class="main">.</span> less_eq <span class="main">(</span><span class="bound">xf</span> <span class="bound">f</span><span class="main">)</span> <span class="main">(</span><span class="bound">yf</span> <span class="bound">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">less_lifted_distrib_lattice_top</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> lifted_distrib_lattice_top <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> lifted_distrib_lattice_top <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">xf</span> <span class="bound">yf</span> <span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">f</span> <span class="main">.</span> less_eq <span class="main">(</span><span class="bound">xf</span> <span class="bound">f</span><span class="main">)</span> <span class="main">(</span><span class="bound">yf</span> <span class="bound">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> <span class="main">(</span><span class="main">∀</span><span class="bound">f</span> <span class="main">.</span> less_eq <span class="main">(</span><span class="bound">yf</span> <span class="bound">f</span><span class="main">)</span> <span class="main">(</span><span class="bound">xf</span> <span class="bound">f</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">intro_classes</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command">using</span></span> order_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command">using</span></span> antisym ext <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup_inf_distrib1<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following function extracts the least element of the filter of a dense pair, which turns out to be a principal filter.
It is used to define one of the isomorphisms below.
›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">get_dense</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>non_trivial_boolean_algebra<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>distrib_lattice_top<span class="main">)</span> lifted_pair dense <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> phi <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">get_dense</span> <span class="free"><span class="bound"><span class="entity">pf</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">z</span> <span class="main">.</span> Rep_lifted_pair <span class="main">(</span>Rep_dense <span class="free"><span class="bound"><span class="entity">pf</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> <span class="main">(</span>top<span class="main">,</span>up_filter <span class="bound">z</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Stone_Construction-get_dense_char"><span class="command">lemma</span></span> get_dense_char<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Rep_lifted_pair <span class="main">(</span>Rep_dense <span class="free">pf</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> <span class="main">(</span>top<span class="main">,</span>up_filter <span class="main">(</span>get_dense <span class="free">pf</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> Rep_lifted_pair <span class="main">(</span>Rep_dense <span class="free">pf</span><span class="main">)</span> <span class="free">f</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> triple.pairs <span class="main">(</span>Rep_phi <span class="free">f</span><span class="main">)</span> <span class="main">∧</span> triple.pairs_uminus <span class="main">(</span>Rep_phi <span class="free">f</span><span class="main">)</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> triple.pairs_bot"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bot_lifted_pair.rep_eq prod.collapse simp_dense simp_lifted_pair uminus_lifted_pair.rep_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> triple.intro triple.pairs_uminus.simps dense_pp<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"triple <span class="main">(</span>Rep_phi <span class="free">f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> triple_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">z</span><span class="main">.</span> <span class="skolem">y</span> <span class="main">=</span> Rep_phi <span class="free">f</span> <span class="main">(</span><span class="main">-</span><span class="skolem">x</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="bound">z</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 triple.pairs_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> up_filter <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Rep_lifted_pair <span class="main">(</span>Rep_dense <span class="free">pf</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> <span class="main">(</span>top<span class="main">,</span>up_filter <span class="skolem">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> tfl_some get_dense.simps<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following two definitions give the distributive lattice isomorphism.
›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">dl_iso_inv</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>non_trivial_boolean_algebra<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>distrib_lattice_top<span class="main">)</span> lifted_distrib_lattice_top <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> lifted_pair dense"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">dl_iso_inv</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">xf</span> <span class="main">.</span> Abs_dense <span class="main">(</span>Abs_lifted_pair <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> <span class="main">(</span>top<span class="main">,</span>up_filter <span class="main">(</span>Rep_lifted_distrib_lattice_top <span class="bound">xf</span> <span class="bound">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">dl_iso</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>non_trivial_boolean_algebra<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>distrib_lattice_top<span class="main">)</span> lifted_pair dense <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> lifted_distrib_lattice_top"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">dl_iso</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">pf</span> <span class="main">.</span> Abs_lifted_distrib_lattice_top <span class="main">(</span>get_dense <span class="bound">pf</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Stone_Construction-dl_iso_inv_lifted_pair"><span class="command">lemma</span></span> dl_iso_inv_lifted_pair<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>top<span class="main">,</span>up_filter <span class="main">(</span>Rep_lifted_distrib_lattice_top <span class="free">xf</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> triple.pairs <span class="main">(</span>Rep_phi <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> compl_bot_eq double_compl simp_phi sup_bot.left_neutral triple.sa_iso_pair triple_def<span class="main">)</span>

<span class="keyword1" id="Stone_Construction-dl_iso_inv_dense"><span class="command">lemma</span></span> dl_iso_inv_dense<span class="main">:</span>
  <span class="quoted"><span class="quoted">"dense <span class="main">(</span>Abs_lifted_pair <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> <span class="main">(</span>top<span class="main">,</span>up_filter <span class="main">(</span>Rep_lifted_distrib_lattice_top <span class="free">xf</span> <span class="bound">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">f</span> <span class="main">.</span> triple.pairs_uminus <span class="main">(</span>Rep_phi <span class="bound">f</span><span class="main">)</span> <span class="main">(</span>top<span class="main">,</span>up_filter <span class="main">(</span>Rep_lifted_distrib_lattice_top <span class="free">xf</span> <span class="bound">f</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> triple.pairs_bot"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> top_filter.abs_eq triple.pairs_uminus.simps triple_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"bot <span class="main">=</span> <span class="main">-</span>Abs_lifted_pair <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> <span class="main">(</span>top<span class="main">,</span>up_filter <span class="main">(</span>Rep_lifted_distrib_lattice_top <span class="free">xf</span> <span class="bound">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_onp_def uminus_lifted_pair.abs_eq dl_iso_inv_lifted_pair bot_lifted_pair_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The following two results prove that the isomorphisms are mutually inverse.
›</span></span>

<span class="keyword1" id="Stone_Construction-dl_iso_left_invertible"><span class="command">lemma</span></span> dl_iso_left_invertible<span class="main">:</span>
  <span class="quoted"><span class="quoted">"dl_iso_inv <span class="main">(</span>dl_iso <span class="free">pf</span><span class="main">)</span> <span class="main">=</span> <span class="free">pf</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dl_iso_inv <span class="main">(</span>dl_iso <span class="free">pf</span><span class="main">)</span> <span class="main">=</span> Abs_dense <span class="main">(</span>Abs_lifted_pair <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> <span class="main">(</span>top<span class="main">,</span>up_filter <span class="main">(</span>get_dense <span class="free">pf</span> <span class="bound">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Abs_lifted_distrib_lattice_top_inverse UNIV_I UNIV_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Abs_dense <span class="main">(</span>Abs_lifted_pair <span class="main">(</span>Rep_lifted_pair <span class="main">(</span>Rep_dense <span class="free">pf</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> get_dense_char<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">pf</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Rep_dense_inverse Rep_lifted_pair_inverse<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Stone_Construction-dl_iso_right_invertible"><span class="command">lemma</span></span> dl_iso_right_invertible<span class="main">:</span>
  <span class="quoted"><span class="quoted">"dl_iso <span class="main">(</span>dl_iso_inv <span class="free">xf</span><span class="main">)</span> <span class="main">=</span> <span class="free">xf</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?rf</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Rep_lifted_distrib_lattice_top <span class="free">xf</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?pf</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Abs_dense <span class="main">(</span>Abs_lifted_pair <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> <span class="main">(</span>top<span class="main">,</span>up_filter <span class="main">(</span><span class="var">?rf</span> <span class="bound">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">f</span> <span class="main">.</span> <span class="main">(</span>top<span class="main">,</span>up_filter <span class="main">(</span><span class="var">?rf</span> <span class="bound">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> triple.pairs <span class="main">(</span>Rep_phi <span class="bound">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> phi"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"triple <span class="main">(</span>Rep_phi <span class="skolem">f</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> triple_def<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>top<span class="main">,</span>up_filter <span class="main">(</span><span class="var">?rf</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> triple.pairs <span class="main">(</span>Rep_phi <span class="skolem">f</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> triple.pairs_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"dense <span class="main">(</span>Abs_lifted_pair <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> <span class="main">(</span>top<span class="main">,</span>up_filter <span class="main">(</span><span class="var">?rf</span> <span class="bound">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span>Abs_lifted_pair <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> <span class="main">(</span>top<span class="main">,</span>up_filter <span class="main">(</span><span class="var">?rf</span> <span class="bound">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Abs_lifted_pair <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> triple.pairs_uminus <span class="main">(</span>Rep_phi <span class="bound">f</span><span class="main">)</span> <span class="main">(</span>top<span class="main">,</span>up_filter <span class="main">(</span><span class="var">?rf</span> <span class="bound">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_onp_same_args uminus_lifted_pair.abs_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Abs_lifted_pair <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> <span class="main">(</span>bot<span class="main">,</span>Rep_phi <span class="bound">f</span> top<span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> triple.pairs_uminus.simps triple_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Abs_lifted_pair <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> triple.pairs_bot<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> simp_phi triple.phi_top triple_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> bot"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bot_lifted_pair_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"get_dense <span class="var">?pf</span> <span class="main">=</span> <span class="var">?rf</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>top<span class="main">,</span>up_filter <span class="main">(</span>get_dense <span class="var">?pf</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Rep_lifted_pair <span class="main">(</span>Rep_dense <span class="var">?pf</span><span class="main">)</span> <span class="skolem">f</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> get_dense_char<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Rep_lifted_pair <span class="main">(</span>Abs_lifted_pair <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> <span class="main">(</span>top<span class="main">,</span>up_filter <span class="main">(</span><span class="var">?rf</span> <span class="bound">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">f</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Abs_dense_inverse 2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>top<span class="main">,</span>up_filter <span class="main">(</span><span class="var">?rf</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_lifted_pair_inverse<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"get_dense <span class="var">?pf</span> <span class="skolem">f</span> <span class="main">=</span> <span class="var">?rf</span> <span class="skolem">f</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> up_filter_injective <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Rep_lifted_distrib_lattice_top_inverse<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
To obtain the isomorphism, it remains to show the homomorphism properties of lattices with a greatest element.
›</span></span>

<span class="keyword1" id="Stone_Construction-dl_iso"><span class="command">lemma</span></span> dl_iso<span class="main">:</span>
  <span class="quoted"><span class="quoted">"bounded_lattice_top_isomorphism dl_iso"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"get_dense top <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> phi <span class="main">.</span> top<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> phi"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Rep_lifted_pair <span class="main">(</span>Rep_dense top<span class="main">)</span> <span class="skolem">f</span> <span class="main">=</span> <span class="main">(</span>top<span class="main">,</span>Abs_filter <span class="main">{</span>top<span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> top_dense.rep_eq top_lifted_pair.rep_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"up_filter <span class="main">(</span>get_dense top <span class="skolem">f</span><span class="main">)</span> <span class="main">=</span> Abs_filter <span class="main">{</span>top<span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> prod.inject get_dense_char<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Rep_filter <span class="main">(</span>up_filter <span class="main">(</span>get_dense top <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span>top<span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bot_filter.abs_eq bot_filter.rep_eq<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"get_dense top <span class="skolem">f</span> <span class="main">=</span> top"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> self_in_upset singletonD Abs_filter_inverse mem_Collect_eq up_filter<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"Abs_lifted_distrib_lattice_top <span class="main">(</span>get_dense top<span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> phi <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">=</span> top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> top_lifted_distrib_lattice_top_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">pf</span> <span class="bound">qf</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> lifted_pair dense <span class="main">.</span> Abs_lifted_distrib_lattice_top <span class="main">(</span>get_dense <span class="main">(</span><span class="bound">pf</span> <span class="main">⊔</span> <span class="bound">qf</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Abs_lifted_distrib_lattice_top <span class="main">(</span>get_dense <span class="bound">pf</span><span class="main">)</span> <span class="main">⊔</span> Abs_lifted_distrib_lattice_top <span class="main">(</span>get_dense <span class="bound">qf</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">pf</span> <span class="skolem">qf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> lifted_pair dense"</span></span>
    <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"Abs_lifted_distrib_lattice_top <span class="main">(</span>get_dense <span class="skolem">pf</span><span class="main">)</span> <span class="main">⊔</span> Abs_lifted_distrib_lattice_top <span class="main">(</span>get_dense <span class="skolem">qf</span><span class="main">)</span> <span class="main">=</span> Abs_lifted_distrib_lattice_top <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> get_dense <span class="skolem">pf</span> <span class="bound">f</span> <span class="main">⊔</span> get_dense <span class="skolem">qf</span> <span class="bound">f</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_onp_same_args sup_lifted_distrib_lattice_top.abs_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> get_dense <span class="main">(</span><span class="skolem">pf</span> <span class="main">⊔</span> <span class="skolem">qf</span><span class="main">)</span> <span class="bound">f</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> get_dense <span class="skolem">pf</span> <span class="bound">f</span> <span class="main">⊔</span> get_dense <span class="skolem">qf</span> <span class="bound">f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>top<span class="main">,</span>up_filter <span class="main">(</span>get_dense <span class="main">(</span><span class="skolem">pf</span> <span class="main">⊔</span> <span class="skolem">qf</span><span class="main">)</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Rep_lifted_pair <span class="main">(</span>Rep_dense <span class="main">(</span><span class="skolem">pf</span> <span class="main">⊔</span> <span class="skolem">qf</span><span class="main">)</span><span class="main">)</span> <span class="skolem">f</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> get_dense_char<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> triple.pairs_sup <span class="main">(</span>Rep_lifted_pair <span class="main">(</span>Rep_dense <span class="skolem">pf</span><span class="main">)</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span>Rep_lifted_pair <span class="main">(</span>Rep_dense <span class="skolem">qf</span><span class="main">)</span> <span class="skolem">f</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup_lifted_pair.rep_eq sup_dense.rep_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> triple.pairs_sup <span class="main">(</span>top<span class="main">,</span>up_filter <span class="main">(</span>get_dense <span class="skolem">pf</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>top<span class="main">,</span>up_filter <span class="main">(</span>get_dense <span class="skolem">qf</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> get_dense_char<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>top<span class="main">,</span>up_filter <span class="main">(</span>get_dense <span class="skolem">pf</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">⊓</span> up_filter <span class="main">(</span>get_dense <span class="skolem">qf</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> calculation prod.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> simp_phi triple.pairs_sup.simps triple_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>top<span class="main">,</span>up_filter <span class="main">(</span>get_dense <span class="skolem">pf</span> <span class="skolem">f</span> <span class="main">⊔</span> get_dense <span class="skolem">qf</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> up_filter_dist_sup<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"get_dense <span class="main">(</span><span class="skolem">pf</span> <span class="main">⊔</span> <span class="skolem">qf</span><span class="main">)</span> <span class="skolem">f</span> <span class="main">=</span> get_dense <span class="skolem">pf</span> <span class="skolem">f</span> <span class="main">⊔</span> get_dense <span class="skolem">qf</span> <span class="skolem">f</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> up_filter_injective <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"Abs_lifted_distrib_lattice_top <span class="main">(</span>get_dense <span class="main">(</span><span class="skolem">pf</span> <span class="main">⊔</span> <span class="skolem">qf</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Abs_lifted_distrib_lattice_top <span class="main">(</span>get_dense <span class="skolem">pf</span><span class="main">)</span> <span class="main">⊔</span> Abs_lifted_distrib_lattice_top <span class="main">(</span>get_dense <span class="skolem">qf</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">pf</span> <span class="bound">qf</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> lifted_pair dense <span class="main">.</span> Abs_lifted_distrib_lattice_top <span class="main">(</span>get_dense <span class="main">(</span><span class="bound">pf</span> <span class="main">⊓</span> <span class="bound">qf</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Abs_lifted_distrib_lattice_top <span class="main">(</span>get_dense <span class="bound">pf</span><span class="main">)</span> <span class="main">⊓</span> Abs_lifted_distrib_lattice_top <span class="main">(</span>get_dense <span class="bound">qf</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">pf</span> <span class="skolem">qf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> lifted_pair dense"</span></span>
    <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"Abs_lifted_distrib_lattice_top <span class="main">(</span>get_dense <span class="skolem">pf</span><span class="main">)</span> <span class="main">⊓</span> Abs_lifted_distrib_lattice_top <span class="main">(</span>get_dense <span class="skolem">qf</span><span class="main">)</span> <span class="main">=</span> Abs_lifted_distrib_lattice_top <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> get_dense <span class="skolem">pf</span> <span class="bound">f</span> <span class="main">⊓</span> get_dense <span class="skolem">qf</span> <span class="bound">f</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_onp_same_args inf_lifted_distrib_lattice_top.abs_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> get_dense <span class="main">(</span><span class="skolem">pf</span> <span class="main">⊓</span> <span class="skolem">qf</span><span class="main">)</span> <span class="bound">f</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="main">.</span> get_dense <span class="skolem">pf</span> <span class="bound">f</span> <span class="main">⊓</span> get_dense <span class="skolem">qf</span> <span class="bound">f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>top<span class="main">,</span>up_filter <span class="main">(</span>get_dense <span class="main">(</span><span class="skolem">pf</span> <span class="main">⊓</span> <span class="skolem">qf</span><span class="main">)</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Rep_lifted_pair <span class="main">(</span>Rep_dense <span class="main">(</span><span class="skolem">pf</span> <span class="main">⊓</span> <span class="skolem">qf</span><span class="main">)</span><span class="main">)</span> <span class="skolem">f</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> get_dense_char<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> triple.pairs_inf <span class="main">(</span>Rep_lifted_pair <span class="main">(</span>Rep_dense <span class="skolem">pf</span><span class="main">)</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span>Rep_lifted_pair <span class="main">(</span>Rep_dense <span class="skolem">qf</span><span class="main">)</span> <span class="skolem">f</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_lifted_pair.rep_eq inf_dense.rep_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> triple.pairs_inf <span class="main">(</span>top<span class="main">,</span>up_filter <span class="main">(</span>get_dense <span class="skolem">pf</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>top<span class="main">,</span>up_filter <span class="main">(</span>get_dense <span class="skolem">qf</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> get_dense_char<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>top<span class="main">,</span>up_filter <span class="main">(</span>get_dense <span class="skolem">pf</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">⊔</span> up_filter <span class="main">(</span>get_dense <span class="skolem">qf</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> calculation prod.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> simp_phi triple.pairs_inf.simps triple_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>top<span class="main">,</span>up_filter <span class="main">(</span>get_dense <span class="skolem">pf</span> <span class="skolem">f</span> <span class="main">⊓</span> get_dense <span class="skolem">qf</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> up_filter_dist_inf<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"get_dense <span class="main">(</span><span class="skolem">pf</span> <span class="main">⊓</span> <span class="skolem">qf</span><span class="main">)</span> <span class="skolem">f</span> <span class="main">=</span> get_dense <span class="skolem">pf</span> <span class="skolem">f</span> <span class="main">⊓</span> get_dense <span class="skolem">qf</span> <span class="skolem">f</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> up_filter_injective <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"Abs_lifted_distrib_lattice_top <span class="main">(</span>get_dense <span class="main">(</span><span class="skolem">pf</span> <span class="main">⊓</span> <span class="skolem">qf</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Abs_lifted_distrib_lattice_top <span class="main">(</span>get_dense <span class="skolem">pf</span><span class="main">)</span> <span class="main">⊓</span> Abs_lifted_distrib_lattice_top <span class="main">(</span>get_dense <span class="skolem">qf</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bij dl_iso"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> invertible_bij<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> g<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">dl_iso_inv</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dl_iso_left_invertible dl_iso_right_invertible<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Structure Map Preservation›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
We finally show that the isomorphisms are compatible with the structure maps.
This involves lifting the distributive lattice isomorphism to filters of distributive lattices (as these are the targets of the structure maps).
To this end, we first show that the lifted isomorphism preserves filters.
›</span></span>

<span class="keyword1" id="Stone_Construction-phi_iso_filter"><span class="command">lemma</span></span> phi_iso_filter<span class="main">:</span>
  <span class="quoted"><span class="quoted">"filter <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">qf</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>non_trivial_boolean_algebra<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>distrib_lattice_top<span class="main">)</span> lifted_pair dense <span class="main">.</span> Rep_lifted_distrib_lattice_top <span class="main">(</span>dl_iso <span class="bound">qf</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span> <span class="main">`</span> Rep_filter <span class="main">(</span>stone_phi <span class="free">pf</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> filter_map_filter<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"mono <span class="main">(</span><span class="main">λ</span><span class="bound">qf</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>non_trivial_boolean_algebra<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>distrib_lattice_top<span class="main">)</span> lifted_pair dense <span class="main">.</span> Rep_lifted_distrib_lattice_top <span class="main">(</span>dl_iso <span class="bound">qf</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> mono_def dl_iso le_iff_sup sup_lifted_distrib_lattice_top.rep_eq<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">qf</span> <span class="bound">y</span> <span class="main">.</span> Rep_lifted_distrib_lattice_top <span class="main">(</span>dl_iso <span class="bound">qf</span><span class="main">)</span> <span class="free">f</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">rf</span> <span class="main">.</span> <span class="bound">qf</span> <span class="main">≤</span> <span class="bound">rf</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">=</span> Rep_lifted_distrib_lattice_top <span class="main">(</span>dl_iso <span class="bound">rf</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">qf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> lifted_pair dense"</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'b</span></span></span>
    <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"Rep_lifted_distrib_lattice_top <span class="main">(</span>dl_iso <span class="skolem">qf</span><span class="main">)</span> <span class="free">f</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?rf</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Abs_dense <span class="main">(</span>Abs_lifted_pair <span class="main">(</span><span class="main">λ</span><span class="bound">g</span> <span class="main">.</span> <span class="keyword1">if</span> <span class="bound">g</span> <span class="main">=</span> <span class="free">f</span> <span class="keyword1">then</span> <span class="main">(</span>top<span class="main">,</span>up_filter <span class="skolem">y</span><span class="main">)</span> <span class="keyword1">else</span> Rep_lifted_pair <span class="main">(</span>Rep_dense <span class="skolem">qf</span><span class="main">)</span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">g</span> <span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">g</span> <span class="main">=</span> <span class="free">f</span> <span class="keyword1">then</span> <span class="main">(</span>top<span class="main">,</span>up_filter <span class="skolem">y</span><span class="main">)</span> <span class="keyword1">else</span> Rep_lifted_pair <span class="main">(</span>Rep_dense <span class="skolem">qf</span><span class="main">)</span> <span class="bound">g</span><span class="main">)</span> <span class="main">∈</span> triple.pairs <span class="main">(</span>Rep_phi <span class="bound">g</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Abs_lifted_distrib_lattice_top_inverse dl_iso_inv_lifted_pair mem_Collect_eq simp_lifted_pair<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span>Abs_lifted_pair <span class="main">(</span><span class="main">λ</span><span class="bound">g</span> <span class="main">.</span> <span class="keyword1">if</span> <span class="bound">g</span> <span class="main">=</span> <span class="free">f</span> <span class="keyword1">then</span> <span class="main">(</span>top<span class="main">,</span>up_filter <span class="skolem">y</span><span class="main">)</span> <span class="keyword1">else</span> Rep_lifted_pair <span class="main">(</span>Rep_dense <span class="skolem">qf</span><span class="main">)</span> <span class="bound">g</span><span class="main">)</span> <span class="main">=</span> Abs_lifted_pair <span class="main">(</span><span class="main">λ</span><span class="bound">g</span> <span class="main">.</span> triple.pairs_uminus <span class="main">(</span>Rep_phi <span class="bound">g</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">g</span> <span class="main">=</span> <span class="free">f</span> <span class="keyword1">then</span> <span class="main">(</span>top<span class="main">,</span>up_filter <span class="skolem">y</span><span class="main">)</span> <span class="keyword1">else</span> Rep_lifted_pair <span class="main">(</span>Rep_dense <span class="skolem">qf</span><span class="main">)</span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_onp_def uminus_lifted_pair.abs_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Abs_lifted_pair <span class="main">(</span><span class="main">λ</span><span class="bound">g</span> <span class="main">.</span> <span class="keyword1">if</span> <span class="bound">g</span> <span class="main">=</span> <span class="free">f</span> <span class="keyword1">then</span> triple.pairs_uminus <span class="main">(</span>Rep_phi <span class="bound">g</span><span class="main">)</span> <span class="main">(</span>top<span class="main">,</span>up_filter <span class="skolem">y</span><span class="main">)</span> <span class="keyword1">else</span> triple.pairs_uminus <span class="main">(</span>Rep_phi <span class="bound">g</span><span class="main">)</span> <span class="main">(</span>Rep_lifted_pair <span class="main">(</span>Rep_dense <span class="skolem">qf</span><span class="main">)</span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> if_distrib<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Abs_lifted_pair <span class="main">(</span><span class="main">λ</span><span class="bound">g</span> <span class="main">.</span> <span class="keyword1">if</span> <span class="bound">g</span> <span class="main">=</span> <span class="free">f</span> <span class="keyword1">then</span> <span class="main">(</span>bot<span class="main">,</span>top<span class="main">)</span> <span class="keyword1">else</span> triple.pairs_uminus <span class="main">(</span>Rep_phi <span class="bound">g</span><span class="main">)</span> <span class="main">(</span>Rep_lifted_pair <span class="main">(</span>Rep_dense <span class="skolem">qf</span><span class="main">)</span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> triple.pairs_uminus.simps<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> triple_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> compl_top_eq simp_phi<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Abs_lifted_pair <span class="main">(</span><span class="main">λ</span><span class="bound">g</span> <span class="main">.</span> <span class="keyword1">if</span> <span class="bound">g</span> <span class="main">=</span> <span class="free">f</span> <span class="keyword1">then</span> <span class="main">(</span>bot<span class="main">,</span>top<span class="main">)</span> <span class="keyword1">else</span> <span class="main">(</span>bot<span class="main">,</span>top<span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bot_lifted_pair.rep_eq simp_dense top_filter.abs_eq uminus_lifted_pair.rep_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> bot"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bot_lifted_pair.abs_eq top_filter.abs_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"Abs_lifted_pair <span class="main">(</span><span class="main">λ</span><span class="bound">g</span> <span class="main">.</span> <span class="keyword1">if</span> <span class="bound">g</span> <span class="main">=</span> <span class="free">f</span> <span class="keyword1">then</span> <span class="main">(</span>top<span class="main">,</span>up_filter <span class="skolem">y</span><span class="main">)</span> <span class="keyword1">else</span> Rep_lifted_pair <span class="main">(</span>Rep_dense <span class="skolem">qf</span><span class="main">)</span> <span class="bound">g</span><span class="main">)</span> <span class="main">∈</span> dense_elements"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>top<span class="main">,</span>up_filter <span class="main">(</span>get_dense <span class="main">(</span>Abs_dense <span class="main">(</span>Abs_lifted_pair <span class="main">(</span><span class="main">λ</span><span class="bound">g</span> <span class="main">.</span> <span class="keyword1">if</span> <span class="bound">g</span> <span class="main">=</span> <span class="free">f</span> <span class="keyword1">then</span> <span class="main">(</span>top<span class="main">,</span>up_filter <span class="skolem">y</span><span class="main">)</span> <span class="keyword1">else</span> Rep_lifted_pair <span class="main">(</span>Rep_dense <span class="skolem">qf</span><span class="main">)</span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Rep_lifted_pair <span class="main">(</span>Rep_dense <span class="main">(</span>Abs_dense <span class="main">(</span>Abs_lifted_pair <span class="main">(</span><span class="main">λ</span><span class="bound">g</span> <span class="main">.</span> <span class="keyword1">if</span> <span class="bound">g</span> <span class="main">=</span> <span class="free">f</span> <span class="keyword1">then</span> <span class="main">(</span>top<span class="main">,</span>up_filter <span class="skolem">y</span><span class="main">)</span> <span class="keyword1">else</span> Rep_lifted_pair <span class="main">(</span>Rep_dense <span class="skolem">qf</span><span class="main">)</span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">f</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> get_dense_char<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Rep_lifted_pair <span class="main">(</span>Abs_lifted_pair <span class="main">(</span><span class="main">λ</span><span class="bound">g</span> <span class="main">.</span> <span class="keyword1">if</span> <span class="bound">g</span> <span class="main">=</span> <span class="free">f</span> <span class="keyword1">then</span> <span class="main">(</span>top<span class="main">,</span>up_filter <span class="skolem">y</span><span class="main">)</span> <span class="keyword1">else</span> Rep_lifted_pair <span class="main">(</span>Rep_dense <span class="skolem">qf</span><span class="main">)</span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span> <span class="free">f</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_dense_inverse<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>top<span class="main">,</span>up_filter <span class="skolem">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_lifted_pair_inverse<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"get_dense <span class="main">(</span>Abs_dense <span class="main">(</span>Abs_lifted_pair <span class="main">(</span><span class="main">λ</span><span class="bound">g</span> <span class="main">.</span> <span class="keyword1">if</span> <span class="bound">g</span> <span class="main">=</span> <span class="free">f</span> <span class="keyword1">then</span> <span class="main">(</span>top<span class="main">,</span>up_filter <span class="skolem">y</span><span class="main">)</span> <span class="keyword1">else</span> Rep_lifted_pair <span class="main">(</span>Rep_dense <span class="skolem">qf</span><span class="main">)</span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> up_filter_injective <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"Rep_lifted_distrib_lattice_top <span class="main">(</span>dl_iso <span class="var">?rf</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_lifted_distrib_lattice_top_inverse<span class="main">)</span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">g</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Rep_lifted_distrib_lattice_top <span class="main">(</span>dl_iso <span class="skolem">qf</span><span class="main">)</span> <span class="skolem">g</span> <span class="main">≤</span> Rep_lifted_distrib_lattice_top <span class="main">(</span>dl_iso <span class="var">?rf</span><span class="main">)</span> <span class="skolem">g</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> <span class="free">f</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> <span class="free">f</span>"</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> 1 4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">≠</span> <span class="free">f</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>top<span class="main">,</span>up_filter <span class="main">(</span>get_dense <span class="var">?rf</span> <span class="skolem">g</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Rep_lifted_pair <span class="main">(</span>Rep_dense <span class="main">(</span>Abs_dense <span class="main">(</span>Abs_lifted_pair <span class="main">(</span><span class="main">λ</span><span class="bound">g</span> <span class="main">.</span> <span class="keyword1">if</span> <span class="bound">g</span> <span class="main">=</span> <span class="free">f</span> <span class="keyword1">then</span> <span class="main">(</span>top<span class="main">,</span>up_filter <span class="skolem">y</span><span class="main">)</span> <span class="keyword1">else</span> Rep_lifted_pair <span class="main">(</span>Rep_dense <span class="skolem">qf</span><span class="main">)</span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">g</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> get_dense_char<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Rep_lifted_pair <span class="main">(</span>Abs_lifted_pair <span class="main">(</span><span class="main">λ</span><span class="bound">g</span> <span class="main">.</span> <span class="keyword1">if</span> <span class="bound">g</span> <span class="main">=</span> <span class="free">f</span> <span class="keyword1">then</span> <span class="main">(</span>top<span class="main">,</span>up_filter <span class="skolem">y</span><span class="main">)</span> <span class="keyword1">else</span> Rep_lifted_pair <span class="main">(</span>Rep_dense <span class="skolem">qf</span><span class="main">)</span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span> <span class="skolem">g</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_dense_inverse<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Rep_lifted_pair <span class="main">(</span>Rep_dense <span class="skolem">qf</span><span class="main">)</span> <span class="skolem">g</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 2 5 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_lifted_pair_inverse<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>top<span class="main">,</span>up_filter <span class="main">(</span>get_dense <span class="skolem">qf</span> <span class="skolem">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> get_dense_char <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"get_dense <span class="var">?rf</span> <span class="skolem">g</span> <span class="main">=</span> get_dense <span class="skolem">qf</span> <span class="skolem">g</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> up_filter_injective <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"Rep_lifted_distrib_lattice_top <span class="main">(</span>dl_iso <span class="skolem">qf</span><span class="main">)</span> <span class="skolem">g</span> <span class="main">≤</span> Rep_lifted_distrib_lattice_top <span class="main">(</span>dl_iso <span class="var">?rf</span><span class="main">)</span> <span class="skolem">g</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_lifted_distrib_lattice_top_inverse<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Rep_lifted_distrib_lattice_top <span class="main">(</span>dl_iso <span class="skolem">qf</span><span class="main">)</span> <span class="main">≤</span> Rep_lifted_distrib_lattice_top <span class="main">(</span>dl_iso <span class="var">?rf</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_funI<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> 6<span class="main">:</span> <span class="quoted"><span class="quoted">"dl_iso <span class="skolem">qf</span> <span class="main">≤</span> dl_iso <span class="var">?rf</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_funD less_eq_lifted_distrib_lattice_top.rep_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">qf</span> <span class="main">≤</span> <span class="var">?rf</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> dl_iso sup_isomorphism_ord_isomorphism<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">rf</span> <span class="main">.</span> <span class="skolem">qf</span> <span class="main">≤</span> <span class="bound">rf</span> <span class="main">∧</span> <span class="skolem">y</span> <span class="main">=</span> Rep_lifted_distrib_lattice_top <span class="main">(</span>dl_iso <span class="bound">rf</span><span class="main">)</span> <span class="free">f</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The commutativity property states that the same result is obtained in two ways by starting with a regular lifted pair <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>pf›</span></span></span></span>:
\begin{itemize}
\item apply the Boolean algebra isomorphism to the pair; then apply a structure map <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>f›</span></span></span></span> to obtain a filter of dense elements; or,
\item apply the structure map <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>stone_phi›</span></span></span></span> to the pair; then apply the distributive lattice isomorphism lifted to the resulting filter.
\end{itemize}
›</span></span>

<span class="keyword1" id="Stone_Construction-phi_iso"><span class="command">lemma</span></span> phi_iso<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Rep_phi <span class="free">f</span> <span class="main">(</span>Rep_lifted_boolean_algebra <span class="main">(</span>ba_iso <span class="free">pf</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> filter_map <span class="main">(</span><span class="main">λ</span><span class="bound">qf</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>non_trivial_boolean_algebra<span class="main">,</span><span class="tfree">'b</span><span class="main">::</span>distrib_lattice_top<span class="main">)</span> lifted_pair dense <span class="main">.</span> Rep_lifted_distrib_lattice_top <span class="main">(</span>dl_iso <span class="bound">qf</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span>stone_phi <span class="free">pf</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Rep_phi <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ppf</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">g</span> <span class="main">.</span> triple.pairs_uminus <span class="main">(</span>Rep_phi <span class="bound">g</span><span class="main">)</span> <span class="main">(</span>Rep_lifted_pair <span class="main">(</span>Rep_regular <span class="free">pf</span><span class="main">)</span> <span class="bound">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"triple <span class="var">?r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> triple_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"Rep_filter <span class="main">(</span><span class="var">?r</span> <span class="main">(</span>fst <span class="main">(</span>Rep_lifted_pair <span class="main">(</span>Rep_regular <span class="free">pf</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">{</span> <span class="bound">z</span> <span class="main">.</span> <span class="main">∃</span><span class="bound">qf</span> <span class="main">.</span> <span class="main">-</span>Rep_regular <span class="free">pf</span> <span class="main">≤</span> Rep_dense <span class="bound">qf</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">=</span> get_dense <span class="bound">qf</span> <span class="free">f</span> <span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> fst <span class="main">(</span>Rep_lifted_pair <span class="main">(</span>Rep_regular <span class="free">pf</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> Rep_filter <span class="main">(</span><span class="var">?r</span> <span class="main">(</span>fst <span class="main">(</span>Rep_lifted_pair <span class="main">(</span>Rep_regular <span class="free">pf</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">↑</span><span class="skolem">z</span> <span class="main">⊆</span> Rep_filter <span class="main">(</span><span class="var">?r</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 3 filter_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">hence</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"up_filter <span class="skolem">z</span> <span class="main">≤</span> <span class="var">?r</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Rep_filter_cases Rep_filter_inverse less_eq_filter.rep_eq mem_Collect_eq up_filter<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">g</span> <span class="main">.</span> <span class="var">?ppf</span> <span class="bound">g</span> <span class="main">∈</span> triple.pairs <span class="main">(</span>Rep_phi <span class="bound">g</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> simp_lifted_pair uminus_lifted_pair.rep_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?zf</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">g</span> <span class="main">.</span> <span class="keyword1">if</span> <span class="bound">g</span> <span class="main">=</span> <span class="free">f</span> <span class="keyword1">then</span> <span class="main">(</span>top<span class="main">,</span>up_filter <span class="skolem">z</span><span class="main">)</span> <span class="keyword1">else</span> triple.pairs_top"</span></span>
    <span class="keyword1"><span class="command">have</span></span> 6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">g</span> <span class="main">.</span> <span class="var">?zf</span> <span class="bound">g</span> <span class="main">∈</span> triple.pairs <span class="main">(</span>Rep_phi <span class="bound">g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> phi"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"triple <span class="main">(</span>Rep_phi <span class="skolem">g</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> triple_def<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>top<span class="main">,</span>up_filter <span class="skolem">z</span><span class="main">)</span> <span class="main">∈</span> triple.pairs <span class="main">(</span>Rep_phi <span class="skolem">g</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> triple.pairs_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?zf</span> <span class="skolem">g</span> <span class="main">∈</span> triple.pairs <span class="main">(</span>Rep_phi <span class="skolem">g</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> simp_lifted_pair top_lifted_pair.rep_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span>Abs_lifted_pair <span class="var">?zf</span> <span class="main">=</span> Abs_lifted_pair <span class="main">(</span><span class="main">λ</span><span class="bound">g</span> <span class="main">.</span> triple.pairs_uminus <span class="main">(</span>Rep_phi <span class="bound">g</span><span class="main">)</span> <span class="main">(</span><span class="var">?zf</span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> uminus_lifted_pair.abs_eq<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_onp_same_args<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Abs_lifted_pair <span class="main">(</span><span class="main">λ</span><span class="bound">g</span> <span class="main">.</span> <span class="keyword1">if</span> <span class="bound">g</span> <span class="main">=</span> <span class="free">f</span> <span class="keyword1">then</span> triple.pairs_uminus <span class="main">(</span>Rep_phi <span class="bound">g</span><span class="main">)</span> <span class="main">(</span>top<span class="main">,</span>up_filter <span class="skolem">z</span><span class="main">)</span> <span class="keyword1">else</span> triple.pairs_uminus <span class="main">(</span>Rep_phi <span class="bound">g</span><span class="main">)</span> triple.pairs_top<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> arg_cong<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">Abs_lifted_pair</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Abs_lifted_pair <span class="main">(</span><span class="main">λ</span><span class="bound">g</span> <span class="main">.</span> triple.pairs_bot<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bot_lifted_pair.rep_eq dense_closed_top top_lifted_pair.rep_eq triple.pairs_uminus.simps uminus_lifted_pair.rep_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 7<span class="main">:</span> <span class="quoted"><span class="quoted">"Abs_lifted_pair <span class="var">?zf</span> <span class="main">∈</span> dense_elements"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bot_lifted_pair.abs_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?qf</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Abs_dense <span class="main">(</span>Abs_lifted_pair <span class="var">?zf</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">g</span> <span class="main">.</span> triple.pairs_less_eq <span class="main">(</span><span class="var">?ppf</span> <span class="bound">g</span><span class="main">)</span> <span class="main">(</span><span class="var">?zf</span> <span class="bound">g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">g</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"triple.pairs_less_eq <span class="main">(</span><span class="var">?ppf</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">(</span><span class="var">?zf</span> <span class="skolem">g</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> <span class="free">f</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> 8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> <span class="free">f</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> 9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?ppf</span> <span class="skolem">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="skolem">x</span><span class="main">,</span><span class="var">?r</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 1 3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> prod.collapse triple.pairs_uminus.simps<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"triple.pairs_less_eq <span class="main">(</span><span class="main">-</span><span class="skolem">x</span><span class="main">,</span><span class="var">?r</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>top<span class="main">,</span>up_filter <span class="skolem">z</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 1 4 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> inf.bot_least triple.pairs_less_eq.simps<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> 8 9 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> 10<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">≠</span> <span class="free">f</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"triple.pairs_less_eq <span class="main">(</span><span class="var">?ppf</span> <span class="skolem">g</span><span class="main">)</span> triple.pairs_top"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> bot.extremum top_greatest prod.collapse triple_def triple.pairs_less_eq.simps triple.phi_bot<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> 10 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Abs_lifted_pair <span class="var">?ppf</span> <span class="main">≤</span> Abs_lifted_pair <span class="var">?zf</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 5 6 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> less_eq_lifted_pair.abs_eq<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_onp_same_args<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> 11<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span>Rep_regular <span class="free">pf</span> <span class="main">≤</span> Rep_dense <span class="var">?qf</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 7 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> uminus_lifted_pair_def Abs_dense_inverse<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>top<span class="main">,</span>up_filter <span class="main">(</span>get_dense <span class="var">?qf</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Rep_lifted_pair <span class="main">(</span>Rep_dense <span class="var">?qf</span><span class="main">)</span> <span class="free">f</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> get_dense_char<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>top<span class="main">,</span>up_filter <span class="skolem">z</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 6 7 Abs_dense_inverse Abs_lifted_pair_inverse <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> get_dense <span class="var">?qf</span> <span class="free">f</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> up_filter_injective <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="main">{</span> <span class="bound">z</span> <span class="main">.</span> <span class="main">∃</span><span class="bound">qf</span> <span class="main">.</span> <span class="main">-</span>Rep_regular <span class="free">pf</span> <span class="main">≤</span> Rep_dense <span class="bound">qf</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">=</span> get_dense <span class="bound">qf</span> <span class="free">f</span> <span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 11 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> 12<span class="main">:</span> <span class="quoted"><span class="quoted">"Rep_filter <span class="main">(</span><span class="var">?r</span> <span class="main">(</span>fst <span class="main">(</span>Rep_lifted_pair <span class="main">(</span>Rep_regular <span class="free">pf</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊇</span> <span class="main">{</span> <span class="bound">z</span> <span class="main">.</span> <span class="main">∃</span><span class="bound">qf</span> <span class="main">.</span> <span class="main">-</span>Rep_regular <span class="free">pf</span> <span class="main">≤</span> Rep_dense <span class="bound">qf</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">=</span> get_dense <span class="bound">qf</span> <span class="free">f</span> <span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="main">{</span> <span class="bound">z</span> <span class="main">.</span> <span class="main">∃</span><span class="bound">qf</span> <span class="main">.</span> <span class="main">-</span>Rep_regular <span class="free">pf</span> <span class="main">≤</span> Rep_dense <span class="bound">qf</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">=</span> get_dense <span class="bound">qf</span> <span class="free">f</span> <span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">qf</span> <span class="main">.</span> <span class="main">-</span>Rep_regular <span class="free">pf</span> <span class="main">≤</span> Rep_dense <span class="bound">qf</span> <span class="main">∧</span> <span class="skolem">z</span> <span class="main">=</span> get_dense <span class="bound">qf</span> <span class="free">f</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"triple.pairs_less_eq <span class="main">(</span>Rep_lifted_pair <span class="main">(</span><span class="main">-</span>Rep_regular <span class="free">pf</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span> <span class="main">(</span>top<span class="main">,</span>up_filter <span class="skolem">z</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_eq_lifted_pair.rep_eq get_dense_char<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"up_filter <span class="skolem">z</span> <span class="main">≤</span> snd <span class="main">(</span>Rep_lifted_pair <span class="main">(</span><span class="main">-</span>Rep_regular <span class="free">pf</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> prod.collapse triple.pairs_less_eq.simps<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> snd <span class="main">(</span><span class="var">?ppf</span> <span class="free">f</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> uminus_lifted_pair.rep_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?r</span> <span class="main">(</span>fst <span class="main">(</span>Rep_lifted_pair <span class="main">(</span>Rep_regular <span class="free">pf</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> prod.collapse prod.inject triple.pairs_uminus.simps<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Rep_filter <span class="main">(</span>up_filter <span class="skolem">z</span><span class="main">)</span> <span class="main">⊆</span> Rep_filter <span class="main">(</span><span class="var">?r</span> <span class="main">(</span>fst <span class="main">(</span>Rep_lifted_pair <span class="main">(</span>Rep_regular <span class="free">pf</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_filter.rep_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">↑</span><span class="skolem">z</span> <span class="main">⊆</span> Rep_filter <span class="main">(</span><span class="var">?r</span> <span class="main">(</span>fst <span class="main">(</span>Rep_lifted_pair <span class="main">(</span>Rep_regular <span class="free">pf</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Abs_filter_inverse mem_Collect_eq up_filter<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> Rep_filter <span class="main">(</span><span class="var">?r</span> <span class="main">(</span>fst <span class="main">(</span>Rep_lifted_pair <span class="main">(</span>Rep_regular <span class="free">pf</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> 13<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">qf</span><span class="main">∈</span>Rep_filter <span class="main">(</span>stone_phi <span class="free">pf</span><span class="main">)</span> <span class="main">.</span> Rep_lifted_distrib_lattice_top <span class="main">(</span>Abs_lifted_distrib_lattice_top <span class="main">(</span>get_dense <span class="bound">qf</span><span class="main">)</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> get_dense <span class="bound">qf</span> <span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Abs_lifted_distrib_lattice_top_inverse UNIV_I UNIV_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Rep_filter <span class="main">(</span><span class="var">?r</span> <span class="main">(</span>fst <span class="main">(</span>Rep_lifted_pair <span class="main">(</span>Rep_regular <span class="free">pf</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span> <span class="bound">z</span> <span class="main">.</span> <span class="main">∃</span><span class="bound">qf</span><span class="main">∈</span>stone_phi_base <span class="free">pf</span> <span class="main">.</span> <span class="bound">z</span> <span class="main">=</span> get_dense <span class="bound">qf</span> <span class="free">f</span> <span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 2 12 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">(</span>fst <span class="main">(</span>Rep_lifted_pair <span class="main">(</span>Rep_regular <span class="free">pf</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Abs_filter <span class="main">{</span> <span class="bound">z</span> <span class="main">.</span> <span class="main">∃</span><span class="bound">qf</span><span class="main">∈</span>stone_phi_base <span class="free">pf</span> <span class="main">.</span> <span class="bound">z</span> <span class="main">=</span> get_dense <span class="bound">qf</span> <span class="free">f</span> <span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Rep_filter_inverse<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r</span> <span class="main">(</span>Rep_lifted_boolean_algebra <span class="main">(</span>ba_iso <span class="free">pf</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> Abs_filter <span class="main">{</span> <span class="bound">z</span> <span class="main">.</span> <span class="main">∃</span><span class="bound">qf</span><span class="main">∈</span>Rep_filter <span class="main">(</span>stone_phi <span class="free">pf</span><span class="main">)</span> <span class="main">.</span> <span class="bound">z</span> <span class="main">=</span> Rep_lifted_distrib_lattice_top <span class="main">(</span>dl_iso <span class="bound">qf</span><span class="main">)</span> <span class="free">f</span> <span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 13 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_filter_inverse stone_phi_base_filter stone_phi_def Abs_lifted_boolean_algebra_inverse<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>