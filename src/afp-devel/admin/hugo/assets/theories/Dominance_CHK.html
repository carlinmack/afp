<div id="Cfg">
<div class="head">
<h1>Theory Cfg</h1>
</div>
<pre class="source"><span class="comment1">(* Author: Nan Jiang *)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹The specification of computing dominators›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Cfg
<span class="keyword2"><span class="keyword">imports</span></span> <a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Main.html">Main</a> 
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The specification of computing dominators is defined.
      For fast data flow analysis presented by CHK \cite{Dominance_Algorithm}, 
      a directed graph with explicit node list and sets of initial nodes is defined.
      Each node refers to its rPO (reverse PostOrder) number w.r.t a DFST, and 
      related properties as assumptions are handled using a locale.›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> digraph <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span><span class="tfree">'a</span><span class="main">)</span> set"</span></span>

<span class="keyword1"><span class="command">record</span></span> <span class="tfree">'a</span> graph_rec <span class="main">=</span>
  g_V  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list"</span></span>
  g_V0 <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set"</span></span> 
  g_E  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> digraph"</span></span>  
 
  tail <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  head <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">wf_cfg</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> graph_rec <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">wf_cfg</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">≡</span> g_V0 <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">⊆</span> set<span class="main">(</span> g_V <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> node <span class="main">=</span> <span class="quoted">nat</span>

<span class="keyword1"><span class="command">locale</span></span> cfg_doms <span class="main">=</span>
  <span class="comment1">―‹Nodes are rPO numbers›</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">G</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat graph_rec"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">structure</span></span><span class="main">)</span> 

  <span class="comment1">―‹General properties›</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> wf_cfg<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_cfg <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> tail<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> <span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">)</span> <span class="main">⟹</span> tail <span class="free">G</span> <span class="free">e</span> <span class="main">=</span> <span class="free">u</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> head<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> <span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">)</span> <span class="main">⟹</span> head <span class="free">G</span> <span class="free">e</span> <span class="main">=</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> tail_in_verts<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">∈</span> g_E <span class="free">G</span> <span class="main">⟹</span> tail <span class="free">G</span> <span class="free">e</span> <span class="main">∈</span> set <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> head_in_verts<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">∈</span> g_E <span class="free">G</span> <span class="main">⟹</span> head <span class="free">G</span> <span class="free">e</span> <span class="main">∈</span> set <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span>"</span></span>

  <span class="comment1">―‹Properties of a cfg where nodes are rPO numbers›</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> entry0<span class="main">:</span>    <span class="quoted"><span class="quoted">"g_V0 <span class="free">G</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> dfst<span class="main">:</span>      <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v</span> <span class="main">∈</span> set <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">.</span> <span class="main">∃</span><span class="bound">prev</span><span class="main">.</span> <span class="main">(</span><span class="bound">prev</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> g_E <span class="free">G</span> <span class="main">∧</span> <span class="bound">prev</span> <span class="main">&lt;</span> <span class="bound">v</span>"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> reachable<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v</span> <span class="main">∈</span> set <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">``</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>    
  <span class="keyword2"><span class="keyword">assumes</span></span> verts<span class="main">:</span>     <span class="quoted"><span class="quoted">"g_V <span class="free">G</span> <span class="main">=</span> <span class="main">[</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="main">(</span>length <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span><span class="main">)</span><span class="main">]</span>"</span></span>

 <span class="comment1">―‹It is required that the entry node has an immediate successor which is not itself;
    Otherwise, no need to compute dominators
    It is required for proving the lemma: "wf\_dom start (unstables r step start)".›</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> succ_of_entry0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="main">∈</span> g_E <span class="free">G</span> <span class="main">∧</span> <span class="bound">s</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">path_entry</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat digraph <span class="main">⇒</span> nat list <span class="main">⇒</span> nat <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="entity">E</span> <span class="keyword2"><span class="keyword">where</span></span>
  path_entry0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">path_entry</span> <span class="free">E</span> <span class="main">[]</span> <span class="main">0</span>"</span></span>
<span class="main">|</span> path_entry_prepend<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span><span class="main">∈</span> <span class="free">E</span><span class="main">;</span> <span class="free">path_entry</span> <span class="free">E</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">path_entry</span> <span class="free">E</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span>"</span></span>

<span class="keyword1" id="Cfg-path_entry0_empty_conv"><span class="command">lemma</span></span> path_entry0_empty_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"path_entry <span class="free">E</span> <span class="main">[]</span> <span class="free">v</span> <span class="main">⟷</span> <span class="free">v</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> path_entry0 <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> path_entry.cases<span class="main">)</span>

<span class="keyword1"><span class="command">inductive_cases</span></span> path_entry_uncons<span class="main">:</span> <span class="quoted"><span class="quoted">"path_entry <span class="free">E</span> <span class="main">(</span><span class="free">u'</span><span class="main">#</span><span class="free">l</span><span class="main">)</span> <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command">inductive_simps</span></span> path_entry_cons_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"path_entry <span class="free">E</span> <span class="main">(</span><span class="free">u'</span><span class="main">#</span><span class="free">l</span><span class="main">)</span> <span class="free">w</span>"</span></span>

<span class="keyword1" id="Cfg-single_path_entry"><span class="command">lemma</span></span> single_path_entry<span class="main">:</span> <span class="quoted"><span class="quoted">"path_entry <span class="free">E</span> <span class="main">[</span><span class="free">p</span><span class="main">]</span> <span class="free">w</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> path_entry_cons_conv path_entry0_empty_conv<span class="main">)</span>

<span class="keyword1" id="Cfg-path_entry_append"><span class="command">lemma</span></span> path_entry_append<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> path_entry <span class="free">E</span> <span class="free">l</span> <span class="free">v</span><span class="main">;</span> <span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">w</span><span class="main">)</span><span class="main">∈</span><span class="free">E</span> <span class="main">⟧</span> <span class="main">⟹</span> path_entry <span class="free">E</span> <span class="main">(</span><span class="free">v</span><span class="main">#</span><span class="free">l</span><span class="main">)</span> <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> path_entry_prepend<span class="main">)</span>

<span class="keyword1" id="Cfg-entry_rtrancl_is_path"><span class="command">lemma</span></span> entry_rtrancl_is_path<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="free">v</span><span class="main">)</span> <span class="main">∈</span> <span class="free">E</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">p</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"path_entry <span class="free">E</span> <span class="free">p</span> <span class="free">v</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">induct</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>path_entry0 path_entry_prepend<span class="main">)</span>

<span class="keyword1" id="Cfg-path_entry_is_trancl"><span class="command">lemma</span></span> path_entry_is_trancl<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"path_entry <span class="free">E</span> <span class="free">l</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="free">v</span><span class="main">)</span><span class="main">∈</span><span class="free">E</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">induct</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="main"><span class="keyword3">[</span></span><span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">l</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>path_entry0_empty_conv<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Cfg-tail_is_vert"><span class="command">lemma</span></span> tail_is_vert<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">)</span> <span class="main">∈</span> g_E <span class="free">G</span>  <span class="main">⟹</span> <span class="free">u</span> <span class="main">∈</span> set <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> tail_in_verts<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1" id="Cfg-head_is_vert"><span class="command">lemma</span></span> head_is_vert<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">)</span> <span class="main">∈</span> g_E <span class="free">G</span>  <span class="main">⟹</span> <span class="free">v</span> <span class="main">∈</span> set <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> head_in_verts<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1" id="Cfg-tail_is_vert2"><span class="command">lemma</span></span> tail_is_vert2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⟹</span> <span class="free">u</span> <span class="main">∈</span> set <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>trancl.induct<span class="main">)</span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> tail_in_verts<span class="main">)</span>

<span class="keyword1" id="Cfg-head_is_vert2"><span class="command">lemma</span></span> head_is_vert2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>  <span class="main">⟹</span> <span class="free">v</span> <span class="main">∈</span> set <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>trancl.induct<span class="main">)</span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> head_in_verts<span class="main">)</span>

<span class="keyword1" id="Cfg-verts_set"><span class="command">lemma</span></span> verts_set<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> length <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span><span class="main">}</span>"</span></span>   
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> verts <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span> <span class="main">=</span> set <span class="main">[</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="main">(</span>length <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span><span class="main">)</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">[</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="main">(</span>length <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="main">(</span>length <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Cfg-fin_verts"><span class="command">lemma</span></span> fin_verts<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>set <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Cfg-zero_in_verts"><span class="command">lemma</span></span> zero_in_verts<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> set <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> wf_cfg entry0 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> wf_cfg_def<span class="main">)</span>  <span class="operator">auto</span>

<span class="keyword1" id="Cfg-verts_not_empty"><span class="command">lemma</span></span> verts_not_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"g_V <span class="free">G</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> zero_in_verts <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Cfg-len_verts_gt0"><span class="command">lemma</span></span> len_verts_gt0<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>verts_not_empty<span class="main">)</span>

<span class="keyword1" id="Cfg-len_verts_gt1"><span class="command">lemma</span></span> len_verts_gt1<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> succ_of_entry0 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> set <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> head_is_vert <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> zero_in_verts <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">,</span><span class="skolem">s</span><span class="main">}</span> <span class="main">⊆</span> set <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="main">0</span><span class="main">,</span> <span class="skolem">s</span><span class="main">}</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="main">0</span><span class="main">,</span> <span class="skolem">s</span><span class="main">}</span> <span class="main">≤</span> card <span class="main">(</span>set <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>card_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> c <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>set <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> card_length<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"g_V <span class="free">G</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Cfg-verts_ge_Suc0"><span class="command">lemma</span></span> verts_ge_Suc0 <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="main">0</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="main">0</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> len_verts_gt1 <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Cfg-distinct_verts1"><span class="command">lemma</span></span> distinct_verts1<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span><span class="main">]</span> "</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Cfg-distinct_verts2"><span class="command">lemma</span></span> distinct_verts2<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> distinct_verts1 verts<span class="main">)</span>  <span class="operator">simp</span>

<span class="keyword1" id="Cfg-single_entry"><span class="command">lemma</span></span> single_entry<span class="main">:</span> <span class="quoted"><span class="quoted">"is_singleton <span class="main">(</span>g_V0 <span class="free">G</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>entry0<span class="main">)</span>

<span class="keyword1" id="Cfg-entry_is_0"><span class="command">lemma</span></span> entry_is_0<span class="main">:</span> <span class="quoted"><span class="quoted">"the_elem <span class="main">(</span>g_V0 <span class="free">G</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> entry0<span class="main">)</span>

<span class="keyword1" id="Cfg-wf_digraph"><span class="command">lemma</span></span> wf_digraph<span class="main">:</span> <span class="quoted"><span class="quoted">"cfg_doms <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">intro_locales</span>

<span class="keyword1" id="Cfg-path_entry_prepend_conv"><span class="command">lemma</span></span> path_entry_prepend_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"path_entry <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span> <span class="free">p</span> <span class="free">n</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">v</span><span class="main">.</span> path_entry <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span> <span class="main">(</span>tl <span class="free">p</span><span class="main">)</span> <span class="bound">v</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">v</span><span class="main">,</span> <span class="free">n</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>path_entry.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> path_entry0 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>path_entry_prepend <span class="skolem">u</span> <span class="skolem">v</span> <span class="skolem">l</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Cfg-path_verts"><span class="command">lemma</span></span> path_verts<span class="main">:</span> <span class="quoted"><span class="quoted">"path_entry <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span> <span class="free">p</span> <span class="free">n</span> <span class="main">⟹</span> <span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"path_entry <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span> <span class="free">p</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>path_entry0_empty_conv zero_in_verts<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"path_entry <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span> <span class="free">p</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="free">n</span><span class="main">)</span><span class="main">∈</span><span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>path_entry_is_trancl<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> head_is_vert2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Cfg-path_in_verts"><span class="command">lemma</span></span> path_in_verts<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"path_entry <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span> <span class="free">l</span> <span class="free">v</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set <span class="free">l</span> <span class="main">⊆</span> set <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>path_entry.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> path_entry0 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>path_entry_prepend <span class="skolem">u</span> <span class="skolem">v</span> <span class="skolem">l</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> path_verts <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Cfg-any_node_exits_path"><span class="command">lemma</span></span> any_node_exits_path<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> set <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span> "</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span><span class="main">.</span> path_entry <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span> <span class="bound">p</span> <span class="free">v</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> set <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path_entry <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span> <span class="main">[]</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>path_entry0<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">`<span class="free">v</span> <span class="main">=</span> <span class="main">0</span>`</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> set <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
  <span class="keyword1"><span class="command">with</span></span> reachable <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">``</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="free">v</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Image_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>entry_rtrancl_is_path<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Cfg-entry0_path"><span class="command">lemma</span></span> entry0_path<span class="main">:</span> <span class="quoted"><span class="quoted">"path_entry <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span> <span class="main">[]</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>path_entry.path_entry0<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">reachable</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"node <span class="main">⇒</span> bool"</span></span> 
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">reachable</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">∈</span> <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">``</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Cfg-path_entry_reachable"><span class="command">lemma</span></span> path_entry_reachable<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"path_entry <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span> <span class="free">p</span> <span class="free">n</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"reachable <span class="free">n</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms reachable 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>path_verts <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>reachable_def<span class="main">)</span>

<span class="keyword1" id="Cfg-nin_nodes_reachable"><span class="command">lemma</span></span> nin_nodes_reachable<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∉</span> set <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">¬</span> reachable <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∉</span> set <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> nn<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">¬</span> <span class="main">¬</span> reachable <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">`<span class="free">n</span> <span class="main">∉</span> set <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span>`</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> verts_set len_verts_gt0 entry0  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> nn <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"reachable <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">``</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reachable_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">n</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> "</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Image_def<span class="main">)</span>  
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">`<span class="free">n</span> <span class="main">≠</span> <span class="main">0</span>`</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n'</span><span class="main">.</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="bound">n'</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">∧</span> <span class="main">(</span><span class="bound">n'</span><span class="main">,</span> <span class="free">n</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>rtranclE<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="skolem">n'</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> "</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="skolem">n'</span><span class="main">,</span> <span class="free">n</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span>"</span></span><span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> head_is_vert <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">`<span class="free">n</span> <span class="main">∉</span> set <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span>`</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Cfg-reachable_path_entry"><span class="command">lemma</span></span> reachable_path_entry<span class="main">:</span> <span class="quoted"><span class="quoted">"reachable <span class="free">n</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">p</span><span class="main">.</span> path_entry <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span> <span class="bound">p</span> <span class="free">n</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"reachable <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="free">n</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>reachable_def Image_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">=</span> <span class="free">n</span> <span class="main">∨</span> <span class="main">0</span> <span class="main">≠</span> <span class="free">n</span> <span class="main">∧</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="free">n</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rtrancl_eq_or_trancl<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">=</span> <span class="free">n</span>"</span></span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path_entry <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span> <span class="main">[]</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>path_entry0<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">`<span class="main">0</span> <span class="main">=</span> <span class="free">n</span>`</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≠</span> <span class="free">n</span> <span class="main">∧</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="free">n</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="free">n</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>rtranclpD<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>head_is_vert2<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> any_node_exits_path<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Cfg-path_entry_unconc"><span class="command">lemma</span></span> path_entry_unconc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"path_entry <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span> <span class="main">(</span><span class="free">la</span><span class="main">@</span><span class="free">lb</span><span class="main">)</span> <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">v</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"path_entry <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span> <span class="free">lb</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="free">la</span><span class="main">@</span><span class="free">lb</span>"</span></span> <span class="quoted"><span class="free">w</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">la</span></span> <span class="quoted"><span class="free">lb</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> path_entry.induct<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>path_entry.intros<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>path_entry.intros <span class="quasi_keyword">iff</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Cons_eq_append_conv<span class="main">)</span>

<span class="keyword1" id="Cfg-path_entry_append_conv"><span class="command">lemma</span></span> path_entry_append_conv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"path_entry <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span> <span class="main">(</span><span class="free">v</span><span class="main">#</span><span class="free">l</span><span class="main">)</span> <span class="free">w</span> <span class="main">⟷</span> <span class="main">(</span>path_entry <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span> <span class="free">l</span> <span class="free">v</span> <span class="main">∧</span> <span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">w</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"path_entry <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span> <span class="main">(</span><span class="free">v</span> <span class="main">#</span> <span class="free">l</span><span class="main">)</span> <span class="free">w</span> "</span></span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"path_entry <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span> <span class="free">l</span> <span class="free">v</span> <span class="main">∧</span> <span class="main">(</span><span class="free">v</span><span class="main">,</span> <span class="free">w</span><span class="main">)</span> <span class="main">∈</span> g_E <span class="free">G</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>path_entry_cons_conv<span class="main">)</span>   
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"path_entry <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span> <span class="free">l</span> <span class="free">v</span> <span class="main">∧</span> <span class="main">(</span><span class="free">v</span><span class="main">,</span> <span class="free">w</span><span class="main">)</span> <span class="main">∈</span> g_E <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"path_entry <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span> <span class="main">(</span><span class="free">v</span> <span class="main">#</span> <span class="free">l</span><span class="main">)</span> <span class="free">w</span> "</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> path_entry_append<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Cfg-takeWhileNot_path_entry"><span class="command">lemma</span></span> takeWhileNot_path_entry<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"path_entry <span class="free">E</span> <span class="free">p</span> <span class="free">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> set <span class="free">p</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"takeWhile <span class="main">(</span><span class="main">(≠)</span> <span class="free">v</span><span class="main">)</span> <span class="main">(</span>rev <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">c</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"path_entry <span class="free">E</span> <span class="main">(</span>rev <span class="free">c</span><span class="main">)</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> path_entry.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> path_entry0 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>path_entry_prepend <span class="skolem">u</span> <span class="skolem">va</span> <span class="skolem">l</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> set <span class="skolem">l</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">note</span></span> v_in <span class="main">=</span> this
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"takeWhile <span class="main">(</span><span class="main">(≠)</span> <span class="free">v</span><span class="main">)</span> <span class="main">(</span>rev <span class="main">(</span><span class="skolem">u</span> <span class="main">#</span> <span class="skolem">l</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> takeWhile <span class="main">(</span><span class="main">(≠)</span> <span class="free">v</span><span class="main">)</span> <span class="main">(</span>rev <span class="skolem">l</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> path_entry_prepend.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"takeWhile <span class="main">(</span><span class="main">(≠)</span> <span class="free">v</span><span class="main">)</span> <span class="main">(</span>rev <span class="skolem">l</span><span class="main">)</span> <span class="main">=</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> v_in <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> path_entry_prepend.hyps<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">note</span></span> v_nin <span class="main">=</span> this    
    <span class="keyword1"><span class="command">with</span></span> path_entry_prepend.prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> v_u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> <span class="skolem">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> take_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"takeWhile <span class="main">(</span><span class="main">(≠)</span> <span class="free">v</span><span class="main">)</span> <span class="main">(</span>rev <span class="main">(</span><span class="skolem">u</span> <span class="main">#</span> <span class="skolem">l</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> takeWhile <span class="main">(</span><span class="main">(≠)</span> <span class="free">v</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>rev <span class="skolem">l</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">u</span><span class="main">]</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">from</span></span> v_nin <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="main">(</span>rev <span class="skolem">l</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(≠)</span> <span class="free">v</span><span class="main">)</span> <span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"takeWhile <span class="main">(</span><span class="main">(≠)</span> <span class="free">v</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>rev <span class="skolem">l</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">u</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>rev <span class="skolem">l</span><span class="main">)</span> <span class="main">@</span> takeWhile <span class="main">(</span><span class="main">(≠)</span> <span class="free">v</span><span class="main">)</span> <span class="main">[</span><span class="skolem">u</span><span class="main">]</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> takeWhile_append2<span class="main">)</span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> v_u take_eq <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"takeWhile <span class="main">(</span><span class="main">(≠)</span> <span class="free">v</span><span class="main">)</span> <span class="main">(</span>rev <span class="main">(</span><span class="skolem">u</span> <span class="main">#</span> <span class="skolem">l</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>rev <span class="skolem">l</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> path_entry_prepend.prems<span class="main">(</span>2<span class="main">)</span> path_entry_prepend.hyps<span class="main">(</span>2<span class="main">)</span> v_u <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Cfg-path_entry_last"><span class="command">lemma</span></span> path_entry_last<span class="main">:</span> <span class="quoted"><span class="quoted">"path_entry <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span> <span class="free">p</span> <span class="free">n</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> last <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> path_entry.induct<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>  
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> path_entry_cons_conv neq_Nil_conv<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>path_entry0_empty_conv<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Cfg-path_entry_loop"><span class="command">lemma</span></span> path_entry_loop<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> n_path<span class="main">:</span> <span class="quoted"><span class="quoted">"path_entry <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span> <span class="free">p</span> <span class="free">n</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> n<span class="main">:</span>      <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="free">p</span> "</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p'</span><span class="main">.</span>   path_entry <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span> <span class="bound">p'</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">n</span> <span class="main">∉</span> set <span class="bound">p'</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"takeWhile <span class="main">(</span><span class="main">(≠)</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span>rev <span class="main">(</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">z</span> <span class="main">∈</span> set <span class="var">?c</span><span class="main">.</span> <span class="bound">z</span> <span class="main">≠</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> set_takeWhileD<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> n_nin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∉</span> set <span class="main">(</span>rev <span class="var">?c</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 
  <span class="keyword1"><span class="command">from</span></span> n_path  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"path_entry <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span> <span class="main">(</span> <span class="free">p</span><span class="main">)</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> path_entry_prepend_conv <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
  <span class="keyword1"><span class="command">with</span></span> n <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path_entry <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span> <span class="main">(</span>rev <span class="var">?c</span><span class="main">)</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>takeWhileNot_path_entry<span class="main">)</span>  
  <span class="keyword1"><span class="command">with</span></span> n_nin <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Cfg-path_entry_hd_edge"><span class="command">lemma</span></span> path_entry_hd_edge<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"path_entry <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span> <span class="free">pa</span> <span class="free">p</span> "</span></span>   
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">pa</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>hd <span class="free">pa</span><span class="main">,</span> <span class="free">p</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> path_entry.induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Cfg-path_entry_edge"><span class="command">lemma</span></span> path_entry_edge<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">pa</span> <span class="main">≠</span> <span class="main">[]</span> "</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"path_entry <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span> <span class="free">pa</span> <span class="free">p</span> "</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">u</span><span class="main">∈</span>set <span class="free">pa</span><span class="main">.</span> <span class="main">(</span>path_entry <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span> <span class="main">(</span>rev <span class="main">(</span>takeWhile <span class="main">(</span><span class="main">(≠)</span> <span class="bound">u</span><span class="main">)</span> <span class="main">(</span>rev <span class="free">pa</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">u</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="free">p</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"path_entry <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span> <span class="main">(</span>rev <span class="main">(</span>takeWhile <span class="main">(</span><span class="main">(≠)</span> <span class="main">(</span>hd <span class="free">pa</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>rev <span class="free">pa</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>hd <span class="free">pa</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>takeWhileNot_path_entry<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>hd <span class="free">pa</span><span class="main">,</span> <span class="free">p</span><span class="main">)</span><span class="main">∈</span> <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> path_entry_hd_edge<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hd <span class="free">pa</span> <span class="main">∈</span> set <span class="free">pa</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> 1 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_tail</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"node <span class="main">⇒</span> node <span class="main">×</span> node <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_tail</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> tail <span class="free">G</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_head</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"node <span class="main">⇒</span> node <span class="main">×</span> node <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_head</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> head <span class="free">G</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">succs</span><span class="main">::</span> <span class="quoted"><span class="quoted">"node <span class="main">⇒</span> node set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">succs</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span> <span class="main">``</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Cfg-succ_in_verts"><span class="command">lemma</span></span> succ_in_verts<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> succs <span class="free">n</span> <span class="main">⟹</span> <span class="main">{</span><span class="free">s</span><span class="main">,</span><span class="free">n</span><span class="main">}</span> <span class="main">⊆</span> set <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>succs_def tail_is_vert head_is_vert<span class="main">)</span>

<span class="keyword1" id="Cfg-succ0_not_nil"><span class="command">lemma</span></span> succ0_not_nil<span class="main">:</span> <span class="quoted"><span class="quoted">"succs <span class="main">0</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> succ_of_entry0 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>succs_def<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">prevs</span><span class="main">::</span> <span class="quoted"><span class="quoted">"node <span class="main">⇒</span> node set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">prevs</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> <span class="main">(</span>converse <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span><span class="main">)</span><span class="main">``</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> succs <span class="free">u</span> <span class="main">⟷</span> <span class="free">u</span> <span class="main">∈</span> prevs <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>succs_def prevs_def<span class="main">)</span>

<span class="keyword1" id="Cfg-succ_edge"><span class="command">lemma</span></span> succ_edge<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v</span> <span class="main">∈</span> succs <span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="free">n</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> g_E <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>succs_def<span class="main">)</span>

<span class="keyword1" id="Cfg-prev_edge"><span class="command">lemma</span></span> prev_edge<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> set <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">v</span> <span class="main">∈</span> prevs <span class="free">u</span><span class="main">.</span> <span class="main">(</span><span class="bound">v</span><span class="main">,</span> <span class="free">u</span><span class="main">)</span> <span class="main">∈</span> g_E <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>prevs_def<span class="main">)</span>

<span class="keyword1" id="Cfg-succ_in_G"><span class="command">lemma</span></span> succ_in_G<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v</span> <span class="main">∈</span> succs <span class="free">n</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> set <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span>"</span></span>  
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> succs_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>head_in_verts<span class="main">)</span>

<span class="keyword1" id="Cfg-succ_is_subset_of_verts"><span class="command">lemma</span></span> succ_is_subset_of_verts<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v</span> <span class="main">∈</span> set <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span><span class="main">.</span> succs <span class="bound">v</span> <span class="main">⊆</span> set<span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> succ_in_G<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Cfg-fin_succs"><span class="command">lemma</span></span> fin_succs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v</span> <span class="main">∈</span> set <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span><span class="main">.</span> finite <span class="main">(</span>succs <span class="bound">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> succ_is_subset_of_verts<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>rev_finite_subset<span class="main">)</span>

<span class="keyword1" id="Cfg-fin_succs'"><span class="command">lemma</span></span> fin_succs'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">&lt;</span> length <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span> <span class="main">⟹</span> finite <span class="main">(</span>succs <span class="free">v</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> set <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span>"</span></span><span class="main">)</span>
   <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fin_succs verts_set<span class="main">)</span>

<span class="keyword1" id="Cfg-succ_range"><span class="command">lemma</span></span> succ_range<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v</span> <span class="main">∈</span> succs <span class="free">n</span><span class="main">.</span> <span class="bound">v</span> <span class="main">&lt;</span> length <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> succ_in_G verts_set<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Cfg-path_entry_gt"><span class="command">lemma</span></span> path_entry_gt<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span><span class="main">.</span> path_entry <span class="free">E</span> <span class="bound">p</span> <span class="free">n</span> <span class="main">⟶</span> <span class="free">d</span> <span class="main">∈</span> set <span class="bound">p</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span><span class="main">.</span> path_entry <span class="free">E</span> <span class="bound">p</span> <span class="free">n'</span> <span class="main">⟶</span> <span class="free">n</span> <span class="main">∈</span> set <span class="bound">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span><span class="main">.</span> path_entry <span class="free">E</span> <span class="bound">p</span> <span class="free">n'</span> <span class="main">⟶</span> <span class="free">d</span> <span class="main">∈</span> set <span class="bound">p</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> strip<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?npath</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"takeWhile <span class="main">(</span><span class="main">(≠)</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span>rev <span class="skolem">p</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">have</span></span> sub<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="var">?npath</span> <span class="main">⊆</span> set <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">p</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>set_takeWhileD<span class="main">)</span>

  <span class="keyword3"><span class="command">assume</span></span> ass<span class="main">:</span> <span class="quoted"><span class="quoted">"path_entry <span class="free">E</span> <span class="skolem">p</span> <span class="free">n'</span> "</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> n_in_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span>rev <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> ass <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path_entry <span class="free">E</span> <span class="main">(</span>rev <span class="var">?npath</span><span class="main">)</span> <span class="free">n</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> takeWhileNot_path_entry <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">∈</span> set <span class="var">?npath</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>   
  <span class="keyword1"><span class="command">with</span></span> sub <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">∈</span> set <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">dominate</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> bool"</span></span> 
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">dominate</span> <span class="free"><span class="bound"><span class="entity">n1</span></span></span> <span class="free"><span class="bound"><span class="entity">n2</span></span></span> <span class="main">≡</span>
         <span class="main">∀</span><span class="bound">pa</span><span class="main">.</span> path_entry <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span> <span class="bound">pa</span> <span class="free"><span class="bound"><span class="entity">n2</span></span></span> <span class="main">⟶</span> 
         <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n1</span></span></span> <span class="main">∈</span> set <span class="bound">pa</span> <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">n1</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">n2</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">strict_dominate</span><span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">strict_dominate</span> <span class="free"><span class="bound"><span class="entity">n1</span></span></span> <span class="free"><span class="bound"><span class="entity">n2</span></span></span> <span class="main">≡</span> 
   <span class="main">∀</span><span class="bound">pa</span><span class="main">.</span> path_entry <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span> <span class="bound">pa</span> <span class="free"><span class="bound"><span class="entity">n2</span></span></span> <span class="main">⟶</span> 
   <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n1</span></span></span> <span class="main">∈</span> set <span class="bound">pa</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">n1</span></span></span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">n2</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Cfg-any_dominate_unreachable"><span class="command">lemma</span></span> any_dominate_unreachable<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> reachable <span class="free">n</span> <span class="main">⟹</span> dominate <span class="free">d</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">unfold</span> reachable_def dominate_def<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> ass<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∉</span> <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">``</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">p</span><span class="main">.</span> path_entry <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span> <span class="bound">p</span> <span class="free">n</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">" <span class="main">¬</span> <span class="main">(</span><span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">p</span><span class="main">.</span> path_entry <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span> <span class="bound">p</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"path_entry <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span> <span class="skolem">p</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> reachable <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>path_entry_reachable<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> ass <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"reachable <span class="free">n</span>"</span></span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> ass <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>reachable_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">pa</span><span class="main">.</span> path_entry <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span> <span class="bound">pa</span> <span class="free">n</span> <span class="main">⟶</span> <span class="free">d</span> <span class="main">∈</span> set <span class="bound">pa</span> <span class="main">∨</span> <span class="free">d</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Cfg-any_sdominate_unreachable"><span class="command">lemma</span></span> any_sdominate_unreachable<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> reachable <span class="free">n</span> <span class="main">⟹</span> strict_dominate <span class="free">d</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">unfold</span> reachable_def strict_dominate_def<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> ass<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∉</span> <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">``</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span> "</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">p</span><span class="main">.</span> path_entry <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span>  <span class="bound">p</span> <span class="free">n</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">" <span class="main">¬</span> <span class="main">(</span><span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">p</span><span class="main">.</span> path_entry <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span> <span class="bound">p</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"path_entry <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span> <span class="skolem">p</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> reachable <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>path_entry_reachable<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>    
    <span class="keyword1"><span class="command">proof</span></span> 
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> ass <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"reachable <span class="free">n</span>"</span></span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> ass <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>reachable_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">pa</span><span class="main">.</span> path_entry <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span>  <span class="bound">pa</span> <span class="free">n</span> <span class="main">⟶</span> <span class="free">d</span> <span class="main">∈</span> set <span class="bound">pa</span> <span class="main">∧</span> <span class="free">d</span> <span class="main">≠</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Cfg-dom_reachable"><span class="command">lemma</span></span> dom_reachable<span class="main">:</span> <span class="quoted"><span class="quoted">"reachable <span class="free">n</span> <span class="main">⟹</span> dominate <span class="free">d</span> <span class="free">n</span> <span class="main">⟹</span> reachable <span class="free">d</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> reach_n<span class="main">:</span> <span class="quoted"><span class="quoted">"reachable <span class="free">n</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> dom_n<span class="main">:</span> <span class="quoted"><span class="quoted">"dominate <span class="free">d</span> <span class="free">n</span>"</span></span> 
  <span class="keyword1"><span class="command">from</span></span> reach_n <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span><span class="main">.</span> path_entry <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span>  <span class="bound">p</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> reachable_path_entry<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"path_entry <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span> <span class="skolem">p</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"reachable <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">≠</span> <span class="free">n</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True     
    <span class="keyword1"><span class="command">with</span></span> dom_n p <span class="keyword1"><span class="command">have</span></span> d_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">∈</span> set <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>dominate_def<span class="main">)</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?pa</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"takeWhile <span class="main">(</span><span class="main">(≠)</span> <span class="free">d</span><span class="main">)</span> <span class="main">(</span>rev <span class="skolem">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> d_in p <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path_entry <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span> <span class="main">(</span>rev <span class="var">?pa</span><span class="main">)</span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> takeWhileNot_path_entry <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> path_entry_reachable <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> reach_n <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Cfg-dominate_refl"><span class="command">lemma</span></span> dominate_refl<span class="main">:</span> <span class="quoted"><span class="quoted">"dominate <span class="free">n</span> <span class="free">n</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>dominate_def<span class="main">)</span>

<span class="keyword1" id="Cfg-entry0_dominates_all"><span class="command">lemma</span></span> entry0_dominates_all<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span> <span class="main">∈</span> set <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span><span class="main">.</span> dominate <span class="main">0</span> <span class="bound">p</span>"</span></span>  
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> strip<span class="main">)</span>  
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> 
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> set <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dominate <span class="main">0</span> <span class="skolem">p</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>dominate_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">assume</span></span> p_neq0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">pa</span><span class="main">.</span> path_entry <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span> <span class="bound">pa</span> <span class="skolem">p</span> <span class="main">⟶</span> <span class="main">0</span> <span class="main">∈</span> set <span class="bound">pa</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> strip<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">pa</span>
      <span class="keyword3"><span class="command">assume</span></span> path_p<span class="main">:</span> <span class="quoted"><span class="quoted">"path_entry <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span> <span class="skolem">pa</span> <span class="skolem">p</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> set <span class="skolem">pa</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">pa</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">note</span></span> pa_n_nil <span class="main">=</span> this
        <span class="keyword1"><span class="command">with</span></span> path_p <span class="keyword1"><span class="command">have</span></span> last_pa<span class="main">:</span> <span class="quoted"><span class="quoted">"last <span class="skolem">pa</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> path_entry_last <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> pa_n_nil <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"last <span class="skolem">pa</span> <span class="main">∈</span> set <span class="skolem">pa</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> last_pa <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False 
        <span class="keyword1"><span class="command">with</span></span> path_p <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>path_entry0_empty_conv<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> p_neq0 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>dominate_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"strict_dominate <span class="free">i</span> <span class="free">j</span> <span class="main">⟹</span> <span class="free">j</span> <span class="main">∈</span> set <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">i</span> <span class="main">≠</span> <span class="free">j</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span>  any_node_exits_path
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>strict_dominate_def<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">non_strict_dominate</span><span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">non_strict_dominate</span> <span class="free"><span class="bound"><span class="entity">n1</span></span></span> <span class="free"><span class="bound"><span class="entity">n2</span></span></span> <span class="main">≡</span> <span class="main">∃</span><span class="bound">pa</span><span class="main">.</span> path_entry <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span> <span class="bound">pa</span> <span class="free"><span class="bound"><span class="entity">n2</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n1</span></span></span> <span class="main">∉</span> set <span class="bound">pa</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Cfg-any_sdominate_0"><span class="command">lemma</span></span> any_sdominate_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> set <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span> <span class="main">⟹</span> non_strict_dominate <span class="free">n</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>non_strict_dominate_def<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>path_entry0<span class="main">)</span>

<span class="comment1">(*
lemma non_strict_dominate_refl: "n ∈ set (g_V G) ⟹ non_strict_dominate n n"
proof(unfold non_strict_dominate_def)
  assume n_in: "n ∈ set (g_V G)"
  then obtain p where p_n: "path_entry (g_E G) p n" using any_node_exits_path by auto

  have pa0: "path_entry (g_E G) [] 0" by (rule path_entry0)

  show "∃pa. path_entry (g_E G) pa n ∧ n ∉ set pa"
  proof(cases "n = 0")
    case True 
    then show ?thesis using pa0 by (auto simp add:non_strict_dominate_def)
  next 
    case False note n_neq_0 = this 
    with p_n have "p ≠ []" using path_entry0_empty_conv by auto 
    then show ?thesis using p_n by (auto intro: path_entry_loop)    
  qed
qed
*)</span>
<span class="keyword1" id="Cfg-non_sdominate_succ"><span class="command">lemma</span></span> non_sdominate_succ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span> <span class="main">)</span> <span class="main">∈</span> g_E <span class="free">G</span> <span class="main">⟹</span> <span class="free">k</span> <span class="main">≠</span> <span class="free">i</span> <span class="main">⟹</span> non_strict_dominate <span class="free">k</span> <span class="free">i</span> <span class="main">⟹</span> non_strict_dominate <span class="free">k</span> <span class="free">j</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> i_j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">i</span><span class="main">,</span><span class="free">j</span> <span class="main">)</span> <span class="main">∈</span> g_E <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> k_neq_i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≠</span> <span class="free">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"non_strict_dominate <span class="free">k</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">pa</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"path_entry <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span> <span class="skolem">pa</span> <span class="free">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> k_nin_pa<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">∉</span> set <span class="skolem">pa</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>non_strict_dominate_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> i_j <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"path_entry <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span> <span class="main">(</span><span class="free">i</span><span class="main">#</span><span class="skolem">pa</span><span class="main">)</span> <span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>path_entry_prepend<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> k_neq_i k_nin_pa <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>non_strict_dominate_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Cfg-any_node_non_sdom0"><span class="command">lemma</span></span> any_node_non_sdom0<span class="main">:</span> <span class="quoted"><span class="quoted">"non_strict_dominate <span class="free">k</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>entry0_path <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>non_strict_dominate_def<span class="main">)</span>

<span class="keyword1" id="Cfg-nonstrict_eq"><span class="command">lemma</span></span> nonstrict_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"non_strict_dominate <span class="free">i</span> <span class="free">j</span> <span class="main">⟹</span> <span class="main">¬</span> strict_dominate <span class="free">i</span> <span class="free">j</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>non_strict_dominate_def strict_dominate_def<span class="main">)</span>

<span class="keyword1" id="Cfg-dominate_trans"><span class="command">lemma</span></span> dominate_trans<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dominate <span class="free">n1</span> <span class="free">n2</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"dominate <span class="free">n2</span> <span class="free">n3</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"dominate <span class="free">n1</span> <span class="free">n3</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n1</span> <span class="main">=</span> <span class="free">n2</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dominate <span class="free">n1</span> <span class="free">n3</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n1</span> <span class="main">=</span> <span class="free">n3</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>dominate_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dominate <span class="free">n1</span> <span class="free">n3</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n2</span> <span class="main">=</span> <span class="free">n3</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">`<span class="free">n1</span> <span class="main">≠</span> <span class="free">n2</span>`</span></span> <span class="quoted"><span class="quoted">`<span class="free">n1</span> <span class="main">≠</span> <span class="free">n3</span>`</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dominate_def<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">pa</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">n1</span> <span class="main">≠</span> <span class="free">n2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">n1</span> <span class="main">≠</span> <span class="free">n3</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">n2</span> <span class="main">≠</span> <span class="free">n3</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">`<span class="free">n1</span> <span class="main">≠</span> <span class="free">n2</span>`</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> n1_n2_pa<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">pa</span><span class="main">.</span> path_entry <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span> <span class="bound">pa</span> <span class="free">n2</span> <span class="main">⟶</span> <span class="free">n1</span> <span class="main">∈</span> set <span class="bound">pa</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>dominate_def<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">`<span class="free">n2</span> <span class="main">≠</span> <span class="free">n3</span>`</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">pa</span><span class="main">.</span> path_entry <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span> <span class="bound">pa</span> <span class="free">n3</span> <span class="main">⟶</span> <span class="free">n2</span> <span class="main">∈</span> set <span class="bound">pa</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>dominate_def<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> n1_n2_pa <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">pa</span><span class="main">.</span> path_entry <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span> <span class="bound">pa</span> <span class="free">n3</span> <span class="main">⟶</span> <span class="free">n1</span> <span class="main">∈</span> set <span class="bound">pa</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> path_entry_gt<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">pa</span><span class="main">.</span> path_entry <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span> <span class="bound">pa</span> <span class="free">n3</span> <span class="main">⟹</span> <span class="free">n1</span> <span class="main">∈</span> set <span class="bound">pa</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Cfg-len_takeWhile_lt"><span class="command">lemma</span></span> len_takeWhile_lt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set <span class="free">xs</span> <span class="main">⟹</span> length <span class="main">(</span>takeWhile <span class="main">(</span><span class="main">(≠)</span> <span class="free">x</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Cfg-len_takeWhile_comp"><span class="command">lemma</span></span> len_takeWhile_comp<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n1</span> <span class="main">∈</span> set <span class="free">xs</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">n2</span> <span class="main">∈</span> set <span class="free">xs</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">n1</span> <span class="main">≠</span> <span class="free">n2</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>takeWhile <span class="main">(</span><span class="main">(≠)</span> <span class="free">n1</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span> <span class="main">≠</span> length <span class="main">(</span>takeWhile <span class="main">(</span><span class="main">(≠)</span> <span class="free">n2</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Cfg-len_takeWhile_comp1"><span class="command">lemma</span></span> len_takeWhile_comp1<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n1</span> <span class="main">∈</span> set <span class="free">xs</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">n2</span> <span class="main">∈</span> set <span class="free">xs</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">n1</span> <span class="main">≠</span> <span class="free">n2</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>takeWhile <span class="main">(</span><span class="main">(≠)</span> <span class="free">n1</span><span class="main">)</span> <span class="main">(</span>rev <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> length <span class="main">(</span>takeWhile <span class="main">(</span><span class="main">(≠)</span> <span class="free">n2</span><span class="main">)</span> <span class="main">(</span>rev <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms len_takeWhile_comp<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">n1</span>"</span></span> <span class="quoted"><span class="quoted">"rev <span class="free">xs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n2</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Cfg-len_takeWhile_comp2"><span class="command">lemma</span></span> len_takeWhile_comp2<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n1</span> <span class="main">∈</span> set <span class="free">xs</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">n2</span> <span class="main">∉</span> set <span class="free">xs</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>takeWhile <span class="main">(</span><span class="main">(≠)</span> <span class="free">n1</span><span class="main">)</span> <span class="main">(</span>rev <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> length <span class="main">(</span>takeWhile <span class="main">(</span><span class="main">(≠)</span> <span class="free">n2</span><span class="main">)</span> <span class="main">(</span>rev <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?xs1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"takeWhile <span class="main">(</span><span class="main">(≠)</span> <span class="free">n1</span><span class="main">)</span> <span class="main">(</span>rev <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?xs2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"takeWhile <span class="main">(</span><span class="main">(≠)</span> <span class="free">n2</span><span class="main">)</span> <span class="main">(</span>rev <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> len1<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>takeWhile <span class="main">(</span><span class="main">(≠)</span> <span class="free">n1</span><span class="main">)</span> <span class="main">(</span>rev <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="main">(</span>rev <span class="free">xs</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> len_takeWhile_lt<span class="main">[</span><span class="operator">of</span> <span class="main">_</span><span class="quoted"><span class="quoted">"rev <span class="free">xs</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?xs1</span> <span class="main">=</span> takeWhile <span class="main">(</span><span class="main">(≠)</span> <span class="free">n1</span><span class="main">)</span> <span class="main">(</span>rev <span class="free">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> len2<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="var">?xs1</span> <span class="main">&lt;</span> length <span class="main">(</span>rev <span class="free">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> len1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"takeWhile <span class="main">(</span><span class="main">(≠)</span> <span class="free">n2</span><span class="main">)</span> <span class="main">(</span>rev <span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>rev <span class="free">xs</span><span class="main">)</span> <span class="main">@</span> takeWhile <span class="main">(</span><span class="main">(≠)</span> <span class="free">n2</span><span class="main">)</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>takeWhile_append2<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?xs2</span> <span class="main">=</span> <span class="main">(</span>rev <span class="free">xs</span><span class="main">)</span> <span class="main">@</span> takeWhile <span class="main">(</span><span class="main">(≠)</span> <span class="free">n2</span><span class="main">)</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> len2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Cfg-len_compare1"><span class="command">lemma</span></span> len_compare1<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n1</span> <span class="main">=</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">n2</span> <span class="main">≠</span> <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>takeWhile <span class="main">(</span><span class="main">(≠)</span> <span class="free">n1</span><span class="main">)</span> <span class="main">(</span>rev <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> length <span class="main">(</span>takeWhile <span class="main">(</span><span class="main">(≠)</span> <span class="free">n2</span><span class="main">)</span> <span class="main">(</span>rev <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n1</span> <span class="main">∈</span> set <span class="free">xs</span> <span class="main">∧</span> <span class="free">n2</span> <span class="main">∈</span> set <span class="free">xs</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> len_takeWhile_comp1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?xs1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"takeWhile <span class="main">(</span><span class="main">(≠)</span> <span class="free">n1</span><span class="main">)</span> <span class="main">(</span>rev <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?xs2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"takeWhile <span class="main">(</span><span class="main">(≠)</span> <span class="free">n2</span><span class="main">)</span> <span class="main">(</span>rev <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n1</span> <span class="main">∈</span> set <span class="free">xs</span> <span class="main">∧</span> <span class="free">n2</span> <span class="main">∉</span> set <span class="free">xs</span> <span class="main">∨</span> <span class="free">n1</span> <span class="main">∉</span> set <span class="free">xs</span> <span class="main">∧</span> <span class="free">n2</span> <span class="main">∈</span> set <span class="free">xs</span> <span class="main">∨</span> <span class="free">n1</span> <span class="main">∉</span> set <span class="free">xs</span> <span class="main">∧</span> <span class="free">n2</span> <span class="main">∉</span>  set <span class="free">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">n1</span> <span class="main">∈</span> set <span class="free">xs</span> <span class="main">∧</span> <span class="free">n2</span> <span class="main">∉</span> set <span class="free">xs</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> len_takeWhile_comp2<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">n1</span> <span class="main">∉</span> set <span class="free">xs</span> <span class="main">∧</span> <span class="free">n2</span> <span class="main">∈</span> set <span class="free">xs</span> <span class="main">∨</span> <span class="free">n1</span> <span class="main">∉</span> set <span class="free">xs</span> <span class="main">∧</span> <span class="free">n2</span> <span class="main">∉</span> set <span class="free">xs</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">n1</span> <span class="main">∉</span> set <span class="free">xs</span> <span class="main">∧</span> <span class="free">n2</span> <span class="main">∈</span> set <span class="free">xs</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> n1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n1</span> <span class="main">∉</span> set <span class="free">xs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> n2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n2</span> <span class="main">∈</span> set <span class="free">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="var">?xs2</span> <span class="main">≠</span> length <span class="var">?xs1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> len_takeWhile_comp2<span class="main">[</span><span class="operator">OF</span> n2 n1<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">n1</span> <span class="main">∉</span> set <span class="free">xs</span> <span class="main">∧</span> <span class="free">n2</span> <span class="main">∉</span> set <span class="free">xs</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> n1_nin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n1</span> <span class="main">∉</span> set <span class="free">xs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> n2_nin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n2</span> <span class="main">∉</span> set <span class="free">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span>  <span class="keyword1"><span class="command">have</span></span> t1<span class="main">:</span> <span class="quoted"><span class="quoted">"takeWhile <span class="main">(</span><span class="main">(≠)</span> <span class="free">n1</span><span class="main">)</span> <span class="main">(</span>rev <span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>rev <span class="free">xs</span><span class="main">)</span> <span class="main">@</span> takeWhile  <span class="main">(</span><span class="main">(≠)</span> <span class="free">n1</span><span class="main">)</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span>"</span></span> 
             <span class="keyword2"><span class="keyword">and</span></span>     <span class="quoted"><span class="quoted">"takeWhile <span class="main">(</span><span class="main">(≠)</span> <span class="free">n2</span><span class="main">)</span> <span class="main">(</span>rev <span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>rev <span class="free">xs</span><span class="main">)</span> <span class="main">@</span> takeWhile  <span class="main">(</span><span class="main">(≠)</span> <span class="free">n2</span><span class="main">)</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>takeWhile_append2<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">`<span class="free">n1</span> <span class="main">=</span> <span class="free">x</span>`</span></span> <span class="quoted"><span class="quoted">`<span class="free">n2</span> <span class="main">≠</span> <span class="free">x</span>`</span></span>  <span class="keyword1"><span class="command">have</span></span> t1'<span class="main">:</span> <span class="quoted"><span class="quoted">"takeWhile <span class="main">(</span><span class="main">(≠)</span> <span class="free">n1</span><span class="main">)</span> <span class="main">(</span>rev <span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> rev <span class="free">xs</span>"</span></span> 
                               <span class="keyword2"><span class="keyword">and</span></span>      <span class="quoted"><span class="quoted">"takeWhile <span class="main">(</span><span class="main">(≠)</span> <span class="free">n2</span><span class="main">)</span> <span class="main">(</span>rev <span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>rev <span class="free">xs</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>      
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>takeWhile <span class="main">(</span><span class="main">(≠)</span> <span class="free">n2</span><span class="main">)</span> <span class="main">(</span>rev <span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span><span class="main">(</span>rev <span class="free">xs</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> arg_cong<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"takeWhile <span class="main">(</span><span class="main">(≠)</span> <span class="free">n2</span><span class="main">)</span> <span class="main">(</span>rev <span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"rev <span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"length"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>       
      <span class="keyword1"><span class="command">with</span></span> t1' <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Cfg-len_compare2"><span class="command">lemma</span></span> len_compare2<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n1</span> <span class="main">∈</span> set <span class="free">xs</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">n1</span> <span class="main">≠</span> <span class="free">n2</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>takeWhile <span class="main">(</span><span class="main">(≠)</span> <span class="free">n1</span><span class="main">)</span> <span class="main">(</span>rev <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> length <span class="main">(</span>takeWhile <span class="main">(</span><span class="main">(≠)</span> <span class="free">n2</span><span class="main">)</span> <span class="main">(</span>rev <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">n2</span> <span class="main">∈</span> set <span class="free">xs</span>"</span></span><span class="main">)</span> 
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> len_takeWhile_comp1 <span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>len_takeWhile_comp2<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Cfg-len_takeWhile_set"><span class="command">lemma</span></span> len_takeWhile_set<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>takeWhile <span class="main">(</span><span class="main">(≠)</span> <span class="free">n1</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span> <span class="main">&gt;</span> length <span class="main">(</span>takeWhile <span class="main">(</span><span class="main">(≠)</span> <span class="free">n2</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">n1</span> <span class="main">≠</span> <span class="free">n2</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">n1</span> <span class="main">∈</span> set <span class="free">xs</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">n2</span> <span class="main">∈</span> set <span class="free">xs</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>takeWhile <span class="main">(</span><span class="main">(≠)</span> <span class="free">n2</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span>  <span class="main">⊆</span> set <span class="main">(</span>takeWhile <span class="main">(</span><span class="main">(≠)</span> <span class="free">n1</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">y</span> <span class="skolem">ys</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> ind_hyp <span class="main">=</span> Cons<span class="main">(</span>1<span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> len_n2_lt_n1_y_ys <span class="main">=</span> Cons<span class="main">(</span>2<span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> n1_n_n2 <span class="main">=</span> Cons<span class="main">(</span>3<span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> n1_in_y_ys <span class="main">=</span> Cons<span class="main">(</span>4<span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> n2_in_y_ys <span class="main">=</span> Cons<span class="main">(</span>5<span class="main">)</span>
 
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ys1_take</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"takeWhile <span class="main">(</span><span class="main">(≠)</span> <span class="free">n1</span><span class="main">)</span> <span class="skolem">ys</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ys2_take</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"takeWhile <span class="main">(</span><span class="main">(≠)</span> <span class="free">n2</span><span class="main">)</span> <span class="skolem">ys</span>"</span></span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n1</span> <span class="main">∈</span> set <span class="skolem">ys</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">note</span></span> n1_in_ys <span class="main">=</span> this
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n2</span> <span class="main">∈</span> set <span class="skolem">ys</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">note</span></span> n2_in_ys <span class="main">=</span> this
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n1</span> <span class="main">≠</span> <span class="skolem">y</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">note</span></span> n1_neq_y <span class="main">=</span> this
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n2</span> <span class="main">≠</span> <span class="skolem">y</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">note</span></span> n2_neq_y <span class="main">=</span> this
          <span class="keyword1"><span class="command">from</span></span> len_n2_lt_n1_y_ys <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="var">?ys2_take</span> <span class="main">&lt;</span> length <span class="var">?ys1_take</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> n1_n_n2 n1_in_ys n2_in_ys n1_neq_y n2_neq_y <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">ys</span></span><span class="main">)</span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> ind_hyp<span class="main">[</span><span class="operator">OF</span> this n1_n_n2 n1_in_ys n2_in_ys<span class="main">]</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>takeWhile <span class="main">(</span><span class="main">(≠)</span> <span class="free">n2</span><span class="main">)</span> <span class="skolem">ys</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>takeWhile <span class="main">(</span><span class="main">(≠)</span> <span class="free">n1</span><span class="main">)</span> <span class="skolem">ys</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> n1_neq_y n2_neq_y <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">ys</span></span><span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">with</span></span> n1_n_n2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False 
        <span class="keyword1"><span class="command">with</span></span> n1_n_n2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> len_n2_lt_n1_y_ys <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">with</span></span> n2_in_y_ys <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n2</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> n1_in_y_ys <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n1</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> n1_n_n2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> len_n2_lt_n1_y_ys <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
    
<span class="keyword1" id="Cfg-reachable_dom_acyclic"><span class="command">lemma</span></span> reachable_dom_acyclic<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"reachable <span class="free">n2</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"dominate <span class="free">n1</span> <span class="free">n2</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"dominate <span class="free">n2</span> <span class="free">n1</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">n1</span> <span class="main">=</span> <span class="free">n2</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"reachable <span class="free">n1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> dom_reachable<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">pa</span><span class="main">.</span> path_entry <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span> <span class="bound">pa</span> <span class="free">n1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> reachable_path_entry<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">pa</span></span> <span class="keyword2"><span class="keyword">where</span></span> pa<span class="main">:</span> <span class="quoted"><span class="quoted">"path_entry <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span> <span class="skolem">pa</span> <span class="free">n1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?n_take_n1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"takeWhile <span class="main">(</span><span class="main">(≠)</span> <span class="free">n1</span><span class="main">)</span> <span class="main">(</span>rev <span class="skolem">pa</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?n_take_n2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"takeWhile <span class="main">(</span><span class="main">(≠)</span> <span class="free">n2</span><span class="main">)</span> <span class="main">(</span>rev <span class="skolem">pa</span><span class="main">)</span>"</span></span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">n1</span> <span class="main">=</span> <span class="free">n2</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> n1_neq_n2<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="free">n1</span> <span class="main">≠</span> <span class="free">n2</span>"</span></span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> pa_n1_n2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">pa</span><span class="main">.</span> path_entry <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span> <span class="bound">pa</span> <span class="free">n2</span> <span class="main">⟶</span> <span class="free">n1</span> <span class="main">∈</span> set <span class="bound">pa</span>"</span></span> 
          <span class="keyword2"><span class="keyword">and</span></span> pa_n2_n1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">pa</span><span class="main">.</span> path_entry <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span>  <span class="bound">pa</span> <span class="free">n1</span> <span class="main">⟶</span> <span class="free">n2</span> <span class="main">∈</span> set <span class="bound">pa</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>dominate_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> n1_n1_pa<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">pa</span><span class="main">.</span> path_entry <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span>  <span class="bound">pa</span> <span class="free">n1</span> <span class="main">⟶</span> <span class="free">n1</span> <span class="main">∈</span> set <span class="bound">pa</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> path_entry_gt<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> pa pa_n2_n1 <span class="keyword1"><span class="command">have</span></span> n1_in_pa<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n1</span> <span class="main">∈</span> set <span class="skolem">pa</span>"</span></span> 
                      <span class="keyword2"><span class="keyword">and</span></span> n2_in_pa<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n2</span> <span class="main">∈</span> set <span class="skolem">pa</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> n1_neq_n2 <span class="keyword1"><span class="command">have</span></span> len_neq<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="var">?n_take_n1</span> <span class="main">≠</span> length <span class="var">?n_take_n2</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> len_takeWhile_comp<span class="main">)</span>
    
    <span class="keyword1"><span class="command">from</span></span> pa n1_in_pa n2_in_pa <span class="keyword1"><span class="command">have</span></span> path1<span class="main">:</span> <span class="quoted"><span class="quoted">"path_entry <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span> <span class="main">(</span>rev <span class="var">?n_take_n1</span><span class="main">)</span> <span class="free">n1</span>"</span></span>  
                               <span class="keyword2"><span class="keyword">and</span></span> path2<span class="main">:</span> <span class="quoted"><span class="quoted">"path_entry <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span> <span class="main">(</span>rev <span class="var">?n_take_n2</span><span class="main">)</span> <span class="free">n2</span>"</span></span>  
      <span class="keyword1"><span class="command">using</span></span> takeWhileNot_path_entry <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">have</span></span> n1_not_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n1</span> <span class="main">∉</span> set <span class="var">?n_take_n1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> set_takeWhileD<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"rev <span class="skolem">pa</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> n2_not_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n2</span> <span class="main">∉</span> set <span class="var">?n_take_n2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> set_takeWhileD<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"rev <span class="skolem">pa</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

    <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"length <span class="var">?n_take_n1</span> <span class="main">&gt;</span> length <span class="var">?n_take_n2</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="var">?n_take_n2</span> <span class="main">⊆</span> set <span class="var">?n_take_n1</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> n1_in_pa n2_in_pa <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> len_takeWhile_set<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"rev <span class="skolem">pa</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>       
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n1</span> <span class="main">∉</span> set <span class="var">?n_take_n2</span> "</span></span> <span class="keyword1"><span class="command">using</span></span> n1_not_in <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> path2 <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> pa_n1_n2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">with</span></span> len_neq <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="var">?n_take_n2</span> <span class="main">&gt;</span> length <span class="var">?n_take_n1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="var">?n_take_n1</span> <span class="main">⊆</span> set <span class="var">?n_take_n2</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> n1_neq_n2 n2_in_pa n1_in_pa  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> len_takeWhile_set<span class="main">)</span>  
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n2</span> <span class="main">∉</span> set <span class="var">?n_take_n1</span> "</span></span> <span class="keyword1"><span class="command">using</span></span> n2_not_in <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> path1 <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> pa_n2_n1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Cfg-sdom_dom"><span class="command">lemma</span></span> sdom_dom<span class="main">:</span> <span class="quoted"><span class="quoted">"strict_dominate <span class="free">n1</span> <span class="free">n2</span> <span class="main">⟹</span> dominate <span class="free">n1</span> <span class="free">n2</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>strict_dominate_def dominate_def<span class="main">)</span>

<span class="keyword1" id="Cfg-dominate_sdominate"><span class="command">lemma</span></span> dominate_sdominate<span class="main">:</span> <span class="quoted"><span class="quoted">"dominate <span class="free">n1</span> <span class="free">n2</span> <span class="main">⟹</span> <span class="free">n1</span> <span class="main">≠</span> <span class="free">n2</span> <span class="main">⟹</span> strict_dominate <span class="free">n1</span> <span class="free">n2</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>strict_dominate_def dominate_def<span class="main">)</span>

<span class="keyword1" id="Cfg-sdom_neq"><span class="command">lemma</span></span> sdom_neq<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"reachable <span class="free">n2</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"strict_dominate <span class="free">n1</span> <span class="free">n2</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">n1</span> <span class="main">≠</span> <span class="free">n2</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span><span class="main">.</span> path_entry <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span>  <span class="bound">p</span> <span class="free">n2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> reachable_path_entry<span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"path_entry <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span>  <span class="skolem">p</span> <span class="free">n2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>strict_dominate_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="Cfg-reachable_dom_acyclic2"><span class="command">lemma</span></span> reachable_dom_acyclic2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"reachable <span class="free">n2</span> "</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"strict_dominate <span class="free">n1</span> <span class="free">n2</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> dominate <span class="free">n2</span> <span class="free">n1</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> n1_dom_n2<span class="main">:</span> <span class="quoted"><span class="quoted">"dominate <span class="free">n1</span> <span class="free">n2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> n1_neq_n2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n1</span> <span class="main">≠</span> <span class="free">n2</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>sdom_dom sdom_neq<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dominate <span class="free">n2</span> <span class="free">n1</span> <span class="main">⟹</span> <span class="free">n1</span> <span class="main">=</span> <span class="free">n2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> reachable_dom_acyclic <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> n1_neq_n2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Cfg-not_dom_eq_not_sdom"><span class="command">lemma</span></span> not_dom_eq_not_sdom<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> dominate <span class="free">n1</span> <span class="free">n2</span> <span class="main">⟹</span> <span class="main">¬</span> strict_dominate <span class="free">n1</span> <span class="free">n2</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>strict_dominate_def dominate_def<span class="main">)</span>

<span class="keyword1" id="Cfg-reachable_sdom_acyclic"><span class="command">lemma</span></span> reachable_sdom_acyclic<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"reachable <span class="free">n2</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"strict_dominate <span class="free">n1</span> <span class="free">n2</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> strict_dominate <span class="free">n2</span> <span class="free">n1</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> reachable_dom_acyclic2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>not_dom_eq_not_sdom<span class="main">)</span> 

<span class="keyword1" id="Cfg-strict_dominate_trans1"><span class="command">lemma</span></span> strict_dominate_trans1<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"strict_dominate <span class="free">n1</span> <span class="free">n2</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"dominate <span class="free">n2</span> <span class="free">n3</span>"</span></span> 
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"strict_dominate <span class="free">n1</span> <span class="free">n3</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"reachable <span class="free">n2</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">note</span></span> reach_n2 <span class="main">=</span> this
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> n1_dom_n2<span class="main">:</span> <span class="quoted"><span class="quoted">"dominate <span class="free">n1</span> <span class="free">n2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> n1_neq_n2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n1</span> <span class="main">≠</span> <span class="free">n2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>sdom_dom sdom_neq<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> n1_dom_n3<span class="main">:</span> <span class="quoted"><span class="quoted">"dominate <span class="free">n1</span> <span class="free">n3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> dominate_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> n1_neq_n3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n1</span> <span class="main">≠</span> <span class="free">n3</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">n1</span> <span class="main">≠</span> <span class="free">n3</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n1</span> <span class="main">=</span> <span class="free">n3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> n2_dom_n1<span class="main">:</span> <span class="quoted"><span class="quoted">"dominate <span class="free">n2</span> <span class="free">n1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> reach_n2 n1_dom_n2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n1</span> <span class="main">=</span> <span class="free">n2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>reachable_dom_acyclic<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> n1_neq_n2 <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> n1_dom_n3 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>strict_dominate_def dominate_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">note</span></span> not_reach_n2 <span class="main">=</span> this
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> reachable <span class="free">n3</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">¬</span> reachable <span class="free">n3</span> "</span></span> 
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"reachable <span class="free">n2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> dom_reachable<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> not_reach_n2 <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>any_sdominate_unreachable<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Cfg-strict_dominate_trans2"><span class="command">lemma</span></span> strict_dominate_trans2<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dominate <span class="free">n1</span> <span class="free">n2</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"strict_dominate <span class="free">n2</span> <span class="free">n3</span>"</span></span> 
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"strict_dominate <span class="free">n1</span> <span class="free">n3</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"reachable <span class="free">n3</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> n2_dom_n3<span class="main">:</span> <span class="quoted"><span class="quoted">"dominate <span class="free">n2</span> <span class="free">n3</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> n1_neq_n2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n2</span> <span class="main">≠</span> <span class="free">n3</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>sdom_dom sdom_neq<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> n1_dom_n3<span class="main">:</span> <span class="quoted"><span class="quoted">"dominate <span class="free">n1</span> <span class="free">n3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> dominate_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> n1_neq_n3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n1</span> <span class="main">≠</span> <span class="free">n3</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">n1</span> <span class="main">≠</span> <span class="free">n3</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n1</span> <span class="main">=</span> <span class="free">n3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dominate <span class="free">n3</span> <span class="free">n2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">`reachable <span class="free">n3</span>`</span></span> n2_dom_n3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n2</span> <span class="main">=</span> <span class="free">n3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>reachable_dom_acyclic<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> n1_neq_n2 <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> n1_dom_n3 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>strict_dominate_def dominate_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> reachable <span class="free">n3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>any_sdominate_unreachable<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Cfg-strict_dominate_trans"><span class="command">lemma</span></span> strict_dominate_trans<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"strict_dominate <span class="free">n1</span> <span class="free">n2</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"strict_dominate <span class="free">n2</span> <span class="free">n3</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"strict_dominate <span class="free">n1</span> <span class="free">n3</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"dominate <span class="free">n2</span> <span class="free">n3</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> strict_dominate_trans1<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> strict_dominate_def dominate_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Cfg-sdominate_dominate_succs"><span class="command">lemma</span></span> sdominate_dominate_succs<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> i_sdom_j<span class="main">:</span>    <span class="quoted"><span class="quoted">"strict_dominate <span class="free">i</span> <span class="free">j</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> j_in_succ_k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">∈</span> succs <span class="free">k</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span>              <span class="quoted"><span class="quoted">"dominate <span class="free">i</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> ass<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> dominate <span class="free">i</span> <span class="free">k</span>"</span></span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> path_k<span class="main">:</span> <span class="quoted"><span class="quoted">"path_entry <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span>  <span class="skolem">p</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> i_nin_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∉</span> set <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>dominate_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> j_in_succ_k i_sdom_j <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> <span class="free">k</span> <span class="main">∨</span> <span class="free">i</span> <span class="main">=</span> <span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>path_entry_append <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>succs_def strict_dominate_def<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> j_in_succ_k <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"reachable <span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> succ_in_verts reachable <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>reachable_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> i_sdom_j <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> <span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sdom_neq<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> i <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dominate <span class="free">i</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>dominate_refl<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> ass <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Semilat">
<div class="head">
<h1>Theory Semilat</h1>
</div>
<pre class="source">
<span class="comment1">(*  Title:      HOL/MicroJava/BV/Semilat.thy
    Author:     Tobias Nipkow
    Copyright   2000 TUM

Semilattices.
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Semilattices›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Semilat
<span class="keyword2"><span class="keyword">imports</span></span> <a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Main.html">Main</a> 
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Most definitions are lemmas in this theory are extracted from Jinja \cite{Semilat-AFP}, 
      'order r' is redefined to 'order r A', so related lemmas are also modified. ›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> ord    <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> binop  <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> sl     <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">×</span> <span class="tfree">'a</span> ord <span class="main">×</span> <span class="tfree">'a</span> binop"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">lesub</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> ord <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">lesub</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">⟷</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">lesssub</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> ord <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">lesssub</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">⟷</span> lesub <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">plussub</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'c</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'c</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">plussub</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>
                                       
<span class="keyword1"><span class="command">notation</span></span> <span class="main">(</span>ASCII<span class="main">)</span>
  <span class="quoted">"lesub"</span>  <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword3">/</span><span class="keyword1">&lt;='_</span>_ _<span class="keyword3">)</span>"</span> <span class="main">[</span>50<span class="main">,</span> 1000<span class="main">,</span> 51<span class="main">]</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="quoted">"lesssub"</span>  <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword3">/</span><span class="keyword1">&lt;'_</span>_ _<span class="keyword3">)</span>"</span> <span class="main">[</span>50<span class="main">,</span> 1000<span class="main">,</span> 51<span class="main">]</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="quoted">"plussub"</span>  <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword3">/</span><span class="keyword1">+'_</span>_ _<span class="keyword3">)</span>"</span> <span class="main">[</span>65<span class="main">,</span> 1000<span class="main">,</span> 66<span class="main">]</span> 65<span class="main">)</span>

<span class="keyword1"><span class="command">notation</span></span>
  <span class="quoted">"lesub"</span>  <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword3">/</span><span class="keyword1">⊑⇘</span>_<span class="keyword1">⇙</span> _<span class="keyword3">)</span>"</span> <span class="main">[</span>50<span class="main">,</span> 0<span class="main">,</span> 51<span class="main">]</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="quoted">"lesssub"</span>  <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword3">/</span><span class="keyword1">⊏⇘</span>_<span class="keyword1">⇙</span> _<span class="keyword3">)</span>"</span> <span class="main">[</span>50<span class="main">,</span> 0<span class="main">,</span> 51<span class="main">]</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="quoted">"plussub"</span>  <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword3">/</span><span class="keyword1">⊔⇘</span>_<span class="keyword1">⇙</span> _<span class="keyword3">)</span>"</span> <span class="main">[</span>65<span class="main">,</span> 0<span class="main">,</span> 66<span class="main">]</span> 65<span class="main">)</span>


<span class="comment1">(* allow \&lt;sub&gt; instead of \&lt;bsub&gt;..\&lt;esub&gt; *)</span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span>
  <span class="entity">lesub1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> ord <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword3">/</span><span class="keyword1">⊑⇩</span>_ _<span class="keyword3">)</span>"</span> <span class="main">[</span>50<span class="main">,</span> 1000<span class="main">,</span> 51<span class="main">]</span> 50<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main"><span class="free">⊑⇩</span></span><span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">==</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> ⊑<span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">r</span></span></span></sub><span class="hidden">⇙</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span>
  <span class="entity">lesssub1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> ord <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword3">/</span><span class="keyword1">⊏⇩</span>_ _<span class="keyword3">)</span>"</span> <span class="main">[</span>50<span class="main">,</span> 1000<span class="main">,</span> 51<span class="main">]</span> 50<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main"><span class="free">⊏⇩</span></span><span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">==</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> ⊏<span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">r</span></span></span></sub><span class="hidden">⇙</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span>
  <span class="entity">plussub1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'c</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'c</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword3">/</span><span class="keyword1">⊔⇩</span>_ _<span class="keyword3">)</span>"</span> <span class="main">[</span>65<span class="main">,</span> 1000<span class="main">,</span> 66<span class="main">]</span> 65<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main"><span class="free">⊔⇩</span></span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">==</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> ⊔<span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">f</span></span></span></sub><span class="hidden">⇙</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ord</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> set <span class="main">⇒</span> <span class="tfree">'a</span> ord"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ord</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">order</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ord <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">order</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span> <span class="bound">x</span> <span class="main">⊑⇩</span><span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span> <span class="bound">x</span> <span class="main">⊑⇩</span><span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="bound">y</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">⊑⇩</span><span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="bound">x</span> <span class="main">⟶</span> <span class="bound">x</span><span class="main">=</span><span class="bound">y</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span>  <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span> <span class="main">∀</span><span class="bound">z</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span> <span class="bound">x</span> <span class="main">⊑⇩</span><span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="bound">y</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">⊑⇩</span><span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="bound">z</span> <span class="main">⟶</span> <span class="bound">x</span> <span class="main">⊑⇩</span><span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="bound">z</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">top</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ord <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span>  bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">top</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span> <span class="bound">x</span> <span class="main">⊑⇩</span><span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">T</span></span></span><span class="main">)</span>"</span></span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">acc</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ord <span class="main">⇒</span>  bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">acc</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">⟷</span> wf <span class="main">{</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⊏⇩</span><span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="bound">y</span> <span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">closed</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> binop <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">closed</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span> <span class="bound">x</span> <span class="main">⊔⇩</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">y</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">semilat</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> sl <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">semilat</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">A</span><span class="main">,</span><span class="bound">r</span><span class="main">,</span><span class="bound">f</span><span class="main">)</span><span class="main">.</span> order <span class="bound">r</span> <span class="bound">A</span> <span class="main">∧</span> closed <span class="bound">A</span> <span class="bound">f</span> <span class="main">∧</span> 
                       <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="bound">A</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="bound">A</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⊑⇩</span><span class="bound">r</span> <span class="bound">x</span> <span class="main">⊔⇩</span><span class="bound">f</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∧</span>
                       <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="bound">A</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="bound">A</span><span class="main">.</span> <span class="bound">y</span> <span class="main">⊑⇩</span><span class="bound">r</span> <span class="bound">x</span> <span class="main">⊔⇩</span><span class="bound">f</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∧</span>
                       <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="bound">A</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="bound">A</span><span class="main">.</span> <span class="main">∀</span><span class="bound">z</span><span class="main">∈</span><span class="bound">A</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⊑⇩</span><span class="bound">r</span> <span class="bound">z</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">⊑⇩</span><span class="bound">r</span> <span class="bound">z</span> <span class="main">⟶</span> <span class="bound">x</span> <span class="main">⊔⇩</span><span class="bound">f</span> <span class="bound">y</span> <span class="main">⊑⇩</span><span class="bound">r</span> <span class="bound">z</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_ub</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> set <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">is_ub</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">)</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">)</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">r</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_lub</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> set <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">is_lub</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">⟷</span> is_ub <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">z</span><span class="main">.</span> is_ub <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="bound">z</span> <span class="main">⟶</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">,</span><span class="bound">z</span><span class="main">)</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">some_lub</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> set <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">some_lub</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">z</span><span class="main">.</span> is_lub <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="bound">z</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Semilat-closedD"><span class="command">lemma</span></span> closedD<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> closed <span class="free">A</span> <span class="free">f</span><span class="main">;</span> <span class="free">x</span><span class="main">∈</span><span class="free">A</span><span class="main">;</span> <span class="free">y</span><span class="main">∈</span><span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">⊔⇩</span><span class="free">f</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="comment1">(*&lt;*)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> closed_def<span class="main">)</span> <span class="operator">blast</span> <span class="comment1">(*&gt;*)</span>


<span class="keyword1" id="Semilat-order_trans"><span class="command">lemma</span></span> order_trans<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> order <span class="free">r</span> <span class="free">A</span><span class="main">;</span>  <span class="free">x</span> <span class="main">⊑⇩</span><span class="free">r</span> <span class="free">y</span><span class="main">;</span>  <span class="free">y</span> <span class="main">⊑⇩</span><span class="free">r</span> <span class="free">z</span> <span class="main">⟧</span> <span class="main">⟹</span>  <span class="free">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">z</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">⊑⇩</span><span class="free">r</span> <span class="free">z</span>"</span></span>
  <span class="comment1">(*&lt;*)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> order_def<span class="main">)</span> <span class="operator">blast</span> <span class="comment1">(*&gt;*)</span>

<span class="keyword1" id="Semilat-order_antisym"><span class="command">lemma</span></span> order_antisym<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> order <span class="free">r</span> <span class="free">A</span><span class="main">;</span> <span class="free">x</span> <span class="main">⊑⇩</span><span class="free">r</span> <span class="free">y</span><span class="main">;</span> <span class="free">y</span> <span class="main">⊑⇩</span><span class="free">r</span> <span class="free">x</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span>  <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="comment1">(*&lt;*)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> order_def<span class="main">)</span> <span class="main">(</span> <span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm_simp</span><span class="main"><span class="main">)</span></span><span class="main">)</span> <span class="comment1">(*&gt;*)</span>

<span class="keyword1" id="Semilat-order_refl"><span class="command">lemma</span></span> order_refl <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"order <span class="free">r</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span>  <span class="free">x</span> <span class="main">⊑⇩</span><span class="free">r</span> <span class="free">x</span>"</span></span>
  <span class="comment1">(*&lt;*)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> order_def<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm_simp</span><span class="main"><span class="main">)</span></span><span class="main">)</span> <span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">locale</span></span> Semilat <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">r</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ord"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> binop"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> semilat<span class="main">:</span> <span class="quoted"><span class="quoted">"semilat <span class="main">(</span><span class="free">A</span><span class="main">,</span> <span class="free">r</span><span class="main">,</span> <span class="free">f</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Semilat-semilat_Def"><span class="command">lemma</span></span> semilat_Def<span class="main">:</span>
<span class="quoted"><span class="quoted">"semilat<span class="main">(</span><span class="free">A</span><span class="main">,</span><span class="free">r</span><span class="main">,</span><span class="free">f</span><span class="main">)</span> <span class="main">⟷</span> order <span class="free">r</span> <span class="free">A</span> <span class="main">∧</span> closed <span class="free">A</span> <span class="free">f</span> <span class="main">∧</span> 
                 <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⊑⇩</span><span class="free">r</span> <span class="bound">x</span> <span class="main">⊔⇩</span><span class="free">f</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∧</span> 
                 <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="bound">y</span> <span class="main">⊑⇩</span><span class="free">r</span> <span class="bound">x</span> <span class="main">⊔⇩</span><span class="free">f</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∧</span> 
                 <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="main">∀</span><span class="bound">z</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⊑⇩</span><span class="free">r</span> <span class="bound">z</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">⊑⇩</span><span class="free">r</span> <span class="bound">z</span> <span class="main">⟶</span> <span class="bound">x</span> <span class="main">⊔⇩</span><span class="free">f</span> <span class="bound">y</span> <span class="main">⊑⇩</span><span class="free">r</span> <span class="bound">z</span><span class="main">)</span>"</span></span>
  <span class="comment1">(*&lt;*)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> semilat_def<span class="main">)</span> <span class="operator">clarsimp</span> <span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> Semilat<span class="main">)</span> orderI <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"order <span class="free">r</span> <span class="free">A</span>"</span></span>
  <span class="comment1">(*&lt;*)</span> <span class="keyword1"><span class="command">using</span></span> semilat <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> semilat_Def<span class="main">)</span> <span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> Semilat<span class="main">)</span> refl_r <span class="main">[</span><span class="operator">intro</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">⊑⇩</span><span class="free">r</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> Semilat<span class="main">)</span> antisym_r <span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main">?</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">x</span> <span class="main">⊑⇩</span><span class="free">r</span> <span class="free">y</span><span class="main">;</span> <span class="free">y</span> <span class="main">⊑⇩</span><span class="free">r</span> <span class="free">x</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span><span class="main">∈</span><span class="free">A</span> <span class="main">⟹</span><span class="free">y</span><span class="main">∈</span><span class="free">A</span> <span class="main">⟹</span><span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="comment1">(*&lt;*)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> order_antisym<span class="main">)</span> <span class="operator">auto</span> <span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> Semilat<span class="main">)</span> lub <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main"><span class="main"><span class="main">?</span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">x</span> <span class="main">⊑⇩</span><span class="free">r</span> <span class="free">z</span><span class="main">;</span> <span class="free">y</span> <span class="main">⊑⇩</span><span class="free">r</span> <span class="free">z</span><span class="main">;</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">;</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">A</span><span class="main">;</span> <span class="free">z</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">⊔⇩</span><span class="free">f</span> <span class="free">y</span> <span class="main">⊑⇩</span><span class="free">r</span> <span class="free">z</span>"</span></span>
  <span class="comment1">(*&lt;*)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> semilat<span class="main">)</span> <span class="main">(</span><span class="operator">unfold</span> semilat_Def<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span> <span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> Semilat<span class="main">)</span> ub2 <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main"><span class="main"><span class="main">?</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">;</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">⊑⇩</span><span class="free">r</span> <span class="free">x</span> <span class="main">⊔⇩</span><span class="free">f</span> <span class="free">y</span>"</span></span>
  <span class="comment1">(*&lt;*)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> semilat<span class="main">)</span> <span class="main">(</span><span class="operator">unfold</span> semilat_Def<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span> <span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> Semilat<span class="main">)</span> closedI <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"closed <span class="free">A</span> <span class="free">f</span>"</span></span>
  <span class="comment1">(*&lt;*)</span> <span class="keyword1"><span class="command">using</span></span> semilat <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> semilat_Def<span class="main">)</span> <span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> Semilat<span class="main">)</span> closed_f <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">;</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">A</span><span class="main">⟧</span>  <span class="main">⟹</span> <span class="free">x</span> <span class="main">⊔⇩</span><span class="free">f</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="comment1">(*&lt;*)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> closedD <span class="main"><span class="main">[</span></span><span class="operator">OF</span> closedI<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="comment1">(*&gt;*)</span>  
  
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> Semilat<span class="main">)</span> ub1 <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main"><span class="main"><span class="main">?</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">;</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">⊑⇩</span><span class="free">r</span> <span class="free">x</span> <span class="main">⊔⇩</span><span class="free">f</span> <span class="free">y</span>"</span></span>
  <span class="comment1">(*&lt;*)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> semilat<span class="main">)</span> <span class="main">(</span><span class="operator">unfold</span> semilat_Def<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span> <span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> Semilat<span class="main">)</span> le_iff_plus_unchanged<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊑⇩</span><span class="free">r</span> <span class="free">y</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">⊔⇩</span><span class="free">f</span> <span class="free">y</span> <span class="main">=</span> <span class="free">y</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">⟷</span> <span class="var">?Q</span>"</span></span><span class="main">)</span>
<span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?Q</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> antisym_r lub ub2<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?Q</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="free">x</span> ⊔<span class="hidden">⇘</span><sub><span class="free">f</span></sub><span class="hidden">⇙</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> ⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span> <span class="free">x</span> ⊔<span class="hidden">⇘</span><sub><span class="free">f</span></sub><span class="hidden">⇙</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> Semilat<span class="main">)</span> plus_le_conv <span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">;</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">A</span><span class="main">;</span> <span class="free">z</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊔⇩</span><span class="free">f</span> <span class="free">y</span> <span class="main">⊑⇩</span><span class="free">r</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊑⇩</span><span class="free">r</span> <span class="free">z</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">⊑⇩</span><span class="free">r</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="comment1">(*&lt;*)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> ub1 ub2 lub order_trans<span class="main">)</span> <span class="comment1">(*&gt;*)</span>


<span class="keyword2"><span class="keyword">end</span></span>

</pre>
</div><div id="Sorted_Less2">
<div class="head">
<h1>Theory Sorted_Less2</h1>
</div>
<pre class="source"><span class="comment1">(* Author: Nan Jiang *)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹More auxiliary lemmas for Lists Sorted wrt $&lt;$›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Sorted_Less2
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Main.html">Main</a> <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Data_Structures/Cmp.html">HOL-Data_Structures.Cmp</a>"</span> <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Data_Structures/Sorted_Less.html">HOL-Data_Structures.Sorted_Less</a>"</span> 
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Sorted_Less2-Cons_sorted_less"><span class="command">lemma</span></span> Cons_sorted_less<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>rev <span class="free">xs</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="free">xs</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">p</span> <span class="main">⟹</span>   sorted <span class="main">(</span>rev <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>sorted_wrt_append<span class="main">)</span>

<span class="keyword1" id="Sorted_Less2-Cons_sorted_less_nth"><span class="command">lemma</span></span> Cons_sorted_less_nth<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">&lt;</span>length <span class="free">xs</span><span class="main">.</span> <span class="free">xs</span> <span class="main">!</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">p</span> <span class="main">⟹</span> sorted <span class="main">(</span>rev <span class="free">xs</span><span class="main">)</span> <span class="main">⟹</span> sorted <span class="main">(</span>rev <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="free">xs</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">p</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>Cons_sorted_less<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_conv_nth<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Sorted_Less2-distinct_sorted_rev"><span class="command">lemma</span></span> distinct_sorted_rev<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>rev <span class="free">xs</span><span class="main">)</span> <span class="main">⟹</span> distinct <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>sorted_wrt_append<span class="main">)</span>

<span class="keyword1" id="Sorted_Less2-sorted_le2lt"><span class="command">lemma</span></span> sorted_le2lt<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"List.sorted <span class="free">xs</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"distinct <span class="free">xs</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sorted <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">note</span></span> ind_hyp_xs <span class="main">=</span> Cons<span class="main">(</span>1<span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> sorted_le_x_xs <span class="main">=</span> Cons<span class="main">(</span>2<span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> dist_x_xs <span class="main">=</span> Cons<span class="main">(</span>3<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> dist_x_xs <span class="keyword1"><span class="command">have</span></span> x_neq_xs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v</span> <span class="main">∈</span> set <span class="skolem">xs</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="bound">v</span>"</span></span> 
                  <span class="keyword2"><span class="keyword">and</span></span>     dist<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> sorted_le_x_xs <span class="keyword1"><span class="command">have</span></span> sorted_le_xs<span class="main">:</span> <span class="quoted"><span class="quoted">"List.sorted <span class="skolem">xs</span>"</span></span> 
                       <span class="keyword2"><span class="keyword">and</span></span>      x_le_xs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v</span> <span class="main">∈</span> set <span class="skolem">xs</span><span class="main">.</span> <span class="bound">v</span> <span class="main">≥</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> x_neq_xs x_le_xs <span class="keyword1"><span class="command">have</span></span> x_lt_xs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v</span> <span class="main">∈</span> set <span class="skolem">xs</span><span class="main">.</span> <span class="bound">v</span> <span class="main">&gt;</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>  
  <span class="keyword1"><span class="command">from</span></span> ind_hyp_xs<span class="main">[</span><span class="operator">OF</span> sorted_le_xs dist<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sorted <span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> x_lt_xs <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Sorted_Less2-sorted_less_sorted_list_of_set"><span class="command">lemma</span></span> sorted_less_sorted_list_of_set<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>sorted_list_of_set <span class="free">S</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>sorted_le2lt<span class="main">)</span>

<span class="keyword1" id="Sorted_Less2-distinct_sorted"><span class="command">lemma</span></span> distinct_sorted<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="free">xs</span> <span class="main">⟹</span> distinct <span class="free">xs</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sorted_wrt_append sorted_sorted_wrt<span class="main">)</span>  

<span class="keyword1" id="Sorted_Less2-sorted_less_set_unique"><span class="command">lemma</span></span> sorted_less_set_unique<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sorted <span class="free">xs</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"sorted <span class="free">ys</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"set <span class="free">xs</span> <span class="main">=</span> set <span class="free">ys</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">=</span> <span class="free">ys</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"distinct <span class="free">xs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"List.sorted <span class="free">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"distinct <span class="free">ys</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"List.sorted <span class="free">ys</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ys</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">=</span> <span class="free">ys</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> sorted_distinct_set_unique<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Sorted_Less2-sorted_less_rev_set_unique"><span class="command">lemma</span></span> sorted_less_rev_set_unique<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>rev <span class="free">xs</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>rev <span class="free">ys</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"set <span class="free">xs</span> <span class="main">=</span> set <span class="free">ys</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">=</span> <span class="free">ys</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms sorted_less_set_unique<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"rev <span class="free">xs</span>"</span></span> <span class="quoted"><span class="quoted">"rev <span class="free">ys</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Sorted_Less2-sorted_less_set_eq"><span class="command">lemma</span></span> sorted_less_set_eq<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sorted <span class="free">xs</span> "</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">=</span> sorted_list_of_set <span class="main">(</span>set <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>sorted_list_of_set <span class="main">(</span>set <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> sorted_less_set_unique sorted_le2lt<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Sorted_Less2-sorted_less_rev_set_eq"><span class="command">lemma</span></span> sorted_less_rev_set_eq<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>rev <span class="free">xs</span><span class="main">)</span> "</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sorted_list_of_set <span class="main">(</span>set <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> rev <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms sorted_less_set_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"rev <span class="free">xs</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Sorted_List_Operations2">
<div class="head">
<h1>Theory Sorted_List_Operations2</h1>
</div>
<pre class="source">
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Operations on sorted lists›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Sorted_List_Operations2
<span class="keyword2"><span class="keyword">imports</span></span> <a href="#Sorted_Less2">Sorted_Less2</a>
<span class="keyword2"><span class="keyword">begin</span></span> 

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The definition and the inter\_sorted\_correct lemma in this theory are the same as those
     in Collections \cite{OpsOnSortedLists-AFP}. 
     except the former is for a descending list while the latter is for an ascending one.›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">inter_sorted_rev</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>linorder<span class="main">}</span> list <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
   <span class="quoted"><span class="quoted">"<span class="free">inter_sorted_rev</span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">l2</span></span></span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
 <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">inter_sorted_rev</span> <span class="free"><span class="bound"><span class="entity">l1</span></span></span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
 <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">inter_sorted_rev</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x1</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">l1</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x2</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">l2</span></span></span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x1</span></span></span> <span class="main">&gt;</span> <span class="free"><span class="bound"><span class="entity">x2</span></span></span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">(</span><span class="free">inter_sorted_rev</span> <span class="free"><span class="bound"><span class="entity">l1</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x2</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">l2</span></span></span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> 
      <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x1</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x2</span></span></span><span class="main">)</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">x1</span></span></span> <span class="main">#</span> <span class="main">(</span><span class="free">inter_sorted_rev</span> <span class="free"><span class="bound"><span class="entity">l1</span></span></span> <span class="free"><span class="bound"><span class="entity">l2</span></span></span><span class="main">)</span> <span class="keyword1">else</span> <span class="free">inter_sorted_rev</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x1</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">l1</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">l2</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Sorted_List_Operations2-inter_sorted_correct"><span class="command">lemma</span></span> inter_sorted_correct <span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> l1_OK<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>rev <span class="free">l1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> l2_OK<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>rev <span class="free">l2</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>rev <span class="main">(</span>inter_sorted_rev <span class="free">l1</span> <span class="free">l2</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> set <span class="main">(</span>inter_sorted_rev <span class="free">l1</span> <span class="free">l2</span><span class="main">)</span> <span class="main">=</span> set <span class="free">l1</span> <span class="main">∩</span> set <span class="free">l2</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">l1</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">l2</span></span><span class="main">)</span> 
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x1</span> <span class="skolem">l1</span> <span class="skolem">l2</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">note</span></span> x1_l1_props <span class="main">=</span> Cons<span class="main">(</span>2<span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> l2_props <span class="main">=</span> Cons<span class="main">(</span>3<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> x1_l1_props <span class="keyword1"><span class="command">have</span></span> l1_props<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>rev <span class="skolem">l1</span><span class="main">)</span>"</span></span>
                    <span class="keyword2"><span class="keyword">and</span></span> x1_nin_l1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span> <span class="main">∉</span> set <span class="skolem">l1</span>"</span></span>
                    <span class="keyword2"><span class="keyword">and</span></span> x1_gt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="skolem">l1</span> <span class="main">⟹</span> <span class="skolem">x1</span> <span class="main">&gt;</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ball_def sorted_wrt_append<span class="main">)</span>

  <span class="keyword1"><span class="command">note</span></span> ind_hyp_l1 <span class="main">=</span> Cons<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> l1_props<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> l2_props 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">l2</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword1"><span class="command">with</span></span> x1_l1_props <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x2</span> <span class="skolem">l2</span><span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> x2_l2_props <span class="main">=</span> Cons<span class="main">(</span>2<span class="main">)</span>  <span class="comment1">(* sorted (rev (x2 # l2))*)</span>
    <span class="keyword1"><span class="command">from</span></span> x2_l2_props <span class="keyword1"><span class="command">have</span></span> l2_props<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>rev <span class="skolem">l2</span><span class="main">)</span>"</span></span>
                    <span class="keyword2"><span class="keyword">and</span></span> x2_nin_l2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x2</span> <span class="main">∉</span> set <span class="skolem">l2</span>"</span></span>
                    <span class="keyword2"><span class="keyword">and</span></span> x2_gt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="skolem">l2</span> <span class="main">⟹</span> <span class="skolem">x2</span> <span class="main">&gt;</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span>  <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ball_def sorted_wrt_append <span class="main">)</span>

    <span class="keyword1"><span class="command">note</span></span> ind_hyp_l2 <span class="main">=</span> Cons<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> l2_props<span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span> <span class="main">&gt;</span> <span class="skolem">x2</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">note</span></span> x1_gt_x2 <span class="main">=</span> this
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">l1</span> <span class="main">∩</span> set <span class="main">(</span><span class="skolem">x2</span> <span class="main">#</span> <span class="skolem">l2</span><span class="main">)</span> <span class="main">=</span> set <span class="main">(</span><span class="skolem">x1</span> <span class="main">#</span> <span class="skolem">l1</span><span class="main">)</span><span class="main">∩</span> set <span class="main">(</span><span class="skolem">x2</span> <span class="main">#</span> <span class="skolem">l2</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> x1_gt_x2 x1_nin_l1 x2_nin_l2 x1_gt x2_gt 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> ind_hyp_l1<span class="main">[</span><span class="operator">OF</span> x2_l2_props<span class="main">]</span>  <span class="keyword1"><span class="command">using</span></span> x1_gt_x2 x1_nin_l1 x2_nin_l2 x1_gt x2_gt 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Ball_def sorted_wrt_append<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">note</span></span> x2_ge_x1 <span class="main">=</span> this      
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span> <span class="main">=</span> <span class="skolem">x2</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">note</span></span> x1_eq_x2 <span class="main">=</span> this        
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> ind_hyp_l1<span class="main">[</span><span class="operator">OF</span> l2_props<span class="main">]</span>  
          <span class="keyword1"><span class="command">using</span></span> x1_eq_x2  x1_nin_l1 x2_nin_l2 x1_gt x2_gt <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Ball_def sorted_wrt_append<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">note</span></span> x1_neq_x2 <span class="main">=</span> this
        <span class="keyword1"><span class="command">with</span></span> x2_ge_x1 <span class="keyword1"><span class="command">have</span></span> x2_gt_x1 <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x2</span> <span class="main">&gt;</span> <span class="skolem">x1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> ind_hyp_l2 x2_ge_x1 x1_neq_x2 x2_gt x2_nin_l2 x1_gt 
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>         
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Sorted_List_Operations2-inter_sorted_rev_refl"><span class="command">lemma</span></span> inter_sorted_rev_refl<span class="main">:</span> <span class="quoted"><span class="quoted">"inter_sorted_rev <span class="free">xs</span> <span class="free">xs</span> <span class="main">=</span> <span class="free">xs</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Sorted_List_Operations2-inter_sorted_correct_col"><span class="command">lemma</span></span>  inter_sorted_correct_col<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>rev <span class="free">xs</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>rev <span class="free">ys</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>inter_sorted_rev <span class="free">xs</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> rev <span class="main">(</span>sorted_list_of_set <span class="main">(</span>set <span class="free">xs</span> <span class="main">∩</span> set <span class="free">ys</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>rev <span class="main">(</span>inter_sorted_rev <span class="free">xs</span> <span class="free">ys</span><span class="main">)</span><span class="main">)</span> "</span></span> 
              <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>inter_sorted_rev <span class="free">xs</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> set <span class="free">xs</span> <span class="main">∩</span> set <span class="free">ys</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> inter_sorted_correct <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>rev <span class="main">(</span>rev <span class="main">(</span>sorted_list_of_set <span class="main">(</span>set <span class="free">xs</span> <span class="main">∩</span> set <span class="free">ys</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>sorted_less_sorted_list_of_set<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> 1 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>sorted_less_rev_set_unique<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Sorted_List_Operations2-cons_set_eq"><span class="command">lemma</span></span> cons_set_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span> <span class="main">∩</span> set <span class="free">xs</span> <span class="main">=</span> set <span class="free">xs</span>"</span></span>  
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Sorted_List_Operations2-inter_sorted_cons"><span class="command">lemma</span></span> inter_sorted_cons<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>rev <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> inter_sorted_rev <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span> <span class="free">xs</span> <span class="main">=</span> <span class="free">xs</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> ass<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>rev <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> sorted_xs<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>rev <span class="free">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>sorted_wrt_append<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> ass <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inter_sorted_rev <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span> <span class="free">xs</span> <span class="main">=</span> rev <span class="main">(</span>sorted_list_of_set <span class="main">(</span>set <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span> <span class="main">∩</span> set <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>inter_sorted_correct_col<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inter_sorted_rev <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span> <span class="free">xs</span> <span class="main">=</span> rev <span class="main">(</span>rev <span class="free">xs</span><span class="main">)</span>"</span></span><span class="keyword1"><span class="command">using</span></span>  sorted_xs <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span>cons_set_eq sorted_less_rev_set_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> sorted_xs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Dom_Semi_List">
<div class="head">
<h1>Theory Dom_Semi_List</h1>
</div>
<pre class="source"><span class="comment1">(* Author: Nan Jiang *)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹A semilattice of reversed-ordered list›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Dom_Semi_List
<span class="keyword2"><span class="keyword">imports</span></span> <a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Main.html">Main</a> <a href="#Semilat">Semilat</a> <a href="#Sorted_List_Operations2">Sorted_List_Operations2</a> <a href="#Sorted_Less2">Sorted_Less2</a> <a href="#Cfg">Cfg</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> node <span class="main">=</span> <span class="quoted">nat</span>

<span class="keyword1"><span class="command">context</span></span> cfg_doms
<span class="keyword2"><span class="keyword">begin</span></span> 

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">nodes</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat list"</span></span> 
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">nodes</span> <span class="main">≡</span> <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">nodes_le</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"node list <span class="main">⇒</span> node list <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">nodes_le</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">≡</span> <span class="main">(</span>sorted <span class="main">(</span>rev <span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">)</span> <span class="main">∧</span> sorted <span class="main">(</span>rev <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>set <span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>set <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">nodes_sup</span> <span class="main">::</span><span class="quoted"><span class="quoted">"node list  <span class="main">⇒</span> node list   <span class="main">⇒</span>node list "</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">nodes_sup</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> inter_sorted_rev <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">nodes_semi</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"node list sl"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">nodes_semi</span>  <span class="main">≡</span> <span class="main">(</span><span class="main">(</span>rev <span class="main">∘</span> sorted_list_of_set<span class="main">)</span> <span class="main">`</span> <span class="main">(</span>Pow <span class="main">(</span>set <span class="main">(</span>nodes<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> nodes_le<span class="main">,</span> nodes_sup <span class="main">)</span>"</span></span>

<span class="keyword1" id="Dom_Semi_List-subset_nodes_inpow"><span class="command">lemma</span></span> subset_nodes_inpow<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>rev <span class="free">xs</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"set <span class="free">xs</span> <span class="main">⊆</span> set nodes"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">∈</span> <span class="main">(</span>rev <span class="main">∘</span> sorted_list_of_set<span class="main">)</span> <span class="main">`</span> <span class="main">(</span>Pow <span class="main">(</span>set nodes<span class="main">)</span><span class="main">)</span>"</span></span>   
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sorted_list_of_set <span class="main">(</span>set <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> rev <span class="free">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>sorted_less_rev_set_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rev <span class="main">(</span>rev <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> rev <span class="main">(</span>sorted_list_of_set <span class="main">(</span>set <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Dom_Semi_List-nil_in_A"><span class="command">lemma</span></span> nil_in_A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[]</span> <span class="main">∈</span> <span class="main">(</span>rev <span class="main">∘</span> sorted_list_of_set<span class="main">)</span> <span class="main">`</span> <span class="main">(</span>Pow <span class="main">(</span>set nodes<span class="main">)</span><span class="main">)</span>"</span></span>  
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Pow_def image_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sorted_list_of_set <span class="main">{}</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">x</span></span><span class="main">⊆</span>set nodes<span class="main">.</span> sorted_list_of_set <span class="bound">x</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Dom_Semi_List-single_n_in_A"><span class="command">lemma</span></span> single_n_in_A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">&lt;</span> length nodes <span class="main">⟹</span> <span class="main">[</span><span class="free">p</span><span class="main">]</span> <span class="main">∈</span> <span class="main">(</span>rev <span class="main">∘</span> sorted_list_of_set<span class="main">)</span> <span class="main">`</span> <span class="main">(</span>Pow <span class="main">(</span>set nodes<span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> nodes_def<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>rev <span class="main">∘</span> sorted_list_of_set<span class="main">)</span> <span class="main">`</span> <span class="main">(</span>Pow <span class="main">(</span>set <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">&lt;</span> length <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span>"</span></span>  
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">p</span><span class="main">}</span> <span class="main">∈</span> Pow <span class="main">(</span>set <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Pow_def verts_set<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">p</span><span class="main">]</span> <span class="main">∈</span><span class="var">?S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> image_def<span class="main">)</span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">p</span><span class="main">]</span> <span class="main">∈</span> <span class="var">?S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
    
<span class="keyword1" id="Dom_Semi_List-inpow_subset_nodes"><span class="command">lemma</span></span> inpow_subset_nodes<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">∈</span> <span class="main">(</span>rev <span class="main">∘</span> sorted_list_of_set<span class="main">)</span> <span class="main">`</span> <span class="main">(</span>Pow <span class="main">(</span>set nodes<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set <span class="free">xs</span> <span class="main">⊆</span> set nodes"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> Pow <span class="main">(</span>set nodes<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">=</span> <span class="main">(</span>rev <span class="main">∘</span> sorted_list_of_set<span class="main">)</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">xs</span> <span class="main">=</span> set <span class="main">(</span>sorted_list_of_set <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> Pow <span class="main">(</span>set nodes<span class="main">)</span><span class="main">.</span> finite <span class="bound">x</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rev_finite_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> x eq <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set <span class="free">xs</span> <span class="main">⊆</span> set nodes"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Dom_Semi_List-inter_in_pow_nodes"><span class="command">lemma</span></span> inter_in_pow_nodes<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">∈</span> <span class="main">(</span>rev <span class="main">∘</span> sorted_list_of_set<span class="main">)</span> <span class="main">`</span> <span class="main">(</span>Pow <span class="main">(</span>set nodes<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>rev <span class="main">∘</span> sorted_list_of_set<span class="main">)</span><span class="main">(</span>set <span class="free">xs</span> <span class="main">∩</span> set <span class="free">ys</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>rev <span class="main">∘</span> <span class="main">(</span>sorted_list_of_set<span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span>Pow <span class="main">(</span>set nodes<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>  
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?res</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"set <span class="free">xs</span> <span class="main">∩</span> set <span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="free">xs</span> <span class="main">⊆</span> set nodes"</span></span> <span class="keyword1"><span class="command">using</span></span> inpow_subset_nodes <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?res</span> <span class="main">⊆</span> set nodes"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> subset_nodes_inpow <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
  

<span class="keyword1" id="Dom_Semi_List-nodes_le_order"><span class="command">lemma</span></span> nodes_le_order<span class="main">:</span> <span class="quoted"><span class="quoted">"order nodes_le <span class="main">(</span><span class="main">(</span>rev <span class="main">∘</span> sorted_list_of_set<span class="main">)</span> <span class="main">`</span> <span class="main">(</span>Pow <span class="main">(</span>set nodes<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>rev <span class="main">∘</span> sorted_list_of_set<span class="main">)</span> <span class="main">`</span> <span class="main">(</span>Pow <span class="main">(</span>set nodes<span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="var">?A</span><span class="main">.</span> sorted <span class="main">(</span>rev <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> sorted_less_sorted_list_of_set<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="var">?A</span><span class="main">.</span> nodes_le <span class="bound">x</span> <span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>nodes_le_def<span class="main">)</span> 

  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="var">?A</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="var">?A</span><span class="main">.</span> <span class="main">(</span>nodes_le <span class="bound">x</span> <span class="bound">y</span> <span class="main">∧</span> nodes_le <span class="bound">y</span> <span class="bound">x</span> <span class="main">⟶</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> strip<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>   
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="var">?A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"nodes_le <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">∧</span> nodes_le <span class="skolem">y</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>rev <span class="skolem">x</span><span class="main">)</span> <span class="main">∧</span> sorted <span class="main">(</span>rev <span class="main">(</span><span class="skolem">y</span><span class="main">::</span>nat list<span class="main">)</span><span class="main">)</span> <span class="main">∧</span>  set <span class="skolem">x</span> <span class="main">=</span> set <span class="skolem">y</span> <span class="main">∨</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nodes_le_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>subset_antisym sorted_less_sorted_list_of_set<span class="main">)</span>
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> sorted_less_rev_set_unique<span class="main">)</span>     
 <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span> <span class="var">?A</span><span class="main">.</span>   <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span> <span class="var">?A</span><span class="main">.</span> <span class="main">∀</span><span class="bound">z</span><span class="main">∈</span> <span class="var">?A</span> <span class="main">.</span> nodes_le <span class="bound">x</span> <span class="bound">y</span> <span class="main">∧</span> nodes_le <span class="bound">y</span>  <span class="bound">z</span> <span class="main">⟶</span> nodes_le <span class="bound">x</span> <span class="bound">z</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nodes_le_def<span class="main">)</span> 

  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> order_def lesub_def lesssub_def<span class="main">)</span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Dom_Semi_List-nodes_semi_auxi"><span class="command">lemma</span></span> nodes_semi_auxi<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="keyword1">let</span> <span class="bound">A</span> <span class="main">=</span> <span class="main">(</span>rev <span class="main">∘</span> sorted_list_of_set<span class="main">)</span> <span class="main">`</span> <span class="main">(</span>Pow <span class="main">(</span>set <span class="main">(</span>nodes<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
       <span class="bound">r</span> <span class="main">=</span> nodes_le<span class="main">;</span>
       <span class="bound">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span>  <span class="main">(</span>inter_sorted_rev <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>
    <span class="keyword1">in</span> semilat<span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">r</span><span class="main">,</span> <span class="bound">f</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>rev <span class="main">∘</span> sorted_list_of_set<span class="main">)</span> <span class="main">`</span> <span class="main">(</span>Pow <span class="main">(</span>set <span class="main">(</span>nodes<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"nodes_le"</span></span> 
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">(</span>inter_sorted_rev <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"order <span class="var">?r</span> <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nodes_le_order<span class="main">)</span>

  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"closed <span class="var">?A</span> <span class="var">?f</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> closed_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> strip<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span> <span class="skolem">ys</span> <span class="keyword3"><span class="command">assume</span></span> xs_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">∈</span> <span class="var">?A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ys_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">∈</span> <span class="var">?A</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> sorted_xs<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>rev <span class="skolem">xs</span><span class="main">)</span>"</span></span> 
          <span class="keyword2"><span class="keyword">and</span></span> sorted_ys<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>rev <span class="skolem">ys</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> sorted_less_sorted_list_of_set<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> inter_xs_ys<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="var">?f</span> <span class="skolem">xs</span> <span class="skolem">ys</span><span class="main">)</span> <span class="main">=</span> set <span class="skolem">xs</span> <span class="main">∩</span> set <span class="skolem">ys</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
              sorted_res<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>rev <span class="main">(</span><span class="var">?f</span> <span class="skolem">xs</span> <span class="skolem">ys</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> inter_sorted_correct <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">from</span></span> xs_in <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">xs</span> <span class="main">⊆</span> set nodes"</span></span> <span class="keyword1"><span class="command">using</span></span> inpow_subset_nodes <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> inter_xs_ys <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="var">?f</span> <span class="skolem">xs</span> <span class="skolem">ys</span><span class="main">)</span> <span class="main">⊆</span> set nodes"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> sorted_res <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> ⊔<span class="hidden">⇘</span><sub><span class="var">?f</span></sub><span class="hidden">⇙</span> <span class="skolem">ys</span><span class="main">∈</span> <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> subset_nodes_inpow <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>plussub_def<span class="main">)</span>   
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="var">?A</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="var">?A</span><span class="main">.</span> <span class="bound">x</span> ⊑<span class="hidden">⇘</span><sub><span class="var">?r</span></sub><span class="hidden">⇙</span> <span class="bound">x</span> ⊔<span class="hidden">⇘</span><sub><span class="var">?f</span></sub><span class="hidden">⇙</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="var">?A</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="var">?A</span><span class="main">.</span> <span class="bound">y</span> ⊑<span class="hidden">⇘</span><sub><span class="var">?r</span></sub><span class="hidden">⇙</span> <span class="bound">x</span> ⊔<span class="hidden">⇘</span><sub><span class="var">?f</span></sub><span class="hidden">⇙</span> <span class="bound">y</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> strip<span class="main">)</span>   
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span> <span class="skolem">ys</span> 
    <span class="keyword3"><span class="command">assume</span></span> xs_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">∈</span> <span class="var">?A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ys_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">∈</span> <span class="var">?A</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> sorted_xs<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>rev <span class="skolem">xs</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> sorted_ys<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>rev <span class="skolem">ys</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> sorted_less_sorted_list_of_set<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="var">?f</span> <span class="skolem">xs</span> <span class="skolem">ys</span><span class="main">)</span> <span class="main">⊆</span> set <span class="skolem">xs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> sorted_f_xs_ys<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>rev <span class="main">(</span><span class="var">?f</span> <span class="skolem">xs</span> <span class="skolem">ys</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inter_sorted_correct<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> ⊑<span class="hidden">⇘</span><sub><span class="var">?r</span></sub><span class="hidden">⇙</span> <span class="skolem">xs</span> ⊔<span class="hidden">⇘</span><sub><span class="var">?f</span></sub><span class="hidden">⇙</span> <span class="skolem">ys</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lesub_def sorted_xs sorted_ys sorted_f_xs_ys nodes_le_def plussub_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="var">?A</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="var">?A</span><span class="main">.</span> <span class="bound">y</span> ⊑<span class="hidden">⇘</span><sub><span class="var">?r</span></sub><span class="hidden">⇙</span> <span class="bound">x</span> ⊔<span class="hidden">⇘</span><sub><span class="var">?f</span></sub><span class="hidden">⇙</span> <span class="bound">y</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> strip<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span> <span class="skolem">ys</span> 
      <span class="keyword3"><span class="command">assume</span></span> xs_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">∈</span> <span class="var">?A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ys_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">∈</span> <span class="var">?A</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> sorted_xs<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>rev <span class="skolem">xs</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> sorted_ys<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>rev <span class="skolem">ys</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> sorted_less_sorted_list_of_set<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="var">?f</span> <span class="skolem">xs</span> <span class="skolem">ys</span><span class="main">)</span> <span class="main">⊆</span> set <span class="skolem">ys</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> sorted_f_xs_ys<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>rev <span class="main">(</span><span class="var">?f</span> <span class="skolem">xs</span> <span class="skolem">ys</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inter_sorted_correct<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> ⊑<span class="hidden">⇘</span><sub><span class="var">?r</span></sub><span class="hidden">⇙</span> <span class="skolem">xs</span> ⊔<span class="hidden">⇘</span><sub><span class="var">?f</span></sub><span class="hidden">⇙</span> <span class="skolem">ys</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lesub_def sorted_ys sorted_xs sorted_f_xs_ys nodes_le_def plussub_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="var">?A</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="var">?A</span><span class="main">.</span> <span class="main">∀</span><span class="bound">z</span><span class="main">∈</span><span class="var">?A</span><span class="main">.</span> <span class="bound">x</span> ⊑<span class="hidden">⇘</span><sub><span class="var">?r</span></sub><span class="hidden">⇙</span> <span class="bound">z</span> <span class="main">∧</span> <span class="bound">y</span>  ⊑<span class="hidden">⇘</span><sub><span class="var">?r</span></sub><span class="hidden">⇙</span> <span class="bound">z</span> <span class="main">⟶</span> <span class="bound">x</span> ⊔<span class="hidden">⇘</span><sub><span class="var">?f</span></sub><span class="hidden">⇙</span> <span class="bound">y</span> ⊑<span class="hidden">⇘</span><sub><span class="var">?r</span></sub><span class="hidden">⇙</span><span class="bound">z</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> strip<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span> <span class="skolem">ys</span> <span class="skolem">zs</span>
    <span class="keyword3"><span class="command">assume</span></span> xin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">∈</span> <span class="var">?A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> yin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> <span class="main">∈</span> <span class="var">?A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> zin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">zs</span> <span class="main">∈</span> <span class="var">?A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> ⊑<span class="hidden">⇘</span><sub><span class="var">?r</span></sub><span class="hidden">⇙</span> <span class="skolem">zs</span> <span class="main">∧</span> <span class="skolem">ys</span> ⊑<span class="hidden">⇘</span><sub><span class="var">?r</span></sub><span class="hidden">⇙</span> <span class="skolem">zs</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> xs_zs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> ⊑<span class="hidden">⇘</span><sub><span class="var">?r</span></sub><span class="hidden">⇙</span> <span class="skolem">zs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ys_zs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ys</span> ⊑<span class="hidden">⇘</span><sub><span class="var">?r</span></sub><span class="hidden">⇙</span> <span class="skolem">zs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> sorted_xs<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>rev <span class="skolem">xs</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> sorted_ys<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>rev <span class="skolem">ys</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sorted_less_sorted_list_of_set<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> inter_xs_ys<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="var">?f</span> <span class="skolem">xs</span> <span class="skolem">ys</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>set <span class="skolem">xs</span> <span class="main">∩</span> set <span class="skolem">ys</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> sorted_f_xs_ys<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>rev <span class="main">(</span><span class="var">?f</span> <span class="skolem">xs</span> <span class="skolem">ys</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inter_sorted_correct<span class="main">)</span>

    <span class="keyword1"><span class="command">from</span></span> xs_zs ys_zs sorted_xs <span class="keyword1"><span class="command">have</span></span> sorted_zs<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>rev <span class="skolem">zs</span><span class="main">)</span>"</span></span>
                                <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">zs</span> <span class="main">⊆</span> set <span class="skolem">xs</span>"</span></span>
                                <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">zs</span> <span class="main">⊆</span> set <span class="skolem">ys</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lesub_def nodes_le_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> zs<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">zs</span> <span class="main">⊆</span> set <span class="skolem">xs</span> <span class="main">∩</span> set <span class="skolem">ys</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> inter_xs_ys sorted_zs sorted_f_xs_ys <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> ⊔<span class="hidden">⇘</span><sub><span class="var">?f</span></sub><span class="hidden">⇙</span> <span class="skolem">ys</span> ⊑<span class="hidden">⇘</span><sub><span class="var">?r</span></sub><span class="hidden">⇙</span> <span class="skolem">zs</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>plussub_def lesub_def  sorted_xs sorted_ys sorted_f_xs_ys sorted_zs nodes_le_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> semilat_def<span class="main">)</span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Dom_Semi_List-nodes_semi_is_semilat"><span class="command">lemma</span></span> nodes_semi_is_semilat<span class="main">:</span> <span class="quoted"><span class="quoted">"semilat <span class="main">(</span>nodes_semi<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> nodes_semi_auxi 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nodes_sup_def nodes_semi_def<span class="main">)</span>

<span class="keyword1" id="Dom_Semi_List-sorted_rev_subset_len_lt"><span class="command">lemma</span></span> sorted_rev_subset_len_lt<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>rev <span class="free">a</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>rev <span class="free">b</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"set <span class="free">a</span> <span class="main">⊂</span> set <span class="free">b</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length <span class="free">a</span> <span class="main">&lt;</span> length <span class="free">b</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> dist_a<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> dist_b<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> distinct_sorted_rev<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span>  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>set <span class="free">a</span><span class="main">)</span> <span class="main">&lt;</span> card <span class="main">(</span>set <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> psubset_card_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> dist_a dist_b <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distinct_card<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Dom_Semi_List-wf_nodes_le_auxi"><span class="command">lemma</span></span> wf_nodes_le_auxi<span class="main">:</span> <span class="quoted"><span class="quoted">"wf <span class="main">{</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>sorted <span class="main">(</span>rev <span class="bound">y</span><span class="main">)</span> <span class="main">∧</span> sorted <span class="main">(</span>rev <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> set <span class="bound">y</span> <span class="main">⊂</span> set <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≠</span> <span class="bound">y</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> wf_measure <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> wf_subset<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> measure_def inv_image_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> sorted_rev_subset_len_lt<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>sorted_less_rev_set_unique<span class="main">)</span>

<span class="keyword1" id="Dom_Semi_List-wf_nodes_le_auxi2"><span class="command">lemma</span></span> wf_nodes_le_auxi2<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"wf <span class="main">{</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span> sorted <span class="main">(</span>rev <span class="bound">y</span><span class="main">)</span> <span class="main">∧</span> sorted <span class="main">(</span>rev <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> set <span class="bound">y</span> <span class="main">⊂</span> set <span class="bound">x</span> <span class="main">∧</span> rev <span class="bound">x</span> <span class="main">≠</span> rev <span class="bound">y</span><span class="main">}</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> wf_nodes_le_auxi <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
<span class="keyword1" id="Dom_Semi_List-wf_nodes_le"><span class="command">lemma</span></span>  wf_nodes_le<span class="main">:</span> <span class="quoted"><span class="quoted">"wf <span class="main">{</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span> nodes_le <span class="bound">x</span> <span class="bound">y</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≠</span> <span class="bound">y</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> eq_set<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>sorted <span class="main">(</span>rev <span class="bound">y</span><span class="main">)</span> <span class="main">∧</span> sorted <span class="main">(</span>rev <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> set <span class="bound">y</span> <span class="main">⊆</span> set <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≠</span> <span class="bound">y</span><span class="main">}</span> <span class="main">=</span> 
                <span class="main">{</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span> nodes_le <span class="bound">x</span> <span class="bound">y</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≠</span> <span class="bound">y</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> nodes_le_def<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>sorted <span class="main">(</span>rev <span class="bound">y</span><span class="main">)</span> <span class="main">∧</span> sorted <span class="main">(</span>rev <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> set <span class="bound">y</span> <span class="main">⊂</span> set <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≠</span> <span class="bound">y</span><span class="main">}</span> <span class="main">=</span>
        <span class="main">{</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>sorted <span class="main">(</span>rev <span class="bound">y</span><span class="main">)</span> <span class="main">∧</span> sorted <span class="main">(</span>rev <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> set <span class="bound">y</span> <span class="main">⊆</span> set <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≠</span> <span class="bound">y</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>sorted_less_rev_set_unique<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this wf_nodes_le_auxi <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"wf <span class="main">{</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>sorted <span class="main">(</span>rev <span class="bound">y</span><span class="main">)</span> <span class="main">∧</span> sorted <span class="main">(</span>rev <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> set <span class="bound">y</span> <span class="main">⊆</span> set <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≠</span> <span class="bound">y</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subst<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> eq_set <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subst<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Dom_Semi_List-acc_nodes_le"><span class="command">lemma</span></span> acc_nodes_le<span class="main">:</span> <span class="quoted"><span class="quoted">"acc nodes_le"</span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> acc_def lesssub_def lesub_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> wf_nodes_le<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Dom_Semi_List-acc_nodes_le2"><span class="command">lemma</span></span> acc_nodes_le2<span class="main">:</span> <span class="quoted"><span class="quoted">"acc <span class="main">(</span>fst <span class="main">(</span>snd nodes_semi<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> nodes_semi_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lesssub_def lesub_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> acc_nodes_le<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"top nodes_le <span class="main">[]</span> <span class="main">(</span>fst nodes_semi<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> top_def nodes_semi_def nodes_le_def lesssub_def lesub_def sorted_less_sorted_list_of_set<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span> 

<span class="keyword2"><span class="keyword">end</span></span>



</pre>
</div><div id="Listn">
<div class="head">
<h1>Theory Listn</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      HOL/MicroJava/BV/Listn.thy
    Author:     Tobias Nipkow
    Copyright   2000 TUM

Lists of a fixed length. 
*)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Most definitions and lemmas in this theory are extracted from Jinja \cite{Listn-AFP}. 
      Two lemmas "acc\_le\_listI" and "Cons\_less\_Conss" in the original Listn.thy are proved in the 'Dom\_kildall\_Property.thy'.›</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Fixed Length Lists›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Listn
<span class="keyword2"><span class="keyword">imports</span></span> <a href="#Semilat">Semilat</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">list</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> list set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">list</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">xs</span><span class="main">.</span> size <span class="bound">xs</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">∧</span> set <span class="bound">xs</span> <span class="main">⊆</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">le</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> ord <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> list<span class="main">)</span>ord"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">le</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">=</span> list_all2 <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⊑⇩</span><span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="bound">y</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span>
  <span class="entity">lesublist</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> ord <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> bool"</span></span>  <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword3">/</span><span class="keyword1">[⊑⇘</span>_<span class="keyword1">⇙]</span> _<span class="keyword3">)</span>"</span> <span class="main">[</span>50<span class="main">,</span> 0<span class="main">,</span> 51<span class="main">]</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> [⊑<span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">r</span></span></span></sub><span class="hidden">⇙</span>] <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">==</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">&lt;=_</span><span class="main">(</span>Listn.le <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span>
  <span class="entity">lesssublist</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> ord <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> bool"</span></span>  <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword3">/</span><span class="keyword1">[⊏⇘</span>_<span class="keyword1">⇙]</span> _<span class="keyword3">)</span>"</span> <span class="main">[</span>50<span class="main">,</span> 0<span class="main">,</span> 51<span class="main">]</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> [⊏<span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">r</span></span></span></sub><span class="hidden">⇙</span>] <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">==</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">&lt;_</span><span class="main">(</span>Listn.le <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

<span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command">notation</span></span> <span class="main">(</span>ASCII<span class="main">)</span>
  lesublist  <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword3">/</span><span class="keyword1">[&lt;=</span>_<span class="keyword1">]</span> _<span class="keyword3">)</span>"</span> <span class="main">[</span>50<span class="main">,</span> 0<span class="main">,</span> 51<span class="main">]</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
  lesssublist  <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword3">/</span><span class="keyword1">[&lt;</span>_<span class="keyword1">]</span> _<span class="keyword3">)</span>"</span> <span class="main">[</span>50<span class="main">,</span> 0<span class="main">,</span> 51<span class="main">]</span> 50<span class="main">)</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span>
  <span class="entity">lesublist2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> ord <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> bool"</span></span>  <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword3">/</span><span class="keyword1">[⊑⇩</span>_<span class="keyword1">]</span> _<span class="keyword3">)</span>"</span> <span class="main">[</span>50<span class="main">,</span> 0<span class="main">,</span> 51<span class="main">]</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main"><span class="free">[⊑⇩</span></span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main"><span class="free">]</span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">==</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> [⊑<span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">r</span></span></span></sub><span class="hidden">⇙</span>] <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span>
  <span class="entity">lesssublist2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> ord <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> bool"</span></span>  <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword3">/</span><span class="keyword1">[⊏⇩</span>_<span class="keyword1">]</span> _<span class="keyword3">)</span>"</span> <span class="main">[</span>50<span class="main">,</span> 0<span class="main">,</span> 51<span class="main">]</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main"><span class="free">[⊏⇩</span></span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main"><span class="free">]</span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">==</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> [⊏<span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">r</span></span></span></sub><span class="hidden">⇙</span>] <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">abbreviation</span></span>
  <span class="entity">plussublist</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'c</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'b</span> list <span class="main">⇒</span> <span class="tfree">'c</span> list"</span></span>
    <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword3">/</span><span class="keyword1">[⊔⇘</span>_<span class="keyword1">⇙]</span> _<span class="keyword3">)</span>"</span> <span class="main">[</span>65<span class="main">,</span> 0<span class="main">,</span> 66<span class="main">]</span> 65<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> [⊔<span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">f</span></span></span></sub><span class="hidden">⇙</span>] <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">==</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> ⊔<span class="hidden">⇘</span><sub>map2 <span class="free"><span class="bound"><span class="entity">f</span></span></span></sub><span class="hidden">⇙</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

<span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command">notation</span></span> <span class="main">(</span>ASCII<span class="main">)</span>
  plussublist  <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword3">/</span><span class="keyword1">[+</span>_<span class="keyword1">]</span> _<span class="keyword3">)</span>"</span> <span class="main">[</span>65<span class="main">,</span> 0<span class="main">,</span> 66<span class="main">]</span> 65<span class="main">)</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span>
  <span class="entity">plussublist2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'c</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'b</span> list <span class="main">⇒</span> <span class="tfree">'c</span> list"</span></span>
    <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword3">/</span><span class="keyword1">[⊔⇩</span>_<span class="keyword1">]</span> _<span class="keyword3">)</span>"</span> <span class="main">[</span>65<span class="main">,</span> 0<span class="main">,</span> 66<span class="main">]</span> 65<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main"><span class="free">[⊔⇩</span></span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main"><span class="free">]</span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">==</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> [⊔<span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">f</span></span></span></sub><span class="hidden">⇙</span>] <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">sl</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> sl <span class="main">⇒</span> <span class="tfree">'a</span> list sl"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sl</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">A</span><span class="main">,</span><span class="bound">r</span><span class="main">,</span><span class="bound">f</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>list <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="bound">A</span><span class="main">,</span> le <span class="bound">r</span><span class="main">,</span> map2 <span class="bound">f</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> set_update_subsetI

<span class="keyword1" id="Listn-unfold_lesub_list"><span class="command">lemma</span></span> unfold_lesub_list<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> [⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>] <span class="free">ys</span> <span class="main">=</span> Listn.le <span class="free">r</span> <span class="free">xs</span> <span class="free">ys</span>"</span></span>
<span class="comment1">(*&lt;*)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lesub_def<span class="main">)</span> <span class="comment1">(*&gt;*)</span>

<span class="keyword1" id="Listn-le_listD"><span class="command">lemma</span></span> le_listD<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">xs</span> [⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>] <span class="free">ys</span><span class="main">;</span> <span class="free">p</span> <span class="main">&lt;</span> size <span class="free">xs</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">xs</span><span class="main">!</span><span class="free">p</span> <span class="main">⊑⇩</span><span class="free">r</span> <span class="free">ys</span><span class="main">!</span><span class="free">p</span>"</span></span>
<span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Listn.le_def lesub_def list_all2_nthD<span class="main">)</span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1" id="Listn-lesub_list_impl_same_size"><span class="command">lemma</span></span> lesub_list_impl_same_size <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> [⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>] <span class="free">ys</span> <span class="main">⟹</span> size <span class="free">ys</span> <span class="main">=</span> size <span class="free">xs</span>"</span></span>
<span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Listn.le_def lesub_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_all2_lengthD<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1" id="Listn-lesssub_lengthD"><span class="command">lemma</span></span> lesssub_lengthD<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">[⊏⇩</span><span class="free">r</span><span class="main">]</span> <span class="free">ys</span> <span class="main">⟹</span> size <span class="free">ys</span> <span class="main">=</span> size <span class="free">xs</span>"</span></span>  
<span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> lesssub_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>  <span class="comment1">― ‹use lemma: lesub_list_impl_same_size ›</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Listn-listI"><span class="command">lemma</span></span> listI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> size <span class="free">xs</span> <span class="main">=</span> <span class="free">n</span><span class="main">;</span> set <span class="free">xs</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">xs</span> <span class="main">∈</span> list <span class="free">n</span> <span class="free">A</span>"</span></span>
<span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> list_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="comment1">(*&gt;*)</span>

<span class="comment1">(* FIXME: remove simp *)</span>
<span class="keyword1" id="Listn-listE_length"><span class="command">lemma</span></span> listE_length <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">∈</span> list <span class="free">n</span> <span class="free">A</span> <span class="main">⟹</span> size <span class="free">xs</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
<span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> list_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="comment1">(*&gt;*)</span>


<span class="keyword1" id="Listn-listE_set"><span class="command">lemma</span></span> listE_set <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">∈</span> list <span class="free">n</span> <span class="free">A</span> <span class="main">⟹</span> set <span class="free">xs</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>
<span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> list_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="comment1">(*&gt;*)</span>


<span class="keyword1" id="Listn-in_list_Suc_iff"><span class="command">lemma</span></span> in_list_Suc_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">xs</span> <span class="main">∈</span> list <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">y</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="main">∃</span><span class="bound">ys</span> <span class="main">∈</span> list <span class="free">n</span> <span class="free">A</span><span class="main">.</span> <span class="free">xs</span> <span class="main">=</span> <span class="bound">y</span><span class="main">#</span><span class="bound">ys</span><span class="main">)</span>"</span></span>
<span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> list_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Listn-nth_in"><span class="command">lemma</span></span> nth_in <span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="bound">n</span><span class="main">.</span> size <span class="free">xs</span> <span class="main">=</span> <span class="bound">n</span> <span class="main">⟶</span> set <span class="free">xs</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">⟶</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="bound">n</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">xs</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
<span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nth_Cons <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> nat.split<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1" id="Listn-listt_update_in_list"><span class="command">lemma</span></span> listt_update_in_list <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">xs</span> <span class="main">∈</span> list <span class="free">n</span> <span class="free">A</span><span class="main">;</span> <span class="free">x</span><span class="main">∈</span><span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">xs</span><span class="main">[</span><span class="free">i</span> <span class="main">:=</span> <span class="free">x</span><span class="main">]</span> <span class="main">∈</span> list <span class="free">n</span> <span class="free">A</span>"</span></span> 
<span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> list_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="comment1">(*&gt;*)</span>


<span class="keyword1" id="Listn-Cons_le_Cons"><span class="command">lemma</span></span> Cons_le_Cons <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">#</span><span class="free">xs</span> [⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>] <span class="free">y</span><span class="main">#</span><span class="free">ys</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊑⇩</span><span class="free">r</span> <span class="free">y</span> <span class="main">∧</span> <span class="free">xs</span> [⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>] <span class="free">ys</span><span class="main">)</span>"</span></span>
<span class="comment1">(*&lt;*)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lesub_def Listn.le_def<span class="main">)</span>



<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Dom_Kildall">
<div class="head">
<h1>Theory Dom_Kildall</h1>
</div>
<pre class="source">
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹A kildall's algorithm for computing dominators›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Dom_Kildall
<span class="keyword2"><span class="keyword">imports</span></span> <a href="#Dom_Semi_List">Dom_Semi_List</a> <a href="#Listn">Listn</a> <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Library/While_Combinator.html">HOL-Library.While_Combinator</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A kildall's algorithm for computing dominators. 
      It uses the ideas and the framework of kildall's algorithm implemented in Jinja \cite{Kildall-AFP},
      and modifications are needed to make it work for a fast algorithm for computing dominators›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span>
  <span class="tfree">'s</span> step_type <span class="main">=</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'s</span> <span class="main">⇒</span> <span class="main">(</span>nat <span class="main">×</span> <span class="tfree">'s</span><span class="main">)</span> list"</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> state_dom <span class="main">=</span> <span class="quoted"><span class="quoted">"nat list "</span></span>

<span class="keyword1"><span class="command">primrec</span></span>  <span class="entity">propa</span> <span class="main">::</span> 
  <span class="quoted"><span class="quoted">"<span class="tfree">'s</span> binop <span class="main">⇒</span> <span class="main">(</span>nat <span class="main">×</span> <span class="tfree">'s</span><span class="main">)</span> list <span class="main">⇒</span> <span class="tfree">'s</span> list <span class="main">⇒</span> nat list <span class="main">⇒</span> <span class="tfree">'s</span> list <span class="main">*</span> nat list"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">propa</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">[]</span>      <span class="free"><span class="bound"><span class="entity">τs</span></span></span> <span class="free"><span class="bound"><span class="entity">wl</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">τs</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">wl</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">propa</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">q'</span></span></span><span class="main">#</span> <span class="free"><span class="bound"><span class="entity">qs</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">τs</span></span></span> <span class="free"><span class="bound"><span class="entity">wl</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="main">(</span><span class="bound">q</span><span class="main">,</span><span class="bound">τ</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">q'</span></span></span><span class="main">;</span>
                             <span class="bound">u</span> <span class="main">=</span>  <span class="main">(</span><span class="bound">τ</span> ⊔<span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">f</span></span></span></sub><span class="hidden">⇙</span> <span class="free"><span class="bound"><span class="entity">τs</span></span></span><span class="main">!</span><span class="bound">q</span><span class="main">)</span><span class="main">;</span>
                             <span class="bound">wl'</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">u</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">τs</span></span></span><span class="main">!</span><span class="bound">q</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">wl</span></span></span> 
                                    <span class="keyword1">else</span> sorted_list_of_set <span class="main">(</span>insert <span class="bound">q</span> <span class="main">(</span>set <span class="free"><span class="bound"><span class="entity">wl</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                         <span class="keyword1">in</span> <span class="free">propa</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">qs</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">τs</span></span></span><span class="main">[</span><span class="bound">q</span> <span class="main">:=</span> <span class="bound">u</span><span class="main">]</span><span class="main">)</span> <span class="bound">wl'</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>  <span class="entity">iter</span> <span class="main">::</span> 
  <span class="quoted"><span class="quoted">"<span class="tfree">'s</span> binop <span class="main">⇒</span> <span class="tfree">'s</span> step_type <span class="main">⇒</span> <span class="tfree">'s</span> list <span class="main">⇒</span> nat list <span class="main">⇒</span> <span class="tfree">'s</span> list <span class="main">×</span> nat list"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">iter</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">step</span></span></span> <span class="free"><span class="bound"><span class="entity">τs</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">=</span>
   while <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">τs</span><span class="main">,</span><span class="bound">w</span><span class="main">)</span><span class="main">.</span> <span class="bound">w</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span>
         <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">τs</span><span class="main">,</span><span class="bound">w</span><span class="main">)</span><span class="main">.</span> <span class="keyword1">let</span> <span class="bound">p</span> <span class="main">=</span> hd <span class="bound">w</span>
                   <span class="keyword1">in</span> propa <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">step</span></span></span> <span class="bound">p</span> <span class="main">(</span><span class="bound">τs</span><span class="main">!</span><span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="bound">τs</span> <span class="main">(</span>tl <span class="bound">w</span><span class="main">)</span><span class="main">)</span>
         <span class="main">(</span><span class="free"><span class="bound"><span class="entity">τs</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">stable</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'s</span> ord <span class="main">⇒</span> <span class="tfree">'s</span> step_type <span class="main">⇒</span> <span class="tfree">'s</span> list <span class="main">⇒</span> nat <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">stable</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">step</span></span></span> <span class="free"><span class="bound"><span class="entity">τs</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span><span class="bound">τ</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free"><span class="bound"><span class="entity">step</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">τs</span></span></span><span class="main">!</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">τ</span> <span class="main">⊑⇩</span><span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">τs</span></span></span><span class="main">!</span><span class="bound">q</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">unstables</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"state_dom ord <span class="main">⇒</span>  state_dom step_type <span class="main">⇒</span> state_dom list <span class="main">⇒</span> nat list"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">unstables</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">step</span></span></span> <span class="free"><span class="bound"><span class="entity">τs</span></span></span> <span class="main">=</span> sorted_list_of_set  <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">&lt;</span> size <span class="free"><span class="bound"><span class="entity">τs</span></span></span> <span class="main">∧</span> <span class="main">¬</span> stable <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">step</span></span></span> <span class="free"><span class="bound"><span class="entity">τs</span></span></span> <span class="bound">p</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Dom_Kildall-init_worklist_is_sorted"><span class="command">lemma</span></span> init_worklist_is_sorted<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>unstables <span class="free">r</span> <span class="free">step</span> <span class="free">τs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>sorted_less_sorted_list_of_set unstables_def<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span>  <span class="entity">kildall</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"state_dom ord <span class="main">⇒</span>state_dom binop  <span class="main">⇒</span> state_dom step_type <span class="main">⇒</span> state_dom list <span class="main">⇒</span> state_dom list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">kildall</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">step</span></span></span> <span class="free"><span class="bound"><span class="entity">τs</span></span></span> <span class="main">=</span> fst<span class="main">(</span>iter <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">step</span></span></span> <span class="free"><span class="bound"><span class="entity">τs</span></span></span> <span class="main">(</span>unstables <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">step</span></span></span> <span class="free"><span class="bound"><span class="entity">τs</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">context</span></span> cfg_doms

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">transf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"node <span class="main">⇒</span> state_dom <span class="main">⇒</span> state_dom "</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">transf</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">input</span></span></span> <span class="main">≡</span>  <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">input</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">exec</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"node <span class="main">⇒</span> state_dom <span class="main">⇒</span> <span class="main">(</span>node <span class="main">×</span> state_dom<span class="main">)</span> list"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">exec</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span><span class="bound">pc</span><span class="main">.</span> <span class="main">(</span><span class="bound">pc</span><span class="main">,</span> <span class="main">(</span>transf <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>rev <span class="main">(</span>sorted_list_of_set<span class="main">(</span>succs <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Dom_Kildall-transf_res_is_rev"><span class="command">lemma</span></span> transf_res_is_rev<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>rev <span class="free">ns</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">n</span> <span class="main">&gt;</span> hd <span class="free">ns</span>  <span class="main">⟹</span> sorted <span class="main">(</span>rev <span class="main">(</span><span class="main">(</span>transf <span class="free">n</span> <span class="main">(</span> <span class="free">ns</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ns</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>transf_def sorted_wrt_append<span class="main">)</span> 

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">start</span> <span class="main">≡</span>  <span class="main">[]</span> <span class="main">#</span> <span class="main">(</span>replicate <span class="main">(</span>length <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span> <span class="main">(</span>rev<span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>length<span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">dom_kildall</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"state_dom list <span class="main">⇒</span> state_dom list"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">dom_kildall</span> <span class="main">=</span> kildall <span class="main">(</span>fst <span class="main">(</span>snd nodes_semi<span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span>snd nodes_semi<span class="main">)</span><span class="main">)</span> exec"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">dom</span><span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">dom</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">≡</span><span class="main">(</span><span class="keyword1">let</span> <span class="bound">res</span> <span class="main">=</span> <span class="main">(</span>dom_kildall start<span class="main">)</span> <span class="main">!</span><span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="keyword1">in</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">∈</span> <span class="main">(</span>set <span class="bound">res</span><span class="main">)</span> <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">)</span>"</span></span>

<span class="keyword1" id="Dom_Kildall-dom_refl"><span class="command">lemma</span></span> dom_refl<span class="main">:</span> <span class="quoted"><span class="quoted">"dom <span class="free">i</span> <span class="free">i</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> dom_def<span class="main">)</span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">strict_dom</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">strict_dom</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">res</span> <span class="main">=</span> <span class="main">(</span>dom_kildall start<span class="main">)</span> <span class="main">!</span><span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="keyword1">in</span>  <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">∈</span> set <span class="bound">res</span><span class="main">)</span>"</span></span>


<span class="keyword1" id="Dom_Kildall-strict_domI1"><span class="command">lemma</span></span> strict_domI1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>dom_kildall <span class="main">(</span><span class="main">[]</span> <span class="main">#</span> <span class="main">(</span>replicate <span class="main">(</span>length <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span> <span class="main">(</span>rev<span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>length<span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="free">j</span> <span class="main">=</span>  <span class="free">res</span> <span class="main">⟹</span> <span class="free">i</span> <span class="main">∈</span> set <span class="free">res</span> <span class="main">⟹</span> strict_dom <span class="free">i</span> <span class="free">j</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>strict_dom_def <span class="main">)</span>

<span class="keyword1" id="Dom_Kildall-strict_domD"><span class="command">lemma</span></span> strict_domD<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"strict_dom <span class="free">i</span> <span class="free">j</span> <span class="main">⟹</span> 
  dom_kildall <span class="main">(</span><span class="main">(</span> <span class="main">[]</span> <span class="main">#</span> <span class="main">(</span>replicate <span class="main">(</span>length <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span> <span class="main">(</span>rev<span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>length<span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="free">j</span>  <span class="main">=</span>  <span class="free">a</span> <span class="main">⟹</span> 
  <span class="free">i</span> <span class="main">∈</span> set <span class="free">a</span>"</span></span>  
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>strict_dom_def <span class="main">)</span>

<span class="keyword1" id="Dom_Kildall-sdom_dom"><span class="command">lemma</span></span> sdom_dom<span class="main">:</span> <span class="quoted"><span class="quoted">"strict_dom <span class="free">i</span> <span class="free">j</span> <span class="main">⟹</span> dom <span class="free">i</span> <span class="free">j</span>"</span></span>  
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> strict_dom_def<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>dom_def<span class="main">)</span>

<span class="keyword1" id="Dom_Kildall-not_sdom_not_dom"><span class="command">lemma</span></span> not_sdom_not_dom<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>strict_dom <span class="free">i</span> <span class="free">j</span> <span class="main">⟹</span> <span class="free">i</span> <span class="main">≠</span> <span class="free">j</span> <span class="main">⟹</span> <span class="main">¬</span>dom <span class="free">i</span> <span class="free">j</span>"</span></span>  
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> strict_dom_def<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>dom_def<span class="main">)</span>

<span class="keyword1" id="Dom_Kildall-dom_sdom"><span class="command">lemma</span></span> dom_sdom<span class="main">:</span> <span class="quoted"><span class="quoted">"dom <span class="free">i</span> <span class="free">j</span> <span class="main">⟹</span> <span class="free">i</span> <span class="main">≠</span> <span class="free">j</span> <span class="main">⟹</span> strict_dom <span class="free">i</span> <span class="free">j</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> dom_def<span class="main">)</span>  <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>dom_def strict_dom_def<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">stables</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'s</span> ord <span class="main">⇒</span> <span class="tfree">'s</span> step_type <span class="main">⇒</span> <span class="tfree">'s</span> list <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>                                                             
  <span class="quoted"><span class="quoted">"<span class="free">stables</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">step</span></span></span> <span class="free"><span class="bound"><span class="entity">τs</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">p</span></span> <span class="main">&lt;</span> size <span class="free"><span class="bound"><span class="entity">τs</span></span></span><span class="main">.</span> stable <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">step</span></span></span> <span class="free"><span class="bound"><span class="entity">τs</span></span></span> <span class="bound">p</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">lesubstep_type</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">×</span> <span class="tfree">'s</span><span class="main">)</span> set <span class="main">⇒</span> <span class="tfree">'s</span> ord <span class="main">⇒</span> <span class="main">(</span>nat <span class="main">×</span> <span class="tfree">'s</span><span class="main">)</span> set <span class="main">⇒</span> bool"</span></span>
    <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword3">/</span><span class="keyword1">{⊑⇘</span>_<span class="keyword1">⇙}</span> _<span class="keyword3">)</span>"</span> <span class="main">[</span>50<span class="main">,</span> 0<span class="main">,</span> 51<span class="main">]</span> 50<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">A</span></span></span> {⊑<span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">r</span></span></span></sub><span class="hidden">⇙</span>} <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">τ</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span> <span class="main">∃</span><span class="bound">τ'</span><span class="main">.</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">τ'</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">∧</span> <span class="bound">τ</span> <span class="main">⊑⇩</span><span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="bound">τ'</span>"</span></span>

<span class="keyword1"><span class="command">notation</span></span> <span class="main">(</span>ASCII<span class="main">)</span>
  lesubstep_type  <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword3">/</span><span class="keyword1">{&lt;='_</span>_<span class="keyword1">}</span> _<span class="keyword3">)</span>"</span> <span class="main">[</span>50<span class="main">,</span> 0<span class="main">,</span> 51<span class="main">]</span> 50<span class="main">)</span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">pluslussub</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>  <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword3">/</span><span class="keyword1">⨆⇘</span>_<span class="keyword1">⇙</span> _<span class="keyword3">)</span>"</span> <span class="main">[</span>65<span class="main">,</span> 0<span class="main">,</span> 66<span class="main">]</span> 65<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">pluslussub</span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">pluslussub</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="free">pluslussub</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊔⇩</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>
<span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command">notation</span></span> <span class="main">(</span>ASCII<span class="main">)</span>
  pluslussub  <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword3">/</span><span class="keyword1">++'_</span>_ _<span class="keyword3">)</span>"</span> <span class="main">[</span>65<span class="main">,</span> 1000<span class="main">,</span> 66<span class="main">]</span> 65<span class="main">)</span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">bounded</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'s</span> step_type <span class="main">⇒</span> nat <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">bounded</span> <span class="free"><span class="bound"><span class="entity">step</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">p</span></span><span class="main">&lt;</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">.</span> <span class="main">∀</span><span class="bound">τ</span><span class="main">.</span> <span class="main">∀</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span><span class="bound">τ'</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free"><span class="bound"><span class="entity">step</span></span></span> <span class="bound">p</span> <span class="bound">τ</span><span class="main">)</span><span class="main">.</span> <span class="bound">q</span><span class="main">&lt;</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">pres_type</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'s</span> step_type <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'s</span> set <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">pres_type</span> <span class="free"><span class="bound"><span class="entity">step</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">τ</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">p</span></span><span class="main">&lt;</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">.</span> <span class="main">∀</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span><span class="bound">τ'</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free"><span class="bound"><span class="entity">step</span></span></span> <span class="bound">p</span> <span class="bound">τ</span><span class="main">)</span><span class="main">.</span> <span class="bound">τ'</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mono</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'s</span> ord <span class="main">⇒</span> <span class="tfree">'s</span> step_type <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'s</span> set <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">mono</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">step</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">⟷</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">τ</span> <span class="bound">p</span> <span class="bound">τ'</span><span class="main">.</span> <span class="bound">τ</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">∧</span> <span class="bound">p</span><span class="main">&lt;</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">∧</span> <span class="bound">τ</span> <span class="main">⊑⇩</span><span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="bound">τ'</span> <span class="main">⟶</span> set <span class="main">(</span><span class="free"><span class="bound"><span class="entity">step</span></span></span> <span class="bound">p</span> <span class="bound">τ</span><span class="main">)</span> {⊑<span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">r</span></span></span></sub><span class="hidden">⇙</span>} set <span class="main">(</span><span class="free"><span class="bound"><span class="entity">step</span></span></span> <span class="bound">p</span> <span class="bound">τ'</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Dom_Kildall_Property">
<div class="head">
<h1>Theory Dom_Kildall_Property</h1>
</div>
<pre class="source"><span class="comment1">(* Author: Nan Jiang *)</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Properties of the kildall's algorithm on the semilattice ›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Dom_Kildall_Property
<span class="keyword2"><span class="keyword">imports</span></span> <a href="#Dom_Kildall">Dom_Kildall</a>  
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Dom_Kildall_Property-sorted_list_len_lt"><span class="command">lemma</span></span> sorted_list_len_lt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊂</span> <span class="free">y</span> <span class="main">⟹</span> finite <span class="free">y</span> <span class="main">⟹</span> length <span class="main">(</span>sorted_list_of_set <span class="free">x</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="main">(</span>sorted_list_of_set <span class="free">y</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"sorted_list_of_set <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?y</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"sorted_list_of_set <span class="free">y</span>"</span></span> 
  <span class="keyword3"><span class="command">assume</span></span> x_y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊂</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> fin_y<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">y</span>"</span></span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> card_x_y<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="free">x</span> <span class="main">&lt;</span> card <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> fin_x<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">x</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>psubset_card_mono finite_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> fin_y <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="var">?x</span> <span class="main">=</span> card <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="var">?y</span> <span class="main">=</span> card <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> card_x_y <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Dom_Kildall_Property-wf_sorted_list"><span class="command">lemma</span></span> wf_sorted_list<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"wf <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>sorted_list_of_set <span class="bound">x</span><span class="main">,</span> sorted_list_of_set <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> finite_psubset<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> finite_psubset_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> wf_measure <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> wf_subset<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> measure_def inv_image_def image_def<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> sorted_list_len_lt<span class="main">)</span>

<span class="keyword1" id="Dom_Kildall_Property-sorted_list_psub"><span class="command">lemma</span></span> sorted_list_psub<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"sorted <span class="free">w</span> <span class="main">⟶</span>
   <span class="free">w</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟶</span>
   <span class="main">(</span>sorted_list_of_set <span class="main">(</span>set <span class="main">(</span>tl <span class="free">w</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="free">w</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>sorted_list_of_set <span class="bound">x</span><span class="main">,</span> sorted_list_of_set <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">B</span><span class="main">)</span><span class="main">.</span> <span class="bound">A</span> <span class="main">⊂</span> <span class="bound">B</span> <span class="main">∧</span> finite <span class="bound">B</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> strip<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>image_iff<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> sorted_w<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="free">w</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> w_n_nil<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> 
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?a</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>tl <span class="free">w</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?b</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"set <span class="free">w</span>"</span></span> 

  <span class="keyword1"><span class="command">from</span></span> sorted_w <span class="keyword1"><span class="command">have</span></span> sorted_tl_w<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>tl <span class="free">w</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> dist<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="free">w</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">w</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sorted_wrt_append <span class="main">)</span>  
  <span class="keyword1"><span class="command">with</span></span> w_n_nil  <span class="keyword1"><span class="command">have</span></span> a_psub_b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?a</span> <span class="main">⊂</span> <span class="var">?b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">w</span></span><span class="main">)</span><span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> sorted_w sorted_tl_w <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">=</span> sorted_list_of_set <span class="var">?b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"tl <span class="free">w</span> <span class="main">=</span> sorted_list_of_set <span class="main">(</span>set <span class="main">(</span>tl <span class="free">w</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sorted_less_set_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> a_psub_b <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">a</span> <span class="main">⊂</span> <span class="bound">b</span> <span class="main">∧</span> finite <span class="bound">b</span> <span class="main">∧</span> sorted_list_of_set <span class="main">(</span>set <span class="main">(</span>tl <span class="free">w</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> sorted_list_of_set <span class="bound">a</span> <span class="main">∧</span> <span class="free">w</span> <span class="main">=</span> sorted_list_of_set <span class="bound">b</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">merges</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'s</span> binop <span class="main">⇒</span> <span class="main">(</span>nat <span class="main">×</span> <span class="tfree">'s</span><span class="main">)</span> list <span class="main">⇒</span> <span class="tfree">'s</span> list <span class="main">⇒</span> <span class="tfree">'s</span> list"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">merges</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">[]</span>      <span class="free"><span class="bound"><span class="entity">τs</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">τs</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">merges</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p'</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">τs</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">τ</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">p'</span></span></span> <span class="keyword1">in</span> <span class="free">merges</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">τs</span></span></span><span class="main">[</span><span class="bound">p</span> <span class="main">:=</span> <span class="bound">τ</span> ⊔<span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">f</span></span></span></sub><span class="hidden">⇙</span> <span class="free"><span class="bound"><span class="entity">τs</span></span></span><span class="main">!</span><span class="bound">p</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">locale</span></span> dom_sl <span class="main">=</span> cfg_doms <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">r</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">f</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">step</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">start</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">n</span> 
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span>  <span class="main">≡</span> <span class="main">(</span><span class="main">(</span>rev <span class="main">∘</span> sorted_list_of_set<span class="main">)</span> <span class="main">`</span> <span class="main">(</span>Pow <span class="main">(</span>set <span class="main">(</span>nodes<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span>  <span class="main">≡</span> nodes_le"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span>  <span class="main">≡</span> nodes_sup"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span>  <span class="main">≡</span> <span class="main">(</span>size nodes<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">step</span> <span class="main">≡</span> exec"</span></span> 
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">start</span> <span class="main">≡</span> <span class="main">(</span><span class="main">[]</span> <span class="main">#</span> <span class="main">(</span>replicate <span class="main">(</span>length <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span> <span class="main">(</span>rev<span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">::</span>state_dom list "</span></span>

<span class="keyword2"><span class="keyword">begin</span></span> 

<span class="keyword1" id="Dom_Kildall_Property-is_semi"><span class="command">lemma</span></span> is_semi<span class="main">:</span> <span class="quoted"><span class="quoted">"semilat<span class="main">(</span><span class="free">A</span><span class="main">,</span><span class="free">r</span><span class="main">,</span><span class="free">f</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">insert</span> nodes_semi_is_semilat<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>nodes_semi_def A_def r_def f_def<span class="main">)</span>

<span class="comment1">―‹used by acc\_le\_listI›</span>
<span class="keyword1" id="Dom_Kildall_Property-Cons_less_Conss"><span class="command">lemma</span></span> Cons_less_Conss <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">#</span><span class="free">xs</span> <span class="main">[⊏⇩</span><span class="free">r</span><span class="main">]</span> <span class="free">y</span><span class="main">#</span><span class="free">ys</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊏⇩</span><span class="free">r</span> <span class="free">y</span> <span class="main">∧</span> <span class="free">xs</span> [⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>] <span class="free">ys</span> <span class="main">∨</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span> <span class="main">∧</span> <span class="free">xs</span> <span class="main">[⊏⇩</span><span class="free">r</span><span class="main">]</span> <span class="free">ys</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">unfold</span> lesssub_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> iffI<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">#</span> <span class="free">xs</span> [⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>] <span class="free">y</span> <span class="main">#</span> <span class="free">ys</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">#</span> <span class="free">xs</span> <span class="main">≠</span> <span class="free">y</span> <span class="main">#</span> <span class="free">ys</span> "</span></span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ass1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">#</span> <span class="free">xs</span> [⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>] <span class="free">y</span> <span class="main">#</span> <span class="free">ys</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ass2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">#</span> <span class="free">xs</span> <span class="main">≠</span> <span class="free">y</span> <span class="main">#</span> <span class="free">ys</span> "</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> ass1 <span class="keyword1"><span class="command">have</span></span> g1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> ⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> g2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> [⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>]  <span class="free">ys</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> ass2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="free">y</span> <span class="main">∨</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span> <span class="main">∧</span> <span class="free">xs</span> <span class="main">≠</span> <span class="free">ys</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> ⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span> <span class="free">y</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">≠</span> <span class="free">y</span><span class="main">)</span> <span class="main">∧</span> <span class="free">xs</span> [⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>] <span class="free">ys</span> <span class="main">∨</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span> <span class="main">∧</span> <span class="free">xs</span> [⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>] <span class="free">ys</span> <span class="main">∧</span> <span class="free">xs</span> <span class="main">≠</span> <span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="free">y</span>"</span></span> 
    <span class="keyword1"><span class="command">with</span></span> g1 g2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> ⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span> <span class="free">y</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">≠</span> <span class="free">y</span><span class="main">)</span> <span class="main">∧</span> <span class="free">xs</span> [⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>] <span class="free">ys</span> "</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">y</span> <span class="main">∧</span> <span class="free">xs</span> <span class="main">≠</span> <span class="free">ys</span> "</span></span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">y</span> <span class="main">∧</span> <span class="free">xs</span> [⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>] <span class="free">ys</span> <span class="main">∧</span> <span class="free">xs</span> <span class="main">≠</span> <span class="free">ys</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  g2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span>  ass<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">x</span> ⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span> <span class="free">y</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">≠</span> <span class="free">y</span><span class="main">)</span> <span class="main">∧</span> <span class="free">xs</span> [⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>] <span class="free">ys</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">x</span> <span class="main">=</span> <span class="free">y</span> <span class="main">∧</span> <span class="free">xs</span> [⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>] <span class="free">ys</span> <span class="main">∧</span> <span class="free">xs</span> <span class="main">≠</span> <span class="free">ys</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> ass <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">#</span> <span class="free">xs</span> [⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>] <span class="free">y</span> <span class="main">#</span> <span class="free">ys</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">#</span> <span class="free">xs</span> <span class="main">≠</span> <span class="free">y</span> <span class="main">#</span> <span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> ⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span> <span class="free">y</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">≠</span> <span class="free">y</span><span class="main">)</span> <span class="main">∧</span> <span class="free">xs</span> [⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>] <span class="free">ys</span> "</span></span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> ⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span> <span class="free">y</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">≠</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ass1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> [⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>] <span class="free">ys</span> "</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ass2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> ⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ass3<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="free">x</span> <span class="main">≠</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> ass3 <span class="keyword1"><span class="command">have</span></span> g2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">#</span> <span class="free">xs</span> <span class="main">≠</span> <span class="free">y</span> <span class="main">#</span> <span class="free">ys</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> ass1 ass2 <span class="keyword1"><span class="command">have</span></span> g1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">#</span> <span class="free">xs</span> [⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>] <span class="free">y</span> <span class="main">#</span> <span class="free">ys</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> g2 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">#</span> <span class="free">xs</span> [⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>] <span class="free">y</span> <span class="main">#</span> <span class="free">ys</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">#</span> <span class="free">xs</span> <span class="main">≠</span> <span class="free">y</span> <span class="main">#</span> <span class="free">ys</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">y</span> <span class="main">∧</span> <span class="free">xs</span> [⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>] <span class="free">ys</span> <span class="main">∧</span> <span class="free">xs</span> <span class="main">≠</span> <span class="free">ys</span> "</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> [⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>] <span class="free">ys</span> "</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">" <span class="free">xs</span> <span class="main">≠</span> <span class="free">ys</span> "</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> g2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">#</span> <span class="free">xs</span> <span class="main">≠</span> <span class="free">y</span> <span class="main">#</span> <span class="free">ys</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">`<span class="free">x</span> <span class="main">=</span> <span class="free">y</span>`</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> ⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span> <span class="free">y</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lesssub_def lesub_def r_def nodes_le_def <span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">`<span class="free">xs</span> [⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>] <span class="free">ys</span>`</span></span> <span class="keyword1"><span class="command">have</span></span> g1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">#</span> <span class="free">xs</span> [⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>] <span class="free">y</span> <span class="main">#</span> <span class="free">ys</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">with</span></span> g2 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="free">x</span> <span class="main">#</span> <span class="free">xs</span> [⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>] <span class="free">y</span> <span class="main">#</span> <span class="free">ys</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">#</span> <span class="free">xs</span> <span class="main">≠</span> <span class="free">y</span> <span class="main">#</span> <span class="free">ys</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Dom_Kildall_Property-acc_le_listI"><span class="command">lemma</span></span> acc_le_listI <span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main">!</span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"acc <span class="free">r</span> <span class="main">⟹</span> acc <span class="main">(</span>Listn.le <span class="free">r</span><span class="main">)</span> "</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> acc_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"Wellfounded.wf<span class="main">(</span><span class="keyword1">UN</span> <span class="bound">n</span><span class="main">.</span> <span class="main">{</span><span class="main">(</span><span class="bound">ys</span><span class="main">,</span><span class="bound">xs</span><span class="main">)</span><span class="main">.</span>  size <span class="bound">xs</span> <span class="main">=</span> <span class="bound">n</span> <span class="main">∧</span> size <span class="bound">ys</span> <span class="main">=</span> <span class="bound">n</span> <span class="main">∧</span> <span class="bound">xs</span> <span class="main">&lt;_</span><span class="main">(</span>Listn.le <span class="free">r</span><span class="main">)</span> <span class="bound">ys</span><span class="main">}</span><span class="main">)</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> wf_subset<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> lesssub_lengthD<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> wf_UN<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> m n<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">m</span><span class="main">=</span><span class="improper">n</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> equals0I <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> not_sym<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> n<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="improper"><span class="quoted"><span class="improper">n</span></span></span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lesssub_def <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> conj_cong<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> k<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_eq_minimal<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm</span><span class="main"><span class="main">)</span></span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_Suc_conv <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> conj_cong<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> M m<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span> <span class="bound">xs</span><span class="main">.</span> size <span class="bound">xs</span> <span class="main">=</span> <span class="improper">k</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">#</span><span class="bound">xs</span> <span class="main">∈</span> <span class="improper">M</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> thin_rl<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> thin_rl<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">a</span><span class="main">.</span> <span class="main">∃</span><span class="bound">xs</span><span class="main">.</span> size <span class="bound">xs</span> <span class="main">=</span> <span class="improper">k</span> <span class="main">∧</span> <span class="bound">a</span><span class="main">#</span><span class="bound">xs</span><span class="main">:</span><span class="improper">M</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> impE<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">thin_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span> <span class="bound">xs</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">x</span> <span class="bound">xs</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">for</span></span></span> <span class="skolem">P</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> maxA xs<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">ys</span><span class="main">.</span> size <span class="bound">ys</span> <span class="main">=</span> size <span class="improper">xs</span> <span class="main">∧</span> <span class="improper">maxA</span><span class="main">#</span><span class="bound">ys</span> <span class="main">∈</span> <span class="improper">M</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> impE<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">thin_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">m</span> <span class="main">∈</span> <span class="improper">M</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">thin_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">maxA</span><span class="main">#</span><span class="improper">xs</span> <span class="main">∈</span> <span class="improper">M</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> bexI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Dom_Kildall_Property-wf_listn"><span class="command">lemma</span></span> wf_listn<span class="main">:</span> <span class="quoted"><span class="quoted">"wf <span class="main">{</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> ⊏<span class="hidden">⇘</span><sub>Listn.le <span class="free">r</span></sub><span class="hidden">⇙</span> <span class="bound">y</span><span class="main">}</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">insert</span> acc_nodes_le acc_le_listI r_def<span class="main">)</span>  <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>acc_def<span class="main">)</span>

<span class="keyword1" id="Dom_Kildall_Property-wf_listn'"><span class="command">lemma</span></span> wf_listn'<span class="main">:</span> <span class="quoted"><span class="quoted">"wf <span class="main">{</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">[⊏⇩</span><span class="free">r</span><span class="main">]</span> <span class="bound">y</span><span class="main">}</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> wf_listn<span class="main">)</span>

<span class="keyword1" id="Dom_Kildall_Property-wf_listn_termination_rel"><span class="command">lemma</span></span> wf_listn_termination_rel<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"wf <span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="bound">y</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> ⊏<span class="hidden">⇘</span><sub>Listn.le <span class="free">r</span></sub><span class="hidden">⇙</span> <span class="bound">y</span><span class="main">}</span>  <span class="keyword1">&lt;*lex*&gt;</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>sorted_list_of_set <span class="bound">x</span><span class="main">,</span> sorted_list_of_set <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> finite_psubset<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> wf_listn wf_sorted_list<span class="main">)</span>  <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>wf_lex_prod<span class="main">)</span>

<span class="keyword1" id="Dom_Kildall_Property-inA_is_sorted"><span class="command">lemma</span></span> inA_is_sorted<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> sorted <span class="main">(</span>rev <span class="free">xs</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>A_def sorted_less_sorted_list_of_set<span class="main">)</span>

<span class="keyword1" id="Dom_Kildall_Property-list_nA_lt_refl"><span class="command">lemma</span></span> list_nA_lt_refl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">∈</span> list <span class="free">n</span> <span class="free">A</span> <span class="main">⟶</span> <span class="free">xs</span> [⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>] <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">∈</span> list <span class="free">n</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="free">xs</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> listE_set<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="free">xs</span><span class="main">.</span> <span class="free">xs</span><span class="main">!</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="free">xs</span><span class="main">.</span> sorted <span class="main">(</span>rev <span class="main">(</span><span class="free">xs</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>inA_is_sorted<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> [⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>] <span class="free">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">unfold</span> Listn.le_def lesub_def<span class="main">)</span> 
     <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>list_all2_conv_all_nth Listn.le_def r_def nodes_le_def<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Dom_Kildall_Property-nil_inA"><span class="command">lemma</span></span> nil_inA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[]</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> A_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">∈</span> Pow <span class="main">(</span>set nodes<span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">[]</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> rev <span class="main">(</span>sorted_list_of_set <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>rev_image_eqI<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Dom_Kildall_Property-upt_n_in_pow_nodes"><span class="command">lemma</span></span> upt_n_in_pow_nodes<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">}</span> <span class="main">∈</span> Pow <span class="main">(</span>set nodes<span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>n_def nodes_def verts_set<span class="main">)</span>

<span class="keyword1" id="Dom_Kildall_Property-rev_all_inA"><span class="command">lemma</span></span> rev_all_inA<span class="main">:</span> <span class="quoted"><span class="quoted">"rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">unfold</span> A_def<span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> rev <span class="main">(</span>sorted_list_of_set <span class="bound">x</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span> <span class="main">=</span><span class="var">?f</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> upt_n_in_pow_nodes <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span> <span class="main">∈</span> <span class="var">?f</span> <span class="main">`</span> Pow <span class="main">(</span>set nodes<span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> image_eqI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Dom_Kildall_Property-len_start_is_n"><span class="command">lemma</span></span> len_start_is_n<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">start</span> <span class="main">=</span> <span class="free">n</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> len_verts_gt0<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>start_def n_def nodes_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>Suc_pred<span class="main">)</span>

<span class="keyword1" id="Dom_Kildall_Property-len_start_is_len_verts"><span class="command">lemma</span></span> len_start_is_len_verts<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">start</span> <span class="main">=</span> length <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> len_verts_gt0 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>start_def<span class="main">)</span>

<span class="keyword1" id="Dom_Kildall_Property-start_len_gt_0"><span class="command">lemma</span></span> start_len_gt_0<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">start</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> len_verts_gt0<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>start_def<span class="main">)</span> 

<span class="keyword1" id="Dom_Kildall_Property-start_subset_A"><span class="command">lemma</span></span> start_subset_A<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">start</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>nil_inA rev_all_inA start_def<span class="main">)</span>

<span class="keyword1" id="Dom_Kildall_Property-start_in_A"><span class="command">lemma</span></span> start_in_A <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">start</span> <span class="main">∈</span> <span class="main">(</span>list <span class="free">n</span> <span class="free">A</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> start_subset_A len_start_is_n<span class="main">)</span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>listI<span class="main">)</span>

<span class="keyword1" id="Dom_Kildall_Property-sorted_start_nth"><span class="command">lemma</span></span> sorted_start_nth<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟹</span> sorted <span class="main">(</span>rev <span class="main">(</span><span class="free">start</span><span class="main">!</span><span class="free">i</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">start</span><span class="main">!</span><span class="free">i</span> <span class="main">∈</span> <span class="free">A</span>"</span></span><span class="main">)</span>    
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>inA_is_sorted<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>start_subset_A  len_start_is_n<span class="main">)</span>

<span class="keyword1" id="Dom_Kildall_Property-start_nth0_empty"><span class="command">lemma</span></span> start_nth0_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">start</span><span class="main">!</span><span class="main">0</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>start_def<span class="main">)</span>

<span class="keyword1" id="Dom_Kildall_Property-start_nth_lt0_all"><span class="command">lemma</span></span> start_nth_lt0_all<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span><span class="main">∈</span><span class="main">{</span><span class="main">1</span><span class="main">..&lt;</span> length <span class="free">start</span><span class="main">}</span><span class="main">.</span> <span class="free">start</span><span class="main">!</span><span class="bound">p</span> <span class="main">=</span> <span class="main">(</span>rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>start_def<span class="main">)</span>
                                                          
<span class="keyword1" id="Dom_Kildall_Property-in_nodes_lt_n"><span class="command">lemma</span></span> in_nodes_lt_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>n_def nodes_def verts_set<span class="main">)</span>

<span class="keyword1" id="Dom_Kildall_Property-start_nth0_unstable_auxi"><span class="command">lemma</span></span> start_nth0_unstable_auxi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">[</span><span class="main">0</span><span class="main">]</span> ⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span> <span class="main">(</span>rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span><span class="main">)</span>"</span></span>  
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> len_verts_gt1 verts_ge_Suc0<span class="main">)</span>
  <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>r_def lesssub_def lesub_def nodes_le_def n_def nodes_def<span class="main">)</span>
                                                          
<span class="keyword1" id="Dom_Kildall_Property-start_nth0_unstable"><span class="command">lemma</span></span> start_nth0_unstable<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> stable <span class="free">r</span> <span class="free">step</span> <span class="free">start</span> <span class="main">0</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> notI<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> start_nth0_empty stable_def step_def exec_def transf_def<span class="main">)</span> 
  <span class="keyword3"><span class="command">assume</span></span> ass<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="main">(</span>sorted_list_of_set <span class="main">(</span>succs <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="main">[</span><span class="main">0</span><span class="main">]</span> ⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span> <span class="free">start</span> <span class="main">!</span> <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> succ_of_entry0 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> succs <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="skolem">s</span> <span class="main">∈</span> set <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> head_is_vert 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>succs_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> set <span class="main">(</span>sorted_list_of_set <span class="main">(</span>succs <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">start</span><span class="main">!</span><span class="skolem">s</span> <span class="main">=</span> <span class="main">(</span>rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fin_succs verts_set len_verts_gt0 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>start_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> ass start_nth0_unstable_auxi <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Dom_Kildall_Property-start_nth_unstable"><span class="command">lemma</span></span> start_nth_unstable<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> <span class="main">{</span><span class="main">1</span> <span class="main">..&lt;</span> length <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span><span class="main">}</span> "</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"succs <span class="free">p</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> stable <span class="free">r</span> <span class="free">step</span> <span class="free">start</span> <span class="free">p</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> stable_def<span class="main">)</span>  
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?step_p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">step</span> <span class="free">p</span> <span class="main">(</span><span class="free">start</span> <span class="main">!</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?rev_all</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"rev<span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>length<span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span><span class="main">]</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> sta<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span> <span class="bound">τ</span><span class="main">)</span><span class="main">∈</span>set <span class="var">?step_p</span><span class="main">.</span> <span class="bound">τ</span> ⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span> <span class="free">start</span> <span class="main">!</span> <span class="bound">q</span>"</span></span>  

  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> n_sorted<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> sorted <span class="main">(</span>rev <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="var">?rev_all</span><span class="main">)</span><span class="main">)</span>"</span></span>    
                 <span class="keyword2"><span class="keyword">and</span></span> p<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> set <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">start</span><span class="main">!</span><span class="free">p</span> <span class="main">=</span> <span class="var">?rev_all</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> verts_set <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>n_def nodes_def start_def sorted_wrt_append<span class="main">)</span>  
  <span class="keyword1"><span class="command">with</span></span> sta <span class="keyword1"><span class="command">have</span></span> step_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span> <span class="bound">τ</span><span class="main">)</span><span class="main">∈</span>set <span class="var">?step_p</span><span class="main">.</span> sorted <span class="main">(</span>rev <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="var">?rev_all</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="var">?rev_all</span> <span class="main">=</span> <span class="free">start</span><span class="main">!</span><span class="bound">q</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>step_def exec_def transf_def lesssub_def lesub_def r_def nodes_le_def<span class="main">)</span>
  
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> fin_succs p <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> a_b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">∈</span> set <span class="var">?step_p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>step_def exec_def transf_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> step_p <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>rev <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="var">?rev_all</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="var">?rev_all</span> <span class="main">=</span> <span class="free">start</span><span class="main">!</span><span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> n_sorted <span class="keyword1"><span class="command">have</span></span> eq_p_cons<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="var">?rev_all</span> <span class="main">=</span> <span class="free">start</span><span class="main">!</span><span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 
  <span class="keyword1"><span class="command">from</span></span> p <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span> <span class="bound">τ</span><span class="main">)</span><span class="main">∈</span>set <span class="var">?step_p</span><span class="main">.</span> <span class="bound">q</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> succ_in_G fin_succs verts_set n_def nodes_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>step_def exec_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> a_b <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> len_start_is_n <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>rev <span class="main">(</span><span class="free">start</span><span class="main">!</span><span class="skolem">a</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sorted_start_nth <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> eq_p_cons n_sorted <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Dom_Kildall_Property-start_unstable_cond"><span class="command">lemma</span></span> start_unstable_cond<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"succs <span class="free">p</span> <span class="main">≠</span> <span class="main">{}</span> "</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">&lt;</span> length <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> stable <span class="free">r</span> <span class="free">step</span> <span class="free">start</span> <span class="free">p</span>"</span></span>  
  <span class="keyword1"><span class="command">using</span></span> assms start_nth0_unstable start_nth_unstable 
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>  <span class="operator">auto</span>

<span class="keyword1" id="Dom_Kildall_Property-unstable_start"><span class="command">lemma</span></span> unstable_start<span class="main">:</span> <span class="quoted"><span class="quoted">"unstables <span class="free">r</span> <span class="free">step</span> <span class="free">start</span> <span class="main">=</span> sorted_list_of_set <span class="main">(</span><span class="main">{</span><span class="bound">p</span><span class="main">.</span> succs <span class="bound">p</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> <span class="bound">p</span> <span class="main">&lt;</span> length <span class="free">start</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> len_start_is_len_verts start_unstable_cond
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="bound">p</span> <span class="main">&lt;</span> length <span class="free">start</span> <span class="main">∧</span> <span class="main">¬</span> stable <span class="free">r</span> <span class="free">step</span> <span class="free">start</span> <span class="bound">p</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> succs <span class="bound">p</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> <span class="bound">p</span> <span class="main">&lt;</span> length <span class="free">start</span><span class="main">}</span>"</span></span><span class="main">)</span>
     <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> unstables_def stable_def step_def exec_def<span class="main">)</span>

<span class="keyword1" id="Dom_Kildall_Property-nth_merges"><span class="command">lemma</span></span> nth_merges<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ss</span><span class="main">.</span> <span class="main">⟦</span><span class="free">p</span> <span class="main">&lt;</span> length <span class="bound">ss</span><span class="main">;</span> <span class="bound">ss</span> <span class="main">∈</span> list <span class="free">n</span> <span class="free">A</span><span class="main">;</span> <span class="main">∀</span><span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">t</span><span class="main">)</span><span class="main">∈</span>set <span class="free">ps</span><span class="main">.</span> <span class="bound">p</span><span class="main">&lt;</span><span class="free">n</span> <span class="main">∧</span> <span class="bound">t</span><span class="main">∈</span><span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span>merges <span class="free">f</span> <span class="free">ps</span> <span class="bound">ss</span><span class="main">)</span><span class="main">!</span><span class="free">p</span> <span class="main">=</span> map snd <span class="main">[</span><span class="main">(</span><span class="bound">p'</span><span class="main">,</span><span class="bound">t'</span><span class="main">)</span> <span class="main">←</span> <span class="free">ps</span><span class="main">.</span> <span class="bound">p'</span><span class="main">=</span><span class="free">p</span><span class="main">]</span> ⨆<span class="hidden">⇘</span><sub><span class="free">f</span></sub><span class="hidden">⇙</span> <span class="bound">ss</span><span class="main">!</span><span class="free">p</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ss</span><span class="main">.</span> <span class="main">⟦</span><span class="main">_</span><span class="main">;</span> <span class="main">_</span><span class="main">;</span> <span class="var">?steptype</span> <span class="free">ps</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="var">?P</span> <span class="bound">ss</span> <span class="free">ps</span>"</span></span><span class="main">)</span>
<span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ps</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ss</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">ss</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ss</span> <span class="skolem">p'</span> <span class="skolem">ps'</span>
  <span class="keyword3"><span class="command">assume</span></span> ss<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ss</span> <span class="main">∈</span> list <span class="free">n</span> <span class="free">A</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> l<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">&lt;</span> length <span class="skolem">ss</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?steptype</span> <span class="main">(</span><span class="skolem">p'</span><span class="main">#</span><span class="skolem">ps'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    p'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span><span class="main">=</span><span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">&lt;</span><span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">∈</span><span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ps'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?steptype</span> <span class="skolem">ps'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">p'</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ss</span><span class="main">.</span> <span class="free">p</span><span class="main">&lt;</span> length <span class="bound">ss</span> <span class="main">⟹</span> <span class="bound">ss</span> <span class="main">∈</span> list <span class="free">n</span> <span class="free">A</span> <span class="main">⟹</span> <span class="var">?steptype</span> <span class="skolem">ps'</span> <span class="main">⟹</span> <span class="var">?P</span> <span class="bound">ss</span> <span class="skolem">ps'</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ss</span><span class="main">.</span> <span class="bound">ss</span> <span class="main">∈</span> list <span class="free">n</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">&lt;</span> length <span class="bound">ss</span> <span class="main">⟹</span> <span class="var">?P</span> <span class="bound">ss</span> <span class="skolem">ps'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ps' <span class="keyword1"><span class="command">by</span></span> <span class="operator">iprover</span>

  <span class="keyword1"><span class="command">from</span></span> is_semi <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"closed  <span class="free">A</span> <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>semilat_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> ss ab
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ss</span><span class="main">[</span><span class="skolem">a</span> <span class="main">:=</span> <span class="skolem">b</span> ⊔<span class="hidden">⇘</span><sub><span class="free">f</span></sub><span class="hidden">⇙</span> <span class="skolem">ss</span><span class="main">!</span><span class="skolem">a</span><span class="main">]</span> <span class="main">∈</span> list <span class="free">n</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>closedD<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> l <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">&lt;</span> length <span class="main">(</span><span class="skolem">ss</span><span class="main">[</span><span class="skolem">a</span> <span class="main">:=</span> <span class="skolem">b</span> ⊔<span class="hidden">⇘</span><sub><span class="free">f</span></sub><span class="hidden">⇙</span> <span class="skolem">ss</span><span class="main">!</span><span class="skolem">a</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">(</span><span class="skolem">ss</span><span class="main">[</span><span class="skolem">a</span> <span class="main">:=</span> <span class="skolem">b</span> ⊔<span class="hidden">⇘</span><sub><span class="free">f</span></sub><span class="hidden">⇙</span> <span class="skolem">ss</span><span class="main">!</span><span class="skolem">a</span><span class="main">]</span><span class="main">)</span> <span class="skolem">ps'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> IH<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> p' l
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">ss</span> <span class="main">(</span><span class="skolem">p'</span><span class="main">#</span><span class="skolem">ps'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Dom_Kildall_Property-length_merges"><span class="command">lemma</span></span> length_merges <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ss</span><span class="main">.</span> size<span class="main">(</span>merges <span class="free">f</span> <span class="free">ps</span> <span class="bound">ss</span><span class="main">)</span> <span class="main">=</span> size <span class="bound">ss</span>"</span></span>
<span class="comment1">(*&lt;*)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ps</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> <span class="comment1">(*&gt;*)</span>

<span class="keyword1" id="Dom_Kildall_Property-merges_preserves_type_lemma"><span class="command">lemma</span></span> merges_preserves_type_lemma<span class="main">:</span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">xs</span><span class="main">.</span> <span class="bound">xs</span> <span class="main">∈</span> list <span class="free">n</span> <span class="free">A</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span><span class="main">.</span> <span class="bound">p</span><span class="main">&lt;</span><span class="free">n</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">)</span> <span class="main">⟶</span> merges <span class="free">f</span> <span class="free">ps</span> <span class="bound">xs</span> <span class="main">∈</span> list <span class="free">n</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">insert</span> is_semi<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> semilat_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> closed_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ps</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>  
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Dom_Kildall_Property-merges_preserves_type"><span class="command">lemma</span></span> merges_preserves_type <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">xs</span> <span class="main">∈</span> list <span class="free">n</span> <span class="free">A</span><span class="main">;</span> <span class="main">∀</span><span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span><span class="main">.</span> <span class="bound">p</span><span class="main">&lt;</span><span class="free">n</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">∈</span><span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span> merges <span class="free">f</span> <span class="free">ps</span> <span class="free">xs</span> <span class="main">∈</span> list <span class="free">n</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> merges_preserves_type_lemma<span class="main">)</span>

<span class="keyword1"><span class="command">declare</span></span> sorted_list_of_set_insert<span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>                                      

<span class="keyword1"><span class="command">lemmas</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> Let_def Semilat.le_iff_plus_unchanged <span class="main">[</span><span class="operator">OF</span> Semilat.intro<span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span>

<span class="keyword1" id="Dom_Kildall_Property-decomp_propa"><span class="command">lemma</span></span> decomp_propa<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ss</span> <span class="bound">w</span><span class="main">.</span> 
   <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span><span class="bound">t</span><span class="main">)</span><span class="main">∈</span>set <span class="free">qs</span><span class="main">.</span> <span class="bound">q</span> <span class="main">&lt;</span> size <span class="bound">ss</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">)</span> <span class="main">⟹</span> 
   sorted <span class="bound">w</span> <span class="main">⟹</span> 
   set <span class="bound">ss</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">⟹</span> 
   propa <span class="free">f</span> <span class="free">qs</span> <span class="bound">ss</span> <span class="bound">w</span> <span class="main">=</span> <span class="main">(</span>merges <span class="free">f</span> <span class="free">qs</span> <span class="bound">ss</span><span class="main">,</span> <span class="main">(</span>sorted_list_of_set <span class="main">(</span><span class="main">{</span><span class="bound">q</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t</span><span class="main">.</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span><span class="bound">t</span><span class="main">)</span><span class="main">∈</span>set <span class="free">qs</span> <span class="main">∧</span> <span class="bound">t</span> ⊔<span class="hidden">⇘</span><sub><span class="free">f</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="bound">ss</span><span class="main">!</span><span class="bound">q</span><span class="main">)</span> <span class="main">≠</span> <span class="bound">ss</span><span class="main">!</span><span class="bound">q</span><span class="main">}</span> <span class="main">∪</span> set <span class="bound">w</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="comment1">(*&lt;*)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">qs</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>sorted_less_set_eq<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sorted_less_sorted_list_of_set Semilat.closed_f<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Semilat.intro<span class="main"><span class="main">,</span></span> <span class="operator">OF</span> is_semi<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>   
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> arg_cong<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nth_list_update<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> arg_cong<span class="main">)</span>

<span class="keyword1" id="Dom_Kildall_Property-distinct_pair_filter_n"><span class="command">lemma</span></span> distinct_pair_filter_n<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map fst <span class="free">xs</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">∉</span> set <span class="main">(</span>map fst <span class="free">xs</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span>map snd <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">a</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distinct_map_filter image_def<span class="main">)</span>

<span class="keyword1" id="Dom_Kildall_Property-map_fst"><span class="command">lemma</span></span> map_fst<span class="main">:</span> <span class="quoted"><span class="quoted">"map fst <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">pc</span><span class="main">.</span> <span class="main">(</span><span class="bound">pc</span><span class="main">,</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span>  <span class="free">xs</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Dom_Kildall_Property-distinct_p"><span class="command">lemma</span></span> distinct_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟶</span> distinct <span class="main">(</span>map fst <span class="main">(</span><span class="free">step</span> <span class="free">p</span> <span class="main">(</span><span class="free">ss</span><span class="main">!</span><span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?qs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">step</span> <span class="free">p</span> <span class="main">(</span><span class="free">ss</span><span class="main">!</span><span class="free">p</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map fst <span class="var">?qs</span> <span class="main">=</span> <span class="main">(</span>rev <span class="main">(</span>sorted_list_of_set<span class="main">(</span>succs <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> map_fst<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>rev <span class="main">(</span>sorted_list_of_set<span class="main">(</span>succs <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>step_def exec_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Dom_Kildall_Property-distinct_pair_filter"><span class="command">lemma</span></span> distinct_pair_filter<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map fst <span class="free">xs</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span><span class="main">∈</span> set <span class="free">xs</span> <span class="main">⟹</span> map snd <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> fst <span class="bound">x</span> <span class="main">=</span> <span class="free">a</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span><span class="free">b</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distinct_map_filter image_def<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="skolem">xs</span><span class="main">.</span> <span class="free">a</span> <span class="main">≠</span> fst <span class="bound">x</span> "</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">" distinct <span class="main">(</span>map fst <span class="skolem">xs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"filter <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> fst <span class="bound">x</span> <span class="main">=</span> <span class="free">a</span><span class="main">)</span> <span class="skolem">xs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">xs</span></span><span class="main">)</span>  <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Dom_Kildall_Property-split_comp_eq_pair"><span class="command">lemma</span></span> split_comp_eq_pair<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> fst <span class="bound">x</span> <span class="main">=</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> split_comp_eq<span class="main">)</span>

<span class="keyword1" id="Dom_Kildall_Property-distinct_pair_filter'"><span class="command">lemma</span></span> distinct_pair_filter'<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map fst <span class="free">xs</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span><span class="main">∈</span> set <span class="free">xs</span> <span class="main">⟹</span> <span class="main">(</span>map snd <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">a</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span><span class="free">b</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> distinct_pair_filter <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> split_comp_eq_pair<span class="main">)</span>

<span class="keyword1" id="Dom_Kildall_Property-merges_property1"><span class="command">lemma</span></span> merges_property1<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">ss</span> <span class="free">w</span> <span class="free">qs</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> step_bounded_pres<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span> <span class="bound">τ</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">qs</span><span class="main">.</span> <span class="bound">q</span> <span class="main">&lt;</span> size <span class="free">ss</span> <span class="main">∧</span> <span class="bound">τ</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> subset_ss_A<span class="main">:</span>       <span class="quoted"><span class="quoted">"set <span class="free">ss</span> <span class="main">⊆</span> <span class="free">A</span> "</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> len_ss_n<span class="main">:</span>          <span class="quoted"><span class="quoted">"length <span class="free">ss</span> <span class="main">=</span> <span class="free">n</span> "</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> dist<span class="main">:</span>              <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map fst <span class="free">qs</span><span class="main">)</span> "</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span> <span class="bound">τ</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">qs</span><span class="main">.</span> merges <span class="free">f</span> <span class="free">qs</span> <span class="free">ss</span><span class="main">!</span><span class="bound">q</span> <span class="main">=</span> <span class="bound">τ</span> ⊔<span class="hidden">⇘</span><sub><span class="free">f</span></sub><span class="hidden">⇙</span><span class="free">ss</span><span class="main">!</span><span class="bound">q</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="free">qs</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> dist <span class="keyword1"><span class="command">have</span></span> τ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span> <span class="bound">τ</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">qs</span><span class="main">.</span> <span class="main">(</span>map snd <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">q</span><span class="main">)</span> <span class="free">qs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span><span class="bound">τ</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> distinct_pair_filter' <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>  
  <span class="keyword1"><span class="command">from</span></span> len_ss_n subset_ss_A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">ss</span> <span class="main">∈</span> list <span class="free">n</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> listI<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> step_bounded_pres <span class="keyword1"><span class="command">have</span></span> merge_nth<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span> <span class="bound">τ</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">qs</span><span class="main">.</span> <span class="main">(</span>merges <span class="free">f</span> <span class="free">qs</span> <span class="free">ss</span><span class="main">)</span><span class="main">!</span><span class="bound">q</span> <span class="main">=</span> map snd <span class="main">[</span><span class="main">(</span><span class="bound">p'</span><span class="main">,</span><span class="bound">t'</span><span class="main">)</span> <span class="main">←</span> <span class="free">qs</span><span class="main">.</span> <span class="bound">p'</span><span class="main">=</span><span class="bound">q</span><span class="main">]</span> ⨆<span class="hidden">⇘</span><sub><span class="free">f</span></sub><span class="hidden">⇙</span> <span class="free">ss</span><span class="main">!</span><span class="bound">q</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>nth_merges<span class="main">)</span> <span class="comment1">― ‹use lemma:  listE_length›</span>
  <span class="keyword1"><span class="command">with</span></span> τ <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span> <span class="bound">τ</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">qs</span><span class="main">.</span> <span class="main">(</span>merges <span class="free">f</span> <span class="free">qs</span> <span class="free">ss</span><span class="main">)</span><span class="main">!</span><span class="bound">q</span> <span class="main">=</span> <span class="main">[</span><span class="bound">τ</span><span class="main">]</span>⨆<span class="hidden">⇘</span><sub><span class="free">f</span></sub><span class="hidden">⇙</span> <span class="free">ss</span><span class="main">!</span><span class="bound">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">case</span> <span class="skolem">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">q</span><span class="main">,</span> <span class="bound">τ</span><span class="main">)</span> <span class="main">⇒</span> merges <span class="free">f</span> <span class="free">qs</span> <span class="free">ss</span> <span class="main">!</span> <span class="bound">q</span> <span class="main">=</span> <span class="bound">τ</span> ⊔<span class="hidden">⇘</span><sub><span class="free">f</span></sub><span class="hidden">⇙</span> <span class="free">ss</span> <span class="main">!</span> <span class="bound">q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">`<span class="skolem">x</span> <span class="main">∈</span> set <span class="free">qs</span>`</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Dom_Kildall_Property-propa_property1"><span class="command">lemma</span></span> propa_property1<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">ss</span> <span class="free">w</span> <span class="free">qs</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> step_bounded_pres<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span> <span class="bound">τ</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">qs</span><span class="main">.</span> <span class="bound">q</span> <span class="main">&lt;</span> size <span class="free">ss</span> <span class="main">∧</span> <span class="bound">τ</span> <span class="main">∈</span> <span class="free">A</span>  "</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> sorted_w<span class="main">:</span>          <span class="quoted"><span class="quoted">"sorted <span class="main">(</span><span class="free">w</span> <span class="main">::</span>nat list<span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> subset_ss_A<span class="main">:</span>       <span class="quoted"><span class="quoted">"set <span class="free">ss</span> <span class="main">⊆</span> <span class="free">A</span> "</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> len_ss_n<span class="main">:</span>          <span class="quoted"><span class="quoted">"length <span class="free">ss</span> <span class="main">=</span> <span class="free">n</span> "</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> dist<span class="main">:</span>              <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map fst <span class="free">qs</span><span class="main">)</span> "</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span> <span class="bound">τ</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">qs</span><span class="main">.</span> <span class="main">(</span>fst<span class="main">(</span>propa <span class="free">f</span> <span class="free">qs</span> <span class="free">ss</span> <span class="free">w</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="bound">q</span> <span class="main">=</span> <span class="bound">τ</span> ⊔<span class="hidden">⇘</span><sub><span class="free">f</span></sub><span class="hidden">⇙</span><span class="free">ss</span><span class="main">!</span><span class="bound">q</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>propa <span class="free">f</span> <span class="free">qs</span> <span class="free">ss</span> <span class="free">w</span><span class="main">)</span> <span class="main">=</span> merges <span class="free">f</span> <span class="free">qs</span> <span class="free">ss</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> merges_property1<span class="main">)</span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>decomp_propa<span class="main">)</span>

<span class="keyword1" id="Dom_Kildall_Property-merges_property2"><span class="command">lemma</span></span> merges_property2<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">ss</span> <span class="free">w</span> <span class="free">qs</span> <span class="free">q</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> step_bounded_pres<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span> <span class="bound">τ</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">qs</span><span class="main">.</span> <span class="bound">q</span> <span class="main">&lt;</span> size <span class="free">ss</span> <span class="main">∧</span> <span class="bound">τ</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> subset_ss_A<span class="main">:</span>       <span class="quoted"><span class="quoted">"set <span class="free">ss</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> len_ss_n<span class="main">:</span>          <span class="quoted"><span class="quoted">"length <span class="free">ss</span> <span class="main">=</span> <span class="free">n</span> "</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> dist<span class="main">:</span>              <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map fst <span class="free">qs</span><span class="main">)</span> "</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> q_nin<span class="main">:</span>             <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∉</span> set<span class="main">(</span>map fst <span class="free">qs</span><span class="main">)</span> "</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> q_lt_len_ss<span class="main">:</span>       <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">&lt;</span> length <span class="free">ss</span> "</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>merges <span class="free">f</span> <span class="free">qs</span> <span class="free">ss</span><span class="main">)</span><span class="main">!</span><span class="free">q</span> <span class="main">=</span> <span class="free">ss</span><span class="main">!</span><span class="free">q</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span> 
  <span class="keyword1"><span class="command">from</span></span> len_ss_n subset_ss_A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">ss</span> <span class="main">∈</span> list <span class="free">n</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> listI<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> step_bounded_pres q_lt_len_ss <span class="keyword1"><span class="command">have</span></span> merge_nth<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>merges <span class="free">f</span> <span class="free">qs</span> <span class="free">ss</span><span class="main">)</span><span class="main">!</span><span class="free">q</span> <span class="main">=</span> map snd <span class="main">[</span><span class="main">(</span><span class="bound">p'</span><span class="main">,</span><span class="bound">t'</span><span class="main">)</span> <span class="main">←</span> <span class="free">qs</span><span class="main">.</span> <span class="bound">p'</span><span class="main">=</span><span class="free">q</span><span class="main">]</span> ⨆<span class="hidden">⇘</span><sub><span class="free">f</span></sub><span class="hidden">⇙</span> <span class="free">ss</span><span class="main">!</span><span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>nth_merges<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> dist <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∉</span> set<span class="main">(</span>map fst <span class="free">qs</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span>map snd <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">q</span><span class="main">)</span> <span class="free">qs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> distinct_pair_filter_n <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">with</span></span> merge_nth q_nin <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>merges <span class="free">f</span> <span class="free">qs</span> <span class="free">ss</span><span class="main">)</span><span class="main">!</span><span class="free">q</span> <span class="main">=</span> <span class="main">[]</span>⨆<span class="hidden">⇘</span><sub><span class="free">f</span></sub><span class="hidden">⇙</span> <span class="free">ss</span><span class="main">!</span><span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>merges <span class="free">f</span> <span class="free">qs</span> <span class="free">ss</span><span class="main">)</span><span class="main">!</span><span class="free">q</span> <span class="main">=</span>  <span class="free">ss</span> <span class="main">!</span> <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Dom_Kildall_Property-propa_property2"><span class="command">lemma</span></span> propa_property2<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">ss</span> <span class="free">w</span> <span class="free">qs</span> <span class="free">q</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> step_bounded_pres<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span> <span class="bound">τ</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">qs</span><span class="main">.</span> <span class="bound">q</span> <span class="main">&lt;</span> size <span class="free">ss</span> <span class="main">∧</span> <span class="bound">τ</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> sorted_w<span class="main">:</span>          <span class="quoted"><span class="quoted">"sorted <span class="main">(</span><span class="free">w</span> <span class="main">::</span>nat list<span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> subset_ss_A<span class="main">:</span>       <span class="quoted"><span class="quoted">"set <span class="free">ss</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> len_ss_n<span class="main">:</span>          <span class="quoted"><span class="quoted">"length <span class="free">ss</span> <span class="main">=</span> <span class="free">n</span> "</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> dist<span class="main">:</span>              <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map fst <span class="free">qs</span><span class="main">)</span> "</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> q_nin<span class="main">:</span>             <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∉</span> set<span class="main">(</span>map fst <span class="free">qs</span><span class="main">)</span> "</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> q_lt_len_ss<span class="main">:</span>       <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">&lt;</span> length <span class="free">ss</span> "</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>fst<span class="main">(</span>propa <span class="free">f</span> <span class="free">qs</span> <span class="free">ss</span> <span class="free">w</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="free">q</span> <span class="main">=</span> <span class="free">ss</span><span class="main">!</span><span class="free">q</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>propa <span class="free">f</span> <span class="free">qs</span> <span class="free">ss</span> <span class="free">w</span><span class="main">)</span> <span class="main">=</span> merges <span class="free">f</span> <span class="free">qs</span> <span class="free">ss</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> merges_property2<span class="main">)</span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>decomp_propa<span class="main">)</span>

<span class="keyword1" id="Dom_Kildall_Property-merges_incr_lemma"><span class="command">lemma</span></span> merges_incr_lemma<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">xs</span><span class="main">.</span> <span class="bound">xs</span> <span class="main">∈</span> list <span class="free">n</span> <span class="free">A</span> <span class="main">⟶</span> distinct <span class="main">(</span>map fst <span class="free">ps</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span><span class="main">∈</span>set <span class="free">ps</span><span class="main">.</span> <span class="bound">p</span><span class="main">&lt;</span>size <span class="bound">xs</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">xs</span> [⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>] merges <span class="free">f</span> <span class="free">ps</span> <span class="bound">xs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> strip<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span>
  <span class="keyword3"><span class="command">assume</span></span> xs_inA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">∈</span> list <span class="free">n</span> <span class="free">A</span> "</span></span> 
     <span class="keyword2"><span class="keyword">and</span></span> step_bounded_pres<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">p</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">∈</span>set <span class="free">ps</span><span class="main">.</span> <span class="bound">p</span> <span class="main">&lt;</span> length <span class="skolem">xs</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> dist<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map fst <span class="free">ps</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> len_xs_n<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">xs</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> subset_xs_inA<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">xs</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>listE_length<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> step_bounded_pres dist <span class="keyword1"><span class="command">have</span></span> merge1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span> <span class="bound">τ</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span><span class="main">.</span> <span class="main">(</span>merges <span class="free">f</span> <span class="free">ps</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">!</span><span class="bound">q</span> <span class="main">=</span> <span class="bound">τ</span> ⊔<span class="hidden">⇘</span><sub><span class="free">f</span></sub><span class="hidden">⇙</span><span class="skolem">xs</span><span class="main">!</span><span class="bound">q</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> merges_property1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> step_bounded_pres dist len_xs_n subset_xs_inA  
  <span class="keyword1"><span class="command">have</span></span> merge2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">q</span><span class="main">.</span> <span class="bound">q</span> <span class="main">∉</span> set<span class="main">(</span>map fst <span class="free">ps</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">q</span> <span class="main">&lt;</span> length <span class="skolem">xs</span> <span class="main">⟶</span> <span class="main">(</span>merges <span class="free">f</span> <span class="free">ps</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">!</span><span class="bound">q</span> <span class="main">=</span> <span class="skolem">xs</span><span class="main">!</span><span class="bound">q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> merges_property2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
  <span class="keyword1"><span class="command">have</span></span> len_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">xs</span> <span class="main">=</span> length <span class="main">(</span>merges <span class="free">f</span> <span class="free">ps</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="skolem">xs</span><span class="main">.</span> <span class="skolem">xs</span><span class="main">!</span><span class="bound">i</span> ⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span> <span class="main">(</span>merges <span class="free">f</span> <span class="free">ps</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">!</span><span class="bound">i</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> strip<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword3"><span class="command">assume</span></span> i_lt_len_xs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="skolem">xs</span>"</span></span> 
    <span class="keyword1"><span class="command">with</span></span> xs_inA <span class="keyword1"><span class="command">have</span></span> xs_i_inA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span><span class="main">!</span><span class="skolem">i</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="skolem">xs</span> <span class="main">!</span> <span class="skolem">i</span> ⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span> <span class="main">(</span>merges <span class="free">f</span> <span class="free">ps</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i</span> "</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> set <span class="main">(</span>map fst <span class="free">ps</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">then</span></span>  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s'</span></span> <span class="keyword2"><span class="keyword">where</span></span> s'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">i</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> merge1 <span class="keyword1"><span class="command">have</span></span> merge1'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>merges <span class="free">f</span> <span class="free">ps</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span> <span class="main">=</span> <span class="skolem">s'</span> ⊔<span class="hidden">⇘</span><sub><span class="free">f</span></sub><span class="hidden">⇙</span> <span class="skolem">xs</span> <span class="main">!</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> s' step_bounded_pres <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>      
      <span class="keyword1"><span class="command">with</span></span> xs_i_inA merge1' <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Semilat.ub2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Semilat.intro<span class="main"><span class="main">,</span></span> <span class="operator">OF</span> is_semi<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">note</span></span> i_nin <span class="main">=</span> this
      <span class="keyword1"><span class="command">with</span></span> i_lt_len_xs merge2  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>merges <span class="free">f</span> <span class="free">ps</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">!</span><span class="skolem">i</span> <span class="main">=</span> <span class="skolem">xs</span><span class="main">!</span><span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> xs_i_inA <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Semilat.refl_r<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Semilat.intro<span class="main"><span class="main">,</span></span> <span class="operator">OF</span> is_semi<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="skolem">xs</span><span class="main">.</span> <span class="skolem">xs</span><span class="main">!</span><span class="bound">i</span> ⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span> <span class="main">(</span>merges <span class="free">f</span> <span class="free">ps</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">!</span><span class="bound">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="skolem">xs</span><span class="main">.</span> lesub <span class="main">(</span><span class="skolem">xs</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="free">r</span>  <span class="main">(</span><span class="main">(</span>merges <span class="free">f</span> <span class="free">ps</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>lesssub_def lesub_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="skolem">xs</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> lesub <span class="bound">x</span> <span class="free">r</span> <span class="bound">y</span><span class="main">)</span> <span class="main">(</span><span class="skolem">xs</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span><span class="main">(</span><span class="main">(</span>merges <span class="free">f</span> <span class="free">ps</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> nth_lt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span>length <span class="skolem">xs</span> <span class="main">⟹</span>  <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> lesub <span class="bound">x</span> <span class="free">r</span> <span class="bound">y</span><span class="main">)</span> <span class="main">(</span><span class="skolem">xs</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span><span class="main">(</span><span class="main">(</span>merges <span class="free">f</span> <span class="free">ps</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
  <span class="keyword1"><span class="command">with</span></span> len_eq <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> [⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>] merges <span class="free">f</span> <span class="free">ps</span> <span class="skolem">xs</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span>list_all2_conv_all_nth Listn.le_def lesssub_def lesub_def<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>
   
<span class="keyword1" id="Dom_Kildall_Property-merges_incr"><span class="command">lemma</span></span> merges_incr<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">xs</span> <span class="main">∈</span> list <span class="free">n</span> <span class="free">A</span><span class="main">;</span> distinct <span class="main">(</span>map fst <span class="free">ps</span><span class="main">)</span><span class="main">;</span> <span class="main">∀</span><span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span><span class="main">∈</span>set <span class="free">ps</span><span class="main">.</span> <span class="bound">p</span><span class="main">&lt;</span>size <span class="free">xs</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">xs</span> [⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>] merges <span class="free">f</span> <span class="free">ps</span> <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> merges_incr_lemma<span class="main">)</span>

<span class="keyword1" id="Dom_Kildall_Property-merges_same_conv"><span class="command">lemma</span></span> merges_same_conv <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">xs</span><span class="main">.</span> <span class="bound">xs</span> <span class="main">∈</span> list <span class="free">n</span> <span class="free">A</span> <span class="main">⟶</span> distinct <span class="main">(</span>map fst <span class="free">ps</span><span class="main">)</span> <span class="main">⟶</span>
        <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span><span class="main">∈</span>set <span class="free">ps</span><span class="main">.</span> <span class="bound">p</span><span class="main">&lt;</span>size <span class="bound">xs</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">)</span> <span class="main">⟶</span> 
        <span class="main">(</span>merges <span class="free">f</span> <span class="free">ps</span> <span class="bound">xs</span> <span class="main">=</span> <span class="bound">xs</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span><span class="main">∈</span>set <span class="free">ps</span><span class="main">.</span> <span class="bound">x</span> ⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span> <span class="bound">xs</span><span class="main">!</span><span class="bound">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">ps</span></span></span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> p x ps xs<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> context_conjI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">xs</span><span class="main">[</span><span class="improper">p</span> <span class="main">:=</span> <span class="improper">x</span> ⊔<span class="hidden">⇘</span><sub><span class="free">f</span></sub><span class="hidden">⇙</span> <span class="improper">xs</span><span class="main">!</span><span class="improper">p</span><span class="main">]</span> [⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>] <span class="improper">xs</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> le_listD 
            <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nth_list_update Semilat.plus_le_conv<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Semilat.intro<span class="main"><span class="main">,</span></span><span class="operator">OF</span> is_semi<span class="main"><span class="main">]</span></span> 
                      Semilat.ub1<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Semilat.intro<span class="main"><span class="main">,</span></span><span class="operator">OF</span> is_semi<span class="main"><span class="main">]</span></span> 
                      Semilat.ub2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Semilat.intro<span class="main"><span class="main">,</span></span><span class="operator">OF</span> is_semi<span class="main"><span class="main">]</span></span>
Semilat.lub<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Semilat.intro<span class="main"><span class="main">,</span></span><span class="operator">OF</span> is_semi<span class="main"><span class="main">]</span></span> 
 <span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> subst<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> merges_incr<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> listE_set <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> closedD listE_length <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> nth_in<span class="main"><span class="main">]</span></span>
                            Semilat.closed_f<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Semilat.intro<span class="main"><span class="main">,</span></span> <span class="operator">OF</span> is_semi<span class="main"><span class="main">]</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> strip<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> allE<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> impE<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> bspec<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Semilat.le_iff_plus_unchanged <span class="main"><span class="main">[</span></span><span class="operator">OF</span> Semilat.intro<span class="main"><span class="main">,</span></span> <span class="operator">OF</span> is_semi<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> iffD1<span class="main"><span class="main">]</span></span> list_update_same_conv <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD2<span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Semilat.le_iff_plus_unchanged<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Semilat.intro<span class="main"><span class="main">,</span></span> <span class="operator">OF</span> is_semi<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> iffD1<span class="main"><span class="main">]</span></span> list_update_same_conv <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD2<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1" id="Dom_Kildall_Property-list_update_le_listI"><span class="command">lemma</span></span> list_update_le_listI <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"set <span class="free">xs</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">⟶</span> set <span class="free">ys</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">⟶</span> <span class="free">xs</span> <span class="main">[⊑⇩</span><span class="free">r</span><span class="main">]</span> <span class="free">ys</span> <span class="main">⟶</span> <span class="free">p</span> <span class="main">&lt;</span> size <span class="free">xs</span> <span class="main">⟶</span>  
   <span class="free">x</span> <span class="main">⊑⇩</span><span class="free">r</span> <span class="free">ys</span><span class="main">!</span><span class="free">p</span> <span class="main">⟶</span> semilat<span class="main">(</span><span class="free">A</span><span class="main">,</span><span class="free">r</span><span class="main">,</span><span class="free">f</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">x</span><span class="main">∈</span><span class="free">A</span> <span class="main">⟶</span> 
   <span class="free">xs</span><span class="main">[</span><span class="free">p</span> <span class="main">:=</span> <span class="free">x</span> <span class="main">⊔⇩</span><span class="free">f</span> <span class="free">xs</span><span class="main">!</span><span class="free">p</span><span class="main">]</span> <span class="main">[⊑⇩</span><span class="free">r</span><span class="main">]</span> <span class="free">ys</span>"</span></span>
<span class="comment1">(*&lt;*)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> Listn.le_def lesub_def semilat_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_all2_conv_all_nth nth_list_update<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Dom_Kildall_Property-merges_pres_le_ub"><span class="command">lemma</span></span> merges_pres_le_ub<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"set <span class="free">ts</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>  
          <span class="quoted"><span class="quoted">"set <span class="free">ss</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">t</span><span class="main">)</span><span class="main">∈</span>set <span class="free">ps</span><span class="main">.</span> <span class="bound">t</span> ⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span> <span class="free">ts</span><span class="main">!</span><span class="bound">p</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">∧</span> <span class="bound">p</span> <span class="main">&lt;</span> size <span class="free">ts</span>"</span></span>  
          <span class="quoted"><span class="quoted">"<span class="free">ss</span> [⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>] <span class="free">ts</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"merges <span class="free">f</span> <span class="free">ps</span> <span class="free">ss</span> [⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>] <span class="free">ts</span>"</span></span>
<span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span> <span class="skolem">ts</span> <span class="skolem">ps</span>
    <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">qs</span><span class="main">.</span> <span class="main">⟦</span>set <span class="skolem">ts</span> <span class="main">⊆</span> <span class="free">A</span><span class="main">;</span> <span class="main">∀</span><span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">t</span><span class="main">)</span><span class="main">∈</span>set <span class="skolem">ps</span><span class="main">.</span> <span class="bound">t</span> ⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span> <span class="skolem">ts</span><span class="main">!</span><span class="bound">p</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">∧</span> <span class="bound">p</span><span class="main">&lt;</span> size <span class="skolem">ts</span> <span class="main">⟧</span> <span class="main">⟹</span>
          set <span class="bound">qs</span> <span class="main">⊆</span> set <span class="skolem">ps</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">ss</span><span class="main">.</span> set <span class="bound">ss</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">⟶</span> <span class="bound">ss</span> [⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>] <span class="skolem">ts</span> <span class="main">⟶</span> merges <span class="free">f</span> <span class="bound">qs</span> <span class="bound">ss</span> [⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>] <span class="skolem">ts</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="improper"><span class="quoted"><span class="improper">qs</span></span></span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm_simp</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> allE<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> impE<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule_tac</span> <span class="main"><span class="improper">[</span></span>2<span class="main"><span class="improper">]</span></span> mp<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> bspec<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> closedD  Semilat.closed_f<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Semilat.intro<span class="main"><span class="main">,</span></span> <span class="operator">OF</span> is_semi<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> bspec<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="main">)</span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> list_update_le_listI<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">insert</span> is_semi<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> this <span class="main">[</span><span class="operator">dest</span><span class="main">]</span>  
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1" id="Dom_Kildall_Property-termination_lemma"><span class="command">lemma</span></span> termination_lemma<span class="main">:</span> 
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">ss</span> <span class="main">∈</span> list <span class="free">n</span> <span class="free">A</span><span class="main">;</span> distinct <span class="main">(</span>map fst <span class="free">qs</span><span class="main">)</span><span class="main">;</span> <span class="main">∀</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span><span class="bound">t</span><span class="main">)</span><span class="main">∈</span>set <span class="free">qs</span><span class="main">.</span> <span class="bound">q</span><span class="main">&lt;</span><span class="free">n</span> <span class="main">∧</span> <span class="bound">t</span><span class="main">∈</span><span class="free">A</span><span class="main">;</span> sorted <span class="free">w</span><span class="main">;</span> <span class="free">w</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟧</span> <span class="main">⟹</span> 
        <span class="free">ss</span> <span class="main">[⊏⇩</span><span class="free">r</span><span class="main">]</span> merges <span class="free">f</span> <span class="free">qs</span> <span class="free">ss</span> <span class="main">∨</span> 
        merges <span class="free">f</span> <span class="free">qs</span> <span class="free">ss</span> <span class="main">=</span> <span class="free">ss</span> <span class="main">∧</span> 
       <span class="main">(</span>sorted_list_of_set <span class="main">(</span><span class="main">{</span><span class="bound">q</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="bound">q</span><span class="main">,</span><span class="bound">t</span><span class="main">)</span><span class="main">∈</span>set <span class="free">qs</span> <span class="main">∧</span> <span class="bound">t</span> ⊔<span class="hidden">⇘</span><sub><span class="free">f</span></sub><span class="hidden">⇙</span> <span class="free">ss</span><span class="main">!</span><span class="bound">q</span> <span class="main">≠</span> <span class="free">ss</span><span class="main">!</span><span class="bound">q</span><span class="main">}</span> <span class="main">∪</span> set <span class="main">(</span>tl <span class="free">w</span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="free">w</span><span class="main">)</span> <span class="main">∈</span>
       <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>sorted_list_of_set <span class="bound">x</span><span class="main">,</span> sorted_list_of_set <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">B</span><span class="main">)</span><span class="main">.</span> <span class="bound">A</span> <span class="main">⊂</span> <span class="bound">B</span> <span class="main">∧</span> finite <span class="bound">B</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">insert</span> is_semi<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> lesssub_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm_simp</span><span class="main"><span class="main">)</span></span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> merges_incr<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> merges_same_conv <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">,</span></span> <span class="operator">elim_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">q</span> <span class="bound">t</span><span class="main">.</span> <span class="main">¬</span><span class="main">(</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">qs</span> <span class="main">∧</span> <span class="bound">t</span> ⊔<span class="hidden">⇘</span><sub><span class="free">f</span></sub><span class="hidden">⇙</span> <span class="free">ss</span> <span class="main">!</span> <span class="bound">q</span> <span class="main">≠</span> <span class="free">ss</span> <span class="main">!</span> <span class="bound">q</span><span class="main">)</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> bspec<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span> 
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> bspec<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>      
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">q</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="bound">q</span><span class="main">,</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">qs</span> <span class="main">∧</span> <span class="bound">t</span> ⊔<span class="hidden">⇘</span><sub><span class="free">f</span></sub><span class="hidden">⇙</span> <span class="free">ss</span> <span class="main">!</span> <span class="bound">q</span> <span class="main">≠</span> <span class="free">ss</span> <span class="main">!</span> <span class="bound">q</span><span class="main">}</span> <span class="main">∪</span> set <span class="main">(</span>tl <span class="free">w</span><span class="main">)</span> <span class="main">=</span> set <span class="main">(</span>tl <span class="free">w</span><span class="main">)</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sorted_list_psub<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Dom_Kildall_Property-bounded_exec"><span class="command">lemma</span></span> bounded_exec<span class="main">:</span> <span class="quoted"><span class="quoted">"bounded <span class="free">step</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> is_semi<span class="main"><span class="keyword3">,</span></span><span class="operator">unfold</span> semilat_def bounded_def step_def exec_def transf_def <span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> n_def nodes_def verts_set fin_succs' succ_range<span class="main">)</span>

<span class="keyword1" id="Dom_Kildall_Property-bounded_exec'"><span class="command">lemma</span></span> bounded_exec'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">ss</span> <span class="free">w</span> <span class="free">a</span> <span class="free">b</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> w_n_nil<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="free">w</span> <span class="main">≠</span> <span class="main">[]</span> "</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> step_hdw<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">step</span> <span class="main">(</span>hd <span class="free">w</span><span class="main">)</span> <span class="main">(</span><span class="free">ss</span> <span class="main">!</span> hd <span class="free">w</span><span class="main">)</span><span class="main">)</span> "</span></span>      
       <span class="keyword2"><span class="keyword">and</span></span> w_lt_n<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span><span class="main">∈</span>set <span class="free">w</span><span class="main">.</span> <span class="bound">p</span> <span class="main">&lt;</span> <span class="free">n</span> "</span></span>
      <span class="keyword2"><span class="keyword">shows</span></span><span class="quoted"><span class="quoted">" <span class="free">a</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms 
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> w_lt_n <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hd <span class="free">w</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> w_n_nil <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> bounded_exec <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span> <span class="main">∀</span><span class="bound">τ</span><span class="main">.</span> <span class="main">∀</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span><span class="bound">τ'</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">step</span> <span class="main">(</span>hd <span class="free">w</span><span class="main">)</span> <span class="bound">τ</span><span class="main">)</span><span class="main">.</span> <span class="bound">q</span><span class="main">&lt;</span><span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>bounded_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> step_hdw <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">wf_dom</span> <span class="free"><span class="bound"><span class="entity">ss</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">≡</span> 
    <span class="main">(</span><span class="main">∀</span><span class="bound">τ</span><span class="main">∈</span>set <span class="free"><span class="bound"><span class="entity">ss</span></span></span><span class="main">.</span> <span class="bound">τ</span> <span class="main">∈</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> 
    <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">p</span></span> <span class="main">&lt;</span> <span class="free">n</span><span class="main">.</span> sorted <span class="main">(</span>rev <span class="main">(</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ss</span></span></span><span class="main">!</span><span class="bound">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
             <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ss</span></span></span><span class="main">!</span><span class="bound">p</span> <span class="main">≠</span> rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span> <span class="free">n</span><span class="main">]</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="main">(</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ss</span></span></span><span class="main">!</span><span class="bound">p</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
             <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ss</span></span></span><span class="main">!</span><span class="bound">p</span> <span class="main">=</span> rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span> <span class="main">⟶</span>  <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">∈</span> set <span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">p</span><span class="main">)</span><span class="main">∈</span> g_E <span class="free">G</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
             <span class="main">(</span><span class="bound">p</span> <span class="main">∉</span> set <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">⟶</span> stable <span class="free">r</span> <span class="free">step</span> <span class="free"><span class="bound"><span class="entity">ss</span></span></span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>              
    sorted <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">∧</span> length <span class="free"><span class="bound"><span class="entity">ss</span></span></span> <span class="main">=</span> <span class="free">n</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">n</span><span class="main">)</span> "</span></span>

<span class="keyword1" id="Dom_Kildall_Property-wf_dom_w"><span class="command">lemma</span></span> wf_dom_w<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"wf_dom <span class="free">ss</span> <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sorted <span class="free">w</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>wf_dom_def<span class="main">)</span>

<span class="keyword1" id="Dom_Kildall_Property-wf_dom_w2"><span class="command">lemma</span></span> wf_dom_w2<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"wf_dom <span class="free">ss</span> <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="free">w</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">n</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>wf_dom_def<span class="main">)</span>

<span class="keyword1" id="Dom_Kildall_Property-wf_dom_len_eq"><span class="command">lemma</span></span> wf_dom_len_eq<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"wf_dom <span class="free">ss</span> <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>length <span class="free">ss</span> <span class="main">=</span> <span class="free">n</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>wf_dom_def<span class="main">)</span>


<span class="keyword1" id="Dom_Kildall_Property-wf_dom_inA"><span class="command">lemma</span></span>  wf_dom_inA<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"wf_dom <span class="free">ss</span> <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ss</span> <span class="main">∈</span> list <span class="free">n</span> <span class="free">A</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>wf_dom_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> listI<span class="main">)</span>

<span class="keyword1" id="Dom_Kildall_Property-wf_dom_le"><span class="command">lemma</span></span> wf_dom_le<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> wf_ss_w<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_dom <span class="free">ss</span> <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ss</span> [⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>] <span class="free">ss</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms 
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> wf_ss_w <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="free">ss</span><span class="main">.</span> <span class="free">ss</span><span class="main">!</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>wf_dom_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="free">ss</span><span class="main">.</span> sorted <span class="main">(</span>rev <span class="main">(</span><span class="free">ss</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>A_def sorted_less_sorted_list_of_set<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Listn.le_def lesssub_def lesub_def r_def nodes_le_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>list_all2_all_nthI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Dom_Kildall_Property-pres_transf"><span class="command">lemma</span></span> pres_transf<span class="main">:</span>  
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">ss</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">p</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">&lt;</span>length <span class="bound">ss</span><span class="main">.</span> <span class="free">p</span> <span class="main">&gt;</span> <span class="bound">ss</span><span class="main">!</span><span class="bound">x</span><span class="main">)</span> <span class="main">⟶</span> transf <span class="free">p</span> <span class="bound">ss</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> strip<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> transf_def<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ss</span>  
  <span class="keyword3"><span class="command">assume</span></span>  p_lt_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> p_gt<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">x</span></span><span class="main">&lt;</span>length <span class="skolem">ss</span><span class="main">.</span> <span class="skolem">ss</span><span class="main">!</span><span class="bound">x</span> <span class="main">&lt;</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> τ_in_A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ss</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">ss</span> <span class="main">⊆</span> set nodes"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> A_def<span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> inpow_subset_nodes<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> p_lt_n <span class="keyword1"><span class="command">have</span></span> p_τ_in<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="skolem">ss</span><span class="main">)</span> <span class="main">⊆</span> set nodes"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>n_def nodes_def verts_set<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> τ_in_A <span class="keyword1"><span class="command">have</span></span> sorted_τ<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>rev <span class="skolem">ss</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>inA_is_sorted<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> p_gt <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>rev <span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="skolem">ss</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons_sorted_less_nth <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> p_τ_in <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="main">#</span> <span class="skolem">ss</span><span class="main">)</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> A_def<span class="main">)</span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> subset_nodes_inpow<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Dom_Kildall_Property-pres_exec"><span class="command">lemma</span></span> pres_exec<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">q</span><span class="main">,</span><span class="free">τ</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">step</span> <span class="free">p</span> <span class="main">(</span><span class="free">ss</span><span class="main">!</span><span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">ss</span><span class="main">!</span><span class="free">p</span><span class="main">)</span><span class="main">.</span> <span class="free">p</span> <span class="main">&gt;</span> <span class="bound">n</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">ss</span><span class="main">!</span><span class="free">p</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> 
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">∈</span> <span class="free">A</span> "</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>step_def exec_def pres_transf<span class="main">)</span>

<span class="keyword1" id="Dom_Kildall_Property-wf_hd_neq_all"><span class="command">lemma</span></span> wf_hd_neq_all<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> wf_ss_w<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_dom <span class="free">ss</span> <span class="free">w</span> "</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> w_n_nil<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">≠</span> <span class="main">[]</span> "</span></span> 
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">" <span class="free">ss</span><span class="main">!</span><span class="main">(</span>hd <span class="free">w</span><span class="main">)</span> <span class="main">≠</span> rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">ss</span> <span class="main">!</span> hd <span class="free">w</span> <span class="main">≠</span>  <span class="main">(</span>rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">note</span></span> x <span class="main">=</span> this
  <span class="keyword1"><span class="command">from</span></span> wf_ss_w <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span> set <span class="free">w</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"sorted <span class="free">w</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>wf_dom_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hd <span class="free">w</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> set <span class="free">w</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> hd <span class="free">w</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> w_n_nil <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">w</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>sorted_wrt_append<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> wf_ss_w x <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">∈</span> set <span class="free">w</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span>hd <span class="free">w</span><span class="main">)</span><span class="main">∈</span> g_E <span class="free">G</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> hd <span class="free">w</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>wf_dom_def<span class="main">)</span>  
  <span class="keyword1"><span class="command">with</span></span> y <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Dom_Kildall_Property-pres_wf_exec"><span class="command">lemma</span></span> pres_wf_exec<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">ss</span> <span class="free">w</span> <span class="free">a</span> <span class="free">b</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> wf_ss_w<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_dom <span class="free">ss</span> <span class="free">w</span> "</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> w_n_nil<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">≠</span> <span class="main">[]</span> "</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span><span class="bound">τ</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">step</span> <span class="main">(</span>hd <span class="free">w</span><span class="main">)</span> <span class="main">(</span><span class="free">ss</span><span class="main">!</span><span class="main">(</span>hd <span class="free">w</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">τ</span> <span class="main">∈</span> <span class="free">A</span> "</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> strip<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
  <span class="keyword3"><span class="command">assume</span></span> a_b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">step</span> <span class="main">(</span>hd <span class="free">w</span><span class="main">)</span> <span class="main">(</span><span class="free">ss</span> <span class="main">!</span> hd <span class="free">w</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> wf_ss_w <span class="keyword1"><span class="command">have</span></span> sorted_w<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="free">w</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> hd_w_lt_n<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="free">w</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>  
    <span class="keyword2"><span class="keyword">and</span></span> ss_hdw_inA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ss</span><span class="main">!</span>hd <span class="free">w</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> w_n_nil <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>wf_dom_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> ss_hd_w_neq_all<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ss</span><span class="main">!</span>hd <span class="free">w</span> <span class="main">≠</span> <span class="main">(</span>rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> wf_hd_neq_all<span class="main">)</span>  
  <span class="keyword1"><span class="command">with</span></span> wf_ss_w hd_w_lt_n <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="main">(</span><span class="free">ss</span><span class="main">!</span>hd <span class="free">w</span><span class="main">)</span><span class="main">.</span> hd <span class="free">w</span> <span class="main">&gt;</span> <span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>wf_dom_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> ss_hdw_inA hd_w_lt_n a_b <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> pres_exec <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Dom_Kildall_Property-propa_dom_invariant_auxi"><span class="command">lemma</span></span> propa_dom_invariant_auxi<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> wf_a_b<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_dom <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b_n_nil<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≠</span> <span class="main">[]</span> "</span></span> 
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">!</span>hd <span class="free">b</span> <span class="main">≠</span> rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span> <span class="main">∧</span>
           sorted <span class="main">(</span>rev <span class="main">(</span>hd <span class="free">b</span> <span class="main">#</span> <span class="main">(</span><span class="free">a</span><span class="main">!</span>hd <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
           set <span class="main">(</span>hd <span class="free">b</span> <span class="main">#</span> <span class="main">(</span><span class="free">a</span><span class="main">!</span>hd <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> set nodes <span class="main">∧</span>
           hd <span class="free">b</span> <span class="main">#</span> <span class="main">(</span><span class="free">a</span><span class="main">!</span>hd <span class="free">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">∧</span>
           <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span> <span class="bound">τ</span><span class="main">)</span><span class="main">∈</span>set <span class="main">(</span><span class="free">step</span> <span class="main">(</span>hd <span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="free">a</span><span class="main">!</span>hd <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">q</span> <span class="main">&lt;</span> length <span class="free">a</span> <span class="main">∧</span> <span class="bound">τ</span> <span class="main">∈</span> <span class="free">A</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">!</span>hd <span class="free">b</span> <span class="main">∈</span> <span class="main">(</span>rev <span class="main">∘</span> sorted_list_of_set<span class="main">)</span> <span class="main">`</span> <span class="main">(</span>Pow <span class="main">(</span>set nodes<span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword2"><span class="keyword">and</span></span>  sorted_hdb<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>rev <span class="main">(</span><span class="free">a</span><span class="main">!</span>hd <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span> 
              <span class="keyword2"><span class="keyword">and</span></span> hd_b_lt_n<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="free">b</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> 
              <span class="keyword2"><span class="keyword">and</span></span> sorted_b<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="free">b</span>"</span></span> 
              <span class="keyword2"><span class="keyword">and</span></span> len_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">a</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>A_def wf_dom_def<span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> as_subset_nodes<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="free">a</span><span class="main">!</span>hd <span class="free">b</span><span class="main">)</span> <span class="main">⊆</span> set nodes"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>inpow_subset_nodes<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> n_def verts_set assms nodes_def <span class="keyword1"><span class="command">have</span></span> hdb_cons_subset_nodes<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>hd <span class="free">b</span> <span class="main">#</span> <span class="main">(</span><span class="free">a</span><span class="main">!</span>hd <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> set nodes"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>wf_dom_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> hdb_subset_n<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>hd <span class="free">b</span> <span class="main">#</span> <span class="main">(</span><span class="free">a</span><span class="main">!</span>hd <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> nodes_def verts_set n_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> wf_a_b b_n_nil <span class="keyword1"><span class="command">have</span></span> a_hd_b_neq_all<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">!</span>hd <span class="free">b</span> <span class="main">≠</span> <span class="main">(</span>rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> wf_hd_neq_all <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> wf_a_b hd_b_lt_n sorted_hdb <span class="keyword1"><span class="command">have</span></span> sorted_hd_b_cons<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>rev <span class="main">(</span>hd <span class="free">b</span> <span class="main">#</span> <span class="main">(</span><span class="free">a</span><span class="main">!</span>hd <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_dom_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> Cons_sorted_less<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> hdb_cons_subset_nodes <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="main">(</span>hd <span class="free">b</span> <span class="main">#</span> <span class="main">(</span><span class="free">a</span><span class="main">!</span>hd <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> Pow <span class="main">(</span>set <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>nodes_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> pow1<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="main">(</span>hd <span class="free">b</span> <span class="main">#</span> <span class="main">(</span><span class="free">a</span><span class="main">!</span>hd <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> set nodes"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>nodes_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> hdb_cons_subset_nodes sorted_hd_b_cons <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hd <span class="free">b</span> <span class="main">#</span> <span class="main">(</span><span class="free">a</span><span class="main">!</span>hd <span class="free">b</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>rev <span class="main">∘</span> sorted_list_of_set<span class="main">)</span> <span class="main">`</span> <span class="main">(</span>Pow <span class="main">(</span>set nodes<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> subset_nodes_inpow<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> hd_b_cons_in_A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>hd <span class="free">b</span> <span class="main">#</span> <span class="main">(</span><span class="free">a</span><span class="main">!</span>hd <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> A_def <span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>nodes_def<span class="main">)</span>  

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">p</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="main">∀</span><span class="bound">τ</span><span class="main">.</span> <span class="main">∀</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span><span class="bound">τ'</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">step</span> <span class="bound">p</span> <span class="bound">τ</span><span class="main">)</span><span class="main">.</span> <span class="bound">q</span><span class="main">&lt;</span><span class="free">n</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> bounded_exec <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>bounded_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> hd_b_lt_n <span class="keyword1"><span class="command">have</span></span> bounded<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span><span class="bound">τ'</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">step</span> <span class="main">(</span>hd <span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="free">a</span><span class="main">!</span>hd <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">q</span><span class="main">&lt;</span><span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> wf_a_b b_n_nil <span class="keyword1"><span class="command">have</span></span> pres<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span> <span class="bound">τ</span><span class="main">)</span><span class="main">∈</span>set<span class="main">(</span><span class="free">step</span> <span class="main">(</span>hd <span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="free">a</span><span class="main">!</span>hd <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">τ</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pres_wf_exec<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> bounded pres <span class="keyword1"><span class="command">have</span></span> step_pres_bounded<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span> <span class="bound">τ</span><span class="main">)</span><span class="main">∈</span>set <span class="main">(</span><span class="free">step</span> <span class="main">(</span>hd <span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="free">a</span><span class="main">!</span>hd <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">q</span> <span class="main">&lt;</span> length <span class="free">a</span> <span class="main">∧</span> <span class="bound">τ</span> <span class="main">∈</span> <span class="free">A</span> "</span></span> <span class="keyword1"><span class="command">using</span></span>  len_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> a_hd_b_neq_all sorted_hd_b_cons hdb_cons_subset_nodes hd_b_cons_in_A  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Dom_Kildall_Property-propa_dom_invariant_aux"><span class="command">lemma</span></span> propa_dom_invariant_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="free">b</span> <span class="free">ss</span> <span class="free">w</span>
<span class="keyword2"><span class="keyword">assumes</span></span> propa<span class="main">:</span> <span class="quoted"><span class="quoted">"propa <span class="free">f</span> <span class="main">(</span><span class="free">step</span> <span class="main">(</span>hd <span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="free">a</span> <span class="main">!</span> hd <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="free">a</span> <span class="main">(</span>tl <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">ss</span><span class="main">,</span> <span class="free">w</span><span class="main">)</span> "</span></span>    
    <span class="keyword2"><span class="keyword">and</span></span> b_n_nil<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≠</span> <span class="main">[]</span> "</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> a_in_A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">τ</span><span class="main">∈</span>set <span class="free">a</span><span class="main">.</span> <span class="bound">τ</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>   
    <span class="keyword2"><span class="keyword">and</span></span> ass<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">p</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span>
          sorted <span class="main">(</span>rev <span class="main">(</span> <span class="main">(</span><span class="free">a</span> <span class="main">!</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
          <span class="main">(</span><span class="free">a</span><span class="main">!</span><span class="bound">p</span> <span class="main">≠</span> rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="main">(</span><span class="free">a</span><span class="main">!</span><span class="bound">p</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
          <span class="main">(</span><span class="free">a</span><span class="main">!</span><span class="bound">p</span> <span class="main">=</span> rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">∈</span>set <span class="free">b</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">p</span><span class="main">)</span><span class="main">∈</span> g_E <span class="free">G</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
          <span class="main">(</span><span class="bound">p</span> <span class="main">∉</span> set <span class="free">b</span> <span class="main">⟶</span> stable <span class="free">r</span> <span class="free">step</span> <span class="free">a</span> <span class="bound">p</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> sorted_b<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="free">b</span>  "</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> len_eq<span class="main">:</span>  <span class="quoted"><span class="quoted">"length <span class="free">a</span> <span class="main">=</span> <span class="free">n</span>  "</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> b_lt_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="free">b</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">n</span>  "</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">τ</span><span class="main">∈</span>set <span class="free">ss</span><span class="main">.</span> <span class="bound">τ</span> <span class="main">∈</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span>
         <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">p</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span>
           sorted <span class="main">(</span>rev <span class="main">(</span> <span class="main">(</span><span class="free">ss</span> <span class="main">!</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="free">ss</span><span class="main">!</span><span class="bound">p</span> <span class="main">≠</span> rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="main">(</span><span class="free">ss</span><span class="main">!</span><span class="bound">p</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="free">ss</span><span class="main">!</span><span class="bound">p</span> <span class="main">=</span> rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">∈</span> set <span class="free">w</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">p</span><span class="main">)</span><span class="main">∈</span> g_E <span class="free">G</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="bound">p</span> <span class="main">∉</span> set <span class="free">w</span> <span class="main">⟶</span> stable <span class="free">r</span> <span class="free">step</span> <span class="free">ss</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
         sorted <span class="free">w</span> <span class="main">∧</span> length <span class="free">ss</span> <span class="main">=</span> <span class="free">n</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="free">w</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span><span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms 
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?a_hdb</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">!</span>hd <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ss_hdw</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">ss</span><span class="main">!</span>hd <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ss_hdb</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">ss</span><span class="main">!</span>hd <span class="free">b</span>"</span></span> 

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?a_hdw</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">!</span>hd <span class="free">w</span>"</span></span> 

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?qs_a</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">step</span> <span class="main">(</span>hd <span class="free">b</span><span class="main">)</span> <span class="var">?a_hdb</span>"</span></span> 
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?qs_ss</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">step</span> <span class="main">(</span>hd <span class="free">w</span><span class="main">)</span> <span class="var">?ss_hdw</span>"</span></span> 
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?qs_ss_hdb</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">step</span> <span class="main">(</span>hd <span class="free">b</span><span class="main">)</span> <span class="var">?ss_hdb</span>"</span></span> 

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?q_a_wl</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">q</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t</span><span class="main">.</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span><span class="bound">t</span><span class="main">)</span><span class="main">∈</span>set <span class="var">?qs_a</span> <span class="main">∧</span> <span class="bound">t</span> ⊔<span class="hidden">⇘</span><sub><span class="free">f</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">a</span><span class="main">!</span><span class="bound">q</span><span class="main">)</span> <span class="main">≠</span> <span class="free">a</span><span class="main">!</span><span class="bound">q</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?q_ss_wl</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">q</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t</span><span class="main">.</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span><span class="bound">t</span><span class="main">)</span><span class="main">∈</span>set <span class="var">?qs_ss</span> <span class="main">∧</span> <span class="bound">t</span> ⊔<span class="hidden">⇘</span><sub><span class="free">f</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">ss</span><span class="main">!</span><span class="bound">q</span><span class="main">)</span> <span class="main">≠</span> <span class="free">ss</span><span class="main">!</span><span class="bound">q</span><span class="main">}</span>"</span></span> 

  <span class="keyword1"><span class="command">from</span></span> a_in_A len_eq <span class="keyword1"><span class="command">have</span></span> a_in_list_nA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> list <span class="free">n</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> listI<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> a_in_A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">p</span></span><span class="main">&lt;</span> length <span class="free">a</span><span class="main">.</span> <span class="free">a</span><span class="main">!</span><span class="bound">p</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>A_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> a_p_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">p</span></span><span class="main">&lt;</span> length <span class="free">a</span><span class="main">.</span> set <span class="main">(</span><span class="free">a</span><span class="main">!</span><span class="bound">p</span><span class="main">)</span> <span class="main">⊆</span> set nodes"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>inpow_subset_nodes A_def<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> a_in_A ass sorted_b len_eq b_lt_n  b_n_nil <span class="keyword1"><span class="command">have</span></span> wf_a_b<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_dom <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>wf_dom_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> b_n_nil <span class="keyword1"><span class="command">have</span></span> a_hd_b_neq_all<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?a_hdb</span> <span class="main">≠</span> rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span>"</span></span> 
                <span class="keyword2"><span class="keyword">and</span></span> sorted_hd_b_cons<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>rev <span class="main">(</span>hd <span class="free">b</span> <span class="main">#</span> <span class="var">?a_hdb</span><span class="main">)</span><span class="main">)</span>"</span></span>
                <span class="keyword2"><span class="keyword">and</span></span> hd_b_cons_in_nodes<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>hd <span class="free">b</span> <span class="main">#</span> <span class="var">?a_hdb</span><span class="main">)</span> <span class="main">⊆</span> set nodes"</span></span> 
                <span class="keyword2"><span class="keyword">and</span></span> hd_b_cons_in_A<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="free">b</span> <span class="main">#</span> <span class="var">?a_hdb</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
                <span class="keyword2"><span class="keyword">and</span></span> step_pres_bounded<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span> <span class="bound">τ</span><span class="main">)</span><span class="main">∈</span>set <span class="main">(</span><span class="free">step</span> <span class="main">(</span>hd <span class="free">b</span><span class="main">)</span> <span class="var">?a_hdb</span><span class="main">)</span><span class="main">.</span> <span class="bound">q</span> <span class="main">&lt;</span> length <span class="free">a</span> <span class="main">∧</span> <span class="bound">τ</span> <span class="main">∈</span> <span class="free">A</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> propa_dom_invariant_auxi
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> hdb_subset_n<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>hd <span class="free">b</span> <span class="main">#</span> <span class="var">?a_hdb</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> nodes_def verts_set n_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
  <span class="keyword1"><span class="command">from</span></span> b_lt_n b_n_nil <span class="keyword1"><span class="command">have</span></span> hd_b_lt_n<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="free">b</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> 
                       <span class="keyword2"><span class="keyword">and</span></span> tl_b_lt_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span> set <span class="main">(</span>tl <span class="free">b</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">b</span></span><span class="main">)</span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>wf_dom_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> dist<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map fst <span class="var">?qs_a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> distinct_p  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>   

  <span class="keyword1"><span class="command">from</span></span> b_lt_n len_eq sorted_b <span class="keyword1"><span class="command">have</span></span> sorted_tl_b<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>tl <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">b</span></span><span class="main">)</span> <span class="operator">auto</span> 

  <span class="keyword1"><span class="command">from</span></span> b_lt_n verts n_def nodes_def verts_set <span class="keyword1"><span class="command">have</span></span> b_in_verts<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="free">b</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> hd_b_in_verts<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="free">b</span> <span class="main">∈</span> set <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b_n_nil <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span>  <span class="keyword1"><span class="command">have</span></span> fin_succ_hd_b<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>succs <span class="main">(</span>hd <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fin_succs  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>    

  <span class="keyword1"><span class="command">have</span></span> fin_q1<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">q</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t</span><span class="main">.</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span><span class="bound">t</span><span class="main">)</span><span class="main">∈</span>set <span class="var">?qs_a</span><span class="main">}</span>"</span></span> 
   <span class="keyword2"><span class="keyword">and</span></span> fin_q2<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="var">?q_a_wl</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>step_def exec_def image_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="var">?q_a_wl</span> <span class="main">∪</span> set <span class="main">(</span>tl <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  
  <span class="keyword1"><span class="command">from</span></span> a_in_A <span class="keyword1"><span class="command">have</span></span> set_a<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">a</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> step_pres_bounded sorted_tl_b len_eq dist
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span> <span class="bound">τ</span><span class="main">)</span> <span class="main">∈</span> set <span class="var">?qs_a</span><span class="main">.</span> <span class="main">(</span>fst<span class="main">(</span>propa <span class="free">f</span> <span class="var">?qs_a</span> <span class="free">a</span> <span class="main">(</span>tl <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="bound">q</span> <span class="main">=</span> <span class="bound">τ</span> ⊔<span class="hidden">⇘</span><sub><span class="free">f</span></sub><span class="hidden">⇙</span><span class="free">a</span><span class="main">!</span><span class="bound">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>propa_property1<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> propa <span class="keyword1"><span class="command">have</span></span> propa_ss1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span> <span class="bound">τ</span><span class="main">)</span> <span class="main">∈</span> set <span class="var">?qs_a</span><span class="main">.</span> <span class="free">ss</span><span class="main">!</span><span class="bound">q</span> <span class="main">=</span> <span class="bound">τ</span> ⊔<span class="hidden">⇘</span><sub><span class="free">f</span></sub><span class="hidden">⇙</span><span class="free">a</span><span class="main">!</span><span class="bound">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>  
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> propa_ss1'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span> <span class="bound">τ</span><span class="main">)</span> <span class="main">∈</span> set <span class="var">?qs_a</span><span class="main">.</span> <span class="free">ss</span><span class="main">!</span><span class="bound">q</span> <span class="main">=</span>  <span class="main">(</span>hd <span class="free">b</span> <span class="main">#</span> <span class="var">?a_hdb</span><span class="main">)</span> ⊔<span class="hidden">⇘</span><sub><span class="free">f</span></sub><span class="hidden">⇙</span><span class="free">a</span><span class="main">!</span><span class="bound">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>step_def exec_def transf_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> succ_self_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span> <span class="bound">τ</span><span class="main">)</span> <span class="main">∈</span> set <span class="var">?qs_a</span><span class="main">.</span> <span class="bound">q</span> <span class="main">=</span> hd <span class="free">b</span> <span class="main">⟶</span> <span class="free">ss</span><span class="main">!</span><span class="bound">q</span> <span class="main">=</span> <span class="free">a</span><span class="main">!</span><span class="bound">q</span>"</span></span>    
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f_def nodes_sup_def plussub_def inter_sorted_cons<span class="main"><span class="main">[</span></span><span class="operator">OF</span> sorted_hd_b_cons<span class="main"><span class="main">]</span></span><span class="main">)</span>    

  <span class="keyword1"><span class="command">have</span></span> step_hd_b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span><span class="bound">τ</span><span class="main">)</span><span class="main">∈</span>set <span class="var">?qs_a</span><span class="main">.</span> <span class="bound">τ</span> <span class="main">=</span> <span class="main">(</span>hd <span class="free">b</span> <span class="main">#</span> <span class="var">?a_hdb</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>step_def exec_def transf_def<span class="main">)</span> 

  <span class="keyword1"><span class="command">from</span></span> step_pres_bounded sorted_tl_b set_a len_eq dist 
  <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">q</span><span class="main">.</span> <span class="bound">q</span> <span class="main">∉</span> set<span class="main">(</span>map fst <span class="var">?qs_a</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">q</span> <span class="main">&lt;</span> length <span class="free">a</span> <span class="main">⟹</span> <span class="main">(</span>fst<span class="main">(</span>propa <span class="free">f</span> <span class="var">?qs_a</span> <span class="free">a</span> <span class="main">(</span>tl <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="bound">q</span> <span class="main">=</span> <span class="free">a</span><span class="main">!</span><span class="bound">q</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>propa_property2<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> propa <span class="keyword1"><span class="command">have</span></span> exec2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">q</span><span class="main">.</span> <span class="bound">q</span> <span class="main">∉</span> set<span class="main">(</span>map fst <span class="var">?qs_a</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">q</span> <span class="main">&lt;</span> length <span class="free">a</span> <span class="main">⟹</span> <span class="free">ss</span><span class="main">!</span><span class="bound">q</span> <span class="main">=</span> <span class="free">a</span><span class="main">!</span><span class="bound">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ss_hd_b_eq_a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ss</span><span class="main">!</span>hd <span class="free">b</span> <span class="main">=</span> <span class="free">a</span><span class="main">!</span>hd <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hd_b_lt_n len_eq  fin_succ_hd_b succ_self_eq
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>step_def exec_def<span class="main">)</span>  
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> hdb_nin_w<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="free">b</span> <span class="main">∉</span> <span class="var">?q_a_wl</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fin_succ_hd_b propa_ss1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>step_def exec_def<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> step_pres_bounded sorted_tl_b set_a 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>propa <span class="free">f</span> <span class="var">?qs_a</span> <span class="free">a</span> <span class="main">(</span>tl <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>sorted_list_of_set <span class="main">(</span><span class="var">?q_a_wl</span> <span class="main">∪</span> set <span class="main">(</span>tl <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>decomp_propa<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> propa <span class="keyword1"><span class="command">have</span></span> ww<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">=</span> sorted_list_of_set <span class="main">(</span><span class="var">?q_a_wl</span> <span class="main">∪</span> set <span class="main">(</span>tl <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>  
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> sorted_w<span class="main">:</span><span class="quoted"><span class="quoted">"sorted <span class="free">w</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>sorted_less_sorted_list_of_set<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> ww <span class="keyword1"><span class="command">have</span></span> set_ww<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">w</span> <span class="main">=</span><span class="var">?q_a_wl</span> <span class="main">∪</span> set <span class="main">(</span>tl <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fin <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> step_pres_bounded tl_b_lt_n ww fin len_eq <span class="keyword1"><span class="command">have</span></span> w_lt_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="free">w</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> len_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> w_set'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="free">w</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> verts_set len_eq  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> w_set<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">w</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> sorted_b <span class="keyword1"><span class="command">have</span></span> hd_b_nin_tl_b<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="free">b</span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="free">b</span><span class="main">)</span> "</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">b</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>sorted_wrt_append<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> hdb_nin_w ww <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hd <span class="free">b</span> <span class="main">∉</span> set <span class="free">w</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fin <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 

  <span class="keyword1"><span class="command">from</span></span> step_pres_bounded sorted_tl_b set_a propa <span class="keyword1"><span class="command">have</span></span> ss_merge<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ss</span> <span class="main">=</span> merges <span class="free">f</span> <span class="var">?qs_a</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> decomp_propa<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> step_pres_bounded a_in_list_nA <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span> <span class="bound">τ</span><span class="main">)</span><span class="main">∈</span>set <span class="main">(</span><span class="free">step</span> <span class="main">(</span>hd <span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="free">a</span> <span class="main">!</span> hd <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">q</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">∧</span> <span class="bound">τ</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> len_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> a_in_list_nA <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"merges <span class="free">f</span> <span class="var">?qs_a</span> <span class="free">a</span>  <span class="main">∈</span> list <span class="free">n</span> <span class="free">A</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> merges_preserves_type<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> ss_merge <span class="keyword1"><span class="command">have</span></span> ss_in_A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ss</span> <span class="main">∈</span> list <span class="free">n</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> len_ss_n<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">ss</span> <span class="main">=</span> <span class="free">n</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span>  len_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> len_eq  <span class="keyword1"><span class="command">have</span></span> len_ss_n<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">ss</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> ss_in_A <span class="keyword1"><span class="command">have</span></span> set_ss<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">ss</span> <span class="main">⊆</span> <span class="free">A</span> "</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> listE_set<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ss_inA<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">τ</span><span class="main">∈</span>set <span class="free">ss</span><span class="main">.</span> <span class="bound">τ</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ss_p_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">p</span></span><span class="main">&lt;</span> length <span class="free">ss</span><span class="main">.</span>  set <span class="main">(</span><span class="free">ss</span><span class="main">!</span><span class="bound">p</span><span class="main">)</span> <span class="main">⊆</span> set nodes"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>inpow_subset_nodes A_def<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> w_lt_n len_ss_n <span class="keyword1"><span class="command">have</span></span> bounded_a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span>  <span class="free">w</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> set <span class="var">?qs_ss</span> <span class="main">⟹</span> <span class="bound">a</span> <span class="main">&lt;</span> length <span class="free">ss</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>bounded_exec'<span class="main">)</span> 

  <span class="keyword1"><span class="command">have</span></span> sorted_a_hdw_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟶</span> sorted <span class="main">(</span>rev <span class="var">?a_hdw</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> wf_a_b len_eq w_set' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>wf_dom_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> sorted_ss_hdw_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟶</span> sorted <span class="main">(</span>rev <span class="var">?ss_hdw</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> ss_in_A inA_is_sorted w_lt_n <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟶</span> <span class="main">(</span>hd <span class="free">w</span> <span class="main">#</span> <span class="var">?ss_hdw</span><span class="main">)</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> w_n_nil<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> 
    <span class="keyword1"><span class="command">with</span></span> w_lt_n <span class="keyword1"><span class="command">have</span></span> hd_w_lt_n<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="free">w</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>   
    <span class="keyword1"><span class="command">with</span></span> a_in_A <span class="keyword1"><span class="command">have</span></span> a_hdw_inA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?a_hdw</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> len_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> a_hdw_in_nodes<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="var">?a_hdw</span> <span class="main">⊆</span> set nodes"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> A_def <span class="main">)</span><span class="main">(</span><span class="operator">rule</span> inpow_subset_nodes<span class="main">)</span>

    <span class="keyword1"><span class="command">from</span></span> hd_w_lt_n <span class="keyword1"><span class="command">have</span></span> hdw_in_nodes<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="free">w</span> <span class="main">∈</span> set nodes"</span></span> <span class="keyword1"><span class="command">using</span></span> verts_set <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>n_def nodes_def<span class="main">)</span> 
    <span class="keyword1"><span class="command">from</span></span> sorted_a_hdw_n w_n_nil <span class="keyword1"><span class="command">have</span></span> sorted_a_hdw<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>rev <span class="var">?a_hdw</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>hd <span class="free">w</span> <span class="main">#</span> <span class="var">?ss_hdw</span><span class="main">)</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"hd <span class="free">w</span> <span class="main">∈</span> succs <span class="main">(</span>hd <span class="free">b</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>hd <span class="free">w</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">∈</span> set <span class="var">?qs_a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fin_succ_hd_b  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>step_def exec_def<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> step_hd_b <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="main">(</span>hd <span class="free">b</span> <span class="main">#</span> <span class="var">?a_hdb</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> s propa_ss1 <span class="keyword1"><span class="command">have</span></span> ss_hd_w<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?ss_hdw</span> <span class="main">=</span> <span class="main">(</span>hd <span class="free">b</span> <span class="main">#</span> <span class="var">?a_hdb</span><span class="main">)</span> ⊔<span class="hidden">⇘</span><sub><span class="free">f</span></sub><span class="hidden">⇙</span> <span class="var">?a_hdw</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> hd_b_cons_in_A a_hdw_inA <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ss_hdw</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Semilat.closed_f<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Semilat.intro<span class="main"><span class="main">,</span></span> <span class="operator">OF</span> is_semi<span class="main"><span class="main">]</span></span><span class="main">)</span>   
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ss_hdw_in_nodes<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="var">?ss_hdw</span> <span class="main">⊆</span> set nodes"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>inpow_subset_nodes A_def<span class="main">)</span>       
      <span class="keyword1"><span class="command">with</span></span> hdw_in_nodes <span class="keyword1"><span class="command">have</span></span> hdw_cons_ss_in_nodes<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>hd <span class="free">w</span> <span class="main">#</span> <span class="var">?ss_hdw</span><span class="main">)</span> <span class="main">⊆</span> set nodes"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> in_pow<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>hd <span class="free">w</span> <span class="main">#</span> <span class="var">?ss_hdw</span><span class="main">)</span> <span class="main">∈</span> Pow <span class="main">(</span>set <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>nodes_def<span class="main">)</span>
          
      <span class="keyword1"><span class="command">from</span></span> sorted_a_hdw ss_hd_w sorted_hd_b_cons
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>rev <span class="var">?ss_hdw</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"set <span class="var">?ss_hdw</span> <span class="main">=</span> set <span class="main">(</span>hd <span class="free">b</span> <span class="main">#</span> <span class="var">?a_hdb</span><span class="main">)</span> <span class="main">∩</span> set <span class="var">?a_hdw</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>f_def plussub_def nodes_sup_def inter_sorted_correct<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> sorted_ss_hdw<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>rev <span class="var">?ss_hdw</span><span class="main">)</span>"</span></span> 
            <span class="keyword2"><span class="keyword">and</span></span> ss_hdw_subset_a_hdb_cons<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="var">?ss_hdw</span> <span class="main">⊆</span> set <span class="main">(</span>hd <span class="free">b</span> <span class="main">#</span> <span class="var">?a_hdb</span><span class="main">)</span>"</span></span> 
            <span class="keyword2"><span class="keyword">and</span></span> ss_hdw_subset_a_hdw<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="var">?ss_hdw</span> <span class="main">⊆</span> set <span class="var">?a_hdw</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>         

      <span class="keyword1"><span class="command">from</span></span>  sorted_hd_b_cons <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span> set <span class="main">(</span>hd <span class="free">b</span> <span class="main">#</span> <span class="var">?a_hdb</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> hd <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b_n_nil 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">b</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>sorted_wrt_append<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> ss_hdw_subset_a_hdb_cons
      <span class="keyword1"><span class="command">have</span></span> ss_hdw_lt_hdb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="var">?ss_hdw</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> hd <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sorted_hd_b_cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>                   
      
      <span class="keyword1"><span class="command">have</span></span> sorted_rev_hdw<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>rev <span class="main">(</span>hd <span class="free">w</span> <span class="main">#</span> <span class="var">?ss_hdw</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="var">?a_hdw</span> <span class="main">=</span> rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">with</span></span> wf_a_b <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">∈</span> set <span class="free">b</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span>hd <span class="free">w</span><span class="main">)</span><span class="main">∈</span> g_E <span class="free">G</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> hd <span class="free">w</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hd_w_lt_n <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>wf_dom_def<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">prev_hd_w</span></span> <span class="keyword2"><span class="keyword">where</span></span> prev_hd_w_in_b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">prev_hd_w</span> <span class="main">∈</span> set <span class="free">b</span>"</span></span> 
                                <span class="keyword2"><span class="keyword">and</span></span> prev_hd_w<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">prev_hd_w</span><span class="main">,</span> hd <span class="free">w</span><span class="main">)</span><span class="main">∈</span> g_E <span class="free">G</span>"</span></span>
                                <span class="keyword2"><span class="keyword">and</span></span> prev_hd_w_lt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">prev_hd_w</span> <span class="main">&lt;</span> hd <span class="free">w</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">prev_hd_w</span> <span class="main">=</span> hd <span class="free">b</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">with</span></span> prev_hd_w_lt <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hd <span class="free">b</span> <span class="main">&lt;</span> hd <span class="free">w</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> ss_hdw_lt_hdb  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="var">?ss_hdw</span><span class="main">.</span> hd <span class="free">w</span> <span class="main">&gt;</span> <span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> sorted_ss_hdw <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>sorted_wrt_append<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">with</span></span> prev_hd_w_in_b <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">prev_hd_w</span> <span class="main">∈</span> set <span class="main">(</span>tl <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">b</span></span><span class="main">)</span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> ww <span class="keyword1"><span class="command">have</span></span> prev_hd_w_nin_w<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">prev_hd_w</span> <span class="main">∈</span> set <span class="free">w</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fin <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> sorted_w <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span> set <span class="free">w</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> hd <span class="free">w</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">w</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>sorted_wrt_append sorted_less_sorted_list_of_set<span class="main">)</span> 
          <span class="keyword1"><span class="command">with</span></span> prev_hd_w_lt <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">prev_hd_w</span> <span class="main">∉</span> set <span class="free">w</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> prev_hd_w_nin_w <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>

      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">with</span></span> wf_a_b <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="var">?a_hdw</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> hd <span class="free">w</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hd_w_lt_n <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>wf_dom_def<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> ss_hdw_subset_a_hdw
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="var">?ss_hdw</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> hd <span class="free">w</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> sorted_ss_hdw <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>sorted_wrt_append<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">with</span></span> hdw_cons_ss_in_nodes <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"hd <span class="free">w</span> <span class="main">#</span> <span class="var">?ss_hdw</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>subset_nodes_inpow<span class="main">)</span>

    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">note</span></span> hd_w_nin_succ_hdb <span class="main">=</span> this
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hd <span class="free">w</span> <span class="main">∉</span> set <span class="main">(</span>map fst <span class="var">?qs_a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fin_succ_hd_b <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>step_def exec_def<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> exec2 <span class="keyword1"><span class="command">have</span></span> ss_hd_w_eq_a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?ss_hdw</span> <span class="main">=</span> <span class="var">?a_hdw</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> hd_w_lt_n len_ss_n len_eq  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> a_hdw_in_nodes  sorted_a_hdw <span class="keyword1"><span class="command">have</span></span> ss_hdw_in_nodes<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="var">?ss_hdw</span> <span class="main">⊆</span> set nodes"</span></span> 
                                         <span class="keyword2"><span class="keyword">and</span></span> sorted_ss_hdw<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>rev <span class="var">?ss_hdw</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> hdw_in_nodes <span class="keyword1"><span class="command">have</span></span> hdw_cons_in_nodes<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>hd <span class="free">w</span> <span class="main">#</span> <span class="var">?ss_hdw</span><span class="main">)</span> <span class="main">⊆</span> set nodes"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span> 

      <span class="keyword1"><span class="command">from</span></span> hd_w_nin_succ_hdb ww <span class="keyword1"><span class="command">have</span></span> hd_w_non<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="free">w</span> <span class="main">∉</span><span class="main">{</span><span class="bound">q</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="bound">q</span><span class="main">,</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∈</span> set <span class="var">?qs_a</span> <span class="main">∧</span> <span class="bound">t</span> ⊔<span class="hidden">⇘</span><sub><span class="free">f</span></sub><span class="hidden">⇙</span> <span class="free">a</span> <span class="main">!</span> <span class="bound">q</span> <span class="main">≠</span> <span class="free">a</span> <span class="main">!</span> <span class="bound">q</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> fin_succ_hd_b <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>step_def exec_def <span class="main">)</span>

      <span class="keyword1"><span class="command">from</span></span> set_ww hd_w_non <span class="keyword1"><span class="command">have</span></span> hd_w_in_tl_b<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="free">w</span> <span class="main">∈</span> set <span class="main">(</span>tl <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sorted_tl_b <span class="quoted"><span class="quoted">`<span class="free">w</span> <span class="main">≠</span> <span class="main">[]</span>`</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>      
        
      <span class="keyword1"><span class="command">have</span></span> sorted_rev_hdw<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>rev <span class="main">(</span>hd <span class="free">w</span> <span class="main">#</span> <span class="var">?ss_hdw</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="var">?a_hdw</span> <span class="main">=</span> rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">with</span></span> wf_a_b <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">∈</span> set <span class="free">b</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span>hd <span class="free">w</span><span class="main">)</span><span class="main">∈</span> g_E <span class="free">G</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> hd <span class="free">w</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hd_w_lt_n <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>wf_dom_def<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">prev_hd_w</span></span> <span class="keyword2"><span class="keyword">where</span></span> prev_hd_w_in_b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">prev_hd_w</span> <span class="main">∈</span> set <span class="free">b</span>"</span></span> 
                                <span class="keyword2"><span class="keyword">and</span></span> prev_hd_w<span class="main">:</span>      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">prev_hd_w</span><span class="main">,</span> hd <span class="free">w</span><span class="main">)</span><span class="main">∈</span> g_E <span class="free">G</span>"</span></span> 
                                <span class="keyword2"><span class="keyword">and</span></span> prev_hd_w_lt<span class="main">:</span>   <span class="quoted"><span class="quoted">"<span class="skolem">prev_hd_w</span> <span class="main">&lt;</span> hd <span class="free">w</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> ww <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sorted <span class="free">w</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>sorted_less_sorted_list_of_set<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span> set <span class="free">w</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> hd <span class="free">w</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> w_n_nil <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">w</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>sorted_wrt_append<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> prev_hd_w_lt <span class="keyword1"><span class="command">have</span></span> prev_hd_w_nin_w<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">prev_hd_w</span> <span class="main">∉</span> set <span class="free">w</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> w_n_nil <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command">with</span></span> set_ww <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">prev_hd_w</span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> prev_hd_w_in_b <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">prev_hd_w</span> <span class="main">=</span> hd <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sorted_b <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">b</span></span><span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> prev_hd_w <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>hd <span class="free">b</span><span class="main">,</span> hd <span class="free">w</span><span class="main">)</span> <span class="main">∈</span> g_E <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command">with</span></span> hd_w_nin_succ_hdb <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>succs_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">with</span></span> wf_a_b <span class="keyword1"><span class="command">have</span></span> a_hdw_lt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="var">?a_hdw</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> hd <span class="free">w</span><span class="main">)</span>"</span></span> 
                     <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>rev <span class="var">?a_hdw</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hd_w_lt_n <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>wf_dom_def<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> ss_hd_w_eq_a <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>rev <span class="var">?ss_hdw</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">from</span></span> ss_hd_w_eq_a  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a_hdw</span> <span class="main">=</span>  <span class="var">?ss_hdw</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> a_hdw_lt <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="var">?ss_hdw</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> hd <span class="free">w</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> sorted_ss_hdw <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>sorted_wrt_append<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span> 
      <span class="keyword1"><span class="command">with</span></span> hdw_cons_in_nodes <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span>hd <span class="free">w</span> <span class="main">#</span> <span class="free">ss</span> <span class="main">!</span> hd <span class="free">w</span><span class="main">)</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> A_def<span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> subset_nodes_inpow<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>   
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> pres_ss<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">q</span> <span class="bound">τ</span><span class="main">.</span> <span class="free">w</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">q</span><span class="main">,</span> <span class="bound">τ</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">step</span> <span class="main">(</span>hd <span class="free">w</span><span class="main">)</span> <span class="var">?ss_hdw</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">τ</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>step_def exec_def transf_def<span class="main">)</span>
 
  <span class="keyword1"><span class="command">have</span></span> hd_b_ss_sta<span class="main">:</span> <span class="quoted"><span class="quoted">"stable <span class="free">r</span> <span class="free">step</span> <span class="free">ss</span> <span class="main">(</span>hd <span class="free">b</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">unfold</span> stable_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">q</span> <span class="skolem">τ</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">q</span><span class="main">,</span> <span class="skolem">τ</span><span class="main">)</span> <span class="main">∈</span> set <span class="var">?qs_ss_hdb</span> "</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> succs <span class="main">(</span>hd <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">τ</span> <span class="main">=</span> transf <span class="main">(</span>hd <span class="free">b</span><span class="main">)</span> <span class="var">?ss_hdb</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hd_b_lt_n fin_succ_hd_b
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>step_def exec_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> τ<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">τ</span> <span class="main">=</span>  <span class="main">(</span>hd <span class="free">b</span> <span class="main">#</span> <span class="var">?a_hdb</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ss_hd_b_eq_a <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>transf_def<span class="main">)</span>  
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">`<span class="skolem">q</span> <span class="main">∈</span> succs <span class="main">(</span>hd <span class="free">b</span><span class="main">)</span>`</span></span> hd_b_lt_n <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span><span class="main">∈</span> set <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> succ_in_G <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> verts_set <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>n_def nodes_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> wf_a_b <span class="keyword1"><span class="command">have</span></span> a_q_inA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">!</span><span class="skolem">q</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>wf_dom_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> wf_a_b a_hd_b_neq_all hd_b_lt_n <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span> set <span class="main">(</span> <span class="main">(</span><span class="free">a</span><span class="main">!</span>hd <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> hd <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>wf_dom_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> sorted_hd_b_cons <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>rev <span class="main">(</span>hd <span class="free">b</span> <span class="main">#</span> <span class="var">?a_hdb</span><span class="main">)</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>sorted_wrt_append<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> propa_ss1 <span class="quoted"><span class="quoted">`<span class="main">(</span><span class="skolem">q</span><span class="main">,</span> <span class="skolem">τ</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">step</span> <span class="main">(</span>hd <span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="free">ss</span> <span class="main">!</span> hd <span class="free">b</span><span class="main">)</span><span class="main">)</span>`</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">ss</span><span class="main">!</span><span class="skolem">q</span> <span class="main">=</span> <span class="skolem">τ</span> ⊔<span class="hidden">⇘</span><sub><span class="free">f</span></sub><span class="hidden">⇙</span> <span class="free">a</span> <span class="main">!</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">`<span class="free">ss</span><span class="main">!</span>hd <span class="free">b</span> <span class="main">=</span> <span class="free">a</span><span class="main">!</span>hd <span class="free">b</span>`</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> τ <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">ss</span><span class="main">!</span><span class="skolem">q</span> <span class="main">=</span>  <span class="main">(</span>hd <span class="free">b</span> <span class="main">#</span> <span class="var">?a_hdb</span><span class="main">)</span> ⊔<span class="hidden">⇘</span><sub><span class="free">f</span></sub><span class="hidden">⇙</span> <span class="free">a</span> <span class="main">!</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> hd_b_cons_in_A a_q_inA <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span>hd <span class="free">b</span> <span class="main">#</span> <span class="var">?a_hdb</span><span class="main">)</span>⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span> <span class="free">ss</span><span class="main">!</span><span class="skolem">q</span> "</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Semilat.ub1<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Semilat.intro<span class="main"><span class="main">,</span></span> <span class="operator">OF</span> is_semi<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> τ <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">τ</span> ⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span> <span class="free">ss</span> <span class="main">!</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> wf_dom_2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">p</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span>
        sorted <span class="main">(</span>rev <span class="main">(</span><span class="free">ss</span> <span class="main">!</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
        <span class="main">(</span><span class="free">ss</span> <span class="main">!</span> <span class="bound">p</span> <span class="main">≠</span> rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="main">(</span> <span class="main">(</span><span class="free">ss</span> <span class="main">!</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
        <span class="main">(</span><span class="free">ss</span> <span class="main">!</span> <span class="bound">p</span> <span class="main">=</span> rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">∈</span> set <span class="free">w</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">p</span><span class="main">)</span><span class="main">∈</span> g_E <span class="free">G</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
        <span class="main">(</span><span class="bound">p</span> <span class="main">∉</span> set <span class="free">w</span> <span class="main">⟶</span> stable <span class="free">r</span> <span class="free">step</span> <span class="free">ss</span> <span class="bound">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> strip<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?a_p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">!</span><span class="skolem">p</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ss_p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">ss</span><span class="main">!</span><span class="skolem">p</span>"</span></span>

    <span class="keyword3"><span class="command">assume</span></span> p_lt_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> 
    <span class="keyword1"><span class="command">with</span></span> wf_a_b <span class="keyword1"><span class="command">have</span></span> a_p_inA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?a_p</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> 
                 <span class="keyword2"><span class="keyword">and</span></span> sorted_a_p<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>rev <span class="var">?a_p</span><span class="main">)</span>"</span></span> 
                 <span class="keyword2"><span class="keyword">and</span></span> sta_a_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∉</span> set <span class="free">b</span> <span class="main">⟶</span> stable <span class="free">r</span> <span class="free">step</span> <span class="free">a</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>wf_dom_def<span class="main">)</span>

    <span class="keyword1"><span class="command">from</span></span> p_lt_n <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> set <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> verts_set n_def nodes_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> fin_succ_p<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>succs <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fin_succs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">from</span></span> set_a p_lt_n <span class="keyword1"><span class="command">have</span></span> a_p_inA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?a_p</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">`length <span class="free">a</span> <span class="main">=</span> <span class="free">n</span>`</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>A_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="var">?a_p</span> <span class="main">⊆</span> set nodes"</span></span> <span class="keyword1"><span class="command">using</span></span> inpow_subset_nodes <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>A_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> p_lt_n <span class="keyword1"><span class="command">have</span></span> set_p_a_p<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="skolem">p</span><span class="main">#</span><span class="var">?a_p</span><span class="main">)</span> <span class="main">⊆</span> set nodes"</span></span> <span class="keyword1"><span class="command">using</span></span> n_def nodes_def verts_set  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">from</span></span> p_lt_n len_eq <span class="keyword1"><span class="command">have</span></span> p_lt_len_a<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">&lt;</span> length <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> ss_inA  <span class="keyword1"><span class="command">have</span></span> ss_p_in_A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ss</span><span class="main">!</span><span class="skolem">p</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> len_eq len_ss_n <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> p_lt_n <span class="keyword1"><span class="command">have</span></span> sorted_ss_p<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>rev <span class="var">?ss_p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>A_def sorted_less_sorted_list_of_set<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> len_ss_eq_a<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">ss</span> <span class="main">=</span> length <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  len_eq len_ss_n <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">have</span></span> p_nin_w_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∉</span> set <span class="free">w</span> <span class="main">⟷</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">∉</span> set <span class="free">b</span> <span class="main">∨</span> <span class="skolem">p</span> <span class="main">=</span> hd <span class="free">b</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="skolem">p</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span> <span class="main">∈</span> set <span class="var">?qs_a</span> <span class="main">⟶</span> <span class="bound">s</span> ⊔<span class="hidden">⇘</span><sub><span class="free">f</span></sub><span class="hidden">⇙</span> <span class="var">?a_p</span> <span class="main">=</span> <span class="var">?a_p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∉</span> set <span class="free">w</span>"</span></span> 
      <span class="keyword1"><span class="command">with</span></span> set_ww <span class="keyword1"><span class="command">have</span></span> p_nin1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∉</span> <span class="main">{</span><span class="bound">q</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="bound">q</span><span class="main">,</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∈</span> set <span class="var">?qs_a</span><span class="main">∧</span> <span class="bound">t</span> ⊔<span class="hidden">⇘</span><sub><span class="free">f</span></sub><span class="hidden">⇙</span> <span class="free">a</span> <span class="main">!</span> <span class="bound">q</span> <span class="main">≠</span> <span class="free">a</span> <span class="main">!</span> <span class="bound">q</span><span class="main">}</span>"</span></span> 
                   <span class="keyword2"><span class="keyword">and</span></span> p_nin2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> p_nin1 <span class="keyword1"><span class="command">have</span></span> p_nin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="skolem">p</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span> <span class="main">∈</span> set <span class="var">?qs_a</span> <span class="main">⟶</span> <span class="bound">s</span> ⊔<span class="hidden">⇘</span><sub><span class="free">f</span></sub><span class="hidden">⇙</span> <span class="var">?a_p</span> <span class="main">=</span> <span class="var">?a_p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> p_nin2 <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∉</span> set <span class="free">b</span> <span class="main">∨</span> <span class="skolem">p</span> <span class="main">=</span> hd <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">b</span></span><span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> p_nin <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">p</span> <span class="main">∉</span> set <span class="free">b</span> <span class="main">∨</span> <span class="skolem">p</span> <span class="main">=</span> hd <span class="free">b</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="skolem">p</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span> <span class="main">∈</span> set  <span class="var">?qs_a</span> <span class="main">⟶</span> <span class="bound">s</span> ⊔<span class="hidden">⇘</span><sub><span class="free">f</span></sub><span class="hidden">⇙</span> <span class="var">?a_p</span> <span class="main">=</span> <span class="var">?a_p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">p</span> <span class="main">∉</span> set <span class="free">b</span> <span class="main">∨</span> <span class="skolem">p</span> <span class="main">=</span> hd <span class="free">b</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="skolem">p</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span> <span class="main">∈</span> set <span class="var">?qs_a</span> <span class="main">⟶</span> <span class="bound">s</span> ⊔<span class="hidden">⇘</span><sub><span class="free">f</span></sub><span class="hidden">⇙</span> <span class="var">?a_p</span> <span class="main">=</span> <span class="var">?a_p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> p1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∉</span> set <span class="free">b</span> <span class="main">∨</span> <span class="skolem">p</span> <span class="main">=</span> hd <span class="free">b</span>"</span></span> 
            <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="skolem">p</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span> <span class="main">∈</span> set <span class="var">?qs_a</span> <span class="main">⟶</span> <span class="bound">s</span> ⊔<span class="hidden">⇘</span><sub><span class="free">f</span></sub><span class="hidden">⇙</span> <span class="free">a</span> <span class="main">!</span> <span class="skolem">p</span> <span class="main">=</span> <span class="var">?a_p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> p1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∉</span> set <span class="main">(</span>tl <span class="free">b</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∉</span> set <span class="free">b</span>"</span></span> 
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">b</span></span><span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> hd <span class="free">b</span>"</span></span> 
        <span class="keyword1"><span class="command">with</span></span> sorted_b <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">b</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>sorted_wrt_append<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">with</span></span> p2 set_ww <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∉</span> set <span class="free">w</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> set_ww <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1"><span class="command">have</span></span> stable_ss_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∉</span> set <span class="free">w</span> <span class="main">⟶</span> <span class="free">w</span> <span class="main">≠</span> Nil <span class="main">⟶</span> stable <span class="free">r</span> <span class="free">step</span> <span class="free">ss</span> <span class="skolem">p</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stable_def split_paired_all<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">q</span> <span class="skolem">τ</span>
      <span class="keyword3"><span class="command">assume</span></span> p_nin_w<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∉</span> set <span class="free">w</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> w_n_nil<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">≠</span> Nil"</span></span> <span class="keyword2"><span class="keyword">and</span></span> step_ss_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">q</span><span class="main">,</span> <span class="skolem">τ</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">step</span> <span class="skolem">p</span> <span class="var">?ss_p</span><span class="main">)</span> "</span></span>
      <span class="keyword1"><span class="command">from</span></span> p_nin_w <span class="keyword1"><span class="command">have</span></span> p_cond<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">p</span> <span class="main">∉</span> set <span class="free">b</span> <span class="main">∨</span> <span class="skolem">p</span> <span class="main">=</span> hd <span class="free">b</span><span class="main">)</span> <span class="main">∧</span> 
                                 <span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="skolem">p</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span> <span class="main">∈</span> set <span class="var">?qs_a</span> <span class="main">⟶</span>  <span class="main">(</span>hd <span class="free">b</span> <span class="main">#</span> <span class="var">?a_hdb</span><span class="main">)</span> ⊔<span class="hidden">⇘</span><sub><span class="free">f</span></sub><span class="hidden">⇙</span> <span class="var">?a_p</span> <span class="main">=</span> <span class="var">?a_p</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> p_nin_w_eq  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>transf_def step_def exec_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> p_cond1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">p</span> <span class="main">∉</span> set <span class="free">b</span> <span class="main">∨</span> <span class="skolem">p</span> <span class="main">=</span> hd <span class="free">b</span><span class="main">)</span>"</span></span>
            <span class="keyword2"><span class="keyword">and</span></span> p_cond2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="skolem">p</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span> <span class="main">∈</span> set <span class="var">?qs_a</span> <span class="main">⟶</span>  <span class="main">(</span>hd <span class="free">b</span> <span class="main">#</span> <span class="var">?a_hdb</span><span class="main">)</span> ⊔<span class="hidden">⇘</span><sub><span class="free">f</span></sub><span class="hidden">⇙</span> <span class="var">?a_p</span> <span class="main">=</span> <span class="var">?a_p</span><span class="main">)</span>"</span></span><span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">from</span></span> bounded_a pres_ss w_n_nil <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span> <span class="bound">t</span><span class="main">)</span><span class="main">∈</span>set <span class="var">?qs_ss</span><span class="main">.</span> <span class="bound">q</span> <span class="main">&lt;</span> length <span class="free">ss</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span> <span class="bound">t</span><span class="main">)</span><span class="main">∈</span>set <span class="main">(</span><span class="free">step</span> <span class="main">(</span>hd <span class="free">w</span><span class="main">)</span> <span class="main">(</span><span class="free">ss</span> <span class="main">!</span> hd <span class="free">w</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">q</span> <span class="main">&lt;</span> length <span class="free">ss</span> <span class="main">∧</span> <span class="main">(</span>transf <span class="main">(</span>hd <span class="free">w</span><span class="main">)</span> <span class="main">(</span><span class="free">ss</span><span class="main">!</span>hd <span class="free">w</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>step_def exec_def<span class="main">)</span>         
      
      <span class="keyword1"><span class="command">have</span></span> ss_a_p_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?ss_p</span> <span class="main">=</span> <span class="var">?a_p</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> succs <span class="main">(</span>hd <span class="free">b</span><span class="main">)</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">note</span></span> p_in_succ_hd_b <span class="main">=</span> this 
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">`<span class="skolem">p</span> <span class="main">∈</span> succs <span class="main">(</span>hd <span class="free">b</span><span class="main">)</span>`</span></span> propa_ss1' <span class="keyword1"><span class="command">have</span></span> ss_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?ss_p</span> <span class="main">=</span>  <span class="main">(</span>hd <span class="free">b</span> <span class="main">#</span> <span class="var">?a_hdb</span><span class="main">)</span> ⊔<span class="hidden">⇘</span><sub><span class="free">f</span></sub><span class="hidden">⇙</span> <span class="var">?a_p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fin_succ_hd_b
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>step_def exec_def<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> p_in_succ_hd_b p_cond2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span>hd <span class="free">b</span> <span class="main">#</span> <span class="var">?a_hdb</span><span class="main">)</span> ⊔<span class="hidden">⇘</span><sub><span class="free">f</span></sub><span class="hidden">⇙</span> <span class="var">?a_p</span><span class="main">=</span> <span class="var">?a_p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fin_succ_hd_b
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>step_def exec_def<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> ss_p <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∉</span> <span class="main">{</span><span class="bound">q</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="bound">q</span><span class="main">,</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∈</span> set <span class="var">?qs_a</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fin fin_succ_hd_b  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>step_def exec_def<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∉</span> set <span class="main">(</span> map fst <span class="var">?qs_a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> p_lt_n <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> exec2 len_eq  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span> <span class="bound">τ</span><span class="main">)</span><span class="main">∈</span>set <span class="main">(</span><span class="free">step</span> <span class="skolem">p</span> <span class="var">?ss_p</span><span class="main">)</span><span class="main">.</span> transf <span class="skolem">p</span> <span class="var">?ss_p</span> ⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span> <span class="free">ss</span> <span class="main">!</span> <span class="bound">q</span><span class="main">)</span> "</span></span>      
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> strip<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">succ_p</span> <span class="skolem">z</span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?a_succ_p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">!</span><span class="skolem">succ_p</span>"</span></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ss_succ_p</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">ss</span><span class="main">!</span><span class="skolem">succ_p</span>"</span></span>         

        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">succ_p</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span>  <span class="main">∈</span> set <span class="main">(</span><span class="free">step</span> <span class="skolem">p</span> <span class="var">?ss_p</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> succ_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">succ_p</span> <span class="main">∈</span> succs <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> p_lt_n fin_succ_p <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>step_def exec_def<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> p_lt_n <span class="keyword1"><span class="command">have</span></span> succ_p_lt_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">succ_p</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> succ_in_verts  n_def nodes_def verts_set <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> wf_a_b <span class="keyword1"><span class="command">have</span></span> a_succ_p_inA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?a_succ_p</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>wf_dom_def<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> succ_p_lt_n ss_in_A <span class="keyword1"><span class="command">have</span></span> ss_succ_p_inA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?ss_succ_p</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 

        <span class="keyword1"><span class="command">have</span></span> p_nin_b_ssp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∉</span> set <span class="free">b</span> <span class="main">⟹</span> transf <span class="skolem">p</span> <span class="var">?ss_p</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">∧</span> transf <span class="skolem">p</span> <span class="var">?ss_p</span> <span class="main">⊑⇩</span><span class="free">r</span> <span class="var">?a_succ_p</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∉</span> set <span class="free">b</span>"</span></span>
          <span class="keyword1"><span class="command">with</span></span> sta_a_p <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span><span class="bound">τ</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">step</span> <span class="skolem">p</span> <span class="var">?a_p</span><span class="main">)</span><span class="main">.</span> <span class="bound">τ</span> <span class="main">⊑⇩</span><span class="free">r</span> <span class="free">a</span><span class="main">!</span><span class="bound">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>stable_def<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> succ_p <span class="keyword1"><span class="command">have</span></span> transf_p_succp'<span class="main">:</span><span class="quoted"><span class="quoted">"transf <span class="skolem">p</span> <span class="var">?a_p</span> <span class="main">⊑⇩</span><span class="free">r</span> <span class="var">?a_succ_p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fin_succ_p 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>stable_def step_def exec_def<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> ss_a_p_eq <span class="keyword1"><span class="command">have</span></span> transf_lt_p<span class="main">:</span> <span class="quoted"><span class="quoted">"transf <span class="skolem">p</span> <span class="var">?ss_p</span> <span class="main">⊑⇩</span><span class="free">r</span> <span class="var">?a_succ_p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> transf_p_succp' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">p</span><span class="main">#</span> <span class="var">?a_p</span><span class="main">)</span> <span class="main">⊑⇩</span><span class="free">r</span> <span class="var">?a_succ_p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>transf_def<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>rev <span class="main">(</span><span class="skolem">p</span><span class="main">#</span><span class="var">?a_p</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">p</span><span class="main">#</span><span class="var">?a_p</span> <span class="main">=</span> <span class="var">?a_succ_p</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>step_def exec_def transf_def r_def lesssub_def lesub_def nodes_le_def<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> set_p_a_p a_succ_p_inA
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">p</span><span class="main">#</span><span class="var">?a_p</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>rev <span class="main">∘</span> sorted_list_of_set<span class="main">)</span> <span class="main">`</span> <span class="main">(</span>Pow <span class="main">(</span>set nodes<span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> subset_nodes_inpow <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>A_def<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"transf <span class="skolem">p</span> <span class="var">?a_p</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> transf_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>A_def transf_def<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> ss_a_p_eq transf_lt_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
              
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"transf <span class="skolem">p</span> <span class="var">?ss_p</span> ⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span> <span class="var">?ss_succ_p</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> succs <span class="main">(</span>hd <span class="free">b</span><span class="main">)</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">note</span></span> p_in_succ_hd_b <span class="main">=</span> this   
          <span class="keyword1"><span class="command">with</span></span> p_cond <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span>hd <span class="free">b</span> <span class="main">#</span> <span class="var">?a_hdb</span><span class="main">)</span> ⊔<span class="hidden">⇘</span><sub><span class="free">f</span></sub><span class="hidden">⇙</span> <span class="var">?a_p</span> <span class="main">=</span><span class="var">?a_p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fin_succ_hd_b
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>step_def exec_def<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> p_in_succ_hd_b propa_ss1' <span class="keyword1"><span class="command">have</span></span> ss_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?ss_p</span> <span class="main">=</span> <span class="main">(</span>hd <span class="free">b</span> <span class="main">#</span> <span class="var">?a_hdb</span><span class="main">)</span> ⊔<span class="hidden">⇘</span><sub><span class="free">f</span></sub><span class="hidden">⇙</span> <span class="var">?a_p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fin_succ_hd_b
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>step_def exec_def<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> transf_p2<span class="main">:</span> <span class="quoted"><span class="quoted">"transf <span class="skolem">p</span> <span class="var">?ss_p</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">#</span> <span class="main">(</span>inter_sorted_rev <span class="main">(</span>hd <span class="free">b</span> <span class="main">#</span> <span class="var">?a_hdb</span><span class="main">)</span> <span class="var">?a_p</span><span class="main">)</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>f_def plussub_def nodes_sup_def transf_def <span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">succ_p</span> <span class="main">∈</span> succs <span class="main">(</span>hd <span class="free">b</span><span class="main">)</span>"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">note</span></span> succ_p_is_succ_hdb <span class="main">=</span> this
            <span class="keyword1"><span class="command">with</span></span> propa_ss1 <span class="keyword1"><span class="command">have</span></span> ss_succ_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?ss_succ_p</span> <span class="main">=</span> <span class="main">(</span>hd <span class="free">b</span> <span class="main">#</span> <span class="var">?a_hdb</span><span class="main">)</span> ⊔<span class="hidden">⇘</span><sub><span class="free">f</span></sub><span class="hidden">⇙</span> <span class="var">?a_succ_p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fin_succ_hd_b
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>step_def exec_def transf_def<span class="main">)</span>
            <span class="keyword1"><span class="command">with</span></span> a_succ_p_inA hd_b_cons_in_A  <span class="keyword1"><span class="command">have</span></span> succ_p1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>hd <span class="free">b</span> <span class="main">#</span> <span class="var">?a_hdb</span><span class="main">)</span> ⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span><span class="var">?ss_succ_p</span>"</span></span> 
                                               <span class="keyword2"><span class="keyword">and</span></span> succ_p2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?a_succ_p</span>⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span> <span class="var">?ss_succ_p</span> "</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Semilat.ub1<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Semilat.intro<span class="main"><span class="main">,</span></span> <span class="operator">OF</span> is_semi<span class="main"><span class="main">]</span></span>
                                Semilat.ub2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Semilat.intro<span class="main"><span class="main">,</span></span> <span class="operator">OF</span> is_semi<span class="main"><span class="main">]</span></span><span class="main">)</span>           
            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> set <span class="free">b</span>"</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">note</span></span> p_in_set_b <span class="main">=</span> this
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> p_eq_hdb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> hd <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> p_cond <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">with</span></span> succ_p <span class="keyword1"><span class="command">have</span></span> succ_p_is_succ_hdb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">succ_p</span> <span class="main">∈</span> succs <span class="main">(</span>hd <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">from</span></span> ss_a_p_eq p_eq_hdb <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>hd <span class="free">b</span> <span class="main">#</span> <span class="var">?ss_hdb</span><span class="main">)</span> <span class="main">=</span> hd <span class="free">b</span> <span class="main">#</span> <span class="var">?a_hdb</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">with</span></span> succ_p1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hd <span class="free">b</span> <span class="main">#</span> <span class="free">ss</span> <span class="main">!</span> hd <span class="free">b</span> ⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span> <span class="free">ss</span> <span class="main">!</span> <span class="skolem">succ_p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">with</span></span> p_eq_hdb <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>transf_def<span class="main">)</span>             
            <span class="keyword1"><span class="command">next</span></span> 
              <span class="keyword3"><span class="command">case</span></span> False
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"transf <span class="skolem">p</span> <span class="var">?ss_p</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"transf <span class="skolem">p</span> <span class="var">?ss_p</span> <span class="main">⊑⇩</span><span class="free">r</span> <span class="var">?a_succ_p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> p_nin_b_ssp <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>                       
              <span class="keyword1"><span class="command">with</span></span> succ_p2 a_succ_p_inA ss_succ_p_inA  
              <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> order_trans Semilat.orderI<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Semilat.intro<span class="main"><span class="main">,</span></span> <span class="operator">OF</span> is_semi<span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">note</span></span> succ_p_n_succ_hdb <span class="main">=</span> this
            <span class="keyword1"><span class="command">with</span></span> exec2 <span class="keyword1"><span class="command">have</span></span> ss_succ_p_eq_a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?ss_succ_p</span> <span class="main">=</span> <span class="var">?a_succ_p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fin_succ_hd_b succ_p_lt_n  len_eq 
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>step_def exec_def<span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> set <span class="free">b</span>"</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">case</span></span> True
              <span class="keyword1"><span class="command">with</span></span> p_cond <span class="keyword1"><span class="command">have</span></span> p_eq_hdb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> hd <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">with</span></span> succ_p <span class="keyword1"><span class="command">have</span></span> succ_p_is_succ_hdb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">succ_p</span> <span class="main">∈</span> succs <span class="main">(</span>hd <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">with</span></span> succ_p_n_succ_hdb <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">next</span></span> 
              <span class="keyword3"><span class="command">case</span></span> False
              <span class="keyword1"><span class="command">with</span></span> sta_a_p <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span><span class="bound">τ</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">step</span> <span class="skolem">p</span> <span class="var">?a_p</span><span class="main">)</span><span class="main">.</span> <span class="bound">τ</span> <span class="main">⊑⇩</span><span class="free">r</span> <span class="free">a</span><span class="main">!</span><span class="bound">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>stable_def<span class="main">)</span>
              <span class="keyword1"><span class="command">with</span></span> succ_p fin_succ_p <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"transf <span class="skolem">p</span> <span class="var">?a_p</span> <span class="main">⊑⇩</span><span class="free">r</span> <span class="var">?a_succ_p</span>"</span></span> 
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>step_def exec_def<span class="main">)</span>
              <span class="keyword1"><span class="command">with</span></span> ss_succ_p_eq_a ss_a_p_eq <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">note</span></span> p_nin_succ_hd_b <span class="main">=</span> this  
          <span class="keyword1"><span class="command">from</span></span> p_nin_succ_hd_b p_cond <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∉</span> set <span class="free">b</span> <span class="main">∨</span> <span class="skolem">p</span> <span class="main">=</span> hd <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">proof</span></span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∉</span> set <span class="free">b</span>"</span></span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> transf_ss_p_inA<span class="main">:</span> <span class="quoted"><span class="quoted">"transf <span class="skolem">p</span> <span class="var">?ss_p</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> transf_lt_p<span class="main">:</span> <span class="quoted"><span class="quoted">"transf <span class="skolem">p</span> <span class="var">?ss_p</span> <span class="main">⊑⇩</span><span class="free">r</span> <span class="var">?a_succ_p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> p_nin_b_ssp <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"transf <span class="skolem">p</span> <span class="var">?ss_p</span> ⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span> <span class="var">?ss_succ_p</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">succ_p</span> <span class="main">∈</span> succs <span class="main">(</span>hd <span class="free">b</span><span class="main">)</span>"</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">case</span></span> True
              <span class="keyword1"><span class="command">with</span></span> succ_p_lt_n propa_ss1' len_eq  fin_succ_hd_b <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ss_succ_p</span> <span class="main">=</span> <span class="main">(</span>hd <span class="free">b</span> <span class="main">#</span> <span class="var">?a_hdb</span><span class="main">)</span> ⊔<span class="hidden">⇘</span><sub><span class="free">f</span></sub><span class="hidden">⇙</span> <span class="var">?a_succ_p</span>"</span></span> 
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>step_def exec_def<span class="main">)</span>
              <span class="keyword1"><span class="command">with</span></span> a_succ_p_inA hd_b_cons_in_A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a_succ_p</span> <span class="main">⊑⇩</span><span class="free">r</span> <span class="var">?ss_succ_p</span>"</span></span> 
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Semilat.ub2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Semilat.intro<span class="main"><span class="main">,</span></span> <span class="operator">OF</span> is_semi<span class="main"><span class="main">]</span></span><span class="main">)</span>            
              <span class="keyword1"><span class="command">with</span></span> transf_lt_p transf_ss_p_inA a_succ_p_inA ss_succ_p_inA  
              <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> order_trans  Semilat.orderI<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Semilat.intro<span class="main"><span class="main">,</span></span> <span class="operator">OF</span> is_semi<span class="main"><span class="main">]</span></span><span class="main">)</span>              
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">case</span></span> False
              <span class="keyword1"><span class="command">with</span></span> succ_p_lt_n exec2 len_eq  fin_succ_hd_b <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ss_succ_p</span> <span class="main">=</span> <span class="var">?a_succ_p</span>"</span></span> 
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>step_def exec_def<span class="main">)</span>
              <span class="keyword1"><span class="command">with</span></span> transf_lt_p <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> hd <span class="free">b</span>"</span></span> 
            <span class="keyword1"><span class="command">with</span></span> hd_b_ss_sta <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span><span class="bound">τ</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">step</span> <span class="skolem">p</span> <span class="var">?ss_p</span><span class="main">)</span><span class="main">.</span> <span class="bound">τ</span> <span class="main">⊑⇩</span><span class="free">r</span> <span class="free">ss</span><span class="main">!</span><span class="bound">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>stable_def<span class="main">)</span>
            <span class="keyword1"><span class="command">with</span></span> succ_p <span class="quoted"><span class="quoted">`<span class="skolem">p</span> <span class="main">=</span> hd <span class="free">b</span>`</span></span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"transf <span class="skolem">p</span> <span class="var">?ss_p</span> ⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span> <span class="var">?ss_succ_p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fin_succ_hd_b
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>stable_def step_def exec_def transf_def<span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>          
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">with</span></span> step_ss_p <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">τ</span> ⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span> <span class="free">ss</span> <span class="main">!</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>step_def exec_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>rev <span class="var">?ss_p</span><span class="main">)</span> <span class="main">∧</span> 
          <span class="main">(</span><span class="var">?ss_p</span> <span class="main">≠</span> rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set<span class="var">?ss_p</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
          <span class="main">(</span><span class="var">?ss_p</span> <span class="main">=</span> rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">∈</span> set <span class="free">w</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="skolem">p</span><span class="main">)</span><span class="main">∈</span> g_E <span class="free">G</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
          <span class="main">(</span><span class="skolem">p</span> <span class="main">∉</span> set <span class="free">w</span> <span class="main">⟶</span> stable <span class="free">r</span> <span class="free">step</span> <span class="free">ss</span> <span class="skolem">p</span><span class="main">)</span>"</span></span>  
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">note</span></span> w_n_nil <span class="main">=</span> this
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> set<span class="main">(</span> map fst <span class="main">(</span><span class="var">?qs_a</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">with</span></span> propa_ss1 <span class="keyword1"><span class="command">have</span></span> ss_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?ss_p</span> <span class="main">=</span> <span class="main">(</span>hd <span class="free">b</span> <span class="main">#</span> <span class="var">?a_hdb</span><span class="main">)</span> ⊔<span class="hidden">⇘</span><sub><span class="free">f</span></sub><span class="hidden">⇙</span> <span class="var">?a_p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>step_def exec_def transf_def<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> sorted_hd_b_cons sorted_a_p
        <span class="keyword1"><span class="command">have</span></span> ss_p_lt_hdb<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="var">?ss_p</span> <span class="main">⊆</span> set <span class="main">(</span>hd <span class="free">b</span> <span class="main">#</span> <span class="var">?a_hdb</span><span class="main">)</span>"</span></span> 
         <span class="keyword2"><span class="keyword">and</span></span> ss_p_lt<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="var">?ss_p</span> <span class="main">⊆</span> set <span class="var">?a_p</span>"</span></span> 
         <span class="keyword2"><span class="keyword">and</span></span> ss_p_inter<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="var">?ss_p</span> <span class="main">=</span> set <span class="main">(</span>hd <span class="free">b</span> <span class="main">#</span> <span class="var">?a_hdb</span><span class="main">)</span> <span class="main">∩</span> set <span class="var">?a_p</span>"</span></span>         
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>f_def plussub_def nodes_sup_def inter_sorted_correct<span class="main">)</span>
  
        <span class="keyword1"><span class="command">from</span></span> sorted_hd_b_cons sorted_a_p
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inter_sorted_rev <span class="main">(</span>hd <span class="free">b</span> <span class="main">#</span> <span class="var">?a_hdb</span><span class="main">)</span> <span class="var">?a_p</span> <span class="main">=</span> rev <span class="main">(</span>sorted_list_of_set <span class="main">(</span>set <span class="main">(</span>hd <span class="free">b</span> <span class="main">#</span> <span class="var">?a_hdb</span><span class="main">)</span> <span class="main">∩</span> set <span class="var">?a_p</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> inter_sorted_correct_col<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> ss_p <span class="keyword1"><span class="command">have</span></span> ss_p2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?ss_p</span> <span class="main">=</span> <span class="main">(</span>rev <span class="main">(</span>sorted_list_of_set <span class="main">(</span>set <span class="main">(</span>hd <span class="free">b</span> <span class="main">#</span> <span class="var">?a_hdb</span><span class="main">)</span> <span class="main">∩</span> set <span class="var">?a_p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>f_def plussub_def nodes_sup_def<span class="main">)</span>

        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="var">?a_p</span> <span class="main">≠</span> <span class="main">(</span>rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span><span class="main">)</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">note</span></span> a_p_neq_all <span class="main">=</span> this
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> seta_p_neq_all<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="var">?a_p</span> <span class="main">≠</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sorted_a_p  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> sorted_less_rev_set_unique<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> a_p_neq_all wf_a_b p_lt_n <span class="keyword1"><span class="command">have</span></span> a_lt_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="var">?a_p</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n_def len_eq  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>wf_dom_def<span class="main">)</span>  
          <span class="keyword1"><span class="command">with</span></span> ss_p_lt <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="var">?ss_p</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span>  ss_lt_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?ss_p</span> <span class="main">≠</span> rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="var">?ss_p</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="var">?ss_p</span> <span class="main">≠</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">}</span>"</span></span> 
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> set <span class="var">?ss_p</span> <span class="main">≠</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">}</span>"</span></span>            
            <span class="keyword1"><span class="command">with</span></span> ss_p_lt <span class="keyword1"><span class="command">have</span></span> cc<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">}</span> <span class="main">⊆</span> set <span class="var">?a_p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">from</span></span> a_in_A p_lt_len_a <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="var">?a_p</span> <span class="main">∈</span> <span class="main">(</span><span class="main">(</span>rev <span class="main">∘</span> sorted_list_of_set<span class="main">)</span> <span class="main">`</span> <span class="main">(</span>Pow <span class="main">(</span>set nodes<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A_def<span class="main">)</span>           
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ass_set_in_nodes<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="var">?a_p</span> <span class="main">⊆</span> set nodes"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> inpow_subset_nodes<span class="main">)</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="var">?a_p</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>nodes_def n_def verts_set<span class="main">)</span> 
            <span class="keyword1"><span class="command">with</span></span> cc <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="var">?a_p</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">}</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">with</span></span> seta_p_neq_all <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ss_p_not_all<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?ss_p</span> <span class="main">≠</span> rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  sorted_ss_p <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> sorted_less_rev_set_unique<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ss_p</span> <span class="main">=</span> rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span> <span class="main">⟶</span>  <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">∈</span>set <span class="free">w</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="skolem">p</span><span class="main">)</span><span class="main">∈</span> g_E <span class="free">G</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> sorted_ss_p ss_lt_p stable_ss_p w_n_nil <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False 
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> a_p_all<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?a_p</span> <span class="main">=</span>  <span class="main">(</span>rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> wf_a_b p_lt_n   <span class="keyword1"><span class="command">have</span></span> ex_lt_p<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">∈</span> set <span class="free">b</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="skolem">p</span><span class="main">)</span><span class="main">∈</span> g_E <span class="free">G</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>wf_dom_def<span class="main">)</span>
  
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hd <span class="free">b</span> <span class="main">∈</span> set <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b_n_nil <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>                  
  
          <span class="keyword1"><span class="command">from</span></span> a_p_all <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="var">?a_p</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> ss_p_inter <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="var">?ss_p</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> ss_p2 hdb_subset_n <span class="quoted"><span class="quoted">`set <span class="var">?a_p</span>  <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">}</span>`</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>set <span class="main">(</span>hd <span class="free">b</span> <span class="main">#</span> <span class="var">?a_hdb</span><span class="main">)</span> <span class="main">∩</span> set <span class="var">?a_p</span><span class="main">)</span> <span class="main">=</span> set <span class="main">(</span>hd <span class="free">b</span> <span class="main">#</span> <span class="var">?a_hdb</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
          <span class="keyword1"><span class="command">with</span></span> ss_p2 <span class="keyword1"><span class="command">have</span></span> ss_p3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?ss_p</span> <span class="main">=</span>  <span class="main">(</span>rev <span class="main">(</span>sorted_list_of_set <span class="main">(</span>set <span class="main">(</span>hd <span class="free">b</span> <span class="main">#</span> <span class="var">?a_hdb</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> sorted_hd_b_cons <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sorted_list_of_set <span class="main">(</span>set <span class="main">(</span>hd <span class="free">b</span> <span class="main">#</span> <span class="var">?a_hdb</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> rev <span class="main">(</span>hd <span class="free">b</span> <span class="main">#</span> <span class="var">?a_hdb</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> sorted_less_rev_set_eq<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> ss_p3 <span class="keyword1"><span class="command">have</span></span> ss_p_4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?ss_p</span> <span class="main">=</span> <span class="main">(</span>hd <span class="free">b</span> <span class="main">#</span> <span class="var">?a_hdb</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>          
           
          
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?ss_p</span> <span class="main">≠</span> rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="var">?ss_p</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                <span class="main">(</span><span class="var">?ss_p</span> <span class="main">=</span> rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span> <span class="main">⟶</span>  <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">∈</span> set <span class="free">w</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="skolem">p</span><span class="main">)</span><span class="main">∈</span> g_E <span class="free">G</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                <span class="main">(</span><span class="skolem">p</span> <span class="main">∉</span> set <span class="free">w</span> <span class="main">⟶</span> stable <span class="free">r</span> <span class="free">step</span> <span class="free">ss</span> <span class="skolem">p</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="var">?ss_p</span> <span class="main">≠</span>  <span class="main">(</span>rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span><span class="main">)</span>"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">note</span></span> ss_p_n_all <span class="main">=</span> this
            <span class="keyword1"><span class="command">with</span></span> ss_p_4 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"hd <span class="free">b</span> <span class="main">&lt;</span> <span class="skolem">p</span>"</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">case</span></span> True
              <span class="keyword1"><span class="command">with</span></span> ss_p_4 sorted_hd_b_cons <span class="keyword1"><span class="command">have</span></span> ss_p_lt_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="main">(</span> <span class="main">(</span><span class="free">ss</span> <span class="main">!</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>sorted_wrt_append<span class="main">)</span>
              <span class="keyword1"><span class="command">with</span></span> ss_p_4 ss_p_n_all stable_ss_p <span class="quoted"><span class="quoted">`<span class="free">w</span> <span class="main">≠</span> <span class="main">[]</span>`</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">note</span></span> hd_b_ge_p <span class="main">=</span> this
              <span class="keyword1"><span class="command">from</span></span> ex_lt_p <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span> set <span class="free">b</span> "</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">p</span><span class="main">)</span><span class="main">∈</span> g_E <span class="free">G</span> "</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">p</span>"</span></span><span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">`<span class="skolem">x</span> <span class="main">∈</span> set <span class="free">b</span>`</span></span> <span class="quoted"><span class="quoted">`<span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">p</span>`</span></span> hd_b_ge_p <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"tl <span class="free">b</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">b</span></span><span class="main">)</span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">with</span></span>  hd_b_ge_p sorted_b <span class="keyword1"><span class="command">have</span></span> temp_t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span> set <span class="main">(</span>tl <span class="free">b</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≥</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">b</span></span><span class="main">)</span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">`<span class="main">¬</span>hd <span class="free">b</span> <span class="main">&lt;</span> <span class="skolem">p</span>`</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">(</span>tl <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">`<span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">p</span><span class="main">)</span><span class="main">∈</span> g_E <span class="free">G</span> `</span></span> <span class="quoted"><span class="quoted">`<span class="skolem">x</span> <span class="main">∈</span> set <span class="free">b</span>`</span></span> <span class="quoted"><span class="quoted">`<span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">p</span>`</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">b</span></span><span class="main">)</span> <span class="operator">auto</span>              
              <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">`<span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">p</span>`</span></span> temp_t <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">then</span></span>  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ss_p</span> <span class="main">=</span>  <span class="main">(</span>rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
            <span class="keyword1"><span class="command">with</span></span> ss_p_4 <span class="keyword1"><span class="command">have</span></span> hd_b_as1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>hd <span class="free">b</span> <span class="main">#</span> <span class="var">?a_hdb</span><span class="main">)</span> <span class="main">=</span> rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span>hd <span class="free">b</span> <span class="main">#</span> <span class="var">?a_hdb</span><span class="main">)</span> <span class="main">=</span> hd <span class="main">(</span>rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> hd_b<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="free">b</span> <span class="main">=</span> hd <span class="main">(</span>rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span> "</span></span><span class="keyword1"><span class="command">using</span></span> n_def nodes_def len_verts_gt0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> last_hd<span class="main">:</span> <span class="quoted"><span class="quoted">"last <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span> <span class="main">=</span> hd <span class="main">(</span>rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>            
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"last<span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span> <span class="main">=</span> <span class="free">n</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">`<span class="free">n</span><span class="main">&gt;</span> <span class="main">0</span>`</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span>rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> last_hd <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">with</span></span> hd_b  <span class="keyword1"><span class="command">have</span></span> hd_b_n_minus1<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="free">b</span> <span class="main">=</span> <span class="free">n</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"hd <span class="free">b</span> <span class="main">&lt;</span> <span class="skolem">p</span>"</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">case</span></span> True
              <span class="keyword1"><span class="command">with</span></span> hd_b_n_minus1 p_lt_n  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>    
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">case</span></span> False
              <span class="keyword1"><span class="command">from</span></span> ex_lt_p <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span>set <span class="free">b</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">∈</span> g_E <span class="free">G</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span>set <span class="free">b</span> "</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">∈</span> g_E <span class="free">G</span> "</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">" <span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">p</span>"</span></span><span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">from</span></span> x <span class="quoted"><span class="quoted">`<span class="main">¬</span>hd <span class="free">b</span> <span class="main">&lt;</span><span class="skolem">p</span>`</span></span> <span class="keyword1"><span class="command">have</span></span> x_n_hd_b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> hd <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">with</span></span>  <span class="quoted"><span class="quoted">`<span class="skolem">x</span><span class="main">∈</span>set <span class="free">b</span> `</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"tl <span class="free">b</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">b</span></span><span class="main">)</span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">`<span class="skolem">x</span><span class="main">∈</span>set <span class="free">b</span> `</span></span> x_n_hd_b <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">(</span>tl <span class="free">b</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">b</span></span><span class="main">)</span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">with</span></span> ww <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="free">w</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fin <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">`<span class="free">ss</span><span class="main">!</span><span class="skolem">p</span> <span class="main">=</span>  <span class="main">(</span>rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span><span class="main">)</span>`</span></span> <span class="quoted"><span class="quoted">`<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">∈</span> g_E <span class="free">G</span>`</span></span> <span class="quoted"><span class="quoted">`<span class="skolem">x</span><span class="main">&lt;</span><span class="skolem">p</span>`</span></span> stable_ss_p <span class="quoted"><span class="quoted">`<span class="free">w</span> <span class="main">≠</span> <span class="main">[]</span>`</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> sorted_ss_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>

      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">note</span></span> p_not_in_succ <span class="main">=</span> this
        <span class="keyword1"><span class="command">with</span></span> exec2 p_lt_n len_eq <span class="keyword1"><span class="command">have</span></span> ss_a_p_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ss</span><span class="main">!</span><span class="skolem">p</span> <span class="main">=</span> <span class="free">a</span><span class="main">!</span><span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> ass p_lt_n  wf_a_b
        <span class="keyword1"><span class="command">have</span></span> cond1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?ss_p</span> <span class="main">≠</span> rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="var">?ss_p</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>wf_dom_def<span class="main">)</span>
  
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="var">?a_p</span> <span class="main">≠</span>  <span class="main">(</span>rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span><span class="main">)</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
  
          <span class="keyword1"><span class="command">with</span></span> wf_a_b <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="var">?a_p</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> p_lt_n  len_eq  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>wf_dom_def<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> ss_a_p_eq <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="var">?ss_p</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> cond1 sorted_ss_p <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> p_lt_n  len_eq stable_ss_p w_n_nil <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">next</span></span> 
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a_p</span> <span class="main">=</span>  <span class="main">(</span>rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> ss_a_p_eq ass p_lt_n  wf_a_b 
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ss_p</span> <span class="main">=</span> rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span> <span class="main">⟶</span>  <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">∈</span> set <span class="free">b</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="skolem">p</span><span class="main">)</span><span class="main">∈</span> g_E <span class="free">G</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>wf_dom_def<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> ss_a_p_eq <span class="quoted"><span class="quoted">`<span class="free">a</span><span class="main">!</span><span class="skolem">p</span> <span class="main">=</span>  <span class="main">(</span>rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span><span class="main">)</span>`</span></span> <span class="keyword1"><span class="command">have</span></span> hd_b_lt_p<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">∈</span> set <span class="free">b</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="skolem">p</span><span class="main">)</span><span class="main">∈</span> g_E <span class="free">G</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> len_eq  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span> set <span class="free">b</span> "</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">p</span><span class="main">)</span> <span class="main">∈</span>  g_E <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">" <span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            
                
          <span class="keyword1"><span class="command">from</span></span> fin_succ_hd_b <span class="quoted"><span class="quoted">`<span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">p</span><span class="main">)</span> <span class="main">∈</span>  g_E <span class="free">G</span>`</span></span> p_not_in_succ <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> hd <span class="free">b</span> "</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>step_def exec_def succs_def<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">`<span class="skolem">x</span><span class="main">∈</span> set <span class="free">b</span>`</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">(</span>tl <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b_n_nil <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">b</span></span><span class="main">)</span>  <span class="operator">auto</span>
  
          <span class="keyword1"><span class="command">with</span></span> ww <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="free">w</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fin <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">`<span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">p</span><span class="main">)</span> <span class="main">∈</span>  g_E <span class="free">G</span>`</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">` <span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">p</span>`</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">∈</span> set <span class="free">w</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="skolem">p</span><span class="main">)</span><span class="main">∈</span> g_E <span class="free">G</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> cond1 sorted_ss_p <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> stable_ss_p w_n_nil <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> w_n_nil<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">=</span><span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">with</span></span> set_ww <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"tl <span class="free">b</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> succ_hd_b_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∈</span> set <span class="var">?qs_a</span><span class="main">.</span>  <span class="bound">t</span> ⊔<span class="hidden">⇘</span><sub><span class="free">f</span></sub><span class="hidden">⇙</span> <span class="free">a</span> <span class="main">!</span> <span class="bound">q</span> <span class="main">=</span> <span class="free">a</span> <span class="main">!</span> <span class="bound">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      
      <span class="keyword1"><span class="command">from</span></span>  succ_hd_b_eq propa <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">p</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="free">ss</span><span class="main">!</span><span class="bound">p</span> <span class="main">=</span> <span class="free">a</span><span class="main">!</span><span class="bound">p</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> strip<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span>
        <span class="keyword3"><span class="command">assume</span></span> ass_eq<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span> <span class="bound">t</span><span class="main">)</span><span class="main">∈</span>set <span class="var">?qs_a</span><span class="main">.</span> <span class="bound">t</span> ⊔<span class="hidden">⇘</span><sub><span class="free">f</span></sub><span class="hidden">⇙</span> <span class="free">a</span> <span class="main">!</span> <span class="bound">q</span> <span class="main">=</span> <span class="free">a</span> <span class="main">!</span> <span class="bound">q</span> "</span></span>
           <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">" propa <span class="free">f</span> <span class="var">?qs_a</span> <span class="free">a</span> <span class="main">(</span>tl <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">ss</span><span class="main">,</span> <span class="free">w</span><span class="main">)</span> "</span></span> <span class="keyword2"><span class="keyword">and</span></span> p_lt_n<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">p</span> <span class="main">&lt;</span> <span class="free">n</span> "</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">ss</span> <span class="main">!</span> <span class="skolem">p</span> <span class="main">=</span> <span class="free">a</span> <span class="main">!</span> <span class="skolem">p</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> succs <span class="main">(</span>hd <span class="free">b</span><span class="main">)</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">with</span></span> fin_succ_hd_b propa_ss1 <span class="keyword1"><span class="command">have</span></span> ss_p_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ss</span><span class="main">!</span><span class="skolem">p</span> <span class="main">=</span> transf <span class="main">(</span>hd <span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="free">a</span><span class="main">!</span>hd <span class="free">b</span><span class="main">)</span>   ⊔<span class="hidden">⇘</span><sub><span class="free">f</span></sub><span class="hidden">⇙</span> <span class="free">a</span> <span class="main">!</span> <span class="skolem">p</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>step_def exec_def<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> ass_eq <span class="quoted"><span class="quoted">`<span class="skolem">p</span> <span class="main">∈</span> succs <span class="main">(</span>hd <span class="free">b</span><span class="main">)</span>`</span></span> fin_succ_hd_b <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"transf <span class="main">(</span>hd <span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="free">a</span><span class="main">!</span>hd <span class="free">b</span><span class="main">)</span> ⊔<span class="hidden">⇘</span><sub><span class="free">f</span></sub><span class="hidden">⇙</span> <span class="free">a</span> <span class="main">!</span> <span class="skolem">p</span> <span class="main">=</span> <span class="free">a</span> <span class="main">!</span> <span class="skolem">p</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>step_def exec_def<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> ss_p_eq <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">with</span></span> fin_succ_hd_b exec2 p_lt_n n_def len_eq nodes_def  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>step_def exec_def<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">p</span></span><span class="main">&lt;</span> length <span class="free">ss</span><span class="main">.</span> <span class="free">ss</span><span class="main">!</span><span class="bound">p</span> <span class="main">=</span> <span class="free">a</span><span class="main">!</span><span class="bound">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">`length <span class="free">ss</span> <span class="main">=</span> <span class="free">n</span>`</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ss_eq_a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ss</span> <span class="main">=</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n_def len_eq nodes_def <span class="quoted"><span class="quoted">`length <span class="free">ss</span> <span class="main">=</span> <span class="free">n</span>`</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>list_eq_iff_nth_eq<span class="main">)</span>
      
      <span class="keyword1"><span class="command">with</span></span> wf_a_b p_lt_n <span class="keyword1"><span class="command">have</span></span> 
                              t3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?ss_p</span> <span class="main">≠</span> rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="var">?ss_p</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
                              t4<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?ss_p</span> <span class="main">=</span> rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">∈</span>set <span class="free">b</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">∈</span> g_E <span class="free">G</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
                              sta_temp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">p</span> <span class="main">∉</span> set <span class="free">b</span> <span class="main">⟶</span>  stable <span class="free">r</span> <span class="free">step</span> <span class="free">ss</span> <span class="skolem">p</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>wf_dom_def<span class="main">)</span>

      <span class="keyword1"><span class="command">from</span></span>  <span class="quoted"><span class="quoted">`tl <span class="free">b</span> <span class="main">=</span> <span class="main">[]</span>`</span></span>  <span class="quoted"><span class="quoted">`<span class="free">b</span> <span class="main">≠</span> <span class="main">[]</span>`</span></span>   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∉</span> set <span class="free">b</span> <span class="main">⟷</span> <span class="skolem">p</span> <span class="main">≠</span> hd <span class="free">b</span> "</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">b</span></span><span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> sta_temp <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≠</span> hd <span class="free">b</span> <span class="main">⟶</span> stable <span class="free">r</span> <span class="free">step</span> <span class="free">ss</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> hd_b_ss_sta <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"stable <span class="free">r</span> <span class="free">step</span> <span class="free">ss</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> sta_temp'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∉</span> set <span class="free">w</span> <span class="main">⟶</span>  stable <span class="free">r</span> <span class="free">step</span> <span class="free">ss</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> w_n_nil <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ss_p</span> <span class="main">≠</span> <span class="main">(</span>rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="var">?ss_p</span> <span class="main">≠</span>  <span class="main">(</span>rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ss_p_all<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?ss_p</span> <span class="main">=</span>  <span class="main">(</span>rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">`<span class="free">ss</span> <span class="main">=</span> <span class="free">a</span>`</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">!</span><span class="skolem">p</span> <span class="main">=</span>  <span class="main">(</span>rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">`<span class="var">?ss_p</span> <span class="main">=</span>  <span class="main">(</span>rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span><span class="main">)</span>`</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="var">?ss_p</span> <span class="main">=</span> rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span>  t4 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">∈</span>set <span class="free">b</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">∈</span> g_E <span class="free">G</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="free">b</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">∈</span> g_E <span class="free">G</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">`tl <span class="free">b</span> <span class="main">=</span> <span class="main">[]</span>`</span></span>  <span class="quoted"><span class="quoted">`<span class="free">b</span> <span class="main">≠</span> <span class="main">[]</span>`</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span>hd <span class="free">b</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">b</span></span><span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span>hd <span class="free">b</span><span class="main">,</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">∈</span> g_E <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> hdb_lt_p<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="free">b</span> <span class="main">&lt;</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> succs <span class="main">(</span>hd <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>succs_def<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> succ_hd_b_eq <span class="keyword1"><span class="command">have</span></span> transf_hd_b_ap<span class="main">:</span> <span class="quoted"><span class="quoted">"transf <span class="main">(</span>hd <span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="free">a</span><span class="main">!</span>hd <span class="free">b</span><span class="main">)</span>  ⊔<span class="hidden">⇘</span><sub><span class="free">f</span></sub><span class="hidden">⇙</span> <span class="free">a</span> <span class="main">!</span> <span class="skolem">p</span> <span class="main">=</span> <span class="free">a</span> <span class="main">!</span> <span class="skolem">p</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> fin_succ_hd_b 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>step_def exec_def<span class="main">)</span>

        <span class="keyword1"><span class="command">have</span></span> a_p_neq_all<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?a_p</span> <span class="main">≠</span> <span class="main">(</span>rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?a_p</span> <span class="main">≠</span>  <span class="main">(</span>rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> a_p_all<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?a_p</span> <span class="main">=</span>  <span class="main">(</span>rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"transf <span class="main">(</span>hd <span class="free">b</span><span class="main">)</span> <span class="var">?a_hdb</span> ⊔<span class="hidden">⇘</span><sub><span class="free">f</span></sub><span class="hidden">⇙</span> <span class="var">?a_p</span> <span class="main">=</span>  <span class="main">(</span>hd <span class="free">b</span> <span class="main">#</span> <span class="var">?a_hdb</span><span class="main">)</span>  ⊔<span class="hidden">⇘</span><sub><span class="free">f</span></sub><span class="hidden">⇙</span>  <span class="main">(</span>rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>transf_def<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"transf <span class="main">(</span>hd <span class="free">b</span><span class="main">)</span> <span class="var">?a_hdb</span>  ⊔<span class="hidden">⇘</span><sub><span class="free">f</span></sub><span class="hidden">⇙</span><span class="var">?a_p</span> <span class="main">=</span>  <span class="main">(</span> <span class="main">(</span>inter_sorted_rev <span class="main">(</span>hd <span class="free">b</span> <span class="main">#</span> <span class="var">?a_hdb</span><span class="main">)</span> <span class="main">(</span>rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>f_def plussub_def nodes_sup_def <span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> transf_hd_b_ap a_p_all <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inter_sorted_rev <span class="main">(</span>hd <span class="free">b</span> <span class="main">#</span> <span class="var">?a_hdb</span><span class="main">)</span> <span class="main">(</span>rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> 
                                              <span class="main">(</span>rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span><span class="main">)</span>"</span></span><span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> tx<span class="main">:</span> <span class="quoted"><span class="quoted">"inter_sorted_rev <span class="main">(</span>hd <span class="free">b</span> <span class="main">#</span> <span class="var">?a_hdb</span><span class="main">)</span> <span class="main">(</span>rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> sorted_hd_b_cons <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>inter_sorted_rev <span class="main">(</span>hd <span class="free">b</span> <span class="main">#</span> <span class="var">?a_hdb</span><span class="main">)</span> <span class="main">(</span>rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span>
                                    set <span class="main">(</span>hd <span class="free">b</span> <span class="main">#</span> <span class="var">?a_hdb</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inter_sorted_correct<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> tx <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>hd <span class="free">b</span> <span class="main">#</span>  <span class="var">?a_hdb</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">}</span> <span class="main">⊆</span> set <span class="main">(</span>hd <span class="free">b</span> <span class="main">#</span> <span class="var">?a_hdb</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
         
          <span class="keyword1"><span class="command">from</span></span> hdb_subset_n ty <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">}</span> <span class="main">=</span> set <span class="main">(</span>hd <span class="free">b</span> <span class="main">#</span> <span class="var">?a_hdb</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

          <span class="keyword1"><span class="command">with</span></span> sorted_hd_b_cons <span class="keyword1"><span class="command">have</span></span> tz<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="free">b</span> <span class="main">#</span> <span class="var">?a_hdb</span> <span class="main">=</span> rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>sorted_less_rev_set_unique<span class="main">)</span>

          <span class="keyword1"><span class="command">from</span></span> n_def nodes_def len_verts_gt0 verts <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> tz <span class="keyword1"><span class="command">have</span></span> tzz<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="free">b</span> <span class="main">=</span> <span class="free">n</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>  <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> p_lt_n tzz hdb_lt_p <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">with</span></span>  ss_p_all ss_eq_a <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">with</span></span> sta_temp' sorted_ss_p t3 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">from</span></span> ss_inA wf_dom_2 sorted_w len_ss_n w_lt_n <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Dom_Kildall_Property-propa_dom_invariant_aux'"><span class="command">lemma</span></span> propa_dom_invariant_aux'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="free">b</span> <span class="free">ss</span> <span class="free">w</span>
<span class="keyword2"><span class="keyword">assumes</span></span> propa<span class="main">:</span> <span class="quoted"><span class="quoted">"propa <span class="free">f</span> <span class="main">(</span><span class="free">step</span> <span class="main">(</span>hd <span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="free">a</span> <span class="main">!</span> hd <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="free">a</span> <span class="main">(</span>tl <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">ss</span><span class="main">,</span> <span class="free">w</span><span class="main">)</span> "</span></span>    
    <span class="keyword2"><span class="keyword">and</span></span> b_n_nil<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≠</span> <span class="main">[]</span> "</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> a_in_A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">τ</span><span class="main">∈</span>set <span class="free">a</span><span class="main">.</span> <span class="bound">τ</span> <span class="main">∈</span> <span class="free">A</span>  "</span></span>   
    <span class="keyword2"><span class="keyword">and</span></span> ass<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">p</span></span><span class="main">&lt;</span>length <span class="free">ss0</span><span class="main">.</span>
          sorted <span class="main">(</span>rev <span class="main">(</span> <span class="main">(</span><span class="free">a</span> <span class="main">!</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
          <span class="main">(</span><span class="free">a</span> <span class="main">!</span> <span class="bound">p</span> <span class="main">≠</span> rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">ss0</span><span class="main">]</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="main">(</span> <span class="main">(</span><span class="free">a</span> <span class="main">!</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
          <span class="main">(</span><span class="free">a</span> <span class="main">!</span> <span class="bound">p</span> <span class="main">=</span> rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">ss0</span><span class="main">]</span> <span class="main">⟶</span>  <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">∈</span> set <span class="free">b</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">p</span><span class="main">)</span><span class="main">∈</span> g_E <span class="free">G</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
          <span class="main">(</span><span class="bound">p</span> <span class="main">∉</span> set <span class="free">b</span> <span class="main">⟶</span> stable <span class="free">r</span> <span class="free">step</span> <span class="free">a</span> <span class="bound">p</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> sorted_b<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="free">b</span>  "</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> n_len<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> length <span class="free">ss0</span>  "</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> len_eq<span class="main">:</span>  <span class="quoted"><span class="quoted">"length <span class="free">a</span> <span class="main">=</span> length <span class="free">ss0</span>  "</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> b_lt_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="free">b</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> length <span class="free">ss0</span>  "</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">τ</span><span class="main">∈</span>set <span class="free">ss</span><span class="main">.</span> <span class="bound">τ</span> <span class="main">∈</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span>
         <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">p</span></span><span class="main">&lt;</span>length <span class="free">ss0</span><span class="main">.</span>
           sorted <span class="main">(</span>rev <span class="main">(</span> <span class="main">(</span><span class="free">ss</span> <span class="main">!</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="free">ss</span> <span class="main">!</span> <span class="bound">p</span> <span class="main">≠</span> rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">ss0</span><span class="main">]</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="main">(</span><span class="free">ss</span> <span class="main">!</span> <span class="bound">p</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="free">ss</span> <span class="main">!</span> <span class="bound">p</span> <span class="main">=</span> rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>length <span class="free">ss0</span><span class="main">]</span> <span class="main">⟶</span>  <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">∈</span> set <span class="free">w</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">p</span><span class="main">)</span><span class="main">∈</span> g_E <span class="free">G</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="bound">p</span> <span class="main">∉</span> set <span class="free">w</span> <span class="main">⟶</span> stable <span class="free">r</span> <span class="free">step</span> <span class="free">ss</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
         sorted <span class="free">w</span> <span class="main">∧</span> length <span class="free">ss</span> <span class="main">=</span> length <span class="free">ss0</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="free">w</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> length <span class="free">ss0</span><span class="main">)</span> "</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> propa_dom_invariant_aux<span class="main">)</span>


<span class="keyword1" id="Dom_Kildall_Property-propa_dom_invariant"><span class="command">lemma</span></span> propa_dom_invariant<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> wf_ss_w<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_dom <span class="free">ss</span> <span class="free">w</span> "</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> w_n_nil<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> propa<span class="main">:</span> <span class="quoted"><span class="quoted">"propa <span class="free">f</span> <span class="main">(</span><span class="free">step</span> <span class="main">(</span>hd <span class="free">w</span><span class="main">)</span> <span class="main">(</span><span class="free">ss</span> <span class="main">!</span> hd <span class="free">w</span><span class="main">)</span><span class="main">)</span> <span class="free">ss</span> <span class="main">(</span>tl <span class="free">w</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">ss'</span><span class="main">,</span> <span class="free">w'</span><span class="main">)</span> "</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"wf_dom <span class="free">ss'</span> <span class="free">w'</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms 
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> wf_ss_w <span class="keyword1"><span class="command">have</span></span> ass<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">p</span></span><span class="main">&lt;</span> <span class="free">n</span><span class="main">.</span> sorted <span class="main">(</span>rev <span class="main">(</span><span class="free">ss</span><span class="main">!</span><span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
             <span class="main">(</span><span class="free">ss</span><span class="main">!</span><span class="bound">p</span> <span class="main">≠</span> rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span> <span class="free">n</span><span class="main">]</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="main">(</span><span class="free">ss</span><span class="main">!</span><span class="bound">p</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
             <span class="main">(</span><span class="free">ss</span><span class="main">!</span><span class="bound">p</span> <span class="main">=</span> rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span> <span class="free">n</span><span class="main">]</span> <span class="main">⟶</span>  <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">∈</span> set <span class="free">w</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">p</span><span class="main">)</span><span class="main">∈</span> g_E <span class="free">G</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
             <span class="main">(</span><span class="bound">p</span> <span class="main">∉</span> set <span class="free">w</span> <span class="main">⟶</span> stable <span class="free">r</span> <span class="free">step</span> <span class="free">ss</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span> "</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> sorted_b<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> a_in_A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">τ</span><span class="main">∈</span>set <span class="free">ss</span><span class="main">.</span> <span class="bound">τ</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> len_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">ss</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> b_lt_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="free">w</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">n</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>wf_dom_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> propa w_n_nil a_in_A ass sorted_b len_eq b_lt_n 
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> wf_dom_def<span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> propa_dom_invariant_aux<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Dom_Kildall_Property-step_dom_mono_aux"><span class="command">lemma</span></span> step_dom_mono_aux<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">τ</span> <span class="free">p</span> <span class="free">τ'</span> <span class="free">a</span> <span class="free">b</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> sorted<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>rev <span class="main">(</span>transf <span class="free">p</span>  <span class="free">τ</span><span class="main">)</span><span class="main">)</span> "</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> a_b_step<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">step</span> <span class="free">p</span>  <span class="free">τ</span><span class="main">)</span> "</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">τ</span> <span class="main">∈</span> <span class="free">A</span> "</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">" <span class="free">p</span> <span class="main">&lt;</span> <span class="free">n</span> "</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">" <span class="free">τ</span> ⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span> <span class="free">τ'</span>"</span></span> 
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">τ''</span><span class="main">.</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="bound">τ''</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">step</span> <span class="free">p</span> <span class="free">τ'</span><span class="main">)</span> <span class="main">∧</span> <span class="free">b</span> ⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span> <span class="bound">τ''</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>  
  <span class="keyword1"><span class="command">have</span></span> step1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">step</span> <span class="free">p</span> <span class="free">τ</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span><span class="bound">pc</span><span class="main">.</span> <span class="main">(</span><span class="bound">pc</span><span class="main">,</span> <span class="main">(</span>transf  <span class="free">p</span> <span class="free">τ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>rev <span class="main">(</span>sorted_list_of_set<span class="main">(</span>succs <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>step_def exec_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> a_b_step <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="free">step</span> <span class="free">p</span> <span class="free">τ</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> step1 <span class="keyword1"><span class="command">have</span></span> succ_p_n_nil<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>rev <span class="main">(</span>sorted_list_of_set<span class="main">(</span>succs <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">`<span class="free">p</span><span class="main">&lt;</span><span class="free">n</span>`</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> set <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n_def nodes_def verts_set len_verts_gt0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>succs <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fin_succs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> step1  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">∈</span> set <span class="main">(</span><span class="free">step</span> <span class="free">p</span> <span class="free">τ</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> succs <span class="free">p</span>"</span></span> 
               <span class="keyword2"><span class="keyword">and</span></span> step2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">∈</span> set <span class="main">(</span><span class="free">step</span> <span class="free">p</span> <span class="free">τ</span><span class="main">)</span><span class="main">.</span> <span class="bound">y</span> <span class="main">=</span> transf <span class="free">p</span> <span class="free">τ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>step_def exec_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> a_b_step <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> succs <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"succs <span class="free">p</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> step2 a_b_step <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> transf <span class="free">p</span> <span class="free">τ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> step2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">step</span> <span class="free">p</span> <span class="free">τ'</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span><span class="bound">pc</span><span class="main">.</span> <span class="main">(</span><span class="bound">pc</span><span class="main">,</span> <span class="main">(</span>transf  <span class="free">p</span> <span class="free">τ'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>rev <span class="main">(</span>sorted_list_of_set<span class="main">(</span>succs <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>step_def exec_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> fin <span class="keyword1"><span class="command">have</span></span> g1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">∈</span> set <span class="main">(</span><span class="free">step</span> <span class="free">p</span> <span class="free">τ'</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> succs <span class="free">p</span>"</span></span> 
                <span class="keyword2"><span class="keyword">and</span></span> g2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">∈</span> set <span class="main">(</span><span class="free">step</span> <span class="free">p</span> <span class="free">τ'</span><span class="main">)</span><span class="main">.</span> <span class="bound">y</span> <span class="main">=</span> transf <span class="free">p</span> <span class="free">τ'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>step_def exec_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">`<span class="free">a</span> <span class="main">∈</span> succs <span class="free">p</span>`</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="bound">t</span><span class="main">)</span><span class="main">∈</span> set <span class="main">(</span><span class="free">step</span> <span class="free">p</span> <span class="free">τ'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fin <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>step_def exec_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> ex<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="skolem">t</span><span class="main">)</span><span class="main">∈</span> set <span class="main">(</span><span class="free">step</span> <span class="free">p</span> <span class="free">τ'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">with</span></span> g2 <span class="keyword1"><span class="command">have</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> transf <span class="free">p</span> <span class="free">τ'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span><span class="quoted"><span class="quoted">` <span class="free">τ</span> ⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span> <span class="free">τ'</span>`</span></span> <span class="keyword1"><span class="command">have</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>rev <span class="free">τ</span><span class="main">)</span> <span class="main">∧</span> sorted <span class="main">(</span>rev <span class="free">τ'</span><span class="main">)</span><span class="main">∧</span> set <span class="free">τ'</span> <span class="main">⊆</span> set <span class="free">τ</span> <span class="main">∨</span> <span class="free">τ</span> <span class="main">=</span> <span class="free">τ'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>r_def lesssub_def lesub_def nodes_le_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> subset_p<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="free">p</span><span class="main">#</span><span class="free">τ'</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span><span class="free">p</span><span class="main">#</span> <span class="free">τ</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"set  <span class="free">τ'</span> <span class="main">⊆</span> set <span class="free">τ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> sorted <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span> set <span class="free">τ</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>rev <span class="free">τ'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> g <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>sorted_wrt_append transf_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">`set <span class="free">τ'</span> <span class="main">⊆</span> set <span class="free">τ</span>`</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span> set <span class="free">τ'</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">`sorted <span class="main">(</span>rev <span class="free">τ'</span><span class="main">)</span>`</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>rev <span class="main">(</span><span class="free">p</span><span class="main">#</span><span class="free">τ'</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>sorted_wrt_append<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> sorted b t subset_p

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> ⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>r_def lesssub_def lesub_def nodes_le_def transf_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> ex <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Dom_Kildall_Property-step_dom_mono"><span class="command">lemma</span></span> step_dom_mono<span class="main">:</span> 
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">τ</span> <span class="bound">p</span> <span class="bound">τ'</span><span class="main">.</span> <span class="bound">τ</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">∧</span> <span class="bound">p</span><span class="main">&lt;</span><span class="free">n</span> <span class="main">∧</span> <span class="bound">τ</span> <span class="main">⊑⇩</span><span class="free">r</span> <span class="bound">τ'</span> <span class="main">⟶</span> 
           sorted <span class="main">(</span>rev <span class="main">(</span>transf <span class="bound">p</span> <span class="bound">τ</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> 
           set <span class="main">(</span><span class="free">step</span> <span class="bound">p</span> <span class="bound">τ</span><span class="main">)</span> {⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>} set <span class="main">(</span><span class="free">step</span> <span class="bound">p</span> <span class="bound">τ'</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> mono_def lesubstep_type_def<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>step_dom_mono_aux n_def nodes_def transf_def<span class="main">)</span>


<span class="keyword1" id="Dom_Kildall_Property-propa_termination"><span class="command">lemma</span></span> propa_termination<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="free">b</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> wf_a_b<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_dom <span class="free">a</span> <span class="free">b</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> b_n_nil<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≠</span> <span class="main">[]</span> "</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>propa <span class="free">f</span> <span class="main">(</span><span class="free">step</span> <span class="main">(</span>hd <span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="free">a</span> <span class="main">!</span> hd <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="free">a</span> <span class="main">(</span>tl <span class="free">b</span><span class="main">)</span><span class="main">,</span> <span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span> <span class="main">∈</span>
           <span class="main">{</span><span class="main">(</span><span class="bound">ss'</span><span class="main">,</span> <span class="bound">ss</span><span class="main">)</span><span class="main">.</span> <span class="bound">ss</span> [⊏<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>] <span class="bound">ss'</span><span class="main">}</span> <span class="keyword1">&lt;*lex*&gt;</span> 
           <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>sorted_list_of_set <span class="bound">x</span><span class="main">,</span> sorted_list_of_set <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> finite_psubset"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?qs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">step</span> <span class="main">(</span>hd <span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="free">a</span> <span class="main">!</span> hd <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> wf_a_b <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="free">b</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> n_len<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">a</span> <span class="main">=</span> <span class="free">n</span>"</span></span>  <span class="keyword2"><span class="keyword">and</span></span> sorted_b<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="free">b</span>"</span></span> 
               <span class="keyword2"><span class="keyword">and</span></span> set_a<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">a</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>wf_dom_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> sorted_tl_b<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>tl <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> hd_b_lt_n<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="free">b</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b_n_nil <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">b</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>sorted_wrt_append<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> set_a <span class="keyword1"><span class="command">have</span></span> a_inA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> list <span class="free">n</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n_len <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> listI<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> hd_b_lt_n <span class="keyword1"><span class="command">have</span></span> dist<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map fst <span class="var">?qs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> distinct_p  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>   

  <span class="keyword1"><span class="command">from</span></span> wf_a_b b_n_nil <span class="keyword1"><span class="command">have</span></span> step_pres_bounded<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span> <span class="bound">τ</span><span class="main">)</span><span class="main">∈</span>set <span class="var">?qs</span><span class="main">.</span> <span class="bound">q</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">∧</span> <span class="bound">τ</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> propa_dom_invariant_auxi n_len <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>  
  <span class="keyword1"><span class="command">with</span></span> sorted_tl_b set_a n_len
  <span class="keyword1"><span class="command">have</span></span> propa<span class="main">:</span> <span class="quoted"><span class="quoted">"propa <span class="free">f</span> <span class="var">?qs</span> <span class="free">a</span> <span class="main">(</span>tl <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>merges <span class="free">f</span> <span class="var">?qs</span> <span class="free">a</span><span class="main">,</span> <span class="main">(</span>sorted_list_of_set <span class="main">(</span><span class="main">{</span><span class="bound">q</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t</span><span class="main">.</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span><span class="bound">t</span><span class="main">)</span><span class="main">∈</span>set <span class="var">?qs</span> <span class="main">∧</span> <span class="bound">t</span> ⊔<span class="hidden">⇘</span><sub><span class="free">f</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">a</span><span class="main">!</span><span class="bound">q</span><span class="main">)</span> <span class="main">≠</span> <span class="free">a</span><span class="main">!</span><span class="bound">q</span><span class="main">}</span> <span class="main">∪</span> set<span class="main">(</span>tl <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> decomp_propa<span class="main">)</span>
  
  <span class="keyword1"><span class="command">from</span></span> a_inA step_pres_bounded sorted_b b_n_nil  dist
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>merges <span class="free">f</span> <span class="var">?qs</span> <span class="free">a</span><span class="main">,</span> <span class="main">(</span>sorted_list_of_set <span class="main">(</span><span class="main">{</span><span class="bound">q</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t</span><span class="main">.</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span><span class="bound">t</span><span class="main">)</span><span class="main">∈</span>set <span class="var">?qs</span> <span class="main">∧</span> <span class="bound">t</span> ⊔<span class="hidden">⇘</span><sub><span class="free">f</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">a</span><span class="main">!</span><span class="bound">q</span><span class="main">)</span> <span class="main">≠</span> <span class="free">a</span><span class="main">!</span><span class="bound">q</span><span class="main">}</span> <span class="main">∪</span> set<span class="main">(</span>tl <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span>
        <span class="main">{</span><span class="main">(</span><span class="bound">ss'</span><span class="main">,</span> <span class="bound">ss</span><span class="main">)</span><span class="main">.</span> <span class="bound">ss</span> [⊏<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>] <span class="bound">ss'</span><span class="main">}</span> <span class="keyword1">&lt;*lex*&gt;</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>sorted_list_of_set <span class="bound">x</span><span class="main">,</span> sorted_list_of_set <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> finite_psubset"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> finite_psubset_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> termination_lemma<span class="main">)</span>      
  <span class="keyword1"><span class="command">with</span></span> propa <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>   

<span class="keyword1" id="Dom_Kildall_Property-iter_dom_invariant"><span class="command">lemma</span></span> iter_dom_invariant<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"wf_dom <span class="free">ss0</span> <span class="free">w0</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"iter <span class="free">f</span> <span class="free">step</span> <span class="free">ss0</span> <span class="free">w0</span> <span class="main">=</span> <span class="main">(</span><span class="free">ss'</span><span class="main">,</span><span class="free">w'</span><span class="main">)</span> <span class="main">⟶</span> wf_dom <span class="free">ss'</span> <span class="free">w'</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> iter_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span>  
      P <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">ss</span><span class="main">,</span> <span class="bound">w</span><span class="main">)</span><span class="main">.</span> wf_dom <span class="bound">ss</span> <span class="bound">w</span> <span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span>
      r <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">ss'</span><span class="main">,</span><span class="bound">ss</span><span class="main">)</span><span class="main">.</span> <span class="bound">ss</span> <span class="main">[⊏⇩</span><span class="free">r</span><span class="main">]</span> <span class="bound">ss'</span><span class="main">}</span> <span class="keyword1">&lt;*lex*&gt;</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>sorted_list_of_set <span class="bound">x</span><span class="main">,</span> sorted_list_of_set <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> finite_psubset"</span></span> 
      <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> while_rule<span class="main">)</span> 
  <span class="comment1">― ‹Invariant holds initially:›</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>

  <span class="comment1">― ‹Invariant is preserved:›</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_dom_def<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>  
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> propa_dom_invariant_aux'<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span>
  <span class="comment1">― ‹Postcondition holds upon termination:›</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span> 

  <span class="comment1">― ‹Well-foundedness of the termination relation:›</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_listn_termination_rel<span class="main">)</span> 

  <span class="comment1">― ‹Loop decreases along termination relation:›</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>propa_termination<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Dom_Kildall_Property-propa_dom_invariant_aux2"><span class="command">lemma</span></span> propa_dom_invariant_aux2<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">ss</span> <span class="free">w</span> <span class="free">ssa</span> <span class="free">wa</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> wf_dom_ss0_w0<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_dom <span class="free">ss0</span> <span class="free">w0</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> w_n_nil<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">≠</span> <span class="main">[]</span> "</span></span>     
      <span class="keyword2"><span class="keyword">and</span></span> propa<span class="main">:</span> <span class="quoted"><span class="quoted">"propa <span class="free">f</span> <span class="main">(</span><span class="free">step</span> <span class="main">(</span>hd <span class="free">w</span><span class="main">)</span> <span class="main">(</span><span class="free">ss</span> <span class="main">!</span> hd <span class="free">w</span><span class="main">)</span><span class="main">)</span> <span class="free">ss</span> <span class="main">(</span>tl <span class="free">w</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">ssa</span><span class="main">,</span> <span class="free">wa</span><span class="main">)</span> "</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> wf_ss_w<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_dom <span class="free">ss</span> <span class="free">w</span> "</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> ss0_lt_ss<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ss0</span> [⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>] <span class="free">ss</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> sta<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="bound">ts</span><span class="main">∈</span>list <span class="free">n</span> <span class="free">A</span><span class="main">.</span> <span class="free">ss0</span> [⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>] <span class="bound">ts</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">p</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> stable <span class="free">r</span> <span class="free">step</span> <span class="bound">ts</span> <span class="bound">p</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">ss</span> [⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>] <span class="bound">ts</span>"</span></span>    
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ss0</span> [⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>] <span class="free">ssa</span> <span class="main">∧</span> 
           <span class="main">(</span><span class="main">∀</span><span class="bound">ts</span><span class="main">∈</span>list <span class="free">n</span> <span class="free">A</span><span class="main">.</span> <span class="free">ss0</span> [⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>] <span class="bound">ts</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">p</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> stable <span class="free">r</span> <span class="free">step</span> <span class="bound">ts</span> <span class="bound">p</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">ssa</span> [⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>] <span class="bound">ts</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ss_hdw</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">ss</span><span class="main">!</span>hd <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> wf_dom_ss0_w0 <span class="keyword1"><span class="command">have</span></span> len_ss0<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">ss0</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span> set <span class="free">ss0</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>wf_dom_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ss0_inA<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="free">ss0</span> <span class="main">∈</span> list <span class="free">n</span> <span class="free">A</span>"</span></span>  <span class="keyword2"><span class="keyword">and</span></span> set_ss0<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">ss0</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span><span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>listI<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ss0_nth_inA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="free">ss0</span><span class="main">.</span> <span class="free">ss0</span><span class="main">!</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ss0_p_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">p</span></span><span class="main">&lt;</span> length <span class="free">ss0</span><span class="main">.</span> set <span class="main">(</span><span class="free">ss0</span><span class="main">!</span><span class="bound">p</span><span class="main">)</span> <span class="main">⊆</span> set nodes"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>inpow_subset_nodes A_def<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> len_ss0 n_def nodes_def len_verts_gt0 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> length <span class="free">ss0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> ss0_lt_ss <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"list_all2 <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⊑⇩</span><span class="free">r</span> <span class="bound">y</span><span class="main">)</span> <span class="free">ss0</span> <span class="free">ss</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>lesssub_def lesub_def list_all2_def Listn.le_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> lt1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">p</span></span><span class="main">&lt;</span>length <span class="free">ss0</span><span class="main">.</span> <span class="free">ss0</span> <span class="main">!</span><span class="bound">p</span> ⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span> <span class="free">ss</span><span class="main">!</span><span class="bound">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_all2_conv_all_nth<span class="main">)</span> 

  <span class="keyword1"><span class="command">from</span></span> wf_ss_w <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">τ</span><span class="main">∈</span>set <span class="free">ss</span><span class="main">.</span> <span class="bound">τ</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> 
                <span class="keyword2"><span class="keyword">and</span></span> ass1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">p</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> sorted <span class="main">(</span>rev <span class="main">(</span> <span class="main">(</span><span class="free">ss</span> <span class="main">!</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                                <span class="main">(</span><span class="free">ss</span><span class="main">!</span><span class="bound">p</span> <span class="main">≠</span> rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="main">(</span><span class="free">ss</span> <span class="main">!</span> <span class="bound">p</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                                <span class="main">(</span><span class="free">ss</span><span class="main">!</span><span class="bound">p</span> <span class="main">=</span> rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span> <span class="main">⟶</span>  <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">∈</span> set <span class="free">w</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">p</span><span class="main">)</span><span class="main">∈</span> g_E <span class="free">G</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                                <span class="main">(</span><span class="bound">p</span> <span class="main">∉</span> set <span class="free">w</span> <span class="main">⟶</span> stable <span class="free">r</span> <span class="free">step</span> <span class="free">ss</span> <span class="bound">p</span><span class="main">)</span>"</span></span> 
                <span class="keyword2"><span class="keyword">and</span></span> sorted_w<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="free">w</span>"</span></span> 
                <span class="keyword2"><span class="keyword">and</span></span> len_ss<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">ss</span> <span class="main">=</span> <span class="free">n</span>"</span></span> 
                <span class="keyword2"><span class="keyword">and</span></span> w_lt_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="free">w</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">n</span>  "</span></span><span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>wf_dom_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ss_inA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ss</span> <span class="main">∈</span> list <span class="free">n</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> set_ss<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">ss</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>listI<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ss_nth_inA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="free">ss</span><span class="main">.</span> <span class="free">ss</span><span class="main">!</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ss_p_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">p</span></span><span class="main">&lt;</span> length <span class="free">ss</span><span class="main">.</span> set <span class="main">(</span><span class="free">ss</span><span class="main">!</span><span class="bound">p</span><span class="main">)</span> <span class="main">⊆</span> set nodes"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>inpow_subset_nodes A_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ss_hdw_nodes<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="var">?ss_hdw</span> <span class="main">⊆</span> set nodes"</span></span> <span class="keyword1"><span class="command">using</span></span> w_lt_n w_n_nil len_ss <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?qs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">step</span> <span class="main">(</span>hd <span class="free">w</span><span class="main">)</span> <span class="var">?ss_hdw</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> w_lt_n <span class="keyword1"><span class="command">have</span></span> hd_w_lt_n<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="free">w</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> w_n_nil <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span>  <span class="keyword1"><span class="command">have</span></span> dist<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map fst <span class="var">?qs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> distinct_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> ss_nth_inA <span class="keyword1"><span class="command">have</span></span> ss_hdw_inA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?ss_hdw</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> w_lt_n w_n_nil len_ss <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> ass1 <span class="keyword1"><span class="command">have</span></span> sorted_ss_hdw<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>rev <span class="var">?ss_hdw</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> w_lt_n w_n_nil  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">q</span><span class="main">∈</span>succs <span class="main">(</span>hd <span class="free">w</span><span class="main">)</span><span class="main">.</span> <span class="bound">q</span> <span class="main">∈</span> set <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>succ_in_G<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> hd_w_suc_lt_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">q</span><span class="main">∈</span>succs <span class="main">(</span>hd <span class="free">w</span><span class="main">)</span><span class="main">.</span> <span class="bound">q</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n_def verts_set nodes_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> hdw_in_nodes<span class="main">:</span><span class="quoted"><span class="quoted">"hd <span class="free">w</span> <span class="main">∈</span> set <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> verts_set n_def nodes_def w_lt_n w_n_nil <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> fin_succ_hd_w<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>succs <span class="main">(</span>hd <span class="free">w</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fin_succs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> sorted_w <span class="keyword1"><span class="command">have</span></span> sorted_tl_w'<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>tl <span class="free">w</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> w_n_nil <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">w</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> wf_ss_w w_n_nil <span class="keyword1"><span class="command">have</span></span> ss_hd_w_neq_all<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?ss_hdw</span> <span class="main">≠</span> <span class="main">(</span>rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span><span class="main">)</span>"</span></span> 
                        <span class="keyword2"><span class="keyword">and</span></span> sorted_hd_w_ss<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>rev <span class="main">(</span>hd <span class="free">w</span> <span class="main">#</span> <span class="var">?ss_hdw</span><span class="main">)</span><span class="main">)</span>"</span></span>
                        <span class="keyword2"><span class="keyword">and</span></span> hdb_subset_nodes<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>hd <span class="free">w</span> <span class="main">#</span> <span class="var">?ss_hdw</span><span class="main">)</span> <span class="main">⊆</span> set nodes"</span></span>
                        <span class="keyword2"><span class="keyword">and</span></span> hd_w_ss_in_A<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">(</span>hd <span class="free">w</span> <span class="main">#</span> <span class="var">?ss_hdw</span><span class="main">)</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> 
                        <span class="keyword2"><span class="keyword">and</span></span> step_pres_bounded<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span> <span class="bound">τ</span><span class="main">)</span><span class="main">∈</span>set <span class="main">(</span><span class="free">step</span> <span class="main">(</span>hd <span class="free">w</span><span class="main">)</span> <span class="var">?ss_hdw</span><span class="main">)</span><span class="main">.</span> <span class="bound">q</span> <span class="main">&lt;</span> length <span class="free">ss</span> <span class="main">∧</span> <span class="bound">τ</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> propa_dom_invariant_auxi <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> ss_hd_w_neq_all <span class="keyword1"><span class="command">have</span></span> ss_lt_hd_w<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="var">?ss_hdw</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> hd <span class="free">w</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hd_w_lt_n wf_ss_w <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>wf_dom_def<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> wf_ss_w w_n_nil propa <span class="keyword1"><span class="command">have</span></span> wf_ssa_wa<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_dom <span class="free">ssa</span> <span class="free">wa</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> propa_dom_invariant <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> sorted_ssa_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">p</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> sorted <span class="main">(</span>rev <span class="main">(</span><span class="free">ssa</span><span class="main">!</span><span class="bound">p</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword2"><span class="keyword">and</span></span> len_ssa<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">ssa</span> <span class="main">=</span> <span class="free">n</span>"</span></span> 
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span> set <span class="free">ssa</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> 
        <span class="keyword2"><span class="keyword">and</span></span> sorted_wa<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="free">wa</span>"</span></span> 
        <span class="keyword2"><span class="keyword">and</span></span> len_ssa<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">ssa</span> <span class="main">=</span> <span class="free">n</span>"</span></span> 
        <span class="keyword2"><span class="keyword">and</span></span> wa_lt_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span> set <span class="free">wa</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>wf_dom_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ssa_inA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ssa</span><span class="main">∈</span> list <span class="free">n</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> set_ssa<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">ssa</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span><span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>listI<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ssa_nth_inA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="free">ssa</span><span class="main">.</span> <span class="free">ssa</span><span class="main">!</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ssa_p_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">p</span></span><span class="main">&lt;</span> length <span class="free">ssa</span><span class="main">.</span> set <span class="main">(</span><span class="free">ssa</span><span class="main">!</span><span class="bound">p</span><span class="main">)</span> <span class="main">⊆</span> set nodes"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>inpow_subset_nodes A_def<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> len_ss0 len_ssa <span class="keyword1"><span class="command">have</span></span> len_ss0_ssa<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">ss0</span> <span class="main">=</span> length <span class="free">ssa</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> len_ss0 len_ss  <span class="keyword1"><span class="command">have</span></span> len_ss0_ss<span class="main">:</span>  <span class="quoted"><span class="quoted">"length <span class="free">ss0</span> <span class="main">=</span> length <span class="free">ss</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>  
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span> <span class="bound">τ</span><span class="main">)</span><span class="main">∈</span>set <span class="var">?qs</span><span class="main">.</span> <span class="bound">τ</span> <span class="main">=</span> transf <span class="main">(</span>hd <span class="free">w</span><span class="main">)</span> <span class="main">(</span><span class="free">ss</span><span class="main">!</span><span class="main">(</span>hd <span class="free">w</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>step_def exec_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> transf_ss_hd_w<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span> <span class="bound">τ</span><span class="main">)</span><span class="main">∈</span>set <span class="var">?qs</span><span class="main">.</span> <span class="bound">τ</span> <span class="main">=</span>  <span class="main">(</span>hd <span class="free">w</span> <span class="main">#</span> <span class="var">?ss_hdw</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>transf_def<span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> set_ss step_pres_bounded sorted_tl_w' len_ss dist <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span> <span class="bound">τ</span><span class="main">)</span> <span class="main">∈</span> set <span class="var">?qs</span><span class="main">.</span> <span class="main">(</span>fst<span class="main">(</span>propa <span class="free">f</span> <span class="var">?qs</span> <span class="free">ss</span> <span class="main">(</span>tl <span class="free">w</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="bound">q</span> <span class="main">=</span> <span class="bound">τ</span> ⊔<span class="hidden">⇘</span><sub><span class="free">f</span></sub><span class="hidden">⇙</span><span class="free">ss</span><span class="main">!</span><span class="bound">q</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>propa_property1<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> propa <span class="keyword1"><span class="command">have</span></span> propa_ss<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span> <span class="bound">τ</span><span class="main">)</span> <span class="main">∈</span> set <span class="var">?qs</span><span class="main">.</span> <span class="free">ssa</span><span class="main">!</span><span class="bound">q</span> <span class="main">=</span> <span class="bound">τ</span> ⊔<span class="hidden">⇘</span><sub><span class="free">f</span></sub><span class="hidden">⇙</span><span class="free">ss</span><span class="main">!</span><span class="bound">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>  
  <span class="keyword1"><span class="command">with</span></span> transf_ss_hd_w <span class="keyword1"><span class="command">have</span></span> propa_ss1<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span> <span class="bound">τ</span><span class="main">)</span> <span class="main">∈</span> set <span class="var">?qs</span><span class="main">.</span> <span class="free">ssa</span><span class="main">!</span><span class="bound">q</span> <span class="main">=</span>  <span class="main">(</span>hd <span class="free">w</span> <span class="main">#</span> <span class="var">?ss_hdw</span><span class="main">)</span> ⊔<span class="hidden">⇘</span><sub><span class="free">f</span></sub><span class="hidden">⇙</span><span class="free">ss</span><span class="main">!</span><span class="bound">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> ss_nth_inA step_pres_bounded <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span> <span class="bound">τ</span><span class="main">)</span> <span class="main">∈</span> set <span class="var">?qs</span><span class="main">.</span> <span class="free">ss</span><span class="main">!</span><span class="bound">q</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hd_w_suc_lt_n fin_succ_hd_w
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>step_def exec_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> hd_w_ss_in_A this propa_ss1 <span class="keyword1"><span class="command">have</span></span> ss_lt_ssa_q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span> <span class="bound">τ</span><span class="main">)</span> <span class="main">∈</span> set <span class="var">?qs</span><span class="main">.</span> <span class="free">ss</span><span class="main">!</span><span class="bound">q</span> ⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span> <span class="free">ssa</span><span class="main">!</span><span class="bound">q</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>Semilat.ub2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Semilat.intro<span class="main"><span class="main">,</span></span> <span class="operator">OF</span> is_semi<span class="main"><span class="main">]</span></span><span class="main">)</span>
  
  <span class="keyword1"><span class="command">from</span></span> step_pres_bounded sorted_tl_w' set_ss len_ss dist
  <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">q</span><span class="main">.</span> <span class="bound">q</span> <span class="main">∉</span> set<span class="main">(</span>map fst <span class="var">?qs</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">q</span> <span class="main">&lt;</span> length <span class="free">ss</span> <span class="main">⟹</span> <span class="main">(</span>fst<span class="main">(</span>propa <span class="free">f</span> <span class="var">?qs</span> <span class="free">ss</span> <span class="main">(</span>tl <span class="free">w</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="bound">q</span> <span class="main">=</span> <span class="free">ss</span><span class="main">!</span><span class="bound">q</span>"</span></span>     
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>propa_property2<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> propa <span class="keyword1"><span class="command">have</span></span> exec2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">q</span><span class="main">.</span> <span class="bound">q</span> <span class="main">∉</span> set<span class="main">(</span>map fst <span class="var">?qs</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">q</span> <span class="main">&lt;</span> length <span class="free">ss</span> <span class="main">⟹</span> <span class="free">ssa</span><span class="main">!</span><span class="bound">q</span> <span class="main">=</span> <span class="free">ss</span><span class="main">!</span><span class="bound">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 
  <span class="keyword1"><span class="command">have</span></span> tran_ss_ssa<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">p</span></span><span class="main">&lt;</span>length <span class="free">ss</span><span class="main">.</span> <span class="free">ss</span><span class="main">!</span><span class="bound">p</span> ⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span> <span class="free">ssa</span><span class="main">!</span><span class="bound">p</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> strip<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> 
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">&lt;</span> length <span class="free">ss</span>"</span></span> 
    <span class="keyword1"><span class="command">with</span></span> ssa_nth_inA <span class="keyword1"><span class="command">have</span></span> ssa_p_inA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ssa</span><span class="main">!</span><span class="skolem">p</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">`length <span class="free">ssa</span> <span class="main">=</span> <span class="free">n</span>`</span></span> <span class="quoted"><span class="quoted">`length <span class="free">ss</span> <span class="main">=</span> <span class="free">n</span>`</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> ss_nth_inA <span class="keyword1"><span class="command">have</span></span> ss_p_inA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ss</span><span class="main">!</span><span class="skolem">p</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  <span class="quoted"><span class="quoted">`length <span class="free">ss</span> <span class="main">=</span> <span class="free">n</span>`</span></span> <span class="quoted"><span class="quoted">`<span class="skolem">p</span> <span class="main">&lt;</span> length <span class="free">ss</span>`</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="free">ss</span> <span class="main">!</span> <span class="skolem">p</span> ⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span> <span class="free">ssa</span> <span class="main">!</span> <span class="skolem">p</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> succs <span class="main">(</span>hd <span class="free">w</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">ss</span><span class="main">!</span><span class="skolem">p</span> ⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>  <span class="free">ssa</span><span class="main">!</span><span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ss_lt_ssa_q <span class="keyword1"><span class="command">using</span></span> fin_succ_hd_w <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>step_def exec_def<span class="main">)</span>
     <span class="keyword1"><span class="command">next</span></span>
       <span class="keyword3"><span class="command">case</span></span> False
       <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∉</span> set <span class="main">(</span>map fst <span class="var">?qs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fin_succ_hd_w <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>step_def exec_def<span class="main">)</span>
       <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> exec2 <span class="quoted"><span class="quoted">`<span class="skolem">p</span> <span class="main">&lt;</span> length <span class="free">ss</span>`</span></span> <span class="keyword1"><span class="command">using</span></span> ssa_p_inA ss_p_inA 
         <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>step_def exec_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Semilat.orderI<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Semilat.intro<span class="main"><span class="main">,</span></span> <span class="operator">OF</span> is_semi<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">p</span></span><span class="main">&lt;</span>length <span class="free">ss0</span><span class="main">.</span> <span class="free">ss</span> <span class="main">!</span> <span class="bound">p</span> ⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span> <span class="free">ssa</span> <span class="main">!</span> <span class="bound">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> len_ss0_ss <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> lt1  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">p</span></span><span class="main">&lt;</span>length <span class="free">ss0</span><span class="main">.</span> <span class="free">ss0</span><span class="main">!</span><span class="bound">p</span> ⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span> <span class="free">ssa</span><span class="main">!</span><span class="bound">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ss0_nth_inA ssa_nth_inA  ss_nth_inA  <span class="keyword1"><span class="command">using</span></span> len_ss0_ss len_ss0_ssa 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> order_trans Semilat.orderI<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Semilat.intro<span class="main"><span class="main">,</span></span> <span class="operator">OF</span> is_semi<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> len_ss0_ssa
  <span class="keyword1"><span class="command">have</span></span> g1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ss0</span> [⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>] <span class="free">ssa</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span>Listn.le_def lesssub_def lesub_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>list_all2_all_nthI<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">ts</span><span class="main">∈</span>list <span class="free">n</span> <span class="free">A</span><span class="main">.</span> <span class="free">ss0</span> [⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>] <span class="bound">ts</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">p</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> stable <span class="free">r</span> <span class="free">step</span> <span class="bound">ts</span> <span class="bound">p</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">ssa</span> [⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>] <span class="bound">ts</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> strip<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ts</span>     
    <span class="keyword3"><span class="command">assume</span></span> ts_inA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ts</span> <span class="main">∈</span> list <span class="free">n</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ass<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ss0</span> [⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>] <span class="skolem">ts</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">p</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> stable <span class="free">r</span> <span class="free">step</span> <span class="skolem">ts</span> <span class="bound">p</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ts_hdw</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">!</span><span class="main">(</span>hd <span class="free">w</span><span class="main">)</span>"</span></span> 

    <span class="keyword1"><span class="command">from</span></span> ts_inA sta ass <span class="keyword1"><span class="command">have</span></span> ss_ts<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ss</span> [⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>] <span class="skolem">ts</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> sta_ts<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">p</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> stable <span class="free">r</span> <span class="free">step</span> <span class="skolem">ts</span> <span class="bound">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> len_ss_ts<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">ss</span> <span class="main">=</span> length <span class="skolem">ts</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
              ss_ts_hdw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?ss_hdw</span> ⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span> <span class="var">?ts_hdw</span> "</span></span><span class="keyword1"><span class="command">using</span></span> le_listD len_ss hd_w_lt_n <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>rev <span class="main">(</span><span class="var">?ts_hdw</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> set <span class="var">?ts_hdw</span> <span class="main">⊆</span> set <span class="var">?ss_hdw</span> <span class="main">∨</span> <span class="var">?ss_hdw</span> <span class="main">=</span><span class="var">?ts_hdw</span> "</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>r_def lesssub_def lesub_def  nodes_le_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> sorted_ts_hdw<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>rev <span class="main">(</span><span class="var">?ts_hdw</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword2"><span class="keyword">and</span></span> ts_ss_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="var">?ts_hdw</span> <span class="main">⊆</span> set <span class="var">?ss_hdw</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sorted_ss_hdw
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>r_def lesssub_def lesub_def  nodes_le_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span> set <span class="var">?ts_hdw</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> hd <span class="free">w</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ss_lt_hd_w <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> sorted_ts_hdw <span class="keyword1"><span class="command">have</span></span> sorted_hd_w_ts<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>rev <span class="main">(</span>hd <span class="free">w</span> <span class="main">#</span> <span class="var">?ts_hdw</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>sorted_wrt_append<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> sorted_hd_w_ss ts_ss_subset 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>hd <span class="free">w</span> <span class="main">#</span> <span class="var">?ss_hdw</span><span class="main">)</span> ⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span> <span class="main">(</span>hd <span class="free">w</span> <span class="main">#</span> <span class="var">?ts_hdw</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>transf_def lesssub_def lesub_def r_def  nodes_le_def<span class="main">)</span>  
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> transf_ss_ts<span class="main">:</span> <span class="quoted"><span class="quoted">"transf <span class="main">(</span>hd <span class="free">w</span><span class="main">)</span> <span class="var">?ss_hdw</span> ⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span> transf <span class="main">(</span>hd <span class="free">w</span><span class="main">)</span> <span class="var">?ts_hdw</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>transf_def<span class="main">)</span>

    <span class="keyword1"><span class="command">from</span></span> sta_ts hd_w_lt_n <span class="keyword1"><span class="command">have</span></span> sta_ts_hdw<span class="main">:</span> <span class="quoted"><span class="quoted">"stable <span class="free">r</span> <span class="free">step</span> <span class="skolem">ts</span> <span class="main">(</span>hd <span class="free">w</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">from</span></span> ss_hdw_nodes ts_ss_subset <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="var">?ts_hdw</span> <span class="main">⊆</span> set nodes"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> hd_w_lt_n <span class="keyword1"><span class="command">have</span></span> hdw_ts_subset_nodes<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>hd <span class="free">w</span> <span class="main">#</span> <span class="var">?ts_hdw</span><span class="main">)</span> <span class="main">⊆</span> set nodes"</span></span> <span class="keyword1"><span class="command">using</span></span> nodes_def n_def verts_set <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> sorted_hd_w_ts <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>hd <span class="free">w</span> <span class="main">#</span> <span class="var">?ts_hdw</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span> <span class="main">(</span>rev <span class="main">∘</span> sorted_list_of_set<span class="main">)</span> <span class="main">`</span> <span class="main">(</span>Pow <span class="main">(</span>set nodes<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> subset_nodes_inpow<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> transf_ts_inA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>hd <span class="free">w</span> <span class="main">#</span><span class="var">?ts_hdw</span><span class="main">)</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>A_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> sorted_hdw_ts_hdw<span class="main">:</span>  <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>rev <span class="main">(</span>hd <span class="free">w</span> <span class="main">#</span> <span class="var">?ts_hdw</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> inA_is_sorted<span class="main">)</span>   

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">p</span></span><span class="main">&lt;</span>length <span class="free">ssa</span><span class="main">.</span> <span class="free">ssa</span><span class="main">!</span><span class="bound">p</span> ⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span> <span class="skolem">ts</span><span class="main">!</span><span class="bound">p</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> strip<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> 
      <span class="keyword3"><span class="command">assume</span></span> p_lt_len_ssa<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">&lt;</span> length <span class="free">ssa</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">&lt;</span> length <span class="free">ss</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> len_ssa len_ss <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> ss_ts <span class="keyword1"><span class="command">have</span></span> ss_ts_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ss</span><span class="main">!</span><span class="skolem">p</span> ⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span> <span class="skolem">ts</span><span class="main">!</span><span class="skolem">p</span> "</span></span> <span class="keyword1"><span class="command">using</span></span> le_listD <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  

      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">ssa</span> <span class="main">!</span> <span class="skolem">p</span> ⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span> <span class="skolem">ts</span> <span class="main">!</span> <span class="skolem">p</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> succs <span class="main">(</span>hd <span class="free">w</span><span class="main">)</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">note</span></span> p_in_succs_hdw <span class="main">=</span> this
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">ss</span><span class="main">!</span><span class="skolem">p</span> ⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span> <span class="free">ssa</span><span class="main">!</span><span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ss_lt_ssa_q <span class="keyword1"><span class="command">using</span></span> fin_succ_hd_w <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>step_def exec_def<span class="main">)</span>

        <span class="keyword1"><span class="command">from</span></span> p_in_succs_hdw <span class="keyword1"><span class="command">have</span></span> ssa_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ssa</span><span class="main">!</span><span class="skolem">p</span> <span class="main">=</span> transf <span class="main">(</span>hd <span class="free">w</span><span class="main">)</span> <span class="main">(</span><span class="free">ss</span><span class="main">!</span>hd <span class="free">w</span><span class="main">)</span> ⊔<span class="hidden">⇘</span><sub><span class="free">f</span></sub><span class="hidden">⇙</span><span class="free">ss</span><span class="main">!</span><span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> propa_ss fin_succ_hd_w 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>step_def exec_def<span class="main">)</span>        

        <span class="keyword1"><span class="command">from</span></span> sta_ts_hdw <span class="keyword1"><span class="command">have</span></span> transf_hdw_ts_hdw<span class="main">:</span> <span class="quoted"><span class="quoted">"transf <span class="main">(</span>hd <span class="free">w</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ts</span><span class="main">!</span>hd <span class="free">w</span><span class="main">)</span> ⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span> <span class="skolem">ts</span><span class="main">!</span><span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> p_in_succs_hdw fin_succ_hd_w
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>step_def exec_def stable_def<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ts_p_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>hd <span class="free">w</span> <span class="main">#</span> <span class="var">?ts_hdw</span><span class="main">)</span> ⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span> <span class="skolem">ts</span><span class="main">!</span><span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>transf_def<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sorted <span class="main">(</span>rev <span class="main">(</span><span class="skolem">ts</span><span class="main">!</span><span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> set <span class="main">(</span><span class="skolem">ts</span><span class="main">!</span><span class="skolem">p</span><span class="main">)</span><span class="main">⊆</span> set <span class="main">(</span>hd <span class="free">w</span> <span class="main">#</span> <span class="var">?ts_hdw</span><span class="main">)</span><span class="main">∧</span> sorted <span class="main">(</span>rev <span class="main">(</span>hd <span class="free">w</span> <span class="main">#</span> <span class="var">?ts_hdw</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> 
                   hd <span class="free">w</span> <span class="main">#</span> <span class="var">?ts_hdw</span> <span class="main">=</span> <span class="skolem">ts</span><span class="main">!</span><span class="skolem">p</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>r_def lesssub_def lesub_def nodes_le_def<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>rev <span class="main">(</span><span class="skolem">ts</span><span class="main">!</span><span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> set <span class="main">(</span><span class="skolem">ts</span><span class="main">!</span><span class="skolem">p</span><span class="main">)</span><span class="main">⊆</span> set <span class="main">(</span>hd <span class="free">w</span> <span class="main">#</span> <span class="var">?ts_hdw</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>rev <span class="main">(</span><span class="skolem">ts</span> <span class="main">!</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> set <span class="main">(</span><span class="skolem">ts</span> <span class="main">!</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>hd <span class="free">w</span> <span class="main">#</span> <span class="skolem">ts</span> <span class="main">!</span> hd <span class="free">w</span><span class="main">)</span> <span class="main">∧</span> sorted <span class="main">(</span>rev <span class="main">(</span>hd <span class="free">w</span> <span class="main">#</span> <span class="skolem">ts</span> <span class="main">!</span> hd <span class="free">w</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">" hd <span class="free">w</span> <span class="main">#</span> <span class="skolem">ts</span> <span class="main">!</span> hd <span class="free">w</span> <span class="main">=</span> <span class="skolem">ts</span> <span class="main">!</span> <span class="skolem">p</span>"</span></span>
          <span class="keyword1"><span class="command">with</span></span> sorted_hdw_ts_hdw <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>

        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> sorted_ts_p<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>rev <span class="main">(</span><span class="skolem">ts</span><span class="main">!</span><span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span> 
              <span class="keyword2"><span class="keyword">and</span></span> ts_as_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="skolem">ts</span><span class="main">!</span><span class="skolem">p</span><span class="main">)</span><span class="main">⊆</span> set <span class="main">(</span>hd <span class="free">w</span> <span class="main">#</span> <span class="var">?ts_hdw</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> hdw_ts_subset_nodes <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="skolem">ts</span><span class="main">!</span><span class="skolem">p</span><span class="main">)</span> <span class="main">⊆</span> set nodes"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> sorted_ts_p <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ts</span><span class="main">!</span><span class="skolem">p</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span> <span class="main">(</span>rev <span class="main">∘</span> sorted_list_of_set<span class="main">)</span> <span class="main">`</span> <span class="main">(</span>Pow <span class="main">(</span>set nodes<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> subset_nodes_inpow<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ts_p_inA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ts</span><span class="main">!</span><span class="skolem">p</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>A_def<span class="main">)</span>

        <span class="keyword1"><span class="command">from</span></span> sorted_hdw_ts_hdw <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span> set <span class="var">?ts_hdw</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> hd <span class="free">w</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>sorted_wrt_append<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">`hd <span class="free">w</span> <span class="main">&lt;</span> <span class="free">n</span>`</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span> set <span class="var">?ts_hdw</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set<span class="main">(</span>hd <span class="free">w</span> <span class="main">#</span> <span class="var">?ts_hdw</span><span class="main">)</span> <span class="main">⊆</span> set nodes"</span></span><span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">`hd <span class="free">w</span> <span class="main">&lt;</span> <span class="free">n</span>`</span></span> n_def verts_set nodes_def  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> sorted_hdw_ts_hdw <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hd <span class="free">w</span> <span class="main">#</span> <span class="var">?ts_hdw</span>  <span class="main">∈</span> <span class="main">(</span> <span class="main">(</span>rev <span class="main">∘</span> sorted_list_of_set<span class="main">)</span> <span class="main">`</span> <span class="main">(</span>Pow <span class="main">(</span>set nodes<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> subset_nodes_inpow<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>hd <span class="free">w</span> <span class="main">#</span> <span class="var">?ts_hdw</span><span class="main">)</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>A_def<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> trans_hdw_ts_inA<span class="main">:</span> <span class="quoted"><span class="quoted">"transf <span class="main">(</span>hd <span class="free">w</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ts</span><span class="main">!</span>hd <span class="free">w</span><span class="main">)</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>transf_def<span class="main">)</span>

        <span class="keyword1"><span class="command">have</span></span> transf_hdw_ss_inA<span class="main">:</span> <span class="quoted"><span class="quoted">"transf <span class="main">(</span>hd <span class="free">w</span><span class="main">)</span> <span class="var">?ss_hdw</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hd_w_ss_in_A  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>transf_def<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> ss_p_inA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ss</span><span class="main">!</span><span class="skolem">p</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">`<span class="skolem">p</span><span class="main">&lt;</span>length <span class="free">ss</span>`</span></span> ss_inA <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> transf_ss_ts  transf_hdw_ts_hdw transf_hdw_ss_inA trans_hdw_ts_inA  ts_p_inA  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"transf <span class="main">(</span>hd <span class="free">w</span><span class="main">)</span> <span class="var">?ss_hdw</span> ⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span> <span class="skolem">ts</span> <span class="main">!</span> <span class="skolem">p</span>"</span></span> 
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> order_trans  Semilat.orderI<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Semilat.intro<span class="main"><span class="main">,</span></span> <span class="operator">OF</span> is_semi<span class="main"><span class="main">]</span></span><span class="main">)</span>          
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">`<span class="free">ss</span><span class="main">!</span><span class="skolem">p</span> ⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span> <span class="skolem">ts</span> <span class="main">!</span> <span class="skolem">p</span>`</span></span> trans_hdw_ts_inA ss_p_inA transf_hdw_ss_inA ssa_p ts_p_inA
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">ssa</span> <span class="main">!</span> <span class="skolem">p</span> ⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span> <span class="skolem">ts</span> <span class="main">!</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Semilat.lub<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Semilat.intro<span class="main"><span class="main">,</span></span> <span class="operator">OF</span> is_semi<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∉</span> set <span class="main">(</span>map fst <span class="var">?qs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fin_succ_hd_w <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>step_def exec_def<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">ssa</span><span class="main">!</span><span class="skolem">p</span> <span class="main">=</span> <span class="free">ss</span><span class="main">!</span><span class="skolem">p</span>"</span></span><span class="keyword1"><span class="command">using</span></span> exec2 p_lt_len_ssa len_ss len_ssa
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>step_def exec_def<span class="main">)</span>    
        <span class="keyword1"><span class="command">with</span></span> ss_ts_p <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">`length <span class="free">ss</span> <span class="main">=</span> length <span class="skolem">ts</span>`</span></span> len_ss len_ssa
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">ssa</span> [⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>] <span class="skolem">ts</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span>Listn.le_def lesssub_def lesub_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>list_all2_all_nthI<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> g1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Dom_Kildall_Property-in_list_nA_refl"><span class="command">lemma</span></span> in_list_nA_refl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ss</span> <span class="main">∈</span> list <span class="free">n</span> <span class="free">A</span>  <span class="main">⟹</span>  <span class="free">ss</span> [⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span>] <span class="free">ss</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Listn.le_def lesssub_def lesub_def<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">ss</span> <span class="main">∈</span> list <span class="free">n</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="free">ss</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"length <span class="free">ss</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="free">ss</span><span class="main">!</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="free">ss</span><span class="main">.</span> <span class="free">ss</span><span class="main">!</span><span class="bound">i</span> ⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span> <span class="free">ss</span><span class="main">!</span><span class="bound">i</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>r_def lesssub_def lesub_def nodes_le_def <span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" list_all2 <span class="free">r</span> <span class="free">ss</span> <span class="free">ss</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>lesssub_def lesub_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> list_all2_all_nthI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Dom_Kildall_Property-iter_dom"><span class="command">lemma</span></span> iter_dom<span class="main">:</span> 
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"wf_dom <span class="free">ss0</span> <span class="free">w0</span>"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"iter <span class="free">f</span> <span class="free">step</span> <span class="free">ss0</span> <span class="free">w0</span> <span class="main">=</span> <span class="main">(</span><span class="free">ss'</span><span class="main">,</span><span class="free">w'</span><span class="main">)</span> <span class="main">⟶</span> 
        wf_dom <span class="free">ss'</span> <span class="free">w'</span> <span class="main">∧</span> 
        stables <span class="free">r</span> <span class="free">step</span> <span class="free">ss'</span> <span class="main">∧</span> 
        <span class="free">ss0</span> <span class="main">[⊑⇩</span><span class="free">r</span><span class="main">]</span> <span class="free">ss'</span> <span class="main">∧</span>
        <span class="main">(</span><span class="main">∀</span><span class="bound">ts</span><span class="main">∈</span>list <span class="free">n</span> <span class="free">A</span><span class="main">.</span> <span class="free">ss0</span> <span class="main">[⊑⇩</span><span class="free">r</span><span class="main">]</span> <span class="bound">ts</span> <span class="main">∧</span> stables <span class="free">r</span> <span class="free">step</span> <span class="bound">ts</span> <span class="main">⟶</span> <span class="free">ss'</span> <span class="main">[⊑⇩</span><span class="free">r</span><span class="main">]</span> <span class="bound">ts</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> iter_def stables_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> P <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main">(</span><span class="bound">ss</span><span class="main">,</span><span class="bound">w</span><span class="main">)</span><span class="main">.</span> wf_dom <span class="bound">ss</span> <span class="bound">w</span> <span class="main">∧</span> <span class="free">ss0</span> <span class="main">[⊑⇩</span><span class="free">r</span><span class="main">]</span> <span class="bound">ss</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">ts</span><span class="main">∈</span>list <span class="free">n</span> <span class="free">A</span><span class="main">.</span> <span class="free">ss0</span> <span class="main">[⊑⇩</span><span class="free">r</span><span class="main">]</span> <span class="bound">ts</span> <span class="main">∧</span> stables <span class="free">r</span> <span class="free">step</span> <span class="bound">ts</span> <span class="main">⟶</span> <span class="bound">ss</span> <span class="main">[⊑⇩</span><span class="free">r</span><span class="main">]</span> <span class="bound">ts</span><span class="main">)</span>"</span></span> 
              <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> r <span class="main"><span class="main">=</span></span>  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">ss'</span><span class="main">,</span><span class="bound">ss</span><span class="main">)</span><span class="main">.</span> <span class="bound">ss</span> <span class="main">[⊏⇩</span><span class="free">r</span><span class="main">]</span> <span class="bound">ss'</span><span class="main">}</span> <span class="keyword1">&lt;*lex*&gt;</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>sorted_list_of_set <span class="bound">x</span><span class="main">,</span> sorted_list_of_set <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> finite_psubset"</span></span>  
         <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> while_rule<span class="main">)</span>

  <span class="comment1">― ‹Invariant holds initially:›</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_dom_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>wf_dom_le<span class="main">)</span>
  
  <span class="comment1">― ‹Invariant is preserved:›</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>propa_dom_invariant<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>stables_def<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> propa_dom_invariant_aux2<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span>

  <span class="comment1">― ‹Postcondition holds upon termination:›</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stables_def split_paired_all<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"length <span class="free">ss0</span> <span class="main">=</span> <span class="free">n</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>wf_dom_def<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

  <span class="comment1">― ‹Well-foundedness of the termination relation:›</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span> 
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>wf_listn_termination_rel<span class="main">)</span>

  <span class="comment1">― ‹Loop decreases along termination relation:›</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>propa_termination<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>   

<span class="keyword1" id="Dom_Kildall_Property-wf_start"><span class="command">lemma</span></span> wf_start<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_dom <span class="free">start</span> <span class="main">(</span>unstables <span class="free">r</span> <span class="free">step</span> <span class="free">start</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?w0</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"unstables <span class="free">r</span> <span class="free">step</span> <span class="free">start</span>"</span></span> 
  <span class="keyword1"><span class="command">have</span></span> sorted_w<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="var">?w0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> unstables_def  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>sorted_less_sorted_list_of_set<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> w0_lt_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="var">?w0</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> unstables_def len_start_is_n <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
 
  <span class="keyword1"><span class="command">have</span></span> neq_all<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">p</span></span> <span class="main">&lt;</span> <span class="free">n</span><span class="main">.</span> <span class="free">start</span><span class="main">!</span><span class="bound">p</span> <span class="main">≠</span> rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span> <span class="free">n</span><span class="main">]</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="main">(</span><span class="free">start</span><span class="main">!</span><span class="bound">p</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="bound">p</span><span class="main">)</span> "</span></span> 
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> strip<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> p_lt_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> p_neq_all<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">start</span> <span class="main">!</span> <span class="skolem">p</span> <span class="main">≠</span> rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span> <span class="free">n</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">start</span> <span class="main">!</span> <span class="skolem">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> start_nth_lt0_all len_start_is_n <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> start_nth0_empty <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x_in <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
 
  <span class="keyword1"><span class="command">have</span></span> eq_all<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">p</span></span> <span class="main">&lt;</span> <span class="free">n</span><span class="main">.</span> <span class="free">start</span><span class="main">!</span><span class="bound">p</span> <span class="main">=</span> rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span> <span class="free">n</span><span class="main">]</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">∈</span> set <span class="var">?w0</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">p</span><span class="main">)</span><span class="main">∈</span> g_E <span class="free">G</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> strip<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span>
    <span class="keyword3"><span class="command">assume</span></span> p_lt_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> p_eq_all<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">start</span> <span class="main">!</span> <span class="skolem">p</span> <span class="main">=</span> rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span> <span class="free">n</span><span class="main">]</span>"</span></span> 
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">`<span class="skolem">p</span> <span class="main">&lt;</span> <span class="free">n</span>`</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="skolem">p</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> <span class="skolem">p</span> <span class="main">&lt;</span> length <span class="free">start</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> len_start_is_n <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> p_eq_all <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> p_lt_len_start<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">&lt;</span> length <span class="free">start</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> start_nth0_empty n_def nodes_def len_verts_gt0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> set <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> len_start_is_n n_def nodes_def verts_set <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">with</span></span> dfst <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">prev</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">prev</span><span class="main">,</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">∈</span> g_E <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">prev</span> <span class="main">&lt;</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"succs <span class="skolem">prev</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">prev</span> <span class="main">&lt;</span> length <span class="free">start</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> p_lt_len_start <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>succs_def<span class="main">)</span>  
    <span class="keyword1"><span class="command">with</span></span> unstable_start  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">prev</span> <span class="main">∈</span> set <span class="var">?w0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">`<span class="main">(</span><span class="skolem">prev</span><span class="main">,</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">∈</span> g_E <span class="free">G</span>`</span></span> <span class="quoted"><span class="quoted">`<span class="skolem">prev</span> <span class="main">&lt;</span> <span class="skolem">p</span>`</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">∈</span>set <span class="main">(</span>unstables <span class="free">r</span> <span class="free">step</span> <span class="free">start</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">∈</span> g_E <span class="free">G</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">p</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>     
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">p</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="bound">p</span> <span class="main">∉</span> set <span class="main">(</span>unstables <span class="free">r</span> <span class="free">step</span> <span class="free">start</span><span class="main">)</span><span class="main">⟶</span> stable <span class="free">r</span> <span class="free">step</span> <span class="free">start</span> <span class="bound">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> unstables_def<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>n_def start_def nodes_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> sorted_start_nth neq_all eq_all start_subset_A sorted_w len_start_is_n w0_lt_n <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span>wf_dom_def<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Dom_Kildall_Property-iter_dom_properties"><span class="command">lemma</span></span> iter_dom_properties<span class="main">:</span>
 <span class="quoted"><span class="quoted">"iter <span class="free">f</span> <span class="free">step</span> <span class="free">start</span> <span class="main">(</span>unstables <span class="free">r</span> <span class="free">step</span> <span class="free">start</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">ss'</span><span class="main">,</span><span class="free">w'</span><span class="main">)</span> <span class="main">⟶</span> 
  wf_dom <span class="free">ss'</span> <span class="free">w'</span> <span class="main">∧</span> 
  stables <span class="free">r</span> <span class="free">step</span> <span class="free">ss'</span> <span class="main">∧</span> 
  <span class="free">start</span> <span class="main">[⊑⇩</span><span class="free">r</span><span class="main">]</span> <span class="free">ss'</span> <span class="main">∧</span>
  <span class="main">(</span><span class="main">∀</span><span class="bound">ts</span><span class="main">∈</span>list <span class="free">n</span> <span class="free">A</span><span class="main">.</span> <span class="free">start</span> <span class="main">[⊑⇩</span><span class="free">r</span><span class="main">]</span> <span class="bound">ts</span> <span class="main">∧</span> stables <span class="free">r</span> <span class="free">step</span> <span class="bound">ts</span> <span class="main">⟶</span> <span class="free">ss'</span> <span class="main">[⊑⇩</span><span class="free">r</span><span class="main">]</span> <span class="bound">ts</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> iter_dom<span class="main">[</span><span class="operator">OF</span> wf_start<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Dom_Kildall_Property-iter_dom_properties2"><span class="command">lemma</span></span> iter_dom_properties2<span class="main">:</span>
 <span class="quoted"><span class="quoted">"iter <span class="free">f</span> <span class="free">step</span> <span class="free">start</span> <span class="main">(</span>unstables <span class="free">r</span> <span class="free">step</span> <span class="free">start</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">ss'</span><span class="main">,</span><span class="free">w'</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">ss'</span> <span class="main">∈</span> list <span class="free">n</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> iter_dom_properties <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span>wf_dom_def list_def<span class="main">)</span>

<span class="keyword1" id="Dom_Kildall_Property-iter_dom_termination"><span class="command">lemma</span></span> iter_dom_termination<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"iter <span class="free">f</span> <span class="free">step</span> <span class="free">start</span> <span class="main">(</span>unstables <span class="free">r</span> <span class="free">step</span> <span class="free">start</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">ss</span><span class="main">,</span><span class="free">w</span><span class="main">)</span> <span class="main">⟶</span> 
   <span class="free">w</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟶</span>
   propa <span class="free">f</span> <span class="main">(</span><span class="free">step</span> <span class="main">(</span>hd <span class="free">w</span><span class="main">)</span> <span class="main">(</span><span class="free">ss</span><span class="main">!</span><span class="main">(</span>hd <span class="free">w</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">ss</span> <span class="main">(</span>tl <span class="free">w</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">ss</span><span class="main">,</span> tl <span class="free">w</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> strip<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> iter<span class="main">:</span> <span class="quoted"><span class="quoted">"iter <span class="free">f</span> <span class="free">step</span> <span class="free">start</span> <span class="main">(</span>unstables <span class="free">r</span> <span class="free">step</span> <span class="free">start</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">ss</span><span class="main">,</span> <span class="free">w</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> w_n_nil<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> iter_dom_properties 
  <span class="keyword1"><span class="command">have</span></span> stas<span class="main">:</span> <span class="quoted"><span class="quoted">"stables <span class="free">r</span> <span class="free">step</span> <span class="free">ss</span>"</span></span> 
   <span class="keyword2"><span class="keyword">and</span></span> wf_ss_w<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_dom <span class="free">ss</span> <span class="free">w</span>"</span></span> 
   <span class="keyword2"><span class="keyword">and</span></span> start_le_ss<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">start</span> <span class="main">[⊑⇩</span><span class="free">r</span><span class="main">]</span> <span class="free">ss</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> stas <span class="keyword1"><span class="command">have</span></span> sta_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">p</span></span> <span class="main">&lt;</span> size <span class="free">ss</span><span class="main">.</span> stable <span class="free">r</span> <span class="free">step</span> <span class="free">ss</span> <span class="bound">p</span><span class="main">)</span>"</span></span><span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>stables_def<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> wf_ss_w <span class="keyword1"><span class="command">have</span></span> n_w_sta<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">p</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="bound">p</span> <span class="main">∉</span>set <span class="free">w</span> <span class="main">⟶</span>  stable <span class="free">r</span> <span class="free">step</span> <span class="free">ss</span> <span class="bound">p</span>"</span></span> 
                      <span class="keyword2"><span class="keyword">and</span></span> len_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">ss</span> <span class="main">=</span> <span class="free">n</span>"</span></span> 
                      <span class="keyword2"><span class="keyword">and</span></span> w_lt_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span> set <span class="free">w</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> 
                      <span class="keyword2"><span class="keyword">and</span></span> ss_inA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="free">ss</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span>  <span class="free">A</span>"</span></span> 
                      <span class="keyword2"><span class="keyword">and</span></span> sorted_w<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="free">w</span> "</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>wf_dom_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> w_lt_n <span class="keyword1"><span class="command">have</span></span> hd_w_lt_n<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="free">w</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> w_n_nil <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> hd_w_in_verts<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="free">w</span> <span class="main">∈</span> set <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n_def nodes_def verts_set <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> fin_succ_hd_w<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>succs <span class="main">(</span>hd <span class="free">w</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fin_succs hd_w_in_verts <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ss_hdw</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">ss</span><span class="main">!</span>hd <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?qs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">step</span> <span class="main">(</span>hd <span class="free">w</span><span class="main">)</span> <span class="var">?ss_hdw</span>"</span></span>  

  <span class="keyword1"><span class="command">from</span></span> hd_w_lt_n <span class="keyword1"><span class="command">have</span></span> dist<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map fst <span class="var">?qs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> distinct_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> wf_ss_w w_n_nil <span class="keyword1"><span class="command">have</span></span> hdw_ss_subset_nodes<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>hd <span class="free">w</span> <span class="main">#</span> <span class="var">?ss_hdw</span><span class="main">)</span> <span class="main">⊆</span> set nodes"</span></span>
                        <span class="keyword2"><span class="keyword">and</span></span> sorted_hd_w_ss<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>rev <span class="main">(</span>hd <span class="free">w</span> <span class="main">#</span> <span class="var">?ss_hdw</span><span class="main">)</span><span class="main">)</span>"</span></span> 
                        <span class="keyword2"><span class="keyword">and</span></span> hd_w_ss_in_A<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">(</span>hd <span class="free">w</span> <span class="main">#</span> <span class="var">?ss_hdw</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
                        <span class="keyword2"><span class="keyword">and</span></span> step_pres_bounded<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span> <span class="bound">τ</span><span class="main">)</span><span class="main">∈</span>set <span class="var">?qs</span><span class="main">.</span> <span class="bound">q</span> <span class="main">&lt;</span> length <span class="free">ss</span> <span class="main">∧</span> <span class="bound">τ</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> propa_dom_invariant_auxi <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?res</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"propa <span class="free">f</span> <span class="main">(</span><span class="free">step</span> <span class="main">(</span>hd <span class="free">w</span><span class="main">)</span> <span class="main">(</span><span class="free">ss</span><span class="main">!</span><span class="main">(</span>hd <span class="free">w</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">ss</span> <span class="main">(</span>tl <span class="free">w</span><span class="main">)</span> "</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"propa <span class="free">f</span> <span class="main">(</span><span class="free">step</span> <span class="main">(</span>hd <span class="free">w</span><span class="main">)</span> <span class="main">(</span><span class="free">ss</span><span class="main">!</span><span class="main">(</span>hd <span class="free">w</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">ss</span> <span class="main">(</span>tl <span class="free">w</span><span class="main">)</span> <span class="main">=</span> <span class="var">?res</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ss'</span></span> <span class="skolem"><span class="skolem">w'</span></span> <span class="keyword2"><span class="keyword">where</span></span> propa<span class="main">:</span> <span class="quoted"><span class="quoted">"propa <span class="free">f</span> <span class="main">(</span><span class="free">step</span> <span class="main">(</span>hd <span class="free">w</span><span class="main">)</span> <span class="main">(</span><span class="free">ss</span><span class="main">!</span><span class="main">(</span>hd <span class="free">w</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">ss</span> <span class="main">(</span>tl <span class="free">w</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ss'</span><span class="main">,</span> <span class="skolem">w'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="var"><span class="quoted"><span class="var">?res</span></span></span><span class="main">)</span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> sorted_w <span class="keyword1"><span class="command">have</span></span> sorted_tl_b<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>tl <span class="free">w</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">w</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> ss_inA <span class="keyword1"><span class="command">have</span></span> set_a<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">ss</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> step_pres_bounded sorted_tl_b len_eq dist <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span> <span class="bound">τ</span><span class="main">)</span> <span class="main">∈</span> set <span class="var">?qs</span><span class="main">.</span> <span class="main">(</span>fst<span class="main">(</span>propa <span class="free">f</span> <span class="var">?qs</span> <span class="free">ss</span> <span class="main">(</span>tl <span class="free">w</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="bound">q</span> <span class="main">=</span> <span class="bound">τ</span> ⊔<span class="hidden">⇘</span><sub><span class="free">f</span></sub><span class="hidden">⇙</span><span class="free">ss</span><span class="main">!</span><span class="bound">q</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>propa_property1<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> propa <span class="keyword1"><span class="command">have</span></span> propa_ss1<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span> <span class="bound">τ</span><span class="main">)</span> <span class="main">∈</span> set <span class="var">?qs</span><span class="main">.</span> <span class="skolem">ss'</span><span class="main">!</span><span class="bound">q</span> <span class="main">=</span>  <span class="main">(</span>hd <span class="free">w</span> <span class="main">#</span> <span class="var">?ss_hdw</span><span class="main">)</span> ⊔<span class="hidden">⇘</span><sub><span class="free">f</span></sub><span class="hidden">⇙</span><span class="free">ss</span><span class="main">!</span><span class="bound">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>step_def exec_def transf_def<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> step_pres_bounded sorted_tl_b set_a  len_eq dist
  <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">q</span><span class="main">.</span> <span class="bound">q</span> <span class="main">∉</span> set<span class="main">(</span>map fst <span class="var">?qs</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">q</span> <span class="main">&lt;</span> length <span class="free">ss</span> <span class="main">⟹</span> <span class="main">(</span>fst<span class="main">(</span>propa <span class="free">f</span> <span class="var">?qs</span> <span class="free">ss</span> <span class="main">(</span>tl <span class="free">w</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="bound">q</span> <span class="main">=</span> <span class="free">ss</span><span class="main">!</span><span class="bound">q</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>propa_property2<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> propa <span class="keyword1"><span class="command">have</span></span> g2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">q</span><span class="main">.</span> <span class="bound">q</span> <span class="main">∉</span> set<span class="main">(</span>map fst <span class="var">?qs</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">q</span> <span class="main">&lt;</span> length <span class="free">ss</span> <span class="main">⟹</span> <span class="skolem">ss'</span><span class="main">!</span><span class="bound">q</span> <span class="main">=</span> <span class="free">ss</span><span class="main">!</span><span class="bound">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> sorted_w <span class="keyword1"><span class="command">have</span></span> sorted_tl_w<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>tl <span class="free">w</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">w</span></span><span class="main">)</span>  <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> step_pres_bounded set_a 
  <span class="keyword1"><span class="command">have</span></span> fst_propa<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>propa <span class="free">f</span> <span class="var">?qs</span> <span class="free">ss</span> <span class="main">(</span>tl <span class="free">w</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>merges <span class="free">f</span> <span class="var">?qs</span> <span class="free">ss</span><span class="main">)</span>"</span></span>   
   <span class="keyword2"><span class="keyword">and</span></span> snd_propa<span class="main">:</span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>propa <span class="free">f</span> <span class="var">?qs</span> <span class="free">ss</span> <span class="main">(</span>tl <span class="free">w</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>sorted_list_of_set <span class="main">(</span><span class="main">{</span><span class="bound">q</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t</span><span class="main">.</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span><span class="bound">t</span><span class="main">)</span><span class="main">∈</span>set <span class="var">?qs</span> <span class="main">∧</span> <span class="bound">t</span> ⊔<span class="hidden">⇘</span><sub><span class="free">f</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">ss</span><span class="main">!</span><span class="bound">q</span><span class="main">)</span> <span class="main">≠</span> <span class="free">ss</span><span class="main">!</span><span class="bound">q</span><span class="main">}</span> <span class="main">∪</span> set <span class="main">(</span>tl <span class="free">w</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> decomp_propa <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> propa <span class="keyword1"><span class="command">have</span></span> len_ss_eq_ss'<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="skolem">ss'</span> <span class="main">=</span> length <span class="free">ss</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> length_merges <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> ss_ss'_eq<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="main">(</span>fst <span class="main">(</span>propa <span class="free">f</span> <span class="var">?qs</span> <span class="free">ss</span> <span class="main">(</span>tl <span class="free">w</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="bound">i</span> <span class="main">=</span> <span class="free">ss</span><span class="main">!</span><span class="bound">i</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> strip<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> 
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> i_lt_len_ss<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">ss</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">`length <span class="free">ss</span> <span class="main">=</span> <span class="free">n</span>`</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>propa <span class="free">f</span> <span class="var">?qs</span> <span class="free">ss</span> <span class="main">(</span>tl <span class="free">w</span><span class="main">)</span><span class="main">)</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span> <span class="free">ss</span> <span class="main">!</span> <span class="skolem">i</span> "</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> set<span class="main">(</span>map fst <span class="var">?qs</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword3"><span class="command">assume</span></span> ass1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> set <span class="main">(</span>map fst <span class="var">?qs</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">with</span></span> propa_ss1 <span class="keyword1"><span class="command">have</span></span> ss'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ss'</span><span class="main">!</span><span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span>hd <span class="free">w</span> <span class="main">#</span> <span class="var">?ss_hdw</span><span class="main">)</span> ⊔<span class="hidden">⇘</span><sub><span class="free">f</span></sub><span class="hidden">⇙</span><span class="free">ss</span><span class="main">!</span><span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> step_def exec_def<span class="main">)</span>    
      <span class="keyword1"><span class="command">from</span></span> ass1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> set <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> succ_in_G fin_succ_hd_w <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>step_def exec_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> q_lt_len_ss<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> length <span class="free">ss</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> len_eq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>n_def nodes_def verts_set<span class="main">)</span>      
      <span class="keyword1"><span class="command">from</span></span> hd_w_lt_n len_eq stas <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"stable <span class="free">r</span> <span class="free">step</span> <span class="free">ss</span> <span class="main">(</span>hd <span class="free">w</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>stables_def<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> ass1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>hd <span class="free">w</span> <span class="main">#</span> <span class="var">?ss_hdw</span><span class="main">)</span> <span class="main">⊑⇩</span><span class="free">r</span> <span class="free">ss</span><span class="main">!</span><span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>stables_def stable_def step_def exec_def transf_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="free">ss</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>hd <span class="free">w</span> <span class="main">#</span> <span class="var">?ss_hdw</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span>hd <span class="free">w</span> <span class="main">#</span> <span class="var">?ss_hdw</span><span class="main">)</span> <span class="main">=</span> <span class="free">ss</span><span class="main">!</span><span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>lesssub_def lesub_def r_def nodes_le_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> set_ss_q_subst_hdw_ss<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="free">ss</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>hd <span class="free">w</span> <span class="main">#</span> <span class="var">?ss_hdw</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> disjE<span class="main">)</span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>lesssub_def lesub_def r_def nodes_le_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ss_q<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="free">ss</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> <span class="main">∩</span> set <span class="main">(</span>hd <span class="free">w</span> <span class="main">#</span> <span class="var">?ss_hdw</span><span class="main">)</span> <span class="main">=</span> set <span class="main">(</span><span class="free">ss</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> wf_ss_w q_lt_len_ss <span class="keyword1"><span class="command">have</span></span> sorted_ss_q<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>rev <span class="main">(</span><span class="free">ss</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>wf_dom_def<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> sorted_hd_w_ss <span class="keyword1"><span class="command">have</span></span> ss_q'<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="skolem">ss'</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> set <span class="main">(</span><span class="free">ss</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> <span class="main">∩</span> set <span class="main">(</span>hd <span class="free">w</span> <span class="main">#</span> <span class="var">?ss_hdw</span><span class="main">)</span>"</span></span> 
                           <span class="keyword2"><span class="keyword">and</span></span> sorrted_ss_q'<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>rev <span class="main">(</span><span class="skolem">ss'</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ss'
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>plussub_def f_def nodes_sup_def inter_sorted_correct<span class="main">)</span> 
      <span class="keyword1"><span class="command">with</span></span> ss_q sorted_ss_q sorrted_ss_q' <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> sorted_less_rev_set_unique propa <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>   
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">note</span></span> i_nin <span class="main">=</span> this
      <span class="keyword1"><span class="command">from</span></span> step_pres_bounded sorted_tl_b set_a len_eq dist propa i_lt_len_ss i_nin 
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>propa_property2<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> len_ss_eq_ss' <span class="keyword1"><span class="command">have</span></span> eq_ss<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ss'</span> <span class="main">=</span> <span class="free">ss</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> len_eq propa <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>list_eq_iff_nth_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> qs_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">{</span><span class="bound">q</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t</span><span class="main">.</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span><span class="bound">t</span><span class="main">)</span><span class="main">∈</span>set <span class="var">?qs</span> <span class="main">∧</span> <span class="bound">t</span> ⊔<span class="hidden">⇘</span><sub><span class="free">f</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">ss</span><span class="main">!</span><span class="bound">q</span><span class="main">)</span> <span class="main">≠</span> <span class="free">ss</span><span class="main">!</span><span class="bound">q</span><span class="main">}</span> <span class="main">∪</span> set <span class="main">(</span>tl <span class="free">w</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>  <span class="main">(</span>set <span class="main">(</span>tl <span class="free">w</span><span class="main">)</span><span class="main">)</span>"</span></span> 
   <span class="keyword1"><span class="command">using</span></span> propa_ss1 propa transf_def step_def exec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">with</span></span> snd_propa <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>propa <span class="free">f</span> <span class="var">?qs</span> <span class="free">ss</span> <span class="main">(</span>tl <span class="free">w</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> sorted_list_of_set <span class="main">(</span>set <span class="main">(</span>tl <span class="free">w</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sorted_w <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> sorted_tl_w <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>propa <span class="free">f</span> <span class="var">?qs</span> <span class="free">ss</span> <span class="main">(</span>tl <span class="free">w</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> tl <span class="free">w</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>sorted_less_set_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> propa <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w'</span> <span class="main">=</span> tl <span class="free">w</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> eq_ss <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"propa <span class="free">f</span> <span class="main">(</span><span class="free">step</span> <span class="main">(</span>hd <span class="free">w</span><span class="main">)</span> <span class="main">(</span><span class="free">ss</span> <span class="main">!</span> hd <span class="free">w</span><span class="main">)</span><span class="main">)</span> <span class="free">ss</span> <span class="main">(</span>tl <span class="free">w</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">ss</span><span class="main">,</span> tl <span class="free">w</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> propa <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="Dom_Kildall_Property-dom_iter_properties"><span class="command">lemma</span></span> dom_iter_properties<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"iter <span class="free">f</span> <span class="free">step</span> <span class="free">start</span> <span class="main">(</span>unstables <span class="free">r</span> <span class="free">step</span> <span class="free">start</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">ss</span><span class="main">,</span> <span class="free">w</span><span class="main">)</span> <span class="main">⟶</span> 
   <span class="free">ss</span><span class="main">!</span><span class="main">0</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> 
   <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">p</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="bound">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟶</span> <span class="free">ss</span><span class="main">!</span><span class="bound">p</span> <span class="main">≠</span> <span class="main">(</span>rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> strip<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> iter<span class="main">:</span> <span class="quoted"><span class="quoted">"iter <span class="free">f</span> <span class="free">step</span> <span class="free">start</span> <span class="main">(</span>unstables <span class="free">r</span> <span class="free">step</span> <span class="free">start</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">ss</span><span class="main">,</span> <span class="free">w</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> iter_dom_properties iter_dom_properties2
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"wf_dom <span class="free">ss</span> <span class="free">w</span>"</span></span> 
   <span class="keyword2"><span class="keyword">and</span></span> stas<span class="main">:</span> <span class="quoted"><span class="quoted">"stables <span class="free">r</span> <span class="free">step</span> <span class="free">ss</span>"</span></span> 
   <span class="keyword2"><span class="keyword">and</span></span> start_le_ss<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">start</span> <span class="main">[⊑⇩</span><span class="free">r</span><span class="main">]</span> <span class="free">ss</span>"</span></span> 
   <span class="keyword2"><span class="keyword">and</span></span> ss_inA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ss</span> <span class="main">∈</span> list <span class="free">n</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> len_ss_n<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">ss</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> start_le_ss <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">start</span><span class="main">!</span><span class="main">0</span> <span class="main">⊑⇩</span><span class="free">r</span> <span class="free">ss</span><span class="main">!</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> start_len_gt_0
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> Listn.le_def lesssub_def lesub_def<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>lesssub_def lesub_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>list_all2_nthD<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ss_0th<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ss</span><span class="main">!</span><span class="main">0</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>r_def nodes_le_def lesssub_def lesub_def start_def<span class="main">)</span>
 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">p</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="bound">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟶</span> <span class="free">ss</span> <span class="main">!</span> <span class="bound">p</span> <span class="main">≠</span>  <span class="main">(</span>rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>  
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> strip<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span>
    <span class="keyword3"><span class="command">assume</span></span> p_lt_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> p_neq_0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">≠</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ss_p_eq_all<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">ss</span> <span class="main">!</span> <span class="skolem">p</span> <span class="main">≠</span> rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> stas len_ss_n  <span class="keyword1"><span class="command">have</span></span> step_sta<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span><span class="bound">τ</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">step</span> <span class="skolem">p</span> <span class="main">(</span><span class="free">ss</span><span class="main">!</span><span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">τ</span> <span class="main">⊑⇩</span><span class="free">r</span> <span class="free">ss</span><span class="main">!</span><span class="bound">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stables_def stable_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> p_lt_n len_start_is_n verts_set <span class="keyword1"><span class="command">have</span></span> p_is_vert<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> set <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>n_def nodes_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> step_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span><span class="bound">τ</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">step</span> <span class="skolem">p</span> <span class="main">(</span><span class="free">ss</span><span class="main">!</span><span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">q</span> <span class="main">∈</span> succs <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fin_succs <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>step_def exec_def<span class="main">)</span>

    <span class="keyword1"><span class="command">from</span></span> p_is_vert p_neq_0 dfst <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">prev</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">prev</span><span class="main">,</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">∈</span> g_E <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> prev_lt_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">prev</span> <span class="main">&lt;</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> prev_lt_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">prev</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> 
         <span class="keyword2"><span class="keyword">and</span></span> prev_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> succs <span class="skolem">prev</span>"</span></span> 
         <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">prev</span> <span class="main">∈</span> set <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> p_lt_n tail_is_vert <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>succs_def<span class="main">)</span>     
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> fin_suc_prev <span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>succs <span class="skolem">prev</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fin_succs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?prev_τ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">ss</span><span class="main">!</span><span class="skolem">prev</span>"</span></span>    

    <span class="keyword1"><span class="command">from</span></span> prev_lt_n stas <span class="quoted"><span class="quoted">`length <span class="free">ss</span> <span class="main">=</span> <span class="free">n</span>`</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"stable <span class="free">r</span> <span class="free">step</span> <span class="free">ss</span> <span class="skolem">prev</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>stables_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span><span class="bound">τ</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">step</span> <span class="skolem">prev</span> <span class="var">?prev_τ</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="skolem">prev</span> <span class="main">#</span> <span class="var">?prev_τ</span><span class="main">)</span> <span class="main">⊑⇩</span><span class="free">r</span> <span class="free">ss</span><span class="main">!</span><span class="bound">q</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stable_def transf_def step_def exec_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> prev_p <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">prev</span> <span class="main">#</span> <span class="var">?prev_τ</span><span class="main">)</span> ⊑<span class="hidden">⇘</span><sub><span class="free">r</span></sub><span class="hidden">⇙</span> <span class="free">ss</span> <span class="main">!</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fin_suc_prev <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stable_def transf_def step_def exec_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> ss_p_eq_all <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>rev <span class="main">(</span><span class="skolem">prev</span> <span class="main">#</span> <span class="var">?prev_τ</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">}</span> <span class="main">⊆</span> set <span class="main">(</span><span class="skolem">prev</span> <span class="main">#</span> <span class="var">?prev_τ</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">prev</span> <span class="main">#</span> <span class="free">ss</span> <span class="main">!</span> <span class="skolem">prev</span><span class="main">)</span> <span class="main">=</span>  <span class="main">(</span>rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>r_def lesssub_def lesub_def nodes_le_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>rev <span class="main">(</span><span class="skolem">prev</span> <span class="main">#</span> <span class="var">?prev_τ</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">}</span> <span class="main">⊆</span> set <span class="main">(</span><span class="skolem">prev</span> <span class="main">#</span> <span class="var">?prev_τ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> disjE<span class="main">)</span>  <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> sorted_rev<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>rev <span class="main">(</span><span class="skolem">prev</span> <span class="main">#</span> <span class="var">?prev_τ</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword2"><span class="keyword">and</span></span> pres_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">}</span> <span class="main">⊆</span> set <span class="main">(</span><span class="skolem">prev</span> <span class="main">#</span> <span class="var">?prev_τ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>    
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> prev_set<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span> set <span class="var">?prev_τ</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">prev</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="var"><span class="quoted"><span class="var">?prev_τ</span></span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>sorted_wrt_append<span class="main">)</span>
    
    <span class="keyword1"><span class="command">from</span></span> p_lt_n prev_lt_p <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">prev</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n_def nodes_def len_verts_gt0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> prev_set <span class="keyword1"><span class="command">have</span></span> prev_lt_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set<span class="main">(</span><span class="skolem">prev</span> <span class="main">#</span> <span class="var">?prev_τ</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> pres_subset <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">-</span> <span class="main">1</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">prev</span> <span class="main">#</span> <span class="var">?prev_τ</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n_def nodes_def len_verts_gt0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">with</span></span> prev_lt_n <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">with</span></span> ss_0th <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="free">ss</span> <span class="main">!</span> <span class="main">0</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">p</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> <span class="bound">p</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟶</span> <span class="free">ss</span> <span class="main">!</span> <span class="bound">p</span> <span class="main">≠</span> rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Dom_Kildall_Property-dom_iter_properties2"><span class="command">lemma</span></span> dom_iter_properties2<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"iter <span class="free">f</span> <span class="free">step</span> <span class="free">start</span> <span class="main">(</span>unstables <span class="free">r</span> <span class="free">step</span> <span class="free">start</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">ss</span><span class="main">,</span><span class="free">w</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">p</span></span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span>  <span class="free">ss</span><span class="main">!</span><span class="bound">p</span> <span class="main">≠</span> <span class="main">(</span>rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> strip<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> 
  <span class="keyword3"><span class="command">assume</span></span> iter<span class="main">:</span> <span class="quoted"><span class="quoted">"iter <span class="free">f</span> <span class="free">step</span> <span class="free">start</span> <span class="main">(</span>unstables <span class="free">r</span> <span class="free">step</span> <span class="free">start</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">ss</span><span class="main">,</span> <span class="free">w</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">ss</span> <span class="main">!</span> <span class="skolem">p</span> <span class="main">≠</span> <span class="main">(</span>rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True  
    <span class="keyword1"><span class="command">with</span></span> iter <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">ss</span><span class="main">!</span><span class="skolem">p</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span>  <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>dom_iter_properties<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> n_def nodes_def len_verts_gt0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> iter p <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>dom_iter_properties<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Dom_Kildall_Property-kildall_dom_properties"><span class="command">lemma</span></span> kildall_dom_properties<span class="main">:</span>
  <span class="quoted"><span class="quoted">"kildall <span class="free">r</span> <span class="free">f</span> <span class="free">step</span> <span class="free">start</span> <span class="main">∈</span> list <span class="free">n</span> <span class="free">A</span> <span class="main">∧</span> 
   stables <span class="free">r</span> <span class="free">step</span> <span class="main">(</span>kildall <span class="free">r</span> <span class="free">f</span> <span class="free">step</span> <span class="free">start</span><span class="main">)</span> <span class="main">∧</span> 
   <span class="free">start</span> <span class="main">[⊑⇩</span><span class="free">r</span><span class="main">]</span> <span class="main">(</span>kildall <span class="free">r</span> <span class="free">f</span> <span class="free">step</span> <span class="free">start</span><span class="main">)</span> <span class="main">∧</span>
   <span class="main">(</span><span class="main">∀</span><span class="bound">ts</span><span class="main">∈</span>list <span class="free">n</span> <span class="free">A</span><span class="main">.</span> <span class="free">start</span> <span class="main">[⊑⇩</span><span class="free">r</span><span class="main">]</span> <span class="bound">ts</span> <span class="main">∧</span> stables <span class="free">r</span> <span class="free">step</span> <span class="bound">ts</span> <span class="main">⟶</span> <span class="main">(</span>kildall <span class="free">r</span> <span class="free">f</span> <span class="free">step</span> <span class="free">start</span><span class="main">)</span> <span class="main">[⊑⇩</span><span class="free">r</span><span class="main">]</span> <span class="bound">ts</span><span class="main">)</span>"</span></span>  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">PROP</span> <span class="var">?P</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"iter <span class="free">f</span> <span class="free">step</span> <span class="free">start</span> <span class="main">(</span>unstables <span class="free">r</span> <span class="free">step</span> <span class="free">start</span><span class="main">)</span>"</span></span><span class="main">)</span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> kildall_def iter_dom_properties iter_dom_properties2<span class="main">)</span>

<span class="keyword1" id="Dom_Kildall_Property-dom_kildall_stables"><span class="command">lemma</span></span> dom_kildall_stables<span class="main">:</span> <span class="quoted"><span class="quoted">"stables <span class="free">r</span> <span class="free">step</span> <span class="main">(</span>dom_kildall <span class="free">start</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> kildall_dom_properties 
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">unfold</span> dom_kildall_def nodes_semi_def<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> r_def f_def step_def<span class="main">)</span>

<span class="keyword1" id="Dom_Kildall_Property-dom_kildall_entry"><span class="command">lemma</span></span> dom_kildall_entry<span class="main">:</span> <span class="quoted"><span class="quoted">"dom_kildall <span class="free">start</span> <span class="main">!</span><span class="main">0</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"iter <span class="free">f</span> <span class="free">step</span> <span class="free">start</span> <span class="main">(</span>unstables <span class="free">r</span> <span class="free">step</span> <span class="free">start</span><span class="main">)</span>"</span></span><span class="main">)</span>
     <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>dom_kildall_def nodes_semi_def dom_iter_properties r_def f_def step_def kildall_def<span class="main">)</span>

<span class="keyword1" id="Dom_Kildall_Property-zero_dom_zero"><span class="command">lemma</span></span> zero_dom_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"dom <span class="free">i</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> start_def n_def nodes_def dom_kildall_entry  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>dom_def<span class="main">)</span>

<span class="comment1">(*lemma sadom_succs:  "strict_dom i j ⟹ j ∈ succs k ⟹ strict_dom i k"*)</span>

<span class="keyword1" id="Dom_Kildall_Property-sdom_dom_succs"><span class="command">lemma</span></span> sdom_dom_succs<span class="main">:</span> <span class="quoted"><span class="quoted">"strict_dom <span class="free">i</span> <span class="free">j</span> <span class="main">⟹</span> <span class="free">j</span> <span class="main">∈</span> succs <span class="free">k</span> <span class="main">⟹</span> dom <span class="free">i</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword3"><span class="command">assume</span></span> sdom_i_j<span class="main">:</span> <span class="quoted"><span class="quoted">"strict_dom <span class="free">i</span> <span class="free">j</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> k_j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">∈</span> succs <span class="free">k</span>"</span></span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">∈</span> set <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span>"</span></span> 
        <span class="keyword2"><span class="keyword">and</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">∈</span> set <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> verts_set succ_in_verts <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> j_lt_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> k_lt_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> n_def nodes_def verts_set <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> fin_succs_k<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>succs <span class="free">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fin_succs k <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> k_j <span class="keyword1"><span class="command">have</span></span> k_j2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">∈</span> set <span class="main">(</span>rev <span class="main">(</span>sorted_list_of_set<span class="main">(</span>succs <span class="free">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ss0</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">start</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?w0</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"unstables <span class="free">r</span> <span class="free">step</span> <span class="free">start</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?res</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"dom_kildall <span class="free">start</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> dom_kil<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?res</span> <span class="main">=</span> kildall <span class="free">r</span> <span class="free">f</span> <span class="free">step</span> <span class="var">?ss0</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>dom_kildall_def r_def f_def step_def nodes_semi_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> sorted_unstables<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="var">?w0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>unstables_def sorted_less_sorted_list_of_set<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> ss<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?res</span> <span class="main">=</span> fst <span class="main">(</span>iter <span class="free">f</span> <span class="free">step</span> <span class="var">?ss0</span> <span class="var">?w0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>dom_kildall_def kildall_def f_def step_def nodes_semi_def start_def r_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ww</span></span> <span class="keyword2"><span class="keyword">where</span></span> dom_iter<span class="main">:</span> <span class="quoted"><span class="quoted">"iter <span class="free">f</span> <span class="free">step</span> <span class="var">?ss0</span> <span class="var">?w0</span> <span class="main">=</span> <span class="main">(</span><span class="var">?res</span><span class="main">,</span> <span class="skolem">ww</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"iter <span class="free">f</span> <span class="free">step</span> <span class="var">?ss0</span> <span class="var">?w0</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>  
  <span class="keyword1"><span class="command">with</span></span> iter_dom_properties <span class="keyword1"><span class="command">have</span></span> wf_res<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_dom <span class="main">(</span>dom_kildall <span class="free">start</span><span class="main">)</span> <span class="skolem">ww</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
  <span class="keyword1"><span class="command">with</span></span> sdom_i_j <span class="keyword1"><span class="command">have</span></span> i_dom_j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∈</span> set <span class="main">(</span><span class="var">?res</span><span class="main">!</span><span class="free">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>strict_dom_def start_def n_def nodes_def<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> wf_res <span class="keyword1"><span class="command">have</span></span> len_res<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="var">?res</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>wf_dom_def<span class="main">)</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dom <span class="free">i</span> <span class="free">k</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> ass<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> dom <span class="free">i</span> <span class="free">k</span>"</span></span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> i_neq_k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>dom_refl<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> ass <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">res</span><span class="main">.</span> <span class="var">?res</span><span class="main">!</span><span class="free">k</span> <span class="main">=</span> <span class="bound">res</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">∉</span> set <span class="bound">res</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ass <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>dom_def start_def nodes_def n_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">res</span><span class="main">.</span> <span class="var">?res</span> <span class="main">!</span> <span class="free">k</span> <span class="main">=</span>  <span class="bound">res</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">∉</span> set <span class="bound">res</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">rs</span></span> <span class="keyword2"><span class="keyword">where</span></span> k_dom<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?res</span> <span class="main">!</span> <span class="free">k</span> <span class="main">=</span> <span class="skolem">rs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> i_notin_rs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∉</span> set <span class="skolem">rs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>     

      <span class="keyword1"><span class="command">from</span></span> iter_dom_properties dom_iter <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">p</span></span> <span class="main">&lt;</span> length <span class="var">?res</span><span class="main">.</span> stable <span class="free">r</span> <span class="free">step</span> <span class="var">?res</span> <span class="bound">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>stables_def<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> k_lt_n <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"stable <span class="free">r</span> <span class="free">step</span> <span class="var">?res</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> len_res <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>      
      <span class="keyword1"><span class="command">with</span></span> k_dom <span class="keyword1"><span class="command">have</span></span> aux<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span><span class="bound">τ</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">pc</span><span class="main">.</span> <span class="main">(</span><span class="bound">pc</span><span class="main">,</span> <span class="main">(</span><span class="free">k</span> <span class="main">#</span> <span class="skolem">rs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>rev <span class="main">(</span>sorted_list_of_set<span class="main">(</span>succs <span class="free">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">τ</span> <span class="main">⊑⇩</span><span class="free">r</span> <span class="var">?res</span><span class="main">!</span><span class="bound">q</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>stable_def r_def step_def exec_def transf_def<span class="main">)</span>      
      <span class="keyword1"><span class="command">with</span></span> k_j2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">k</span> <span class="main">#</span> <span class="skolem">rs</span><span class="main">)</span> <span class="main">⊑⇩</span><span class="free">r</span> <span class="var">?res</span><span class="main">!</span><span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="var">?res</span><span class="main">!</span><span class="free">j</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span><span class="free">k</span> <span class="main">#</span> <span class="skolem">rs</span><span class="main">)</span> <span class="main">∨</span> <span class="var">?res</span><span class="main">!</span><span class="free">j</span> <span class="main">=</span> <span class="free">k</span><span class="main">#</span><span class="skolem">rs</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>lesssub_def lesub_def nodes_semi_def nodes_le_def r_def f_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="var">?res</span><span class="main">!</span><span class="free">j</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span><span class="free">k</span> <span class="main">#</span> <span class="skolem">rs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>        
      <span class="keyword1"><span class="command">with</span></span> i_dom_j i_neq_k <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="free">i</span> <span class="main">∈</span> set <span class="skolem">rs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> i_notin_rs <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Dom_Kildall_Property-adom_succs"><span class="command">lemma</span></span> adom_succs<span class="main">:</span> <span class="quoted"><span class="quoted">"dom <span class="free">i</span> <span class="free">j</span> <span class="main">⟹</span> <span class="free">i</span> <span class="main">≠</span> <span class="free">j</span> <span class="main">⟹</span> <span class="free">j</span> <span class="main">∈</span> succs <span class="free">k</span> <span class="main">⟹</span> dom <span class="free">i</span> <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> dom_sdom sdom_dom_succs<span class="main">)</span>

<span class="keyword1" id="Dom_Kildall_Property-dom_kildall_is_strict"><span class="command">lemma</span></span> dom_kildall_is_strict<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> length <span class="free">start</span> <span class="main">⟹</span> dom_kildall <span class="free">start</span> <span class="main">!</span> <span class="free">j</span> <span class="main">=</span> <span class="free">res</span> <span class="main">⟹</span> <span class="free">j</span> <span class="main">∉</span> set <span class="free">res</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> j_dom<span class="main">:</span> <span class="quoted"><span class="quoted">"dom_kildall <span class="free">start</span> <span class="main">!</span> <span class="free">j</span> <span class="main">=</span> <span class="free">res</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> j_lt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> length <span class="free">start</span>"</span></span> 
  <span class="keyword1"><span class="command">from</span></span> j_dom <span class="keyword1"><span class="command">have</span></span> iter_fst<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>fst <span class="main">(</span>iter <span class="free">f</span> <span class="free">step</span> <span class="free">start</span> <span class="main">(</span>unstables <span class="free">r</span> <span class="free">step</span> <span class="free">start</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">!</span> <span class="free">j</span> <span class="main">=</span> <span class="free">res</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>dom_kildall_def r_def f_def step_def start_def nodes_semi_def kildall_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ss</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="keyword2"><span class="keyword">where</span></span> iter<span class="main">:</span> <span class="quoted"><span class="quoted">"iter <span class="free">f</span> <span class="free">step</span> <span class="free">start</span> <span class="main">(</span>unstables <span class="free">r</span> <span class="free">step</span> <span class="free">start</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ss</span><span class="main">,</span> <span class="skolem">w</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">with</span></span> iter_fst <span class="keyword1"><span class="command">have</span></span> res<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ss</span><span class="main">!</span><span class="free">j</span> <span class="main">=</span> <span class="free">res</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> dom_iter_properties2 iter <span class="keyword1"><span class="command">have</span></span> res_neq_all<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">res</span> <span class="main">≠</span> rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> len_start_is_n  j_lt len_start_is_n <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">with</span></span> iter iter_dom_properties <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">p</span></span> <span class="main">&lt;</span> <span class="free">n</span><span class="main">.</span> <span class="main">(</span><span class="skolem">ss</span><span class="main">!</span><span class="bound">p</span><span class="main">)</span> <span class="main">≠</span> rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span> <span class="free">n</span><span class="main">]</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="main">(</span> <span class="main">(</span><span class="skolem">ss</span><span class="main">!</span><span class="bound">p</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="bound">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>wf_dom_def<span class="main">)</span>  
  <span class="keyword1"><span class="command">with</span></span> j_lt len_start_is_n res res_neq_all <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="free">res</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>wf_dom_def<span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">∉</span> set <span class="free">res</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Dom_Kildall_Property-sdom_asyc"><span class="command">lemma</span></span> sdom_asyc<span class="main">:</span> <span class="quoted"><span class="quoted">"strict_dom <span class="free">i</span> <span class="free">j</span> <span class="main">⟹</span> <span class="free">j</span> <span class="main">∈</span> set <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">i</span> <span class="main">≠</span> <span class="free">j</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> sdom_i_j<span class="main">:</span> <span class="quoted"><span class="quoted">"strict_dom <span class="free">i</span> <span class="free">j</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">∈</span> set <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> j_lt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> length <span class="free">start</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> start_def n_def nodes_def verts_set <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?start</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">" <span class="main">[]</span> <span class="main">#</span> <span class="main">(</span>replicate <span class="main">(</span>length <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span> <span class="main">(</span>rev<span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span>length<span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> eq_start<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?start</span> <span class="main">=</span> <span class="free">start</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n_def nodes_def start_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>  
  <span class="keyword1"><span class="command">from</span></span> sdom_i_j <span class="keyword1"><span class="command">have</span></span> i_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∈</span> set <span class="main">(</span>dom_kildall <span class="var">?start</span> <span class="main">!</span><span class="free">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>strict_dom_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> j_lt <span class="keyword1"><span class="command">have</span></span> j_nin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">∉</span> set <span class="main">(</span>dom_kildall <span class="var">?start</span> <span class="main">!</span><span class="free">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> eq_start <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dom_kildall_is_strict<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> i_in  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> <span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Dom_Kildall_Property-propa_dom_invariant_complete"><span class="command">lemma</span></span> propa_dom_invariant_complete<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">i</span> <span class="free">a</span> <span class="free">b</span> <span class="free">ss</span> <span class="free">w</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> b_n_nil<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≠</span> <span class="main">[]</span> "</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> propa<span class="main">:</span> <span class="quoted"><span class="quoted">"propa <span class="free">f</span> <span class="main">(</span><span class="free">step</span> <span class="main">(</span>hd <span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="free">a</span> <span class="main">!</span> hd <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="free">a</span> <span class="main">(</span>tl <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">ss</span><span class="main">,</span> <span class="free">w</span><span class="main">)</span> "</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> wf_a_b<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_dom <span class="free">a</span> <span class="free">b</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> non_strict<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">∧</span>  <span class="free">k</span> <span class="main">∉</span> set <span class="main">(</span><span class="free">a</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="main">⟶</span> non_strict_dominate <span class="free">k</span> <span class="bound">i</span> "</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"wf_dom <span class="free">ss</span> <span class="free">w</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">∧</span>  <span class="free">k</span> <span class="main">∉</span> set <span class="main">(</span> <span class="free">ss</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span> <span class="main">⟶</span> non_strict_dominate <span class="free">k</span> <span class="bound">i</span><span class="main">)</span>"</span></span>  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?PROP</span> <span class="var">?P</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>  
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?a_hdb</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">!</span>hd <span class="free">b</span>"</span></span> 
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?qs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">step</span> <span class="main">(</span>hd <span class="free">b</span><span class="main">)</span> <span class="main">(</span><span class="free">a</span><span class="main">!</span>hd <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> wf_a_b b_n_nil propa <span class="keyword1"><span class="command">have</span></span> wf_ss_w<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_dom <span class="free">ss</span> <span class="free">w</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> propa_dom_invariant <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
  <span class="keyword1"><span class="command">from</span></span> wf_a_b <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">τ</span><span class="main">∈</span>set <span class="free">a</span><span class="main">.</span> <span class="bound">τ</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> 
               <span class="keyword2"><span class="keyword">and</span></span> sorted_b<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="free">b</span>"</span></span> 
               <span class="keyword2"><span class="keyword">and</span></span> len_a<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="free">a</span> <span class="main">=</span> <span class="free">n</span>"</span></span> 
               <span class="keyword2"><span class="keyword">and</span></span> b_lt_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="free">b</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">n</span>  "</span></span><span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>wf_dom_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> set_a<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">a</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>listI<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> sorted_b <span class="keyword1"><span class="command">have</span></span> sorted_tl_b<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>tl <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b_n_nil <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">b</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> b_lt_n b_n_nil <span class="keyword1"><span class="command">have</span></span> hd_b_lt_n<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="free">b</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> n_def nodes_def verts_set <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hd <span class="free">b</span> <span class="main">∈</span> set <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b_n_nil  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> fin_succ_hd_b<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>succs <span class="main">(</span>hd <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fin_succs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 

  <span class="keyword1"><span class="command">from</span></span> wf_a_b b_n_nil <span class="keyword1"><span class="command">have</span></span> sorted_hd_b_a<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>rev <span class="main">(</span>hd <span class="free">b</span> <span class="main">#</span> <span class="var">?a_hdb</span><span class="main">)</span><span class="main">)</span>"</span></span>
                       <span class="keyword2"><span class="keyword">and</span></span> step_pres_bounded<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span> <span class="bound">τ</span><span class="main">)</span><span class="main">∈</span>set <span class="main">(</span><span class="free">step</span> <span class="main">(</span>hd <span class="free">b</span><span class="main">)</span> <span class="var">?a_hdb</span><span class="main">)</span><span class="main">.</span> <span class="bound">q</span> <span class="main">&lt;</span> length <span class="free">a</span> <span class="main">∧</span> <span class="bound">τ</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> propa_dom_invariant_auxi <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 

  <span class="keyword1"><span class="command">from</span></span> hd_b_lt_n <span class="keyword1"><span class="command">have</span></span> dist<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map fst <span class="var">?qs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> distinct_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> set_a step_pres_bounded sorted_tl_b len_a <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span> <span class="bound">τ</span><span class="main">)</span> <span class="main">∈</span> set <span class="var">?qs</span><span class="main">.</span> <span class="main">(</span>fst<span class="main">(</span>propa <span class="free">f</span> <span class="var">?qs</span> <span class="free">a</span> <span class="main">(</span>tl <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="bound">q</span> <span class="main">=</span> <span class="bound">τ</span> ⊔<span class="hidden">⇘</span><sub><span class="free">f</span></sub><span class="hidden">⇙</span><span class="free">a</span><span class="main">!</span><span class="bound">q</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>propa_property1<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> propa <span class="keyword1"><span class="command">have</span></span> propa_ss1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span> <span class="bound">τ</span><span class="main">)</span> <span class="main">∈</span> set <span class="var">?qs</span><span class="main">.</span> <span class="free">ss</span><span class="main">!</span><span class="bound">q</span> <span class="main">=</span>  <span class="main">(</span>hd <span class="free">b</span> <span class="main">#</span> <span class="var">?a_hdb</span><span class="main">)</span> ⊔<span class="hidden">⇘</span><sub><span class="free">f</span></sub><span class="hidden">⇙</span><span class="free">a</span><span class="main">!</span><span class="bound">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>step_def exec_def transf_def<span class="main">)</span>
  
  <span class="keyword1"><span class="command">from</span></span> step_pres_bounded sorted_tl_b set_a len_a dist
  <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">q</span><span class="main">.</span> <span class="bound">q</span> <span class="main">∉</span> set<span class="main">(</span>map fst <span class="var">?qs</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">q</span> <span class="main">&lt;</span> length <span class="free">a</span> <span class="main">⟹</span> <span class="main">(</span>fst<span class="main">(</span>propa <span class="free">f</span> <span class="var">?qs</span> <span class="free">a</span> <span class="main">(</span>tl <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="bound">q</span> <span class="main">=</span> <span class="free">a</span><span class="main">!</span><span class="bound">q</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>propa_property2<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> propa <span class="keyword1"><span class="command">have</span></span> exec2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">q</span><span class="main">.</span> <span class="bound">q</span> <span class="main">∉</span> set<span class="main">(</span>map fst <span class="var">?qs</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">q</span> <span class="main">&lt;</span> length <span class="free">a</span> <span class="main">⟹</span> <span class="free">ss</span><span class="main">!</span><span class="bound">q</span> <span class="main">=</span> <span class="free">a</span><span class="main">!</span><span class="bound">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">k</span> <span class="main">∉</span> set <span class="main">(</span> <span class="free">ss</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span> <span class="main">⟶</span> non_strict_dominate <span class="free">k</span> <span class="bound">i</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> strip<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?a_i</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">!</span><span class="skolem">i</span>"</span></span> 
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">k</span> <span class="main">∉</span> set <span class="main">(</span> <span class="free">ss</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> "</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> i_lt_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> k_nin_ss<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">∉</span> set <span class="main">(</span><span class="free">ss</span> <span class="main">!</span> <span class="skolem">i</span><span class="main">)</span> "</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> non_strict <span class="keyword1"><span class="command">have</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">!</span> <span class="skolem">i</span> <span class="main">=</span>  <span class="var">?a_i</span> <span class="main">∧</span> <span class="free">k</span> <span class="main">∉</span> set <span class="var">?a_i</span> <span class="main">⟹</span> non_strict_dominate <span class="free">k</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">have</span></span> sorted_a_i<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>rev <span class="var">?a_i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> wf_a_b i_lt_n <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>_wf_dom_def<span class="main">)</span>

    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"non_strict_dominate <span class="free">k</span> <span class="skolem">i</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="main">(</span>succs <span class="main">(</span>hd <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">note</span></span> i_succ_hdb <span class="main">=</span> this
      <span class="keyword1"><span class="command">with</span></span> propa_ss1 <span class="keyword1"><span class="command">have</span></span> ss_i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ss</span><span class="main">!</span><span class="skolem">i</span> <span class="main">=</span>  <span class="main">(</span>hd <span class="free">b</span> <span class="main">#</span> <span class="var">?a_hdb</span><span class="main">)</span> ⊔<span class="hidden">⇘</span><sub><span class="free">f</span></sub><span class="hidden">⇙</span> <span class="free">a</span><span class="main">!</span><span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fin_succ_hd_b <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>step_def exec_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">ss</span><span class="main">!</span><span class="skolem">i</span> <span class="main">=</span>  <span class="main">(</span>hd <span class="free">b</span> <span class="main">#</span> <span class="var">?a_hdb</span> <span class="main">)</span> ⊔<span class="hidden">⇘</span><sub><span class="free">f</span></sub><span class="hidden">⇙</span> <span class="var">?a_i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> sorted_hd_b_a sorted_a_i <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="free">ss</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> set <span class="main">(</span>hd <span class="free">b</span> <span class="main">#</span> <span class="var">?a_hdb</span><span class="main">)</span> <span class="main">∩</span> set <span class="var">?a_i</span>"</span></span> 
                                     <span class="keyword2"><span class="keyword">and</span></span> ss_i_merge<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ss</span><span class="main">!</span><span class="skolem">i</span> <span class="main">=</span>  <span class="main">(</span><span class="main">(</span>inter_sorted_rev <span class="main">(</span>hd <span class="free">b</span> <span class="main">#</span> <span class="var">?a_hdb</span><span class="main">)</span> <span class="var">?a_i</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>inter_sorted_correct f_def nodes_sup_def plussub_def<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> k_nin_ss <span class="keyword1"><span class="command">have</span></span> k_nin'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">∉</span> set <span class="main">(</span>hd <span class="free">b</span> <span class="main">#</span> <span class="var">?a_hdb</span><span class="main">)</span> <span class="main">∩</span> set <span class="var">?a_i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">∉</span> set <span class="var">?a_i</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> i_lt_n g <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span> 
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">with</span></span> k_nin' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">∉</span> set <span class="var">?a_hdb</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> k_neq_hdb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≠</span> hd <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>   
        <span class="keyword1"><span class="command">with</span></span> hd_b_lt_n non_strict <span class="keyword1"><span class="command">have</span></span> n_k_hdb<span class="main">:</span> <span class="quoted"><span class="quoted">"non_strict_dominate <span class="free">k</span> <span class="main">(</span>hd <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> i_succ_hdb <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>hd <span class="free">b</span><span class="main">,</span> <span class="skolem">i</span><span class="main">)</span><span class="main">∈</span> g_E <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>succs_def<span class="main">)</span>        
        <span class="keyword1"><span class="command">with</span></span> n_k_hdb k_neq_hdb <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> non_sdominate_succ <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>      
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False      
      <span class="keyword1"><span class="command">with</span></span> exec2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">ss</span><span class="main">!</span><span class="skolem">i</span> <span class="main">=</span> <span class="free">a</span><span class="main">!</span><span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fin_succ_hd_b len_a i_lt_n <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>step_def exec_def<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> k_nin_ss <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">∉</span> set <span class="main">(</span><span class="free">a</span><span class="main">!</span><span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> non_strict <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> i_lt_n <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">with</span></span> wf_ss_w <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?PROP</span> <span class="var">?P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Dom_Kildall_Property-start_non_sdom"><span class="command">lemma</span></span> start_non_sdom<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="free">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">start</span><span class="main">!</span><span class="free">i</span> <span class="main">=</span>  <span class="free">res</span> <span class="main">∧</span> <span class="free">k</span> <span class="main">∉</span> set <span class="free">res</span> <span class="main">⟶</span> non_strict_dominate <span class="free">k</span> <span class="free">i</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> i_lt_n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> k_nin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">∉</span> set <span class="main">(</span><span class="free">start</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> reach_i<span class="main">:</span> <span class="quoted"><span class="quoted">"reachable <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> n_def nodes_def verts_set len_verts_gt0 reachable <span class="keyword1"><span class="command">by</span></span>  <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>reachable_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">pa</span></span> <span class="keyword2"><span class="keyword">where</span></span> pa_i<span class="main">:</span> <span class="quoted"><span class="quoted">"path_entry <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span> <span class="skolem">pa</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> reachable_path_entry <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"non_strict_dominate <span class="free">k</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">∈</span> set <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> verts_set <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>n_def nodes_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> k_in_verts<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">∈</span> set <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> k_in_verts'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> verts_set n_def nodes_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"non_strict_dominate <span class="free">k</span> <span class="free">i</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> any_sdominate_0 k_in_verts <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">start</span><span class="main">!</span><span class="free">i</span> <span class="main">=</span> <span class="main">(</span>rev <span class="main">[</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> start_def i_lt_n n_def nodes_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>start_def<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> k_nin k_in_verts' <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">note</span></span> k_nin_verts <span class="main">=</span> this
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">pa</span><span class="main">.</span> path_entry <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span> <span class="bound">pa</span> <span class="free">i</span> <span class="main">⟶</span> set <span class="bound">pa</span> <span class="main">⊆</span> set <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> path_in_verts nodes_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> k_nin_verts <span class="keyword1"><span class="command">have</span></span> k_nin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">pa</span><span class="main">.</span> path_entry <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span> <span class="bound">pa</span> <span class="free">i</span> <span class="main">⟶</span> <span class="free">k</span> <span class="main">∉</span> set <span class="bound">pa</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> contra_subsetD<span class="main">)</span> 
    <span class="keyword1"><span class="command">with</span></span> pa_i <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">∉</span> set <span class="skolem">pa</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> pa_i <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> non_strict_dominate_def<span class="main">)</span> 
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Dom_Kildall_Property-iter_dom_invariant_complete"><span class="command">lemma</span></span> iter_dom_invariant_complete<span class="main">:</span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">res</span><span class="main">.</span>  iter <span class="free">f</span> <span class="free">step</span> <span class="free">start</span> <span class="main">(</span>unstables <span class="free">r</span> <span class="free">step</span> <span class="free">start</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">ss'</span><span class="main">,</span><span class="free">w'</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">ss'</span><span class="main">!</span><span class="free">i</span> <span class="main">=</span>  <span class="bound">res</span> <span class="main">∧</span> <span class="free">k</span> <span class="main">∉</span> set <span class="bound">res</span> <span class="main">⟶</span> non_strict_dominate <span class="free">k</span> <span class="free">i</span>"</span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> iter_def<span class="main">)</span>  
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span>  
      P <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">ss</span><span class="main">,</span> <span class="bound">w</span><span class="main">)</span><span class="main">.</span> wf_dom <span class="bound">ss</span> <span class="bound">w</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">rs</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">∧</span> <span class="bound">ss</span><span class="main">!</span><span class="bound">i</span> <span class="main">=</span>  <span class="bound">rs</span> <span class="main">∧</span> <span class="free">k</span> <span class="main">∉</span> set <span class="bound">rs</span><span class="main">)</span> <span class="main">⟶</span> non_strict_dominate <span class="free">k</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span>
      r <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">ss'</span><span class="main">,</span><span class="bound">ss</span><span class="main">)</span><span class="main">.</span> <span class="bound">ss</span> <span class="main">[⊏⇩</span><span class="free">r</span><span class="main">]</span> <span class="bound">ss'</span><span class="main">}</span> <span class="keyword1">&lt;*lex*&gt;</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>sorted_list_of_set <span class="bound">x</span><span class="main">,</span> sorted_list_of_set <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> finite_psubset"</span></span> 
      <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> while_rule<span class="main">)</span> 
  <span class="comment1">― ‹Invariant holds initially:›</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>start_non_sdom wf_start<span class="main">)</span>

  <span class="comment1">― ‹Invariant is preserved:›</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>propa_dom_invariant_complete<span class="main">)</span>

  <span class="comment1">― ‹Postcondition holds upon termination:›</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>    

  <span class="comment1">― ‹Well-foundedness of the termination relation:›</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>wf_listn_termination_rel<span class="main">)</span>

  <span class="comment1">― ‹Loop decreases along termination relation:›</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>propa_termination<span class="main">)</span>
 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>



</pre>
</div><div id="Dom_Kildall_Correct">
<div class="head">
<h1>Theory Dom_Kildall_Correct</h1>
</div>
<pre class="source"><span class="comment1">(* Author: Nan Jiang *)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Soundness and completeness›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Dom_Kildall_Correct
<span class="keyword2"><span class="keyword">imports</span></span> <a href="#Dom_Kildall_Property">Dom_Kildall_Property</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">context</span></span> dom_sl
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Dom_Kildall_Correct-entry_dominate_dom"><span class="command">lemma</span></span> entry_dominate_dom<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∈</span> set <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"dominate <span class="free">i</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"dom <span class="free">i</span> <span class="main">0</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> entry0_dominates_all <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dominate <span class="main">0</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> reachable <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> reachable_dom_acyclic <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>reachable_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> dom_refl <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Dom_Kildall_Correct-path_entry_dom"><span class="command">lemma</span></span> path_entry_dom<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">pa</span> <span class="free">i</span> <span class="free">d</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"path_entry <span class="main">(</span>g_E <span class="free">G</span><span class="main">)</span> <span class="free">pa</span> <span class="free">i</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"dom <span class="free">d</span> <span class="free">i</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">∈</span> set <span class="free">pa</span> <span class="main">∨</span> <span class="free">d</span> <span class="main">=</span> <span class="free">i</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>path_entry.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> path_entry0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> zero_dom_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>path_entry_prepend <span class="skolem">u</span> <span class="skolem">v</span> <span class="skolem">l</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> u_v <span class="main">=</span> path_entry_prepend.hyps<span class="main">(</span>1<span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> ind <span class="main">=</span> path_entry_prepend.hyps<span class="main">(</span>3<span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> d_v <span class="main">=</span> path_entry_prepend.prems
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">≠</span> <span class="skolem">v</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">note</span></span> d_n_v <span class="main">=</span> this
    <span class="keyword1"><span class="command">from</span></span> u_v <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> succs <span class="skolem">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>succs_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> d_v d_n_v <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dom <span class="free">d</span> <span class="skolem">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>adom_succs<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> ind <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">∈</span> set <span class="skolem">l</span> <span class="main">∨</span> <span class="free">d</span> <span class="main">=</span> <span class="skolem">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">―‹soundenss›</span>

<span class="keyword1" id="Dom_Kildall_Correct-dom_sound"><span class="command">lemma</span></span> dom_sound<span class="main">:</span> <span class="quoted"><span class="quoted">"dom <span class="free">i</span> <span class="free">j</span> <span class="main">⟹</span> dominate <span class="free">i</span> <span class="free">j</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dominate_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>path_entry_dom<span class="main">)</span>

<span class="keyword1" id="Dom_Kildall_Correct-sdom_sound"><span class="command">lemma</span></span> sdom_sound<span class="main">:</span> <span class="quoted"><span class="quoted">"strict_dom <span class="free">i</span> <span class="free">j</span> <span class="main">⟹</span> <span class="free">j</span> <span class="main">∈</span> set <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span> <span class="main">⟹</span> strict_dominate <span class="free">i</span> <span class="free">j</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> sdom<span class="main">:</span> <span class="quoted"><span class="quoted">"strict_dom <span class="free">i</span> <span class="free">j</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">∈</span> set <span class="main">(</span>g_V <span class="free">G</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> i_n_j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> <span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sdom_asyc<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> sdom <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dom <span class="free">i</span> <span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sdom_dom <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> domi<span class="main">:</span> <span class="quoted"><span class="quoted">"dominate <span class="free">i</span> <span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dom_sound<span class="main">)</span>  
  <span class="keyword1"><span class="command">with</span></span> i_n_j <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> dominate_sdominate<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="comment1">―‹completeness›</span>
 
<span class="keyword1" id="Dom_Kildall_Correct-dom_complete_auxi"><span class="command">lemma</span></span> dom_complete_auxi<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="free">start</span> <span class="main">⟹</span> <span class="main">(</span>dom_kildall <span class="free">start</span><span class="main">)</span><span class="main">!</span><span class="free">i</span> <span class="main">=</span> <span class="free">ss'</span> <span class="main">∧</span> <span class="free">k</span> <span class="main">∉</span> set <span class="free">ss'</span> <span class="main">⟹</span> non_strict_dominate <span class="free">k</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> i_lt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="free">start</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> dom_kil<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>dom_kildall <span class="free">start</span><span class="main">)</span><span class="main">!</span><span class="free">i</span> <span class="main">=</span> <span class="free">ss'</span><span class="main">∧</span> <span class="free">k</span> <span class="main">∉</span> set <span class="free">ss'</span>"</span></span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> dom_iter<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>fst <span class="main">(</span>iter <span class="free">f</span> <span class="free">step</span> <span class="free">start</span> <span class="main">(</span>unstables <span class="free">r</span> <span class="free">step</span> <span class="free">start</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="free">i</span> <span class="main">=</span> <span class="free">ss'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> k_nin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">∉</span> set <span class="free">ss'</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> nodes_semi_def r_def f_def step_def dom_kildall_def kildall_def  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="keyword2"><span class="keyword">where</span></span> iter<span class="main">:</span> <span class="quoted"><span class="quoted">" iter <span class="free">f</span> <span class="free">step</span> <span class="free">start</span> <span class="main">(</span>unstables <span class="free">r</span> <span class="free">step</span> <span class="free">start</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">w</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">with</span></span> dom_iter <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">!</span><span class="free">i</span> <span class="main">=</span> <span class="free">ss'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> iter_dom_invariant_complete iter k_nin i_lt len_start_is_n
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Dom_Kildall_Correct-notsdom_notsdominate"><span class="command">lemma</span></span> notsdom_notsdominate<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> strict_dom <span class="free">i</span> <span class="free">j</span> <span class="main">⟹</span> <span class="free">j</span> <span class="main">&lt;</span> length <span class="free">start</span> <span class="main">⟹</span> non_strict_dominate <span class="free">i</span> <span class="free">j</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> i_not_sdom_j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> strict_dom <span class="free">i</span> <span class="free">j</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> j_lt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">j</span> <span class="main">&lt;</span> length <span class="free">start</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">res</span></span> <span class="keyword2"><span class="keyword">where</span></span> j_res<span class="main">:</span> <span class="quoted"><span class="quoted">"dom_kildall <span class="free">start</span> <span class="main">!</span> <span class="free">j</span> <span class="main">=</span> <span class="skolem">res</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>strict_dom_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"strict_dom <span class="free">i</span> <span class="free">j</span> <span class="main">=</span> <span class="main">(</span><span class="free">i</span> <span class="main">∈</span> set <span class="skolem">res</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>strict_dom_def start_def n_def nodes_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> i_not_sdom_j <span class="keyword1"><span class="command">have</span></span> i_nin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∉</span> set <span class="skolem">res</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> j_res j_lt <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"non_strict_dominate <span class="free">i</span> <span class="free">j</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dom_complete_auxi <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Dom_Kildall_Correct-notsdom_notsdominate'"><span class="command">lemma</span></span> notsdom_notsdominate'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> strict_dom <span class="free">i</span> <span class="free">j</span> <span class="main">⟹</span> <span class="free">j</span> <span class="main">&lt;</span> length <span class="free">start</span> <span class="main">⟹</span> <span class="main">¬</span> strict_dominate <span class="free">i</span> <span class="free">j</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> notsdom_notsdominate nonstrict_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Dom_Kildall_Correct-dom_complete"><span class="command">lemma</span></span> dom_complete<span class="main">:</span> <span class="quoted"><span class="quoted">"strict_dominate <span class="free">i</span> <span class="free">j</span> <span class="main">⟹</span> <span class="free">j</span> <span class="main">&lt;</span> size <span class="free">start</span> <span class="main">⟹</span> strict_dom <span class="free">i</span> <span class="free">j</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> notsdom_notsdominate'<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> contrapos_nn nonstrict_eq<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

</pre>
</div>