<div id="DFS">
<div class="head">
<h1>Theory DFS</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      Depth-First Search
    Author:     Toshiaki Nishihara and Yasuhiko Minamide
    Maintainer: Yasuhiko Minamide &lt;minamide at cs.tsukuba.ac.jp&gt;
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Depth-First Search"</span></span>

<span class="keyword1"><span class="command">theory</span></span> DFS
<span class="keyword2"><span class="keyword">imports</span></span> <a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Main.html">Main</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Definition of Graphs"</span></span>

<span class="keyword1"><span class="command">typedecl</span></span> node 
<span class="keyword1"><span class="command">type_synonym</span></span> graph <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>node <span class="main">*</span> node<span class="main">)</span> list"</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">nexts</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>graph<span class="main">,</span> node<span class="main">]</span> <span class="main">⇒</span> node list"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">nexts</span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">nexts</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">es</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> fst <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">then</span> snd <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">#</span> <span class="free">nexts</span> <span class="free"><span class="bound"><span class="entity">es</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">else</span> <span class="free">nexts</span> <span class="free"><span class="bound"><span class="entity">es</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">nextss</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>graph<span class="main">,</span> node list<span class="main">]</span> <span class="main">⇒</span> node set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">nextss</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span> set <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">``</span> set <span class="free"><span class="bound"><span class="entity">xs</span></span></span>"</span></span>

<span class="keyword1" id="DFS-nexts_set"><span class="command">lemma</span></span> nexts_set<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> set <span class="main">(</span>nexts <span class="free">g</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">g</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="DFS-nextss_Cons"><span class="command">lemma</span></span> nextss_Cons<span class="main">:</span> <span class="quoted"><span class="quoted">"nextss <span class="free">g</span> <span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span> <span class="main">=</span> set <span class="main">(</span>nexts <span class="free">g</span> <span class="free">x</span><span class="main">)</span> <span class="main">∪</span> nextss <span class="free">g</span> <span class="free">xs</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> nextss_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Image_def nexts_set<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">reachable</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>graph<span class="main">,</span> node list<span class="main">]</span> <span class="main">⇒</span> node set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">reachable</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span> <span class="main">(</span>set <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">``</span> set <span class="free"><span class="bound"><span class="entity">xs</span></span></span>"</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Depth-First Search with Stack"</span></span> 

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">nodes_of</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"graph <span class="main">⇒</span> node set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">nodes_of</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">=</span> set <span class="main">(</span>map fst <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">@</span> map snd <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> nodes_of <span class="free">g</span> <span class="main">⟹</span> nexts <span class="free">g</span> <span class="free">x</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">g</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nodes_of_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>nodes_of <span class="free">g</span> <span class="main">-</span> set <span class="free">ys</span><span class="main">)</span>"</span></span>  
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>nodes_of <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nodes_of_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">function</span></span>
  <span class="entity">dfs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"graph <span class="main">⇒</span> node list <span class="main">⇒</span> node list <span class="main">⇒</span> node list"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  dfs_base<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">dfs</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span>"</span></span>
<span class="main">|</span> dfs_inductive<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">dfs</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> List.member <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">then</span> <span class="free">dfs</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> 
                        <span class="keyword1">else</span> <span class="free">dfs</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">(</span>nexts <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">@</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">pat_completeness</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">termination</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">relation</span> <span class="quoted"><span class="quoted">"inv_image <span class="main">(</span>finite_psubset <span class="keyword1">&lt;*lex*&gt;</span> less_than<span class="main">)</span>  
                   <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">g</span><span class="main">,</span><span class="bound">xs</span><span class="main">,</span><span class="bound">ys</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>nodes_of <span class="bound">g</span> <span class="main">-</span> set <span class="bound">ys</span><span class="main">,</span> size <span class="bound">xs</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> finite_psubset_def<span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span>  <span class="quoted"><span class="quoted">"<span class="improper">x</span> <span class="main">∈</span> nodes_of <span class="improper">g</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> List.member_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  \begin{itemize}
  \item The second argument of \isatext{\isastyle{dfs}} is a stack of nodes that will be
  visited.
  \item The third argument of \isatext{\isastyle{dfs}} is a list of nodes that have
  been visited already.
  \end{itemize}
›</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Depth-First Search with Nested-Recursion"</span></span>

<span class="keyword1"><span class="command">function</span></span>
  <span class="entity">dfs2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"graph <span class="main">⇒</span> node list <span class="main">⇒</span> node list <span class="main">⇒</span> node list"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">dfs2</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span>"</span></span>
<span class="main">|</span>  dfs2_inductive<span class="main">:</span> 
          <span class="quoted"><span class="quoted">"<span class="free">dfs2</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> List.member <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">then</span> <span class="free">dfs2</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> 
                               <span class="keyword1">else</span> <span class="free">dfs2</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">(</span><span class="free">dfs2</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">(</span>nexts <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">ys</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">pat_completeness</span> <span class="operator">auto</span>

<span class="keyword1" id="DFS-dfs2_invariant"><span class="command">lemma</span></span> dfs2_invariant<span class="main">:</span> <span class="quoted"><span class="quoted">"dfs2_dom <span class="main">(</span><span class="free">g</span><span class="main">,</span> <span class="free">xs</span><span class="main">,</span> <span class="free">ys</span><span class="main">)</span> <span class="main">⟹</span> set <span class="free">ys</span> <span class="main">⊆</span> set <span class="main">(</span>dfs2 <span class="free">g</span> <span class="free">xs</span> <span class="free">ys</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="free">xs</span></span> <span class="quoted"><span class="free">ys</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> dfs2.pinduct<span class="main">)</span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dfs2.psimps<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">termination</span></span> <span class="quoted">dfs2</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">relation</span> <span class="quoted"><span class="quoted">"inv_image <span class="main">(</span>finite_psubset <span class="keyword1">&lt;*lex*&gt;</span> less_than<span class="main">)</span>  
                   <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">g</span><span class="main">,</span><span class="bound">xs</span><span class="main">,</span><span class="bound">ys</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>nodes_of <span class="bound">g</span> <span class="main">-</span> set <span class="bound">ys</span><span class="main">,</span> size <span class="bound">xs</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> finite_psubset_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span>  <span class="quoted"><span class="quoted">"<span class="improper">x</span> <span class="main">∈</span> nodes_of <span class="improper">g</span>"</span></span><span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> List.member_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>2<span class="main"><span class="keyword3">]</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> dfs2_invariant<span class="main">)</span> <span class="operator">force</span>

<span class="comment1">(*lemma dfs2_induct[induct type]:
  assumes B: "⋀g ys. P g [] ys" and
  H: "⋀g x xs ys.
        ⟦¬ x mem ys ⟶ P g xs (dfs2 (g, nexts g x, x # ys));
         ¬ x mem ys ⟶ P g (nexts g x) (x # ys); x mem ys ⟶ P g xs ys⟧
         ⟹ P g (x # xs) ys"
  shows "P u v w"

proof (induct u v w rule: dfs2.induct)
  case 1 show ?case by (rule B)
next
  case (2 g x xs ys)
  show ?case
  proof (rule H)
    show "¬ x mem ys ⟶ P g xs (dfs2 (g, nexts g x, x # ys))"
    proof 
      assume *: "¬ x mem ys"
      have "set (x#ys) ⊆ set (dfs2 (g, nexts g x, x # ys))"
        by (rule dfs2_inv)
      with 2 * show "P g xs (dfs2 (g, nexts g x, x # ys))"
        by auto
    qed
  qed (rule 2)+
qed
*)</span>

<span class="keyword1" id="DFS-dfs_app"><span class="command">lemma</span></span> dfs_app<span class="main">:</span> <span class="quoted"><span class="quoted">"dfs <span class="free">g</span> <span class="main">(</span><span class="free">xs</span><span class="main">@</span><span class="free">ys</span><span class="main">)</span> <span class="free">zs</span> <span class="main">=</span> dfs <span class="free">g</span> <span class="free">ys</span> <span class="main">(</span>dfs <span class="free">g</span> <span class="free">xs</span> <span class="free">zs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="free">xs</span></span> <span class="quoted"><span class="free">zs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> dfs.induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"dfs2 <span class="free">g</span> <span class="free">xs</span> <span class="free">ys</span> <span class="main">=</span> dfs <span class="free">g</span> <span class="free">xs</span> <span class="free">ys</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="free">xs</span></span> <span class="quoted"><span class="free">ys</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> dfs2.induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dfs_app<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Basic Properties"</span></span>

<span class="keyword1" id="DFS-visit_subset_dfs"><span class="command">lemma</span></span> visit_subset_dfs<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">ys</span> <span class="main">⊆</span> set <span class="main">(</span>dfs <span class="free">g</span> <span class="free">xs</span> <span class="free">ys</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="free">xs</span></span> <span class="quoted"><span class="free">ys</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> dfs.induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="DFS-next_subset_dfs"><span class="command">lemma</span></span> next_subset_dfs<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">xs</span> <span class="main">⊆</span> set <span class="main">(</span>dfs <span class="free">g</span> <span class="free">xs</span> <span class="free">ys</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="free">xs</span></span> <span class="quoted"><span class="free">ys</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>dfs.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span><span class="main">(</span>2 <span class="skolem">g</span> <span class="skolem">x</span> <span class="skolem">xs</span> <span class="skolem">ys</span><span class="main">)</span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="skolem">ys</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">ys</span> <span class="main">⊆</span> set <span class="main">(</span>dfs <span class="skolem">g</span> <span class="skolem">xs</span> <span class="skolem">ys</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> visit_subset_dfs<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> 2 <span class="keyword2"><span class="keyword">and</span></span> True <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> List.member_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">ys</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>dfs <span class="skolem">g</span> <span class="main">(</span>nexts <span class="skolem">g</span> <span class="skolem">x</span> <span class="main">@</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">ys</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> visit_subset_dfs<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> 2 <span class="keyword2"><span class="keyword">and</span></span> False <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> List.member_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>


<span class="keyword1" id="DFS-nextss_closed_dfs'"><span class="command">lemma</span></span> nextss_closed_dfs'<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> 
 <span class="quoted"><span class="quoted">"nextss <span class="free">g</span> <span class="free">ys</span> <span class="main">⊆</span> set <span class="free">xs</span> <span class="main">∪</span> set <span class="free">ys</span> <span class="main">⟶</span> nextss <span class="free">g</span> <span class="main">(</span>dfs <span class="free">g</span> <span class="free">xs</span> <span class="free">ys</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>dfs <span class="free">g</span> <span class="free">xs</span> <span class="free">ys</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="free">xs</span></span> <span class="quoted"><span class="free">ys</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>dfs.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>nextss_Cons List.member_def<span class="main">)</span>

<span class="keyword1" id="DFS-nextss_closed_dfs"><span class="command">lemma</span></span> nextss_closed_dfs<span class="main">:</span> <span class="quoted"><span class="quoted">"nextss <span class="free">g</span> <span class="main">(</span>dfs <span class="free">g</span> <span class="free">xs</span> <span class="main">[]</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>dfs <span class="free">g</span> <span class="free">xs</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nextss_closed_dfs'<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nextss_def<span class="main">)</span>

<span class="keyword1" id="DFS-Image_closed_trancl"><span class="command">lemma</span></span> Image_closed_trancl<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">``</span> <span class="free">X</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">``</span> <span class="free">X</span> <span class="main">=</span> <span class="free">X</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">``</span> <span class="free">X</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
      <span class="keyword3"><span class="command">assume</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">X</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">y</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span><span class="main">)</span> <span class="main">(</span><span class="operator">insert</span> assms y<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Image_def<span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> Image_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="DFS-reachable_closed_dfs"><span class="command">lemma</span></span> reachable_closed_dfs<span class="main">:</span> <span class="quoted"><span class="quoted">"reachable <span class="free">g</span> <span class="free">xs</span> <span class="main">⊆</span> set<span class="main">(</span>dfs <span class="free">g</span> <span class="free">xs</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"reachable <span class="free">g</span> <span class="free">xs</span> <span class="main">⊆</span> reachable <span class="free">g</span> <span class="main">(</span>dfs <span class="free">g</span> <span class="free">xs</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> reachable_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Image_mono<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> next_subset_dfs<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> set<span class="main">(</span>dfs <span class="free">g</span> <span class="free">xs</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> reachable_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Image_closed_trancl<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> nextss_closed_dfs
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set <span class="free">g</span> <span class="main">``</span> set <span class="main">(</span>dfs <span class="free">g</span> <span class="free">xs</span> <span class="main">[]</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>dfs <span class="free">g</span> <span class="free">xs</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nextss_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="DFS-reachable_nexts"><span class="command">lemma</span></span> reachable_nexts<span class="main">:</span> <span class="quoted"><span class="quoted">"reachable <span class="free">g</span> <span class="main">(</span>nexts <span class="free">g</span> <span class="free">x</span><span class="main">)</span> <span class="main">⊆</span> reachable <span class="free">g</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> reachable_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> converse_rtrancl_into_rtrancl <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nexts_set<span class="main">)</span>

<span class="keyword1" id="DFS-reachable_append"><span class="command">lemma</span></span> reachable_append<span class="main">:</span> <span class="quoted"><span class="quoted">"reachable <span class="free">g</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> reachable <span class="free">g</span> <span class="free">xs</span> <span class="main">∪</span> reachable <span class="free">g</span> <span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> reachable_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1" id="DFS-dfs_subset_reachable_visit_nodes"><span class="command">lemma</span></span> dfs_subset_reachable_visit_nodes<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>dfs <span class="free">g</span> <span class="free">xs</span> <span class="free">ys</span><span class="main">)</span> <span class="main">⊆</span> reachable <span class="free">g</span> <span class="free">xs</span> <span class="main">∪</span> set <span class="free">ys</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="free">xs</span></span> <span class="quoted"><span class="free">ys</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> dfs.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 1
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">g</span> <span class="skolem">x</span> <span class="skolem">xs</span> <span class="skolem">ys</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="skolem">ys</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">with</span></span> 2 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>dfs <span class="skolem">g</span> <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span> <span class="skolem">ys</span><span class="main">)</span> <span class="main">⊆</span> reachable <span class="skolem">g</span> <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span> <span class="main">∪</span> set <span class="skolem">ys</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reachable_def List.member_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"reachable <span class="skolem">g</span> <span class="main">(</span>nexts <span class="skolem">g</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">⊆</span> reachable <span class="skolem">g</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> reachable_nexts<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"reachable <span class="skolem">g</span> <span class="main">(</span>nexts <span class="skolem">g</span> <span class="skolem">x</span> <span class="main">@</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">⊆</span> reachable <span class="skolem">g</span> <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reachable_append<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reachable_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> False 2
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>dfs <span class="skolem">g</span> <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span> <span class="skolem">ys</span><span class="main">)</span> <span class="main">⊆</span> reachable <span class="skolem">g</span> <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span> <span class="main">∪</span> set <span class="skolem">ys</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reachable_def List.member_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Correctness"</span></span>
    
<span class="keyword1"><span class="command">theorem</span></span> dfs_eq_reachable<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>dfs <span class="free">g</span> <span class="free">xs</span> <span class="main">[]</span><span class="main">)</span> <span class="main">=</span> reachable <span class="free">g</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>dfs <span class="free">g</span> <span class="free">xs</span> <span class="main">[]</span><span class="main">)</span> <span class="main">⊆</span> reachable <span class="free">g</span> <span class="free">xs</span> <span class="main">∪</span> set <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dfs_subset_reachable_visit_nodes<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">g</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">xs</span></span></span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">[]</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>dfs <span class="free">g</span> <span class="free">xs</span> <span class="main">[]</span><span class="main">)</span> <span class="main">⊆</span> reachable <span class="free">g</span> <span class="free">xs</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span><span class="main">(</span><span class="operator">rule</span> reachable_closed_dfs<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> set <span class="main">(</span>dfs <span class="free">g</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">[]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>set <span class="free">g</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span>dfs_eq_reachable reachable_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Executable Code"</span></span>

<span class="keyword1"><span class="command">consts</span></span> Node <span class="main">::</span> <span class="quoted"><span class="quoted">"int <span class="main">⇒</span> node"</span></span>

<span class="keyword1"><span class="command">code_datatype</span></span> <span class="quoted">Node</span>

<span class="keyword1"><span class="command">instantiation</span></span> node <span class="main">::</span> <span class="quoted">equal</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">equal_node</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"node <span class="main">⇒</span> node <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">del</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">equal_node</span> <span class="main">=</span> HOL.eq"</span></span>

<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">proof</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> equal_node_def<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">declare</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword">abort</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">"HOL.equal <span class="main">::</span> node <span class="main">⇒</span> node <span class="main">⇒</span> bool"</span></span><span class="main">]</span><span class="main">]</span>

<span class="keyword1"><span class="command">export_code</span></span> <span class="quoted"><span class="quoted">dfs</span></span> <span class="quoted"><span class="quoted">dfs2</span></span> <span class="keyword2"><span class="keyword">in</span></span> SML <span class="keyword2"><span class="keyword">file</span></span> <span class="quoted">‹dfs.ML›</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>