<div id="MyTactics">
<div class="head">
<h1>Theory MyTactics</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Some tactics›</span></span>

<span class="comment1">(* author: Andrei Popescu *)</span>

<span class="keyword1"><span class="command">theory</span></span> MyTactics <span class="keyword2"><span class="keyword">imports</span></span> <a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Main.html">Main</a> 
<span class="keyword2"><span class="keyword">begin</span></span> 

<span class="comment1">(* ML {* clarsimp_tac *}


ML{* val x = [1] @ [2] *}

ML {* simp_tac *}  *)</span>


<span class="keyword1"><span class="command">ML</span></span><span class="quoted">‹
<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">impI</span> <span class="main">=</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> impI<span class="antiquote">}</span></span></span>  
<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">allI</span> <span class="main">=</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> allI<span class="antiquote">}</span></span></span> 
<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">ballI</span> <span class="main">=</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> ballI<span class="antiquote">}</span></span></span>
<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">conjE</span> <span class="main">=</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> conjE<span class="antiquote">}</span></span></span>
<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">conjI</span> <span class="main">=</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> conjI<span class="antiquote">}</span></span></span>
<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">exE</span> <span class="main">=</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> exE<span class="antiquote">}</span></span></span>
<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">disjE</span> <span class="main">=</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> disjE<span class="antiquote">}</span></span></span>


<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">mclarTacs</span> <span class="entity">ctxt</span> <span class="entity">i</span> <span class="main">=</span>
  <span class="main">[</span>resolve_tac <span class="entity">ctxt</span> <span class="main">[</span><span class="entity">impI</span><span class="main">]</span> <span class="entity">i</span><span class="main">,</span>
   resolve_tac <span class="entity">ctxt</span> <span class="main">[</span><span class="entity">allI</span><span class="main">]</span> <span class="entity">i</span><span class="main">,</span>
   resolve_tac <span class="entity">ctxt</span> <span class="main">[</span><span class="entity">ballI</span><span class="main">]</span> <span class="entity">i</span><span class="main">,</span>
   eresolve_tac <span class="entity">ctxt</span> <span class="main">[</span><span class="entity">conjE</span><span class="main">]</span> <span class="entity">i</span><span class="main">,</span>
   eresolve_tac <span class="entity">ctxt</span> <span class="main">[</span><span class="entity">exE</span><span class="main">]</span> <span class="entity">i</span><span class="main">]</span><span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">mclarify_all_tac</span> <span class="entity">ctxt</span> <span class="main">=</span> REPEAT<span class="main">(</span>SOMEGOAL<span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">i</span> <span class="main">=&gt;</span> FIRST <span class="main">(</span><span class="entity">mclarTacs</span> <span class="entity">ctxt</span> <span class="entity">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">mclarsimp_all_tac</span> <span class="entity">ctxt</span> <span class="main">=</span> TRY <span class="main">(</span><span class="entity">mclarify_all_tac</span> <span class="entity">ctxt</span><span class="main">)</span> THEN TRYALL <span class="main">(</span><span class="entity">asm_full_simp_tac</span> <span class="entity">ctxt</span><span class="main">)</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">mautoTacs</span> <span class="entity">ctxt</span> <span class="entity">i</span> <span class="main">=</span> <span class="entity">mclarTacs</span> <span class="entity">ctxt</span> <span class="entity">i</span> @ <span class="main">[</span>resolve_tac <span class="entity">ctxt</span> <span class="main">[</span><span class="entity">conjI</span><span class="main">]</span> <span class="entity">i</span><span class="main">,</span> eresolve_tac <span class="entity">ctxt</span> <span class="main">[</span><span class="entity">disjE</span><span class="main">]</span> <span class="entity">i</span><span class="main">]</span>
<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">mauto_no_simp_tac</span> <span class="entity">ctxt</span> <span class="main">=</span> REPEAT<span class="main">(</span>SOMEGOAL<span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">i</span> <span class="main">=&gt;</span> FIRST <span class="main">(</span><span class="entity">mautoTacs</span> <span class="entity">ctxt</span> <span class="entity">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">clarify_all_tac</span> <span class="entity">ctxt</span> <span class="main">=</span> TRYALL <span class="main">(</span><span class="entity">clarify_tac</span> <span class="entity">ctxt</span><span class="main">)</span>
›</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Above, "m" stands for "mild" -- mainly, disjunctions are left untouched.›</span></span>




<span class="comment1">(* Note: The variables @{simpset} and @{claset} are *statically bound*, 
hence they refer to the contents of the simp and classical databases at this 
definition time.  For the classical database, this is OK for my purpose, 
since all I care is that it includes HOL_cs.  However, for the simp database 
I shall need to use the current version each time, since the database changes 
continuously with simpliication rules for the newly defined concepts -- thereore 
I shall need to pass that current version as an explicit parameter, which will 
typically be (the current value of) @{simpset}.  *)</span>



<span class="comment1">(*  Tests: 
lemma "(∀ i j k. P ⟶ (Q1 ∨ Q2  ∧ [] @ L = L)) ∧ (∀ a b. G a ∧ G b ⟶ Q) ∧ D"
apply(tactic {* REPEAT(SOMEGOAL(rtac @{thm conjI})) *})
apply(tactic {* mclarify_all_tac *})
oops


lemma "V ∧ (∀ i j k. P ⟶ (Q1 ∨ Q2 ∧ [] @ L = L)) ∧ (∀ a b. G a ∧ G b ⟶ Q) ∧ D"
apply(tactic {* REPEAT(SOMEGOAL(rtac @{thm conjI})) *})
apply(tactic {* mclarsimp_all_tac @{simpset}*})
oops


lemma "V ∧ (∀ i j k. P ⟶ (Q1 ∨ Q2)) ∧ (∀ a b. G a ∧ G b ⟶ Q) ∧ D"
apply(tactic {* REPEAT(SOMEGOAL(rtac @{thm conjI})) *})
apply(tactic {* clarify_all_tac *})
apply(rule disjE)
oops


lemma "V ∧ (∀ i j k. P ⟶ (Q1 ∨ Q2 ∧ x = x)) ∧ (∀ a b. G a ∧ G b ⟶ Q) ∧ D"
apply(tactic {* REPEAT(SOMEGOAL(rtac @{thm conjI})) *})
apply(tactic {* clarsimp_all_tac @{simpset} *})
oops


lemma "(∀ i j k. P ⟶ Q) ∧ (∀ a b. G a ∧ G b ⟶ (Q ∧ R)) ∧ D"
apply(tactic {* REPEAT(SOMEGOAL(rtac @{thm conjI})) *})
apply(tactic {* mauto_no_simp_tac @{context} *})
oops


lemma test: "(∀ i j k. P ⟶ Q) ∧ (∀ a b. G a ∧ G b ⟶ Q)"
apply(tactic {* mauto_no_simp_tac @{context} *})
apply(rule disjE)
oops

*)</span>


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Interface">
<div class="head">
<h1>Theory Interface</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Interface 
<span class="keyword2"><span class="keyword">imports</span></span> <a href="#MyTactics">MyTactics</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Bisim">
<div class="head">
<h1>Theory Bisim</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Bisimilarity, abstractly"</span></span>

<span class="keyword1"><span class="command">theory</span></span> Bisim 
<span class="keyword2"><span class="keyword">imports</span></span> <a href="#Interface">Interface</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> rel <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">*</span> <span class="tfree">'a</span><span class="main">)</span> set"</span></span>  
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'cmd</span><span class="main">,</span><span class="tfree">'state</span><span class="main">)</span>config <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'cmd</span> <span class="main">*</span> <span class="tfree">'state</span>"</span></span> 

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mono</span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">mono</span> <span class="free"><span class="bound"><span class="entity">Retr</span></span></span> <span class="main">≡</span> 
 <span class="main">∀</span> <span class="bound">theta</span> <span class="bound">theta'</span><span class="main">.</span> <span class="bound">theta</span> <span class="main">≤</span> <span class="bound">theta'</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">Retr</span></span></span> <span class="bound">theta</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">Retr</span></span></span> <span class="bound">theta'</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">simul</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">simul</span> <span class="free"><span class="bound"><span class="entity">Retr</span></span></span> <span class="free"><span class="bound"><span class="entity">theta</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">theta</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">Retr</span></span></span> <span class="free"><span class="bound"><span class="entity">theta</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">bisim</span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">bisim</span> <span class="free"><span class="bound"><span class="entity">Retr</span></span></span> <span class="free"><span class="bound"><span class="entity">theta</span></span></span> <span class="main">≡</span> sym <span class="free"><span class="bound"><span class="entity">theta</span></span></span> <span class="main">∧</span> simul <span class="free"><span class="bound"><span class="entity">Retr</span></span></span> <span class="free"><span class="bound"><span class="entity">theta</span></span></span>"</span></span>

<span class="keyword1" id="Bisim-mono_Union"><span class="command">lemma</span></span> mono_Union<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mono <span class="free">Retr</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Union <span class="main">(</span><span class="free">Retr</span> <span class="main">`</span> <span class="free">Theta</span><span class="main">)</span> <span class="main">≤</span> <span class="free">Retr</span> <span class="main">(</span>Union <span class="free">Theta</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">theta'</span> <span class="main">∈</span> <span class="free">Retr</span> <span class="main">`</span> <span class="free">Theta</span><span class="main">.</span> <span class="bound">theta'</span> <span class="main">⊆</span> <span class="free">Retr</span> <span class="main">(</span>Union <span class="free">Theta</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> mono_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Bisim-mono_Un"><span class="command">lemma</span></span> mono_Un<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mono <span class="free">Retr</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">Retr</span> <span class="free">theta</span> <span class="keyword1">Un</span> <span class="free">Retr</span> <span class="free">theta'</span> <span class="main">⊆</span> <span class="free">Retr</span> <span class="main">(</span><span class="free">theta</span> <span class="keyword1">Un</span> <span class="free">theta'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> mono_def
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Un_least Un_upper1 Un_upper2<span class="main">)</span>

<span class="keyword1" id="Bisim-sym_Union"><span class="command">lemma</span></span> sym_Union<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">theta</span><span class="main">.</span> <span class="bound">theta</span> <span class="main">∈</span> <span class="free">Theta</span> <span class="main">⟹</span> sym <span class="bound">theta</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sym <span class="main">(</span>Union <span class="free">Theta</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> sym_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Bisim-sym_Un"><span class="command">lemma</span></span> sym_Un<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sym <span class="free">theta1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"sym <span class="free">theta2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sym <span class="main">(</span><span class="free">theta1</span> <span class="keyword1">Un</span> <span class="free">theta2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms sym_Union<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">theta1</span><span class="main">,</span><span class="free">theta2</span><span class="main">}</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Bisim-simul_Union"><span class="command">lemma</span></span> simul_Union<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mono <span class="free">Retr</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">theta</span><span class="main">.</span> <span class="bound">theta</span> <span class="main">∈</span> <span class="free">Theta</span> <span class="main">⟹</span> simul <span class="free">Retr</span> <span class="bound">theta</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"simul <span class="free">Retr</span> <span class="main">(</span>Union <span class="free">Theta</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">theta</span> <span class="main">∈</span> <span class="free">Theta</span><span class="main">.</span> <span class="bound">theta</span> <span class="main">⊆</span> <span class="free">Retr</span> <span class="bound">theta</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> simul_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Union <span class="free">Theta</span> <span class="main">⊆</span> Union <span class="main">(</span><span class="free">Retr</span> <span class="main">`</span> <span class="free">Theta</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⊆</span> <span class="free">Retr</span> <span class="main">(</span>Union <span class="free">Theta</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mono_Union assms <span class="keyword1"><span class="command">unfolding</span></span> mono_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Union <span class="free">Theta</span> <span class="main">⊆</span> <span class="free">Retr</span> <span class="main">(</span>Union <span class="free">Theta</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> simul_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Bisim-simul_Un"><span class="command">lemma</span></span> simul_Un<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mono <span class="free">Retr</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"simul <span class="free">Retr</span> <span class="free">theta1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"simul <span class="free">Retr</span> <span class="free">theta2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"simul <span class="free">Retr</span> <span class="main">(</span><span class="free">theta1</span> <span class="keyword1">Un</span> <span class="free">theta2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms simul_Union<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">Retr</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">theta1</span><span class="main">,</span><span class="free">theta2</span><span class="main">}</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Bisim-bisim_Union"><span class="command">lemma</span></span> bisim_Union<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mono <span class="free">Retr</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">theta</span><span class="main">.</span> <span class="bound">theta</span> <span class="main">∈</span> <span class="free">Theta</span> <span class="main">⟹</span> bisim <span class="free">Retr</span> <span class="bound">theta</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"bisim <span class="free">Retr</span> <span class="main">(</span>Union <span class="free">Theta</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> bisim_def
<span class="keyword1"><span class="command">using</span></span> sym_Union simul_Union <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Bisim-bisim_Un"><span class="command">lemma</span></span> bisim_Un<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mono <span class="free">Retr</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"bisim <span class="free">Retr</span> <span class="free">theta1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"bisim <span class="free">Retr</span> <span class="free">theta2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"bisim <span class="free">Retr</span> <span class="main">(</span><span class="free">theta1</span> <span class="keyword1">Un</span> <span class="free">theta2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms bisim_Union<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">Retr</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">theta1</span><span class="main">,</span><span class="free">theta2</span><span class="main">}</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">bis</span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">bis</span> <span class="free"><span class="bound"><span class="entity">Retr</span></span></span> <span class="main">≡</span> Union <span class="main">{</span><span class="bound">theta</span><span class="main">.</span> bisim <span class="free"><span class="bound"><span class="entity">Retr</span></span></span> <span class="bound">theta</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Bisim-bisim_bis"><span class="command">lemma</span></span> bisim_bis<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mono <span class="free">Retr</span>"</span></span> 
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"bisim <span class="free">Retr</span> <span class="main">(</span>bis <span class="free">Retr</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> mono_def
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> CollectD assms bis_def bisim_Union<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> sym_bis<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"mono <span class="free">Retr</span> <span class="main">⟹</span> sym <span class="main">(</span>bis <span class="free">Retr</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> simul_bis<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"mono <span class="free">Retr</span> <span class="main">⟹</span> simul <span class="free">Retr</span> <span class="main">(</span>bis <span class="free">Retr</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> bisim_bis <span class="keyword1"><span class="command">unfolding</span></span> bisim_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Bisim-bis_raw_coind"><span class="command">lemma</span></span> bis_raw_coind<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mono <span class="free">Retr</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"sym <span class="free">theta</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">theta</span> <span class="main">⊆</span> <span class="free">Retr</span> <span class="free">theta</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">theta</span> <span class="main">⊆</span> bis <span class="free">Retr</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> mono_def bis_def bisim_def simul_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Bisim-bis_prefix"><span class="command">lemma</span></span> bis_prefix<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mono <span class="free">Retr</span>"</span></span>   
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"bis <span class="free">Retr</span> <span class="main">⊆</span> <span class="free">Retr</span> <span class="main">(</span>bis <span class="free">Retr</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms bisim_bis bisim_def simul_def<span class="main">)</span>

<span class="keyword1" id="Bisim-bis_coind"><span class="command">lemma</span></span> bis_coind<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"mono <span class="free">Retr</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"sym <span class="free">theta</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">theta</span> <span class="main">⊆</span> <span class="free">Retr</span> <span class="main">(</span><span class="free">theta</span> <span class="keyword1">Un</span> <span class="main">(</span>bis <span class="free">Retr</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">theta</span> <span class="main">⊆</span> bis <span class="free">Retr</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?theta'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">theta</span> <span class="keyword1">Un</span> <span class="main">(</span>bis <span class="free">Retr</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sym <span class="var">?theta'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Bisim.sym_Un sym_bis assms<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?theta'</span> <span class="main">⊆</span> <span class="free">Retr</span> <span class="var">?theta'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms mono_Un Un_least bis_prefix le_supI2 subset_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> * bis_raw_coind <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>  

<span class="keyword1" id="Bisim-bis_coind2"><span class="command">lemma</span></span> bis_coind2<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"mono <span class="free">Retr</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
**<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">theta</span> <span class="main">⊆</span> <span class="free">Retr</span> <span class="main">(</span><span class="free">theta</span> <span class="keyword1">Un</span> <span class="main">(</span>bis <span class="free">Retr</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
***<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">theta</span> <span class="main">^-1</span> <span class="main">⊆</span> <span class="free">Retr</span> <span class="main">(</span><span class="main">(</span><span class="free">theta</span> <span class="main">^-1</span><span class="main">)</span> <span class="keyword1">Un</span> <span class="main">(</span>bis <span class="free">Retr</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">theta</span> <span class="main">⊆</span> bis <span class="free">Retr</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?th</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">theta</span> <span class="keyword1">Un</span> <span class="free">theta</span> <span class="main">^-1</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sym <span class="var">?th</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sym_Un_converse<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span><span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?th</span> <span class="main">⊆</span> <span class="free">Retr</span> <span class="main">(</span><span class="free">theta</span> <span class="keyword1">Un</span> <span class="main">(</span>bis <span class="free">Retr</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">Un</span> <span class="free">Retr</span> <span class="main">(</span><span class="free">theta</span> <span class="main">^-1</span> <span class="keyword1">Un</span> <span class="main">(</span>bis <span class="free">Retr</span><span class="main">)</span><span class="main">)</span>"</span></span> 
   <span class="keyword1"><span class="command">using</span></span> ** *** Un_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
   <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⊆</span> <span class="free">Retr</span> <span class="main">(</span><span class="main">(</span><span class="free">theta</span> <span class="keyword1">Un</span> <span class="main">(</span>bis <span class="free">Retr</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">Un</span> <span class="main">(</span><span class="free">theta</span> <span class="main">^-1</span> <span class="keyword1">Un</span> <span class="main">(</span>bis <span class="free">Retr</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
   <span class="keyword1"><span class="command">using</span></span> * mono_Un <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
   <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">Retr</span> <span class="main">(</span><span class="var">?th</span> <span class="keyword1">Un</span> <span class="main">(</span>bis <span class="free">Retr</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Un_assoc Un_commute Un_left_absorb<span class="main">)</span>
   <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?th</span> <span class="main">⊆</span> <span class="free">Retr</span> <span class="main">(</span><span class="var">?th</span> <span class="keyword1">Un</span> <span class="main">(</span>bis <span class="free">Retr</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?th</span> <span class="main">⊆</span> bis <span class="free">Retr</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms bis_coind <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Bisim-bis_raw_coind2"><span class="command">lemma</span></span> bis_raw_coind2<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"mono <span class="free">Retr</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
**<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">theta</span> <span class="main">⊆</span> <span class="free">Retr</span> <span class="free">theta</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
***<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">theta</span> <span class="main">^-1</span> <span class="main">⊆</span> <span class="free">Retr</span> <span class="main">(</span><span class="free">theta</span> <span class="main">^-1</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">theta</span> <span class="main">⊆</span> bis <span class="free">Retr</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">theta</span> <span class="main">⊆</span> <span class="free">Retr</span> <span class="main">(</span><span class="free">theta</span> <span class="keyword1">Un</span> <span class="main">(</span>bis <span class="free">Retr</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">theta</span> <span class="main">^-1</span> <span class="main">⊆</span> <span class="free">Retr</span> <span class="main">(</span><span class="main">(</span><span class="free">theta</span> <span class="main">^-1</span><span class="main">)</span> <span class="keyword1">Un</span> <span class="main">(</span>bis <span class="free">Retr</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">metis</span> mono_Un le_supI1 subset_trans<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> * bis_coind2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Bisim-mono_bis"><span class="command">lemma</span></span> mono_bis<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mono <span class="free">Retr1</span>"</span></span>  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"mono <span class="free">Retr2</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">theta</span><span class="main">.</span> <span class="free">Retr1</span> <span class="bound">theta</span> <span class="main">⊆</span> <span class="free">Retr2</span> <span class="bound">theta</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"bis <span class="free">Retr1</span> <span class="main">⊆</span> bis <span class="free">Retr2</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms bis_prefix bis_raw_coind subset_trans sym_bis<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Language_Semantics">
<div class="head">
<h1>Theory Language_Semantics</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹The programming language and its semantics›</span></span> 

<span class="keyword1"><span class="command">theory</span></span> Language_Semantics <span class="keyword2"><span class="keyword">imports</span></span> <a href="#Interface">Interface</a> <span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Syntax and operational semantics›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> <span class="main">(</span><span class="tfree">'test</span><span class="main">,</span><span class="tfree">'atom</span><span class="main">)</span> com <span class="main">=</span> 
  Atm <span class="tfree"><span class="quoted"><span class="tfree">'atom</span></span></span> <span class="main">|</span> 
  Seq <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'test</span><span class="main">,</span><span class="tfree">'atom</span><span class="main">)</span> com"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'test</span><span class="main">,</span><span class="tfree">'atom</span><span class="main">)</span> com"</span></span> 
    <span class="main">(</span><span class="quoted">"_ <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">;;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _"</span>  <span class="main">[</span>60<span class="main">,</span> 61<span class="main">]</span> 60<span class="main">)</span> <span class="main">|</span>
  If <span class="tfree"><span class="quoted"><span class="tfree">'test</span></span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'test</span><span class="main">,</span><span class="tfree">'atom</span><span class="main">)</span> com"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'test</span><span class="main">,</span><span class="tfree">'atom</span><span class="main">)</span> com"</span></span> 
    <span class="main">(</span><span class="quoted">"<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">(</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">if</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">/ </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">then</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">/ </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">else</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">)</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span>  <span class="main">[</span>0<span class="main">,</span> 0<span class="main">,</span> 61<span class="main">]</span> 61<span class="main">)</span> <span class="main">|</span>
  While <span class="tfree"><span class="quoted"><span class="tfree">'test</span></span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'test</span><span class="main">,</span><span class="tfree">'atom</span><span class="main">)</span> com"</span></span> 
    <span class="main">(</span><span class="quoted">"<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">(</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">while</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">/ </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">do</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">)</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span>  <span class="main">[</span>0<span class="main">,</span> 61<span class="main">]</span> 61<span class="main">)</span> <span class="main">|</span>
  Par <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'test</span><span class="main">,</span><span class="tfree">'atom</span><span class="main">)</span> com"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'test</span><span class="main">,</span><span class="tfree">'atom</span><span class="main">)</span> com"</span></span> 
    <span class="main">(</span><span class="quoted">"_ <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">|</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _"</span>  <span class="main">[</span>60<span class="main">,</span> 61<span class="main">]</span> 60<span class="main">)</span>
  
<span class="keyword1"><span class="command">locale</span></span> PL <span class="main">=</span> 
<span class="keyword2"><span class="keyword">fixes</span></span> 
  <span class="free">tval</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'test</span> <span class="main">⇒</span> <span class="tfree">'state</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
  <span class="free">aval</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'atom</span> <span class="main">⇒</span> <span class="tfree">'state</span> <span class="main">⇒</span> <span class="tfree">'state</span>"</span></span>

<span class="comment1">(* *****************************************)</span>
<span class="keyword1"><span class="command">context</span></span> PL
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Conventions and notations:
-- suffixes: ``C" for ``Continuation", ``T" for ``termination"
-- prefix: ``M" for multistep
-- tst, tst' are tests
-- atm, atm' are atoms (atomic commands)
-- s, s', t, t' are states
-- c, c', d, d' are commands
-- cf, cf' are configurations, i.e., pairs command-state›</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">transT</span> <span class="main">::</span> 
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'test</span><span class="main">,</span><span class="tfree">'atom</span><span class="main">)</span>com <span class="main">*</span> <span class="tfree">'state</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'state</span> <span class="main">⇒</span> bool"</span></span>
<span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">→t</span>"</span> 55<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  Atm<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
<span class="quoted"><span class="quoted">"<span class="main">(</span>Atm <span class="free"><span class="bound"><span class="entity">atm</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="keyword1"><span class="free">→t</span></span> <span class="free">aval</span> <span class="free"><span class="bound"><span class="entity">atm</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span>
<span class="main">|</span> WhileFalse<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>  
<span class="quoted"><span class="quoted">"<span class="main">~</span> <span class="free">tval</span> <span class="free"><span class="bound"><span class="entity">tst</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">⟹</span> <span class="main">(</span>While <span class="free"><span class="bound"><span class="entity">tst</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="keyword1"><span class="free">→t</span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> trans_Atm <span class="main">=</span> Atm  
<span class="keyword1"><span class="command">lemmas</span></span> trans_WhileFalse <span class="main">=</span> WhileFalse

<span class="comment1">(* The RT-closure of →c is inlined since later versions of →c may refer to it. *)</span>
<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">transC</span> <span class="main">::</span> 
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'test</span><span class="main">,</span><span class="tfree">'atom</span><span class="main">)</span>com <span class="main">*</span> <span class="tfree">'state</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'test</span><span class="main">,</span><span class="tfree">'atom</span><span class="main">)</span>com <span class="main">*</span> <span class="tfree">'state</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
<span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">→c</span>"</span> 55<span class="main">)</span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="entity">MtransC</span> <span class="main">::</span> 
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'test</span><span class="main">,</span><span class="tfree">'atom</span><span class="main">)</span>com <span class="main">*</span> <span class="tfree">'state</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'test</span><span class="main">,</span><span class="tfree">'atom</span><span class="main">)</span>com <span class="main">*</span> <span class="tfree">'state</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
<span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">→*c</span>"</span> 55<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  SeqC<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="keyword1"><span class="free">→c</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c1'</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s'</span></span></span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="keyword1"><span class="free">→c</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c1'</span></span></span> <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s'</span></span></span><span class="main">)</span>"</span></span> 
<span class="main">|</span> SeqT<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="keyword1">→t</span> <span class="free"><span class="bound"><span class="entity">s'</span></span></span> <span class="main">⟹</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="keyword1"><span class="free">→c</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s'</span></span></span><span class="main">)</span>"</span></span> 
<span class="main">|</span> IfTrue<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>  
<span class="quoted"><span class="quoted">"<span class="free">tval</span> <span class="free"><span class="bound"><span class="entity">tst</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">⟹</span> <span class="main">(</span>If <span class="free"><span class="bound"><span class="entity">tst</span></span></span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="keyword1"><span class="free">→c</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> IfFalse<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>  
<span class="quoted"><span class="quoted">"<span class="main">~</span> <span class="free">tval</span> <span class="free"><span class="bound"><span class="entity">tst</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">⟹</span> <span class="main">(</span>If <span class="free"><span class="bound"><span class="entity">tst</span></span></span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="keyword1"><span class="free">→c</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> WhileTrue<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>  
<span class="quoted"><span class="quoted">"<span class="free">tval</span> <span class="free"><span class="bound"><span class="entity">tst</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">⟹</span> <span class="main">(</span>While <span class="free"><span class="bound"><span class="entity">tst</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="keyword1"><span class="free">→c</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">;;</span> <span class="main">(</span>While <span class="free"><span class="bound"><span class="entity">tst</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span>
<span class="comment1">(*  *)</span>
<span class="main">|</span> ParCL<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="keyword1"><span class="free">→c</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c1'</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s'</span></span></span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span>Par <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="keyword1"><span class="free">→c</span></span> <span class="main">(</span>Par <span class="free"><span class="bound"><span class="entity">c1'</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s'</span></span></span><span class="main">)</span>"</span></span> 
<span class="main">|</span> ParCR<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="keyword1"><span class="free">→c</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c2'</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s'</span></span></span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span>Par <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="keyword1"><span class="free">→c</span></span> <span class="main">(</span>Par <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2'</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s'</span></span></span><span class="main">)</span>"</span></span> 
<span class="main">|</span> ParTL<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="keyword1">→t</span> <span class="free"><span class="bound"><span class="entity">s'</span></span></span> <span class="main">⟹</span> <span class="main">(</span>Par <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="keyword1"><span class="free">→c</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s'</span></span></span><span class="main">)</span>"</span></span> 
<span class="main">|</span> ParTR<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="keyword1">→t</span> <span class="free"><span class="bound"><span class="entity">s'</span></span></span> <span class="main">⟹</span> <span class="main">(</span>Par <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="keyword1"><span class="free">→c</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s'</span></span></span><span class="main">)</span>"</span></span> 
<span class="main">|</span> Refl<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="keyword1"><span class="free">→*c</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> Step<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="keyword1"><span class="free">→*c</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c'</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s'</span></span></span><span class="main">)</span><span class="main">;</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c'</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s'</span></span></span><span class="main">)</span> <span class="keyword1"><span class="free">→c</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c''</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s''</span></span></span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="keyword1"><span class="free">→*c</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c''</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s''</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> trans_SeqC <span class="main">=</span> SeqC <span class="keyword1"><span class="command">lemmas</span></span> trans_SeqT <span class="main">=</span> SeqT 
<span class="keyword1"><span class="command">lemmas</span></span> trans_IfTrue <span class="main">=</span> IfTrue <span class="keyword1"><span class="command">lemmas</span></span> trans_IfFalse <span class="main">=</span> IfFalse
<span class="keyword1"><span class="command">lemmas</span></span> trans_WhileTrue <span class="main">=</span> WhileTrue 
<span class="keyword1"><span class="command">lemmas</span></span> trans_ParCL <span class="main">=</span> ParCL  <span class="keyword1"><span class="command">lemmas</span></span> trans_ParCR <span class="main">=</span> ParCR
<span class="keyword1"><span class="command">lemmas</span></span> trans_ParTL <span class="main">=</span> ParTL  <span class="keyword1"><span class="command">lemmas</span></span> trans_ParTR <span class="main">=</span> ParTR
<span class="keyword1"><span class="command">lemmas</span></span> trans_Refl <span class="main">=</span> Refl  <span class="keyword1"><span class="command">lemmas</span></span> trans_Step <span class="main">=</span> Step

<span class="keyword1" id="Language_Semantics-MtransC_Refl"><span class="command">lemma</span></span> MtransC_Refl<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">cf</span> <span class="keyword1">→*c</span> <span class="free">cf</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> trans_Refl <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">cf</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> transC_induct <span class="main">=</span> transC_MtransC.inducts<span class="main">(</span>1<span class="main">)</span>
  <span class="main">[</span><span class="operator">split_format</span><span class="main"><span class="main">(</span></span><span class="quasi_keyword">complete</span><span class="main"><span class="main">)</span></span><span class="main">,</span> 
   <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?P2.0</span> <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">c</span> <span class="bound">s</span> <span class="bound">c'</span> <span class="bound">s'</span><span class="main">.</span> True"</span></span><span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> MtransC_induct_temp <span class="main">=</span> transC_MtransC.inducts<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">split_format</span><span class="main"><span class="main">(</span></span><span class="quasi_keyword">complete</span><span class="main"><span class="main">)</span></span><span class="main">]</span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">MtransT</span> <span class="main">::</span> 
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'test</span><span class="main">,</span><span class="tfree">'atom</span><span class="main">)</span>com <span class="main">*</span> <span class="tfree">'state</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'state</span> <span class="main">⇒</span> bool"</span></span>
<span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">→*t</span>"</span> 55<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
  StepT<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">cf</span></span></span> <span class="keyword1">→*c</span> <span class="free"><span class="bound"><span class="entity">cf'</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">cf'</span></span></span> <span class="keyword1">→t</span> <span class="free"><span class="bound"><span class="entity">s''</span></span></span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">cf</span></span></span> <span class="keyword1"><span class="free">→*t</span></span> <span class="free"><span class="bound"><span class="entity">s''</span></span></span>"</span></span>

<span class="keyword1" id="Language_Semantics-MtransC_rtranclp_transC"><span class="command">lemma</span></span> MtransC_rtranclp_transC<span class="main">:</span>
<span class="quoted"><span class="quoted">"MtransC <span class="main">=</span> transC <span class="main">^**</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span> <span class="skolem">s</span> <span class="skolem">c'</span> <span class="skolem">s'</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c</span><span class="main">,</span><span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span><span class="skolem">s'</span><span class="main">)</span> <span class="main">⟹</span> transC <span class="main">^**</span> <span class="main">(</span><span class="skolem">c</span><span class="main">,</span><span class="skolem">s</span><span class="main">)</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span><span class="skolem">s'</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> MtransC_induct_temp<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">c</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">s</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">c'</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">s'</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">c</span></span> <span class="bound"><span class="bound">s</span></span> <span class="bound"><span class="bound">c'</span></span> <span class="bound"><span class="bound">s'</span></span><span class="main"><span class="main">.</span></span> True"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> 
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span> <span class="skolem">s</span> <span class="skolem">c'</span> <span class="skolem">s'</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"transC <span class="main">^**</span> <span class="main">(</span><span class="skolem">c</span><span class="main">,</span><span class="skolem">s</span><span class="main">)</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span><span class="skolem">s'</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="skolem">c</span><span class="main">,</span><span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span><span class="skolem">s'</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> rtranclp.induct<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> trans_Step <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ext<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Language_Semantics-transC_MtransC"><span class="command">lemma</span></span> transC_MtransC<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">cf</span> <span class="keyword1">→c</span> <span class="free">cf'</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">cf</span> <span class="keyword1">→*c</span> <span class="free">cf'</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> MtransC_rtranclp_transC <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Language_Semantics-MtransC_Trans"><span class="command">lemma</span></span> MtransC_Trans<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">cf</span> <span class="keyword1">→*c</span> <span class="free">cf'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">cf'</span> <span class="keyword1">→*c</span> <span class="free">cf''</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">cf</span> <span class="keyword1">→*c</span> <span class="free">cf''</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms rtranclp_trans<span class="main">[</span><span class="operator">of</span> <span class="quoted">transC</span> <span class="quoted"><span class="free">cf</span></span> <span class="quoted"><span class="free">cf'</span></span> <span class="quoted"><span class="free">cf''</span></span><span class="main">]</span> 
<span class="keyword1"><span class="command">unfolding</span></span> MtransC_rtranclp_transC <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Language_Semantics-MtransC_StepC"><span class="command">lemma</span></span> MtransC_StepC<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">cf</span> <span class="keyword1">→*c</span> <span class="free">cf'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">cf'</span> <span class="keyword1">→c</span> <span class="free">cf''</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">cf</span> <span class="keyword1">→*c</span> <span class="free">cf''</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">cf'</span> <span class="keyword1">→*c</span> <span class="free">cf''</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ** <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> * MtransC_Trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Language_Semantics-MtransC_induct"><span class="command">lemma</span></span> MtransC_induct<span class="main">[</span><span class="operator">consumes</span> 1<span class="main">,</span> <span class="operator">case_names</span> Refl Trans<span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">cf</span> <span class="keyword1">→*c</span> <span class="free">cf'</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">cf</span><span class="main">.</span> <span class="free">phi</span> <span class="bound">cf</span> <span class="bound">cf</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> 
<span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">cf</span> <span class="bound">cf'</span> <span class="bound">cf''</span><span class="main">.</span> 
   <span class="main">⟦</span><span class="bound">cf</span> <span class="keyword1">→*c</span> <span class="bound">cf'</span><span class="main">;</span> <span class="free">phi</span> <span class="bound">cf</span> <span class="bound">cf'</span><span class="main">;</span> <span class="bound">cf'</span> <span class="keyword1">→c</span> <span class="bound">cf''</span><span class="main">⟧</span>
   <span class="main">⟹</span> <span class="free">phi</span> <span class="bound">cf</span> <span class="bound">cf''</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">phi</span> <span class="free">cf</span> <span class="free">cf'</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> MtransC_rtranclp_transC 
<span class="keyword1"><span class="command">using</span></span> rtranclp.induct<span class="main">[</span><span class="operator">of</span> <span class="quoted">transC</span> <span class="quoted"><span class="free">cf</span></span> <span class="quoted"><span class="free">cf'</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Language_Semantics-MtransC_induct2"><span class="command">lemma</span></span> MtransC_induct2<span class="main">[</span><span class="operator">consumes</span> 1<span class="main">,</span> <span class="operator">case_names</span> Refl Trans<span class="main">,</span> <span class="operator">induct</span> <span class="quasi_keyword"><span class="quasi_keyword">pred</span></span><span class="main"><span class="main"><span class="main">:</span></span></span> MtransC<span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="free">c'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">c</span> <span class="bound">s</span><span class="main">.</span> <span class="free">phi</span> <span class="bound">c</span> <span class="bound">s</span> <span class="bound">c</span> <span class="bound">s</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> 
<span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">c</span> <span class="bound">s</span> <span class="bound">c'</span> <span class="bound">s'</span> <span class="bound">c''</span> <span class="bound">s''</span><span class="main">.</span> 
   <span class="main">⟦</span><span class="main">(</span><span class="bound">c</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span><span class="bound">s'</span><span class="main">)</span><span class="main">;</span> <span class="free">phi</span> <span class="bound">c</span> <span class="bound">s</span> <span class="bound">c'</span> <span class="bound">s'</span><span class="main">;</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span><span class="bound">s'</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">c''</span><span class="main">,</span><span class="bound">s''</span><span class="main">)</span><span class="main">⟧</span>
   <span class="main">⟹</span> <span class="free">phi</span> <span class="bound">c</span> <span class="bound">s</span> <span class="bound">c''</span> <span class="bound">s''</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">phi</span> <span class="free">c</span> <span class="free">s</span> <span class="free">c'</span> <span class="free">s'</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms 
MtransC_induct<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main">(</span><span class="bound">c</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span><span class="bound">s'</span><span class="main">)</span><span class="main">.</span> <span class="free">phi</span> <span class="bound">c</span> <span class="bound">s</span> <span class="bound">c'</span> <span class="bound">s'</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Language_Semantics-transT_MtransT"><span class="command">lemma</span></span> transT_MtransT<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">cf</span> <span class="keyword1">→t</span> <span class="free">s'</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">cf</span> <span class="keyword1">→*t</span> <span class="free">s'</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> PL.MtransC_Refl PL.MtransT.intros assms<span class="main">)</span>

<span class="keyword1" id="Language_Semantics-MtransC_MtransT"><span class="command">lemma</span></span> MtransC_MtransT<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">cf</span> <span class="keyword1">→*c</span> <span class="free">cf'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">cf'</span> <span class="keyword1">→*t</span> <span class="free">cf''</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">cf</span> <span class="keyword1">→*t</span> <span class="free">cf''</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> MtransT.cases PL.MtransC_Trans PL.MtransT.intros assms<span class="main">)</span>

<span class="keyword1" id="Language_Semantics-transC_MtransT"><span class="command">lemma</span></span> transC_MtransT<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">cf</span> <span class="keyword1">→c</span> <span class="free">cf'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">cf'</span> <span class="keyword1">→*t</span> <span class="free">s''</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">cf</span> <span class="keyword1">→*t</span> <span class="free">s''</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> PL.MtransC_MtransT assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> transC_MtransC<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Inversion rules, nchotomies and such:›</span></span>

<span class="keyword1" id="Language_Semantics-Atm_transC_simp"><span class="command">lemma</span></span> Atm_transC_simp<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">~</span> <span class="main">(</span>Atm <span class="free">atm</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="free">cf</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> transC.cases<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Language_Semantics-Atm_transC_invert"><span class="command">lemma</span></span> Atm_transC_invert<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main">!</span></span></span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Atm <span class="free">atm</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="free">cf</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="free">phi</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Language_Semantics-Atm_transT_invert"><span class="command">lemma</span></span> Atm_transT_invert<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main">!</span></span></span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Atm <span class="free">atm</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="free">s'</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s'</span> <span class="main">=</span> <span class="free">aval</span> <span class="free">atm</span> <span class="free">s</span> <span class="main">⟹</span> <span class="free">phi</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="free">phi</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> transT.cases<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Language_Semantics-Seq_transC_invert"><span class="command">lemma</span></span> Seq_transC_invert<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main">!</span></span></span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c1</span> <span class="main">;;</span> <span class="free">c2</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="free">c'</span><span class="main">,</span> <span class="free">s'</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">c1'</span><span class="main">.</span> <span class="main">⟦</span><span class="main">(</span><span class="free">c1</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">c1'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span><span class="main">;</span> <span class="free">c'</span> <span class="main">=</span> <span class="bound">c1'</span> <span class="main">;;</span> <span class="free">c2</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">phi</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span><span class="free">c1</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="free">s'</span><span class="main">;</span> <span class="free">c'</span> <span class="main">=</span> <span class="free">c2</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">phi</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="free">phi</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> transC.cases<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Language_Semantics-Seq_transT_invert"><span class="command">lemma</span></span> Seq_transT_invert<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">~</span> <span class="main">(</span><span class="free">c1</span> <span class="main">;;</span> <span class="free">c2</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="free">s'</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> transT.cases<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Language_Semantics-If_transC_invert"><span class="command">lemma</span></span> If_transC_invert<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main">!</span></span></span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>If <span class="free">tst</span> <span class="free">c1</span> <span class="free">c2</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="free">c'</span><span class="main">,</span> <span class="free">s'</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">tval</span> <span class="free">tst</span> <span class="free">s</span><span class="main">;</span> <span class="free">c'</span> <span class="main">=</span> <span class="free">c1</span><span class="main">;</span> <span class="free">s'</span> <span class="main">=</span> <span class="free">s</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">phi</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">~</span> <span class="free">tval</span> <span class="free">tst</span> <span class="free">s</span><span class="main">;</span> <span class="free">c'</span> <span class="main">=</span> <span class="free">c2</span><span class="main">;</span> <span class="free">s'</span> <span class="main">=</span> <span class="free">s</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">phi</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="free">phi</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> transC.cases<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Language_Semantics-If_transT_simp"><span class="command">lemma</span></span> If_transT_simp<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">~</span> <span class="main">(</span>If <span class="free">b</span> <span class="free">c1</span> <span class="free">c2</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="free">s'</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> transT.cases<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Language_Semantics-If_transT_invert"><span class="command">lemma</span></span> If_transT_invert<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main">!</span></span></span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>If <span class="free">b</span> <span class="free">c1</span> <span class="free">c2</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="free">s'</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="free">phi</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Language_Semantics-While_transC_invert"><span class="command">lemma</span></span> While_transC_invert<span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>While <span class="free">tst</span> <span class="free">c1</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="free">c'</span><span class="main">,</span> <span class="free">s'</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">tval</span> <span class="free">tst</span> <span class="free">s</span><span class="main">;</span> <span class="free">c'</span> <span class="main">=</span> <span class="free">c1</span> <span class="main">;;</span> <span class="main">(</span>While <span class="free">tst</span> <span class="free">c1</span><span class="main">)</span><span class="main">;</span> <span class="free">s'</span> <span class="main">=</span> <span class="free">s</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">phi</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="free">phi</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> transC.cases<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Language_Semantics-While_transT_invert"><span class="command">lemma</span></span> While_transT_invert<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main">!</span></span></span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>While <span class="free">tst</span> <span class="free">c1</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="free">s'</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">~</span> <span class="free">tval</span> <span class="free">tst</span> <span class="free">s</span><span class="main">;</span> <span class="free">s'</span> <span class="main">=</span> <span class="free">s</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">phi</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="free">phi</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> transT.cases<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="Language_Semantics-Par_transC_invert"><span class="command">lemma</span></span> Par_transC_invert<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main">!</span></span></span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Par <span class="free">c1</span> <span class="free">c2</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="free">c'</span><span class="main">,</span> <span class="free">s'</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">c1'</span><span class="main">.</span> <span class="main">⟦</span><span class="main">(</span><span class="free">c1</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">c1'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span><span class="main">;</span> <span class="free">c'</span> <span class="main">=</span> Par <span class="bound">c1'</span> <span class="free">c2</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">phi</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span><span class="free">c1</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="free">s'</span><span class="main">;</span> <span class="free">c'</span> <span class="main">=</span> <span class="free">c2</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">phi</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">c2'</span><span class="main">.</span> <span class="main">⟦</span><span class="main">(</span><span class="free">c2</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">c2'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span><span class="main">;</span> <span class="free">c'</span> <span class="main">=</span> Par <span class="free">c1</span> <span class="bound">c2'</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">phi</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span><span class="free">c2</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="free">s'</span><span class="main">;</span> <span class="free">c'</span> <span class="main">=</span> <span class="free">c1</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">phi</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="free">phi</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> transC.cases<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Language_Semantics-Par_transT_simp"><span class="command">lemma</span></span> Par_transT_simp<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">~</span> <span class="main">(</span>Par <span class="free">c1</span> <span class="free">c2</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="free">s'</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> transT.cases<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Language_Semantics-Par_transT_invert"><span class="command">lemma</span></span> Par_transT_invert<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main">!</span></span></span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Par <span class="free">c1</span> <span class="free">c2</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="free">s'</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="free">phi</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Language_Semantics-trans_nchotomy"><span class="command">lemma</span></span> trans_nchotomy<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span> <span class="bound">c'</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span><span class="bound">s'</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> 
 <span class="main">(</span><span class="main">∃</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">s'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?phiC</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">c</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">c'</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">(</span><span class="bound">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span><span class="bound">s'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?phiT</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">c</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">(</span><span class="bound">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">s'</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?phi</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">c</span><span class="main">.</span> <span class="var">?phiC</span> <span class="bound">c</span> <span class="main">∨</span> <span class="var">?phiT</span> <span class="bound">c</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?phi</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">c</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">metis</span> Atm<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> SeqC SeqT<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> IfFalse IfTrue<span class="main"><span class="keyword3">,</span></span> 
  <span class="operator">metis</span> WhileFalse WhileTrue<span class="main"><span class="keyword3">,</span></span> 
  <span class="operator">metis</span> ParCL ParCR ParTL ParTR<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> trans_invert<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> 
<span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">c'</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span><span class="bound">s'</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">phi</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">s'</span> <span class="main">⟹</span> <span class="free">phi</span>"</span></span> 
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="free">phi</span></span>
<span class="keyword1"><span class="command">using</span></span> assms trans_nchotomy <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Language_Semantics-not_transC_transT"><span class="command">lemma</span></span> not_transC_transT<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">cf</span> <span class="keyword1">→c</span> <span class="free">cf'</span><span class="main">;</span> <span class="free">cf</span> <span class="keyword1">→t</span> <span class="free">s'</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">phi</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> transC.cases<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemmas</span></span> MtransT_invert <span class="main">=</span> MtransT.cases

<span class="keyword1" id="Language_Semantics-MtransT_invert2"><span class="command">lemma</span></span> MtransT_invert2<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="free">s''</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">c'</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">⟦</span><span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span><span class="bound">s'</span><span class="main">)</span><span class="main">;</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="free">s''</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">phi</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="free">phi</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> MtransT.cases<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Language_Semantics-Seq_MtransC_invert"><span class="command">lemma</span></span> Seq_MtransC_invert<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main">!</span></span></span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c1</span> <span class="main">;;</span> <span class="free">c2</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="free">d'</span><span class="main">,</span> <span class="free">t'</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">c1'</span><span class="main">.</span> <span class="main">⟦</span><span class="main">(</span><span class="free">c1</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="bound">c1'</span><span class="main">,</span><span class="free">t'</span><span class="main">)</span><span class="main">;</span> <span class="free">d'</span> <span class="main">=</span> <span class="bound">c1'</span> <span class="main">;;</span> <span class="free">c2</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">phi</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">⟦</span><span class="main">(</span><span class="free">c1</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="bound">s'</span><span class="main">;</span> <span class="main">(</span><span class="free">c2</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="free">d'</span><span class="main">,</span><span class="free">t'</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">phi</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="free">phi</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="free">d'</span><span class="main">,</span><span class="free">t'</span><span class="main">)</span> <span class="main">⟹</span> 
   <span class="main">∀</span> <span class="bound">c1</span> <span class="bound">c2</span><span class="main">.</span> 
     <span class="skolem">c</span> <span class="main">=</span> <span class="bound">c1</span> <span class="main">;;</span> <span class="bound">c2</span> <span class="main">⟶</span>  
     <span class="main">(</span><span class="main">∃</span> <span class="bound">c1'</span><span class="main">.</span> <span class="main">(</span><span class="bound">c1</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="bound">c1'</span><span class="main">,</span><span class="free">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="free">d'</span> <span class="main">=</span> <span class="bound">c1'</span> <span class="main">;;</span> <span class="bound">c2</span><span class="main">)</span> <span class="main">∨</span> 
     <span class="main">(</span><span class="main">∃</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">(</span><span class="bound">c1</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="bound">s'</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">c2</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="free">d'</span><span class="main">,</span><span class="free">t'</span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> MtransC_induct2<span class="main">)</span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="entity">mauto_no_simp_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span>
     <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span> <span class="skolem">s</span> <span class="skolem">d'</span> <span class="skolem">t'</span> <span class="skolem">d''</span> <span class="skolem">t''</span> <span class="skolem">c1</span> <span class="skolem">c2</span>
     <span class="keyword3"><span class="command">assume</span></span> <span class="comment1">(*  "(c, s) →*c (d', t')" and *)</span>
     <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">c1</span> <span class="bound">c2</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">=</span> <span class="bound">c1</span> <span class="main">;;</span> <span class="bound">c2</span> <span class="main">⟶</span> 
        <span class="main">(</span><span class="main">∃</span><span class="bound">c1'</span><span class="main">.</span> <span class="main">(</span><span class="bound">c1</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="bound">c1'</span><span class="main">,</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">d'</span> <span class="main">=</span> <span class="bound">c1'</span> <span class="main">;;</span> <span class="bound">c2</span><span class="main">)</span> <span class="main">∨</span> 
        <span class="main">(</span><span class="main">∃</span><span class="bound">s'</span><span class="main">.</span> <span class="main">(</span><span class="bound">c1</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="bound">s'</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">c2</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="skolem">d'</span><span class="main">,</span> <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">d'</span><span class="main">,</span> <span class="skolem">t'</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">d''</span><span class="main">,</span> <span class="skolem">t''</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> <span class="skolem">c1</span> <span class="main">;;</span> <span class="skolem">c2</span>"</span></span>
     <span class="keyword1"><span class="command">hence</span></span> IH<span class="main">:</span> 
     <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">c1'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">c1</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="bound">c1'</span><span class="main">,</span> <span class="skolem">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">d'</span> <span class="main">=</span> <span class="bound">c1'</span> <span class="main">;;</span> <span class="skolem">c2</span><span class="main">)</span> <span class="main">∨</span> 
      <span class="main">(</span><span class="main">∃</span><span class="bound">s'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">c1</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="bound">s'</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">c2</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="skolem">d'</span><span class="main">,</span> <span class="skolem">t'</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">c1''</span><span class="main">.</span> <span class="main">(</span><span class="skolem">c1</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="bound">c1''</span><span class="main">,</span> <span class="skolem">t''</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">d''</span> <span class="main">=</span> <span class="bound">c1''</span> <span class="main">;;</span> <span class="skolem">c2</span><span class="main">)</span> <span class="main">∨</span> 
           <span class="main">(</span><span class="main">∃</span><span class="bound">s''</span><span class="main">.</span> <span class="main">(</span><span class="skolem">c1</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="bound">s''</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">c2</span><span class="main">,</span> <span class="bound">s''</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="skolem">d''</span><span class="main">,</span> <span class="skolem">t''</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
       <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c1'</span> <span class="keyword3"><span class="command">assume</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="skolem">c1'</span><span class="main">,</span> <span class="skolem">t'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> d'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d'</span> <span class="main">=</span> <span class="skolem">c1'</span> <span class="main">;;</span> <span class="skolem">c2</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">unfolding</span></span> d' <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">erule</span> Seq_transC_invert<span class="main">)</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c1''</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1'</span><span class="main">,</span> <span class="skolem">t'</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c1''</span><span class="main">,</span> <span class="skolem">t''</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> d''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d''</span> <span class="main">=</span> <span class="skolem">c1''</span> <span class="main">;;</span> <span class="skolem">c2</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="skolem">c1''</span><span class="main">,</span> <span class="skolem">t''</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 2 MtransC_StepC <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> d'' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1'</span><span class="main">,</span> <span class="skolem">t'</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="skolem">t''</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> d''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d''</span> <span class="main">=</span> <span class="skolem">c2</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="skolem">t''</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 2 MtransT.StepT <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> d'' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
       <span class="keyword1"><span class="command">}</span></span>
       <span class="keyword1"><span class="command">moreover</span></span>
       <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s'</span> <span class="keyword3"><span class="command">assume</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="skolem">s'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="skolem">d'</span><span class="main">,</span> <span class="skolem">t'</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="skolem">d''</span><span class="main">,</span> <span class="skolem">t''</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1 MtransC_StepC <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
       <span class="keyword1"><span class="command">}</span></span>
       <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
     <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">metis</span> PL.MtransC_Refl<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Language_Semantics-Seq_MtransT_invert"><span class="command">lemma</span></span> Seq_MtransT_invert<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main">!</span></span></span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c1</span> <span class="main">;;</span> <span class="free">c2</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="free">s''</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">⟦</span><span class="main">(</span><span class="free">c1</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="bound">s'</span><span class="main">;</span> <span class="main">(</span><span class="free">c2</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="free">s''</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">phi</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="free">phi</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d'</span></span> <span class="skolem"><span class="skolem">t'</span></span> <span class="keyword2"><span class="keyword">where</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c1</span> <span class="main">;;</span> <span class="free">c2</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="skolem">d'</span><span class="main">,</span><span class="skolem">t'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">d'</span><span class="main">,</span><span class="skolem">t'</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="free">s''</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> MtransT_invert2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
  <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">erule</span> Seq_MtransC_invert<span class="main">)</span> 
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c1'</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d'</span> <span class="main">=</span> <span class="skolem">c1'</span> <span class="main">;;</span> <span class="free">c2</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s'</span> <span class="keyword3"><span class="command">assume</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c1</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="skolem">s'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c2</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="skolem">d'</span><span class="main">,</span> <span class="skolem">t'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c2</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="free">s''</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 2 MtransT.StepT <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> 3 ** <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Direct rules for the multi-step relations›</span></span>

<span class="keyword1" id="Language_Semantics-Seq_MtransC"><span class="command">lemma</span></span> Seq_MtransC<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c1</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="free">c1'</span><span class="main">,</span> <span class="free">s'</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c1</span> <span class="main">;;</span> <span class="free">c2</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="free">c1'</span> <span class="main">;;</span> <span class="free">c2</span><span class="main">,</span> <span class="free">s'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> MtransC_induct2<span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> MtransC_StepC SeqC<span class="main">)</span>

<span class="keyword1" id="Language_Semantics-Seq_MtransT_MtransC"><span class="command">lemma</span></span> Seq_MtransT_MtransC<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c1</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="free">s'</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c1</span> <span class="main">;;</span> <span class="free">c2</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="free">c2</span><span class="main">,</span> <span class="free">s'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> MtransT_invert<span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> MtransC_StepC MtransT_invert2 PL.SeqT PL.Seq_MtransC assms<span class="main">)</span> 

<span class="keyword1" id="Language_Semantics-ParCL_MtransC"><span class="command">lemma</span></span> ParCL_MtransC<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c1</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="free">c1'</span><span class="main">,</span> <span class="free">s'</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Par <span class="free">c1</span> <span class="free">c2</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span>Par <span class="free">c1'</span> <span class="free">c2</span><span class="main">,</span> <span class="free">s'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> MtransC_induct2<span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> MtransC_StepC ParCL<span class="main">)</span>

<span class="keyword1" id="Language_Semantics-ParCR_MtransC"><span class="command">lemma</span></span> ParCR_MtransC<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c2</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="free">c2'</span><span class="main">,</span> <span class="free">s'</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Par <span class="free">c1</span> <span class="free">c2</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span>Par <span class="free">c1</span> <span class="free">c2'</span><span class="main">,</span> <span class="free">s'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> MtransC_induct2<span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> MtransC_StepC ParCR<span class="main">)</span>

<span class="keyword1" id="Language_Semantics-ParTL_MtransC"><span class="command">lemma</span></span> ParTL_MtransC<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c1</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="free">s'</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Par <span class="free">c1</span> <span class="free">c2</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="free">c2</span><span class="main">,</span> <span class="free">s'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> MtransT_invert<span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> MtransC_StepC MtransT_invert2 PL.ParTL ParCL_MtransC assms<span class="main">)</span> 

<span class="keyword1" id="Language_Semantics-ParTR_MtransC"><span class="command">lemma</span></span> ParTR_MtransC<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c2</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="free">s'</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Par <span class="free">c1</span> <span class="free">c2</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="free">c1</span><span class="main">,</span> <span class="free">s'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> MtransT_invert<span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> MtransC_StepC MtransT_invert2 PL.ParTR ParCR_MtransC assms<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Sublanguages›</span></span>

<span class="comment1">(* Commands not containing "while": *)</span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">noWhile</span> <span class="keyword2"><span class="keyword">where</span></span> 
 <span class="quoted"><span class="quoted">"<span class="free">noWhile</span> <span class="main">(</span>Atm <span class="free"><span class="bound"><span class="entity">atm</span></span></span><span class="main">)</span> <span class="main">=</span> True"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">noWhile</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">noWhile</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="main">∧</span> <span class="free">noWhile</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">noWhile</span> <span class="main">(</span>If <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">noWhile</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="main">∧</span> <span class="free">noWhile</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">noWhile</span> <span class="main">(</span>While <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">=</span> False"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">noWhile</span> <span class="main">(</span>Par <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">noWhile</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="main">∧</span> <span class="free">noWhile</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span>"</span></span>

<span class="comment1">(* Sequential commands: *)</span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">seq</span> <span class="keyword2"><span class="keyword">where</span></span> 
 <span class="quoted"><span class="quoted">"<span class="free">seq</span> <span class="main">(</span>Atm <span class="free"><span class="bound"><span class="entity">atm</span></span></span><span class="main">)</span> <span class="main">=</span> True"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">seq</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">seq</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="main">∧</span> <span class="free">seq</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">seq</span> <span class="main">(</span>If <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">seq</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="main">∧</span> <span class="free">seq</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">seq</span> <span class="main">(</span>While <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">seq</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">seq</span> <span class="main">(</span>Par <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span> <span class="main">=</span> False"</span></span>

<span class="keyword1" id="Language_Semantics-noWhile_transC"><span class="command">lemma</span></span> noWhile_transC<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"noWhile <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="free">c'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"noWhile <span class="free">c'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="free">c'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span> <span class="main">⟹</span> noWhile <span class="free">c</span> <span class="main">⟶</span> noWhile <span class="free">c'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">erule</span> transC_induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Language_Semantics-seq_transC"><span class="command">lemma</span></span> seq_transC<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"seq <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="free">c'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"seq <span class="free">c'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="free">c'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span> <span class="main">⟹</span> seq <span class="free">c</span> <span class="main">⟶</span> seq <span class="free">c'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">erule</span> transC_induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">wfP_on</span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">wfP_on</span> <span class="free"><span class="bound"><span class="entity">phi</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">≡</span> wfP <span class="main">(</span><span class="main">λ</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">phi</span></span></span> <span class="bound">a</span> <span class="bound">b</span><span class="main">)</span>"</span></span>

<span class="comment1">(* The number of steps -- makes sense only for the noWhile sublanguage: *)</span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">numSt</span> <span class="keyword2"><span class="keyword">where</span></span> 
 <span class="quoted"><span class="quoted">"<span class="free">numSt</span> <span class="main">(</span>Atm <span class="free"><span class="bound"><span class="entity">atm</span></span></span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">0</span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">numSt</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">numSt</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="main">+</span> <span class="free">numSt</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">numSt</span> <span class="main">(</span>If <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> max <span class="main">(</span><span class="free">numSt</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">numSt</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">numSt</span> <span class="main">(</span>Par <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">numSt</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="main">+</span> <span class="free">numSt</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span>"</span></span>

<span class="keyword1" id="Language_Semantics-numSt_gt_0"><span class="command">lemma</span></span> numSt_gt_0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"noWhile <span class="free">c</span> <span class="main">⟹</span> numSt <span class="free">c</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">c</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Language_Semantics-numSt_transC"><span class="command">lemma</span></span> numSt_transC<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"noWhile <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="free">c'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"numSt <span class="free">c'</span> <span class="main">&lt;</span> numSt <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">c</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">c'</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
<span class="keyword1"><span class="command">corollary</span></span> wfP_tranC_noWhile<span class="main">:</span>
<span class="quoted"><span class="quoted">"wfP <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span><span class="bound">s'</span><span class="main">)</span> <span class="main">(</span><span class="bound">c</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span><span class="main">.</span> noWhile <span class="bound">c</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">c</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span><span class="bound">s'</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?K</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="main">(</span><span class="bound">c'</span><span class="main">,</span><span class="bound">s'</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="bound">c</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> noWhile <span class="bound">c</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">c</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span><span class="bound">s'</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?K</span> <span class="main">≤</span> inv_image <span class="main">{</span><span class="main">(</span><span class="bound">m</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="bound">m</span> <span class="main">&lt;</span> <span class="bound">n</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">c</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span><span class="main">.</span> numSt <span class="bound">c</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> numSt_transC<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"wf <span class="var">?K</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> wf_less wf_subset<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="var"><span class="quoted"><span class="var">?K</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> wfP_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> CollectD Collect_mem_eq Compl_eq Compl_iff double_complement<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Language_Semantics-noWhile_MtransT"><span class="command">lemma</span></span> noWhile_MtransT<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"noWhile <span class="free">c</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="bound">s'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"noWhile <span class="free">c</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">s</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="bound">s'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> measure_induct<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">numSt</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">proof</span></span> <span class="operator">clarify</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'test</span><span class="main">,</span><span class="tfree">'atom</span><span class="main">)</span> com"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">s</span> 
    <span class="keyword3"><span class="command">assume</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">c'</span><span class="main">.</span> numSt <span class="bound">c'</span> <span class="main">&lt;</span> numSt <span class="skolem">c</span> <span class="main">⟶</span> noWhile <span class="bound">c'</span> <span class="main">⟶</span> 
                     <span class="main">(</span><span class="main">∀</span><span class="bound">s'</span><span class="main">.</span> <span class="main">∃</span><span class="bound">s''</span><span class="main">.</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="bound">s''</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"noWhile <span class="skolem">c</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">s''</span><span class="main">.</span> <span class="main">(</span><span class="skolem">c</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="bound">s''</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> trans_invert<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">c</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">s</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c'</span> <span class="skolem">s'</span> <span class="keyword3"><span class="command">assume</span></span> cs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"numSt <span class="skolem">c'</span> <span class="main">&lt;</span> numSt <span class="skolem">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"noWhile <span class="skolem">c'</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> numSt_transC noWhile_transC c <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="skolem">s''</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="skolem">s''</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> cs <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s'</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="skolem">s'</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="skolem">s'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    <span class="keyword1"><span class="command">qed</span></span> 
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span> 

<span class="comment1">(* Configurations that may diverge: *)</span>

<span class="keyword1"><span class="command">coinductive</span></span> <span class="entity">mayDiverge</span> <span class="keyword2"><span class="keyword">where</span></span> 
intro<span class="main">:</span> 
<span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c'</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s'</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="free">mayDiverge</span> <span class="free"><span class="bound"><span class="entity">c'</span></span></span> <span class="free"><span class="bound"><span class="entity">s'</span></span></span><span class="main">⟧</span> 
  <span class="main">⟹</span> <span class="free">mayDiverge</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Coinduction for may-diverge :›</span></span>

<span class="keyword1" id="Language_Semantics-mayDiverge_coind"><span class="command">lemma</span></span> mayDiverge_coind<span class="main">[</span><span class="operator">consumes</span> 1<span class="main">,</span> <span class="operator">case_names</span> Hyp<span class="main">,</span> <span class="operator">induct</span> <span class="quasi_keyword"><span class="quasi_keyword">pred</span></span><span class="main"><span class="main"><span class="main">:</span></span></span> mayDiverge<span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">phi</span> <span class="free">c</span> <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
**<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">c</span> <span class="bound">s</span><span class="main">.</span> <span class="free">phi</span> <span class="bound">c</span> <span class="bound">s</span> <span class="main">⟹</span> 
            <span class="main">∃</span> <span class="bound">c'</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">(</span><span class="bound">c</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span><span class="bound">s'</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">phi</span> <span class="bound">c'</span> <span class="bound">s'</span> <span class="main">∨</span> mayDiverge <span class="bound">c'</span> <span class="bound">s'</span><span class="main">)</span>"</span></span> 
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mayDiverge <span class="free">c</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> mayDiverge.coinduct<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> ** <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 

<span class="keyword1" id="Language_Semantics-mayDiverge_raw_coind"><span class="command">lemma</span></span> mayDiverge_raw_coind<span class="main">[</span><span class="operator">consumes</span> 1<span class="main">,</span> <span class="operator">case_names</span> Hyp<span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">phi</span> <span class="free">c</span> <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
**<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">c</span> <span class="bound">s</span><span class="main">.</span> <span class="free">phi</span> <span class="bound">c</span> <span class="bound">s</span> <span class="main">⟹</span> 
            <span class="main">∃</span> <span class="bound">c'</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">(</span><span class="bound">c</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span><span class="bound">s'</span><span class="main">)</span> <span class="main">∧</span> <span class="free">phi</span> <span class="bound">c'</span> <span class="bound">s'</span>"</span></span> 
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mayDiverge <span class="free">c</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">induct</span> <span class="keyword1"><span class="command">using</span></span> ** <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹May-diverge versus transition:›</span></span>

<span class="keyword1" id="Language_Semantics-mayDiverge_transC"><span class="command">lemma</span></span> mayDiverge_transC<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mayDiverge <span class="free">c</span> <span class="free">s</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">c'</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span><span class="bound">s'</span><span class="main">)</span> <span class="main">∧</span> mayDiverge <span class="bound">c'</span> <span class="bound">s'</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> mayDiverge.cases<span class="main">)</span> <span class="operator">blast</span>

<span class="keyword1" id="Language_Semantics-transC_mayDiverge"><span class="command">lemma</span></span> transC_mayDiverge<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="free">c'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"mayDiverge <span class="free">c'</span> <span class="free">s'</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mayDiverge <span class="free">c</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mayDiverge.intro<span class="main">)</span>

<span class="keyword1" id="Language_Semantics-mayDiverge_not_transT"><span class="command">lemma</span></span> mayDiverge_not_transT<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mayDiverge <span class="free">c</span> <span class="free">s</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="free">s'</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms mayDiverge_transC not_transC_transT<span class="main">)</span>

<span class="keyword1" id="Language_Semantics-MtransC_mayDiverge"><span class="command">lemma</span></span> MtransC_mayDiverge<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="free">c'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"mayDiverge <span class="free">c'</span> <span class="free">s'</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mayDiverge <span class="free">c</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms transC_mayDiverge <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Language_Semantics-not_MtransT_mayDiverge"><span class="command">lemma</span></span> not_MtransT_mayDiverge<span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="bound">s'</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mayDiverge <span class="free">c</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="bound">s'</span> <span class="main">⟹</span> <span class="var">?thesis</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> mayDiverge_raw_coind<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Hyp <span class="skolem">c</span> <span class="skolem">s</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">s''</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span><span class="skolem">c</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">s''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> transT_MtransT<span class="main">)</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c'</span></span> <span class="skolem"><span class="skolem">s'</span></span> <span class="keyword2"><span class="keyword">where</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c</span><span class="main">,</span><span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span><span class="skolem">s'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> trans_invert<span class="main">)</span> 
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">s''</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="bound">s''</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Hyp 1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> transC_MtransT<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Language_Semantics-not_mayDiverge_Atm"><span class="command">lemma</span></span> not_mayDiverge_Atm<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">¬</span> mayDiverge <span class="main">(</span>Atm <span class="free">atm</span><span class="main">)</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Atm_transC_invert mayDiverge.simps<span class="main">)</span> 

<span class="keyword1" id="Language_Semantics-mayDiverge_Seq_L"><span class="command">lemma</span></span> mayDiverge_Seq_L<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mayDiverge <span class="free">c1</span> <span class="free">s</span>"</span></span> 
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mayDiverge <span class="main">(</span><span class="free">c1</span> <span class="main">;;</span> <span class="free">c2</span><span class="main">)</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
 <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">c1</span> <span class="bound">c2</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">=</span> <span class="bound">c1</span> <span class="main">;;</span> <span class="bound">c2</span> <span class="main">∧</span> mayDiverge <span class="bound">c1</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"mayDiverge <span class="skolem">c</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> mayDiverge_raw_coind<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Hyp <span class="skolem">c</span> <span class="skolem">s</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c1</span></span> <span class="skolem"><span class="skolem">c2</span></span> <span class="keyword2"><span class="keyword">where</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> <span class="skolem">c1</span> <span class="main">;;</span> <span class="skolem">c2</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"mayDiverge <span class="skolem">c1</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c1'</span></span> <span class="skolem"><span class="skolem">s'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span><span class="main">,</span><span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c1'</span><span class="main">,</span><span class="skolem">s'</span><span class="main">)</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"mayDiverge <span class="skolem">c1'</span> <span class="skolem">s'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mayDiverge_transC<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> c SeqC <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">qed</span></span>
 <span class="keyword1"><span class="command">}</span></span>
 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Language_Semantics-mayDiverge_Seq_R"><span class="command">lemma</span></span> mayDiverge_Seq_R<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> c1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c1</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="free">s'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c2<span class="main">:</span> <span class="quoted"><span class="quoted">"mayDiverge <span class="free">c2</span> <span class="free">s'</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mayDiverge <span class="main">(</span><span class="free">c1</span> <span class="main">;;</span> <span class="free">c2</span><span class="main">)</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c1</span> <span class="main">;;</span> <span class="free">c2</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="free">c2</span><span class="main">,</span> <span class="free">s'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> c1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Seq_MtransT_MtransC<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> MtransC_mayDiverge c2<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Language_Semantics-mayDiverge_If_L"><span class="command">lemma</span></span> mayDiverge_If_L<span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">tval</span> <span class="free">tst</span> <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"mayDiverge <span class="free">c1</span> <span class="free">s</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mayDiverge <span class="main">(</span>If <span class="free">tst</span> <span class="free">c1</span> <span class="free">c2</span><span class="main">)</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms IfTrue transC_mayDiverge <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1" id="Language_Semantics-mayDiverge_If_R"><span class="command">lemma</span></span> mayDiverge_If_R<span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">tval</span> <span class="free">tst</span> <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"mayDiverge <span class="free">c2</span> <span class="free">s</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mayDiverge <span class="main">(</span>If <span class="free">tst</span> <span class="free">c1</span> <span class="free">c2</span><span class="main">)</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms IfFalse transC_mayDiverge <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1" id="Language_Semantics-mayDiverge_If"><span class="command">lemma</span></span> mayDiverge_If<span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mayDiverge <span class="free">c1</span> <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"mayDiverge <span class="free">c2</span> <span class="free">s</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mayDiverge <span class="main">(</span>If <span class="free">tst</span> <span class="free">c1</span> <span class="free">c2</span><span class="main">)</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms mayDiverge_If_L mayDiverge_If_R 
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">tval</span> <span class="free">tst</span> <span class="free">s</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Language_Semantics-mayDiverge_Par_L"><span class="command">lemma</span></span> mayDiverge_Par_L<span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mayDiverge <span class="free">c1</span> <span class="free">s</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mayDiverge <span class="main">(</span>Par <span class="free">c1</span> <span class="free">c2</span><span class="main">)</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
 <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">c1</span> <span class="bound">c2</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">=</span> Par <span class="bound">c1</span> <span class="bound">c2</span> <span class="main">∧</span> mayDiverge <span class="bound">c1</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"mayDiverge <span class="skolem">c</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> mayDiverge_raw_coind<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Hyp <span class="skolem">c</span> <span class="skolem">s</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c1</span></span> <span class="skolem"><span class="skolem">c2</span></span> <span class="keyword2"><span class="keyword">where</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> Par <span class="skolem">c1</span> <span class="skolem">c2</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"mayDiverge <span class="skolem">c1</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c1'</span></span> <span class="skolem"><span class="skolem">s'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span><span class="main">,</span><span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c1'</span><span class="main">,</span><span class="skolem">s'</span><span class="main">)</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"mayDiverge <span class="skolem">c1'</span> <span class="skolem">s'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mayDiverge_transC<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> c ParCL <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">qed</span></span>
 <span class="keyword1"><span class="command">}</span></span>
 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Language_Semantics-mayDiverge_Par_R"><span class="command">lemma</span></span> mayDiverge_Par_R<span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mayDiverge <span class="free">c2</span> <span class="free">s</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mayDiverge <span class="main">(</span>Par <span class="free">c1</span> <span class="free">c2</span><span class="main">)</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
 <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">c1</span> <span class="bound">c2</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">=</span> Par <span class="bound">c1</span> <span class="bound">c2</span> <span class="main">∧</span> mayDiverge <span class="bound">c2</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"mayDiverge <span class="skolem">c</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> mayDiverge_raw_coind<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Hyp <span class="skolem">c</span> <span class="skolem">s</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c1</span></span> <span class="skolem"><span class="skolem">c2</span></span> <span class="keyword2"><span class="keyword">where</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> Par <span class="skolem">c1</span> <span class="skolem">c2</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"mayDiverge <span class="skolem">c2</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c2'</span></span> <span class="skolem"><span class="skolem">s'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c2</span><span class="main">,</span><span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c2'</span><span class="main">,</span><span class="skolem">s'</span><span class="main">)</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"mayDiverge <span class="skolem">c2'</span> <span class="skolem">s'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mayDiverge_transC<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> c ParCR <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">qed</span></span>
 <span class="keyword1"><span class="command">}</span></span>
 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* Configurations that must terminate: *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mustT</span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">mustT</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">≡</span> <span class="main">¬</span> mayDiverge <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span>

<span class="keyword1" id="Language_Semantics-mustT_transC"><span class="command">lemma</span></span> mustT_transC<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mustT <span class="free">c</span> <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="free">c'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mustT <span class="free">c'</span> <span class="free">s'</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms intro <span class="keyword1"><span class="command">unfolding</span></span> mustT_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Language_Semantics-transT_not_mustT"><span class="command">lemma</span></span> transT_not_mustT<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="free">s'</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mustT <span class="free">c</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms mayDiverge_not_transT mustT_def<span class="main">)</span>

<span class="keyword1" id="Language_Semantics-mustT_MtransC"><span class="command">lemma</span></span> mustT_MtransC<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mustT <span class="free">c</span> <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="free">c'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mustT <span class="free">c'</span> <span class="free">s'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="free">c'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span> <span class="main">⟹</span> mustT <span class="free">c</span> <span class="free">s</span> <span class="main">⟶</span> mustT <span class="free">c'</span> <span class="free">s'</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> MtransC_induct2<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> mustT_transC <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Language_Semantics-mustT_MtransT"><span class="command">lemma</span></span> mustT_MtransT<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mustT <span class="free">c</span> <span class="free">s</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="bound">s'</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms not_MtransT_mayDiverge <span class="keyword1"><span class="command">unfolding</span></span> mustT_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Language_Semantics-mustT_Atm"><span class="command">lemma</span></span> mustT_Atm<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"mustT <span class="main">(</span>Atm <span class="free">atm</span><span class="main">)</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> not_mayDiverge_Atm mustT_def<span class="main">)</span>

<span class="keyword1" id="Language_Semantics-mustT_Seq_L"><span class="command">lemma</span></span> mustT_Seq_L<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mustT <span class="main">(</span><span class="free">c1</span> <span class="main">;;</span> <span class="free">c2</span><span class="main">)</span> <span class="free">s</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mustT <span class="free">c1</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> PL.mayDiverge_Seq_L assms mustT_def<span class="main">)</span> 

<span class="keyword1" id="Language_Semantics-mustT_Seq_R"><span class="command">lemma</span></span> mustT_Seq_R<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mustT <span class="main">(</span><span class="free">c1</span> <span class="main">;;</span> <span class="free">c2</span><span class="main">)</span> <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c1</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="free">s'</span>"</span></span> 
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mustT <span class="free">c2</span> <span class="free">s'</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Seq_MtransT_MtransC mustT_MtransC assms<span class="main">)</span>

<span class="keyword1" id="Language_Semantics-mustT_If_L"><span class="command">lemma</span></span> mustT_If_L<span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">tval</span> <span class="free">tst</span> <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"mustT <span class="main">(</span>If <span class="free">tst</span> <span class="free">c1</span> <span class="free">c2</span><span class="main">)</span> <span class="free">s</span>"</span></span> 
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mustT <span class="free">c1</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms trans_IfTrue  mustT_transC<span class="main">)</span>

<span class="keyword1" id="Language_Semantics-mustT_If_R"><span class="command">lemma</span></span> mustT_If_R<span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">tval</span> <span class="free">tst</span> <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"mustT <span class="main">(</span>If <span class="free">tst</span> <span class="free">c1</span> <span class="free">c2</span><span class="main">)</span> <span class="free">s</span>"</span></span> 
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mustT <span class="free">c2</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms trans_IfFalse  mustT_transC<span class="main">)</span>

<span class="keyword1" id="Language_Semantics-mustT_If"><span class="command">lemma</span></span> mustT_If<span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mustT <span class="main">(</span>If <span class="free">tst</span> <span class="free">c1</span> <span class="free">c2</span><span class="main">)</span> <span class="free">s</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mustT <span class="free">c1</span> <span class="free">s</span> <span class="main">∨</span> mustT <span class="free">c2</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms mustT_If_L mustT_If_R<span class="main">)</span>

<span class="keyword1" id="Language_Semantics-mustT_Par_L"><span class="command">lemma</span></span> mustT_Par_L<span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mustT <span class="main">(</span>Par <span class="free">c1</span> <span class="free">c2</span><span class="main">)</span> <span class="free">s</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mustT <span class="free">c1</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms mayDiverge_Par_L mustT_def<span class="main">)</span>

<span class="keyword1" id="Language_Semantics-mustT_Par_R"><span class="command">lemma</span></span> mustT_Par_R<span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mustT <span class="main">(</span>Par <span class="free">c1</span> <span class="free">c2</span><span class="main">)</span> <span class="free">s</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mustT <span class="free">c2</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms mayDiverge_Par_R mustT_def<span class="main">)</span>
 
<span class="comment1">(* Semantically deterministic commands: *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">determOn</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">determOn</span> <span class="free"><span class="bound"><span class="entity">phi</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">≡</span> 
 <span class="main">∀</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">b'</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">phi</span></span></span> <span class="bound">a</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="bound">a</span> <span class="bound">b</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="bound">a</span> <span class="bound">b'</span> <span class="main">⟶</span> <span class="bound">b</span> <span class="main">=</span> <span class="bound">b'</span>"</span></span>

<span class="keyword1" id="Language_Semantics-determOn_seq_transT"><span class="command">lemma</span></span> determOn_seq_transT<span class="main">:</span>
<span class="quoted"><span class="quoted">"determOn <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">c</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span><span class="main">.</span> seq <span class="bound">c</span><span class="main">)</span> transT"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span> <span class="skolem">s</span> <span class="skolem">s1'</span> <span class="skolem">s2'</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"seq <span class="skolem">c</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">c</span><span class="main">,</span><span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="skolem">s1'</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">c</span><span class="main">,</span><span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="skolem">s2'</span> <span class="main">⟶</span> <span class="skolem">s1'</span> <span class="main">=</span> <span class="skolem">s2'</span>"</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">c</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">s1'</span></span> <span class="quoted"><span class="skolem">s2'</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> determOn_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context PL *)</span>
<span class="comment1">(*******************************************)</span>


<span class="keyword2"><span class="keyword">end</span></span>







</pre>
</div><div id="During_Execution">
<div class="head">
<h1>Theory During_Execution</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹During-execution security›</span></span> 

<span class="keyword1"><span class="command">theory</span></span> During_Execution 
<span class="keyword2"><span class="keyword">imports</span></span> <a href="#Bisim">Bisim</a> <a href="#Language_Semantics">Language_Semantics</a> <span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Basic setting›</span></span>

<span class="keyword1"><span class="command">locale</span></span> PL_Indis <span class="main">=</span> PL <span class="quoted"><span class="free">tval</span></span> <span class="quoted"><span class="free">aval</span></span> 
  <span class="keyword2"><span class="keyword">for</span></span> 
    <span class="free">tval</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'test</span> <span class="main">⇒</span> <span class="tfree">'state</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
    <span class="free">aval</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'atom</span> <span class="main">⇒</span> <span class="tfree">'state</span> <span class="main">⇒</span> <span class="tfree">'state</span>"</span></span>
  <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> 
    <span class="free">indis</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'state</span> rel"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> 
    equiv_indis<span class="main">:</span> <span class="quoted"><span class="quoted">"equiv UNIV <span class="free">indis</span>"</span></span> 
    

<span class="comment1">(*******************************************)</span>
<span class="keyword1"><span class="command">context</span></span> PL_Indis 
<span class="keyword2"><span class="keyword">begin</span></span> 

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">indisAbbrev</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">≈</span>"</span> 50<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">s1</span></span></span> <span class="main"><span class="free">≈</span></span> <span class="free"><span class="bound"><span class="entity">s2</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s1</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s2</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">indis</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">indisE</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">≈e</span>"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">se1</span></span></span> <span class="keyword1"><span class="free">≈e</span></span> <span class="free"><span class="bound"><span class="entity">se2</span></span></span> <span class="main">≡</span> 
 <span class="keyword1">case</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">se1</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">se2</span></span></span><span class="main">)</span> <span class="keyword1">of</span> 
   <span class="main">(</span>Inl <span class="bound">s1</span><span class="main">,</span> Inl <span class="bound">s2</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">s1</span> <span class="main">≈</span> <span class="bound">s2</span>
  <span class="main">|</span><span class="main">(</span>Inr <span class="bound">err1</span><span class="main">,</span> Inr <span class="bound">err2</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">err1</span> <span class="main">=</span> <span class="bound">err2</span>"</span></span>

<span class="keyword1" id="During_Execution-refl_indis"><span class="command">lemma</span></span> refl_indis<span class="main">:</span> <span class="quoted"><span class="quoted">"refl <span class="free">indis</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> trans_indis<span class="main">:</span> <span class="quoted"><span class="quoted">"trans <span class="free">indis</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> sym_indis<span class="main">:</span> <span class="quoted"><span class="quoted">"sym <span class="free">indis</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> equiv_indis <span class="keyword1"><span class="command">unfolding</span></span> equiv_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="During_Execution-indis_refl"><span class="command">lemma</span></span> indis_refl<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> refl_indis <span class="keyword1"><span class="command">unfolding</span></span> refl_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="During_Execution-indis_trans"><span class="command">lemma</span></span> indis_trans<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">s</span> <span class="main">≈</span> <span class="free">s'</span><span class="main">;</span> <span class="free">s'</span> <span class="main">≈</span> <span class="free">s''</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">s</span> <span class="main">≈</span> <span class="free">s''</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> trans_indis <span class="keyword1"><span class="command">unfolding</span></span> trans_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="During_Execution-indis_sym"><span class="command">lemma</span></span> indis_sym<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> <span class="free">s'</span> <span class="main">⟹</span> <span class="free">s'</span> <span class="main">≈</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> sym_indis <span class="keyword1"><span class="command">unfolding</span></span> sym_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Compatibility and discreetness›</span></span> 

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">compatTst</span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">compatTst</span> <span class="free"><span class="bound"><span class="entity">tst</span></span></span> <span class="main">≡</span> 
 <span class="main">∀</span> <span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> <span class="bound">s</span> <span class="main">≈</span> <span class="bound">t</span> <span class="main">⟶</span> <span class="free">tval</span> <span class="free"><span class="bound"><span class="entity">tst</span></span></span> <span class="bound">s</span> <span class="main">=</span> <span class="free">tval</span> <span class="free"><span class="bound"><span class="entity">tst</span></span></span> <span class="bound">t</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">compatAtm</span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">compatAtm</span> <span class="free"><span class="bound"><span class="entity">atm</span></span></span> <span class="main">≡</span> 
 <span class="main">∀</span> <span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> <span class="bound">s</span> <span class="main">≈</span> <span class="bound">t</span> <span class="main">⟶</span> <span class="free">aval</span> <span class="free"><span class="bound"><span class="entity">atm</span></span></span> <span class="bound">s</span> <span class="main">≈</span> <span class="free">aval</span> <span class="free"><span class="bound"><span class="entity">atm</span></span></span> <span class="bound">t</span>"</span></span>

<span class="comment1">(* ≈-preservation: *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">presAtm</span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">presAtm</span> <span class="free"><span class="bound"><span class="entity">atm</span></span></span> <span class="main">≡</span> 
 <span class="main">∀</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">≈</span> <span class="free">aval</span> <span class="free"><span class="bound"><span class="entity">atm</span></span></span> <span class="bound">s</span>"</span></span>

<span class="keyword1"><span class="command">coinductive</span></span> <span class="entity">discr</span> <span class="keyword2"><span class="keyword">where</span></span> 
intro<span class="main">:</span> 
<span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">⋀</span> <span class="bound">s</span> <span class="bound">c'</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span><span class="bound">s'</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">s</span> <span class="main">≈</span> <span class="bound">s'</span> <span class="main">∧</span> <span class="free">discr</span> <span class="bound">c'</span><span class="main">;</span> 
  <span class="main">⋀</span> <span class="bound">s</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">s'</span> <span class="main">⟹</span> <span class="bound">s</span> <span class="main">≈</span> <span class="bound">s'</span><span class="main">⟧</span> 
  <span class="main">⟹</span> <span class="free">discr</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span>"</span></span>

<span class="keyword1" id="During_Execution-presAtm_compatAtm"><span class="command">lemma</span></span> presAtm_compatAtm<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"presAtm <span class="free">atm</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"compatAtm <span class="free">atm</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> compatAtm_def
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> presAtm_def indis_sym indis_trans<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Coinduction for discreetness:›</span></span>

<span class="keyword1" id="During_Execution-discr_coind"><span class="command">lemma</span></span> discr_coind<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">phi</span> <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
**<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">c</span> <span class="bound">s</span> <span class="bound">c'</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">⟦</span><span class="free">phi</span> <span class="bound">c</span><span class="main">;</span> <span class="main">(</span><span class="bound">c</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span><span class="bound">s'</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="bound">s</span> <span class="main">≈</span> <span class="bound">s'</span> <span class="main">∧</span> <span class="main">(</span><span class="free">phi</span> <span class="bound">c'</span> <span class="main">∨</span> discr <span class="bound">c'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
***<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">c</span> <span class="bound">s</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">⟦</span><span class="free">phi</span> <span class="bound">c</span><span class="main">;</span> <span class="main">(</span><span class="bound">c</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">s'</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="bound">s</span> <span class="main">≈</span> <span class="bound">s'</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"discr <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> discr.coinduct<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> ** *** <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="During_Execution-discr_raw_coind"><span class="command">lemma</span></span> discr_raw_coind<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">phi</span> <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
**<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">c</span> <span class="bound">s</span> <span class="bound">c'</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">⟦</span><span class="free">phi</span> <span class="bound">c</span><span class="main">;</span> <span class="main">(</span><span class="bound">c</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span><span class="bound">s'</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="bound">s</span> <span class="main">≈</span> <span class="bound">s'</span> <span class="main">∧</span> <span class="free">phi</span> <span class="bound">c'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
***<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">c</span> <span class="bound">s</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">⟦</span><span class="free">phi</span> <span class="bound">c</span><span class="main">;</span> <span class="main">(</span><span class="bound">c</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">s'</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="bound">s</span> <span class="main">≈</span> <span class="bound">s'</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"discr <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> discr_coind<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> ** *** <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Discreetness versus transition:›</span></span>

<span class="keyword1" id="During_Execution-discr_transC"><span class="command">lemma</span></span> discr_transC<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"discr <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="free">c'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"discr <span class="free">c'</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> discr.cases<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> ** <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="During_Execution-discr_MtransC"><span class="command">lemma</span></span> discr_MtransC<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"discr <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="free">c'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"discr <span class="free">c'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="free">c'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span> <span class="main">⟹</span> discr <span class="free">c</span> <span class="main">⟶</span> discr <span class="free">c'</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> MtransC_induct2<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> discr_transC <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="During_Execution-discr_transC_indis"><span class="command">lemma</span></span> discr_transC_indis<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"discr <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="free">c'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> <span class="free">s'</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> discr.cases<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> ** <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="During_Execution-discr_MtransC_indis"><span class="command">lemma</span></span> discr_MtransC_indis<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"discr <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="free">c'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> <span class="free">s'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="free">c'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span> <span class="main">⟹</span> discr <span class="free">c</span> <span class="main">⟶</span> <span class="free">s</span> <span class="main">≈</span> <span class="free">s'</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> MtransC_induct2<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> indis_refl<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> discr.cases discr_MtransC indis_trans<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="During_Execution-discr_transT"><span class="command">lemma</span></span> discr_transT<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"discr <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="free">s'</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> <span class="free">s'</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> discr.cases<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> ** <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="During_Execution-discr_MtransT"><span class="command">lemma</span></span> discr_MtransT<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"discr <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="free">s'</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> <span class="free">s'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d'</span></span> <span class="skolem"><span class="skolem">t'</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  cs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="skolem">d'</span><span class="main">,</span><span class="skolem">t'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> d't'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">d'</span><span class="main">,</span><span class="skolem">t'</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="free">s'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ** <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> MtransT_invert2<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> <span class="skolem">t'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> * discr_MtransC_indis <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> 
  <span class="keyword1"><span class="command">{</span></span><span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"discr <span class="skolem">d'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> cs * discr_MtransC <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
   <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span> <span class="main">≈</span> <span class="free">s'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> d't' discr_transT <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> indis_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span> 


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Terminating-interctive discreetness›</span></span>

<span class="keyword1"><span class="command">coinductive</span></span> <span class="entity">discr0</span> <span class="keyword2"><span class="keyword">where</span></span> 
intro<span class="main">:</span> 
<span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">⋀</span> <span class="bound">s</span> <span class="bound">c'</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">⟦</span>mustT <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="bound">s</span><span class="main">;</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span><span class="bound">s'</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="bound">s</span> <span class="main">≈</span> <span class="bound">s'</span> <span class="main">∧</span> <span class="free">discr0</span> <span class="bound">c'</span><span class="main">;</span> 
  <span class="main">⋀</span> <span class="bound">s</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">⟦</span>mustT <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="bound">s</span><span class="main">;</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">s'</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="bound">s</span> <span class="main">≈</span> <span class="bound">s'</span><span class="main">⟧</span> 
  <span class="main">⟹</span> <span class="free">discr0</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span>"</span></span> 

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Coinduction for 0-discreetness:›</span></span>

<span class="keyword1" id="During_Execution-discr0_coind"><span class="command">lemma</span></span> discr0_coind<span class="main">[</span><span class="operator">consumes</span> 1<span class="main">,</span> <span class="operator">case_names</span> Cont Term<span class="main">,</span> <span class="operator">induct</span> <span class="quasi_keyword"><span class="quasi_keyword">pred</span></span><span class="main"><span class="main"><span class="main">:</span></span></span> discr0<span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">phi</span> <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
**<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">c</span> <span class="bound">s</span> <span class="bound">c'</span> <span class="bound">s'</span><span class="main">.</span> 
       <span class="main">⟦</span>mustT <span class="bound">c</span> <span class="bound">s</span><span class="main">;</span> <span class="free">phi</span> <span class="bound">c</span><span class="main">;</span> <span class="main">(</span><span class="bound">c</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span><span class="bound">s'</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> 
       <span class="bound">s</span> <span class="main">≈</span> <span class="bound">s'</span> <span class="main">∧</span> <span class="main">(</span><span class="free">phi</span> <span class="bound">c'</span> <span class="main">∨</span> discr0 <span class="bound">c'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
***<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">c</span> <span class="bound">s</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">⟦</span>mustT <span class="bound">c</span> <span class="bound">s</span><span class="main">;</span> <span class="free">phi</span> <span class="bound">c</span><span class="main">;</span> <span class="main">(</span><span class="bound">c</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">s'</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="bound">s</span> <span class="main">≈</span> <span class="bound">s'</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"discr0 <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> discr0.coinduct<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> ** *** <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="During_Execution-discr0_raw_coind"><span class="command">lemma</span></span> discr0_raw_coind<span class="main">[</span><span class="operator">consumes</span> 1<span class="main">,</span> <span class="operator">case_names</span> Cont Term<span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">phi</span> <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
**<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">c</span> <span class="bound">s</span> <span class="bound">c'</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">⟦</span>mustT <span class="bound">c</span> <span class="bound">s</span><span class="main">;</span> <span class="free">phi</span> <span class="bound">c</span><span class="main">;</span> <span class="main">(</span><span class="bound">c</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span><span class="bound">s'</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="bound">s</span> <span class="main">≈</span> <span class="bound">s'</span> <span class="main">∧</span> <span class="free">phi</span> <span class="bound">c'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
***<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">c</span> <span class="bound">s</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">⟦</span>mustT <span class="bound">c</span> <span class="bound">s</span><span class="main">;</span> <span class="free">phi</span> <span class="bound">c</span><span class="main">;</span> <span class="main">(</span><span class="bound">c</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">s'</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="bound">s</span> <span class="main">≈</span> <span class="bound">s'</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"discr0 <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> discr0_coind<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> ** *** <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹0-Discreetness versus transition:›</span></span>

<span class="keyword1" id="During_Execution-discr0_transC"><span class="command">lemma</span></span> discr0_transC<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"discr0 <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"mustT <span class="free">c</span> <span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="free">c'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"discr0 <span class="free">c'</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> discr0.cases<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> ** <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="During_Execution-discr0_MtransC"><span class="command">lemma</span></span> discr0_MtransC<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"discr0 <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"mustT <span class="free">c</span> <span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="free">c'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"discr0 <span class="free">c'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="free">c'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span> <span class="main">⟹</span> mustT <span class="free">c</span> <span class="free">s</span> <span class="main">∧</span> discr0 <span class="free">c</span> <span class="main">⟶</span> discr0 <span class="free">c'</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> MtransC_induct2<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> discr0_transC mustT_MtransC
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="During_Execution-discr0_transC_indis"><span class="command">lemma</span></span> discr0_transC_indis<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"discr0 <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"mustT <span class="free">c</span> <span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="free">c'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> <span class="free">s'</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> discr0.cases<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> ** <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="During_Execution-discr0_MtransC_indis"><span class="command">lemma</span></span> discr0_MtransC_indis<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"discr0 <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"mustT <span class="free">c</span> <span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="free">c'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> <span class="free">s'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="free">c'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span> <span class="main">⟹</span> mustT <span class="free">c</span> <span class="free">s</span> <span class="main">∧</span> discr0 <span class="free">c</span> <span class="main">⟶</span> <span class="free">s</span> <span class="main">≈</span> <span class="free">s'</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> MtransC_induct2<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> indis_refl<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> discr0_MtransC discr0_transC_indis indis_trans mustT_MtransC<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="During_Execution-discr0_transT"><span class="command">lemma</span></span> discr0_transT<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"discr0 <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"mustT <span class="free">c</span> <span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="free">s'</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> <span class="free">s'</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> discr0.cases<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> ** <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="During_Execution-discr0_MtransT"><span class="command">lemma</span></span> discr0_MtransT<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"discr0 <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ***<span class="main">:</span> <span class="quoted"><span class="quoted">"mustT <span class="free">c</span> <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="free">s'</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> <span class="free">s'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d'</span></span> <span class="skolem"><span class="skolem">t'</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  cs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="skolem">d'</span><span class="main">,</span><span class="skolem">t'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> d't'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">d'</span><span class="main">,</span><span class="skolem">t'</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="free">s'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ** <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> MtransT_invert2<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> <span class="skolem">t'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> * discr0_MtransC_indis *** <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> 
  <span class="keyword1"><span class="command">{</span></span><span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"discr0 <span class="skolem">d'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> cs * discr0_MtransC *** <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
   <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span> <span class="main">≈</span> <span class="free">s'</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> *** <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mustT_MtransC cs d't' discr0_transT<span class="main">)</span> 
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> indis_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span> 

<span class="keyword1" id="During_Execution-discr_discr0"><span class="command">lemma</span></span> discr_discr0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"discr <span class="free">c</span> <span class="main">⟹</span> discr0 <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> discr0_coind<span class="main">)</span>
     <span class="main">(</span><span class="operator">metis</span> discr_transC discr_transC_indis discr_transT<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Self-isomorphism›</span></span>  

<span class="keyword1"><span class="command">coinductive</span></span> <span class="entity">siso</span> <span class="keyword2"><span class="keyword">where</span></span> 
intro<span class="main">:</span> 
<span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">⋀</span> <span class="bound">s</span> <span class="bound">c'</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span><span class="bound">s'</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">siso</span> <span class="bound">c'</span><span class="main">;</span> 
  <span class="main">⋀</span> <span class="bound">s</span> <span class="bound">t</span> <span class="bound">c'</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">s</span> <span class="main">≈</span> <span class="bound">t</span><span class="main">;</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span><span class="bound">s'</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">∃</span> <span class="bound">t'</span><span class="main">.</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="bound">t</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span><span class="bound">t'</span><span class="main">)</span><span class="main">;</span>
  <span class="main">⋀</span> <span class="bound">s</span> <span class="bound">t</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">s</span> <span class="main">≈</span> <span class="bound">t</span><span class="main">;</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">s'</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">∃</span> <span class="bound">t'</span><span class="main">.</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="bound">t</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">t'</span><span class="main">⟧</span> 
  <span class="main">⟹</span> <span class="free">siso</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Coinduction for self-isomorphism:›</span></span>

<span class="keyword1" id="During_Execution-siso_coind"><span class="command">lemma</span></span> siso_coind<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">phi</span> <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
**<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">c</span> <span class="bound">s</span> <span class="bound">c'</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">⟦</span><span class="free">phi</span> <span class="bound">c</span><span class="main">;</span> <span class="main">(</span><span class="bound">c</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span><span class="bound">s'</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">phi</span> <span class="bound">c'</span> <span class="main">∨</span> siso <span class="bound">c'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
***<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">c</span> <span class="bound">s</span> <span class="bound">t</span> <span class="bound">c'</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">⟦</span><span class="free">phi</span> <span class="bound">c</span><span class="main">;</span> <span class="bound">s</span> <span class="main">≈</span> <span class="bound">t</span><span class="main">;</span> <span class="main">(</span><span class="bound">c</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span><span class="bound">s'</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">∃</span> <span class="bound">t'</span><span class="main">.</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">c</span><span class="main">,</span><span class="bound">t</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span><span class="bound">t'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
****<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">c</span> <span class="bound">s</span> <span class="bound">t</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">⟦</span><span class="free">phi</span> <span class="bound">c</span><span class="main">;</span> <span class="bound">s</span> <span class="main">≈</span> <span class="bound">t</span><span class="main">;</span> <span class="main">(</span><span class="bound">c</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">s'</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">∃</span> <span class="bound">t'</span><span class="main">.</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">c</span><span class="main">,</span><span class="bound">t</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">t'</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"siso <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> siso.coinduct<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> ** *** **** <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="During_Execution-siso_raw_coind"><span class="command">lemma</span></span> siso_raw_coind<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">phi</span> <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
**<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">c</span> <span class="bound">s</span> <span class="bound">c'</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">⟦</span><span class="free">phi</span> <span class="bound">c</span><span class="main">;</span> <span class="main">(</span><span class="bound">c</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span><span class="bound">s'</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">phi</span> <span class="bound">c'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
***<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">c</span> <span class="bound">s</span> <span class="bound">t</span> <span class="bound">c'</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">⟦</span><span class="free">phi</span> <span class="bound">c</span><span class="main">;</span> <span class="bound">s</span> <span class="main">≈</span> <span class="bound">t</span><span class="main">;</span> <span class="main">(</span><span class="bound">c</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span><span class="bound">s'</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">∃</span> <span class="bound">t'</span><span class="main">.</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">c</span><span class="main">,</span><span class="bound">t</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span><span class="bound">t'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
****<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">c</span> <span class="bound">s</span> <span class="bound">t</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">⟦</span><span class="free">phi</span> <span class="bound">c</span><span class="main">;</span> <span class="bound">s</span> <span class="main">≈</span> <span class="bound">t</span><span class="main">;</span> <span class="main">(</span><span class="bound">c</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">s'</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">∃</span> <span class="bound">t'</span><span class="main">.</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">c</span><span class="main">,</span><span class="bound">t</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">t'</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"siso <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> siso_coind<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> ** *** **** <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Self-Isomorphism versus transition:›</span></span>

<span class="keyword1" id="During_Execution-siso_transC"><span class="command">lemma</span></span> siso_transC<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"siso <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="free">c'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"siso <span class="free">c'</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> siso.cases<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> ** <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="During_Execution-siso_MtransC"><span class="command">lemma</span></span> siso_MtransC<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"siso <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="free">c'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"siso <span class="free">c'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="free">c'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span> <span class="main">⟹</span> siso <span class="free">c</span> <span class="main">⟶</span> siso <span class="free">c'</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> MtransC_induct2<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> siso_transC <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="During_Execution-siso_transC_indis"><span class="command">lemma</span></span> siso_transC_indis<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"siso <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="free">c'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ***<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> <span class="free">t</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">t'</span><span class="main">.</span> <span class="free">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="free">c'</span><span class="main">,</span><span class="bound">t'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> siso.cases<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> ** *** <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="During_Execution-siso_transT"><span class="command">lemma</span></span> siso_transT<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"siso <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="free">s'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ***<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> <span class="free">t</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">t'</span><span class="main">.</span> <span class="free">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">t'</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> siso.cases<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> ** *** <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹MustT-interactive self-isomorphism›</span></span>  

<span class="keyword1"><span class="command">coinductive</span></span> <span class="entity">siso0</span> <span class="keyword2"><span class="keyword">where</span></span> 
intro<span class="main">:</span> 
<span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">⋀</span> <span class="bound">s</span> <span class="bound">c'</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">⟦</span>mustT <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="bound">s</span><span class="main">;</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span><span class="bound">s'</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">siso0</span> <span class="bound">c'</span><span class="main">;</span> 
  <span class="main">⋀</span> <span class="bound">s</span> <span class="bound">t</span> <span class="bound">c'</span> <span class="bound">s'</span><span class="main">.</span> 
    <span class="main">⟦</span>mustT <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="bound">s</span><span class="main">;</span> mustT <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="bound">t</span><span class="main">;</span> <span class="bound">s</span> <span class="main">≈</span> <span class="bound">t</span><span class="main">;</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span><span class="bound">s'</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> 
    <span class="main">∃</span> <span class="bound">t'</span><span class="main">.</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="bound">t</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span><span class="bound">t'</span><span class="main">)</span><span class="main">;</span>
  <span class="main">⋀</span> <span class="bound">s</span> <span class="bound">t</span> <span class="bound">s'</span><span class="main">.</span> 
    <span class="main">⟦</span>mustT <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="bound">s</span><span class="main">;</span> mustT <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="bound">t</span><span class="main">;</span> <span class="bound">s</span> <span class="main">≈</span> <span class="bound">t</span><span class="main">;</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">s'</span><span class="main">⟧</span> <span class="main">⟹</span> 
    <span class="main">∃</span> <span class="bound">t'</span><span class="main">.</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="bound">t</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">t'</span><span class="main">⟧</span> 
  <span class="main">⟹</span> <span class="free">siso0</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Coinduction for self-isomorphism:›</span></span>

<span class="keyword1" id="During_Execution-siso0_coind"><span class="command">lemma</span></span> siso0_coind<span class="main">[</span><span class="operator">consumes</span> 1<span class="main">,</span> <span class="operator">case_names</span> Indef Cont Term<span class="main">,</span> <span class="operator">induct</span> <span class="quasi_keyword"><span class="quasi_keyword">pred</span></span><span class="main"><span class="main"><span class="main">:</span></span></span> discr0<span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">phi</span> <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
**<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">c</span> <span class="bound">s</span> <span class="bound">c'</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">⟦</span><span class="free">phi</span> <span class="bound">c</span><span class="main">;</span> mustT <span class="bound">c</span> <span class="bound">s</span><span class="main">;</span> <span class="main">(</span><span class="bound">c</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span><span class="bound">s'</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">phi</span> <span class="bound">c'</span> <span class="main">∨</span> siso0 <span class="bound">c'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
***<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">c</span> <span class="bound">s</span> <span class="bound">t</span> <span class="bound">c'</span> <span class="bound">s'</span><span class="main">.</span> 
        <span class="main">⟦</span><span class="free">phi</span> <span class="bound">c</span><span class="main">;</span> mustT <span class="bound">c</span> <span class="bound">s</span><span class="main">;</span> mustT <span class="bound">c</span> <span class="bound">t</span><span class="main">;</span> <span class="bound">s</span> <span class="main">≈</span> <span class="bound">t</span><span class="main">;</span> <span class="main">(</span><span class="bound">c</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span><span class="bound">s'</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> 
        <span class="main">∃</span> <span class="bound">t'</span><span class="main">.</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">c</span><span class="main">,</span><span class="bound">t</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span><span class="bound">t'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
****<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">c</span> <span class="bound">s</span> <span class="bound">t</span> <span class="bound">s'</span><span class="main">.</span> 
         <span class="main">⟦</span>mustT <span class="bound">c</span> <span class="bound">s</span><span class="main">;</span> mustT <span class="bound">c</span> <span class="bound">t</span><span class="main">;</span> <span class="free">phi</span> <span class="bound">c</span><span class="main">;</span> <span class="bound">s</span> <span class="main">≈</span> <span class="bound">t</span><span class="main">;</span> <span class="main">(</span><span class="bound">c</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">s'</span><span class="main">⟧</span> <span class="main">⟹</span> 
         <span class="main">∃</span> <span class="bound">t'</span><span class="main">.</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">c</span><span class="main">,</span><span class="bound">t</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">t'</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"siso0 <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> siso0.coinduct<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> ** *** **** <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="During_Execution-siso0_raw_coind"><span class="command">lemma</span></span> siso0_raw_coind<span class="main">[</span><span class="operator">consumes</span> 1<span class="main">,</span> <span class="operator">case_names</span> Indef Cont Term<span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">phi</span> <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
**<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">c</span> <span class="bound">s</span> <span class="bound">c'</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">⟦</span><span class="free">phi</span> <span class="bound">c</span><span class="main">;</span> mustT <span class="bound">c</span> <span class="bound">s</span><span class="main">;</span> <span class="main">(</span><span class="bound">c</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span><span class="bound">s'</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">phi</span> <span class="bound">c'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
***<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">c</span> <span class="bound">s</span> <span class="bound">t</span> <span class="bound">c'</span> <span class="bound">s'</span><span class="main">.</span> 
        <span class="main">⟦</span><span class="free">phi</span> <span class="bound">c</span><span class="main">;</span> mustT <span class="bound">c</span> <span class="bound">s</span><span class="main">;</span> mustT <span class="bound">c</span> <span class="bound">t</span><span class="main">;</span> <span class="bound">s</span> <span class="main">≈</span> <span class="bound">t</span><span class="main">;</span> <span class="main">(</span><span class="bound">c</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span><span class="bound">s'</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> 
        <span class="main">∃</span> <span class="bound">t'</span><span class="main">.</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">c</span><span class="main">,</span><span class="bound">t</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span><span class="bound">t'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
****<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">c</span> <span class="bound">s</span> <span class="bound">t</span> <span class="bound">s'</span><span class="main">.</span> 
         <span class="main">⟦</span><span class="free">phi</span> <span class="bound">c</span><span class="main">;</span> mustT <span class="bound">c</span> <span class="bound">s</span><span class="main">;</span> mustT <span class="bound">c</span> <span class="bound">t</span><span class="main">;</span> <span class="bound">s</span> <span class="main">≈</span> <span class="bound">t</span><span class="main">;</span> <span class="main">(</span><span class="bound">c</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">s'</span><span class="main">⟧</span> <span class="main">⟹</span> 
         <span class="main">∃</span> <span class="bound">t'</span><span class="main">.</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">c</span><span class="main">,</span><span class="bound">t</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">t'</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"siso0 <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> siso0_coind<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> ** *** **** <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Self-Isomorphism versus transition:›</span></span>

<span class="keyword1" id="During_Execution-siso0_transC"><span class="command">lemma</span></span> siso0_transC<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"siso0 <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"mustT <span class="free">c</span> <span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="free">c'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"siso0 <span class="free">c'</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> siso0.cases<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> ** <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="During_Execution-siso0_MtransC"><span class="command">lemma</span></span> siso0_MtransC<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"siso0 <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"mustT <span class="free">c</span> <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="free">c'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"siso0 <span class="free">c'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="free">c'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span> <span class="main">⟹</span> mustT <span class="free">c</span> <span class="free">s</span> <span class="main">∧</span> siso0 <span class="free">c</span> <span class="main">⟶</span> siso0 <span class="free">c'</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> MtransC_induct2<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> siso0_transC mustT_MtransC siso0_transC
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="During_Execution-siso0_transC_indis"><span class="command">lemma</span></span> siso0_transC_indis<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"siso0 <span class="free">c</span>"</span></span> 
<span class="keyword2"><span class="keyword">and</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"mustT <span class="free">c</span> <span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"mustT <span class="free">c</span> <span class="free">t</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="free">c'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span>"</span></span> 
<span class="keyword2"><span class="keyword">and</span></span> ***<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> <span class="free">t</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">t'</span><span class="main">.</span> <span class="free">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="free">c'</span><span class="main">,</span><span class="bound">t'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> siso0.cases<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> ** *** <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="During_Execution-siso0_transT"><span class="command">lemma</span></span> siso0_transT<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"siso0 <span class="free">c</span>"</span></span> 
<span class="keyword2"><span class="keyword">and</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"mustT <span class="free">c</span> <span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"mustT <span class="free">c</span> <span class="free">t</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="free">s'</span>"</span></span> 
<span class="keyword2"><span class="keyword">and</span></span> ***<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> <span class="free">t</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">t'</span><span class="main">.</span> <span class="free">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">t'</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> siso0.cases<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> ** *** <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Notions of bisimilarity›</span></span> 

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Matchers:›</span></span>

<span class="comment1">(* Notations and conventions:
\\- ``&lt;u&gt;_&lt;v&gt;" means: ``match u by v", where u, v can be: 
C (one continuation step), MC (multiple continuation steps), 
ZOC (zero or one continuation steps), 
T (termination step), MT (multiple steps leading to termination).   *)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">matchC_C</span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">matchC_C</span> <span class="free"><span class="bound"><span class="entity">theta</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">≡</span> 
 <span class="main">∀</span> <span class="bound">s</span> <span class="bound">t</span> <span class="bound">c'</span> <span class="bound">s'</span><span class="main">.</span> 
   <span class="bound">s</span> <span class="main">≈</span> <span class="bound">t</span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span><span class="bound">s'</span><span class="main">)</span> 
   <span class="main">⟶</span> 
   <span class="main">(</span><span class="main">∃</span> <span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span><span class="bound">t</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span><span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span><span class="bound">d'</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">theta</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">matchC_ZOC</span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">matchC_ZOC</span> <span class="free"><span class="bound"><span class="entity">theta</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">≡</span> 
 <span class="main">∀</span> <span class="bound">s</span> <span class="bound">t</span> <span class="bound">c'</span> <span class="bound">s'</span><span class="main">.</span> 
   <span class="bound">s</span> <span class="main">≈</span> <span class="bound">t</span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span><span class="bound">s'</span><span class="main">)</span> 
   <span class="main">⟶</span> 
   <span class="main">(</span><span class="bound">s'</span> <span class="main">≈</span> <span class="bound">t</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">theta</span></span></span><span class="main">)</span>
   <span class="main">∨</span> 
   <span class="main">(</span><span class="main">∃</span> <span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span><span class="bound">t</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span><span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span><span class="bound">d'</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">theta</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">matchC_ZO</span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">matchC_ZO</span> <span class="free"><span class="bound"><span class="entity">theta</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">≡</span> 
 <span class="main">∀</span> <span class="bound">s</span> <span class="bound">t</span> <span class="bound">c'</span> <span class="bound">s'</span><span class="main">.</span> 
   <span class="bound">s</span> <span class="main">≈</span> <span class="bound">t</span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span><span class="bound">s'</span><span class="main">)</span> 
   <span class="main">⟶</span> 
   <span class="main">(</span><span class="bound">s'</span> <span class="main">≈</span> <span class="bound">t</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">theta</span></span></span><span class="main">)</span>
   <span class="main">∨</span> 
   <span class="main">(</span><span class="main">∃</span> <span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span><span class="bound">t</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span><span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span><span class="bound">d'</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">theta</span></span></span><span class="main">)</span> 
   <span class="main">∨</span> 
   <span class="main">(</span><span class="main">∃</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span><span class="bound">t</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> discr <span class="bound">c'</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">matchT_T</span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">matchT_T</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">≡</span> 
 <span class="main">∀</span> <span class="bound">s</span> <span class="bound">t</span> <span class="bound">s'</span><span class="main">.</span> 
   <span class="bound">s</span> <span class="main">≈</span> <span class="bound">t</span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">s'</span> 
   <span class="main">⟶</span> 
   <span class="main">(</span><span class="main">∃</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span><span class="bound">t</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="bound">t'</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">matchT_ZO</span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">matchT_ZO</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">≡</span> 
 <span class="main">∀</span> <span class="bound">s</span> <span class="bound">t</span> <span class="bound">s'</span><span class="main">.</span> 
   <span class="bound">s</span> <span class="main">≈</span> <span class="bound">t</span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">s'</span> 
   <span class="main">⟶</span> 
   <span class="main">(</span><span class="bound">s'</span> <span class="main">≈</span> <span class="bound">t</span> <span class="main">∧</span> discr <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">)</span>
   <span class="main">∨</span> 
   <span class="main">(</span><span class="main">∃</span> <span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span><span class="bound">t</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span><span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> discr <span class="bound">d'</span><span class="main">)</span>
   <span class="main">∨</span> 
   <span class="main">(</span><span class="main">∃</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span><span class="bound">t</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="bound">t'</span><span class="main">)</span>"</span></span>

<span class="comment1">(*  *)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">matchC_MC</span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">matchC_MC</span> <span class="free"><span class="bound"><span class="entity">theta</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">≡</span> 
 <span class="main">∀</span> <span class="bound">s</span> <span class="bound">t</span> <span class="bound">c'</span> <span class="bound">s'</span><span class="main">.</span> 
   <span class="bound">s</span> <span class="main">≈</span> <span class="bound">t</span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span><span class="bound">s'</span><span class="main">)</span> 
   <span class="main">⟶</span> 
   <span class="main">(</span><span class="main">∃</span> <span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span><span class="bound">t</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span><span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span><span class="bound">d'</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">theta</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">matchC_TMC</span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">matchC_TMC</span> <span class="free"><span class="bound"><span class="entity">theta</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">≡</span> 
 <span class="main">∀</span> <span class="bound">s</span> <span class="bound">t</span> <span class="bound">c'</span> <span class="bound">s'</span><span class="main">.</span> 
   mustT <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="bound">s</span> <span class="main">∧</span> mustT <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">s</span> <span class="main">≈</span> <span class="bound">t</span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span><span class="bound">s'</span><span class="main">)</span> 
   <span class="main">⟶</span> 
   <span class="main">(</span><span class="main">∃</span> <span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span><span class="bound">t</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span><span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span><span class="bound">d'</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">theta</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">matchC_M</span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">matchC_M</span> <span class="free"><span class="bound"><span class="entity">theta</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">≡</span> 
 <span class="main">∀</span> <span class="bound">s</span> <span class="bound">t</span> <span class="bound">c'</span> <span class="bound">s'</span><span class="main">.</span> 
   <span class="bound">s</span> <span class="main">≈</span> <span class="bound">t</span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span><span class="bound">s'</span><span class="main">)</span> 
   <span class="main">⟶</span> 
   <span class="main">(</span><span class="main">∃</span> <span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span><span class="bound">t</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span><span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span><span class="bound">d'</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">theta</span></span></span><span class="main">)</span> 
   <span class="main">∨</span> 
   <span class="main">(</span><span class="main">∃</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span><span class="bound">t</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> discr <span class="bound">c'</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">matchT_MT</span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">matchT_MT</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">≡</span> 
 <span class="main">∀</span> <span class="bound">s</span> <span class="bound">t</span> <span class="bound">s'</span><span class="main">.</span> 
   <span class="bound">s</span> <span class="main">≈</span> <span class="bound">t</span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">s'</span> 
   <span class="main">⟶</span> 
   <span class="main">(</span><span class="main">∃</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span><span class="bound">t</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="bound">t'</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">matchT_TMT</span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">matchT_TMT</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">≡</span> 
 <span class="main">∀</span> <span class="bound">s</span> <span class="bound">t</span> <span class="bound">s'</span><span class="main">.</span> 
   mustT <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="bound">s</span> <span class="main">∧</span> mustT <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">s</span> <span class="main">≈</span> <span class="bound">t</span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">s'</span> 
   <span class="main">⟶</span> 
   <span class="main">(</span><span class="main">∃</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span><span class="bound">t</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="bound">t'</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">matchT_M</span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">matchT_M</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">≡</span> 
 <span class="main">∀</span> <span class="bound">s</span> <span class="bound">t</span> <span class="bound">s'</span><span class="main">.</span> 
   <span class="bound">s</span> <span class="main">≈</span> <span class="bound">t</span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">s'</span> 
   <span class="main">⟶</span> 
   <span class="main">(</span><span class="main">∃</span> <span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span><span class="bound">t</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span><span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> discr <span class="bound">d'</span><span class="main">)</span>
   <span class="main">∨</span> 
   <span class="main">(</span><span class="main">∃</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span><span class="bound">t</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="bound">t'</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> match_defs <span class="main">=</span> 
matchC_C_def 
matchC_ZOC_def matchC_ZO_def
matchT_T_def matchT_ZO_def
matchC_MC_def matchC_M_def
matchT_MT_def matchT_M_def
matchC_TMC_def matchT_TMT_def

<span class="comment1">(* For convenience, indis-symmetric variations of the above definitions: *)</span>

<span class="keyword1" id="During_Execution-matchC_C_def2"><span class="command">lemma</span></span> matchC_C_def2<span class="main">:</span> 
<span class="quoted"><span class="quoted">"matchC_C <span class="free">theta</span> <span class="free">d</span> <span class="free">c</span> <span class="main">=</span>
 <span class="main">(</span><span class="main">∀</span> <span class="bound">s</span> <span class="bound">t</span> <span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> 
   <span class="bound">s</span> <span class="main">≈</span> <span class="bound">t</span> <span class="main">∧</span> <span class="main">(</span><span class="free">d</span><span class="main">,</span><span class="bound">t</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span><span class="bound">t'</span><span class="main">)</span> 
   <span class="main">⟶</span> 
   <span class="main">(</span><span class="main">∃</span> <span class="bound">c'</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span><span class="bound">s'</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span><span class="bound">c'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">theta</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> matchC_C_def <span class="keyword1"><span class="command">using</span></span> indis_sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="During_Execution-matchC_ZOC_def2"><span class="command">lemma</span></span> matchC_ZOC_def2<span class="main">:</span>  
<span class="quoted"><span class="quoted">"matchC_ZOC <span class="free">theta</span> <span class="free">d</span> <span class="free">c</span><span class="main">=</span> 
 <span class="main">(</span><span class="main">∀</span> <span class="bound">s</span> <span class="bound">t</span> <span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> 
   <span class="bound">s</span> <span class="main">≈</span> <span class="bound">t</span> <span class="main">∧</span> <span class="main">(</span><span class="free">d</span><span class="main">,</span><span class="bound">t</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span><span class="bound">t'</span><span class="main">)</span> 
   <span class="main">⟶</span> 
   <span class="main">(</span><span class="bound">s</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span><span class="free">c</span><span class="main">)</span> <span class="main">∈</span> <span class="free">theta</span><span class="main">)</span>
   <span class="main">∨</span> 
   <span class="main">(</span><span class="main">∃</span> <span class="bound">c'</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span><span class="bound">s'</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span><span class="bound">c'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">theta</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> matchC_ZOC_def <span class="keyword1"><span class="command">using</span></span> indis_sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="During_Execution-matchC_ZO_def2"><span class="command">lemma</span></span> matchC_ZO_def2<span class="main">:</span>
<span class="quoted"><span class="quoted">"matchC_ZO <span class="free">theta</span> <span class="free">d</span> <span class="free">c</span> <span class="main">=</span> 
 <span class="main">(</span><span class="main">∀</span> <span class="bound">s</span> <span class="bound">t</span> <span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> 
   <span class="bound">s</span> <span class="main">≈</span> <span class="bound">t</span> <span class="main">∧</span> <span class="main">(</span><span class="free">d</span><span class="main">,</span><span class="bound">t</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span><span class="bound">t'</span><span class="main">)</span> 
   <span class="main">⟶</span> 
   <span class="main">(</span><span class="bound">s</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span><span class="free">c</span><span class="main">)</span> <span class="main">∈</span> <span class="free">theta</span><span class="main">)</span>
   <span class="main">∨</span> 
   <span class="main">(</span><span class="main">∃</span> <span class="bound">c'</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span><span class="bound">s'</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span><span class="bound">c'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">theta</span><span class="main">)</span> 
   <span class="main">∨</span> 
   <span class="main">(</span><span class="main">∃</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">s'</span> <span class="main">∧</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> discr <span class="bound">d'</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> matchC_ZO_def <span class="keyword1"><span class="command">using</span></span> indis_sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="During_Execution-matchT_T_def2"><span class="command">lemma</span></span> matchT_T_def2<span class="main">:</span>
<span class="quoted"><span class="quoted">"matchT_T <span class="free">d</span> <span class="free">c</span> <span class="main">=</span> 
 <span class="main">(</span><span class="main">∀</span> <span class="bound">s</span> <span class="bound">t</span> <span class="bound">t'</span><span class="main">.</span> 
   <span class="bound">s</span> <span class="main">≈</span> <span class="bound">t</span> <span class="main">∧</span> <span class="main">(</span><span class="free">d</span><span class="main">,</span><span class="bound">t</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">t'</span> 
   <span class="main">⟶</span> 
   <span class="main">(</span><span class="main">∃</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">s'</span> <span class="main">∧</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="bound">t'</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> matchT_T_def <span class="keyword1"><span class="command">using</span></span> indis_sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="During_Execution-matchT_ZO_def2"><span class="command">lemma</span></span> matchT_ZO_def2<span class="main">:</span>
<span class="quoted"><span class="quoted">"matchT_ZO <span class="free">d</span> <span class="free">c</span> <span class="main">=</span> 
 <span class="main">(</span><span class="main">∀</span> <span class="bound">s</span> <span class="bound">t</span> <span class="bound">t'</span><span class="main">.</span> 
   <span class="bound">s</span> <span class="main">≈</span> <span class="bound">t</span> <span class="main">∧</span> <span class="main">(</span><span class="free">d</span><span class="main">,</span><span class="bound">t</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">t'</span> 
   <span class="main">⟶</span> 
   <span class="main">(</span><span class="bound">s</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> discr <span class="free">c</span><span class="main">)</span>
   <span class="main">∨</span> 
   <span class="main">(</span><span class="main">∃</span> <span class="bound">c'</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span><span class="bound">s'</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> discr <span class="bound">c'</span><span class="main">)</span>
   <span class="main">∨</span> 
   <span class="main">(</span><span class="main">∃</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">s'</span> <span class="main">∧</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="bound">t'</span><span class="main">)</span><span class="main">)</span>"</span></span>    
<span class="keyword1"><span class="command">unfolding</span></span> matchT_ZO_def <span class="keyword1"><span class="command">using</span></span> indis_sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="comment1">(*  *)</span>

<span class="keyword1" id="During_Execution-matchC_MC_def2"><span class="command">lemma</span></span> matchC_MC_def2<span class="main">:</span>  
<span class="quoted"><span class="quoted">"matchC_MC <span class="free">theta</span> <span class="free">d</span> <span class="free">c</span><span class="main">=</span> 
 <span class="main">(</span><span class="main">∀</span> <span class="bound">s</span> <span class="bound">t</span> <span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> 
   <span class="bound">s</span> <span class="main">≈</span> <span class="bound">t</span> <span class="main">∧</span> <span class="main">(</span><span class="free">d</span><span class="main">,</span><span class="bound">t</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span><span class="bound">t'</span><span class="main">)</span> 
   <span class="main">⟶</span> 
   <span class="main">(</span><span class="main">∃</span> <span class="bound">c'</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span><span class="bound">s'</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span><span class="bound">c'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">theta</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> matchC_MC_def <span class="keyword1"><span class="command">using</span></span> indis_sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="During_Execution-matchC_TMC_def2"><span class="command">lemma</span></span> matchC_TMC_def2<span class="main">:</span>  
<span class="quoted"><span class="quoted">"matchC_TMC <span class="free">theta</span> <span class="free">d</span> <span class="free">c</span><span class="main">=</span> 
 <span class="main">(</span><span class="main">∀</span> <span class="bound">s</span> <span class="bound">t</span> <span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> 
   mustT <span class="free">c</span> <span class="bound">s</span> <span class="main">∧</span> mustT <span class="free">d</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">s</span> <span class="main">≈</span> <span class="bound">t</span> <span class="main">∧</span> <span class="main">(</span><span class="free">d</span><span class="main">,</span><span class="bound">t</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span><span class="bound">t'</span><span class="main">)</span> 
   <span class="main">⟶</span> 
   <span class="main">(</span><span class="main">∃</span> <span class="bound">c'</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span><span class="bound">s'</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span><span class="bound">c'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">theta</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> matchC_TMC_def <span class="keyword1"><span class="command">using</span></span> indis_sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="During_Execution-matchC_M_def2"><span class="command">lemma</span></span> matchC_M_def2<span class="main">:</span>
<span class="quoted"><span class="quoted">"matchC_M <span class="free">theta</span> <span class="free">d</span> <span class="free">c</span> <span class="main">=</span> 
 <span class="main">(</span><span class="main">∀</span> <span class="bound">s</span> <span class="bound">t</span> <span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> 
   <span class="bound">s</span> <span class="main">≈</span> <span class="bound">t</span> <span class="main">∧</span> <span class="main">(</span><span class="free">d</span><span class="main">,</span><span class="bound">t</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span><span class="bound">t'</span><span class="main">)</span> 
   <span class="main">⟶</span> 
   <span class="main">(</span><span class="main">∃</span> <span class="bound">c'</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span><span class="bound">s'</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span><span class="bound">c'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">theta</span><span class="main">)</span> 
   <span class="main">∨</span> 
   <span class="main">(</span><span class="main">∃</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="bound">s'</span> <span class="main">∧</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> discr <span class="bound">d'</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> matchC_M_def <span class="keyword1"><span class="command">using</span></span> indis_sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="During_Execution-matchT_MT_def2"><span class="command">lemma</span></span> matchT_MT_def2<span class="main">:</span>
<span class="quoted"><span class="quoted">"matchT_MT <span class="free">d</span> <span class="free">c</span> <span class="main">=</span> 
 <span class="main">(</span><span class="main">∀</span> <span class="bound">s</span> <span class="bound">t</span> <span class="bound">t'</span><span class="main">.</span> 
   <span class="bound">s</span> <span class="main">≈</span> <span class="bound">t</span> <span class="main">∧</span> <span class="main">(</span><span class="free">d</span><span class="main">,</span><span class="bound">t</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">t'</span> 
   <span class="main">⟶</span> 
   <span class="main">(</span><span class="main">∃</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="bound">s'</span> <span class="main">∧</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="bound">t'</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> matchT_MT_def <span class="keyword1"><span class="command">using</span></span> indis_sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="During_Execution-matchT_TMT_def2"><span class="command">lemma</span></span> matchT_TMT_def2<span class="main">:</span>
<span class="quoted"><span class="quoted">"matchT_TMT <span class="free">d</span> <span class="free">c</span> <span class="main">=</span> 
 <span class="main">(</span><span class="main">∀</span> <span class="bound">s</span> <span class="bound">t</span> <span class="bound">t'</span><span class="main">.</span> 
   mustT <span class="free">c</span> <span class="bound">s</span> <span class="main">∧</span> mustT <span class="free">d</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">s</span> <span class="main">≈</span> <span class="bound">t</span> <span class="main">∧</span> <span class="main">(</span><span class="free">d</span><span class="main">,</span><span class="bound">t</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">t'</span> 
   <span class="main">⟶</span> 
   <span class="main">(</span><span class="main">∃</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="bound">s'</span> <span class="main">∧</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="bound">t'</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> matchT_TMT_def <span class="keyword1"><span class="command">using</span></span> indis_sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="During_Execution-matchT_M_def2"><span class="command">lemma</span></span> matchT_M_def2<span class="main">:</span>
<span class="quoted"><span class="quoted">"matchT_M <span class="free">d</span> <span class="free">c</span> <span class="main">=</span> 
 <span class="main">(</span><span class="main">∀</span> <span class="bound">s</span> <span class="bound">t</span> <span class="bound">t'</span><span class="main">.</span> 
   <span class="bound">s</span> <span class="main">≈</span> <span class="bound">t</span> <span class="main">∧</span> <span class="main">(</span><span class="free">d</span><span class="main">,</span><span class="bound">t</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">t'</span> 
   <span class="main">⟶</span> 
   <span class="main">(</span><span class="main">∃</span> <span class="bound">c'</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span><span class="bound">s'</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> discr <span class="bound">c'</span><span class="main">)</span>
   <span class="main">∨</span> 
   <span class="main">(</span><span class="main">∃</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="bound">s'</span> <span class="main">∧</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="bound">t'</span><span class="main">)</span><span class="main">)</span>"</span></span>    
<span class="keyword1"><span class="command">unfolding</span></span> matchT_M_def <span class="keyword1"><span class="command">using</span></span> indis_sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Retracts:›</span></span>

<span class="comment1">(* Strong retract: *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Sretr</span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">Sretr</span> <span class="free"><span class="bound"><span class="entity">theta</span></span></span> <span class="main">≡</span> 
 <span class="main">{</span><span class="main">(</span><span class="bound">c</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span><span class="main">.</span> 
    matchC_C <span class="free"><span class="bound"><span class="entity">theta</span></span></span> <span class="bound">c</span> <span class="bound">d</span> <span class="main">∧</span> 
    matchT_T <span class="bound">c</span> <span class="bound">d</span><span class="main">}</span>"</span></span>

<span class="comment1">(* Zero-one retract: *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ZOretr</span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">ZOretr</span> <span class="free"><span class="bound"><span class="entity">theta</span></span></span> <span class="main">≡</span> 
 <span class="main">{</span><span class="main">(</span><span class="bound">c</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span><span class="main">.</span> 
    matchC_ZO <span class="free"><span class="bound"><span class="entity">theta</span></span></span> <span class="bound">c</span> <span class="bound">d</span> <span class="main">∧</span> 
    matchT_ZO <span class="bound">c</span> <span class="bound">d</span><span class="main">}</span>"</span></span>

<span class="comment1">(* Zero-one termination-sensitive retract: *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ZOretrT</span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">ZOretrT</span> <span class="free"><span class="bound"><span class="entity">theta</span></span></span> <span class="main">≡</span> 
 <span class="main">{</span><span class="main">(</span><span class="bound">c</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span><span class="main">.</span> 
    matchC_ZOC <span class="free"><span class="bound"><span class="entity">theta</span></span></span> <span class="bound">c</span> <span class="bound">d</span> <span class="main">∧</span> 
    matchT_T <span class="bound">c</span> <span class="bound">d</span><span class="main">}</span>"</span></span>

<span class="comment1">(* Weak retract: *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Wretr</span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">Wretr</span> <span class="free"><span class="bound"><span class="entity">theta</span></span></span> <span class="main">≡</span> 
 <span class="main">{</span><span class="main">(</span><span class="bound">c</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span><span class="main">.</span> 
    matchC_M <span class="free"><span class="bound"><span class="entity">theta</span></span></span> <span class="bound">c</span> <span class="bound">d</span> <span class="main">∧</span> 
    matchT_M <span class="bound">c</span> <span class="bound">d</span> <span class="main">}</span>"</span></span>

<span class="comment1">(* Weak termination-sensitive retract: *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">WretrT</span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">WretrT</span> <span class="free"><span class="bound"><span class="entity">theta</span></span></span> <span class="main">≡</span> 
 <span class="main">{</span><span class="main">(</span><span class="bound">c</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span><span class="main">.</span> 
    matchC_MC <span class="free"><span class="bound"><span class="entity">theta</span></span></span> <span class="bound">c</span> <span class="bound">d</span> <span class="main">∧</span> 
    matchT_MT <span class="bound">c</span> <span class="bound">d</span><span class="main">}</span>"</span></span>

<span class="comment1">(* Weak terminating-interactive termination-sensitive retract: *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">RetrT</span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">RetrT</span> <span class="free"><span class="bound"><span class="entity">theta</span></span></span> <span class="main">≡</span> 
 <span class="main">{</span><span class="main">(</span><span class="bound">c</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span><span class="main">.</span> 
    matchC_TMC <span class="free"><span class="bound"><span class="entity">theta</span></span></span> <span class="bound">c</span> <span class="bound">d</span> <span class="main">∧</span> 
    matchT_TMT <span class="bound">c</span> <span class="bound">d</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> Retr_defs <span class="main">=</span> 
Sretr_def 
ZOretr_def ZOretrT_def 
Wretr_def WretrT_def 
RetrT_def

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The associated bisimilarity relations:›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Sbis</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Sbis</span> <span class="main">≡</span> bis Sretr"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ZObis</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">ZObis</span> <span class="main">≡</span> bis ZOretr"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ZObisT</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">ZObisT</span> <span class="main">≡</span> bis ZOretrT"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Wbis</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Wbis</span> <span class="main">≡</span> bis Wretr"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">WbisT</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">WbisT</span> <span class="main">≡</span> bis WretrT"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">BisT</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">BisT</span> <span class="main">≡</span> bis RetrT"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> bis_defs <span class="main">=</span> 
Sbis_def 
ZObis_def ZObisT_def 
Wbis_def WbisT_def 
BisT_def

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">Sbis_abbrev</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">≈s</span>"</span> 55<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="keyword1"><span class="free">≈s</span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span> <span class="main">∈</span> Sbis"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">ZObis_abbrev</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">≈01</span>"</span> 55<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="main"><span class="free">≈01</span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span> <span class="main">∈</span> ZObis"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">ZObisT_abbrev</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">≈01T</span>"</span> 55<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="keyword1"><span class="free">≈01T</span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span> <span class="main">∈</span> ZObisT"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">Wbis_abbrev</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">≈w</span>"</span> 55<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="keyword1"><span class="free">≈w</span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span> <span class="main">∈</span> Wbis"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">WbisT_abbrev</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">≈wT</span>"</span> 55<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="keyword1"><span class="free">≈wT</span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span> <span class="main">∈</span> WbisT"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">BisT_abbrev</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">≈T</span>"</span> 55<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="keyword1"><span class="free">≈T</span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span> <span class="main">∈</span> BisT"</span></span>


<span class="keyword1" id="During_Execution-mono_Retr"><span class="command">lemma</span></span> mono_Retr<span class="main">:</span>
<span class="quoted"><span class="quoted">"mono Sretr"</span></span>
<span class="quoted"><span class="quoted">"mono ZOretr"</span></span>  <span class="quoted"><span class="quoted">"mono ZOretrT"</span></span>
<span class="quoted"><span class="quoted">"mono Wretr"</span></span>  <span class="quoted"><span class="quoted">"mono WretrT"</span></span>
<span class="quoted"><span class="quoted">"mono RetrT"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> mono_def Retr_defs match_defs <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

<span class="comment1">(* Sbis: *)</span>
<span class="keyword1" id="During_Execution-Sbis_prefix"><span class="command">lemma</span></span> Sbis_prefix<span class="main">:</span>
<span class="quoted"><span class="quoted">"Sbis <span class="main">⊆</span> Sretr Sbis"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> Sbis_def <span class="keyword1"><span class="command">using</span></span> mono_Retr bis_prefix <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="During_Execution-Sbis_sym"><span class="command">lemma</span></span> Sbis_sym<span class="main">:</span> <span class="quoted"><span class="quoted">"sym Sbis"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> Sbis_def <span class="keyword1"><span class="command">using</span></span> mono_Retr sym_bis <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="During_Execution-Sbis_Sym"><span class="command">lemma</span></span> Sbis_Sym<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="keyword1">≈s</span> <span class="free">d</span> <span class="main">⟹</span> <span class="free">d</span> <span class="keyword1">≈s</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> Sbis_sym <span class="keyword1"><span class="command">unfolding</span></span> sym_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="During_Execution-Sbis_converse"><span class="command">lemma</span></span> Sbis_converse<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">d</span><span class="main">)</span> <span class="main">∈</span> <span class="free">theta</span><span class="main">^-1</span> <span class="main">∪</span> Sbis<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">d</span><span class="main">,</span><span class="free">c</span><span class="main">)</span> <span class="main">∈</span> <span class="free">theta</span> <span class="main">∪</span> Sbis<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Sbis_sym converseI converse_Un converse_converse sym_conv_converse_eq<span class="main">)</span>

<span class="keyword1" id="During_Execution-Sbis_matchC_C"><span class="command">lemma</span></span>
Sbis_matchC_C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> <span class="free">c</span> <span class="keyword1">≈s</span> <span class="free">d</span> <span class="main">⟹</span> matchC_C Sbis <span class="free">c</span> <span class="free">d</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> 
Sbis_matchT_T<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">.</span> <span class="bound">c</span> <span class="keyword1">≈s</span> <span class="bound">d</span> <span class="main">⟹</span> matchT_T <span class="bound">c</span> <span class="bound">d</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> Sbis_prefix <span class="keyword1"><span class="command">unfolding</span></span> Sretr_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemmas</span></span> Sbis_step <span class="main">=</span> Sbis_matchC_C Sbis_matchT_T

<span class="keyword1" id="During_Execution-Sbis_matchC_C_rev"><span class="command">lemma</span></span>
Sbis_matchC_C_rev<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> <span class="bound">s</span> <span class="keyword1">≈s</span> <span class="bound">t</span> <span class="main">⟹</span> matchC_C Sbis <span class="bound">t</span> <span class="bound">s</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> 
Sbis_matchT_T_rev<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> <span class="bound">s</span> <span class="keyword1">≈s</span> <span class="bound">t</span> <span class="main">⟹</span> matchT_T <span class="bound">t</span> <span class="bound">s</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> Sbis_step Sbis_sym <span class="keyword1"><span class="command">unfolding</span></span> sym_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> Sbis_step_rev <span class="main">=</span> Sbis_matchC_C_rev Sbis_matchT_T_rev

<span class="keyword1" id="During_Execution-Sbis_coind"><span class="command">lemma</span></span> Sbis_coind<span class="main">:</span>  
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sym <span class="free">theta</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">theta</span> <span class="main">⊆</span> Sretr <span class="main">(</span><span class="free">theta</span> <span class="main">∪</span> Sbis<span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">theta</span> <span class="main">⊆</span> Sbis"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms mono_Retr bis_coind 
<span class="keyword1"><span class="command">unfolding</span></span> Sbis_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="During_Execution-Sbis_raw_coind"><span class="command">lemma</span></span> Sbis_raw_coind<span class="main">:</span>  
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sym <span class="free">theta</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">theta</span> <span class="main">⊆</span> Sretr <span class="free">theta</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">theta</span> <span class="main">⊆</span> Sbis"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms mono_Retr bis_raw_coind 
<span class="keyword1"><span class="command">unfolding</span></span> Sbis_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="During_Execution-Sbis_coind2"><span class="command">lemma</span></span> Sbis_coind2<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">theta</span> <span class="main">⊆</span> Sretr <span class="main">(</span><span class="free">theta</span> <span class="main">∪</span> Sbis<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">theta</span> <span class="main">^-1</span> <span class="main">⊆</span> Sretr <span class="main">(</span><span class="main">(</span><span class="free">theta</span> <span class="main">^-1</span><span class="main">)</span> <span class="main">∪</span> Sbis<span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">theta</span> <span class="main">⊆</span> Sbis"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms mono_Retr bis_coind2 
<span class="keyword1"><span class="command">unfolding</span></span> Sbis_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="During_Execution-Sbis_raw_coind2"><span class="command">lemma</span></span> Sbis_raw_coind2<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">theta</span> <span class="main">⊆</span> Sretr <span class="free">theta</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">theta</span> <span class="main">^-1</span> <span class="main">⊆</span> Sretr <span class="main">(</span><span class="free">theta</span> <span class="main">^-1</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">theta</span> <span class="main">⊆</span> Sbis"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms mono_Retr bis_raw_coind2 
<span class="keyword1"><span class="command">unfolding</span></span> Sbis_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="comment1">(* ZObis: *)</span>
<span class="keyword1" id="During_Execution-ZObis_prefix"><span class="command">lemma</span></span> ZObis_prefix<span class="main">:</span>
<span class="quoted"><span class="quoted">"ZObis <span class="main">⊆</span> ZOretr ZObis"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> ZObis_def <span class="keyword1"><span class="command">using</span></span> mono_Retr bis_prefix <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="During_Execution-ZObis_sym"><span class="command">lemma</span></span> ZObis_sym<span class="main">:</span> <span class="quoted"><span class="quoted">"sym ZObis"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> ZObis_def <span class="keyword1"><span class="command">using</span></span> mono_Retr sym_bis <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="During_Execution-ZObis_converse"><span class="command">lemma</span></span> ZObis_converse<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">d</span><span class="main">)</span> <span class="main">∈</span> <span class="free">theta</span><span class="main">^-1</span> <span class="main">∪</span> ZObis<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">d</span><span class="main">,</span><span class="free">c</span><span class="main">)</span> <span class="main">∈</span> <span class="free">theta</span> <span class="main">∪</span> ZObis<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ZObis_sym converseI converse_Un converse_converse sym_conv_converse_eq<span class="main">)</span>

<span class="keyword1" id="During_Execution-ZObis_Sym"><span class="command">lemma</span></span> ZObis_Sym<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈01</span> <span class="free">t</span> <span class="main">⟹</span> <span class="free">t</span> <span class="main">≈01</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> ZObis_sym <span class="keyword1"><span class="command">unfolding</span></span> sym_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="During_Execution-ZObis_matchC_ZO"><span class="command">lemma</span></span>
ZObis_matchC_ZO<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> <span class="bound">s</span> <span class="main">≈01</span> <span class="bound">t</span> <span class="main">⟹</span> matchC_ZO ZObis <span class="bound">s</span> <span class="bound">t</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> 
ZObis_matchT_ZO<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> <span class="bound">s</span> <span class="main">≈01</span> <span class="bound">t</span> <span class="main">⟹</span> matchT_ZO <span class="bound">s</span> <span class="bound">t</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> ZObis_prefix <span class="keyword1"><span class="command">unfolding</span></span> ZOretr_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemmas</span></span> ZObis_step <span class="main">=</span> ZObis_matchC_ZO ZObis_matchT_ZO 

<span class="keyword1" id="During_Execution-ZObis_matchC_ZO_rev"><span class="command">lemma</span></span>
ZObis_matchC_ZO_rev<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> <span class="bound">s</span> <span class="main">≈01</span> <span class="bound">t</span> <span class="main">⟹</span> matchC_ZO ZObis <span class="bound">t</span> <span class="bound">s</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> 
ZObis_matchT_ZO_rev<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> <span class="bound">s</span> <span class="main">≈01</span> <span class="bound">t</span> <span class="main">⟹</span> matchT_ZO <span class="bound">t</span> <span class="bound">s</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> ZObis_step ZObis_sym <span class="keyword1"><span class="command">unfolding</span></span> sym_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> ZObis_step_rev <span class="main">=</span> ZObis_matchC_ZO_rev ZObis_matchT_ZO_rev

<span class="keyword1" id="During_Execution-ZObis_coind"><span class="command">lemma</span></span> ZObis_coind<span class="main">:</span>  
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sym <span class="free">theta</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">theta</span> <span class="main">⊆</span> ZOretr <span class="main">(</span><span class="free">theta</span> <span class="main">∪</span> ZObis<span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">theta</span> <span class="main">⊆</span> ZObis"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms mono_Retr bis_coind 
<span class="keyword1"><span class="command">unfolding</span></span> ZObis_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="During_Execution-ZObis_raw_coind"><span class="command">lemma</span></span> ZObis_raw_coind<span class="main">:</span>  
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sym <span class="free">theta</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">theta</span> <span class="main">⊆</span> ZOretr <span class="free">theta</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">theta</span> <span class="main">⊆</span> ZObis"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms mono_Retr bis_raw_coind 
<span class="keyword1"><span class="command">unfolding</span></span> ZObis_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="During_Execution-ZObis_coind2"><span class="command">lemma</span></span> ZObis_coind2<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">theta</span> <span class="main">⊆</span> ZOretr <span class="main">(</span><span class="free">theta</span> <span class="main">∪</span> ZObis<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">theta</span> <span class="main">^-1</span> <span class="main">⊆</span> ZOretr <span class="main">(</span><span class="main">(</span><span class="free">theta</span> <span class="main">^-1</span><span class="main">)</span> <span class="main">∪</span> ZObis<span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">theta</span> <span class="main">⊆</span> ZObis"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms mono_Retr bis_coind2 
<span class="keyword1"><span class="command">unfolding</span></span> ZObis_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="During_Execution-ZObis_raw_coind2"><span class="command">lemma</span></span> ZObis_raw_coind2<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">theta</span> <span class="main">⊆</span> ZOretr <span class="free">theta</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">theta</span> <span class="main">^-1</span> <span class="main">⊆</span> ZOretr <span class="main">(</span><span class="free">theta</span> <span class="main">^-1</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">theta</span> <span class="main">⊆</span> ZObis"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms mono_Retr bis_raw_coind2 
<span class="keyword1"><span class="command">unfolding</span></span> ZObis_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="comment1">(* ZObisT: *)</span>
<span class="keyword1" id="During_Execution-ZObisT_prefix"><span class="command">lemma</span></span> ZObisT_prefix<span class="main">:</span>
<span class="quoted"><span class="quoted">"ZObisT <span class="main">⊆</span> ZOretrT ZObisT"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> ZObisT_def <span class="keyword1"><span class="command">using</span></span> mono_Retr bis_prefix <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="During_Execution-ZObisT_sym"><span class="command">lemma</span></span> ZObisT_sym<span class="main">:</span> <span class="quoted"><span class="quoted">"sym ZObisT"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> ZObisT_def <span class="keyword1"><span class="command">using</span></span> mono_Retr sym_bis <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="During_Execution-ZObisT_Sym"><span class="command">lemma</span></span> ZObisT_Sym<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="keyword1">≈01T</span> <span class="free">t</span> <span class="main">⟹</span> <span class="free">t</span> <span class="keyword1">≈01T</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> ZObisT_sym <span class="keyword1"><span class="command">unfolding</span></span> sym_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="During_Execution-ZObisT_converse"><span class="command">lemma</span></span> ZObisT_converse<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">d</span><span class="main">)</span> <span class="main">∈</span> <span class="free">theta</span><span class="main">^-1</span> <span class="main">∪</span> ZObisT<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">d</span><span class="main">,</span><span class="free">c</span><span class="main">)</span> <span class="main">∈</span> <span class="free">theta</span> <span class="main">∪</span> ZObisT<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ZObisT_sym converseI converse_Un converse_converse sym_conv_converse_eq<span class="main">)</span>

<span class="keyword1" id="During_Execution-ZObisT_matchC_ZOC"><span class="command">lemma</span></span>
ZObisT_matchC_ZOC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> <span class="bound">s</span> <span class="keyword1">≈01T</span> <span class="bound">t</span> <span class="main">⟹</span> matchC_ZOC ZObisT <span class="bound">s</span> <span class="bound">t</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> 
ZObisT_matchT_T<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> <span class="bound">s</span> <span class="keyword1">≈01T</span> <span class="bound">t</span> <span class="main">⟹</span> matchT_T <span class="bound">s</span> <span class="bound">t</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> ZObisT_prefix <span class="keyword1"><span class="command">unfolding</span></span> ZOretrT_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemmas</span></span> ZObisT_step <span class="main">=</span> ZObisT_matchC_ZOC ZObisT_matchT_T

<span class="keyword1" id="During_Execution-ZObisT_matchC_ZOC_rev"><span class="command">lemma</span></span>
ZObisT_matchC_ZOC_rev<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> <span class="bound">s</span> <span class="keyword1">≈01T</span> <span class="bound">t</span> <span class="main">⟹</span> matchC_ZOC ZObisT <span class="bound">t</span> <span class="bound">s</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> 
ZObisT_matchT_T_rev<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> <span class="bound">s</span> <span class="keyword1">≈01T</span> <span class="bound">t</span> <span class="main">⟹</span> matchT_T <span class="bound">t</span> <span class="bound">s</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> ZObisT_step ZObisT_sym <span class="keyword1"><span class="command">unfolding</span></span> sym_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> ZObisT_step_rev <span class="main">=</span> ZObisT_matchC_ZOC_rev ZObisT_matchT_T_rev 

<span class="keyword1" id="During_Execution-ZObisT_coind"><span class="command">lemma</span></span> ZObisT_coind<span class="main">:</span>  
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sym <span class="free">theta</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">theta</span> <span class="main">⊆</span> ZOretrT <span class="main">(</span><span class="free">theta</span> <span class="main">∪</span> ZObisT<span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">theta</span> <span class="main">⊆</span> ZObisT"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms mono_Retr bis_coind 
<span class="keyword1"><span class="command">unfolding</span></span> ZObisT_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="During_Execution-ZObisT_raw_coind"><span class="command">lemma</span></span> ZObisT_raw_coind<span class="main">:</span>  
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sym <span class="free">theta</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">theta</span> <span class="main">⊆</span> ZOretrT <span class="free">theta</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">theta</span> <span class="main">⊆</span> ZObisT"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms mono_Retr bis_raw_coind 
<span class="keyword1"><span class="command">unfolding</span></span> ZObisT_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="During_Execution-ZObisT_coind2"><span class="command">lemma</span></span> ZObisT_coind2<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">theta</span> <span class="main">⊆</span> ZOretrT <span class="main">(</span><span class="free">theta</span> <span class="main">∪</span> ZObisT<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">theta</span> <span class="main">^-1</span> <span class="main">⊆</span> ZOretrT <span class="main">(</span><span class="main">(</span><span class="free">theta</span> <span class="main">^-1</span><span class="main">)</span> <span class="main">∪</span> ZObisT<span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">theta</span> <span class="main">⊆</span> ZObisT"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms mono_Retr bis_coind2 
<span class="keyword1"><span class="command">unfolding</span></span> ZObisT_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="During_Execution-ZObisT_raw_coind2"><span class="command">lemma</span></span> ZObisT_raw_coind2<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">theta</span> <span class="main">⊆</span> ZOretrT <span class="free">theta</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">theta</span> <span class="main">^-1</span> <span class="main">⊆</span> ZOretrT <span class="main">(</span><span class="free">theta</span> <span class="main">^-1</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">theta</span> <span class="main">⊆</span> ZObisT"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms mono_Retr bis_raw_coind2 
<span class="keyword1"><span class="command">unfolding</span></span> ZObisT_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="comment1">(* Wbis: *)</span>
<span class="keyword1" id="During_Execution-Wbis_prefix"><span class="command">lemma</span></span> Wbis_prefix<span class="main">:</span>
<span class="quoted"><span class="quoted">"Wbis <span class="main">⊆</span> Wretr Wbis"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> Wbis_def <span class="keyword1"><span class="command">using</span></span> mono_Retr bis_prefix <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="During_Execution-Wbis_sym"><span class="command">lemma</span></span> Wbis_sym<span class="main">:</span> <span class="quoted"><span class="quoted">"sym Wbis"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> Wbis_def <span class="keyword1"><span class="command">using</span></span> mono_Retr sym_bis <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="During_Execution-Wbis_converse"><span class="command">lemma</span></span> Wbis_converse<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">d</span><span class="main">)</span> <span class="main">∈</span> <span class="free">theta</span><span class="main">^-1</span> <span class="main">∪</span> Wbis<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">d</span><span class="main">,</span><span class="free">c</span><span class="main">)</span> <span class="main">∈</span> <span class="free">theta</span> <span class="main">∪</span> Wbis<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Wbis_sym converseI converse_Un converse_converse sym_conv_converse_eq<span class="main">)</span>

<span class="keyword1" id="During_Execution-Wbis_Sym"><span class="command">lemma</span></span> Wbis_Sym<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="keyword1">≈w</span> <span class="free">d</span> <span class="main">⟹</span> <span class="free">d</span> <span class="keyword1">≈w</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> Wbis_sym <span class="keyword1"><span class="command">unfolding</span></span> sym_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="During_Execution-Wbis_matchC_M"><span class="command">lemma</span></span>
Wbis_matchC_M<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">.</span> <span class="bound">c</span> <span class="keyword1">≈w</span> <span class="bound">d</span> <span class="main">⟹</span> matchC_M Wbis <span class="bound">c</span> <span class="bound">d</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> 
Wbis_matchT_M<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">.</span> <span class="bound">c</span> <span class="keyword1">≈w</span> <span class="bound">d</span> <span class="main">⟹</span> matchT_M <span class="bound">c</span> <span class="bound">d</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> Wbis_prefix <span class="keyword1"><span class="command">unfolding</span></span> Wretr_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemmas</span></span> Wbis_step <span class="main">=</span> Wbis_matchC_M Wbis_matchT_M 

<span class="keyword1" id="During_Execution-Wbis_matchC_M_rev"><span class="command">lemma</span></span>
Wbis_matchC_M_rev<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> <span class="bound">s</span> <span class="keyword1">≈w</span> <span class="bound">t</span> <span class="main">⟹</span> matchC_M Wbis <span class="bound">t</span> <span class="bound">s</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> 
Wbis_matchT_M_rev<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> <span class="bound">s</span> <span class="keyword1">≈w</span> <span class="bound">t</span> <span class="main">⟹</span> matchT_M <span class="bound">t</span> <span class="bound">s</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> Wbis_step Wbis_sym <span class="keyword1"><span class="command">unfolding</span></span> sym_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> Wbis_step_rev <span class="main">=</span> Wbis_matchC_M_rev Wbis_matchT_M_rev

<span class="keyword1" id="During_Execution-Wbis_coind"><span class="command">lemma</span></span> Wbis_coind<span class="main">:</span>  
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sym <span class="free">theta</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">theta</span> <span class="main">⊆</span> Wretr <span class="main">(</span><span class="free">theta</span> <span class="main">∪</span> Wbis<span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">theta</span> <span class="main">⊆</span> Wbis"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms mono_Retr bis_coind 
<span class="keyword1"><span class="command">unfolding</span></span> Wbis_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="During_Execution-Wbis_raw_coind"><span class="command">lemma</span></span> Wbis_raw_coind<span class="main">:</span>  
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sym <span class="free">theta</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">theta</span> <span class="main">⊆</span> Wretr <span class="free">theta</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">theta</span> <span class="main">⊆</span> Wbis"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms mono_Retr bis_raw_coind 
<span class="keyword1"><span class="command">unfolding</span></span> Wbis_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="During_Execution-Wbis_coind2"><span class="command">lemma</span></span> Wbis_coind2<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">theta</span> <span class="main">⊆</span> Wretr <span class="main">(</span><span class="free">theta</span> <span class="main">∪</span> Wbis<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">theta</span> <span class="main">^-1</span> <span class="main">⊆</span> Wretr <span class="main">(</span><span class="main">(</span><span class="free">theta</span> <span class="main">^-1</span><span class="main">)</span> <span class="main">∪</span> Wbis<span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">theta</span> <span class="main">⊆</span> Wbis"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms mono_Retr bis_coind2 
<span class="keyword1"><span class="command">unfolding</span></span> Wbis_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="During_Execution-Wbis_raw_coind2"><span class="command">lemma</span></span> Wbis_raw_coind2<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">theta</span> <span class="main">⊆</span> Wretr <span class="free">theta</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">theta</span> <span class="main">^-1</span> <span class="main">⊆</span> Wretr <span class="main">(</span><span class="free">theta</span> <span class="main">^-1</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">theta</span> <span class="main">⊆</span> Wbis"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms mono_Retr bis_raw_coind2 
<span class="keyword1"><span class="command">unfolding</span></span> Wbis_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="comment1">(* WbisT: *)</span>
<span class="keyword1" id="During_Execution-WbisT_prefix"><span class="command">lemma</span></span> WbisT_prefix<span class="main">:</span>
<span class="quoted"><span class="quoted">"WbisT <span class="main">⊆</span> WretrT WbisT"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> WbisT_def <span class="keyword1"><span class="command">using</span></span> mono_Retr bis_prefix <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="During_Execution-WbisT_sym"><span class="command">lemma</span></span> WbisT_sym<span class="main">:</span> <span class="quoted"><span class="quoted">"sym WbisT"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> WbisT_def <span class="keyword1"><span class="command">using</span></span> mono_Retr sym_bis <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="During_Execution-WbisT_Sym"><span class="command">lemma</span></span> WbisT_Sym<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="keyword1">≈wT</span> <span class="free">d</span> <span class="main">⟹</span> <span class="free">d</span> <span class="keyword1">≈wT</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> WbisT_sym <span class="keyword1"><span class="command">unfolding</span></span> sym_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="During_Execution-WbisT_converse"><span class="command">lemma</span></span> WbisT_converse<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">d</span><span class="main">)</span> <span class="main">∈</span> <span class="free">theta</span><span class="main">^-1</span> <span class="main">∪</span> WbisT<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">d</span><span class="main">,</span><span class="free">c</span><span class="main">)</span> <span class="main">∈</span> <span class="free">theta</span> <span class="main">∪</span> WbisT<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> WbisT_sym converseI converse_Un converse_converse sym_conv_converse_eq<span class="main">)</span>

<span class="keyword1" id="During_Execution-WbisT_matchC_MC"><span class="command">lemma</span></span>
WbisT_matchC_MC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">.</span> <span class="bound">c</span> <span class="keyword1">≈wT</span> <span class="bound">d</span> <span class="main">⟹</span> matchC_MC WbisT <span class="bound">c</span> <span class="bound">d</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> 
WbisT_matchT_MT<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">.</span> <span class="bound">c</span> <span class="keyword1">≈wT</span> <span class="bound">d</span> <span class="main">⟹</span> matchT_MT <span class="bound">c</span> <span class="bound">d</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> WbisT_prefix <span class="keyword1"><span class="command">unfolding</span></span> WretrT_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemmas</span></span> WbisT_step <span class="main">=</span> WbisT_matchC_MC WbisT_matchT_MT

<span class="keyword1" id="During_Execution-WbisT_matchC_MC_rev"><span class="command">lemma</span></span>
WbisT_matchC_MC_rev<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> <span class="bound">s</span> <span class="keyword1">≈wT</span> <span class="bound">t</span> <span class="main">⟹</span> matchC_MC WbisT <span class="bound">t</span> <span class="bound">s</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> 
WbisT_matchT_MT_rev<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> <span class="bound">s</span> <span class="keyword1">≈wT</span> <span class="bound">t</span> <span class="main">⟹</span> matchT_MT <span class="bound">t</span> <span class="bound">s</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> WbisT_step WbisT_sym <span class="keyword1"><span class="command">unfolding</span></span> sym_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> WbisT_step_rev <span class="main">=</span> WbisT_matchC_MC_rev WbisT_matchT_MT_rev 

<span class="keyword1" id="During_Execution-WbisT_coind"><span class="command">lemma</span></span> WbisT_coind<span class="main">:</span>  
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sym <span class="free">theta</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">theta</span> <span class="main">⊆</span> WretrT <span class="main">(</span><span class="free">theta</span> <span class="main">∪</span> WbisT<span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">theta</span> <span class="main">⊆</span> WbisT"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms mono_Retr bis_coind 
<span class="keyword1"><span class="command">unfolding</span></span> WbisT_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="During_Execution-WbisT_raw_coind"><span class="command">lemma</span></span> WbisT_raw_coind<span class="main">:</span>  
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sym <span class="free">theta</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">theta</span> <span class="main">⊆</span> WretrT <span class="free">theta</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">theta</span> <span class="main">⊆</span> WbisT"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms mono_Retr bis_raw_coind 
<span class="keyword1"><span class="command">unfolding</span></span> WbisT_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="During_Execution-WbisT_coind2"><span class="command">lemma</span></span> WbisT_coind2<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">theta</span> <span class="main">⊆</span> WretrT <span class="main">(</span><span class="free">theta</span> <span class="main">∪</span> WbisT<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">theta</span> <span class="main">^-1</span> <span class="main">⊆</span> WretrT <span class="main">(</span><span class="main">(</span><span class="free">theta</span> <span class="main">^-1</span><span class="main">)</span> <span class="main">∪</span> WbisT<span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">theta</span> <span class="main">⊆</span> WbisT"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms mono_Retr bis_coind2 
<span class="keyword1"><span class="command">unfolding</span></span> WbisT_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="During_Execution-WbisT_raw_coind2"><span class="command">lemma</span></span> WbisT_raw_coind2<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">theta</span> <span class="main">⊆</span> WretrT <span class="free">theta</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">theta</span> <span class="main">^-1</span> <span class="main">⊆</span> WretrT <span class="main">(</span><span class="free">theta</span> <span class="main">^-1</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">theta</span> <span class="main">⊆</span> WbisT"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms mono_Retr bis_raw_coind2 
<span class="keyword1"><span class="command">unfolding</span></span> WbisT_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="During_Execution-WbisT_coinduct"><span class="command">lemma</span></span> WbisT_coinduct<span class="main">[</span><span class="operator">consumes</span> 1<span class="main">,</span> <span class="operator">case_names</span> sym cont termi<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> φ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="free">c</span> <span class="free">d</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">c</span> <span class="bound">d</span><span class="main">.</span> <span class="free">φ</span> <span class="bound">c</span> <span class="bound">d</span> <span class="main">⟹</span> <span class="free">φ</span> <span class="bound">d</span> <span class="bound">c</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">c</span> <span class="bound">s</span> <span class="bound">d</span> <span class="bound">t</span> <span class="bound">c'</span> <span class="bound">s'</span><span class="main">.</span>
    <span class="main">⟦</span> <span class="free">φ</span> <span class="bound">c</span> <span class="bound">d</span> <span class="main">;</span> <span class="bound">s</span> <span class="main">≈</span> <span class="bound">t</span> <span class="main">;</span> <span class="main">(</span><span class="bound">c</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="bound">d</span><span class="main">,</span> <span class="bound">t</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="main">(</span><span class="free">φ</span> <span class="bound">c'</span> <span class="bound">d'</span> <span class="main">∨</span> <span class="bound">c'</span> <span class="keyword1">≈wT</span> <span class="bound">d'</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> T<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">c</span> <span class="bound">s</span> <span class="bound">d</span> <span class="bound">t</span> <span class="bound">s'</span><span class="main">.</span>
    <span class="main">⟦</span> <span class="free">φ</span> <span class="bound">c</span> <span class="bound">d</span> <span class="main">;</span> <span class="bound">s</span> <span class="main">≈</span> <span class="bound">t</span> <span class="main">;</span> <span class="main">(</span><span class="bound">c</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">s'</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="bound">d</span><span class="main">,</span> <span class="bound">t</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="bound">t'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="keyword1">≈wT</span> <span class="free">d</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?θ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">c</span><span class="main">,</span> <span class="bound">d</span><span class="main">)</span><span class="main">.</span> <span class="free">φ</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sym <span class="var">?θ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> symI S<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?θ</span> <span class="main">⊆</span> WretrT <span class="main">(</span><span class="var">?θ</span> <span class="main">∪</span> WbisT<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> C T <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> WretrT_def matchC_MC_def matchT_MT_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?θ</span> <span class="main">⊆</span> WbisT"</span></span>
    <span class="keyword1"><span class="command">using</span></span> WbisT_coind <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> φ <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* BisT: *)</span>
<span class="keyword1" id="During_Execution-BisT_prefix"><span class="command">lemma</span></span> BisT_prefix<span class="main">:</span>
<span class="quoted"><span class="quoted">"BisT <span class="main">⊆</span> RetrT BisT"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> BisT_def <span class="keyword1"><span class="command">using</span></span> mono_Retr bis_prefix <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="During_Execution-BisT_sym"><span class="command">lemma</span></span> BisT_sym<span class="main">:</span> <span class="quoted"><span class="quoted">"sym BisT"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> BisT_def <span class="keyword1"><span class="command">using</span></span> mono_Retr sym_bis <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="During_Execution-BisT_Sym"><span class="command">lemma</span></span> BisT_Sym<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="keyword1">≈T</span> <span class="free">d</span> <span class="main">⟹</span> <span class="free">d</span> <span class="keyword1">≈T</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> BisT_sym <span class="keyword1"><span class="command">unfolding</span></span> sym_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="During_Execution-BisT_converse"><span class="command">lemma</span></span> BisT_converse<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">d</span><span class="main">)</span> <span class="main">∈</span> <span class="free">theta</span><span class="main">^-1</span> <span class="main">∪</span> BisT<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">d</span><span class="main">,</span><span class="free">c</span><span class="main">)</span> <span class="main">∈</span> <span class="free">theta</span> <span class="main">∪</span> BisT<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> BisT_sym converseI converse_Un converse_converse sym_conv_converse_eq<span class="main">)</span>

<span class="keyword1" id="During_Execution-BisT_matchC_TMC"><span class="command">lemma</span></span>
BisT_matchC_TMC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">.</span> <span class="bound">c</span> <span class="keyword1">≈T</span> <span class="bound">d</span> <span class="main">⟹</span> matchC_TMC BisT <span class="bound">c</span> <span class="bound">d</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> 
BisT_matchT_TMT<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">.</span> <span class="bound">c</span> <span class="keyword1">≈T</span> <span class="bound">d</span> <span class="main">⟹</span> matchT_TMT <span class="bound">c</span> <span class="bound">d</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> BisT_prefix <span class="keyword1"><span class="command">unfolding</span></span> RetrT_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemmas</span></span> BisT_step <span class="main">=</span> BisT_matchC_TMC BisT_matchT_TMT

<span class="keyword1" id="During_Execution-BisT_matchC_TMC_rev"><span class="command">lemma</span></span>
BisT_matchC_TMC_rev<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">.</span> <span class="bound">c</span> <span class="keyword1">≈T</span> <span class="bound">d</span> <span class="main">⟹</span> matchC_TMC BisT <span class="bound">d</span> <span class="bound">c</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> 
BisT_matchT_TMT_rev<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">.</span> <span class="bound">c</span> <span class="keyword1">≈T</span> <span class="bound">d</span> <span class="main">⟹</span> matchT_TMT <span class="bound">d</span> <span class="bound">c</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> BisT_step BisT_sym <span class="keyword1"><span class="command">unfolding</span></span> sym_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> BisT_step_rev <span class="main">=</span> BisT_matchC_TMC_rev BisT_matchT_TMT_rev 

<span class="keyword1" id="During_Execution-BisT_coind"><span class="command">lemma</span></span> BisT_coind<span class="main">:</span>  
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sym <span class="free">theta</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">theta</span> <span class="main">⊆</span> RetrT <span class="main">(</span><span class="free">theta</span> <span class="main">∪</span> BisT<span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">theta</span> <span class="main">⊆</span> BisT"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms mono_Retr bis_coind 
<span class="keyword1"><span class="command">unfolding</span></span> BisT_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="During_Execution-BisT_raw_coind"><span class="command">lemma</span></span> BisT_raw_coind<span class="main">:</span>  
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sym <span class="free">theta</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">theta</span> <span class="main">⊆</span> RetrT <span class="free">theta</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">theta</span> <span class="main">⊆</span> BisT"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms mono_Retr bis_raw_coind 
<span class="keyword1"><span class="command">unfolding</span></span> BisT_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="During_Execution-BisT_coind2"><span class="command">lemma</span></span> BisT_coind2<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">theta</span> <span class="main">⊆</span> RetrT <span class="main">(</span><span class="free">theta</span> <span class="main">∪</span> BisT<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">theta</span> <span class="main">^-1</span> <span class="main">⊆</span> RetrT <span class="main">(</span><span class="main">(</span><span class="free">theta</span> <span class="main">^-1</span><span class="main">)</span> <span class="main">∪</span> BisT<span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">theta</span> <span class="main">⊆</span> BisT"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms mono_Retr bis_coind2 
<span class="keyword1"><span class="command">unfolding</span></span> BisT_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="During_Execution-BisT_raw_coind2"><span class="command">lemma</span></span> BisT_raw_coind2<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">theta</span> <span class="main">⊆</span> RetrT <span class="free">theta</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">theta</span> <span class="main">^-1</span> <span class="main">⊆</span> RetrT <span class="main">(</span><span class="free">theta</span> <span class="main">^-1</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">theta</span> <span class="main">⊆</span> BisT"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms mono_Retr bis_raw_coind2 
<span class="keyword1"><span class="command">unfolding</span></span> BisT_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Inclusions between bisimilarities:›</span></span>

<span class="keyword1" id="During_Execution-match_imp"><span class="command">lemma</span></span> match_imp<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">theta</span> <span class="bound">c1</span> <span class="bound">c2</span><span class="main">.</span> matchC_C <span class="bound">theta</span> <span class="bound">c1</span> <span class="bound">c2</span> <span class="main">⟹</span> matchC_ZOC <span class="bound">theta</span> <span class="bound">c1</span> <span class="bound">c2</span>"</span></span>
<span class="comment1">(*  *)</span>
<span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">theta</span> <span class="bound">c1</span> <span class="bound">c2</span><span class="main">.</span> matchC_ZOC <span class="bound">theta</span> <span class="bound">c1</span> <span class="bound">c2</span> <span class="main">⟹</span> matchC_ZO <span class="bound">theta</span> <span class="bound">c1</span> <span class="bound">c2</span>"</span></span>
<span class="comment1">(*  *)</span>
<span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">theta</span> <span class="bound">c1</span> <span class="bound">c2</span><span class="main">.</span> matchC_ZOC <span class="bound">theta</span> <span class="bound">c1</span> <span class="bound">c2</span> <span class="main">⟹</span> matchC_MC <span class="bound">theta</span> <span class="bound">c1</span> <span class="bound">c2</span>"</span></span>
<span class="comment1">(*  *)</span>
<span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">theta</span> <span class="bound">c1</span> <span class="bound">c2</span><span class="main">.</span> matchC_ZO <span class="bound">theta</span> <span class="bound">c1</span> <span class="bound">c2</span> <span class="main">⟹</span> matchC_M <span class="bound">theta</span> <span class="bound">c1</span> <span class="bound">c2</span>"</span></span>
<span class="comment1">(*  *)</span>
<span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">theta</span> <span class="bound">c1</span> <span class="bound">c2</span><span class="main">.</span> matchC_MC <span class="bound">theta</span> <span class="bound">c1</span> <span class="bound">c2</span> <span class="main">⟹</span> matchC_M <span class="bound">theta</span> <span class="bound">c1</span> <span class="bound">c2</span>"</span></span>
<span class="comment1">(*  *)</span>
<span class="comment1">(*  *)</span>
<span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">c1</span> <span class="bound">c2</span><span class="main">.</span> matchT_T <span class="bound">c1</span> <span class="bound">c2</span> <span class="main">⟹</span> matchT_ZO <span class="bound">c1</span> <span class="bound">c2</span>"</span></span>
<span class="comment1">(*  *)</span>
<span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">c1</span> <span class="bound">c2</span><span class="main">.</span> matchT_T <span class="bound">c1</span> <span class="bound">c2</span> <span class="main">⟹</span> matchT_MT <span class="bound">c1</span> <span class="bound">c2</span>"</span></span>
<span class="comment1">(*  *)</span>
<span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">c1</span> <span class="bound">c2</span><span class="main">.</span> matchT_ZO <span class="bound">c1</span> <span class="bound">c2</span> <span class="main">⟹</span> matchT_M <span class="bound">c1</span> <span class="bound">c2</span>"</span></span>
<span class="comment1">(*  *)</span>
<span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">c1</span> <span class="bound">c2</span><span class="main">.</span> matchT_MT <span class="bound">c1</span> <span class="bound">c2</span> <span class="main">⟹</span> matchT_M <span class="bound">c1</span> <span class="bound">c2</span>"</span></span>
<span class="comment1">(*  *)</span>
<span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">theta</span> <span class="bound">c1</span> <span class="bound">c2</span><span class="main">.</span> matchC_MC <span class="bound">theta</span> <span class="bound">c1</span> <span class="bound">c2</span> <span class="main">⟹</span> matchC_TMC <span class="bound">theta</span> <span class="bound">c1</span> <span class="bound">c2</span>"</span></span>
<span class="comment1">(*  *)</span>
<span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">theta</span> <span class="bound">c1</span> <span class="bound">c2</span><span class="main">.</span> matchT_MT <span class="bound">c1</span> <span class="bound">c2</span> <span class="main">⟹</span> matchT_TMT <span class="bound">c1</span> <span class="bound">c2</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> match_defs <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="entity">mauto_no_simp_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> MtransC_Refl transC_MtransC<span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="During_Execution-Retr_incl"><span class="command">lemma</span></span> Retr_incl<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">theta</span><span class="main">.</span> Sretr <span class="bound">theta</span> <span class="main">⊆</span> ZOretrT <span class="bound">theta</span>"</span></span>
<span class="comment1">(*  *)</span>
<span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">theta</span><span class="main">.</span> ZOretrT <span class="bound">theta</span> <span class="main">⊆</span> ZOretr <span class="bound">theta</span>"</span></span>
<span class="comment1">(*  *)</span>
<span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">theta</span><span class="main">.</span> ZOretrT <span class="bound">theta</span> <span class="main">⊆</span> WretrT <span class="bound">theta</span>"</span></span>
<span class="comment1">(*  *)</span>
<span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">theta</span><span class="main">.</span> ZOretr <span class="bound">theta</span> <span class="main">⊆</span> Wretr <span class="bound">theta</span>"</span></span>
<span class="comment1">(*  *)</span>
<span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">theta</span><span class="main">.</span> WretrT <span class="bound">theta</span> <span class="main">⊆</span> Wretr <span class="bound">theta</span>"</span></span>
<span class="comment1">(*  *)</span>
<span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">theta</span><span class="main">.</span> WretrT <span class="bound">theta</span> <span class="main">⊆</span> RetrT <span class="bound">theta</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> Retr_defs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="During_Execution-bis_incl"><span class="command">lemma</span></span> bis_incl<span class="main">:</span>
<span class="quoted"><span class="quoted">"Sbis <span class="main">⊆</span> ZObisT"</span></span>
<span class="comment1">(*  *)</span>
<span class="quoted"><span class="quoted">"ZObisT <span class="main">⊆</span> ZObis"</span></span>
<span class="comment1">(*  *)</span>
<span class="quoted"><span class="quoted">"ZObisT <span class="main">⊆</span> WbisT"</span></span>
<span class="comment1">(*  *)</span>
<span class="quoted"><span class="quoted">"ZObis <span class="main">⊆</span> Wbis"</span></span>
<span class="comment1">(*  *)</span>
<span class="quoted"><span class="quoted">"WbisT <span class="main">⊆</span> Wbis"</span></span>
<span class="comment1">(*  *)</span>
<span class="quoted"><span class="quoted">"WbisT <span class="main">⊆</span> BisT"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> bis_defs 
<span class="keyword1"><span class="command">using</span></span> Retr_incl mono_bis mono_Retr <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="During_Execution-bis_imp"><span class="command">lemma</span></span> bis_imp<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">c1</span> <span class="bound">c2</span><span class="main">.</span> <span class="bound">c1</span> <span class="keyword1">≈s</span> <span class="bound">c2</span> <span class="main">⟹</span> <span class="bound">c1</span> <span class="keyword1">≈01T</span> <span class="bound">c2</span>"</span></span>
<span class="comment1">(*  *)</span>
<span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">c1</span> <span class="bound">c2</span><span class="main">.</span> <span class="bound">c1</span> <span class="keyword1">≈01T</span> <span class="bound">c2</span> <span class="main">⟹</span> <span class="bound">c1</span> <span class="main">≈01</span> <span class="bound">c2</span>"</span></span>
<span class="comment1">(*  *)</span>
<span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">c1</span> <span class="bound">c2</span><span class="main">.</span> <span class="bound">c1</span> <span class="keyword1">≈01T</span> <span class="bound">c2</span> <span class="main">⟹</span> <span class="bound">c1</span> <span class="keyword1">≈wT</span> <span class="bound">c2</span>"</span></span>
<span class="comment1">(*  *)</span>
<span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">c1</span> <span class="bound">c2</span><span class="main">.</span> <span class="bound">c1</span> <span class="main">≈01</span> <span class="bound">c2</span> <span class="main">⟹</span> <span class="bound">c1</span> <span class="keyword1">≈w</span> <span class="bound">c2</span>"</span></span>
<span class="comment1">(*  *)</span>
<span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">c1</span> <span class="bound">c2</span><span class="main">.</span> <span class="bound">c1</span> <span class="keyword1">≈wT</span> <span class="bound">c2</span> <span class="main">⟹</span> <span class="bound">c1</span> <span class="keyword1">≈w</span> <span class="bound">c2</span>"</span></span>
<span class="comment1">(*  *)</span>
<span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">c1</span> <span class="bound">c2</span><span class="main">.</span> <span class="bound">c1</span> <span class="keyword1">≈wT</span> <span class="bound">c2</span> <span class="main">⟹</span> <span class="bound">c1</span> <span class="keyword1">≈T</span> <span class="bound">c2</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> bis_incl rev_subsetD <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Self-isomorphism implies strong bisimilarity:›</span></span>

<span class="keyword1" id="During_Execution-siso_Sbis"><span class="command">lemma</span></span> siso_Sbis<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"siso <span class="free">c</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="keyword1">≈s</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?theta</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">c</span><span class="main">,</span><span class="bound">c</span><span class="main">)</span> <span class="main">|</span> <span class="bound">c</span> <span class="main">.</span> siso <span class="bound">c</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?theta</span> <span class="main">⊆</span> Sbis"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> Sbis_raw_coind<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sym <span class="var">?theta</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sym_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?theta</span> <span class="main">⊆</span> Sretr <span class="var">?theta</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">clarify</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span> <span class="keyword3"><span class="command">assume</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"siso <span class="skolem">c</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c</span><span class="main">,</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">∈</span> Sretr <span class="var">?theta</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> Sretr_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"matchC_C <span class="var">?theta</span> <span class="skolem">c</span> <span class="skolem">c</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> matchC_C_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> c siso_transC siso_transC_indis<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"matchT_T <span class="skolem">c</span> <span class="skolem">c</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> matchT_T_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> c siso_transT<span class="main">)</span>           
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹0-Self-isomorphism implies weak T 0-bisimilarity:›</span></span>

<span class="keyword1" id="During_Execution-siso0_Sbis"><span class="command">lemma</span></span> siso0_Sbis<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"siso0 <span class="free">c</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="keyword1">≈T</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?theta</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">c</span><span class="main">,</span><span class="bound">c</span><span class="main">)</span> <span class="main">|</span> <span class="bound">c</span> <span class="main">.</span> siso0 <span class="bound">c</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?theta</span> <span class="main">⊆</span> BisT"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> BisT_raw_coind<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sym <span class="var">?theta</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sym_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?theta</span> <span class="main">⊆</span> RetrT <span class="var">?theta</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">clarify</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span> <span class="keyword3"><span class="command">assume</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"siso0 <span class="skolem">c</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c</span><span class="main">,</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">∈</span> RetrT <span class="var">?theta</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> RetrT_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"matchC_TMC <span class="var">?theta</span> <span class="skolem">c</span> <span class="skolem">c</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> matchC_TMC_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> c siso0_transC siso0_transC_indis transC_MtransC<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"matchT_TMT <span class="skolem">c</span> <span class="skolem">c</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> matchC_TMC_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> c matchT_TMT_def siso0_transT transT_MtransT<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>
 

<span class="keyword2"><span class="keyword">end</span></span> 
<span class="comment1">(* context PL_Indis *)</span>


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Compositionality">
<div class="head">
<h1>Theory Compositionality</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Compasitionality of the during-execution security notions›</span></span> 

<span class="keyword1"><span class="command">theory</span></span> Compositionality <span class="keyword2"><span class="keyword">imports</span></span> <a href="#During_Execution">During_Execution</a> <span class="keyword2"><span class="keyword">begin</span></span>


<span class="comment1">(*******************************************)</span>
<span class="keyword1"><span class="command">context</span></span> PL_Indis 
<span class="keyword2"><span class="keyword">begin</span></span> 

<span class="comment1">(* The end-product compositionality results are listed as theorems 
(as opposed to lemmas). *)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Discreetness versus language constructs:›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> discr_Atm<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"discr <span class="main">(</span>Atm <span class="free">atm</span><span class="main">)</span> <span class="main">=</span> presAtm <span class="free">atm</span>"</span></span>  
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>    
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span>
   <span class="keyword1"><span class="command">have</span></span> 
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span> <span class="bound">atm</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">=</span> Atm <span class="bound">atm</span> <span class="main">∧</span> presAtm <span class="bound">atm</span><span class="main">)</span> 
    <span class="main">⟹</span> discr <span class="skolem">c</span>"</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> discr_coind<span class="main">)</span> 
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Atm_transC_invert<span class="main">)</span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> PL.Atm_transT_invert presAtm_def<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"discr <span class="main">(</span>Atm <span class="free">atm</span><span class="main">)</span> <span class="main">⟹</span> presAtm <span class="free">atm</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Atm presAtm_def discr_transT<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> discr_If<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"discr <span class="free">c1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"discr <span class="free">c2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"discr <span class="main">(</span>If <span class="free">tst</span> <span class="free">c1</span> <span class="free">c2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>    
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span>
   <span class="keyword1"><span class="command">have</span></span> 
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span> <span class="bound">tst</span> <span class="bound">c1</span> <span class="bound">c2</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">=</span> If <span class="bound">tst</span> <span class="bound">c1</span> <span class="bound">c2</span> <span class="main">∧</span> discr <span class="bound">c1</span> <span class="main">∧</span> discr <span class="bound">c2</span><span class="main">)</span> <span class="main">⟹</span> discr <span class="skolem">c</span>"</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> discr_coind<span class="main">)</span> 
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> PL.If_transC_invert indis_refl<span class="main">)</span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> If_transT_invert<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> discr_Seq<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"discr <span class="free">c1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"discr <span class="free">c2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"discr <span class="main">(</span><span class="free">c1</span> <span class="main">;;</span> <span class="free">c2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span>
   <span class="keyword1"><span class="command">have</span></span> 
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span> <span class="bound">c1</span> <span class="bound">c2</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">=</span> <span class="bound">c1</span> <span class="main">;;</span> <span class="bound">c2</span> <span class="main">∧</span> discr <span class="bound">c1</span> <span class="main">∧</span> discr <span class="bound">c2</span><span class="main">)</span> 
    <span class="main">⟹</span> discr <span class="skolem">c</span>"</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> discr_coind<span class="main">)</span> 
   <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">tactic</span><span class="quoted">‹<span class="entity">clarify_all_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span>
     <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span> <span class="skolem">s</span> <span class="skolem">c'</span> <span class="skolem">s'</span> <span class="skolem">c1</span> <span class="skolem">c2</span>
     <span class="keyword3"><span class="command">assume</span></span> c1<span class="main">:</span> <span class="quoted"><span class="quoted">"discr <span class="skolem">c1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c2<span class="main">:</span> <span class="quoted"><span class="quoted">"discr <span class="skolem">c2</span>"</span></span> 
     <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span> <span class="main">;;</span> <span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
     <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≈</span> <span class="skolem">s'</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="main">∃</span><span class="bound">c1</span> <span class="bound">c2</span><span class="main">.</span> <span class="skolem">c'</span> <span class="main">=</span> <span class="bound">c1</span> <span class="main">;;</span> <span class="bound">c2</span> <span class="main">∧</span> discr <span class="bound">c1</span> <span class="main">∧</span> discr <span class="bound">c2</span><span class="main">)</span> <span class="main">∨</span> discr <span class="skolem">c'</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> Seq_transC_invert<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> c1 c2 discr_transC discr_transC_indis<span class="main">)</span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> c1 c2 discr.cases<span class="main">)</span>
   <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> Seq_transT_invert<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> discr_While<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"discr <span class="free">c</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"discr <span class="main">(</span>While <span class="free">tst</span> <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span>
   <span class="keyword1"><span class="command">have</span></span> 
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span> <span class="bound">tst</span> <span class="bound">d</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">=</span> While <span class="bound">tst</span> <span class="bound">d</span> <span class="main">∧</span> discr <span class="bound">d</span><span class="main">)</span> <span class="main">∨</span> 
    <span class="main">(</span><span class="main">∃</span> <span class="bound">tst</span> <span class="bound">d1</span> <span class="bound">d</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">=</span> <span class="bound">d1</span> <span class="main">;;</span> <span class="main">(</span>While <span class="bound">tst</span> <span class="bound">d</span><span class="main">)</span> <span class="main">∧</span> discr <span class="bound">d1</span> <span class="main">∧</span> discr <span class="bound">d</span><span class="main">)</span>
    <span class="main">⟹</span> discr <span class="skolem">c</span>"</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> discr_coind<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="entity">mauto_no_simp_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> While_transC_invert indis_refl<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Seq_transC_invert discr.cases<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> While_transC_invert<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Seq_transC_invert discr.cases<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> PL.While_transT_invert indis_refl<span class="main">)</span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Seq_transT_invert<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> discr_Par<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"discr <span class="free">c1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"discr <span class="free">c2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"discr <span class="main">(</span>Par <span class="free">c1</span> <span class="free">c2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span>
   <span class="keyword1"><span class="command">have</span></span> 
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span> <span class="bound">c1</span> <span class="bound">c2</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">=</span> Par <span class="bound">c1</span> <span class="bound">c2</span> <span class="main">∧</span> discr <span class="bound">c1</span> <span class="main">∧</span> discr <span class="bound">c2</span><span class="main">)</span> 
    <span class="main">⟹</span> discr <span class="skolem">c</span>"</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> discr_coind<span class="main">)</span> 
   <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">tactic</span><span class="quoted">‹<span class="entity">clarify_all_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span>
     <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span> <span class="skolem">s</span> <span class="skolem">c'</span> <span class="skolem">s'</span> <span class="skolem">c1</span> <span class="skolem">c2</span>
     <span class="keyword3"><span class="command">assume</span></span> c1<span class="main">:</span> <span class="quoted"><span class="quoted">"discr <span class="skolem">c1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c2<span class="main">:</span> <span class="quoted"><span class="quoted">"discr <span class="skolem">c2</span>"</span></span> 
     <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Par <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
     <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≈</span> <span class="skolem">s'</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="main">∃</span><span class="bound">c1</span> <span class="bound">c2</span><span class="main">.</span> <span class="skolem">c'</span> <span class="main">=</span> Par <span class="bound">c1</span> <span class="bound">c2</span> <span class="main">∧</span> discr <span class="bound">c1</span> <span class="main">∧</span> discr <span class="bound">c2</span><span class="main">)</span> <span class="main">∨</span> discr <span class="skolem">c'</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> Par_transC_invert<span class="main">)</span>
     <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">metis</span> c1 c2 discr.cases<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
   <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Discreetness versus language constructs:›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> discr0_Atm<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"discr0 <span class="main">(</span>Atm <span class="free">atm</span><span class="main">)</span> <span class="main">=</span> presAtm <span class="free">atm</span>"</span></span>  
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>    
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span>
   <span class="keyword1"><span class="command">have</span></span> 
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span> <span class="bound">atm</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">=</span> Atm <span class="bound">atm</span> <span class="main">∧</span> presAtm <span class="bound">atm</span><span class="main">)</span> 
    <span class="main">⟹</span> discr0 <span class="skolem">c</span>"</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> discr0_coind<span class="main">)</span> 
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Atm_transC_invert<span class="main">)</span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> discr_Atm discr_transT<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"discr0 <span class="main">(</span>Atm <span class="free">atm</span><span class="main">)</span> <span class="main">⟹</span> presAtm <span class="free">atm</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Atm discr0_MtransT presAtm_def mustT_Atm transT_MtransT<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> discr0_If<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"discr0 <span class="free">c1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"discr0 <span class="free">c2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"discr0 <span class="main">(</span>If <span class="free">tst</span> <span class="free">c1</span> <span class="free">c2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>    
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span>
   <span class="keyword1"><span class="command">have</span></span> 
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span> <span class="bound">tst</span> <span class="bound">c1</span> <span class="bound">c2</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">=</span> If <span class="bound">tst</span> <span class="bound">c1</span> <span class="bound">c2</span> <span class="main">∧</span> discr0 <span class="bound">c1</span> <span class="main">∧</span> discr0 <span class="bound">c2</span><span class="main">)</span> <span class="main">⟹</span> discr0 <span class="skolem">c</span>"</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> discr0_coind<span class="main">)</span> 
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> If_transC_invert indis_refl<span class="main">)</span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> If_transT_invert<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> discr0_Seq<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"discr0 <span class="free">c1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"discr0 <span class="free">c2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"discr0 <span class="main">(</span><span class="free">c1</span> <span class="main">;;</span> <span class="free">c2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span>
   <span class="keyword1"><span class="command">have</span></span> 
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span> <span class="bound">c1</span> <span class="bound">c2</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">=</span> <span class="bound">c1</span> <span class="main">;;</span> <span class="bound">c2</span> <span class="main">∧</span> discr0 <span class="bound">c1</span> <span class="main">∧</span> discr0 <span class="bound">c2</span><span class="main">)</span> 
    <span class="main">⟹</span> discr0 <span class="skolem">c</span>"</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> discr0_coind<span class="main">)</span> 
   <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">tactic</span><span class="quoted">‹<span class="entity">clarify_all_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span>
     <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span> <span class="skolem">s</span> <span class="skolem">c'</span> <span class="skolem">s'</span> <span class="skolem">c1</span> <span class="skolem">c2</span>
     <span class="keyword3"><span class="command">assume</span></span> mt<span class="main">:</span> <span class="quoted"><span class="quoted">"mustT <span class="main">(</span><span class="skolem">c1</span> <span class="main">;;</span> <span class="skolem">c2</span><span class="main">)</span> <span class="skolem">s</span>"</span></span> 
     <span class="keyword2"><span class="keyword">and</span></span> c1<span class="main">:</span> <span class="quoted"><span class="quoted">"discr0 <span class="skolem">c1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c2<span class="main">:</span> <span class="quoted"><span class="quoted">"discr0 <span class="skolem">c2</span>"</span></span> 
     <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span> <span class="main">;;</span> <span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
     <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≈</span> <span class="skolem">s'</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="main">∃</span><span class="bound">c1</span> <span class="bound">c2</span><span class="main">.</span> <span class="skolem">c'</span> <span class="main">=</span> <span class="bound">c1</span> <span class="main">;;</span> <span class="bound">c2</span> <span class="main">∧</span> discr0 <span class="bound">c1</span> <span class="main">∧</span> discr0 <span class="bound">c2</span><span class="main">)</span> <span class="main">∨</span> discr0 <span class="skolem">c'</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> Seq_transC_invert<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> mustT_Seq_L c1 c2 discr0_MtransC discr0_MtransC_indis mt 
                  transC_MtransC<span class="main">)</span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> c1 c2 discr0_transT mt mustT_Seq_L<span class="main">)</span>
   <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> Seq_transT_invert<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> discr0_While<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"discr0 <span class="free">c</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"discr0 <span class="main">(</span>While <span class="free">tst</span> <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span>
   <span class="keyword1"><span class="command">have</span></span> 
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span> <span class="bound">tst</span> <span class="bound">d</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">=</span> While <span class="bound">tst</span> <span class="bound">d</span> <span class="main">∧</span> discr0 <span class="bound">d</span><span class="main">)</span> <span class="main">∨</span> 
    <span class="main">(</span><span class="main">∃</span> <span class="bound">tst</span> <span class="bound">d1</span> <span class="bound">d</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">=</span> <span class="bound">d1</span> <span class="main">;;</span> <span class="main">(</span>While <span class="bound">tst</span> <span class="bound">d</span><span class="main">)</span> <span class="main">∧</span> discr0 <span class="bound">d1</span> <span class="main">∧</span> discr0 <span class="bound">d</span><span class="main">)</span>
    <span class="main">⟹</span> discr0 <span class="skolem">c</span>"</span></span>
   <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> discr0_coind<span class="main">)</span>
     <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Term <span class="skolem">c</span> <span class="skolem">s</span> <span class="skolem">s'</span><span class="main">)</span>
     <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≈</span> <span class="skolem">s'</span>"</span></span> 
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> exE disjE conjE<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> While_transT_invert indis_refl<span class="main">)</span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Seq_transT_invert<span class="main">)</span>
   <span class="keyword1"><span class="command">next</span></span>
     <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cont <span class="skolem">c</span> <span class="skolem">s</span> <span class="skolem">c'</span> <span class="skolem">s'</span><span class="main">)</span>
     <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> exE disjE conjE<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> While_transC_invert indis_refl<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Seq_transC_invert discr0_MtransC_indis discr0_transT 
                  mustT_Seq_L transC_MtransC<span class="main">)</span>
     <span class="comment1">(*  *)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">elim</span> exE disjE conjE<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> While_transC_invert<span class="main">)</span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cont<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> Seq_transC_invert discr0_transC mustT_Seq_L<span class="main">)</span>
   <span class="keyword1"><span class="command">qed</span></span>   
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> discr0_Par<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"discr0 <span class="free">c1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"discr0 <span class="free">c2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"discr0 <span class="main">(</span>Par <span class="free">c1</span> <span class="free">c2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span>
   <span class="keyword1"><span class="command">have</span></span> 
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span> <span class="bound">c1</span> <span class="bound">c2</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">=</span> Par <span class="bound">c1</span> <span class="bound">c2</span> <span class="main">∧</span> discr0 <span class="bound">c1</span> <span class="main">∧</span> discr0 <span class="bound">c2</span><span class="main">)</span> 
    <span class="main">⟹</span> discr0 <span class="skolem">c</span>"</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> discr0_coind<span class="main">)</span> 
   <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">tactic</span><span class="quoted">‹<span class="entity">clarify_all_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span>
     <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span> <span class="skolem">s</span> <span class="skolem">c'</span> <span class="skolem">s'</span> <span class="skolem">c1</span> <span class="skolem">c2</span>
     <span class="keyword3"><span class="command">assume</span></span> mt<span class="main">:</span> <span class="quoted"><span class="quoted">"mustT <span class="main">(</span>Par <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">)</span> <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c1<span class="main">:</span> <span class="quoted"><span class="quoted">"discr0 <span class="skolem">c1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c2<span class="main">:</span> <span class="quoted"><span class="quoted">"discr0 <span class="skolem">c2</span>"</span></span> 
     <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Par <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
     <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≈</span> <span class="skolem">s'</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="main">∃</span><span class="bound">c1</span> <span class="bound">c2</span><span class="main">.</span> <span class="skolem">c'</span> <span class="main">=</span> Par <span class="bound">c1</span> <span class="bound">c2</span> <span class="main">∧</span> discr0 <span class="bound">c1</span> <span class="main">∧</span> discr0 <span class="bound">c2</span><span class="main">)</span> <span class="main">∨</span> discr0 <span class="skolem">c'</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> Par_transC_invert<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> c1 c2 discr0.simps mt mustT_Par_L<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> c1 c2 discr0_transT mt mustT_Par_L<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> c1 c2 discr0.simps indis_sym mt mustT_Par_R<span class="main">)</span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> PL.mustT_Par_R c1 c2 discr0_transT mt<span class="main">)</span>
   <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Self-Isomorphism versus language constructs:›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> siso_Atm<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"siso <span class="main">(</span>Atm <span class="free">atm</span><span class="main">)</span> <span class="main">=</span> compatAtm <span class="free">atm</span>"</span></span>  
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>    
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span>
   <span class="keyword1"><span class="command">have</span></span> 
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span> <span class="bound">atm</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">=</span> Atm <span class="bound">atm</span> <span class="main">∧</span> compatAtm <span class="bound">atm</span><span class="main">)</span> 
    <span class="main">⟹</span> siso <span class="skolem">c</span>"</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> siso_coind<span class="main">)</span> 
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Atm_transC_invert<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> PL.Atm_transC_invert<span class="main">)</span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Atm_transT_invert PL.Atm compatAtm_def<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"siso <span class="main">(</span>Atm <span class="free">atm</span><span class="main">)</span> <span class="main">⟹</span> compatAtm <span class="free">atm</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> compatAtm_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Atm Atm_transT_invert siso_transT<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span> 

<span class="keyword1"><span class="command">theorem</span></span> siso_If<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span>  <span class="quoted"><span class="quoted">"compatTst <span class="free">tst</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"siso <span class="free">c1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"siso <span class="free">c2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"siso <span class="main">(</span>If <span class="free">tst</span> <span class="free">c1</span> <span class="free">c2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>    
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span>
   <span class="keyword1"><span class="command">have</span></span> 
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span> <span class="bound">tst</span> <span class="bound">c1</span> <span class="bound">c2</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">=</span> If <span class="bound">tst</span> <span class="bound">c1</span> <span class="bound">c2</span> <span class="main">∧</span> compatTst <span class="bound">tst</span> <span class="main">∧</span> siso <span class="bound">c1</span> <span class="main">∧</span> siso <span class="bound">c2</span><span class="main">)</span> <span class="main">⟹</span> siso <span class="skolem">c</span>"</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> siso_coind<span class="main">)</span> 
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> PL.If_transC_invert indis_refl<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> IfTrue PL.IfFalse PL.If_transC_invert compatTst_def<span class="main">)</span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> If_transT_invert<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> siso_Seq<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"siso <span class="free">c1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"siso <span class="free">c2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"siso <span class="main">(</span><span class="free">c1</span> <span class="main">;;</span> <span class="free">c2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span>
   <span class="keyword1"><span class="command">have</span></span> 
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span> <span class="bound">c1</span> <span class="bound">c2</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">=</span> <span class="bound">c1</span> <span class="main">;;</span> <span class="bound">c2</span> <span class="main">∧</span> siso <span class="bound">c1</span> <span class="main">∧</span> siso <span class="bound">c2</span><span class="main">)</span> 
    <span class="main">⟹</span> siso <span class="skolem">c</span>"</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> siso_coind<span class="main">)</span> 
   <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">tactic</span><span class="quoted">‹<span class="entity">clarify_all_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span>
     <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">c'</span> <span class="skolem">s'</span> <span class="skolem">c1</span> <span class="skolem">c2</span>
     <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≈</span> <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span> <span class="main">;;</span> <span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"siso <span class="skolem">c1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"siso <span class="skolem">c2</span>"</span></span>
     <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t'</span><span class="main">.</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">c1</span> <span class="main">;;</span> <span class="skolem">c2</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> Seq_transC_invert<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> SeqC siso_transC_indis<span class="main">)</span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> PL.SeqT siso_transT<span class="main">)</span>
   <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> Seq_transT_invert siso_transC<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> siso_While<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"compatTst <span class="free">tst</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"siso <span class="free">c</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"siso <span class="main">(</span>While <span class="free">tst</span> <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span>
   <span class="keyword1"><span class="command">have</span></span> 
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span> <span class="bound">tst</span> <span class="bound">d</span><span class="main">.</span> compatTst <span class="bound">tst</span> <span class="main">∧</span> <span class="skolem">c</span> <span class="main">=</span> While <span class="bound">tst</span> <span class="bound">d</span> <span class="main">∧</span> siso <span class="bound">d</span><span class="main">)</span> <span class="main">∨</span> 
    <span class="main">(</span><span class="main">∃</span> <span class="bound">tst</span> <span class="bound">d1</span> <span class="bound">d</span><span class="main">.</span> compatTst <span class="bound">tst</span> <span class="main">∧</span> <span class="skolem">c</span> <span class="main">=</span> <span class="bound">d1</span> <span class="main">;;</span> <span class="main">(</span>While <span class="bound">tst</span> <span class="bound">d</span><span class="main">)</span> <span class="main">∧</span> siso <span class="bound">d1</span> <span class="main">∧</span> siso <span class="bound">d</span><span class="main">)</span>
    <span class="main">⟹</span> siso <span class="skolem">c</span>"</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> siso_coind<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> PL.Seq_transC_invert siso_transC<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> WhileTrue While_transC_invert compatTst_def<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> PL.SeqC siso_transC_indis<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> PL.SeqT siso_transT<span class="main">)</span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> WhileFalse compatTst_def<span class="main">)</span> 
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> siso_Par<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"siso <span class="free">c1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"siso <span class="free">c2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"siso <span class="main">(</span>Par <span class="free">c1</span> <span class="free">c2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span>
   <span class="keyword1"><span class="command">have</span></span> 
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span> <span class="bound">c1</span> <span class="bound">c2</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">=</span> Par <span class="bound">c1</span> <span class="bound">c2</span> <span class="main">∧</span> siso <span class="bound">c1</span> <span class="main">∧</span> siso <span class="bound">c2</span><span class="main">)</span> 
    <span class="main">⟹</span> siso <span class="skolem">c</span>"</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> siso_coind<span class="main">)</span>
   <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">tactic</span><span class="quoted">‹<span class="entity">clarify_all_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span>
     <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">c'</span> <span class="skolem">s'</span> <span class="skolem">c1</span> <span class="skolem">c2</span>
     <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≈</span> <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Par <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c1<span class="main">:</span> <span class="quoted"><span class="quoted">"siso <span class="skolem">c1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c2<span class="main">:</span> <span class="quoted"><span class="quoted">"siso <span class="skolem">c2</span>"</span></span>
     <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t'</span><span class="main">.</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="main">(</span>Par <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> Par_transC_invert<span class="main">)</span>
     <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">metis</span> ParCL ParTL ParCR ParTR c1 c2 siso_transT siso_transC_indis<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>   
   <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> Par_transC_invert siso_transC Par_transT_invert<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Self-Isomorphism versus language constructs:›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> siso0_Atm<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"siso0 <span class="main">(</span>Atm <span class="free">atm</span><span class="main">)</span> <span class="main">=</span> compatAtm <span class="free">atm</span>"</span></span>  
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>    
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span>
   <span class="keyword1"><span class="command">have</span></span> 
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span> <span class="bound">atm</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">=</span> Atm <span class="bound">atm</span> <span class="main">∧</span> compatAtm <span class="bound">atm</span><span class="main">)</span> 
    <span class="main">⟹</span> siso0 <span class="skolem">c</span>"</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> siso0_coind<span class="main">)</span> 
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Atm_transC_invert<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> PL.Atm_transC_invert<span class="main">)</span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Atm_transT_invert PL.Atm compatAtm_def<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"siso0 <span class="main">(</span>Atm <span class="free">atm</span><span class="main">)</span> <span class="main">⟹</span> compatAtm <span class="free">atm</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> compatAtm_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Atm Atm_transT_invert siso0_transT mustT_Atm<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span> 

<span class="keyword1"><span class="command">theorem</span></span> siso0_If<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span>  <span class="quoted"><span class="quoted">"compatTst <span class="free">tst</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"siso0 <span class="free">c1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"siso0 <span class="free">c2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"siso0 <span class="main">(</span>If <span class="free">tst</span> <span class="free">c1</span> <span class="free">c2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>    
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span>
   <span class="keyword1"><span class="command">have</span></span> 
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span> <span class="bound">tst</span> <span class="bound">c1</span> <span class="bound">c2</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">=</span> If <span class="bound">tst</span> <span class="bound">c1</span> <span class="bound">c2</span> <span class="main">∧</span> compatTst <span class="bound">tst</span> <span class="main">∧</span> siso0 <span class="bound">c1</span> <span class="main">∧</span> siso0 <span class="bound">c2</span><span class="main">)</span> <span class="main">⟹</span> siso0 <span class="skolem">c</span>"</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> siso0_coind<span class="main">)</span> 
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> PL.If_transC_invert indis_refl<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> IfTrue PL.IfFalse PL.If_transC_invert compatTst_def<span class="main">)</span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> If_transT_invert<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> siso0_Seq<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"siso0 <span class="free">c1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"siso0 <span class="free">c2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"siso0 <span class="main">(</span><span class="free">c1</span> <span class="main">;;</span> <span class="free">c2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span>
   <span class="keyword1"><span class="command">have</span></span> 
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span> <span class="bound">c1</span> <span class="bound">c2</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">=</span> <span class="bound">c1</span> <span class="main">;;</span> <span class="bound">c2</span> <span class="main">∧</span> siso0 <span class="bound">c1</span> <span class="main">∧</span> siso0 <span class="bound">c2</span><span class="main">)</span> 
    <span class="main">⟹</span> siso0 <span class="skolem">c</span>"</span></span>
   <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> siso0_coind<span class="main">)</span>
     <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Indef <span class="skolem">c</span> <span class="skolem">s</span> <span class="skolem">c'</span> <span class="skolem">s'</span><span class="main">)</span>
     <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Seq_transC_invert mustT_Seq_L siso0_transC<span class="main">)</span> 
   <span class="keyword1"><span class="command">next</span></span>
     <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cont <span class="skolem">c</span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">c'</span> <span class="skolem">s'</span><span class="main">)</span>
     <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c1</span></span> <span class="skolem"><span class="skolem">c2</span></span>
     <span class="keyword2"><span class="keyword">where</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> <span class="skolem">c1</span> <span class="main">;;</span> <span class="skolem">c2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> mt<span class="main">:</span> <span class="quoted"><span class="quoted">"mustT <span class="main">(</span><span class="skolem">c1</span> <span class="main">;;</span> <span class="skolem">c2</span><span class="main">)</span> <span class="skolem">s</span>"</span></span> <span class="quoted"><span class="quoted">"mustT <span class="main">(</span><span class="skolem">c1</span> <span class="main">;;</span> <span class="skolem">c2</span><span class="main">)</span> <span class="skolem">t</span>"</span></span> 
     <span class="keyword2"><span class="keyword">and</span></span> st<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≈</span> <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> siso1<span class="main">:</span> <span class="quoted"><span class="quoted">"siso0 <span class="skolem">c1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> siso2<span class="main">:</span> <span class="quoted"><span class="quoted">"siso0 <span class="skolem">c2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">hence</span></span> mt1<span class="main">:</span> <span class="quoted"><span class="quoted">"mustT <span class="skolem">c1</span> <span class="skolem">s</span>"</span></span> <span class="quoted"><span class="quoted">"mustT <span class="skolem">c1</span> <span class="skolem">t</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mustT_Seq_L<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
     <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span> <span class="main">;;</span> <span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c Cont <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
     <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">elim</span> Seq_transC_invert<span class="main">)</span>
       <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c1'</span> <span class="keyword3"><span class="command">assume</span></span> c1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c1'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">=</span> <span class="skolem">c1'</span> <span class="main">;;</span> <span class="skolem">c2</span>"</span></span>
       <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c1'</span><span class="main">,</span> <span class="skolem">t'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">≈</span> <span class="skolem">t'</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> siso1 c1 st mt1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> siso0_transC_indis<span class="main">)</span> 
       <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> SeqC c c'<span class="main">)</span> 
     <span class="keyword1"><span class="command">next</span></span>
       <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="skolem">s'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">=</span> <span class="skolem">c2</span>"</span></span>
       <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> c SeqT mt1 siso0_transT siso1 st<span class="main">)</span>
     <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> siso0_While<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"compatTst <span class="free">tst</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"siso0 <span class="free">c</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"siso0 <span class="main">(</span>While <span class="free">tst</span> <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span>
   <span class="keyword1"><span class="command">have</span></span> 
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span> <span class="bound">tst</span> <span class="bound">d</span><span class="main">.</span> compatTst <span class="bound">tst</span> <span class="main">∧</span> <span class="skolem">c</span> <span class="main">=</span> While <span class="bound">tst</span> <span class="bound">d</span> <span class="main">∧</span> siso0 <span class="bound">d</span><span class="main">)</span> <span class="main">∨</span> 
    <span class="main">(</span><span class="main">∃</span> <span class="bound">tst</span> <span class="bound">d1</span> <span class="bound">d</span><span class="main">.</span> compatTst <span class="bound">tst</span> <span class="main">∧</span> <span class="skolem">c</span> <span class="main">=</span> <span class="bound">d1</span> <span class="main">;;</span> <span class="main">(</span>While <span class="bound">tst</span> <span class="bound">d</span><span class="main">)</span> <span class="main">∧</span> siso0 <span class="bound">d1</span> <span class="main">∧</span> siso0 <span class="bound">d</span><span class="main">)</span>
    <span class="main">⟹</span> siso0 <span class="skolem">c</span>"</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> siso0_coind<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> mustT_Seq_L siso0_transC<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> WhileTrue While_transC_invert compatTst_def<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> SeqC mustT_Seq_L siso0_transC_indis<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> SeqT mustT_Seq_L siso0_transT<span class="main">)</span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> WhileFalse compatTst_def<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> siso0_Par<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"siso0 <span class="free">c1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"siso0 <span class="free">c2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"siso0 <span class="main">(</span>Par <span class="free">c1</span> <span class="free">c2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span>
   <span class="keyword1"><span class="command">have</span></span> 
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span> <span class="bound">c1</span> <span class="bound">c2</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">=</span> Par <span class="bound">c1</span> <span class="bound">c2</span> <span class="main">∧</span> siso0 <span class="bound">c1</span> <span class="main">∧</span> siso0 <span class="bound">c2</span><span class="main">)</span> 
    <span class="main">⟹</span> siso0 <span class="skolem">c</span>"</span></span>
   <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> siso0_coind<span class="main">)</span>
     <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Indef <span class="skolem">c</span> <span class="skolem">s</span> <span class="skolem">c'</span> <span class="skolem">s'</span><span class="main">)</span>
     <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c1</span></span> <span class="skolem"><span class="skolem">c2</span></span> <span class="keyword2"><span class="keyword">where</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> Par <span class="skolem">c1</span> <span class="skolem">c2</span>"</span></span> 
     <span class="keyword2"><span class="keyword">and</span></span> c1<span class="main">:</span> <span class="quoted"><span class="quoted">"siso0 <span class="skolem">c1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c2<span class="main">:</span> <span class="quoted"><span class="quoted">"siso0 <span class="skolem">c2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Par <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c Indef <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> Par_transC_invert<span class="main">)</span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Indef c c1 c2 mustT_Par_L mustT_Par_R siso0_transC<span class="main">)</span><span class="main"><span class="keyword3">+</span></span> 
   <span class="keyword1"><span class="command">next</span></span>
     <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cont <span class="skolem">c</span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">c'</span> <span class="skolem">s'</span><span class="main">)</span>
     <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c1</span></span> <span class="skolem"><span class="skolem">c2</span></span> <span class="keyword2"><span class="keyword">where</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> Par <span class="skolem">c1</span> <span class="skolem">c2</span>"</span></span> 
     <span class="keyword2"><span class="keyword">and</span></span> c1<span class="main">:</span> <span class="quoted"><span class="quoted">"siso0 <span class="skolem">c1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c2<span class="main">:</span> <span class="quoted"><span class="quoted">"siso0 <span class="skolem">c2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword1"><span class="command">hence</span></span> mt<span class="main">:</span> <span class="quoted"><span class="quoted">"mustT <span class="skolem">c1</span> <span class="skolem">s</span>"</span></span> <span class="quoted"><span class="quoted">"mustT <span class="skolem">c1</span> <span class="skolem">t</span>"</span></span> <span class="quoted"><span class="quoted">"mustT <span class="skolem">c2</span> <span class="skolem">s</span>"</span></span> <span class="quoted"><span class="quoted">"mustT <span class="skolem">c2</span> <span class="skolem">t</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cont mustT_Par_L mustT_Par_R<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
     <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Par <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c Cont <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> Par_transC_invert<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Cont ParCL c c1 mt siso0_transC_indis<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Cont ParTL c c1 mt siso0_transT<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Cont ParCR c c2 mt siso0_transC_indis<span class="main">)</span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cont ParTR c c2 mt siso0_transT<span class="main">)</span>
   <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Strong bisimilarity versus language constructs›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Atomic commands:›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">thetaAtm</span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">thetaAtm</span> <span class="free"><span class="bound"><span class="entity">atm</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="main">(</span>Atm <span class="free"><span class="bound"><span class="entity">atm</span></span></span><span class="main">,</span> Atm <span class="free"><span class="bound"><span class="entity">atm</span></span></span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Compositionality-thetaAtm_sym"><span class="command">lemma</span></span> thetaAtm_sym<span class="main">:</span>
<span class="quoted"><span class="quoted">"sym <span class="main">(</span>thetaAtm <span class="free">atm</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> thetaAtm_def sym_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Compositionality-thetaAtm_Sretr"><span class="command">lemma</span></span> thetaAtm_Sretr<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"compatAtm <span class="free">atm</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"thetaAtm <span class="free">atm</span> <span class="main">⊆</span> Sretr <span class="main">(</span>thetaAtm <span class="free">atm</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms 
<span class="keyword1"><span class="command">unfolding</span></span> compatAtm_def Sretr_def matchC_C_def matchT_T_def thetaAtm_def
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Atm_transT_invert Atm<span class="main">)</span> 

<span class="keyword1" id="Compositionality-thetaAtm_Sbis"><span class="command">lemma</span></span> thetaAtm_Sbis<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"compatAtm <span class="free">atm</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"thetaAtm <span class="free">atm</span> <span class="main">⊆</span> Sbis"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Sbis_raw_coind<span class="main">)</span>
<span class="keyword1"><span class="command">using</span></span> assms thetaAtm_sym thetaAtm_Sretr <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> Atm_Sbis<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"compatAtm <span class="free">atm</span>"</span></span> 
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Atm <span class="free">atm</span> <span class="keyword1">≈s</span> Atm <span class="free">atm</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms thetaAtm_Sbis <span class="keyword1"><span class="command">unfolding</span></span> thetaAtm_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Sequential composition:›</span></span> 

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">thetaSeq</span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">thetaSeq</span> <span class="main">≡</span> 
 <span class="main">{</span><span class="main">(</span><span class="bound">c1</span> <span class="main">;;</span> <span class="bound">c2</span><span class="main">,</span> <span class="bound">d1</span> <span class="main">;;</span> <span class="bound">d2</span><span class="main">)</span> <span class="main">|</span> <span class="bound">c1</span> <span class="bound">c2</span> <span class="bound">d1</span> <span class="bound">d2</span><span class="main">.</span> <span class="bound">c1</span> <span class="keyword1">≈s</span> <span class="bound">d1</span> <span class="main">∧</span> <span class="bound">c2</span> <span class="keyword1">≈s</span> <span class="bound">d2</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Compositionality-thetaSeq_sym"><span class="command">lemma</span></span> thetaSeq_sym<span class="main">:</span>
<span class="quoted"><span class="quoted">"sym thetaSeq"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> thetaSeq_def sym_def <span class="keyword1"><span class="command">using</span></span> Sbis_Sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Compositionality-thetaSeq_Sretr"><span class="command">lemma</span></span> thetaSeq_Sretr<span class="main">:</span>
<span class="quoted"><span class="quoted">"thetaSeq <span class="main">⊆</span> Sretr <span class="main">(</span>thetaSeq <span class="keyword1">Un</span> Sbis<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c1</span> <span class="skolem">c2</span> <span class="skolem">d1</span> <span class="skolem">d2</span>
   <span class="keyword3"><span class="command">assume</span></span> c1d1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span> <span class="keyword1">≈s</span> <span class="skolem">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c2d2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c2</span> <span class="keyword1">≈s</span> <span class="skolem">d2</span>"</span></span>
   <span class="keyword1"><span class="command">hence</span></span> matchC_C1<span class="main">:</span> <span class="quoted"><span class="quoted">"matchC_C Sbis <span class="skolem">c1</span> <span class="skolem">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> matchC_C2<span class="main">:</span> <span class="quoted"><span class="quoted">"matchC_C Sbis <span class="skolem">c2</span> <span class="skolem">d2</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> matchT_T1<span class="main">:</span> <span class="quoted"><span class="quoted">"matchT_T <span class="skolem">c1</span> <span class="skolem">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> matchT_T2<span class="main">:</span> <span class="quoted"><span class="quoted">"matchT_T <span class="skolem">c2</span> <span class="skolem">d2</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> Sbis_matchC_C Sbis_matchT_T <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span> <span class="main">;;</span> <span class="skolem">c2</span><span class="main">,</span> <span class="skolem">d1</span> <span class="main">;;</span> <span class="skolem">d2</span><span class="main">)</span> <span class="main">∈</span> Sretr <span class="main">(</span>thetaSeq <span class="keyword1">Un</span> Sbis<span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">unfolding</span></span> Sretr_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"matchC_C <span class="main">(</span>thetaSeq <span class="keyword1">Un</span> Sbis<span class="main">)</span> <span class="main">(</span><span class="skolem">c1</span> <span class="main">;;</span> <span class="skolem">c2</span><span class="main">)</span> <span class="main">(</span><span class="skolem">d1</span> <span class="main">;;</span> <span class="skolem">d2</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">unfolding</span></span> matchC_C_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="entity">mauto_no_simp_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span>
       <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">c'</span> <span class="skolem">s'</span>
       <span class="keyword3"><span class="command">assume</span></span> st<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≈</span> <span class="skolem">t</span>"</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span> <span class="main">;;</span> <span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
       <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d1</span> <span class="main">;;</span> <span class="skolem">d2</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="bound">d'</span><span class="main">)</span> <span class="main">∈</span> thetaSeq <span class="keyword1">Un</span> Sbis"</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">erule</span> Seq_transC_invert<span class="main">)</span> 
         <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c1'</span> <span class="keyword3"><span class="command">assume</span></span> c1s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c1'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">=</span> <span class="skolem">c1'</span> <span class="main">;;</span> <span class="skolem">c2</span>"</span></span>
         <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">d1'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d1</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">d1'</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">c1'</span> <span class="keyword1">≈s</span> <span class="bound">d1'</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> st matchC_C1 <span class="keyword1"><span class="command">unfolding</span></span> matchC_C_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
         <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> c' thetaSeq_def
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> SeqC c2d2 <span class="main">)</span> 
       <span class="keyword1"><span class="command">next</span></span>      
         <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="skolem">s'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">=</span> <span class="skolem">c2</span>"</span></span>
         <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d1</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> st matchT_T1 <span class="keyword1"><span class="command">unfolding</span></span> matchT_T_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
         <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
         <span class="keyword1"><span class="command">unfolding</span></span> c' thetaSeq_def
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> PL.SeqT c2d2<span class="main">)</span> 
       <span class="keyword1"><span class="command">qed</span></span>
     <span class="keyword1"><span class="command">qed</span></span> 
   <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">unfold</span> matchT_T_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> thetaSeq_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Compositionality-thetaSeq_Sbis"><span class="command">lemma</span></span> thetaSeq_Sbis<span class="main">:</span>
<span class="quoted"><span class="quoted">"thetaSeq <span class="main">⊆</span> Sbis"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Sbis_coind<span class="main">)</span>
<span class="keyword1"><span class="command">using</span></span> thetaSeq_sym thetaSeq_Sretr <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> Seq_Sbis<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c1</span> <span class="keyword1">≈s</span> <span class="free">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">c2</span> <span class="keyword1">≈s</span> <span class="free">d2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">c1</span> <span class="main">;;</span> <span class="free">c2</span> <span class="keyword1">≈s</span> <span class="free">d1</span> <span class="main">;;</span> <span class="free">d2</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms thetaSeq_Sbis <span class="keyword1"><span class="command">unfolding</span></span> thetaSeq_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Conditional:›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">thetaIf</span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">thetaIf</span> <span class="main">≡</span> 
 <span class="main">{</span><span class="main">(</span>If <span class="bound">tst</span> <span class="bound">c1</span> <span class="bound">c2</span><span class="main">,</span> If <span class="bound">tst</span> <span class="bound">d1</span> <span class="bound">d2</span><span class="main">)</span> <span class="main">|</span> <span class="bound">tst</span> <span class="bound">c1</span> <span class="bound">c2</span> <span class="bound">d1</span> <span class="bound">d2</span><span class="main">.</span> compatTst <span class="bound">tst</span> <span class="main">∧</span> <span class="bound">c1</span> <span class="keyword1">≈s</span> <span class="bound">d1</span> <span class="main">∧</span> <span class="bound">c2</span> <span class="keyword1">≈s</span> <span class="bound">d2</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Compositionality-thetaIf_sym"><span class="command">lemma</span></span> thetaIf_sym<span class="main">:</span>
<span class="quoted"><span class="quoted">"sym thetaIf"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> thetaIf_def sym_def <span class="keyword1"><span class="command">using</span></span> Sbis_Sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Compositionality-thetaIf_Sretr"><span class="command">lemma</span></span> thetaIf_Sretr<span class="main">:</span>
<span class="quoted"><span class="quoted">"thetaIf <span class="main">⊆</span> Sretr <span class="main">(</span>thetaIf <span class="keyword1">Un</span> Sbis<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">tst</span> <span class="skolem">c1</span> <span class="skolem">c2</span> <span class="skolem">d1</span> <span class="skolem">d2</span>
   <span class="keyword3"><span class="command">assume</span></span> tst<span class="main">:</span> <span class="quoted"><span class="quoted">"compatTst <span class="skolem">tst</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c1d1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span> <span class="keyword1">≈s</span> <span class="skolem">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c2d2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c2</span> <span class="keyword1">≈s</span> <span class="skolem">d2</span>"</span></span>
   <span class="keyword1"><span class="command">hence</span></span> matchC_C1<span class="main">:</span> <span class="quoted"><span class="quoted">"matchC_C Sbis <span class="skolem">c1</span> <span class="skolem">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> matchC_C2<span class="main">:</span> <span class="quoted"><span class="quoted">"matchC_C Sbis <span class="skolem">c2</span> <span class="skolem">d2</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> matchT_T1<span class="main">:</span> <span class="quoted"><span class="quoted">"matchT_T <span class="skolem">c1</span> <span class="skolem">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> matchT_T2<span class="main">:</span> <span class="quoted"><span class="quoted">"matchT_T <span class="skolem">c2</span> <span class="skolem">d2</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> Sbis_matchC_C Sbis_matchT_T <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>If <span class="skolem">tst</span> <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">,</span> If <span class="skolem">tst</span> <span class="skolem">d1</span> <span class="skolem">d2</span><span class="main">)</span> <span class="main">∈</span> Sretr <span class="main">(</span>thetaIf <span class="keyword1">Un</span> Sbis<span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">unfolding</span></span> Sretr_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"matchC_C <span class="main">(</span>thetaIf <span class="keyword1">Un</span> Sbis<span class="main">)</span> <span class="main">(</span>If <span class="skolem">tst</span> <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">)</span> <span class="main">(</span>If <span class="skolem">tst</span> <span class="skolem">d1</span> <span class="skolem">d2</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">unfolding</span></span> matchC_C_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="entity">mauto_no_simp_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span>
       <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">c'</span> <span class="skolem">s'</span>
       <span class="keyword3"><span class="command">assume</span></span> st<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≈</span> <span class="skolem">t</span>"</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>If <span class="skolem">tst</span> <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
       <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span>If <span class="skolem">tst</span> <span class="skolem">d1</span> <span class="skolem">d2</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="bound">d'</span><span class="main">)</span> <span class="main">∈</span> thetaIf <span class="keyword1">Un</span> Sbis"</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> If_transC_invert<span class="main">)</span>
       <span class="keyword1"><span class="command">unfolding</span></span> thetaIf_def 
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> IfTrue c1d1 compatTst_def st tst<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IfFalse c2d2 compatTst_def st tst<span class="main">)</span>
     <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">unfold</span> matchT_T_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> thetaIf_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Compositionality-thetaIf_Sbis"><span class="command">lemma</span></span> thetaIf_Sbis<span class="main">:</span>
<span class="quoted"><span class="quoted">"thetaIf <span class="main">⊆</span> Sbis"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Sbis_coind<span class="main">)</span>
<span class="keyword1"><span class="command">using</span></span> thetaIf_sym thetaIf_Sretr <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> If_Sbis<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"compatTst <span class="free">tst</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">c1</span> <span class="keyword1">≈s</span> <span class="free">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">c2</span> <span class="keyword1">≈s</span> <span class="free">d2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"If <span class="free">tst</span> <span class="free">c1</span> <span class="free">c2</span> <span class="keyword1">≈s</span> If <span class="free">tst</span> <span class="free">d1</span> <span class="free">d2</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms thetaIf_Sbis <span class="keyword1"><span class="command">unfolding</span></span> thetaIf_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹While loop:›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">thetaWhile</span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">thetaWhile</span> <span class="main">≡</span> 
 <span class="main">{</span><span class="main">(</span>While <span class="bound">tst</span> <span class="bound">c</span><span class="main">,</span> While <span class="bound">tst</span> <span class="bound">d</span><span class="main">)</span> <span class="main">|</span> <span class="bound">tst</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">.</span> compatTst <span class="bound">tst</span> <span class="main">∧</span> <span class="bound">c</span> <span class="keyword1">≈s</span> <span class="bound">d</span><span class="main">}</span> <span class="keyword1">Un</span> 
 <span class="main">{</span><span class="main">(</span><span class="bound">c1</span> <span class="main">;;</span> <span class="main">(</span>While <span class="bound">tst</span> <span class="bound">c</span><span class="main">)</span><span class="main">,</span> <span class="bound">d1</span> <span class="main">;;</span> <span class="main">(</span>While <span class="bound">tst</span> <span class="bound">d</span><span class="main">)</span><span class="main">)</span> <span class="main">|</span> <span class="bound">tst</span> <span class="bound">c1</span> <span class="bound">d1</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">.</span> compatTst <span class="bound">tst</span> <span class="main">∧</span> <span class="bound">c1</span> <span class="keyword1">≈s</span> <span class="bound">d1</span> <span class="main">∧</span> <span class="bound">c</span> <span class="keyword1">≈s</span> <span class="bound">d</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Compositionality-thetaWhile_sym"><span class="command">lemma</span></span> thetaWhile_sym<span class="main">:</span>
<span class="quoted"><span class="quoted">"sym thetaWhile"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> thetaWhile_def sym_def <span class="keyword1"><span class="command">using</span></span> Sbis_Sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Compositionality-thetaWhile_Sretr"><span class="command">lemma</span></span> thetaWhile_Sretr<span class="main">:</span>
<span class="quoted"><span class="quoted">"thetaWhile <span class="main">⊆</span> Sretr <span class="main">(</span>thetaWhile <span class="keyword1">Un</span> Sbis<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">tst</span> <span class="skolem">c</span> <span class="skolem">d</span> 
   <span class="keyword3"><span class="command">assume</span></span> tst<span class="main">:</span> <span class="quoted"><span class="quoted">"compatTst <span class="skolem">tst</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c_d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="keyword1">≈s</span> <span class="skolem">d</span>"</span></span>
   <span class="keyword1"><span class="command">hence</span></span> matchC_C<span class="main">:</span> <span class="quoted"><span class="quoted">"matchC_C Sbis <span class="skolem">c</span> <span class="skolem">d</span>"</span></span> 
     <span class="keyword2"><span class="keyword">and</span></span> matchT_T<span class="main">:</span> <span class="quoted"><span class="quoted">"matchT_T <span class="skolem">c</span> <span class="skolem">d</span>"</span></span> 
   <span class="keyword1"><span class="command">using</span></span> Sbis_matchC_C Sbis_matchT_T <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>While <span class="skolem">tst</span> <span class="skolem">c</span><span class="main">,</span> While <span class="skolem">tst</span> <span class="skolem">d</span><span class="main">)</span> <span class="main">∈</span> Sretr <span class="main">(</span>thetaWhile <span class="keyword1">Un</span> Sbis<span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">unfolding</span></span> Sretr_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"matchC_C <span class="main">(</span>thetaWhile <span class="main">∪</span> Sbis<span class="main">)</span> <span class="main">(</span>While <span class="skolem">tst</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">(</span>While <span class="skolem">tst</span> <span class="skolem">d</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">unfolding</span></span> matchC_C_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="entity">mauto_no_simp_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span>
       <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">c'</span> <span class="skolem">s'</span>
       <span class="keyword3"><span class="command">assume</span></span> st<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≈</span> <span class="skolem">t</span>"</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>While <span class="skolem">tst</span> <span class="skolem">c</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
       <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span>While <span class="skolem">tst</span> <span class="skolem">d</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="bound">d'</span><span class="main">)</span> <span class="main">∈</span> thetaWhile <span class="main">∪</span> Sbis"</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> While_transC_invert<span class="main">)</span>
       <span class="keyword1"><span class="command">unfolding</span></span> thetaWhile_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> WhileTrue c_d compatTst_def st tst<span class="main">)</span>
     <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">next</span></span>
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"matchT_T <span class="main">(</span>While <span class="skolem">tst</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">(</span>While <span class="skolem">tst</span> <span class="skolem">d</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">unfolding</span></span> matchT_T_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="entity">mauto_no_simp_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span>
       <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">s'</span> <span class="keyword3"><span class="command">assume</span></span> st<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≈</span> <span class="skolem">t</span>"</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>While <span class="skolem">tst</span> <span class="skolem">c</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="skolem">s'</span>"</span></span>
       <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t'</span><span class="main">.</span> <span class="main">(</span>While <span class="skolem">tst</span> <span class="skolem">d</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> "</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> While_transT_invert<span class="main">)</span>
       <span class="keyword1"><span class="command">unfolding</span></span> thetaWhile_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> PL.WhileFalse compatTst_def st tst<span class="main">)</span>    
     <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> 
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">tst</span> <span class="skolem">c1</span> <span class="skolem">d1</span>  <span class="skolem">c</span> <span class="skolem">d</span>
   <span class="keyword3"><span class="command">assume</span></span> tst<span class="main">:</span> <span class="quoted"><span class="quoted">"compatTst <span class="skolem">tst</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c1d1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span> <span class="keyword1">≈s</span> <span class="skolem">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c_d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="keyword1">≈s</span> <span class="skolem">d</span>"</span></span>
   <span class="keyword1"><span class="command">hence</span></span> matchC_C1<span class="main">:</span> <span class="quoted"><span class="quoted">"matchC_C Sbis <span class="skolem">c1</span> <span class="skolem">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> matchC_C<span class="main">:</span> <span class="quoted"><span class="quoted">"matchC_C Sbis <span class="skolem">c</span> <span class="skolem">d</span>"</span></span> 
     <span class="keyword2"><span class="keyword">and</span></span> matchT_T1<span class="main">:</span> <span class="quoted"><span class="quoted">"matchT_T <span class="skolem">c1</span> <span class="skolem">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> matchT_T<span class="main">:</span> <span class="quoted"><span class="quoted">"matchT_T <span class="skolem">c</span> <span class="skolem">d</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> Sbis_matchC_C Sbis_matchT_T <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span> <span class="main">;;</span> <span class="main">(</span>While <span class="skolem">tst</span> <span class="skolem">c</span><span class="main">)</span><span class="main">,</span> <span class="skolem">d1</span> <span class="main">;;</span> <span class="main">(</span>While <span class="skolem">tst</span> <span class="skolem">d</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> Sretr <span class="main">(</span>thetaWhile <span class="keyword1">Un</span> Sbis<span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">unfolding</span></span> Sretr_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"matchC_C <span class="main">(</span>thetaWhile <span class="main">∪</span> Sbis<span class="main">)</span> <span class="main">(</span><span class="skolem">c1</span> <span class="main">;;</span> <span class="main">(</span>While <span class="skolem">tst</span> <span class="skolem">c</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">d1</span> <span class="main">;;</span> <span class="main">(</span>While <span class="skolem">tst</span> <span class="skolem">d</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">unfolding</span></span> matchC_C_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="entity">mauto_no_simp_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span>
       <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">c'</span> <span class="skolem">s'</span>
       <span class="keyword3"><span class="command">assume</span></span> st<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≈</span> <span class="skolem">t</span>"</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span> <span class="main">;;</span> <span class="main">(</span>While <span class="skolem">tst</span> <span class="skolem">c</span><span class="main">)</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
       <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d1</span> <span class="main">;;</span> <span class="main">(</span>While <span class="skolem">tst</span> <span class="skolem">d</span><span class="main">)</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="bound">d'</span><span class="main">)</span> <span class="main">∈</span> thetaWhile <span class="main">∪</span> Sbis"</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">erule</span> Seq_transC_invert<span class="main">)</span>
         <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c1'</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c1'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">=</span> <span class="skolem">c1'</span> <span class="main">;;</span> <span class="main">(</span>While <span class="skolem">tst</span> <span class="skolem">c</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d1</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">c1'</span> <span class="keyword1">≈s</span> <span class="bound">d'</span>"</span></span> 
         <span class="keyword1"><span class="command">using</span></span> st matchC_C1 <span class="keyword1"><span class="command">unfolding</span></span> matchC_C_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
         <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
         <span class="keyword1"><span class="command">unfolding</span></span> c' thetaWhile_def
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> SeqC c_d tst<span class="main">)</span> 
       <span class="keyword1"><span class="command">next</span></span>
         <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="skolem">s'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">=</span> While <span class="skolem">tst</span> <span class="skolem">c</span>"</span></span>
         <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d1</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> st matchT_T1 <span class="keyword1"><span class="command">unfolding</span></span> matchT_T_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
         <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
         <span class="keyword1"><span class="command">unfolding</span></span> c' thetaWhile_def 
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> PL.SeqT c_d tst<span class="main">)</span> 
       <span class="keyword1"><span class="command">qed</span></span>
     <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">unfold</span> matchT_T_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> thetaWhile_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Compositionality-thetaWhile_Sbis"><span class="command">lemma</span></span> thetaWhile_Sbis<span class="main">:</span>
<span class="quoted"><span class="quoted">"thetaWhile <span class="main">⊆</span> Sbis"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Sbis_coind<span class="main">)</span>
<span class="keyword1"><span class="command">using</span></span> thetaWhile_sym thetaWhile_Sretr <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> While_Sbis<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"compatTst <span class="free">tst</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="keyword1">≈s</span> <span class="free">d</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"While <span class="free">tst</span> <span class="free">c</span> <span class="keyword1">≈s</span> While <span class="free">tst</span> <span class="free">d</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms thetaWhile_Sbis <span class="keyword1"><span class="command">unfolding</span></span> thetaWhile_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Parallel composition:›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">thetaPar</span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">thetaPar</span> <span class="main">≡</span> 
 <span class="main">{</span><span class="main">(</span>Par <span class="bound">c1</span> <span class="bound">c2</span><span class="main">,</span> Par <span class="bound">d1</span> <span class="bound">d2</span><span class="main">)</span> <span class="main">|</span> <span class="bound">c1</span> <span class="bound">c2</span> <span class="bound">d1</span> <span class="bound">d2</span><span class="main">.</span> <span class="bound">c1</span> <span class="keyword1">≈s</span> <span class="bound">d1</span> <span class="main">∧</span> <span class="bound">c2</span> <span class="keyword1">≈s</span> <span class="bound">d2</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Compositionality-thetaPar_sym"><span class="command">lemma</span></span> thetaPar_sym<span class="main">:</span>
<span class="quoted"><span class="quoted">"sym thetaPar"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> thetaPar_def sym_def <span class="keyword1"><span class="command">using</span></span> Sbis_Sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Compositionality-thetaPar_Sretr"><span class="command">lemma</span></span> thetaPar_Sretr<span class="main">:</span>
<span class="quoted"><span class="quoted">"thetaPar <span class="main">⊆</span> Sretr <span class="main">(</span>thetaPar <span class="keyword1">Un</span> Sbis<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c1</span> <span class="skolem">c2</span> <span class="skolem">d1</span> <span class="skolem">d2</span>
   <span class="keyword3"><span class="command">assume</span></span> c1d1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span> <span class="keyword1">≈s</span> <span class="skolem">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c2d2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c2</span> <span class="keyword1">≈s</span> <span class="skolem">d2</span>"</span></span>
   <span class="keyword1"><span class="command">hence</span></span> matchC_C1<span class="main">:</span> <span class="quoted"><span class="quoted">"matchC_C Sbis <span class="skolem">c1</span> <span class="skolem">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> matchC_C2<span class="main">:</span> <span class="quoted"><span class="quoted">"matchC_C Sbis <span class="skolem">c2</span> <span class="skolem">d2</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> matchT_T1<span class="main">:</span> <span class="quoted"><span class="quoted">"matchT_T <span class="skolem">c1</span> <span class="skolem">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> matchT_T2<span class="main">:</span> <span class="quoted"><span class="quoted">"matchT_T <span class="skolem">c2</span> <span class="skolem">d2</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> Sbis_matchC_C Sbis_matchT_T <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Par <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">,</span> Par <span class="skolem">d1</span> <span class="skolem">d2</span><span class="main">)</span> <span class="main">∈</span> Sretr <span class="main">(</span>thetaPar <span class="keyword1">Un</span> Sbis<span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">unfolding</span></span> Sretr_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"matchC_C <span class="main">(</span>thetaPar <span class="main">∪</span> Sbis<span class="main">)</span> <span class="main">(</span>Par <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">)</span> <span class="main">(</span>Par <span class="skolem">d1</span> <span class="skolem">d2</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">unfolding</span></span> matchC_C_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="entity">mauto_no_simp_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span>
       <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">c'</span> <span class="skolem">s'</span>
       <span class="keyword3"><span class="command">assume</span></span> st<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≈</span> <span class="skolem">t</span>"</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Par <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
       <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span>Par <span class="skolem">d1</span> <span class="skolem">d2</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="bound">d'</span><span class="main">)</span> <span class="main">∈</span> thetaPar <span class="main">∪</span> Sbis"</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">erule</span> Par_transC_invert<span class="main">)</span>
         <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c1'</span> <span class="keyword3"><span class="command">assume</span></span> c1s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c1'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">=</span> Par <span class="skolem">c1'</span> <span class="skolem">c2</span>"</span></span>
         <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d1</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">c1'</span> <span class="keyword1">≈s</span> <span class="bound">d'</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> st matchC_C1 <span class="keyword1"><span class="command">unfolding</span></span> matchC_C_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
         <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> c' thetaPar_def
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">metis</span> ParCL c2d2<span class="main">)</span>
       <span class="keyword1"><span class="command">next</span></span>      
         <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="skolem">s'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">=</span> <span class="skolem">c2</span>"</span></span>
         <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d1</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> st matchT_T1 <span class="keyword1"><span class="command">unfolding</span></span> matchT_T_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
         <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
         <span class="keyword1"><span class="command">unfolding</span></span> c' thetaPar_def
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> PL.ParTL c2d2<span class="main">)</span> 
       <span class="keyword1"><span class="command">next</span></span>
         <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c2'</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c2'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">=</span> Par <span class="skolem">c1</span> <span class="skolem">c2'</span>"</span></span>
         <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d2</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">c2'</span> <span class="keyword1">≈s</span> <span class="bound">d'</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> st matchC_C2 <span class="keyword1"><span class="command">unfolding</span></span> matchC_C_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
         <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
         <span class="keyword1"><span class="command">unfolding</span></span> c' thetaPar_def
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ParCR c1d1<span class="main">)</span>
       <span class="keyword1"><span class="command">next</span></span>
         <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="skolem">s'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">=</span> <span class="skolem">c1</span>"</span></span>
         <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d2</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> st matchT_T2 <span class="keyword1"><span class="command">unfolding</span></span> matchT_T_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
         <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
         <span class="keyword1"><span class="command">unfolding</span></span> c' thetaPar_def
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> PL.ParTR c1d1<span class="main">)</span> 
       <span class="keyword1"><span class="command">qed</span></span>
     <span class="keyword1"><span class="command">qed</span></span> 
   <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">unfold</span> matchT_T_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> thetaPar_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Compositionality-thetaPar_Sbis"><span class="command">lemma</span></span> thetaPar_Sbis<span class="main">:</span>
<span class="quoted"><span class="quoted">"thetaPar <span class="main">⊆</span> Sbis"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Sbis_coind<span class="main">)</span>
<span class="keyword1"><span class="command">using</span></span> thetaPar_sym thetaPar_Sretr <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> Par_Sbis<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c1</span> <span class="keyword1">≈s</span> <span class="free">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">c2</span> <span class="keyword1">≈s</span> <span class="free">d2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Par <span class="free">c1</span> <span class="free">c2</span> <span class="keyword1">≈s</span> Par <span class="free">d1</span> <span class="free">d2</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms thetaPar_Sbis <span class="keyword1"><span class="command">unfolding</span></span> thetaPar_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹01T-bisimilarity versus language constructs›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Atomic commands:›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> Atm_ZObisT<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"compatAtm <span class="free">atm</span>"</span></span> 
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Atm <span class="free">atm</span> <span class="keyword1">≈01T</span> Atm <span class="free">atm</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Atm_Sbis assms bis_imp<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Sequential composition:›</span></span> 

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">thetaSeqZOT</span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">thetaSeqZOT</span> <span class="main">≡</span> 
 <span class="main">{</span><span class="main">(</span><span class="bound">c1</span> <span class="main">;;</span> <span class="bound">c2</span><span class="main">,</span> <span class="bound">d1</span> <span class="main">;;</span> <span class="bound">d2</span><span class="main">)</span> <span class="main">|</span> <span class="bound">c1</span> <span class="bound">c2</span> <span class="bound">d1</span> <span class="bound">d2</span><span class="main">.</span> <span class="bound">c1</span> <span class="keyword1">≈01T</span> <span class="bound">d1</span> <span class="main">∧</span> <span class="bound">c2</span> <span class="keyword1">≈01T</span> <span class="bound">d2</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Compositionality-thetaSeqZOT_sym"><span class="command">lemma</span></span> thetaSeqZOT_sym<span class="main">:</span>
<span class="quoted"><span class="quoted">"sym thetaSeqZOT"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> thetaSeqZOT_def sym_def <span class="keyword1"><span class="command">using</span></span> ZObisT_Sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Compositionality-thetaSeqZOT_ZOretrT"><span class="command">lemma</span></span> thetaSeqZOT_ZOretrT<span class="main">:</span>
<span class="quoted"><span class="quoted">"thetaSeqZOT <span class="main">⊆</span> ZOretrT <span class="main">(</span>thetaSeqZOT <span class="keyword1">Un</span> ZObisT<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c1</span> <span class="skolem">c2</span> <span class="skolem">d1</span> <span class="skolem">d2</span>
   <span class="keyword3"><span class="command">assume</span></span> c1d1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span> <span class="keyword1">≈01T</span> <span class="skolem">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c2d2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c2</span> <span class="keyword1">≈01T</span> <span class="skolem">d2</span>"</span></span>
   <span class="keyword1"><span class="command">hence</span></span> matchC_ZOC1<span class="main">:</span> <span class="quoted"><span class="quoted">"matchC_ZOC ZObisT <span class="skolem">c1</span> <span class="skolem">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> matchC_ZOC2<span class="main">:</span> <span class="quoted"><span class="quoted">"matchC_ZOC ZObisT <span class="skolem">c2</span> <span class="skolem">d2</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> matchT_T1<span class="main">:</span> <span class="quoted"><span class="quoted">"matchT_T <span class="skolem">c1</span> <span class="skolem">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> matchT_T2<span class="main">:</span> <span class="quoted"><span class="quoted">"matchT_T <span class="skolem">c2</span> <span class="skolem">d2</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> ZObisT_matchC_ZOC ZObisT_matchT_T <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span> <span class="main">;;</span> <span class="skolem">c2</span><span class="main">,</span> <span class="skolem">d1</span> <span class="main">;;</span> <span class="skolem">d2</span><span class="main">)</span> <span class="main">∈</span> ZOretrT <span class="main">(</span>thetaSeqZOT <span class="keyword1">Un</span> ZObisT<span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">unfolding</span></span> ZOretrT_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"matchC_ZOC <span class="main">(</span>thetaSeqZOT <span class="keyword1">Un</span> ZObisT<span class="main">)</span> <span class="main">(</span><span class="skolem">c1</span> <span class="main">;;</span> <span class="skolem">c2</span><span class="main">)</span> <span class="main">(</span><span class="skolem">d1</span> <span class="main">;;</span> <span class="skolem">d2</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">unfolding</span></span> matchC_ZOC_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="entity">mauto_no_simp_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span>
       <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">c'</span> <span class="skolem">s'</span>
       <span class="keyword3"><span class="command">assume</span></span> st<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≈</span> <span class="skolem">t</span>"</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span> <span class="main">;;</span> <span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
       <span class="keyword3"><span class="command">thus</span></span> 
       <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">≈</span> <span class="skolem">t</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="skolem">d1</span> <span class="main">;;</span> <span class="skolem">d2</span><span class="main">)</span> <span class="main">∈</span> thetaSeqZOT <span class="keyword1">Un</span> ZObisT<span class="main">)</span> <span class="main">∨</span>
        <span class="main">(</span><span class="main">∃</span><span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d1</span> <span class="main">;;</span> <span class="skolem">d2</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="bound">d'</span><span class="main">)</span> <span class="main">∈</span> thetaSeqZOT <span class="keyword1">Un</span> ZObisT<span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">erule</span> Seq_transC_invert<span class="main">)</span>
         <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c1'</span> <span class="keyword3"><span class="command">assume</span></span> c1s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c1'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">=</span> <span class="skolem">c1'</span> <span class="main">;;</span> <span class="skolem">c2</span>"</span></span>
         <span class="keyword1"><span class="command">hence</span></span>
         <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">≈</span> <span class="skolem">t</span> <span class="main">∧</span> <span class="skolem">c1'</span> <span class="keyword1">≈01T</span> <span class="skolem">d1</span><span class="main">)</span> <span class="main">∨</span> 
          <span class="main">(</span><span class="main">∃</span><span class="bound">d1'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d1</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">d1'</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">c1'</span> <span class="keyword1">≈01T</span> <span class="bound">d1'</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> st matchC_ZOC1 <span class="keyword1"><span class="command">unfolding</span></span> matchC_ZOC_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
         <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> c' thetaSeqZOT_def
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="entity">mauto_no_simp_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> c2d2<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> SeqC c2d2 <span class="main">)</span> 
       <span class="keyword1"><span class="command">next</span></span>      
         <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="skolem">s'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">=</span> <span class="skolem">c2</span>"</span></span>
         <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d1</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> st matchT_T1 <span class="keyword1"><span class="command">unfolding</span></span> matchT_T_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
         <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
         <span class="keyword1"><span class="command">unfolding</span></span> c' thetaSeqZOT_def
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="entity">mauto_no_simp_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> PL.SeqT c2d2<span class="main">)</span> 
       <span class="keyword1"><span class="command">qed</span></span>
     <span class="keyword1"><span class="command">qed</span></span> 
   <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">unfold</span> matchT_T_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> thetaSeqZOT_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Compositionality-thetaSeqZOT_ZObisT"><span class="command">lemma</span></span> thetaSeqZOT_ZObisT<span class="main">:</span>
<span class="quoted"><span class="quoted">"thetaSeqZOT <span class="main">⊆</span> ZObisT"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ZObisT_coind<span class="main">)</span>
<span class="keyword1"><span class="command">using</span></span> thetaSeqZOT_sym thetaSeqZOT_ZOretrT <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> Seq_ZObisT<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c1</span> <span class="keyword1">≈01T</span> <span class="free">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">c2</span> <span class="keyword1">≈01T</span> <span class="free">d2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">c1</span> <span class="main">;;</span> <span class="free">c2</span> <span class="keyword1">≈01T</span> <span class="free">d1</span> <span class="main">;;</span> <span class="free">d2</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms thetaSeqZOT_ZObisT <span class="keyword1"><span class="command">unfolding</span></span> thetaSeqZOT_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Conditional:›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">thetaIfZOT</span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">thetaIfZOT</span> <span class="main">≡</span> 
 <span class="main">{</span><span class="main">(</span>If <span class="bound">tst</span> <span class="bound">c1</span> <span class="bound">c2</span><span class="main">,</span> If <span class="bound">tst</span> <span class="bound">d1</span> <span class="bound">d2</span><span class="main">)</span> <span class="main">|</span> <span class="bound">tst</span> <span class="bound">c1</span> <span class="bound">c2</span> <span class="bound">d1</span> <span class="bound">d2</span><span class="main">.</span> compatTst <span class="bound">tst</span> <span class="main">∧</span> <span class="bound">c1</span> <span class="keyword1">≈01T</span> <span class="bound">d1</span> <span class="main">∧</span> <span class="bound">c2</span> <span class="keyword1">≈01T</span> <span class="bound">d2</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Compositionality-thetaIfZOT_sym"><span class="command">lemma</span></span> thetaIfZOT_sym<span class="main">:</span>
<span class="quoted"><span class="quoted">"sym thetaIfZOT"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> thetaIfZOT_def sym_def <span class="keyword1"><span class="command">using</span></span> ZObisT_Sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Compositionality-thetaIfZOT_ZOretrT"><span class="command">lemma</span></span> thetaIfZOT_ZOretrT<span class="main">:</span>
<span class="quoted"><span class="quoted">"thetaIfZOT <span class="main">⊆</span> ZOretrT <span class="main">(</span>thetaIfZOT <span class="keyword1">Un</span> ZObisT<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">tst</span> <span class="skolem">c1</span> <span class="skolem">c2</span> <span class="skolem">d1</span> <span class="skolem">d2</span>
   <span class="keyword3"><span class="command">assume</span></span> tst<span class="main">:</span> <span class="quoted"><span class="quoted">"compatTst <span class="skolem">tst</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c1d1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span> <span class="keyword1">≈01T</span> <span class="skolem">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c2d2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c2</span> <span class="keyword1">≈01T</span> <span class="skolem">d2</span>"</span></span>
   <span class="keyword1"><span class="command">hence</span></span> matchC_ZOC1<span class="main">:</span> <span class="quoted"><span class="quoted">"matchC_ZOC ZObisT <span class="skolem">c1</span> <span class="skolem">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> matchC_ZOC2<span class="main">:</span> <span class="quoted"><span class="quoted">"matchC_ZOC ZObisT <span class="skolem">c2</span> <span class="skolem">d2</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> matchT_T1<span class="main">:</span> <span class="quoted"><span class="quoted">"matchT_T <span class="skolem">c1</span> <span class="skolem">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> matchT_T2<span class="main">:</span> <span class="quoted"><span class="quoted">"matchT_T <span class="skolem">c2</span> <span class="skolem">d2</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> ZObisT_matchC_ZOC ZObisT_matchT_T <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>If <span class="skolem">tst</span> <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">,</span> If <span class="skolem">tst</span> <span class="skolem">d1</span> <span class="skolem">d2</span><span class="main">)</span> <span class="main">∈</span> ZOretrT <span class="main">(</span>thetaIfZOT <span class="keyword1">Un</span> ZObisT<span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">unfolding</span></span> ZOretrT_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"matchC_ZOC <span class="main">(</span>thetaIfZOT <span class="keyword1">Un</span> ZObisT<span class="main">)</span> <span class="main">(</span>If <span class="skolem">tst</span> <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">)</span> <span class="main">(</span>If <span class="skolem">tst</span> <span class="skolem">d1</span> <span class="skolem">d2</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">unfolding</span></span> matchC_ZOC_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="entity">mauto_no_simp_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span>
       <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">c'</span> <span class="skolem">s'</span>
       <span class="keyword3"><span class="command">assume</span></span> st<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≈</span> <span class="skolem">t</span>"</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>If <span class="skolem">tst</span> <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
       <span class="keyword3"><span class="command">thus</span></span> 
       <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">≈</span> <span class="skolem">t</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> If <span class="skolem">tst</span> <span class="skolem">d1</span> <span class="skolem">d2</span><span class="main">)</span> <span class="main">∈</span> thetaIfZOT <span class="keyword1">Un</span> ZObisT<span class="main">)</span> <span class="main">∨</span>
        <span class="main">(</span><span class="main">∃</span><span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span>If <span class="skolem">tst</span> <span class="skolem">d1</span> <span class="skolem">d2</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="bound">d'</span><span class="main">)</span> <span class="main">∈</span> thetaIfZOT <span class="keyword1">Un</span> ZObisT<span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> If_transC_invert<span class="main">)</span>
       <span class="keyword1"><span class="command">unfolding</span></span> thetaIfZOT_def 
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> IfTrue c1d1 compatTst_def st tst<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IfFalse c2d2 compatTst_def st tst<span class="main">)</span>
     <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">unfold</span> matchT_T_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> thetaIfZOT_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Compositionality-thetaIfZOT_ZObisT"><span class="command">lemma</span></span> thetaIfZOT_ZObisT<span class="main">:</span>
<span class="quoted"><span class="quoted">"thetaIfZOT <span class="main">⊆</span> ZObisT"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ZObisT_coind<span class="main">)</span>
<span class="keyword1"><span class="command">using</span></span> thetaIfZOT_sym thetaIfZOT_ZOretrT <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> If_ZObisT<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"compatTst <span class="free">tst</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">c1</span> <span class="keyword1">≈01T</span> <span class="free">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">c2</span> <span class="keyword1">≈01T</span> <span class="free">d2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"If <span class="free">tst</span> <span class="free">c1</span> <span class="free">c2</span> <span class="keyword1">≈01T</span> If <span class="free">tst</span> <span class="free">d1</span> <span class="free">d2</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms thetaIfZOT_ZObisT <span class="keyword1"><span class="command">unfolding</span></span> thetaIfZOT_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹While loop:›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">thetaWhileZOT</span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">thetaWhileZOT</span> <span class="main">≡</span> 
 <span class="main">{</span><span class="main">(</span>While <span class="bound">tst</span> <span class="bound">c</span><span class="main">,</span> While <span class="bound">tst</span> <span class="bound">d</span><span class="main">)</span> <span class="main">|</span> <span class="bound">tst</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">.</span> compatTst <span class="bound">tst</span> <span class="main">∧</span> <span class="bound">c</span> <span class="keyword1">≈01T</span> <span class="bound">d</span><span class="main">}</span> <span class="keyword1">Un</span> 
 <span class="main">{</span><span class="main">(</span><span class="bound">c1</span> <span class="main">;;</span> <span class="main">(</span>While <span class="bound">tst</span> <span class="bound">c</span><span class="main">)</span><span class="main">,</span> <span class="bound">d1</span> <span class="main">;;</span> <span class="main">(</span>While <span class="bound">tst</span> <span class="bound">d</span><span class="main">)</span><span class="main">)</span> <span class="main">|</span> <span class="bound">tst</span> <span class="bound">c1</span> <span class="bound">d1</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">.</span> compatTst <span class="bound">tst</span> <span class="main">∧</span> <span class="bound">c1</span> <span class="keyword1">≈01T</span> <span class="bound">d1</span> <span class="main">∧</span> <span class="bound">c</span> <span class="keyword1">≈01T</span> <span class="bound">d</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Compositionality-thetaWhileZOT_sym"><span class="command">lemma</span></span> thetaWhileZOT_sym<span class="main">:</span>
<span class="quoted"><span class="quoted">"sym thetaWhileZOT"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> thetaWhileZOT_def sym_def <span class="keyword1"><span class="command">using</span></span> ZObisT_Sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Compositionality-thetaWhileZOT_ZOretrT"><span class="command">lemma</span></span> thetaWhileZOT_ZOretrT<span class="main">:</span>
<span class="quoted"><span class="quoted">"thetaWhileZOT <span class="main">⊆</span> ZOretrT <span class="main">(</span>thetaWhileZOT <span class="keyword1">Un</span> ZObisT<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">tst</span> <span class="skolem">c</span> <span class="skolem">d</span> 
   <span class="keyword3"><span class="command">assume</span></span> tst<span class="main">:</span> <span class="quoted"><span class="quoted">"compatTst <span class="skolem">tst</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c_d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="keyword1">≈01T</span> <span class="skolem">d</span>"</span></span>
   <span class="keyword1"><span class="command">hence</span></span> matchC_ZOC<span class="main">:</span> <span class="quoted"><span class="quoted">"matchC_ZOC ZObisT <span class="skolem">c</span> <span class="skolem">d</span>"</span></span> 
     <span class="keyword2"><span class="keyword">and</span></span> matchT_T<span class="main">:</span> <span class="quoted"><span class="quoted">"matchT_T <span class="skolem">c</span> <span class="skolem">d</span>"</span></span> 
   <span class="keyword1"><span class="command">using</span></span> ZObisT_matchC_ZOC ZObisT_matchT_T <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>While <span class="skolem">tst</span> <span class="skolem">c</span><span class="main">,</span> While <span class="skolem">tst</span> <span class="skolem">d</span><span class="main">)</span> <span class="main">∈</span> ZOretrT <span class="main">(</span>thetaWhileZOT <span class="keyword1">Un</span> ZObisT<span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">unfolding</span></span> ZOretrT_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"matchC_ZOC <span class="main">(</span>thetaWhileZOT <span class="main">∪</span> ZObisT<span class="main">)</span> <span class="main">(</span>While <span class="skolem">tst</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">(</span>While <span class="skolem">tst</span> <span class="skolem">d</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">unfolding</span></span> matchC_ZOC_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="entity">mauto_no_simp_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span>
       <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">c'</span> <span class="skolem">s'</span>
       <span class="keyword3"><span class="command">assume</span></span> st<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≈</span> <span class="skolem">t</span>"</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>While <span class="skolem">tst</span> <span class="skolem">c</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
       <span class="keyword3"><span class="command">thus</span></span> 
       <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">≈</span> <span class="skolem">t</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> While <span class="skolem">tst</span> <span class="skolem">d</span><span class="main">)</span> <span class="main">∈</span> thetaWhileZOT <span class="main">∪</span> ZObisT<span class="main">)</span> <span class="main">∨</span> 
        <span class="main">(</span><span class="main">∃</span><span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span>While <span class="skolem">tst</span> <span class="skolem">d</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="bound">d'</span><span class="main">)</span> <span class="main">∈</span> thetaWhileZOT <span class="main">∪</span> ZObisT<span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> While_transC_invert<span class="main">)</span>
       <span class="keyword1"><span class="command">unfolding</span></span> thetaWhileZOT_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> WhileTrue c_d compatTst_def st tst<span class="main">)</span>
     <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">next</span></span>
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"matchT_T <span class="main">(</span>While <span class="skolem">tst</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">(</span>While <span class="skolem">tst</span> <span class="skolem">d</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">unfolding</span></span> matchT_T_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="entity">mauto_no_simp_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span>
       <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">s'</span> <span class="keyword3"><span class="command">assume</span></span> st<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≈</span> <span class="skolem">t</span>"</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>While <span class="skolem">tst</span> <span class="skolem">c</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="skolem">s'</span>"</span></span>
       <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t'</span><span class="main">.</span> <span class="main">(</span>While <span class="skolem">tst</span> <span class="skolem">d</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> "</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> While_transT_invert<span class="main">)</span>
       <span class="keyword1"><span class="command">unfolding</span></span> thetaWhileZOT_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> PL.WhileFalse compatTst_def st tst<span class="main">)</span>    
     <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> 
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">tst</span> <span class="skolem">c1</span> <span class="skolem">d1</span>  <span class="skolem">c</span> <span class="skolem">d</span>
   <span class="keyword3"><span class="command">assume</span></span> tst<span class="main">:</span> <span class="quoted"><span class="quoted">"compatTst <span class="skolem">tst</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c1d1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span> <span class="keyword1">≈01T</span> <span class="skolem">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c_d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="keyword1">≈01T</span> <span class="skolem">d</span>"</span></span>
   <span class="keyword1"><span class="command">hence</span></span> matchC_ZOC1<span class="main">:</span> <span class="quoted"><span class="quoted">"matchC_ZOC ZObisT <span class="skolem">c1</span> <span class="skolem">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> matchC_ZOC<span class="main">:</span> <span class="quoted"><span class="quoted">"matchC_ZOC ZObisT <span class="skolem">c</span> <span class="skolem">d</span>"</span></span> 
     <span class="keyword2"><span class="keyword">and</span></span> matchT_T1<span class="main">:</span> <span class="quoted"><span class="quoted">"matchT_T <span class="skolem">c1</span> <span class="skolem">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> matchT_T<span class="main">:</span> <span class="quoted"><span class="quoted">"matchT_T <span class="skolem">c</span> <span class="skolem">d</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> ZObisT_matchC_ZOC ZObisT_matchT_T <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span> <span class="main">;;</span> <span class="main">(</span>While <span class="skolem">tst</span> <span class="skolem">c</span><span class="main">)</span><span class="main">,</span> <span class="skolem">d1</span> <span class="main">;;</span> <span class="main">(</span>While <span class="skolem">tst</span> <span class="skolem">d</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> ZOretrT <span class="main">(</span>thetaWhileZOT <span class="keyword1">Un</span> ZObisT<span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">unfolding</span></span> ZOretrT_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"matchC_ZOC <span class="main">(</span>thetaWhileZOT <span class="main">∪</span> ZObisT<span class="main">)</span> <span class="main">(</span><span class="skolem">c1</span> <span class="main">;;</span> <span class="main">(</span>While <span class="skolem">tst</span> <span class="skolem">c</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">d1</span> <span class="main">;;</span> <span class="main">(</span>While <span class="skolem">tst</span> <span class="skolem">d</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">unfolding</span></span> matchC_ZOC_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="entity">mauto_no_simp_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span>
       <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">c'</span> <span class="skolem">s'</span>
       <span class="keyword3"><span class="command">assume</span></span> st<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≈</span> <span class="skolem">t</span>"</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span> <span class="main">;;</span> <span class="main">(</span>While <span class="skolem">tst</span> <span class="skolem">c</span><span class="main">)</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
       <span class="keyword3"><span class="command">thus</span></span> 
       <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">≈</span> <span class="skolem">t</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="skolem">d1</span> <span class="main">;;</span> <span class="main">(</span>While <span class="skolem">tst</span> <span class="skolem">d</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> thetaWhileZOT <span class="main">∪</span> ZObisT<span class="main">)</span> <span class="main">∨</span> 
        <span class="main">(</span><span class="main">∃</span><span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d1</span> <span class="main">;;</span> <span class="main">(</span>While <span class="skolem">tst</span> <span class="skolem">d</span><span class="main">)</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="bound">d'</span><span class="main">)</span> <span class="main">∈</span> thetaWhileZOT <span class="main">∪</span> ZObisT<span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">erule</span> Seq_transC_invert<span class="main">)</span>
         <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c1'</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c1'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">=</span> <span class="skolem">c1'</span> <span class="main">;;</span> <span class="main">(</span>While <span class="skolem">tst</span> <span class="skolem">c</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">hence</span></span> 
         <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">≈</span> <span class="skolem">t</span> <span class="main">∧</span> <span class="skolem">c1'</span> <span class="keyword1">≈01T</span> <span class="skolem">d1</span><span class="main">)</span> <span class="main">∨</span> 
          <span class="main">(</span><span class="main">∃</span><span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d1</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">c1'</span> <span class="keyword1">≈01T</span> <span class="bound">d'</span><span class="main">)</span>"</span></span> 
         <span class="keyword1"><span class="command">using</span></span> st matchC_ZOC1 <span class="keyword1"><span class="command">unfolding</span></span> matchC_ZOC_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
         <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
         <span class="keyword1"><span class="command">unfolding</span></span> c' thetaWhileZOT_def
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="entity">mauto_no_simp_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> c_d tst<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> SeqC c_d tst<span class="main">)</span> 
       <span class="keyword1"><span class="command">next</span></span>
         <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="skolem">s'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">=</span> While <span class="skolem">tst</span> <span class="skolem">c</span>"</span></span>
         <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d1</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> st matchT_T1 <span class="keyword1"><span class="command">unfolding</span></span> matchT_T_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
         <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
         <span class="keyword1"><span class="command">unfolding</span></span> c' thetaWhileZOT_def 
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> PL.SeqT c_d tst<span class="main">)</span> 
       <span class="keyword1"><span class="command">qed</span></span>
     <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">unfold</span> matchT_T_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> thetaWhileZOT_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Compositionality-thetaWhileZOT_ZObisT"><span class="command">lemma</span></span> thetaWhileZOT_ZObisT<span class="main">:</span>
<span class="quoted"><span class="quoted">"thetaWhileZOT <span class="main">⊆</span> ZObisT"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ZObisT_coind<span class="main">)</span>
<span class="keyword1"><span class="command">using</span></span> thetaWhileZOT_sym thetaWhileZOT_ZOretrT <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> While_ZObisT<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"compatTst <span class="free">tst</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="keyword1">≈01T</span> <span class="free">d</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"While <span class="free">tst</span> <span class="free">c</span> <span class="keyword1">≈01T</span> While <span class="free">tst</span> <span class="free">d</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms thetaWhileZOT_ZObisT <span class="keyword1"><span class="command">unfolding</span></span> thetaWhileZOT_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Parallel composition:›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">thetaParZOT</span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">thetaParZOT</span> <span class="main">≡</span> 
 <span class="main">{</span><span class="main">(</span>Par <span class="bound">c1</span> <span class="bound">c2</span><span class="main">,</span> Par <span class="bound">d1</span> <span class="bound">d2</span><span class="main">)</span> <span class="main">|</span> <span class="bound">c1</span> <span class="bound">c2</span> <span class="bound">d1</span> <span class="bound">d2</span><span class="main">.</span> <span class="bound">c1</span> <span class="keyword1">≈01T</span> <span class="bound">d1</span> <span class="main">∧</span> <span class="bound">c2</span> <span class="keyword1">≈01T</span> <span class="bound">d2</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Compositionality-thetaParZOT_sym"><span class="command">lemma</span></span> thetaParZOT_sym<span class="main">:</span>
<span class="quoted"><span class="quoted">"sym thetaParZOT"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> thetaParZOT_def sym_def <span class="keyword1"><span class="command">using</span></span> ZObisT_Sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Compositionality-thetaParZOT_ZOretrT"><span class="command">lemma</span></span> thetaParZOT_ZOretrT<span class="main">:</span>
<span class="quoted"><span class="quoted">"thetaParZOT <span class="main">⊆</span> ZOretrT <span class="main">(</span>thetaParZOT <span class="keyword1">Un</span> ZObisT<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c1</span> <span class="skolem">c2</span> <span class="skolem">d1</span> <span class="skolem">d2</span>
   <span class="keyword3"><span class="command">assume</span></span> c1d1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span> <span class="keyword1">≈01T</span> <span class="skolem">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c2d2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c2</span> <span class="keyword1">≈01T</span> <span class="skolem">d2</span>"</span></span>
   <span class="keyword1"><span class="command">hence</span></span> matchC_ZOC1<span class="main">:</span> <span class="quoted"><span class="quoted">"matchC_ZOC ZObisT <span class="skolem">c1</span> <span class="skolem">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> matchC_ZOC2<span class="main">:</span> <span class="quoted"><span class="quoted">"matchC_ZOC ZObisT <span class="skolem">c2</span> <span class="skolem">d2</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> matchT_T1<span class="main">:</span> <span class="quoted"><span class="quoted">"matchT_T <span class="skolem">c1</span> <span class="skolem">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> matchT_T2<span class="main">:</span> <span class="quoted"><span class="quoted">"matchT_T <span class="skolem">c2</span> <span class="skolem">d2</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> ZObisT_matchC_ZOC ZObisT_matchT_T <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Par <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">,</span> Par <span class="skolem">d1</span> <span class="skolem">d2</span><span class="main">)</span> <span class="main">∈</span> ZOretrT <span class="main">(</span>thetaParZOT <span class="keyword1">Un</span> ZObisT<span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">unfolding</span></span> ZOretrT_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"matchC_ZOC <span class="main">(</span>thetaParZOT <span class="main">∪</span> ZObisT<span class="main">)</span> <span class="main">(</span>Par <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">)</span> <span class="main">(</span>Par <span class="skolem">d1</span> <span class="skolem">d2</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">unfolding</span></span> matchC_ZOC_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="entity">mauto_no_simp_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span>
       <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">c'</span> <span class="skolem">s'</span>
       <span class="keyword3"><span class="command">assume</span></span> st<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≈</span> <span class="skolem">t</span>"</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Par <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
       <span class="keyword3"><span class="command">thus</span></span> 
       <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">≈</span> <span class="skolem">t</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> Par <span class="skolem">d1</span> <span class="skolem">d2</span><span class="main">)</span> <span class="main">∈</span> thetaParZOT <span class="main">∪</span> ZObisT<span class="main">)</span> <span class="main">∨</span>
        <span class="main">(</span><span class="main">∃</span><span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span>Par <span class="skolem">d1</span> <span class="skolem">d2</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="bound">d'</span><span class="main">)</span> <span class="main">∈</span> thetaParZOT <span class="main">∪</span> ZObisT<span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">erule</span> Par_transC_invert<span class="main">)</span>
         <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c1'</span> <span class="keyword3"><span class="command">assume</span></span> c1s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c1'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">=</span> Par <span class="skolem">c1'</span> <span class="skolem">c2</span>"</span></span>
         <span class="keyword1"><span class="command">hence</span></span>
         <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">≈</span> <span class="skolem">t</span> <span class="main">∧</span> <span class="skolem">c1'</span> <span class="keyword1">≈01T</span> <span class="skolem">d1</span><span class="main">)</span> <span class="main">∨</span> 
          <span class="main">(</span><span class="main">∃</span><span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d1</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">c1'</span> <span class="keyword1">≈01T</span> <span class="bound">d'</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> st matchC_ZOC1 <span class="keyword1"><span class="command">unfolding</span></span> matchC_ZOC_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
         <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> c' thetaParZOT_def
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="entity">mauto_no_simp_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> c2d2<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">metis</span> ParCL c2d2<span class="main">)</span>
       <span class="keyword1"><span class="command">next</span></span>      
         <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="skolem">s'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">=</span> <span class="skolem">c2</span>"</span></span>
         <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d1</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> st matchT_T1 <span class="keyword1"><span class="command">unfolding</span></span> matchT_T_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
         <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
         <span class="keyword1"><span class="command">unfolding</span></span> c' thetaParZOT_def
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> PL.ParTL c2d2<span class="main">)</span> 
       <span class="keyword1"><span class="command">next</span></span>
         <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c2'</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c2'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">=</span> Par <span class="skolem">c1</span> <span class="skolem">c2'</span>"</span></span>
         <span class="keyword1"><span class="command">hence</span></span> 
         <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">≈</span> <span class="skolem">t</span> <span class="main">∧</span> <span class="skolem">c2'</span> <span class="keyword1">≈01T</span> <span class="skolem">d2</span><span class="main">)</span> <span class="main">∨</span> 
          <span class="main">(</span><span class="main">∃</span><span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d2</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">c2'</span> <span class="keyword1">≈01T</span> <span class="bound">d'</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> st matchC_ZOC2 <span class="keyword1"><span class="command">unfolding</span></span> matchC_ZOC_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
         <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
         <span class="keyword1"><span class="command">unfolding</span></span> c' thetaParZOT_def
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="entity">mauto_no_simp_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> c1d1<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ParCR c1d1<span class="main">)</span>
       <span class="keyword1"><span class="command">next</span></span>
         <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="skolem">s'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">=</span> <span class="skolem">c1</span>"</span></span>
         <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d2</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> st matchT_T2 <span class="keyword1"><span class="command">unfolding</span></span> matchT_T_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
         <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
         <span class="keyword1"><span class="command">unfolding</span></span> c' thetaParZOT_def
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> PL.ParTR c1d1<span class="main">)</span> 
       <span class="keyword1"><span class="command">qed</span></span>
     <span class="keyword1"><span class="command">qed</span></span> 
   <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">unfold</span> matchT_T_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> thetaParZOT_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Compositionality-thetaParZOT_ZObisT"><span class="command">lemma</span></span> thetaParZOT_ZObisT<span class="main">:</span>
<span class="quoted"><span class="quoted">"thetaParZOT <span class="main">⊆</span> ZObisT"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ZObisT_coind<span class="main">)</span>
<span class="keyword1"><span class="command">using</span></span> thetaParZOT_sym thetaParZOT_ZOretrT <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> Par_ZObisT<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c1</span> <span class="keyword1">≈01T</span> <span class="free">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">c2</span> <span class="keyword1">≈01T</span> <span class="free">d2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Par <span class="free">c1</span> <span class="free">c2</span> <span class="keyword1">≈01T</span> Par <span class="free">d1</span> <span class="free">d2</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms thetaParZOT_ZObisT <span class="keyword1"><span class="command">unfolding</span></span> thetaParZOT_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹01-bisimilarity versus language constructs›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Discreetness:›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> discr_ZObis<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"discr <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"discr <span class="free">d</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≈01</span> <span class="free">d</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?theta</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">c</span><span class="main">,</span><span class="bound">d</span><span class="main">)</span> <span class="main">|</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">.</span> discr <span class="bound">c</span> <span class="main">∧</span> discr <span class="bound">d</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?theta</span> <span class="main">⊆</span> ZObis"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> ZObis_raw_coind<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sym <span class="var">?theta</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sym_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?theta</span> <span class="main">⊆</span> ZOretr <span class="var">?theta</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">clarify</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span> <span class="skolem">d</span> <span class="keyword3"><span class="command">assume</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"discr <span class="skolem">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"discr <span class="skolem">d</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c</span><span class="main">,</span> <span class="skolem">d</span><span class="main">)</span> <span class="main">∈</span> ZOretr <span class="var">?theta</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> ZOretr_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"matchC_ZO <span class="var">?theta</span> <span class="skolem">c</span> <span class="skolem">d</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> matchC_ZO_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="entity">mauto_no_simp_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">c'</span> <span class="skolem">s'</span>
          <span class="keyword3"><span class="command">assume</span></span> st<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≈</span> <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> cs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
          <span class="keyword3"><span class="command">show</span></span> 
          <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">≈</span> <span class="skolem">t</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="skolem">d</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?theta</span><span class="main">)</span> <span class="main">∨</span>
           <span class="main">(</span><span class="main">∃</span><span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="bound">d'</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?theta</span><span class="main">)</span> <span class="main">∨</span>
           <span class="main">(</span><span class="main">∃</span><span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> discr <span class="skolem">c'</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≈</span> <span class="skolem">s'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c cs discr_transC_indis <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">hence</span></span> s't<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">≈</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> st indis_trans indis_sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"discr <span class="skolem">c'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c cs discr_transC <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c'</span><span class="main">,</span><span class="skolem">d</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?theta</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> d <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> s't <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"matchT_ZO <span class="skolem">c</span> <span class="skolem">d</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> matchT_ZO_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="entity">mauto_no_simp_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">s'</span>
          <span class="keyword3"><span class="command">assume</span></span> st<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≈</span> <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> cs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="skolem">s'</span>"</span></span>
          <span class="keyword3"><span class="command">show</span></span> 
          <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">≈</span> <span class="skolem">t</span> <span class="main">∧</span> discr <span class="skolem">d</span><span class="main">)</span> <span class="main">∨</span>
           <span class="main">(</span><span class="main">∃</span><span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> discr <span class="bound">d'</span><span class="main">)</span> <span class="main">∨</span>
           <span class="main">(</span><span class="main">∃</span><span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≈</span> <span class="skolem">s'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c cs discr_transT <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">hence</span></span> s't<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">≈</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> st indis_trans indis_sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> d <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Atomic commands:›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> Atm_ZObis<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"compatAtm <span class="free">atm</span>"</span></span> 
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Atm <span class="free">atm</span> <span class="main">≈01</span> Atm <span class="free">atm</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Atm_Sbis assms bis_imp<span class="main">)</span> 

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Sequential composition:›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">thetaSeqZO</span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">thetaSeqZO</span> <span class="main">≡</span> 
 <span class="main">{</span><span class="main">(</span><span class="bound">c1</span> <span class="main">;;</span> <span class="bound">c2</span><span class="main">,</span> <span class="bound">d1</span> <span class="main">;;</span> <span class="bound">d2</span><span class="main">)</span> <span class="main">|</span> <span class="bound">c1</span> <span class="bound">c2</span> <span class="bound">d1</span> <span class="bound">d2</span><span class="main">.</span> <span class="bound">c1</span> <span class="keyword1">≈01T</span> <span class="bound">d1</span> <span class="main">∧</span> <span class="bound">c2</span> <span class="main">≈01</span> <span class="bound">d2</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Compositionality-thetaSeqZO_sym"><span class="command">lemma</span></span> thetaSeqZO_sym<span class="main">:</span>
<span class="quoted"><span class="quoted">"sym thetaSeqZO"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> thetaSeqZO_def sym_def <span class="keyword1"><span class="command">using</span></span> ZObisT_Sym ZObis_Sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Compositionality-thetaSeqZO_ZOretr"><span class="command">lemma</span></span> thetaSeqZO_ZOretr<span class="main">:</span>
<span class="quoted"><span class="quoted">"thetaSeqZO <span class="main">⊆</span> ZOretr <span class="main">(</span>thetaSeqZO <span class="keyword1">Un</span> ZObis<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c1</span> <span class="skolem">c2</span> <span class="skolem">d1</span> <span class="skolem">d2</span>
   <span class="keyword3"><span class="command">assume</span></span> c1d1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span> <span class="keyword1">≈01T</span> <span class="skolem">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c2d2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c2</span> <span class="main">≈01</span> <span class="skolem">d2</span>"</span></span>
   <span class="keyword1"><span class="command">hence</span></span> matchC_ZOC1<span class="main">:</span> <span class="quoted"><span class="quoted">"matchC_ZOC ZObisT <span class="skolem">c1</span> <span class="skolem">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> matchC_ZO2<span class="main">:</span> <span class="quoted"><span class="quoted">"matchC_ZO ZObis <span class="skolem">c2</span> <span class="skolem">d2</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> matchT_T1<span class="main">:</span> <span class="quoted"><span class="quoted">"matchT_T <span class="skolem">c1</span> <span class="skolem">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> matchT_ZO2<span class="main">:</span> <span class="quoted"><span class="quoted">"matchT_ZO <span class="skolem">c2</span> <span class="skolem">d2</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> ZObisT_matchC_ZOC ZObisT_matchT_T ZObis_matchC_ZO ZObis_matchT_ZO <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span> <span class="main">;;</span> <span class="skolem">c2</span><span class="main">,</span> <span class="skolem">d1</span> <span class="main">;;</span> <span class="skolem">d2</span><span class="main">)</span> <span class="main">∈</span> ZOretr <span class="main">(</span>thetaSeqZO <span class="keyword1">Un</span> ZObis<span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">unfolding</span></span> ZOretr_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"matchC_ZO <span class="main">(</span>thetaSeqZO <span class="keyword1">Un</span> ZObis<span class="main">)</span> <span class="main">(</span><span class="skolem">c1</span> <span class="main">;;</span> <span class="skolem">c2</span><span class="main">)</span> <span class="main">(</span><span class="skolem">d1</span> <span class="main">;;</span> <span class="skolem">d2</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">unfolding</span></span> matchC_ZO_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="entity">mauto_no_simp_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span>
       <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">c'</span> <span class="skolem">s'</span>
       <span class="keyword3"><span class="command">assume</span></span> st<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≈</span> <span class="skolem">t</span>"</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span> <span class="main">;;</span> <span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
       <span class="keyword3"><span class="command">thus</span></span> 
       <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">≈</span> <span class="skolem">t</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="skolem">d1</span> <span class="main">;;</span> <span class="skolem">d2</span><span class="main">)</span> <span class="main">∈</span> thetaSeqZO <span class="keyword1">Un</span> ZObis<span class="main">)</span> <span class="main">∨</span>
        <span class="main">(</span><span class="main">∃</span><span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d1</span> <span class="main">;;</span> <span class="skolem">d2</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="bound">d'</span><span class="main">)</span> <span class="main">∈</span> thetaSeqZO <span class="keyword1">Un</span> ZObis<span class="main">)</span> <span class="main">∨</span> 
        <span class="main">(</span><span class="main">∃</span><span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d1</span> <span class="main">;;</span> <span class="skolem">d2</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> discr <span class="skolem">c'</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">erule</span> Seq_transC_invert<span class="main">)</span>
         <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c1'</span> <span class="keyword3"><span class="command">assume</span></span> c1s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c1'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">=</span> <span class="skolem">c1'</span> <span class="main">;;</span> <span class="skolem">c2</span>"</span></span>
         <span class="keyword1"><span class="command">hence</span></span>
         <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">≈</span> <span class="skolem">t</span> <span class="main">∧</span> <span class="skolem">c1'</span> <span class="keyword1">≈01T</span> <span class="skolem">d1</span><span class="main">)</span> <span class="main">∨</span> 
          <span class="main">(</span><span class="main">∃</span><span class="bound">d1'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d1</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">d1'</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">c1'</span> <span class="keyword1">≈01T</span> <span class="bound">d1'</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> st matchC_ZOC1 <span class="keyword1"><span class="command">unfolding</span></span> matchC_ZOC_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
         <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> c' thetaSeqZO_def
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="entity">mauto_no_simp_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> c2d2<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> SeqC c2d2 <span class="main">)</span> 
       <span class="keyword1"><span class="command">next</span></span>      
         <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="skolem">s'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">=</span> <span class="skolem">c2</span>"</span></span>
         <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d1</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> st matchT_T1 <span class="keyword1"><span class="command">unfolding</span></span> matchT_T_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
         <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
         <span class="keyword1"><span class="command">unfolding</span></span> c' thetaSeqZO_def
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="entity">mauto_no_simp_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> PL.SeqT c2d2<span class="main">)</span> 
       <span class="keyword1"><span class="command">qed</span></span>
     <span class="keyword1"><span class="command">qed</span></span> 
   <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">unfold</span> matchT_ZO_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> thetaSeqZO_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Compositionality-thetaSeqZO_ZObis"><span class="command">lemma</span></span> thetaSeqZO_ZObis<span class="main">:</span>
<span class="quoted"><span class="quoted">"thetaSeqZO <span class="main">⊆</span> ZObis"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ZObis_coind<span class="main">)</span>
<span class="keyword1"><span class="command">using</span></span> thetaSeqZO_sym thetaSeqZO_ZOretr <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> Seq_ZObisT_ZObis<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c1</span> <span class="keyword1">≈01T</span> <span class="free">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">c2</span> <span class="main">≈01</span> <span class="free">d2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">c1</span> <span class="main">;;</span> <span class="free">c2</span> <span class="main">≈01</span> <span class="free">d1</span> <span class="main">;;</span> <span class="free">d2</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms thetaSeqZO_ZObis <span class="keyword1"><span class="command">unfolding</span></span> thetaSeqZO_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">theorem</span></span> Seq_siso_ZObis<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"siso <span class="free">e</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">c2</span> <span class="main">≈01</span> <span class="free">d2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">;;</span> <span class="free">c2</span> <span class="main">≈01</span> <span class="free">e</span> <span class="main">;;</span> <span class="free">d2</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="comment1">(*  *)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">thetaSeqZOD</span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">thetaSeqZOD</span> <span class="main">≡</span> 
 <span class="main">{</span><span class="main">(</span><span class="bound">c1</span> <span class="main">;;</span> <span class="bound">c2</span><span class="main">,</span> <span class="bound">d1</span> <span class="main">;;</span> <span class="bound">d2</span><span class="main">)</span> <span class="main">|</span> <span class="bound">c1</span> <span class="bound">c2</span> <span class="bound">d1</span> <span class="bound">d2</span><span class="main">.</span> <span class="bound">c1</span> <span class="main">≈01</span> <span class="bound">d1</span> <span class="main">∧</span> discr <span class="bound">c2</span> <span class="main">∧</span> discr <span class="bound">d2</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Compositionality-thetaSeqZOD_sym"><span class="command">lemma</span></span> thetaSeqZOD_sym<span class="main">:</span>
<span class="quoted"><span class="quoted">"sym thetaSeqZOD"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> thetaSeqZOD_def sym_def <span class="keyword1"><span class="command">using</span></span> ZObis_Sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Compositionality-thetaSeqZOD_ZOretr"><span class="command">lemma</span></span> thetaSeqZOD_ZOretr<span class="main">:</span>
<span class="quoted"><span class="quoted">"thetaSeqZOD <span class="main">⊆</span> ZOretr <span class="main">(</span>thetaSeqZOD <span class="keyword1">Un</span> ZObis<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c1</span> <span class="skolem">c2</span> <span class="skolem">d1</span> <span class="skolem">d2</span>
   <span class="keyword3"><span class="command">assume</span></span> c1d1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span> <span class="main">≈01</span> <span class="skolem">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c2<span class="main">:</span> <span class="quoted"><span class="quoted">"discr <span class="skolem">c2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> d2<span class="main">:</span> <span class="quoted"><span class="quoted">"discr <span class="skolem">d2</span>"</span></span>
   <span class="keyword1"><span class="command">hence</span></span> matchC_ZO<span class="main">:</span> <span class="quoted"><span class="quoted">"matchC_ZO ZObis <span class="skolem">c1</span> <span class="skolem">d1</span>"</span></span> 
     <span class="keyword2"><span class="keyword">and</span></span> matchT_ZO<span class="main">:</span> <span class="quoted"><span class="quoted">"matchT_ZO <span class="skolem">c1</span> <span class="skolem">d1</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> ZObis_matchC_ZO ZObis_matchT_ZO <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span> <span class="main">;;</span> <span class="skolem">c2</span><span class="main">,</span> <span class="skolem">d1</span> <span class="main">;;</span> <span class="skolem">d2</span><span class="main">)</span> <span class="main">∈</span> ZOretr <span class="main">(</span>thetaSeqZOD <span class="keyword1">Un</span> ZObis<span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">unfolding</span></span> ZOretr_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"matchC_ZO <span class="main">(</span>thetaSeqZOD <span class="keyword1">Un</span> ZObis<span class="main">)</span> <span class="main">(</span><span class="skolem">c1</span> <span class="main">;;</span> <span class="skolem">c2</span><span class="main">)</span> <span class="main">(</span><span class="skolem">d1</span> <span class="main">;;</span> <span class="skolem">d2</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">unfolding</span></span> matchC_ZO_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="entity">mauto_no_simp_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span>
       <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">c'</span> <span class="skolem">s'</span>
       <span class="keyword3"><span class="command">assume</span></span> st<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≈</span> <span class="skolem">t</span>"</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span> <span class="main">;;</span> <span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
       <span class="keyword3"><span class="command">thus</span></span> 
       <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">≈</span> <span class="skolem">t</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="skolem">d1</span> <span class="main">;;</span> <span class="skolem">d2</span><span class="main">)</span> <span class="main">∈</span> thetaSeqZOD <span class="keyword1">Un</span> ZObis<span class="main">)</span> <span class="main">∨</span>
        <span class="main">(</span><span class="main">∃</span><span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d1</span> <span class="main">;;</span> <span class="skolem">d2</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="bound">d'</span><span class="main">)</span> <span class="main">∈</span> thetaSeqZOD <span class="keyword1">Un</span> ZObis<span class="main">)</span> <span class="main">∨</span> 
        <span class="main">(</span><span class="main">∃</span><span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d1</span> <span class="main">;;</span> <span class="skolem">d2</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> discr <span class="skolem">c'</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">erule</span> Seq_transC_invert<span class="main">)</span>
         <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c1'</span> <span class="keyword3"><span class="command">assume</span></span> c1s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c1'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">=</span> <span class="skolem">c1'</span> <span class="main">;;</span> <span class="skolem">c2</span>"</span></span>
         <span class="keyword1"><span class="command">hence</span></span>
         <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">≈</span> <span class="skolem">t</span> <span class="main">∧</span> <span class="skolem">c1'</span> <span class="main">≈01</span> <span class="skolem">d1</span><span class="main">)</span> <span class="main">∨</span> 
          <span class="main">(</span><span class="main">∃</span><span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d1</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">c1'</span> <span class="main">≈01</span> <span class="bound">d'</span><span class="main">)</span> <span class="main">∨</span> 
          <span class="main">(</span><span class="main">∃</span><span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d1</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> discr <span class="skolem">c1'</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> st matchC_ZO <span class="keyword1"><span class="command">unfolding</span></span> matchC_ZO_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
         <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> c' thetaSeqZOD_def
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="entity">mauto_no_simp_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> c2 d2<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> SeqC c2 d2<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> SeqT c2 d2 discr_Seq discr_ZObis<span class="main">)</span> 
       <span class="keyword1"><span class="command">next</span></span>      
         <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="skolem">s'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">=</span> <span class="skolem">c2</span>"</span></span>
         <span class="keyword1"><span class="command">hence</span></span> 
         <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">≈</span> <span class="skolem">t</span> <span class="main">∧</span> discr <span class="skolem">d1</span><span class="main">)</span> <span class="main">∨</span> 
          <span class="main">(</span><span class="main">∃</span><span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d1</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> discr <span class="bound">d'</span><span class="main">)</span> <span class="main">∨</span> 
          <span class="main">(</span><span class="main">∃</span><span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d1</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> st matchT_ZO <span class="keyword1"><span class="command">unfolding</span></span> matchT_ZO_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
         <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
         <span class="keyword1"><span class="command">unfolding</span></span> c' thetaSeqZOD_def
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="entity">mauto_no_simp_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> c2 d2 discr_Seq discr_ZObis<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> SeqC c2 d2 discr_Seq discr_ZObis<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> SeqT c2 d2 discr_ZObis<span class="main">)</span> 
       <span class="keyword1"><span class="command">qed</span></span>
     <span class="keyword1"><span class="command">qed</span></span> 
   <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">unfold</span> matchT_ZO_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> thetaSeqZOD_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Compositionality-thetaSeqZOD_ZObis"><span class="command">lemma</span></span> thetaSeqZOD_ZObis<span class="main">:</span>
<span class="quoted"><span class="quoted">"thetaSeqZOD <span class="main">⊆</span> ZObis"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ZObis_coind<span class="main">)</span>
<span class="keyword1"><span class="command">using</span></span> thetaSeqZOD_sym thetaSeqZOD_ZOretr <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> Seq_ZObis_discr<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c1</span> <span class="main">≈01</span> <span class="free">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"discr <span class="free">c2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"discr <span class="free">d2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">c1</span> <span class="main">;;</span> <span class="free">c2</span> <span class="main">≈01</span> <span class="free">d1</span> <span class="main">;;</span> <span class="free">d2</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms thetaSeqZOD_ZObis <span class="keyword1"><span class="command">unfolding</span></span> thetaSeqZOD_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Conditional:›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">thetaIfZO</span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">thetaIfZO</span> <span class="main">≡</span> 
 <span class="main">{</span><span class="main">(</span>If <span class="bound">tst</span> <span class="bound">c1</span> <span class="bound">c2</span><span class="main">,</span> If <span class="bound">tst</span> <span class="bound">d1</span> <span class="bound">d2</span><span class="main">)</span> <span class="main">|</span> <span class="bound">tst</span> <span class="bound">c1</span> <span class="bound">c2</span> <span class="bound">d1</span> <span class="bound">d2</span><span class="main">.</span> compatTst <span class="bound">tst</span> <span class="main">∧</span> <span class="bound">c1</span> <span class="main">≈01</span> <span class="bound">d1</span> <span class="main">∧</span> <span class="bound">c2</span> <span class="main">≈01</span> <span class="bound">d2</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Compositionality-thetaIfZO_sym"><span class="command">lemma</span></span> thetaIfZO_sym<span class="main">:</span>
<span class="quoted"><span class="quoted">"sym thetaIfZO"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> thetaIfZO_def sym_def <span class="keyword1"><span class="command">using</span></span> ZObis_Sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Compositionality-thetaIfZO_ZOretr"><span class="command">lemma</span></span> thetaIfZO_ZOretr<span class="main">:</span>
<span class="quoted"><span class="quoted">"thetaIfZO <span class="main">⊆</span> ZOretr <span class="main">(</span>thetaIfZO <span class="keyword1">Un</span> ZObis<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">tst</span> <span class="skolem">c1</span> <span class="skolem">c2</span> <span class="skolem">d1</span> <span class="skolem">d2</span>
   <span class="keyword3"><span class="command">assume</span></span> tst<span class="main">:</span> <span class="quoted"><span class="quoted">"compatTst <span class="skolem">tst</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c1d1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span> <span class="main">≈01</span> <span class="skolem">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c2d2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c2</span> <span class="main">≈01</span> <span class="skolem">d2</span>"</span></span>
   <span class="keyword1"><span class="command">hence</span></span> matchC_ZO1<span class="main">:</span> <span class="quoted"><span class="quoted">"matchC_ZO ZObis <span class="skolem">c1</span> <span class="skolem">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> matchC_ZO2<span class="main">:</span> <span class="quoted"><span class="quoted">"matchC_ZO ZObis <span class="skolem">c2</span> <span class="skolem">d2</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> matchT_ZO1<span class="main">:</span> <span class="quoted"><span class="quoted">"matchT_ZO <span class="skolem">c1</span> <span class="skolem">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> matchT_ZO2<span class="main">:</span> <span class="quoted"><span class="quoted">"matchT_ZO <span class="skolem">c2</span> <span class="skolem">d2</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> ZObis_matchC_ZO ZObis_matchT_ZO <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>If <span class="skolem">tst</span> <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">,</span> If <span class="skolem">tst</span> <span class="skolem">d1</span> <span class="skolem">d2</span><span class="main">)</span> <span class="main">∈</span> ZOretr <span class="main">(</span>thetaIfZO <span class="keyword1">Un</span> ZObis<span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">unfolding</span></span> ZOretr_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"matchC_ZO <span class="main">(</span>thetaIfZO <span class="keyword1">Un</span> ZObis<span class="main">)</span> <span class="main">(</span>If <span class="skolem">tst</span> <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">)</span> <span class="main">(</span>If <span class="skolem">tst</span> <span class="skolem">d1</span> <span class="skolem">d2</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">unfolding</span></span> matchC_ZO_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="entity">mauto_no_simp_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span>
       <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">c'</span> <span class="skolem">s'</span>
       <span class="keyword3"><span class="command">assume</span></span> st<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≈</span> <span class="skolem">t</span>"</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>If <span class="skolem">tst</span> <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
       <span class="keyword3"><span class="command">thus</span></span> 
       <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">≈</span> <span class="skolem">t</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> If <span class="skolem">tst</span> <span class="skolem">d1</span> <span class="skolem">d2</span><span class="main">)</span> <span class="main">∈</span> thetaIfZO <span class="keyword1">Un</span> ZObis<span class="main">)</span> <span class="main">∨</span>
        <span class="main">(</span><span class="main">∃</span><span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span>If <span class="skolem">tst</span> <span class="skolem">d1</span> <span class="skolem">d2</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="bound">d'</span><span class="main">)</span> <span class="main">∈</span> thetaIfZO <span class="keyword1">Un</span> ZObis<span class="main">)</span> <span class="main">∨</span> 
        <span class="main">(</span><span class="main">∃</span><span class="bound">t'</span><span class="main">.</span> <span class="main">(</span>If <span class="skolem">tst</span> <span class="skolem">d1</span> <span class="skolem">d2</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> discr <span class="skolem">c'</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> If_transC_invert<span class="main">)</span>
       <span class="keyword1"><span class="command">unfolding</span></span> thetaIfZO_def 
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> IfTrue c1d1 compatTst_def st tst<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IfFalse c2d2 compatTst_def st tst<span class="main">)</span>
     <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">unfold</span> matchT_ZO_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> thetaIfZO_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Compositionality-thetaIfZO_ZObis"><span class="command">lemma</span></span> thetaIfZO_ZObis<span class="main">:</span>
<span class="quoted"><span class="quoted">"thetaIfZO <span class="main">⊆</span> ZObis"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ZObis_coind<span class="main">)</span>
<span class="keyword1"><span class="command">using</span></span> thetaIfZO_sym thetaIfZO_ZOretr <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> If_ZObis<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"compatTst <span class="free">tst</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">c1</span> <span class="main">≈01</span> <span class="free">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">c2</span> <span class="main">≈01</span> <span class="free">d2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"If <span class="free">tst</span> <span class="free">c1</span> <span class="free">c2</span> <span class="main">≈01</span> If <span class="free">tst</span> <span class="free">d1</span> <span class="free">d2</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms thetaIfZO_ZObis <span class="keyword1"><span class="command">unfolding</span></span> thetaIfZO_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹While loop:›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹01-bisimilarity does not interact with / preserve the While construct in 
any interesting way.›</span></span>

<span class="comment1">(* Indeed, assume c ≈01 d and try to prove while tst c ≈01 while tst d.  
If tst is True in some state, we obtain the task of proving c ;; (while tst c) ≈01 d ;; (while tst d).  
Now, assume c takes a step to c' and d terminates, possibility allowed by ~01-bisimilarity, 
provided c' is discr.  So now we need to have, for discr c', the following: 
c' ;; (while tst c) ≈01 while tst d.  This is not true in general. *)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Parallel composition:›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">thetaParZOL1</span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">thetaParZOL1</span> <span class="main">≡</span> 
 <span class="main">{</span><span class="main">(</span>Par <span class="bound">c1</span> <span class="bound">c2</span><span class="main">,</span> <span class="bound">d</span><span class="main">)</span> <span class="main">|</span> <span class="bound">c1</span> <span class="bound">c2</span> <span class="bound">d</span><span class="main">.</span> <span class="bound">c1</span> <span class="main">≈01</span> <span class="bound">d</span> <span class="main">∧</span> discr <span class="bound">c2</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Compositionality-thetaParZOL1_ZOretr"><span class="command">lemma</span></span> thetaParZOL1_ZOretr<span class="main">:</span>
<span class="quoted"><span class="quoted">"thetaParZOL1 <span class="main">⊆</span> ZOretr <span class="main">(</span>thetaParZOL1 <span class="keyword1">Un</span> ZObis<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c1</span> <span class="skolem">c2</span> <span class="skolem">d</span>
   <span class="keyword3"><span class="command">assume</span></span> c1d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span> <span class="main">≈01</span> <span class="skolem">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c2<span class="main">:</span> <span class="quoted"><span class="quoted">"discr <span class="skolem">c2</span>"</span></span>
   <span class="keyword1"><span class="command">hence</span></span> matchC_ZO<span class="main">:</span> <span class="quoted"><span class="quoted">"matchC_ZO ZObis <span class="skolem">c1</span> <span class="skolem">d</span>"</span></span> 
     <span class="keyword2"><span class="keyword">and</span></span> matchT_ZO<span class="main">:</span> <span class="quoted"><span class="quoted">"matchT_ZO <span class="skolem">c1</span> <span class="skolem">d</span>"</span></span> 
   <span class="keyword1"><span class="command">using</span></span> ZObis_matchC_ZO ZObis_matchT_ZO <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Par <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">,</span> <span class="skolem">d</span><span class="main">)</span> <span class="main">∈</span> ZOretr <span class="main">(</span>thetaParZOL1 <span class="keyword1">Un</span> ZObis<span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">unfolding</span></span> ZOretr_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"matchC_ZO <span class="main">(</span>thetaParZOL1 <span class="main">∪</span> ZObis<span class="main">)</span> <span class="main">(</span>Par <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">)</span> <span class="skolem">d</span>"</span></span>
     <span class="keyword1"><span class="command">unfolding</span></span> matchC_ZO_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="entity">mauto_no_simp_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span>
       <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">c'</span> <span class="skolem">s'</span>
       <span class="keyword3"><span class="command">assume</span></span> st<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≈</span> <span class="skolem">t</span>"</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Par <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
       <span class="keyword3"><span class="command">thus</span></span>
       <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">≈</span> <span class="skolem">t</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="skolem">d</span><span class="main">)</span> <span class="main">∈</span> thetaParZOL1 <span class="main">∪</span> ZObis<span class="main">)</span> <span class="main">∨</span>
        <span class="main">(</span><span class="main">∃</span><span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="bound">d'</span><span class="main">)</span> <span class="main">∈</span> thetaParZOL1 <span class="main">∪</span> ZObis<span class="main">)</span> <span class="main">∨</span>
        <span class="main">(</span><span class="main">∃</span><span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> discr <span class="skolem">c'</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">erule</span> Par_transC_invert<span class="main">)</span>
         <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c1'</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c1'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">=</span> Par <span class="skolem">c1'</span> <span class="skolem">c2</span>"</span></span>
         <span class="keyword1"><span class="command">hence</span></span> 
         <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">≈</span> <span class="skolem">t</span> <span class="main">∧</span> <span class="skolem">c1'</span> <span class="main">≈01</span> <span class="skolem">d</span><span class="main">)</span> <span class="main">∨</span> 
          <span class="main">(</span><span class="main">∃</span><span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">c1'</span> <span class="main">≈01</span> <span class="bound">d'</span><span class="main">)</span> <span class="main">∨</span> 
          <span class="main">(</span><span class="main">∃</span><span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> discr <span class="skolem">c1'</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> st matchC_ZO <span class="keyword1"><span class="command">unfolding</span></span> matchC_ZO_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
         <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> thetaParZOL1_def
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> disjE exE conjE<span class="main">)</span> 
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> c2 c'<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> c2 c'<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> c' c2 discr_Par<span class="main">)</span> 
       <span class="keyword1"><span class="command">next</span></span>
         <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="skolem">s'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">=</span> <span class="skolem">c2</span>"</span></span>
         <span class="keyword1"><span class="command">hence</span></span> 
         <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">≈</span> <span class="skolem">t</span> <span class="main">∧</span> discr <span class="skolem">d</span><span class="main">)</span> <span class="main">∨</span> 
          <span class="main">(</span><span class="main">∃</span><span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> discr <span class="bound">d'</span><span class="main">)</span> <span class="main">∨</span> 
          <span class="main">(</span><span class="main">∃</span><span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> st matchT_ZO <span class="keyword1"><span class="command">unfolding</span></span> matchT_ZO_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
         <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> thetaParZOL1_def
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> disjE exE conjE<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> c' c2 discr_ZObis<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> c' c2 discr_ZObis<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> c' c2<span class="main">)</span>  
       <span class="keyword1"><span class="command">next</span></span>
         <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c2'</span> <span class="keyword3"><span class="command">assume</span></span> c2s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c2'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">=</span> Par <span class="skolem">c1</span> <span class="skolem">c2'</span>"</span></span>
         <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≈</span> <span class="skolem">s'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c2 discr_transC_indis <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
         <span class="keyword1"><span class="command">hence</span></span> s't<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">≈</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> st indis_sym indis_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
         <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"discr <span class="skolem">c2'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c2 c2s discr_transC <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
         <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> s't c1d <span class="keyword1"><span class="command">unfolding</span></span> thetaParZOL1_def c' <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
       <span class="keyword1"><span class="command">next</span></span>
         <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="skolem">s'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">=</span> <span class="skolem">c1</span>"</span></span>
         <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≈</span> <span class="skolem">s'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c2 discr_transT <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
         <span class="keyword1"><span class="command">hence</span></span> s't<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">≈</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> st indis_sym indis_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
         <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> c1d <span class="keyword1"><span class="command">unfolding</span></span> thetaParZOL1_def c' <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
       <span class="keyword1"><span class="command">qed</span></span>
     <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">unfold</span> matchT_ZO_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> thetaParZOL1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Compositionality-thetaParZOL1_converse_ZOretr"><span class="command">lemma</span></span> thetaParZOL1_converse_ZOretr<span class="main">:</span>
<span class="quoted"><span class="quoted">"thetaParZOL1 <span class="main">^-1</span> <span class="main">⊆</span> ZOretr <span class="main">(</span>thetaParZOL1 <span class="main">^-1</span> <span class="keyword1">Un</span> ZObis<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c1</span> <span class="skolem">c2</span> <span class="skolem">d</span>
   <span class="keyword3"><span class="command">assume</span></span> c1d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span> <span class="main">≈01</span> <span class="skolem">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c2<span class="main">:</span> <span class="quoted"><span class="quoted">"discr <span class="skolem">c2</span>"</span></span>
   <span class="keyword1"><span class="command">hence</span></span> matchC_ZO<span class="main">:</span> <span class="quoted"><span class="quoted">"matchC_ZO ZObis <span class="skolem">d</span> <span class="skolem">c1</span>"</span></span> 
     <span class="keyword2"><span class="keyword">and</span></span> matchT_ZO<span class="main">:</span> <span class="quoted"><span class="quoted">"matchT_ZO <span class="skolem">d</span> <span class="skolem">c1</span>"</span></span> 
   <span class="keyword1"><span class="command">using</span></span> ZObis_matchC_ZO_rev ZObis_matchT_ZO_rev <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">d</span><span class="main">,</span> Par <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">)</span> <span class="main">∈</span> ZOretr <span class="main">(</span>thetaParZOL1<span class="main">¯</span> <span class="main">∪</span> ZObis<span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">unfolding</span></span> ZOretr_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"matchC_ZO <span class="main">(</span>thetaParZOL1<span class="main">¯</span> <span class="main">∪</span> ZObis<span class="main">)</span> <span class="skolem">d</span> <span class="main">(</span>Par <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">unfolding</span></span> matchC_ZO_def2 ZObis_converse <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="entity">mauto_no_simp_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span> 
       <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">d'</span> <span class="skolem">t'</span>
       <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≈</span> <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">d</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">d'</span><span class="main">,</span> <span class="skolem">t'</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">hence</span></span> 
       <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">≈</span> <span class="skolem">t'</span> <span class="main">∧</span> <span class="skolem">d'</span> <span class="main">≈01</span> <span class="skolem">c1</span><span class="main">)</span> <span class="main">∨</span> 
        <span class="main">(</span><span class="main">∃</span><span class="bound">c'</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">c1</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="skolem">t'</span> <span class="main">∧</span> <span class="skolem">d'</span> <span class="main">≈01</span> <span class="bound">c'</span><span class="main">)</span> <span class="main">∨</span> 
        <span class="main">(</span><span class="main">∃</span><span class="bound">s'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">c1</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">s'</span> <span class="main">∧</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="skolem">t'</span> <span class="main">∧</span> discr <span class="skolem">d'</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> matchC_ZO <span class="keyword1"><span class="command">unfolding</span></span> matchC_ZO_def2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
       <span class="keyword3"><span class="command">thus</span></span>
       <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">≈</span> <span class="skolem">t'</span> <span class="main">∧</span> <span class="main">(</span>Par <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">,</span> <span class="skolem">d'</span><span class="main">)</span> <span class="main">∈</span> thetaParZOL1 <span class="main">∪</span> ZObis<span class="main">)</span> <span class="main">∨</span>
        <span class="main">(</span><span class="main">∃</span><span class="bound">c'</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">(</span>Par <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="skolem">t'</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span> <span class="skolem">d'</span><span class="main">)</span> <span class="main">∈</span> thetaParZOL1 <span class="main">∪</span> ZObis<span class="main">)</span> <span class="main">∨</span>
        <span class="main">(</span><span class="main">∃</span><span class="bound">s'</span><span class="main">.</span> <span class="main">(</span>Par <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">s'</span> <span class="main">∧</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="skolem">t'</span> <span class="main">∧</span> discr <span class="skolem">d'</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">unfolding</span></span> thetaParZOL1_def 
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="entity">mauto_no_simp_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> ZObis_Sym c2<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> ParCL ZObis_sym c2 sym_def<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ParTL c2 discr_ZObis<span class="main">)</span> 
     <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">next</span></span>
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"matchT_ZO <span class="skolem">d</span> <span class="main">(</span>Par <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">unfolding</span></span> matchT_ZO_def2 ZObis_converse <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="entity">mauto_no_simp_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span> 
       <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">t'</span>
       <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≈</span> <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">d</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="skolem">t'</span>"</span></span>
       <span class="keyword1"><span class="command">hence</span></span> 
       <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">≈</span> <span class="skolem">t'</span> <span class="main">∧</span> discr <span class="skolem">c1</span><span class="main">)</span> <span class="main">∨</span> 
        <span class="main">(</span><span class="main">∃</span><span class="bound">c'</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">c1</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="skolem">t'</span> <span class="main">∧</span> discr <span class="bound">c'</span><span class="main">)</span> <span class="main">∨</span> 
        <span class="main">(</span><span class="main">∃</span><span class="bound">s'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">c1</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">s'</span> <span class="main">∧</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="skolem">t'</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> matchT_ZO <span class="keyword1"><span class="command">unfolding</span></span> matchT_ZO_def2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
       <span class="keyword3"><span class="command">thus</span></span>
       <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">≈</span> <span class="skolem">t'</span> <span class="main">∧</span> discr <span class="main">(</span>Par <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> 
        <span class="main">(</span><span class="main">∃</span><span class="bound">c'</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">(</span>Par <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="skolem">t'</span> <span class="main">∧</span> discr <span class="bound">c'</span><span class="main">)</span> <span class="main">∨</span> 
        <span class="main">(</span><span class="main">∃</span><span class="bound">s'</span><span class="main">.</span> <span class="main">(</span>Par <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">s'</span> <span class="main">∧</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="skolem">t'</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="entity">mauto_no_simp_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> c2 discr_Par<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> ParCL c2 discr_Par<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ParTL c2<span class="main">)</span>
     <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> thetaParZOL1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Compositionality-thetaParZOL1_ZObis"><span class="command">lemma</span></span> thetaParZOL1_ZObis<span class="main">:</span>
<span class="quoted"><span class="quoted">"thetaParZOL1 <span class="main">⊆</span> ZObis"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ZObis_coind2<span class="main">)</span>
<span class="keyword1"><span class="command">using</span></span> thetaParZOL1_ZOretr thetaParZOL1_converse_ZOretr <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> Par_ZObis_discrL1<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c1</span> <span class="main">≈01</span> <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"discr <span class="free">c2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Par <span class="free">c1</span> <span class="free">c2</span> <span class="main">≈01</span> <span class="free">d</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms thetaParZOL1_ZObis <span class="keyword1"><span class="command">unfolding</span></span> thetaParZOL1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">theorem</span></span> Par_ZObis_discrR1<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≈01</span> <span class="free">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"discr <span class="free">d2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≈01</span> Par <span class="free">d1</span> <span class="free">d2</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms Par_ZObis_discrL1 ZObis_Sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="comment1">(*  *)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">thetaParZOL2</span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">thetaParZOL2</span> <span class="main">≡</span> 
 <span class="main">{</span><span class="main">(</span>Par <span class="bound">c1</span> <span class="bound">c2</span><span class="main">,</span> <span class="bound">d</span><span class="main">)</span> <span class="main">|</span> <span class="bound">c1</span> <span class="bound">c2</span> <span class="bound">d</span><span class="main">.</span> discr <span class="bound">c1</span> <span class="main">∧</span> <span class="bound">c2</span> <span class="main">≈01</span> <span class="bound">d</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Compositionality-thetaParZOL2_ZOretr"><span class="command">lemma</span></span> thetaParZOL2_ZOretr<span class="main">:</span>
<span class="quoted"><span class="quoted">"thetaParZOL2 <span class="main">⊆</span> ZOretr <span class="main">(</span>thetaParZOL2 <span class="keyword1">Un</span> ZObis<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c1</span> <span class="skolem">c2</span> <span class="skolem">d</span>
   <span class="keyword3"><span class="command">assume</span></span> c2d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c2</span> <span class="main">≈01</span> <span class="skolem">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c1<span class="main">:</span> <span class="quoted"><span class="quoted">"discr <span class="skolem">c1</span>"</span></span> 
   <span class="keyword1"><span class="command">hence</span></span> matchC_ZO<span class="main">:</span> <span class="quoted"><span class="quoted">"matchC_ZO ZObis <span class="skolem">c2</span> <span class="skolem">d</span>"</span></span> 
     <span class="keyword2"><span class="keyword">and</span></span> matchT_ZO<span class="main">:</span> <span class="quoted"><span class="quoted">"matchT_ZO <span class="skolem">c2</span> <span class="skolem">d</span>"</span></span> 
   <span class="keyword1"><span class="command">using</span></span> ZObis_matchC_ZO ZObis_matchT_ZO <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Par <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">,</span> <span class="skolem">d</span><span class="main">)</span> <span class="main">∈</span> ZOretr <span class="main">(</span>thetaParZOL2 <span class="keyword1">Un</span> ZObis<span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">unfolding</span></span> ZOretr_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"matchC_ZO <span class="main">(</span>thetaParZOL2 <span class="main">∪</span> ZObis<span class="main">)</span> <span class="main">(</span>Par <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">)</span> <span class="skolem">d</span>"</span></span>
     <span class="keyword1"><span class="command">unfolding</span></span> matchC_ZO_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="entity">mauto_no_simp_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span>
       <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">c'</span> <span class="skolem">s'</span>
       <span class="keyword3"><span class="command">assume</span></span> st<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≈</span> <span class="skolem">t</span>"</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Par <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
       <span class="keyword3"><span class="command">thus</span></span>
       <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">≈</span> <span class="skolem">t</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="skolem">d</span><span class="main">)</span> <span class="main">∈</span> thetaParZOL2 <span class="main">∪</span> ZObis<span class="main">)</span> <span class="main">∨</span>
        <span class="main">(</span><span class="main">∃</span><span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="bound">d'</span><span class="main">)</span> <span class="main">∈</span> thetaParZOL2 <span class="main">∪</span> ZObis<span class="main">)</span> <span class="main">∨</span>
        <span class="main">(</span><span class="main">∃</span><span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> discr <span class="skolem">c'</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">erule</span> Par_transC_invert<span class="main">)</span>
         <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c1'</span> <span class="keyword3"><span class="command">assume</span></span> c1s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c1'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">=</span> Par <span class="skolem">c1'</span> <span class="skolem">c2</span>"</span></span>
         <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≈</span> <span class="skolem">s'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c1 discr_transC_indis <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
         <span class="keyword1"><span class="command">hence</span></span> s't<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">≈</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> st indis_sym indis_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
         <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"discr <span class="skolem">c1'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c1 c1s discr_transC <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
         <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> s't c2d <span class="keyword1"><span class="command">unfolding</span></span> thetaParZOL2_def c' <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
       <span class="keyword1"><span class="command">next</span></span>
         <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="skolem">s'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">=</span> <span class="skolem">c2</span>"</span></span>
         <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≈</span> <span class="skolem">s'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c1 discr_transT <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
         <span class="keyword1"><span class="command">hence</span></span> s't<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">≈</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> st indis_sym indis_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
         <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> c2d <span class="keyword1"><span class="command">unfolding</span></span> thetaParZOL2_def c' <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
       <span class="keyword1"><span class="command">next</span></span>
         <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c2'</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c2'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">=</span> Par <span class="skolem">c1</span> <span class="skolem">c2'</span>"</span></span>
         <span class="keyword1"><span class="command">hence</span></span> 
         <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">≈</span> <span class="skolem">t</span> <span class="main">∧</span> <span class="skolem">c2'</span> <span class="main">≈01</span> <span class="skolem">d</span><span class="main">)</span> <span class="main">∨</span> 
          <span class="main">(</span><span class="main">∃</span><span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">c2'</span> <span class="main">≈01</span> <span class="bound">d'</span><span class="main">)</span> <span class="main">∨</span> 
          <span class="main">(</span><span class="main">∃</span><span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> discr <span class="skolem">c2'</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> st matchC_ZO <span class="keyword1"><span class="command">unfolding</span></span> matchC_ZO_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
         <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> thetaParZOL2_def
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> disjE exE conjE<span class="main">)</span> 
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> c1 c'<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> c1 c'<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> c' c1 discr_Par<span class="main">)</span> 
       <span class="keyword1"><span class="command">next</span></span>
         <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="skolem">s'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">=</span> <span class="skolem">c1</span>"</span></span>
         <span class="keyword1"><span class="command">hence</span></span> 
         <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">≈</span> <span class="skolem">t</span> <span class="main">∧</span> discr <span class="skolem">d</span><span class="main">)</span> <span class="main">∨</span> 
          <span class="main">(</span><span class="main">∃</span><span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> discr <span class="bound">d'</span><span class="main">)</span> <span class="main">∨</span> 
          <span class="main">(</span><span class="main">∃</span><span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> st matchT_ZO <span class="keyword1"><span class="command">unfolding</span></span> matchT_ZO_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
         <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> thetaParZOL2_def
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> disjE exE conjE<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> c' c1 discr_ZObis<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> c' c1 discr_ZObis<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> c' c1<span class="main">)</span>          
       <span class="keyword1"><span class="command">qed</span></span>
     <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">unfold</span> matchT_ZO_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> thetaParZOL2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Compositionality-thetaParZOL2_converse_ZOretr"><span class="command">lemma</span></span> thetaParZOL2_converse_ZOretr<span class="main">:</span>
<span class="quoted"><span class="quoted">"thetaParZOL2 <span class="main">^-1</span> <span class="main">⊆</span> ZOretr <span class="main">(</span>thetaParZOL2 <span class="main">^-1</span> <span class="keyword1">Un</span> ZObis<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c1</span> <span class="skolem">c2</span> <span class="skolem">d</span>
   <span class="keyword3"><span class="command">assume</span></span> c2d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c2</span> <span class="main">≈01</span> <span class="skolem">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c1<span class="main">:</span> <span class="quoted"><span class="quoted">"discr <span class="skolem">c1</span>"</span></span>
   <span class="keyword1"><span class="command">hence</span></span> matchC_ZO<span class="main">:</span> <span class="quoted"><span class="quoted">"matchC_ZO ZObis <span class="skolem">d</span> <span class="skolem">c2</span>"</span></span> 
     <span class="keyword2"><span class="keyword">and</span></span> matchT_ZO<span class="main">:</span> <span class="quoted"><span class="quoted">"matchT_ZO <span class="skolem">d</span> <span class="skolem">c2</span>"</span></span> 
   <span class="keyword1"><span class="command">using</span></span> ZObis_matchC_ZO_rev ZObis_matchT_ZO_rev <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">d</span><span class="main">,</span> Par <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">)</span> <span class="main">∈</span> ZOretr <span class="main">(</span>thetaParZOL2<span class="main">¯</span> <span class="main">∪</span> ZObis<span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">unfolding</span></span> ZOretr_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"matchC_ZO <span class="main">(</span>thetaParZOL2<span class="main">¯</span> <span class="main">∪</span> ZObis<span class="main">)</span> <span class="skolem">d</span> <span class="main">(</span>Par <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">unfolding</span></span> matchC_ZO_def2 ZObis_converse <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="entity">mauto_no_simp_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span> 
       <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">d'</span> <span class="skolem">t'</span>
       <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≈</span> <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">d</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">d'</span><span class="main">,</span> <span class="skolem">t'</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">hence</span></span> 
       <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">≈</span> <span class="skolem">t'</span> <span class="main">∧</span> <span class="skolem">d'</span> <span class="main">≈01</span> <span class="skolem">c2</span><span class="main">)</span> <span class="main">∨</span> 
        <span class="main">(</span><span class="main">∃</span><span class="bound">c'</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="skolem">t'</span> <span class="main">∧</span> <span class="skolem">d'</span> <span class="main">≈01</span> <span class="bound">c'</span><span class="main">)</span> <span class="main">∨</span> 
        <span class="main">(</span><span class="main">∃</span><span class="bound">s'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">s'</span> <span class="main">∧</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="skolem">t'</span> <span class="main">∧</span> discr <span class="skolem">d'</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> matchC_ZO <span class="keyword1"><span class="command">unfolding</span></span> matchC_ZO_def2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
       <span class="keyword3"><span class="command">thus</span></span>
       <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">≈</span> <span class="skolem">t'</span> <span class="main">∧</span> <span class="main">(</span>Par <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">,</span> <span class="skolem">d'</span><span class="main">)</span> <span class="main">∈</span> thetaParZOL2 <span class="main">∪</span> ZObis<span class="main">)</span> <span class="main">∨</span>
        <span class="main">(</span><span class="main">∃</span><span class="bound">c'</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">(</span>Par <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="skolem">t'</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span> <span class="skolem">d'</span><span class="main">)</span> <span class="main">∈</span> thetaParZOL2 <span class="main">∪</span> ZObis<span class="main">)</span> <span class="main">∨</span>
        <span class="main">(</span><span class="main">∃</span><span class="bound">s'</span><span class="main">.</span> <span class="main">(</span>Par <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">s'</span> <span class="main">∧</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="skolem">t'</span> <span class="main">∧</span> discr <span class="skolem">d'</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">unfolding</span></span> thetaParZOL2_def 
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="entity">mauto_no_simp_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> ZObis_Sym c1<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> ParCR ZObis_sym c1 sym_def<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ParTR c1 discr_ZObis<span class="main">)</span> 
     <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">next</span></span>
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"matchT_ZO <span class="skolem">d</span> <span class="main">(</span>Par <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">unfolding</span></span> matchT_ZO_def2 ZObis_converse <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="entity">mauto_no_simp_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span> 
       <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">t'</span>
       <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≈</span> <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">d</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="skolem">t'</span>"</span></span>
       <span class="keyword1"><span class="command">hence</span></span> 
       <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">≈</span> <span class="skolem">t'</span> <span class="main">∧</span> discr <span class="skolem">c2</span><span class="main">)</span> <span class="main">∨</span> 
        <span class="main">(</span><span class="main">∃</span><span class="bound">c'</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="skolem">t'</span> <span class="main">∧</span> discr <span class="bound">c'</span><span class="main">)</span> <span class="main">∨</span> 
        <span class="main">(</span><span class="main">∃</span><span class="bound">s'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">s'</span> <span class="main">∧</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="skolem">t'</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> matchT_ZO <span class="keyword1"><span class="command">unfolding</span></span> matchT_ZO_def2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
       <span class="keyword3"><span class="command">thus</span></span>
       <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">≈</span> <span class="skolem">t'</span> <span class="main">∧</span> discr <span class="main">(</span>Par <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> 
        <span class="main">(</span><span class="main">∃</span><span class="bound">c'</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">(</span>Par <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="skolem">t'</span> <span class="main">∧</span> discr <span class="bound">c'</span><span class="main">)</span> <span class="main">∨</span> 
        <span class="main">(</span><span class="main">∃</span><span class="bound">s'</span><span class="main">.</span> <span class="main">(</span>Par <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">s'</span> <span class="main">∧</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="skolem">t'</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="entity">mauto_no_simp_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> c1 discr_Par<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> ParCR c1 discr_Par<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ParTR c1<span class="main">)</span>
     <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> thetaParZOL2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Compositionality-thetaParZOL2_ZObis"><span class="command">lemma</span></span> thetaParZOL2_ZObis<span class="main">:</span>
<span class="quoted"><span class="quoted">"thetaParZOL2 <span class="main">⊆</span> ZObis"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ZObis_coind2<span class="main">)</span>
<span class="keyword1"><span class="command">using</span></span> thetaParZOL2_ZOretr thetaParZOL2_converse_ZOretr <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> Par_ZObis_discrL2<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c2</span> <span class="main">≈01</span> <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"discr <span class="free">c1</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Par <span class="free">c1</span> <span class="free">c2</span> <span class="main">≈01</span> <span class="free">d</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms thetaParZOL2_ZObis <span class="keyword1"><span class="command">unfolding</span></span> thetaParZOL2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">theorem</span></span> Par_ZObis_discrR2<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≈01</span> <span class="free">d2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"discr <span class="free">d1</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≈01</span> Par <span class="free">d1</span> <span class="free">d2</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms Par_ZObis_discrL2 ZObis_Sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="comment1">(*  *)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">thetaParZO</span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">thetaParZO</span> <span class="main">≡</span> 
 <span class="main">{</span><span class="main">(</span>Par <span class="bound">c1</span> <span class="bound">c2</span><span class="main">,</span> Par <span class="bound">d1</span> <span class="bound">d2</span><span class="main">)</span> <span class="main">|</span> <span class="bound">c1</span> <span class="bound">c2</span> <span class="bound">d1</span> <span class="bound">d2</span><span class="main">.</span> <span class="bound">c1</span> <span class="main">≈01</span> <span class="bound">d1</span> <span class="main">∧</span> <span class="bound">c2</span> <span class="main">≈01</span> <span class="bound">d2</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Compositionality-thetaParZO_sym"><span class="command">lemma</span></span> thetaParZO_sym<span class="main">:</span>
<span class="quoted"><span class="quoted">"sym thetaParZO"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> thetaParZO_def sym_def <span class="keyword1"><span class="command">using</span></span> ZObis_Sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Compositionality-thetaParZO_ZOretr"><span class="command">lemma</span></span> thetaParZO_ZOretr<span class="main">:</span>
<span class="quoted"><span class="quoted">"thetaParZO <span class="main">⊆</span> ZOretr <span class="main">(</span>thetaParZO <span class="keyword1">Un</span> ZObis<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c1</span> <span class="skolem">c2</span> <span class="skolem">d1</span> <span class="skolem">d2</span>
   <span class="keyword3"><span class="command">assume</span></span> c1d1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span> <span class="main">≈01</span> <span class="skolem">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c2d2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c2</span> <span class="main">≈01</span> <span class="skolem">d2</span>"</span></span>
   <span class="keyword1"><span class="command">hence</span></span> matchC_ZO1<span class="main">:</span> <span class="quoted"><span class="quoted">"matchC_ZO ZObis <span class="skolem">c1</span> <span class="skolem">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> matchC_ZO2<span class="main">:</span> <span class="quoted"><span class="quoted">"matchC_ZO ZObis <span class="skolem">c2</span> <span class="skolem">d2</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> matchT_ZO1<span class="main">:</span> <span class="quoted"><span class="quoted">"matchT_ZO <span class="skolem">c1</span> <span class="skolem">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> matchT_ZO2<span class="main">:</span> <span class="quoted"><span class="quoted">"matchT_ZO <span class="skolem">c2</span> <span class="skolem">d2</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> ZObis_matchC_ZO ZObis_matchT_ZO <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Par <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">,</span> Par <span class="skolem">d1</span> <span class="skolem">d2</span><span class="main">)</span> <span class="main">∈</span> ZOretr <span class="main">(</span>thetaParZO <span class="keyword1">Un</span> ZObis<span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">unfolding</span></span> ZOretr_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"matchC_ZO <span class="main">(</span>thetaParZO <span class="main">∪</span> ZObis<span class="main">)</span> <span class="main">(</span>Par <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">)</span> <span class="main">(</span>Par <span class="skolem">d1</span> <span class="skolem">d2</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">unfolding</span></span> matchC_ZO_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="entity">mauto_no_simp_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span>
       <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">c'</span> <span class="skolem">s'</span>
       <span class="keyword3"><span class="command">assume</span></span> st<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≈</span> <span class="skolem">t</span>"</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Par <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
       <span class="keyword3"><span class="command">thus</span></span> 
       <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">≈</span> <span class="skolem">t</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> Par <span class="skolem">d1</span> <span class="skolem">d2</span><span class="main">)</span> <span class="main">∈</span> thetaParZO <span class="main">∪</span> ZObis<span class="main">)</span> <span class="main">∨</span>
        <span class="main">(</span><span class="main">∃</span><span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span>Par <span class="skolem">d1</span> <span class="skolem">d2</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="bound">d'</span><span class="main">)</span> <span class="main">∈</span> thetaParZO <span class="main">∪</span> ZObis<span class="main">)</span> <span class="main">∨</span> 
        <span class="main">(</span><span class="main">∃</span><span class="bound">t'</span><span class="main">.</span> <span class="main">(</span>Par <span class="skolem">d1</span> <span class="skolem">d2</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> discr <span class="skolem">c'</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">erule</span> Par_transC_invert<span class="main">)</span>
         <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c1'</span> <span class="keyword3"><span class="command">assume</span></span> c1s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c1'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">=</span> Par <span class="skolem">c1'</span> <span class="skolem">c2</span>"</span></span>
         <span class="keyword1"><span class="command">hence</span></span>
         <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">≈</span> <span class="skolem">t</span> <span class="main">∧</span> <span class="skolem">c1'</span> <span class="main">≈01</span> <span class="skolem">d1</span><span class="main">)</span> <span class="main">∨</span> 
          <span class="main">(</span><span class="main">∃</span><span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d1</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">c1'</span> <span class="main">≈01</span> <span class="bound">d'</span><span class="main">)</span> <span class="main">∨</span> 
          <span class="main">(</span><span class="main">∃</span><span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d1</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> discr <span class="skolem">c1'</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> st matchC_ZO1 <span class="keyword1"><span class="command">unfolding</span></span> matchC_ZO_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
         <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> c' thetaParZO_def
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="entity">mauto_no_simp_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> c2d2<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> ParCL c2d2<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ParTL Par_ZObis_discrL2 c2d2<span class="main">)</span>   
       <span class="keyword1"><span class="command">next</span></span>      
         <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="skolem">s'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">=</span> <span class="skolem">c2</span>"</span></span>
         <span class="keyword1"><span class="command">hence</span></span> 
         <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">≈</span> <span class="skolem">t</span> <span class="main">∧</span> discr <span class="skolem">d1</span><span class="main">)</span> <span class="main">∨</span> 
          <span class="main">(</span><span class="main">∃</span><span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d1</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> discr <span class="bound">d'</span><span class="main">)</span> <span class="main">∨</span> 
          <span class="main">(</span><span class="main">∃</span><span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d1</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> st matchT_ZO1 <span class="keyword1"><span class="command">unfolding</span></span> matchT_ZO_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
         <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
         <span class="keyword1"><span class="command">unfolding</span></span> c' thetaParZO_def
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="entity">mauto_no_simp_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Par_ZObis_discrR2 c2d2<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> PL.ParCL Par_ZObis_discrR2 c2d2<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> PL.ParTL c2d2<span class="main">)</span> 
       <span class="keyword1"><span class="command">next</span></span>
         <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c2'</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c2'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">=</span> Par <span class="skolem">c1</span> <span class="skolem">c2'</span>"</span></span>
         <span class="keyword1"><span class="command">hence</span></span> 
         <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">≈</span> <span class="skolem">t</span> <span class="main">∧</span> <span class="skolem">c2'</span> <span class="main">≈01</span> <span class="skolem">d2</span><span class="main">)</span> <span class="main">∨</span> 
          <span class="main">(</span><span class="main">∃</span><span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d2</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">c2'</span> <span class="main">≈01</span> <span class="bound">d'</span><span class="main">)</span> <span class="main">∨</span> 
          <span class="main">(</span><span class="main">∃</span><span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d2</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> discr <span class="skolem">c2'</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> st matchC_ZO2 <span class="keyword1"><span class="command">unfolding</span></span> matchC_ZO_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
         <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
         <span class="keyword1"><span class="command">unfolding</span></span> c' thetaParZO_def
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="entity">mauto_no_simp_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> c1d1<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> PL.ParCR c1d1<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> PL.ParTR Par_ZObis_discrL1 c1d1<span class="main">)</span>
       <span class="keyword1"><span class="command">next</span></span>
         <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="skolem">s'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">=</span> <span class="skolem">c1</span>"</span></span>
         <span class="keyword1"><span class="command">hence</span></span> 
         <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">≈</span> <span class="skolem">t</span> <span class="main">∧</span> discr <span class="skolem">d2</span><span class="main">)</span> <span class="main">∨</span> 
          <span class="main">(</span><span class="main">∃</span><span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d2</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> discr <span class="bound">d'</span><span class="main">)</span> <span class="main">∨</span> 
          <span class="main">(</span><span class="main">∃</span><span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d2</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> st matchT_ZO2 <span class="keyword1"><span class="command">unfolding</span></span> matchT_ZO_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
         <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
         <span class="keyword1"><span class="command">unfolding</span></span> c' thetaParZO_def
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="entity">mauto_no_simp_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Par_ZObis_discrR1 c1d1<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> PL.ParCR Par_ZObis_discrR1 c1d1<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> PL.ParTR c1d1<span class="main">)</span> 
       <span class="keyword1"><span class="command">qed</span></span>
     <span class="keyword1"><span class="command">qed</span></span> 
   <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">unfold</span> matchT_ZO_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> thetaParZO_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Compositionality-thetaParZO_ZObis"><span class="command">lemma</span></span> thetaParZO_ZObis<span class="main">:</span>
<span class="quoted"><span class="quoted">"thetaParZO <span class="main">⊆</span> ZObis"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ZObis_coind<span class="main">)</span>
<span class="keyword1"><span class="command">using</span></span> thetaParZO_sym thetaParZO_ZOretr <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> Par_ZObis<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c1</span> <span class="main">≈01</span> <span class="free">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">c2</span> <span class="main">≈01</span> <span class="free">d2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Par <span class="free">c1</span> <span class="free">c2</span> <span class="main">≈01</span> Par <span class="free">d1</span> <span class="free">d2</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms thetaParZO_ZObis <span class="keyword1"><span class="command">unfolding</span></span> thetaParZO_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹WT-bisimilarity versus language constructs›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Discreetness:›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> noWhile_discr_WbisT<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"noWhile <span class="free">c1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"noWhile <span class="free">c2</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"discr <span class="free">c1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"discr <span class="free">c2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">c1</span> <span class="keyword1">≈wT</span> <span class="free">c2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"noWhile <span class="free">c1</span> <span class="main">∧</span> noWhile <span class="free">c2</span> <span class="main">∧</span> discr <span class="free">c1</span> <span class="main">∧</span> discr <span class="free">c2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> WbisT_coinduct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> cont <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> MtransC_Refl noWhile_transC discr_transC discr_transC_indis indis_sym indis_trans<span class="main">)</span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> termi <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> discr_MtransT indis_sym indis_trans noWhile_MtransT transT_MtransT<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Atomic commands:›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> Atm_WbisT<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"compatAtm <span class="free">atm</span>"</span></span> 
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Atm <span class="free">atm</span> <span class="keyword1">≈wT</span> Atm <span class="free">atm</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Atm_Sbis assms bis_imp<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Sequential composition:›</span></span> 

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">thetaSeqWT</span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">thetaSeqWT</span> <span class="main">≡</span> 
 <span class="main">{</span><span class="main">(</span><span class="bound">c1</span> <span class="main">;;</span> <span class="bound">c2</span><span class="main">,</span> <span class="bound">d1</span> <span class="main">;;</span> <span class="bound">d2</span><span class="main">)</span> <span class="main">|</span> <span class="bound">c1</span> <span class="bound">c2</span> <span class="bound">d1</span> <span class="bound">d2</span><span class="main">.</span> <span class="bound">c1</span> <span class="keyword1">≈wT</span> <span class="bound">d1</span> <span class="main">∧</span> <span class="bound">c2</span> <span class="keyword1">≈wT</span> <span class="bound">d2</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Compositionality-thetaSeqWT_sym"><span class="command">lemma</span></span> thetaSeqWT_sym<span class="main">:</span>
<span class="quoted"><span class="quoted">"sym thetaSeqWT"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> thetaSeqWT_def sym_def <span class="keyword1"><span class="command">using</span></span> WbisT_Sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Compositionality-thetaSeqWT_WretrT"><span class="command">lemma</span></span> thetaSeqWT_WretrT<span class="main">:</span>
<span class="quoted"><span class="quoted">"thetaSeqWT <span class="main">⊆</span> WretrT <span class="main">(</span>thetaSeqWT <span class="keyword1">Un</span> WbisT<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span> 
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c1</span> <span class="skolem">c2</span> <span class="skolem">d1</span> <span class="skolem">d2</span>
   <span class="keyword3"><span class="command">assume</span></span> c1d1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span> <span class="keyword1">≈wT</span> <span class="skolem">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c2d2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c2</span> <span class="keyword1">≈wT</span> <span class="skolem">d2</span>"</span></span>
   <span class="keyword1"><span class="command">hence</span></span> matchC_MC1<span class="main">:</span> <span class="quoted"><span class="quoted">"matchC_MC WbisT <span class="skolem">c1</span> <span class="skolem">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> matchC_MC2<span class="main">:</span> <span class="quoted"><span class="quoted">"matchC_MC WbisT <span class="skolem">c2</span> <span class="skolem">d2</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> matchT_MT1<span class="main">:</span> <span class="quoted"><span class="quoted">"matchT_MT <span class="skolem">c1</span> <span class="skolem">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> matchT_T2<span class="main">:</span> <span class="quoted"><span class="quoted">"matchT_MT <span class="skolem">c2</span> <span class="skolem">d2</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> WbisT_matchC_MC WbisT_matchT_MT <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span> <span class="main">;;</span> <span class="skolem">c2</span><span class="main">,</span> <span class="skolem">d1</span> <span class="main">;;</span> <span class="skolem">d2</span><span class="main">)</span> <span class="main">∈</span> WretrT <span class="main">(</span>thetaSeqWT <span class="keyword1">Un</span> WbisT<span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">unfolding</span></span> WretrT_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"matchC_MC <span class="main">(</span>thetaSeqWT <span class="keyword1">Un</span> WbisT<span class="main">)</span> <span class="main">(</span><span class="skolem">c1</span> <span class="main">;;</span> <span class="skolem">c2</span><span class="main">)</span> <span class="main">(</span><span class="skolem">d1</span> <span class="main">;;</span> <span class="skolem">d2</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">unfolding</span></span> matchC_MC_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="entity">mauto_no_simp_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span>
       <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">c'</span> <span class="skolem">s'</span>
       <span class="keyword3"><span class="command">assume</span></span> st<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≈</span> <span class="skolem">t</span>"</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span> <span class="main">;;</span> <span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
       <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d1</span> <span class="main">;;</span> <span class="skolem">d2</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="bound">d'</span><span class="main">)</span> <span class="main">∈</span> thetaSeqWT <span class="keyword1">Un</span> WbisT<span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">erule</span> Seq_transC_invert<span class="main">)</span>
         <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c1'</span> <span class="keyword3"><span class="command">assume</span></span> c1s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c1'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">=</span> <span class="skolem">c1'</span> <span class="main">;;</span> <span class="skolem">c2</span>"</span></span>
         <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">d1'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d1</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="bound">d1'</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">c1'</span> <span class="keyword1">≈wT</span> <span class="bound">d1'</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> st matchC_MC1 <span class="keyword1"><span class="command">unfolding</span></span> matchC_MC_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
         <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> c' thetaSeqWT_def
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> PL.Seq_MtransC c2d2<span class="main">)</span> 
       <span class="keyword1"><span class="command">next</span></span>      
         <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="skolem">s'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">=</span> <span class="skolem">c2</span>"</span></span>
         <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d1</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> st matchT_MT1 <span class="keyword1"><span class="command">unfolding</span></span> matchT_MT_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
         <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
         <span class="keyword1"><span class="command">unfolding</span></span> c' thetaSeqWT_def
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="entity">mauto_no_simp_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Seq_MtransT_MtransC c2d2<span class="main">)</span> 
       <span class="keyword1"><span class="command">qed</span></span>
     <span class="keyword1"><span class="command">qed</span></span> 
   <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">unfold</span> matchT_MT_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> thetaSeqWT_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Compositionality-thetaSeqWT_WbisT"><span class="command">lemma</span></span> thetaSeqWT_WbisT<span class="main">:</span>
<span class="quoted"><span class="quoted">"thetaSeqWT <span class="main">⊆</span> WbisT"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> WbisT_coind<span class="main">)</span>
<span class="keyword1"><span class="command">using</span></span> thetaSeqWT_sym thetaSeqWT_WretrT <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> Seq_WbisT<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c1</span> <span class="keyword1">≈wT</span> <span class="free">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">c2</span> <span class="keyword1">≈wT</span> <span class="free">d2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">c1</span> <span class="main">;;</span> <span class="free">c2</span> <span class="keyword1">≈wT</span> <span class="free">d1</span> <span class="main">;;</span> <span class="free">d2</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms thetaSeqWT_WbisT <span class="keyword1"><span class="command">unfolding</span></span> thetaSeqWT_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Conditional:›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">thetaIfWT</span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">thetaIfWT</span> <span class="main">≡</span> 
 <span class="main">{</span><span class="main">(</span>If <span class="bound">tst</span> <span class="bound">c1</span> <span class="bound">c2</span><span class="main">,</span> If <span class="bound">tst</span> <span class="bound">d1</span> <span class="bound">d2</span><span class="main">)</span> <span class="main">|</span> <span class="bound">tst</span> <span class="bound">c1</span> <span class="bound">c2</span> <span class="bound">d1</span> <span class="bound">d2</span><span class="main">.</span> compatTst <span class="bound">tst</span> <span class="main">∧</span> <span class="bound">c1</span> <span class="keyword1">≈wT</span> <span class="bound">d1</span> <span class="main">∧</span> <span class="bound">c2</span> <span class="keyword1">≈wT</span> <span class="bound">d2</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Compositionality-thetaIfWT_sym"><span class="command">lemma</span></span> thetaIfWT_sym<span class="main">:</span>
<span class="quoted"><span class="quoted">"sym thetaIfWT"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> thetaIfWT_def sym_def <span class="keyword1"><span class="command">using</span></span> WbisT_Sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Compositionality-thetaIfWT_WretrT"><span class="command">lemma</span></span> thetaIfWT_WretrT<span class="main">:</span>
<span class="quoted"><span class="quoted">"thetaIfWT <span class="main">⊆</span> WretrT <span class="main">(</span>thetaIfWT <span class="keyword1">Un</span> WbisT<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span> 
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">tst</span> <span class="skolem">c1</span> <span class="skolem">c2</span> <span class="skolem">d1</span> <span class="skolem">d2</span>
   <span class="keyword3"><span class="command">assume</span></span> tst<span class="main">:</span> <span class="quoted"><span class="quoted">"compatTst <span class="skolem">tst</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c1d1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span> <span class="keyword1">≈wT</span> <span class="skolem">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c2d2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c2</span> <span class="keyword1">≈wT</span> <span class="skolem">d2</span>"</span></span>
   <span class="keyword1"><span class="command">hence</span></span> matchC_MC1<span class="main">:</span> <span class="quoted"><span class="quoted">"matchC_MC WbisT <span class="skolem">c1</span> <span class="skolem">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> matchC_MC2<span class="main">:</span> <span class="quoted"><span class="quoted">"matchC_MC WbisT <span class="skolem">c2</span> <span class="skolem">d2</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> matchT_MT1<span class="main">:</span> <span class="quoted"><span class="quoted">"matchT_MT <span class="skolem">c1</span> <span class="skolem">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> matchT_MT2<span class="main">:</span> <span class="quoted"><span class="quoted">"matchT_MT <span class="skolem">c2</span> <span class="skolem">d2</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> WbisT_matchC_MC WbisT_matchT_MT <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>If <span class="skolem">tst</span> <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">,</span> If <span class="skolem">tst</span> <span class="skolem">d1</span> <span class="skolem">d2</span><span class="main">)</span> <span class="main">∈</span> WretrT <span class="main">(</span>thetaIfWT <span class="keyword1">Un</span> WbisT<span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">unfolding</span></span> WretrT_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"matchC_MC <span class="main">(</span>thetaIfWT <span class="keyword1">Un</span> WbisT<span class="main">)</span> <span class="main">(</span>If <span class="skolem">tst</span> <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">)</span> <span class="main">(</span>If <span class="skolem">tst</span> <span class="skolem">d1</span> <span class="skolem">d2</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">unfolding</span></span> matchC_MC_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="entity">mauto_no_simp_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span>
       <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">c'</span> <span class="skolem">s'</span>
       <span class="keyword3"><span class="command">assume</span></span> st<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≈</span> <span class="skolem">t</span>"</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>If <span class="skolem">tst</span> <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
       <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span>If <span class="skolem">tst</span> <span class="skolem">d1</span> <span class="skolem">d2</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="bound">d'</span><span class="main">)</span> <span class="main">∈</span> thetaIfWT <span class="keyword1">Un</span> WbisT"</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> If_transC_invert<span class="main">)</span>
       <span class="keyword1"><span class="command">unfolding</span></span> thetaIfWT_def 
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> IfTrue c1d1 compatTst_def st transC_MtransC tst<span class="main">)</span> 
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IfFalse c2d2 compatTst_def st transC_MtransC tst<span class="main">)</span> 
     <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">unfold</span> matchT_MT_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> thetaIfWT_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Compositionality-thetaIfWT_WbisT"><span class="command">lemma</span></span> thetaIfWT_WbisT<span class="main">:</span>
<span class="quoted"><span class="quoted">"thetaIfWT <span class="main">⊆</span> WbisT"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> WbisT_coind<span class="main">)</span>
<span class="keyword1"><span class="command">using</span></span> thetaIfWT_sym thetaIfWT_WretrT <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> If_WbisT<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"compatTst <span class="free">tst</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">c1</span> <span class="keyword1">≈wT</span> <span class="free">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">c2</span> <span class="keyword1">≈wT</span> <span class="free">d2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"If <span class="free">tst</span> <span class="free">c1</span> <span class="free">c2</span> <span class="keyword1">≈wT</span> If <span class="free">tst</span> <span class="free">d1</span> <span class="free">d2</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms thetaIfWT_WbisT <span class="keyword1"><span class="command">unfolding</span></span> thetaIfWT_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹While loop:›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">thetaWhileW</span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">thetaWhileW</span> <span class="main">≡</span> 
 <span class="main">{</span><span class="main">(</span>While <span class="bound">tst</span> <span class="bound">c</span><span class="main">,</span> While <span class="bound">tst</span> <span class="bound">d</span><span class="main">)</span> <span class="main">|</span> <span class="bound">tst</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">.</span> compatTst <span class="bound">tst</span> <span class="main">∧</span> <span class="bound">c</span> <span class="keyword1">≈wT</span> <span class="bound">d</span><span class="main">}</span> <span class="keyword1">Un</span> 
 <span class="main">{</span><span class="main">(</span><span class="bound">c1</span> <span class="main">;;</span> <span class="main">(</span>While <span class="bound">tst</span> <span class="bound">c</span><span class="main">)</span><span class="main">,</span> <span class="bound">d1</span> <span class="main">;;</span> <span class="main">(</span>While <span class="bound">tst</span> <span class="bound">d</span><span class="main">)</span><span class="main">)</span> <span class="main">|</span> <span class="bound">tst</span> <span class="bound">c1</span> <span class="bound">d1</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">.</span> 
               compatTst <span class="bound">tst</span> <span class="main">∧</span> <span class="bound">c1</span> <span class="keyword1">≈wT</span> <span class="bound">d1</span> <span class="main">∧</span> <span class="bound">c</span> <span class="keyword1">≈wT</span> <span class="bound">d</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Compositionality-thetaWhileW_sym"><span class="command">lemma</span></span> thetaWhileW_sym<span class="main">:</span>
<span class="quoted"><span class="quoted">"sym thetaWhileW"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> thetaWhileW_def sym_def <span class="keyword1"><span class="command">using</span></span> WbisT_Sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Compositionality-thetaWhileW_WretrT"><span class="command">lemma</span></span> thetaWhileW_WretrT<span class="main">:</span>
<span class="quoted"><span class="quoted">"thetaWhileW <span class="main">⊆</span> WretrT <span class="main">(</span>thetaWhileW <span class="keyword1">Un</span> WbisT<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">tst</span> <span class="skolem">c</span> <span class="skolem">d</span> 
   <span class="keyword3"><span class="command">assume</span></span> tst<span class="main">:</span> <span class="quoted"><span class="quoted">"compatTst <span class="skolem">tst</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c_d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="keyword1">≈wT</span> <span class="skolem">d</span>"</span></span>
   <span class="keyword1"><span class="command">hence</span></span> matchC_MC<span class="main">:</span> <span class="quoted"><span class="quoted">"matchC_MC WbisT <span class="skolem">c</span> <span class="skolem">d</span>"</span></span> 
     <span class="keyword2"><span class="keyword">and</span></span> matchT_MT<span class="main">:</span> <span class="quoted"><span class="quoted">"matchT_MT <span class="skolem">c</span> <span class="skolem">d</span>"</span></span> 
   <span class="keyword1"><span class="command">using</span></span> WbisT_matchC_MC WbisT_matchT_MT <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>While <span class="skolem">tst</span> <span class="skolem">c</span><span class="main">,</span> While <span class="skolem">tst</span> <span class="skolem">d</span><span class="main">)</span> <span class="main">∈</span> WretrT <span class="main">(</span>thetaWhileW <span class="keyword1">Un</span> WbisT<span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">unfolding</span></span> WretrT_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"matchC_MC <span class="main">(</span>thetaWhileW <span class="main">∪</span> WbisT<span class="main">)</span> <span class="main">(</span>While <span class="skolem">tst</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">(</span>While <span class="skolem">tst</span> <span class="skolem">d</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">unfolding</span></span> matchC_MC_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="entity">mauto_no_simp_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span>
       <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">c'</span> <span class="skolem">s'</span>
       <span class="keyword3"><span class="command">assume</span></span> st<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≈</span> <span class="skolem">t</span>"</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>While <span class="skolem">tst</span> <span class="skolem">c</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
       <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span>While <span class="skolem">tst</span> <span class="skolem">d</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> 
                     <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="bound">d'</span><span class="main">)</span> <span class="main">∈</span> thetaWhileW <span class="main">∪</span> WbisT"</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> While_transC_invert<span class="main">)</span>
       <span class="keyword1"><span class="command">unfolding</span></span> thetaWhileW_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> PL.WhileTrue PL.transC_MtransC c_d compatTst_def st tst<span class="main">)</span>
     <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">next</span></span>
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"matchT_MT <span class="main">(</span>While <span class="skolem">tst</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">(</span>While <span class="skolem">tst</span> <span class="skolem">d</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">unfolding</span></span> matchT_MT_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="entity">mauto_no_simp_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span>
       <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">s'</span> <span class="keyword3"><span class="command">assume</span></span> st<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≈</span> <span class="skolem">t</span>"</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>While <span class="skolem">tst</span> <span class="skolem">c</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="skolem">s'</span>"</span></span>
       <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t'</span><span class="main">.</span> <span class="main">(</span>While <span class="skolem">tst</span> <span class="skolem">d</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> "</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> While_transT_invert<span class="main">)</span>
       <span class="keyword1"><span class="command">unfolding</span></span> thetaWhileW_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> WhileFalse compatTst_def st transT_MtransT tst<span class="main">)</span>       
     <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> 
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">tst</span> <span class="skolem">c1</span> <span class="skolem">d1</span>  <span class="skolem">c</span> <span class="skolem">d</span>
   <span class="keyword3"><span class="command">assume</span></span> tst<span class="main">:</span> <span class="quoted"><span class="quoted">"compatTst <span class="skolem">tst</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c1d1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span> <span class="keyword1">≈wT</span> <span class="skolem">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c_d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="keyword1">≈wT</span> <span class="skolem">d</span>"</span></span>
   <span class="keyword1"><span class="command">hence</span></span> matchC_MC1<span class="main">:</span> <span class="quoted"><span class="quoted">"matchC_MC WbisT <span class="skolem">c1</span> <span class="skolem">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> matchC_MC<span class="main">:</span> <span class="quoted"><span class="quoted">"matchC_MC WbisT <span class="skolem">c</span> <span class="skolem">d</span>"</span></span> 
     <span class="keyword2"><span class="keyword">and</span></span> matchT_MT1<span class="main">:</span> <span class="quoted"><span class="quoted">"matchT_MT <span class="skolem">c1</span> <span class="skolem">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> matchT_MT<span class="main">:</span> <span class="quoted"><span class="quoted">"matchT_MT <span class="skolem">c</span> <span class="skolem">d</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> WbisT_matchC_MC WbisT_matchT_MT <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span> <span class="main">;;</span> <span class="main">(</span>While <span class="skolem">tst</span> <span class="skolem">c</span><span class="main">)</span><span class="main">,</span> <span class="skolem">d1</span> <span class="main">;;</span> <span class="main">(</span>While <span class="skolem">tst</span> <span class="skolem">d</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> WretrT <span class="main">(</span>thetaWhileW <span class="keyword1">Un</span> WbisT<span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">unfolding</span></span> WretrT_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"matchC_MC <span class="main">(</span>thetaWhileW <span class="main">∪</span> WbisT<span class="main">)</span> <span class="main">(</span><span class="skolem">c1</span> <span class="main">;;</span> <span class="main">(</span>While <span class="skolem">tst</span> <span class="skolem">c</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">d1</span> <span class="main">;;</span> <span class="main">(</span>While <span class="skolem">tst</span> <span class="skolem">d</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">unfolding</span></span> matchC_MC_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="entity">mauto_no_simp_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span>
       <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">c'</span> <span class="skolem">s'</span>
       <span class="keyword3"><span class="command">assume</span></span> st<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≈</span> <span class="skolem">t</span>"</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span> <span class="main">;;</span> <span class="main">(</span>While <span class="skolem">tst</span> <span class="skolem">c</span><span class="main">)</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
       <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d1</span> <span class="main">;;</span> <span class="main">(</span>While <span class="skolem">tst</span> <span class="skolem">d</span><span class="main">)</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> 
                     <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="bound">d'</span><span class="main">)</span> <span class="main">∈</span> thetaWhileW <span class="main">∪</span> WbisT"</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">erule</span> Seq_transC_invert<span class="main">)</span>
         <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c1'</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c1'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">=</span> <span class="skolem">c1'</span> <span class="main">;;</span> <span class="main">(</span>While <span class="skolem">tst</span> <span class="skolem">c</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d1</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">c1'</span> <span class="keyword1">≈wT</span> <span class="bound">d'</span>"</span></span> 
         <span class="keyword1"><span class="command">using</span></span> st matchC_MC1 <span class="keyword1"><span class="command">unfolding</span></span> matchC_MC_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
         <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
         <span class="keyword1"><span class="command">unfolding</span></span> c' thetaWhileW_def
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> PL.Seq_MtransC c_d tst<span class="main">)</span>
       <span class="keyword1"><span class="command">next</span></span>
         <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="skolem">s'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">=</span> While <span class="skolem">tst</span> <span class="skolem">c</span>"</span></span>
         <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d1</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> st matchT_MT1 <span class="keyword1"><span class="command">unfolding</span></span> matchT_MT_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
         <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
         <span class="keyword1"><span class="command">unfolding</span></span> c' thetaWhileW_def 
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> PL.Seq_MtransT_MtransC c_d tst<span class="main">)</span>
       <span class="keyword1"><span class="command">qed</span></span>
     <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">unfold</span> matchT_MT_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> thetaWhileW_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Compositionality-thetaWhileW_WbisT"><span class="command">lemma</span></span> thetaWhileW_WbisT<span class="main">:</span>
<span class="quoted"><span class="quoted">"thetaWhileW <span class="main">⊆</span> WbisT"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> WbisT_coind<span class="main">)</span>
<span class="keyword1"><span class="command">using</span></span> thetaWhileW_sym thetaWhileW_WretrT <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> While_WbisT<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"compatTst <span class="free">tst</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="keyword1">≈wT</span> <span class="free">d</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"While <span class="free">tst</span> <span class="free">c</span> <span class="keyword1">≈wT</span> While <span class="free">tst</span> <span class="free">d</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms thetaWhileW_WbisT <span class="keyword1"><span class="command">unfolding</span></span> thetaWhileW_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Parallel composition:›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">thetaParWT</span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">thetaParWT</span> <span class="main">≡</span> 
 <span class="main">{</span><span class="main">(</span>Par <span class="bound">c1</span> <span class="bound">c2</span><span class="main">,</span> Par <span class="bound">d1</span> <span class="bound">d2</span><span class="main">)</span> <span class="main">|</span> <span class="bound">c1</span> <span class="bound">c2</span> <span class="bound">d1</span> <span class="bound">d2</span><span class="main">.</span> <span class="bound">c1</span> <span class="keyword1">≈wT</span> <span class="bound">d1</span> <span class="main">∧</span> <span class="bound">c2</span> <span class="keyword1">≈wT</span> <span class="bound">d2</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Compositionality-thetaParWT_sym"><span class="command">lemma</span></span> thetaParWT_sym<span class="main">:</span>
<span class="quoted"><span class="quoted">"sym thetaParWT"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> thetaParWT_def sym_def <span class="keyword1"><span class="command">using</span></span> WbisT_Sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Compositionality-thetaParWT_WretrT"><span class="command">lemma</span></span> thetaParWT_WretrT<span class="main">:</span>
<span class="quoted"><span class="quoted">"thetaParWT <span class="main">⊆</span> WretrT <span class="main">(</span>thetaParWT <span class="keyword1">Un</span> WbisT<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c1</span> <span class="skolem">c2</span> <span class="skolem">d1</span> <span class="skolem">d2</span>
   <span class="keyword3"><span class="command">assume</span></span> c1d1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span> <span class="keyword1">≈wT</span> <span class="skolem">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c2d2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c2</span> <span class="keyword1">≈wT</span> <span class="skolem">d2</span>"</span></span>
   <span class="keyword1"><span class="command">hence</span></span> matchC_MC1<span class="main">:</span> <span class="quoted"><span class="quoted">"matchC_MC WbisT <span class="skolem">c1</span> <span class="skolem">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> matchC_MC2<span class="main">:</span> <span class="quoted"><span class="quoted">"matchC_MC WbisT <span class="skolem">c2</span> <span class="skolem">d2</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> matchT_MT1<span class="main">:</span> <span class="quoted"><span class="quoted">"matchT_MT <span class="skolem">c1</span> <span class="skolem">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> matchT_MT2<span class="main">:</span> <span class="quoted"><span class="quoted">"matchT_MT <span class="skolem">c2</span> <span class="skolem">d2</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> WbisT_matchC_MC WbisT_matchT_MT <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Par <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">,</span> Par <span class="skolem">d1</span> <span class="skolem">d2</span><span class="main">)</span> <span class="main">∈</span> WretrT <span class="main">(</span>thetaParWT <span class="keyword1">Un</span> WbisT<span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">unfolding</span></span> WretrT_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"matchC_MC <span class="main">(</span>thetaParWT <span class="main">∪</span> WbisT<span class="main">)</span> <span class="main">(</span>Par <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">)</span> <span class="main">(</span>Par <span class="skolem">d1</span> <span class="skolem">d2</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">unfolding</span></span> matchC_MC_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="entity">mauto_no_simp_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span>
       <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">c'</span> <span class="skolem">s'</span>
       <span class="keyword3"><span class="command">assume</span></span> st<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≈</span> <span class="skolem">t</span>"</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Par <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
       <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span>Par <span class="skolem">d1</span> <span class="skolem">d2</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> 
                     <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="bound">d'</span><span class="main">)</span> <span class="main">∈</span> thetaParWT <span class="main">∪</span> WbisT"</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">erule</span> Par_transC_invert<span class="main">)</span>
         <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c1'</span> <span class="keyword3"><span class="command">assume</span></span> c1s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c1'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">=</span> Par <span class="skolem">c1'</span> <span class="skolem">c2</span>"</span></span>
         <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d1</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">c1'</span> <span class="keyword1">≈wT</span> <span class="bound">d'</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> st matchC_MC1 <span class="keyword1"><span class="command">unfolding</span></span> matchC_MC_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
         <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> c' thetaParWT_def
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> PL.ParCL_MtransC c2d2<span class="main">)</span> 
       <span class="keyword1"><span class="command">next</span></span>      
         <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="skolem">s'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">=</span> <span class="skolem">c2</span>"</span></span>
         <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d1</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> st matchT_MT1 <span class="keyword1"><span class="command">unfolding</span></span> matchT_MT_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
         <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
         <span class="keyword1"><span class="command">unfolding</span></span> c' thetaParWT_def
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> PL.ParTL_MtransC c2d2<span class="main">)</span>
       <span class="keyword1"><span class="command">next</span></span>
         <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c2'</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c2'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">=</span> Par <span class="skolem">c1</span> <span class="skolem">c2'</span>"</span></span>
         <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d2</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">c2'</span> <span class="keyword1">≈wT</span> <span class="bound">d'</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> st matchC_MC2 <span class="keyword1"><span class="command">unfolding</span></span> matchC_MC_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
         <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
         <span class="keyword1"><span class="command">unfolding</span></span> c' thetaParWT_def
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> PL.ParCR_MtransC c1d1<span class="main">)</span>
       <span class="keyword1"><span class="command">next</span></span>
         <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="skolem">s'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">=</span> <span class="skolem">c1</span>"</span></span>
         <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d2</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> st matchT_MT2 <span class="keyword1"><span class="command">unfolding</span></span> matchT_MT_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
         <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
         <span class="keyword1"><span class="command">unfolding</span></span> c' thetaParWT_def
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> PL.ParTR_MtransC c1d1<span class="main">)</span>
       <span class="keyword1"><span class="command">qed</span></span>
     <span class="keyword1"><span class="command">qed</span></span> 
   <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">unfold</span> matchT_MT_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> thetaParWT_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Compositionality-thetaParWT_WbisT"><span class="command">lemma</span></span> thetaParWT_WbisT<span class="main">:</span>
<span class="quoted"><span class="quoted">"thetaParWT <span class="main">⊆</span> WbisT"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> WbisT_coind<span class="main">)</span>
<span class="keyword1"><span class="command">using</span></span> thetaParWT_sym thetaParWT_WretrT <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> Par_WbisT<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c1</span> <span class="keyword1">≈wT</span> <span class="free">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">c2</span> <span class="keyword1">≈wT</span> <span class="free">d2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Par <span class="free">c1</span> <span class="free">c2</span> <span class="keyword1">≈wT</span> Par <span class="free">d1</span> <span class="free">d2</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms thetaParWT_WbisT <span class="keyword1"><span class="command">unfolding</span></span> thetaParWT_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹T-bisimilarity versus language constructs›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹T-Discreetness:›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">thetaFDW0</span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">thetaFDW0</span> <span class="main">≡</span> 
 <span class="main">{</span><span class="main">(</span><span class="bound">c1</span><span class="main">,</span><span class="bound">c2</span><span class="main">)</span><span class="main">.</span> discr0 <span class="bound">c1</span> <span class="main">∧</span> discr0 <span class="bound">c2</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Compositionality-thetaFDW0_sym"><span class="command">lemma</span></span> thetaFDW0_sym<span class="main">:</span>
<span class="quoted"><span class="quoted">"sym thetaFDW0"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> thetaFDW0_def sym_def <span class="keyword1"><span class="command">using</span></span> Sbis_Sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Compositionality-thetaFDW0_RetrT"><span class="command">lemma</span></span> thetaFDW0_RetrT<span class="main">:</span>
<span class="quoted"><span class="quoted">"thetaFDW0 <span class="main">⊆</span> RetrT thetaFDW0"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span> <span class="skolem">d</span> 
   <span class="keyword3"><span class="command">assume</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"discr0 <span class="skolem">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"discr0 <span class="skolem">d</span>"</span></span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c</span><span class="main">,</span><span class="skolem">d</span><span class="main">)</span> <span class="main">∈</span> RetrT thetaFDW0"</span></span>
   <span class="keyword1"><span class="command">unfolding</span></span> RetrT_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"matchC_TMC thetaFDW0 <span class="skolem">c</span> <span class="skolem">d</span>"</span></span>
     <span class="keyword1"><span class="command">unfolding</span></span> matchC_TMC_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="entity">mauto_no_simp_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span>
       <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">c'</span> <span class="skolem">s'</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"mustT <span class="skolem">c</span> <span class="skolem">s</span>"</span></span> <span class="quoted"><span class="quoted">"mustT <span class="skolem">d</span> <span class="skolem">t</span>"</span></span> 
       <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≈</span> <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
       <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="bound">d'</span><span class="main">)</span> <span class="main">∈</span> thetaFDW0"</span></span>
       <span class="keyword1"><span class="command">unfolding</span></span> thetaFDW0_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> MtransC_Refl noWhile_transC c d discr0_transC discr0_transC_indis 
                 indis_sym indis_trans<span class="main">)</span> 
     <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">next</span></span>
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"matchT_TMT <span class="skolem">c</span> <span class="skolem">d</span>"</span></span>
     <span class="keyword1"><span class="command">unfolding</span></span> matchT_TMT_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="entity">mauto_no_simp_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span>
       <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">s'</span> <span class="keyword3"><span class="command">assume</span></span> mt<span class="main">:</span> <span class="quoted"><span class="quoted">"mustT <span class="skolem">c</span> <span class="skolem">s</span>"</span></span> <span class="quoted"><span class="quoted">"mustT <span class="skolem">d</span> <span class="skolem">t</span>"</span></span>  
       <span class="keyword2"><span class="keyword">and</span></span> st<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≈</span> <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> cs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="skolem">s'</span>"</span></span>
       <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t'</span></span> <span class="keyword2"><span class="keyword">where</span></span> dt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">d</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="skolem">t'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mt mustT_MtransT<span class="main">)</span>
       <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">≈</span> <span class="skolem">t'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≈</span> <span class="skolem">s'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mt cs c d discr0_transT discr0_MtransT <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
       <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">≈</span> <span class="skolem">t'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> st indis_trans indis_sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
       <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dt <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>     
     <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> thetaFDW0_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Compositionality-thetaFDW0_BisT"><span class="command">lemma</span></span> thetaFDW0_BisT<span class="main">:</span>
<span class="quoted"><span class="quoted">"thetaFDW0 <span class="main">⊆</span> BisT"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> BisT_raw_coind<span class="main">)</span>
<span class="keyword1"><span class="command">using</span></span> thetaFDW0_sym thetaFDW0_RetrT <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> discr0_BisT<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"discr0 <span class="free">c1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"discr0 <span class="free">c2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">c1</span> <span class="keyword1">≈T</span> <span class="free">c2</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms thetaFDW0_BisT <span class="keyword1"><span class="command">unfolding</span></span> thetaFDW0_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>   

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Atomic commands:›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> Atm_BisT<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"compatAtm <span class="free">atm</span>"</span></span> 
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Atm <span class="free">atm</span> <span class="keyword1">≈T</span> Atm <span class="free">atm</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms siso0_Atm siso0_Sbis<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Sequential composition:›</span></span> 

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">thetaSeqTT</span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">thetaSeqTT</span> <span class="main">≡</span> 
 <span class="main">{</span><span class="main">(</span><span class="bound">c1</span> <span class="main">;;</span> <span class="bound">c2</span><span class="main">,</span> <span class="bound">d1</span> <span class="main">;;</span> <span class="bound">d2</span><span class="main">)</span> <span class="main">|</span> <span class="bound">c1</span> <span class="bound">c2</span> <span class="bound">d1</span> <span class="bound">d2</span><span class="main">.</span> <span class="bound">c1</span> <span class="keyword1">≈T</span> <span class="bound">d1</span> <span class="main">∧</span> <span class="bound">c2</span> <span class="keyword1">≈T</span> <span class="bound">d2</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Compositionality-thetaSeqTT_sym"><span class="command">lemma</span></span> thetaSeqTT_sym<span class="main">:</span>
<span class="quoted"><span class="quoted">"sym thetaSeqTT"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> thetaSeqTT_def sym_def <span class="keyword1"><span class="command">using</span></span> BisT_Sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Compositionality-thetaSeqTT_RetrT"><span class="command">lemma</span></span> thetaSeqTT_RetrT<span class="main">:</span>
<span class="quoted"><span class="quoted">"thetaSeqTT <span class="main">⊆</span> RetrT <span class="main">(</span>thetaSeqTT <span class="main">∪</span> BisT<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span> 
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c1</span> <span class="skolem">c2</span> <span class="skolem">d1</span> <span class="skolem">d2</span>
   <span class="keyword3"><span class="command">assume</span></span> c1d1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span> <span class="keyword1">≈T</span> <span class="skolem">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c2d2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c2</span> <span class="keyword1">≈T</span> <span class="skolem">d2</span>"</span></span>
   <span class="keyword1"><span class="command">hence</span></span> matchC_TMC1<span class="main">:</span> <span class="quoted"><span class="quoted">"matchC_TMC BisT <span class="skolem">c1</span> <span class="skolem">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> matchC_TMC2<span class="main">:</span> <span class="quoted"><span class="quoted">"matchC_TMC BisT <span class="skolem">c2</span> <span class="skolem">d2</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> matchT_TMT1<span class="main">:</span> <span class="quoted"><span class="quoted">"matchT_TMT <span class="skolem">c1</span> <span class="skolem">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> matchT_T2<span class="main">:</span> <span class="quoted"><span class="quoted">"matchT_TMT <span class="skolem">c2</span> <span class="skolem">d2</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> BisT_matchC_TMC BisT_matchT_TMT <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span> <span class="main">;;</span> <span class="skolem">c2</span><span class="main">,</span> <span class="skolem">d1</span> <span class="main">;;</span> <span class="skolem">d2</span><span class="main">)</span> <span class="main">∈</span> RetrT <span class="main">(</span>thetaSeqTT <span class="main">∪</span> BisT<span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">unfolding</span></span> RetrT_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"matchC_TMC <span class="main">(</span>thetaSeqTT <span class="main">∪</span> BisT<span class="main">)</span> <span class="main">(</span><span class="skolem">c1</span> <span class="main">;;</span> <span class="skolem">c2</span><span class="main">)</span> <span class="main">(</span><span class="skolem">d1</span> <span class="main">;;</span> <span class="skolem">d2</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">unfolding</span></span> matchC_TMC_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="entity">mauto_no_simp_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span>
       <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">c'</span> <span class="skolem">s'</span>
       <span class="keyword3"><span class="command">assume</span></span> mt<span class="main">:</span> <span class="quoted"><span class="quoted">"mustT <span class="main">(</span><span class="skolem">c1</span> <span class="main">;;</span> <span class="skolem">c2</span><span class="main">)</span> <span class="skolem">s</span>"</span></span> <span class="quoted"><span class="quoted">"mustT <span class="main">(</span><span class="skolem">d1</span> <span class="main">;;</span> <span class="skolem">d2</span><span class="main">)</span> <span class="skolem">t</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> st<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≈</span> <span class="skolem">t</span>"</span></span> 
       <span class="keyword1"><span class="command">hence</span></span> mt1<span class="main">:</span> <span class="quoted"><span class="quoted">"mustT <span class="skolem">c1</span> <span class="skolem">s</span>"</span></span> <span class="quoted"><span class="quoted">"mustT <span class="skolem">d1</span> <span class="skolem">t</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mustT_Seq_L mustT_Seq_R<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
       <span class="keyword3"><span class="command">assume</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span> <span class="main">;;</span> <span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
       <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d1</span> <span class="main">;;</span> <span class="skolem">d2</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> 
                      <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="bound">d'</span><span class="main">)</span> <span class="main">∈</span> thetaSeqTT <span class="main">∪</span> BisT<span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">elim</span> Seq_transC_invert<span class="main">)</span>
         <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c1'</span> <span class="keyword3"><span class="command">assume</span></span> c1s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c1'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">=</span> <span class="skolem">c1'</span> <span class="main">;;</span> <span class="skolem">c2</span>"</span></span>
         <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">d1'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d1</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="bound">d1'</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">c1'</span> <span class="keyword1">≈T</span> <span class="bound">d1'</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> mt1 st matchC_TMC1 <span class="keyword1"><span class="command">unfolding</span></span> matchC_TMC_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
         <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> c' thetaSeqTT_def
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Seq_MtransC c2d2<span class="main">)</span> 
       <span class="keyword1"><span class="command">next</span></span>      
         <span class="keyword3"><span class="command">assume</span></span> c1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="skolem">s'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">=</span> <span class="skolem">c2</span>"</span></span>
         <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t'</span></span> <span class="keyword2"><span class="keyword">where</span></span> d1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">d1</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="skolem">t'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> s't'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">≈</span> <span class="skolem">t'</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> mt1 st matchT_TMT1 <span class="keyword1"><span class="command">unfolding</span></span> matchT_TMT_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
         <span class="keyword1"><span class="command">hence</span></span> mt1<span class="main">:</span> <span class="quoted"><span class="quoted">"mustT <span class="skolem">c2</span> <span class="skolem">s'</span>"</span></span> <span class="quoted"><span class="quoted">"mustT <span class="skolem">d2</span> <span class="skolem">t'</span>"</span></span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> 0 c' mt mustT_transC<span class="main">)</span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mustT_Seq_R d1 mt<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
         <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
         <span class="keyword1"><span class="command">unfolding</span></span> c' thetaSeqTT_def
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="entity">mauto_no_simp_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Seq_MtransT_MtransC c2d2 d1 s't'<span class="main">)</span> 
       <span class="keyword1"><span class="command">qed</span></span>
     <span class="keyword1"><span class="command">qed</span></span> 
   <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">unfold</span> matchT_TMT_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> thetaSeqTT_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Compositionality-thetaSeqTT_BisT"><span class="command">lemma</span></span> thetaSeqTT_BisT<span class="main">:</span>
<span class="quoted"><span class="quoted">"thetaSeqTT <span class="main">⊆</span> BisT"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> BisT_coind<span class="main">)</span>
<span class="keyword1"><span class="command">using</span></span> thetaSeqTT_sym thetaSeqTT_RetrT <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> Seq_BisT<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c1</span> <span class="keyword1">≈T</span> <span class="free">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">c2</span> <span class="keyword1">≈T</span> <span class="free">d2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">c1</span> <span class="main">;;</span> <span class="free">c2</span> <span class="keyword1">≈T</span> <span class="free">d1</span> <span class="main">;;</span> <span class="free">d2</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms thetaSeqTT_BisT <span class="keyword1"><span class="command">unfolding</span></span> thetaSeqTT_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Conditional:›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">thetaIfTT</span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">thetaIfTT</span> <span class="main">≡</span> 
 <span class="main">{</span><span class="main">(</span>If <span class="bound">tst</span> <span class="bound">c1</span> <span class="bound">c2</span><span class="main">,</span> If <span class="bound">tst</span> <span class="bound">d1</span> <span class="bound">d2</span><span class="main">)</span> <span class="main">|</span> <span class="bound">tst</span> <span class="bound">c1</span> <span class="bound">c2</span> <span class="bound">d1</span> <span class="bound">d2</span><span class="main">.</span> compatTst <span class="bound">tst</span> <span class="main">∧</span> <span class="bound">c1</span> <span class="keyword1">≈T</span> <span class="bound">d1</span> <span class="main">∧</span> <span class="bound">c2</span> <span class="keyword1">≈T</span> <span class="bound">d2</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Compositionality-thetaIfTT_sym"><span class="command">lemma</span></span> thetaIfTT_sym<span class="main">:</span>
<span class="quoted"><span class="quoted">"sym thetaIfTT"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> thetaIfTT_def sym_def <span class="keyword1"><span class="command">using</span></span> BisT_Sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Compositionality-thetaIfTT_RetrT"><span class="command">lemma</span></span> thetaIfTT_RetrT<span class="main">:</span>
<span class="quoted"><span class="quoted">"thetaIfTT <span class="main">⊆</span> RetrT <span class="main">(</span>thetaIfTT <span class="main">∪</span> BisT<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span> 
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">tst</span> <span class="skolem">c1</span> <span class="skolem">c2</span> <span class="skolem">d1</span> <span class="skolem">d2</span>
   <span class="keyword3"><span class="command">assume</span></span> tst<span class="main">:</span> <span class="quoted"><span class="quoted">"compatTst <span class="skolem">tst</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c1d1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span> <span class="keyword1">≈T</span> <span class="skolem">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c2d2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c2</span> <span class="keyword1">≈T</span> <span class="skolem">d2</span>"</span></span>
   <span class="keyword1"><span class="command">hence</span></span> matchC_TMC1<span class="main">:</span> <span class="quoted"><span class="quoted">"matchC_TMC BisT <span class="skolem">c1</span> <span class="skolem">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> matchC_TMC2<span class="main">:</span> <span class="quoted"><span class="quoted">"matchC_TMC BisT <span class="skolem">c2</span> <span class="skolem">d2</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> matchT_TMT1<span class="main">:</span> <span class="quoted"><span class="quoted">"matchT_TMT <span class="skolem">c1</span> <span class="skolem">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> matchT_TMT2<span class="main">:</span> <span class="quoted"><span class="quoted">"matchT_TMT <span class="skolem">c2</span> <span class="skolem">d2</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> BisT_matchC_TMC BisT_matchT_TMT <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>If <span class="skolem">tst</span> <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">,</span> If <span class="skolem">tst</span> <span class="skolem">d1</span> <span class="skolem">d2</span><span class="main">)</span> <span class="main">∈</span> RetrT <span class="main">(</span>thetaIfTT <span class="main">∪</span> BisT<span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">unfolding</span></span> RetrT_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"matchC_TMC <span class="main">(</span>thetaIfTT <span class="main">∪</span> BisT<span class="main">)</span> <span class="main">(</span>If <span class="skolem">tst</span> <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">)</span> <span class="main">(</span>If <span class="skolem">tst</span> <span class="skolem">d1</span> <span class="skolem">d2</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">unfolding</span></span> matchC_TMC_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="entity">mauto_no_simp_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span>
       <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">c'</span> <span class="skolem">s'</span>
       <span class="keyword3"><span class="command">assume</span></span> st<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≈</span> <span class="skolem">t</span>"</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>If <span class="skolem">tst</span> <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
       <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span>If <span class="skolem">tst</span> <span class="skolem">d1</span> <span class="skolem">d2</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> 
                     <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="bound">d'</span><span class="main">)</span> <span class="main">∈</span> thetaIfTT <span class="main">∪</span> BisT"</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> If_transC_invert<span class="main">)</span>
       <span class="keyword1"><span class="command">unfolding</span></span> thetaIfTT_def 
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> IfTrue c1d1 compatTst_def st transC_MtransC tst<span class="main">)</span> 
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IfFalse c2d2 compatTst_def st transC_MtransC tst<span class="main">)</span> 
     <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">unfold</span> matchT_TMT_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> thetaIfTT_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Compositionality-thetaIfTT_BisT"><span class="command">lemma</span></span> thetaIfTT_BisT<span class="main">:</span>
<span class="quoted"><span class="quoted">"thetaIfTT <span class="main">⊆</span> BisT"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> BisT_coind<span class="main">)</span>
<span class="keyword1"><span class="command">using</span></span> thetaIfTT_sym thetaIfTT_RetrT <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> If_BisT<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"compatTst <span class="free">tst</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">c1</span> <span class="keyword1">≈T</span> <span class="free">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">c2</span> <span class="keyword1">≈T</span> <span class="free">d2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"If <span class="free">tst</span> <span class="free">c1</span> <span class="free">c2</span> <span class="keyword1">≈T</span> If <span class="free">tst</span> <span class="free">d1</span> <span class="free">d2</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms thetaIfTT_BisT <span class="keyword1"><span class="command">unfolding</span></span> thetaIfTT_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹While loop:›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">thetaWhileW0</span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">thetaWhileW0</span> <span class="main">≡</span> 
 <span class="main">{</span><span class="main">(</span>While <span class="bound">tst</span> <span class="bound">c</span><span class="main">,</span> While <span class="bound">tst</span> <span class="bound">d</span><span class="main">)</span> <span class="main">|</span> <span class="bound">tst</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">.</span> compatTst <span class="bound">tst</span> <span class="main">∧</span> <span class="bound">c</span> <span class="keyword1">≈T</span> <span class="bound">d</span><span class="main">}</span> <span class="main">∪</span> 
 <span class="main">{</span><span class="main">(</span><span class="bound">c1</span> <span class="main">;;</span> <span class="main">(</span>While <span class="bound">tst</span> <span class="bound">c</span><span class="main">)</span><span class="main">,</span> <span class="bound">d1</span> <span class="main">;;</span> <span class="main">(</span>While <span class="bound">tst</span> <span class="bound">d</span><span class="main">)</span><span class="main">)</span> <span class="main">|</span> <span class="bound">tst</span> <span class="bound">c1</span> <span class="bound">d1</span> <span class="bound">c</span> <span class="bound">d</span><span class="main">.</span> 
               compatTst <span class="bound">tst</span> <span class="main">∧</span> <span class="bound">c1</span> <span class="keyword1">≈T</span> <span class="bound">d1</span> <span class="main">∧</span> <span class="bound">c</span> <span class="keyword1">≈T</span> <span class="bound">d</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Compositionality-thetaWhileW0_sym"><span class="command">lemma</span></span> thetaWhileW0_sym<span class="main">:</span>
<span class="quoted"><span class="quoted">"sym thetaWhileW0"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> thetaWhileW0_def sym_def <span class="keyword1"><span class="command">using</span></span> BisT_Sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Compositionality-thetaWhileW0_RetrT"><span class="command">lemma</span></span> thetaWhileW0_RetrT<span class="main">:</span>
<span class="quoted"><span class="quoted">"thetaWhileW0 <span class="main">⊆</span> RetrT <span class="main">(</span>thetaWhileW0 <span class="main">∪</span> BisT<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">tst</span> <span class="skolem">c</span> <span class="skolem">d</span> 
   <span class="keyword3"><span class="command">assume</span></span> tst<span class="main">:</span> <span class="quoted"><span class="quoted">"compatTst <span class="skolem">tst</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c_d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="keyword1">≈T</span> <span class="skolem">d</span>"</span></span>
   <span class="keyword1"><span class="command">hence</span></span> matchC_TMC<span class="main">:</span> <span class="quoted"><span class="quoted">"matchC_TMC BisT <span class="skolem">c</span> <span class="skolem">d</span>"</span></span> 
     <span class="keyword2"><span class="keyword">and</span></span> matchT_TMT<span class="main">:</span> <span class="quoted"><span class="quoted">"matchT_TMT <span class="skolem">c</span> <span class="skolem">d</span>"</span></span> 
   <span class="keyword1"><span class="command">using</span></span> BisT_matchC_TMC BisT_matchT_TMT <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>While <span class="skolem">tst</span> <span class="skolem">c</span><span class="main">,</span> While <span class="skolem">tst</span> <span class="skolem">d</span><span class="main">)</span> <span class="main">∈</span> RetrT <span class="main">(</span>thetaWhileW0 <span class="main">∪</span> BisT<span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">unfolding</span></span> RetrT_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"matchC_TMC <span class="main">(</span>thetaWhileW0 <span class="main">∪</span> BisT<span class="main">)</span> <span class="main">(</span>While <span class="skolem">tst</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">(</span>While <span class="skolem">tst</span> <span class="skolem">d</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">unfolding</span></span> matchC_TMC_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="entity">mauto_no_simp_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span>
       <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">c'</span> <span class="skolem">s'</span>
       <span class="keyword3"><span class="command">assume</span></span> st<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≈</span> <span class="skolem">t</span>"</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>While <span class="skolem">tst</span> <span class="skolem">c</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
       <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span>While <span class="skolem">tst</span> <span class="skolem">d</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> 
                     <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="bound">d'</span><span class="main">)</span> <span class="main">∈</span> thetaWhileW0 <span class="main">∪</span> BisT"</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> While_transC_invert<span class="main">)</span>
       <span class="keyword1"><span class="command">unfolding</span></span> thetaWhileW0_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> WhileTrue transC_MtransC c_d compatTst_def st tst<span class="main">)</span>
     <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">next</span></span>
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"matchT_TMT <span class="main">(</span>While <span class="skolem">tst</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">(</span>While <span class="skolem">tst</span> <span class="skolem">d</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">unfolding</span></span> matchT_TMT_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="entity">mauto_no_simp_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span>
       <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">s'</span> <span class="keyword3"><span class="command">assume</span></span> st<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≈</span> <span class="skolem">t</span>"</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>While <span class="skolem">tst</span> <span class="skolem">c</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="skolem">s'</span>"</span></span>
       <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t'</span><span class="main">.</span> <span class="main">(</span>While <span class="skolem">tst</span> <span class="skolem">d</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> "</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> While_transT_invert<span class="main">)</span>
       <span class="keyword1"><span class="command">unfolding</span></span> thetaWhileW0_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> WhileFalse compatTst_def st transT_MtransT tst<span class="main">)</span>       
     <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> 
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">tst</span> <span class="skolem">c1</span> <span class="skolem">d1</span>  <span class="skolem">c</span> <span class="skolem">d</span>
   <span class="keyword3"><span class="command">assume</span></span> tst<span class="main">:</span> <span class="quoted"><span class="quoted">"compatTst <span class="skolem">tst</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c1d1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span> <span class="keyword1">≈T</span> <span class="skolem">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c_d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="keyword1">≈T</span> <span class="skolem">d</span>"</span></span>
   <span class="keyword1"><span class="command">hence</span></span> matchC_TMC1<span class="main">:</span> <span class="quoted"><span class="quoted">"matchC_TMC BisT <span class="skolem">c1</span> <span class="skolem">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> matchC_TMC<span class="main">:</span> <span class="quoted"><span class="quoted">"matchC_TMC BisT <span class="skolem">c</span> <span class="skolem">d</span>"</span></span> 
     <span class="keyword2"><span class="keyword">and</span></span> matchT_TMT1<span class="main">:</span> <span class="quoted"><span class="quoted">"matchT_TMT <span class="skolem">c1</span> <span class="skolem">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> matchT_TMT<span class="main">:</span> <span class="quoted"><span class="quoted">"matchT_TMT <span class="skolem">c</span> <span class="skolem">d</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> BisT_matchC_TMC BisT_matchT_TMT <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span> <span class="main">;;</span> <span class="main">(</span>While <span class="skolem">tst</span> <span class="skolem">c</span><span class="main">)</span><span class="main">,</span> <span class="skolem">d1</span> <span class="main">;;</span> <span class="main">(</span>While <span class="skolem">tst</span> <span class="skolem">d</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> RetrT <span class="main">(</span>thetaWhileW0 <span class="main">∪</span> BisT<span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">unfolding</span></span> RetrT_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"matchC_TMC <span class="main">(</span>thetaWhileW0 <span class="main">∪</span> BisT<span class="main">)</span> <span class="main">(</span><span class="skolem">c1</span> <span class="main">;;</span> <span class="main">(</span>While <span class="skolem">tst</span> <span class="skolem">c</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">d1</span> <span class="main">;;</span> <span class="main">(</span>While <span class="skolem">tst</span> <span class="skolem">d</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">unfolding</span></span> matchC_TMC_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="entity">mauto_no_simp_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span>
       <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">c'</span> <span class="skolem">s'</span>
       <span class="keyword3"><span class="command">assume</span></span> mt<span class="main">:</span> <span class="quoted"><span class="quoted">"mustT <span class="main">(</span><span class="skolem">c1</span> <span class="main">;;</span> While <span class="skolem">tst</span> <span class="skolem">c</span><span class="main">)</span> <span class="skolem">s</span>"</span></span> <span class="quoted"><span class="quoted">"mustT <span class="main">(</span><span class="skolem">d1</span> <span class="main">;;</span> While <span class="skolem">tst</span> <span class="skolem">d</span><span class="main">)</span> <span class="skolem">t</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> st<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≈</span> <span class="skolem">t</span>"</span></span> 
       <span class="keyword1"><span class="command">hence</span></span> mt1<span class="main">:</span> <span class="quoted"><span class="quoted">"mustT <span class="skolem">c1</span> <span class="skolem">s</span>"</span></span> <span class="quoted"><span class="quoted">"mustT <span class="skolem">d1</span> <span class="skolem">t</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mustT_Seq_L mustT_Seq_R<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>     
       <span class="keyword3"><span class="command">assume</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span> <span class="main">;;</span> <span class="main">(</span>While <span class="skolem">tst</span> <span class="skolem">c</span><span class="main">)</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
       <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d1</span> <span class="main">;;</span> <span class="main">(</span>While <span class="skolem">tst</span> <span class="skolem">d</span><span class="main">)</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> 
                     <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="bound">d'</span><span class="main">)</span> <span class="main">∈</span> thetaWhileW0 <span class="main">∪</span> BisT"</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">erule</span> Seq_transC_invert<span class="main">)</span>
         <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c1'</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c1'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">=</span> <span class="skolem">c1'</span> <span class="main">;;</span> <span class="main">(</span>While <span class="skolem">tst</span> <span class="skolem">c</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d1</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">c1'</span> <span class="keyword1">≈T</span> <span class="bound">d'</span>"</span></span> 
         <span class="keyword1"><span class="command">using</span></span> mt1 st matchC_TMC1 <span class="keyword1"><span class="command">unfolding</span></span> matchC_TMC_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
         <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
         <span class="keyword1"><span class="command">unfolding</span></span> c' thetaWhileW0_def
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Seq_MtransC c_d tst<span class="main">)</span>
       <span class="keyword1"><span class="command">next</span></span>
         <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="skolem">s'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">=</span> While <span class="skolem">tst</span> <span class="skolem">c</span>"</span></span>
         <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">d1</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="skolem">t'</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="skolem">t'</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> mt1 st matchT_TMT1 <span class="keyword1"><span class="command">unfolding</span></span> matchT_TMT_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
         <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
         <span class="keyword1"><span class="command">unfolding</span></span> c' thetaWhileW0_def 
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Seq_MtransT_MtransC c_d tst<span class="main">)</span>
       <span class="keyword1"><span class="command">qed</span></span>
     <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">unfold</span> matchT_TMT_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> thetaWhileW0_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Compositionality-thetaWhileW0_BisT"><span class="command">lemma</span></span> thetaWhileW0_BisT<span class="main">:</span>
<span class="quoted"><span class="quoted">"thetaWhileW0 <span class="main">⊆</span> BisT"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> BisT_coind<span class="main">)</span>
<span class="keyword1"><span class="command">using</span></span> thetaWhileW0_sym thetaWhileW0_RetrT <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> While_BisT<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"compatTst <span class="free">tst</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="keyword1">≈T</span> <span class="free">d</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"While <span class="free">tst</span> <span class="free">c</span> <span class="keyword1">≈T</span> While <span class="free">tst</span> <span class="free">d</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms thetaWhileW0_BisT <span class="keyword1"><span class="command">unfolding</span></span> thetaWhileW0_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Parallel composition:›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">thetaParTT</span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">thetaParTT</span> <span class="main">≡</span> 
 <span class="main">{</span><span class="main">(</span>Par <span class="bound">c1</span> <span class="bound">c2</span><span class="main">,</span> Par <span class="bound">d1</span> <span class="bound">d2</span><span class="main">)</span> <span class="main">|</span> <span class="bound">c1</span> <span class="bound">c2</span> <span class="bound">d1</span> <span class="bound">d2</span><span class="main">.</span> <span class="bound">c1</span> <span class="keyword1">≈T</span> <span class="bound">d1</span> <span class="main">∧</span> <span class="bound">c2</span> <span class="keyword1">≈T</span> <span class="bound">d2</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Compositionality-thetaParTT_sym"><span class="command">lemma</span></span> thetaParTT_sym<span class="main">:</span>
<span class="quoted"><span class="quoted">"sym thetaParTT"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> thetaParTT_def sym_def <span class="keyword1"><span class="command">using</span></span> BisT_Sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Compositionality-thetaParTT_RetrT"><span class="command">lemma</span></span> thetaParTT_RetrT<span class="main">:</span>
<span class="quoted"><span class="quoted">"thetaParTT <span class="main">⊆</span> RetrT <span class="main">(</span>thetaParTT <span class="main">∪</span> BisT<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c1</span> <span class="skolem">c2</span> <span class="skolem">d1</span> <span class="skolem">d2</span>
   <span class="keyword3"><span class="command">assume</span></span> c1d1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span> <span class="keyword1">≈T</span> <span class="skolem">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c2d2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c2</span> <span class="keyword1">≈T</span> <span class="skolem">d2</span>"</span></span>
   <span class="keyword1"><span class="command">hence</span></span> matchC_TMC1<span class="main">:</span> <span class="quoted"><span class="quoted">"matchC_TMC BisT <span class="skolem">c1</span> <span class="skolem">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> matchC_TMC2<span class="main">:</span> <span class="quoted"><span class="quoted">"matchC_TMC BisT <span class="skolem">c2</span> <span class="skolem">d2</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> matchT_TMT1<span class="main">:</span> <span class="quoted"><span class="quoted">"matchT_TMT <span class="skolem">c1</span> <span class="skolem">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> matchT_TMT2<span class="main">:</span> <span class="quoted"><span class="quoted">"matchT_TMT <span class="skolem">c2</span> <span class="skolem">d2</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> BisT_matchC_TMC BisT_matchT_TMT <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Par <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">,</span> Par <span class="skolem">d1</span> <span class="skolem">d2</span><span class="main">)</span> <span class="main">∈</span> RetrT <span class="main">(</span>thetaParTT <span class="main">∪</span> BisT<span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">unfolding</span></span> RetrT_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"matchC_TMC <span class="main">(</span>thetaParTT <span class="main">∪</span> BisT<span class="main">)</span> <span class="main">(</span>Par <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">)</span> <span class="main">(</span>Par <span class="skolem">d1</span> <span class="skolem">d2</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">unfolding</span></span> matchC_TMC_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="entity">mauto_no_simp_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span>
       <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">c'</span> <span class="skolem">s'</span>
       <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"mustT <span class="main">(</span>Par <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">)</span> <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"mustT <span class="main">(</span>Par <span class="skolem">d1</span> <span class="skolem">d2</span><span class="main">)</span> <span class="skolem">t</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> st<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≈</span> <span class="skolem">t</span>"</span></span> 
       <span class="keyword1"><span class="command">hence</span></span> mt<span class="main">:</span> <span class="quoted"><span class="quoted">"mustT <span class="skolem">c1</span> <span class="skolem">s</span>"</span></span> <span class="quoted"><span class="quoted">"mustT <span class="skolem">c2</span> <span class="skolem">s</span>"</span></span>
                 <span class="quoted"><span class="quoted">"mustT <span class="skolem">d1</span> <span class="skolem">t</span>"</span></span> <span class="quoted"><span class="quoted">"mustT <span class="skolem">d2</span> <span class="skolem">t</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mustT_Par_L mustT_Par_R<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>        
       <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Par <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
       <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span>Par <span class="skolem">d1</span> <span class="skolem">d2</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> 
                     <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="bound">d'</span><span class="main">)</span> <span class="main">∈</span> thetaParTT <span class="main">∪</span> BisT"</span></span>
       <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">elim</span> Par_transC_invert<span class="main">)</span>
         <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c1'</span> <span class="keyword3"><span class="command">assume</span></span> c1s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c1'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">=</span> Par <span class="skolem">c1'</span> <span class="skolem">c2</span>"</span></span>
         <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d1</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">c1'</span> <span class="keyword1">≈T</span> <span class="bound">d'</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> mt st matchC_TMC1 <span class="keyword1"><span class="command">unfolding</span></span> matchC_TMC_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
         <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> c' thetaParTT_def
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ParCL_MtransC c2d2<span class="main">)</span> 
       <span class="keyword1"><span class="command">next</span></span>      
         <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="skolem">s'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">=</span> <span class="skolem">c2</span>"</span></span>
         <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d1</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> mt st matchT_TMT1 <span class="keyword1"><span class="command">unfolding</span></span> matchT_TMT_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
         <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
         <span class="keyword1"><span class="command">unfolding</span></span> c' thetaParTT_def
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> PL.ParTL_MtransC c2d2<span class="main">)</span>
       <span class="keyword1"><span class="command">next</span></span>
         <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c2'</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c2'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">=</span> Par <span class="skolem">c1</span> <span class="skolem">c2'</span>"</span></span>
         <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d2</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">c2'</span> <span class="keyword1">≈T</span> <span class="bound">d'</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> mt st matchC_TMC2 <span class="keyword1"><span class="command">unfolding</span></span> matchC_TMC_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
         <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
         <span class="keyword1"><span class="command">unfolding</span></span> c' thetaParTT_def
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> PL.ParCR_MtransC c1d1<span class="main">)</span>
       <span class="keyword1"><span class="command">next</span></span>
         <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="skolem">s'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">=</span> <span class="skolem">c1</span>"</span></span>
         <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d2</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> mt st matchT_TMT2 <span class="keyword1"><span class="command">unfolding</span></span> matchT_TMT_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
         <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
         <span class="keyword1"><span class="command">unfolding</span></span> c' thetaParTT_def
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> PL.ParTR_MtransC c1d1<span class="main">)</span>
       <span class="keyword1"><span class="command">qed</span></span>
     <span class="keyword1"><span class="command">qed</span></span> 
   <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">unfold</span> matchT_TMT_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> thetaParTT_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Compositionality-thetaParTT_BisT"><span class="command">lemma</span></span> thetaParTT_BisT<span class="main">:</span>
<span class="quoted"><span class="quoted">"thetaParTT <span class="main">⊆</span> BisT"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> BisT_coind<span class="main">)</span>
<span class="keyword1"><span class="command">using</span></span> thetaParTT_sym thetaParTT_RetrT <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> Par_BisT<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c1</span> <span class="keyword1">≈T</span> <span class="free">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">c2</span> <span class="keyword1">≈T</span> <span class="free">d2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Par <span class="free">c1</span> <span class="free">c2</span> <span class="keyword1">≈T</span> Par <span class="free">d1</span> <span class="free">d2</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms thetaParTT_BisT <span class="keyword1"><span class="command">unfolding</span></span> thetaParTT_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹W-bisimilarity versus language constructs›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Atomic commands:›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> Atm_Wbis<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"compatAtm <span class="free">atm</span>"</span></span> 
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Atm <span class="free">atm</span> <span class="keyword1">≈w</span> Atm <span class="free">atm</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Atm_Sbis assms bis_imp<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Discreetness:›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> discr_Wbis<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"discr <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"discr <span class="free">d</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="keyword1">≈w</span> <span class="free">d</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> * ** bis_imp<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> discr_ZObis<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Sequential composition:›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">thetaSeqW</span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">thetaSeqW</span> <span class="main">≡</span> 
 <span class="main">{</span><span class="main">(</span><span class="bound">c1</span> <span class="main">;;</span> <span class="bound">c2</span><span class="main">,</span> <span class="bound">d1</span> <span class="main">;;</span> <span class="bound">d2</span><span class="main">)</span> <span class="main">|</span> <span class="bound">c1</span> <span class="bound">c2</span> <span class="bound">d1</span> <span class="bound">d2</span><span class="main">.</span> <span class="bound">c1</span> <span class="keyword1">≈wT</span> <span class="bound">d1</span> <span class="main">∧</span> <span class="bound">c2</span> <span class="keyword1">≈w</span> <span class="bound">d2</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Compositionality-thetaSeqW_sym"><span class="command">lemma</span></span> thetaSeqW_sym<span class="main">:</span>
<span class="quoted"><span class="quoted">"sym thetaSeqW"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> thetaSeqW_def sym_def <span class="keyword1"><span class="command">using</span></span> WbisT_Sym Wbis_Sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Compositionality-thetaSeqW_Wretr"><span class="command">lemma</span></span> thetaSeqW_Wretr<span class="main">:</span>
<span class="quoted"><span class="quoted">"thetaSeqW <span class="main">⊆</span> Wretr <span class="main">(</span>thetaSeqW <span class="main">∪</span> Wbis<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span> 
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c1</span> <span class="skolem">c2</span> <span class="skolem">d1</span> <span class="skolem">d2</span>
   <span class="keyword3"><span class="command">assume</span></span> c1d1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span> <span class="keyword1">≈wT</span> <span class="skolem">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c2d2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c2</span> <span class="keyword1">≈w</span> <span class="skolem">d2</span>"</span></span>
   <span class="keyword1"><span class="command">hence</span></span> matchC_MC1<span class="main">:</span> <span class="quoted"><span class="quoted">"matchC_MC WbisT <span class="skolem">c1</span> <span class="skolem">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> matchC_W2<span class="main">:</span> <span class="quoted"><span class="quoted">"matchC_M Wbis <span class="skolem">c2</span> <span class="skolem">d2</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> matchT_MT1<span class="main">:</span> <span class="quoted"><span class="quoted">"matchT_MT <span class="skolem">c1</span> <span class="skolem">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> matchT_M2<span class="main">:</span> <span class="quoted"><span class="quoted">"matchT_M <span class="skolem">c2</span> <span class="skolem">d2</span>"</span></span> 
   <span class="keyword1"><span class="command">using</span></span> WbisT_matchC_MC WbisT_matchT_MT Wbis_matchC_M Wbis_matchT_M <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span> <span class="main">;;</span> <span class="skolem">c2</span><span class="main">,</span> <span class="skolem">d1</span> <span class="main">;;</span> <span class="skolem">d2</span><span class="main">)</span> <span class="main">∈</span> Wretr <span class="main">(</span>thetaSeqW <span class="main">∪</span> Wbis<span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">unfolding</span></span> Wretr_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"matchC_M <span class="main">(</span>thetaSeqW <span class="main">∪</span> Wbis<span class="main">)</span> <span class="main">(</span><span class="skolem">c1</span> <span class="main">;;</span> <span class="skolem">c2</span><span class="main">)</span> <span class="main">(</span><span class="skolem">d1</span> <span class="main">;;</span> <span class="skolem">d2</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">unfolding</span></span> matchC_M_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="entity">mauto_no_simp_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span>
       <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">c'</span> <span class="skolem">s'</span>
       <span class="keyword3"><span class="command">assume</span></span> st<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≈</span> <span class="skolem">t</span>"</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span> <span class="main">;;</span> <span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
       <span class="keyword3"><span class="command">thus</span></span> 
       <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d1</span> <span class="main">;;</span> <span class="skolem">d2</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="bound">d'</span><span class="main">)</span> <span class="main">∈</span> thetaSeqW <span class="main">∪</span> Wbis<span class="main">)</span> <span class="main">∨</span> 
        <span class="main">(</span><span class="main">∃</span><span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d1</span> <span class="main">;;</span> <span class="skolem">d2</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> discr <span class="skolem">c'</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">erule</span> Seq_transC_invert<span class="main">)</span>
         <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c1'</span> <span class="keyword3"><span class="command">assume</span></span> c1s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c1'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">=</span> <span class="skolem">c1'</span> <span class="main">;;</span> <span class="skolem">c2</span>"</span></span>
         <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">d1'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d1</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="bound">d1'</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">c1'</span> <span class="keyword1">≈wT</span> <span class="bound">d1'</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> st matchC_MC1 <span class="keyword1"><span class="command">unfolding</span></span> matchC_MC_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
         <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> c' thetaSeqW_def
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> PL.Seq_MtransC c2d2<span class="main">)</span>
       <span class="keyword1"><span class="command">next</span></span>      
         <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="skolem">s'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">=</span> <span class="skolem">c2</span>"</span></span>
         <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d1</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> st matchT_MT1 <span class="keyword1"><span class="command">unfolding</span></span> matchT_MT_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
         <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
         <span class="keyword1"><span class="command">unfolding</span></span> c' thetaSeqW_def
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> PL.Seq_MtransT_MtransC c2d2<span class="main">)</span> 
       <span class="keyword1"><span class="command">qed</span></span>
     <span class="keyword1"><span class="command">qed</span></span> 
   <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">unfold</span> matchT_M_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> thetaSeqW_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Compositionality-thetaSeqW_Wbis"><span class="command">lemma</span></span> thetaSeqW_Wbis<span class="main">:</span>
<span class="quoted"><span class="quoted">"thetaSeqW <span class="main">⊆</span> Wbis"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Wbis_coind<span class="main">)</span>
<span class="keyword1"><span class="command">using</span></span> thetaSeqW_sym thetaSeqW_Wretr <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> Seq_WbisT_Wbis<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c1</span> <span class="keyword1">≈wT</span> <span class="free">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">c2</span> <span class="keyword1">≈w</span> <span class="free">d2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">c1</span> <span class="main">;;</span> <span class="free">c2</span> <span class="keyword1">≈w</span> <span class="free">d1</span> <span class="main">;;</span> <span class="free">d2</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms thetaSeqW_Wbis <span class="keyword1"><span class="command">unfolding</span></span> thetaSeqW_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">theorem</span></span> Seq_siso_Wbis<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"siso <span class="free">e</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">c2</span> <span class="keyword1">≈w</span> <span class="free">d2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">;;</span> <span class="free">c2</span> <span class="keyword1">≈w</span> <span class="free">e</span> <span class="main">;;</span> <span class="free">d2</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="comment1">(*  *)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">thetaSeqWD</span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">thetaSeqWD</span> <span class="main">≡</span> 
 <span class="main">{</span><span class="main">(</span><span class="bound">c1</span> <span class="main">;;</span> <span class="bound">c2</span><span class="main">,</span> <span class="bound">d1</span> <span class="main">;;</span> <span class="bound">d2</span><span class="main">)</span> <span class="main">|</span> <span class="bound">c1</span> <span class="bound">c2</span> <span class="bound">d1</span> <span class="bound">d2</span><span class="main">.</span> <span class="bound">c1</span> <span class="keyword1">≈w</span> <span class="bound">d1</span> <span class="main">∧</span> discr <span class="bound">c2</span> <span class="main">∧</span> discr <span class="bound">d2</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Compositionality-thetaSeqWD_sym"><span class="command">lemma</span></span> thetaSeqWD_sym<span class="main">:</span>
<span class="quoted"><span class="quoted">"sym thetaSeqWD"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> thetaSeqWD_def sym_def <span class="keyword1"><span class="command">using</span></span> Wbis_Sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Compositionality-thetaSeqWD_Wretr"><span class="command">lemma</span></span> thetaSeqWD_Wretr<span class="main">:</span>
<span class="quoted"><span class="quoted">"thetaSeqWD <span class="main">⊆</span> Wretr <span class="main">(</span>thetaSeqWD <span class="main">∪</span> Wbis<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c1</span> <span class="skolem">c2</span> <span class="skolem">d1</span> <span class="skolem">d2</span>
   <span class="keyword3"><span class="command">assume</span></span> c1d1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span> <span class="keyword1">≈w</span> <span class="skolem">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c2<span class="main">:</span> <span class="quoted"><span class="quoted">"discr <span class="skolem">c2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> d2<span class="main">:</span> <span class="quoted"><span class="quoted">"discr <span class="skolem">d2</span>"</span></span>
   <span class="keyword1"><span class="command">hence</span></span> matchC_M<span class="main">:</span> <span class="quoted"><span class="quoted">"matchC_M Wbis <span class="skolem">c1</span> <span class="skolem">d1</span>"</span></span> 
     <span class="keyword2"><span class="keyword">and</span></span> matchT_M<span class="main">:</span> <span class="quoted"><span class="quoted">"matchT_M <span class="skolem">c1</span> <span class="skolem">d1</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> Wbis_matchC_M Wbis_matchT_M <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span> <span class="main">;;</span> <span class="skolem">c2</span><span class="main">,</span> <span class="skolem">d1</span> <span class="main">;;</span> <span class="skolem">d2</span><span class="main">)</span> <span class="main">∈</span> Wretr <span class="main">(</span>thetaSeqWD <span class="main">∪</span> Wbis<span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">unfolding</span></span> Wretr_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"matchC_M <span class="main">(</span>thetaSeqWD <span class="main">∪</span> Wbis<span class="main">)</span> <span class="main">(</span><span class="skolem">c1</span> <span class="main">;;</span> <span class="skolem">c2</span><span class="main">)</span> <span class="main">(</span><span class="skolem">d1</span> <span class="main">;;</span> <span class="skolem">d2</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">unfolding</span></span> matchC_M_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="entity">mauto_no_simp_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span>
       <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">c'</span> <span class="skolem">s'</span>
       <span class="keyword3"><span class="command">assume</span></span> st<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≈</span> <span class="skolem">t</span>"</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span> <span class="main">;;</span> <span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
       <span class="keyword3"><span class="command">thus</span></span> 
       <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d1</span> <span class="main">;;</span> <span class="skolem">d2</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="bound">d'</span><span class="main">)</span> <span class="main">∈</span> thetaSeqWD <span class="main">∪</span> Wbis<span class="main">)</span> <span class="main">∨</span> 
        <span class="main">(</span><span class="main">∃</span><span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d1</span> <span class="main">;;</span> <span class="skolem">d2</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> discr <span class="skolem">c'</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">erule</span> Seq_transC_invert<span class="main">)</span>
         <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c1'</span> <span class="keyword3"><span class="command">assume</span></span> c1s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c1'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">=</span> <span class="skolem">c1'</span> <span class="main">;;</span> <span class="skolem">c2</span>"</span></span>
         <span class="keyword1"><span class="command">hence</span></span>
         <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d1</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">c1'</span> <span class="keyword1">≈w</span> <span class="bound">d'</span><span class="main">)</span> <span class="main">∨</span> 
          <span class="main">(</span><span class="main">∃</span><span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d1</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> discr <span class="skolem">c1'</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> st matchC_M <span class="keyword1"><span class="command">unfolding</span></span> matchC_M_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
         <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> c' thetaSeqWD_def
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="entity">mauto_no_simp_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> PL.Seq_MtransC c2 d2<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> PL.Seq_MtransT_MtransC c2 d2 discr_Seq discr_Wbis<span class="main">)</span>
       <span class="keyword1"><span class="command">next</span></span>      
         <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="skolem">s'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">=</span> <span class="skolem">c2</span>"</span></span>
         <span class="keyword1"><span class="command">hence</span></span> 
         <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d1</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> discr <span class="bound">d'</span><span class="main">)</span> <span class="main">∨</span> 
          <span class="main">(</span><span class="main">∃</span><span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d1</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> st matchT_M <span class="keyword1"><span class="command">unfolding</span></span> matchT_M_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
         <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
         <span class="keyword1"><span class="command">unfolding</span></span> c' thetaSeqWD_def
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="entity">mauto_no_simp_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> PL.Seq_MtransC c2 d2 discr_Seq discr_Wbis<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> PL.Seq_MtransT_MtransC c2 d2 discr_Wbis<span class="main">)</span>
       <span class="keyword1"><span class="command">qed</span></span>
     <span class="keyword1"><span class="command">qed</span></span> 
   <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">unfold</span> matchT_M_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> thetaSeqWD_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Compositionality-thetaSeqWD_Wbis"><span class="command">lemma</span></span> thetaSeqWD_Wbis<span class="main">:</span>
<span class="quoted"><span class="quoted">"thetaSeqWD <span class="main">⊆</span> Wbis"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Wbis_coind<span class="main">)</span>
<span class="keyword1"><span class="command">using</span></span> thetaSeqWD_sym thetaSeqWD_Wretr <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> Seq_Wbis_discr<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c1</span> <span class="keyword1">≈w</span> <span class="free">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"discr <span class="free">c2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"discr <span class="free">d2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">c1</span> <span class="main">;;</span> <span class="free">c2</span> <span class="keyword1">≈w</span> <span class="free">d1</span> <span class="main">;;</span> <span class="free">d2</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms thetaSeqWD_Wbis <span class="keyword1"><span class="command">unfolding</span></span> thetaSeqWD_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Conditional:›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">thetaIfW</span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">thetaIfW</span> <span class="main">≡</span> 
 <span class="main">{</span><span class="main">(</span>If <span class="bound">tst</span> <span class="bound">c1</span> <span class="bound">c2</span><span class="main">,</span> If <span class="bound">tst</span> <span class="bound">d1</span> <span class="bound">d2</span><span class="main">)</span> <span class="main">|</span> <span class="bound">tst</span> <span class="bound">c1</span> <span class="bound">c2</span> <span class="bound">d1</span> <span class="bound">d2</span><span class="main">.</span> compatTst <span class="bound">tst</span> <span class="main">∧</span> <span class="bound">c1</span> <span class="keyword1">≈w</span> <span class="bound">d1</span> <span class="main">∧</span> <span class="bound">c2</span> <span class="keyword1">≈w</span> <span class="bound">d2</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Compositionality-thetaIfW_sym"><span class="command">lemma</span></span> thetaIfW_sym<span class="main">:</span>
<span class="quoted"><span class="quoted">"sym thetaIfW"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> thetaIfW_def sym_def <span class="keyword1"><span class="command">using</span></span> Wbis_Sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Compositionality-thetaIfW_Wretr"><span class="command">lemma</span></span> thetaIfW_Wretr<span class="main">:</span>
<span class="quoted"><span class="quoted">"thetaIfW <span class="main">⊆</span> Wretr <span class="main">(</span>thetaIfW <span class="main">∪</span> Wbis<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">tst</span> <span class="skolem">c1</span> <span class="skolem">c2</span> <span class="skolem">d1</span> <span class="skolem">d2</span>
   <span class="keyword3"><span class="command">assume</span></span> tst<span class="main">:</span> <span class="quoted"><span class="quoted">"compatTst <span class="skolem">tst</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c1d1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span> <span class="keyword1">≈w</span> <span class="skolem">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c2d2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c2</span> <span class="keyword1">≈w</span> <span class="skolem">d2</span>"</span></span>
   <span class="keyword1"><span class="command">hence</span></span> matchC_M1<span class="main">:</span> <span class="quoted"><span class="quoted">"matchC_M Wbis <span class="skolem">c1</span> <span class="skolem">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> matchC_M2<span class="main">:</span> <span class="quoted"><span class="quoted">"matchC_M Wbis <span class="skolem">c2</span> <span class="skolem">d2</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> matchT_M1<span class="main">:</span> <span class="quoted"><span class="quoted">"matchT_M <span class="skolem">c1</span> <span class="skolem">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> matchT_M2<span class="main">:</span> <span class="quoted"><span class="quoted">"matchT_M <span class="skolem">c2</span> <span class="skolem">d2</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> Wbis_matchC_M Wbis_matchT_M <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>If <span class="skolem">tst</span> <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">,</span> If <span class="skolem">tst</span> <span class="skolem">d1</span> <span class="skolem">d2</span><span class="main">)</span> <span class="main">∈</span> Wretr <span class="main">(</span>thetaIfW <span class="main">∪</span> Wbis<span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">unfolding</span></span> Wretr_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"matchC_M <span class="main">(</span>thetaIfW <span class="main">∪</span> Wbis<span class="main">)</span> <span class="main">(</span>If <span class="skolem">tst</span> <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">)</span> <span class="main">(</span>If <span class="skolem">tst</span> <span class="skolem">d1</span> <span class="skolem">d2</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">unfolding</span></span> matchC_M_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="entity">mauto_no_simp_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span>
       <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">c'</span> <span class="skolem">s'</span>
       <span class="keyword3"><span class="command">assume</span></span> st<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≈</span> <span class="skolem">t</span>"</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>If <span class="skolem">tst</span> <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
       <span class="keyword3"><span class="command">thus</span></span> 
       <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span>If <span class="skolem">tst</span> <span class="skolem">d1</span> <span class="skolem">d2</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="bound">d'</span><span class="main">)</span> <span class="main">∈</span> thetaIfW <span class="main">∪</span> Wbis<span class="main">)</span> <span class="main">∨</span> 
        <span class="main">(</span><span class="main">∃</span><span class="bound">t'</span><span class="main">.</span> <span class="main">(</span>If <span class="skolem">tst</span> <span class="skolem">d1</span> <span class="skolem">d2</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> discr <span class="skolem">c'</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> If_transC_invert<span class="main">)</span>
       <span class="keyword1"><span class="command">unfolding</span></span> thetaIfW_def 
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> IfTrue c1d1 compatTst_def st transC_MtransC tst<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IfFalse c2d2 compatTst_def st transC_MtransC tst<span class="main">)</span>
     <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">unfold</span> matchT_M_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> thetaIfW_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Compositionality-thetaIfW_Wbis"><span class="command">lemma</span></span> thetaIfW_Wbis<span class="main">:</span>
<span class="quoted"><span class="quoted">"thetaIfW <span class="main">⊆</span> Wbis"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Wbis_coind<span class="main">)</span>
<span class="keyword1"><span class="command">using</span></span> thetaIfW_sym thetaIfW_Wretr <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> If_Wbis<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"compatTst <span class="free">tst</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">c1</span> <span class="keyword1">≈w</span> <span class="free">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">c2</span> <span class="keyword1">≈w</span> <span class="free">d2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"If <span class="free">tst</span> <span class="free">c1</span> <span class="free">c2</span> <span class="keyword1">≈w</span> If <span class="free">tst</span> <span class="free">d1</span> <span class="free">d2</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms thetaIfW_Wbis <span class="keyword1"><span class="command">unfolding</span></span> thetaIfW_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹While loop:›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Again, w-bisimilarity does not interact with / preserve the While construct in 
any interesting way.›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Parallel composition:›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">thetaParWL1</span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">thetaParWL1</span> <span class="main">≡</span> 
 <span class="main">{</span><span class="main">(</span>Par <span class="bound">c1</span> <span class="bound">c2</span><span class="main">,</span> <span class="bound">d</span><span class="main">)</span> <span class="main">|</span> <span class="bound">c1</span> <span class="bound">c2</span> <span class="bound">d</span><span class="main">.</span> <span class="bound">c1</span> <span class="keyword1">≈w</span> <span class="bound">d</span> <span class="main">∧</span> discr <span class="bound">c2</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Compositionality-thetaParWL1_Wretr"><span class="command">lemma</span></span> thetaParWL1_Wretr<span class="main">:</span>
<span class="quoted"><span class="quoted">"thetaParWL1 <span class="main">⊆</span> Wretr <span class="main">(</span>thetaParWL1 <span class="main">∪</span> Wbis<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c1</span> <span class="skolem">c2</span> <span class="skolem">d</span>
   <span class="keyword3"><span class="command">assume</span></span> c1d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span> <span class="keyword1">≈w</span> <span class="skolem">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c2<span class="main">:</span> <span class="quoted"><span class="quoted">"discr <span class="skolem">c2</span>"</span></span>
   <span class="keyword1"><span class="command">hence</span></span> matchC_M<span class="main">:</span> <span class="quoted"><span class="quoted">"matchC_M Wbis <span class="skolem">c1</span> <span class="skolem">d</span>"</span></span> 
     <span class="keyword2"><span class="keyword">and</span></span> matchT_M<span class="main">:</span> <span class="quoted"><span class="quoted">"matchT_M <span class="skolem">c1</span> <span class="skolem">d</span>"</span></span> 
   <span class="keyword1"><span class="command">using</span></span> Wbis_matchC_M Wbis_matchT_M <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Par <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">,</span> <span class="skolem">d</span><span class="main">)</span> <span class="main">∈</span> Wretr <span class="main">(</span>thetaParWL1 <span class="main">∪</span> Wbis<span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">unfolding</span></span> Wretr_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"matchC_M <span class="main">(</span>thetaParWL1 <span class="main">∪</span> Wbis<span class="main">)</span> <span class="main">(</span>Par <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">)</span> <span class="skolem">d</span>"</span></span>
     <span class="keyword1"><span class="command">unfolding</span></span> matchC_M_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="entity">mauto_no_simp_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span>
       <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">c'</span> <span class="skolem">s'</span>
       <span class="keyword3"><span class="command">assume</span></span> st<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≈</span> <span class="skolem">t</span>"</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Par <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
       <span class="keyword3"><span class="command">thus</span></span>
       <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="bound">d'</span><span class="main">)</span> <span class="main">∈</span> thetaParWL1 <span class="main">∪</span> Wbis<span class="main">)</span> <span class="main">∨</span>
        <span class="main">(</span><span class="main">∃</span><span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> discr <span class="skolem">c'</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">erule</span> Par_transC_invert<span class="main">)</span>
         <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c1'</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c1'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">=</span> Par <span class="skolem">c1'</span> <span class="skolem">c2</span>"</span></span>
         <span class="keyword1"><span class="command">hence</span></span> 
         <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">c1'</span> <span class="keyword1">≈w</span> <span class="bound">d'</span><span class="main">)</span> <span class="main">∨</span> 
          <span class="main">(</span><span class="main">∃</span><span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> discr <span class="skolem">c1'</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> st matchC_M <span class="keyword1"><span class="command">unfolding</span></span> matchC_M_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
         <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> thetaParWL1_def
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> disjE exE conjE<span class="main">)</span> 
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> c2 c'<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> c' c2 discr_Par<span class="main">)</span> 
       <span class="keyword1"><span class="command">next</span></span>
         <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="skolem">s'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">=</span> <span class="skolem">c2</span>"</span></span>
         <span class="keyword1"><span class="command">hence</span></span> 
         <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> discr <span class="bound">d'</span><span class="main">)</span> <span class="main">∨</span> 
          <span class="main">(</span><span class="main">∃</span><span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> st matchT_M <span class="keyword1"><span class="command">unfolding</span></span> matchT_M_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
         <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> thetaParWL1_def
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> disjE exE conjE<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> c' c2 discr_Wbis<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> c' c2<span class="main">)</span>  
       <span class="keyword1"><span class="command">next</span></span>
         <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c2'</span> <span class="keyword3"><span class="command">assume</span></span> c2s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c2'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">=</span> Par <span class="skolem">c1</span> <span class="skolem">c2'</span>"</span></span>
         <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≈</span> <span class="skolem">s'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c2 discr_transC_indis <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
         <span class="keyword1"><span class="command">hence</span></span> s't<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">≈</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> st indis_sym indis_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
         <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"discr <span class="skolem">c2'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c2 c2s discr_transC <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
         <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> s't c1d <span class="keyword1"><span class="command">unfolding</span></span> thetaParWL1_def c' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
       <span class="keyword1"><span class="command">next</span></span>
         <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="skolem">s'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">=</span> <span class="skolem">c1</span>"</span></span>
         <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≈</span> <span class="skolem">s'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c2 discr_transT <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
         <span class="keyword1"><span class="command">hence</span></span> s't<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">≈</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> st indis_sym indis_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
         <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> c1d <span class="keyword1"><span class="command">unfolding</span></span> thetaParWL1_def c' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
       <span class="keyword1"><span class="command">qed</span></span>
     <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">unfold</span> matchT_M_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> thetaParWL1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Compositionality-thetaParWL1_converse_Wretr"><span class="command">lemma</span></span> thetaParWL1_converse_Wretr<span class="main">:</span>
<span class="quoted"><span class="quoted">"thetaParWL1 <span class="main">^-1</span> <span class="main">⊆</span> Wretr <span class="main">(</span>thetaParWL1 <span class="main">^-1</span> <span class="main">∪</span> Wbis<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c1</span> <span class="skolem">c2</span> <span class="skolem">d</span>
   <span class="keyword3"><span class="command">assume</span></span> c1d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span> <span class="keyword1">≈w</span> <span class="skolem">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c2<span class="main">:</span> <span class="quoted"><span class="quoted">"discr <span class="skolem">c2</span>"</span></span>
   <span class="keyword1"><span class="command">hence</span></span> matchC_M<span class="main">:</span> <span class="quoted"><span class="quoted">"matchC_M Wbis <span class="skolem">d</span> <span class="skolem">c1</span>"</span></span> 
     <span class="keyword2"><span class="keyword">and</span></span> matchT_M<span class="main">:</span> <span class="quoted"><span class="quoted">"matchT_M <span class="skolem">d</span> <span class="skolem">c1</span>"</span></span> 
   <span class="keyword1"><span class="command">using</span></span> Wbis_matchC_M_rev Wbis_matchT_M_rev <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">d</span><span class="main">,</span> Par <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">)</span> <span class="main">∈</span> Wretr <span class="main">(</span>thetaParWL1<span class="main">¯</span> <span class="main">∪</span> Wbis<span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">unfolding</span></span> Wretr_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"matchC_M <span class="main">(</span>thetaParWL1<span class="main">¯</span> <span class="main">∪</span> Wbis<span class="main">)</span> <span class="skolem">d</span> <span class="main">(</span>Par <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">unfolding</span></span> matchC_M_def2 Wbis_converse <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="entity">mauto_no_simp_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span> 
       <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">d'</span> <span class="skolem">t'</span>
       <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≈</span> <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">d</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">d'</span><span class="main">,</span> <span class="skolem">t'</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">hence</span></span> 
       <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">c'</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">c1</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="skolem">t'</span> <span class="main">∧</span> <span class="skolem">d'</span> <span class="keyword1">≈w</span> <span class="bound">c'</span><span class="main">)</span> <span class="main">∨</span> 
        <span class="main">(</span><span class="main">∃</span><span class="bound">s'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">c1</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="bound">s'</span> <span class="main">∧</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="skolem">t'</span> <span class="main">∧</span> discr <span class="skolem">d'</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> matchC_M <span class="keyword1"><span class="command">unfolding</span></span> matchC_M_def2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
       <span class="keyword3"><span class="command">thus</span></span>
       <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">c'</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">(</span>Par <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="skolem">t'</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span> <span class="skolem">d'</span><span class="main">)</span> <span class="main">∈</span> thetaParWL1 <span class="main">∪</span> Wbis<span class="main">)</span> <span class="main">∨</span>
        <span class="main">(</span><span class="main">∃</span><span class="bound">s'</span><span class="main">.</span> <span class="main">(</span>Par <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="bound">s'</span> <span class="main">∧</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="skolem">t'</span> <span class="main">∧</span> discr <span class="skolem">d'</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">unfolding</span></span> thetaParWL1_def 
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="entity">mauto_no_simp_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> PL.ParCL_MtransC Wbis_Sym c2<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> PL.ParTL_MtransC c2 discr_Wbis<span class="main">)</span>
     <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">next</span></span>
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"matchT_M <span class="skolem">d</span> <span class="main">(</span>Par <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">unfolding</span></span> matchT_M_def2 Wbis_converse <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="entity">mauto_no_simp_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span> 
       <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">t'</span>
       <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≈</span> <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">d</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="skolem">t'</span>"</span></span>
       <span class="keyword1"><span class="command">hence</span></span> 
       <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">c'</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">c1</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="skolem">t'</span> <span class="main">∧</span> discr <span class="bound">c'</span><span class="main">)</span> <span class="main">∨</span> 
        <span class="main">(</span><span class="main">∃</span><span class="bound">s'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">c1</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="bound">s'</span> <span class="main">∧</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="skolem">t'</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> matchT_M <span class="keyword1"><span class="command">unfolding</span></span> matchT_M_def2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
       <span class="keyword3"><span class="command">thus</span></span>
       <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">c'</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">(</span>Par <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="skolem">t'</span> <span class="main">∧</span> discr <span class="bound">c'</span><span class="main">)</span> <span class="main">∨</span> 
        <span class="main">(</span><span class="main">∃</span><span class="bound">s'</span><span class="main">.</span> <span class="main">(</span>Par <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="bound">s'</span> <span class="main">∧</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="skolem">t'</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="entity">mauto_no_simp_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> PL.ParCL_MtransC c2 discr_Par<span class="main">)</span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> PL.ParTL_MtransC c2<span class="main">)</span>  
     <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> thetaParWL1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Compositionality-thetaParWL1_Wbis"><span class="command">lemma</span></span> thetaParWL1_Wbis<span class="main">:</span>
<span class="quoted"><span class="quoted">"thetaParWL1 <span class="main">⊆</span> Wbis"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Wbis_coind2<span class="main">)</span>
<span class="keyword1"><span class="command">using</span></span> thetaParWL1_Wretr thetaParWL1_converse_Wretr <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> Par_Wbis_discrL1<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c1</span> <span class="keyword1">≈w</span> <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"discr <span class="free">c2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Par <span class="free">c1</span> <span class="free">c2</span> <span class="keyword1">≈w</span> <span class="free">d</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms thetaParWL1_Wbis <span class="keyword1"><span class="command">unfolding</span></span> thetaParWL1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">theorem</span></span> Par_Wbis_discrR1<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="keyword1">≈w</span> <span class="free">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"discr <span class="free">d2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="keyword1">≈w</span> Par <span class="free">d1</span> <span class="free">d2</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms Par_Wbis_discrL1 Wbis_Sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="comment1">(*  *)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">thetaParWL2</span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">thetaParWL2</span> <span class="main">≡</span> 
 <span class="main">{</span><span class="main">(</span>Par <span class="bound">c1</span> <span class="bound">c2</span><span class="main">,</span> <span class="bound">d</span><span class="main">)</span> <span class="main">|</span> <span class="bound">c1</span> <span class="bound">c2</span> <span class="bound">d</span><span class="main">.</span> discr <span class="bound">c1</span> <span class="main">∧</span> <span class="bound">c2</span> <span class="keyword1">≈w</span> <span class="bound">d</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Compositionality-thetaParWL2_Wretr"><span class="command">lemma</span></span> thetaParWL2_Wretr<span class="main">:</span>
<span class="quoted"><span class="quoted">"thetaParWL2 <span class="main">⊆</span> Wretr <span class="main">(</span>thetaParWL2 <span class="main">∪</span> Wbis<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c1</span> <span class="skolem">c2</span> <span class="skolem">d</span>
   <span class="keyword3"><span class="command">assume</span></span> c2d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c2</span> <span class="keyword1">≈w</span> <span class="skolem">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c1<span class="main">:</span> <span class="quoted"><span class="quoted">"discr <span class="skolem">c1</span>"</span></span> 
   <span class="keyword1"><span class="command">hence</span></span> matchC_M<span class="main">:</span> <span class="quoted"><span class="quoted">"matchC_M Wbis <span class="skolem">c2</span> <span class="skolem">d</span>"</span></span> 
     <span class="keyword2"><span class="keyword">and</span></span> matchT_M<span class="main">:</span> <span class="quoted"><span class="quoted">"matchT_M <span class="skolem">c2</span> <span class="skolem">d</span>"</span></span> 
   <span class="keyword1"><span class="command">using</span></span> Wbis_matchC_M Wbis_matchT_M <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Par <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">,</span> <span class="skolem">d</span><span class="main">)</span> <span class="main">∈</span> Wretr <span class="main">(</span>thetaParWL2 <span class="main">∪</span> Wbis<span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">unfolding</span></span> Wretr_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"matchC_M <span class="main">(</span>thetaParWL2 <span class="main">∪</span> Wbis<span class="main">)</span> <span class="main">(</span>Par <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">)</span> <span class="skolem">d</span>"</span></span>
     <span class="keyword1"><span class="command">unfolding</span></span> matchC_M_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="entity">mauto_no_simp_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span>
       <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">c'</span> <span class="skolem">s'</span>
       <span class="keyword3"><span class="command">assume</span></span> st<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≈</span> <span class="skolem">t</span>"</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Par <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
       <span class="keyword3"><span class="command">thus</span></span>
       <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="bound">d'</span><span class="main">)</span> <span class="main">∈</span> thetaParWL2 <span class="main">∪</span> Wbis<span class="main">)</span> <span class="main">∨</span>
        <span class="main">(</span><span class="main">∃</span><span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> discr <span class="skolem">c'</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">erule</span> Par_transC_invert<span class="main">)</span>
         <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c1'</span> <span class="keyword3"><span class="command">assume</span></span> c1s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c1'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">=</span> Par <span class="skolem">c1'</span> <span class="skolem">c2</span>"</span></span>
         <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≈</span> <span class="skolem">s'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c1 discr_transC_indis <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
         <span class="keyword1"><span class="command">hence</span></span> s't<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">≈</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> st indis_sym indis_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
         <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"discr <span class="skolem">c1'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c1 c1s discr_transC <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
         <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> s't c2d <span class="keyword1"><span class="command">unfolding</span></span> thetaParWL2_def c' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
       <span class="keyword1"><span class="command">next</span></span>
         <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="skolem">s'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">=</span> <span class="skolem">c2</span>"</span></span>
         <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≈</span> <span class="skolem">s'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c1 discr_transT <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
         <span class="keyword1"><span class="command">hence</span></span> s't<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">≈</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> st indis_sym indis_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
         <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> c2d <span class="keyword1"><span class="command">unfolding</span></span> thetaParWL2_def c' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
       <span class="keyword1"><span class="command">next</span></span>
         <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c2'</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c2'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">=</span> Par <span class="skolem">c1</span> <span class="skolem">c2'</span>"</span></span>
         <span class="keyword1"><span class="command">hence</span></span> 
         <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">c2'</span> <span class="keyword1">≈w</span> <span class="bound">d'</span><span class="main">)</span> <span class="main">∨</span> 
          <span class="main">(</span><span class="main">∃</span><span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> discr <span class="skolem">c2'</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> st matchC_M <span class="keyword1"><span class="command">unfolding</span></span> matchC_M_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
         <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> thetaParWL2_def
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> disjE exE conjE<span class="main">)</span> 
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> c1 c'<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> c' c1 discr_Par<span class="main">)</span> 
       <span class="keyword1"><span class="command">next</span></span>
         <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="skolem">s'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">=</span> <span class="skolem">c1</span>"</span></span>
         <span class="keyword1"><span class="command">hence</span></span> 
         <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> discr <span class="bound">d'</span><span class="main">)</span> <span class="main">∨</span> 
          <span class="main">(</span><span class="main">∃</span><span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> st matchT_M <span class="keyword1"><span class="command">unfolding</span></span> matchT_M_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
         <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> thetaParWL2_def
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> disjE exE conjE<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> c' c1 discr_Wbis<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> c' c1<span class="main">)</span>          
       <span class="keyword1"><span class="command">qed</span></span>
     <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">unfold</span> matchT_M_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> thetaParWL2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Compositionality-thetaParWL2_converse_Wretr"><span class="command">lemma</span></span> thetaParWL2_converse_Wretr<span class="main">:</span>
<span class="quoted"><span class="quoted">"thetaParWL2 <span class="main">^-1</span> <span class="main">⊆</span> Wretr <span class="main">(</span>thetaParWL2 <span class="main">^-1</span> <span class="main">∪</span> Wbis<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c1</span> <span class="skolem">c2</span> <span class="skolem">d</span>
   <span class="keyword3"><span class="command">assume</span></span> c2d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c2</span> <span class="keyword1">≈w</span> <span class="skolem">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c1<span class="main">:</span> <span class="quoted"><span class="quoted">"discr <span class="skolem">c1</span>"</span></span>
   <span class="keyword1"><span class="command">hence</span></span> matchC_M<span class="main">:</span> <span class="quoted"><span class="quoted">"matchC_M Wbis <span class="skolem">d</span> <span class="skolem">c2</span>"</span></span> 
     <span class="keyword2"><span class="keyword">and</span></span> matchT_M<span class="main">:</span> <span class="quoted"><span class="quoted">"matchT_M <span class="skolem">d</span> <span class="skolem">c2</span>"</span></span> 
   <span class="keyword1"><span class="command">using</span></span> Wbis_matchC_M_rev Wbis_matchT_M_rev <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">d</span><span class="main">,</span> Par <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">)</span> <span class="main">∈</span> Wretr <span class="main">(</span>thetaParWL2<span class="main">¯</span> <span class="main">∪</span> Wbis<span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">unfolding</span></span> Wretr_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"matchC_M <span class="main">(</span>thetaParWL2<span class="main">¯</span> <span class="main">∪</span> Wbis<span class="main">)</span> <span class="skolem">d</span> <span class="main">(</span>Par <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">unfolding</span></span> matchC_M_def2 Wbis_converse <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="entity">mauto_no_simp_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span> 
       <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">d'</span> <span class="skolem">t'</span>
       <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≈</span> <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">d</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">d'</span><span class="main">,</span> <span class="skolem">t'</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">hence</span></span> 
       <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">c'</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="skolem">t'</span> <span class="main">∧</span> <span class="skolem">d'</span> <span class="keyword1">≈w</span> <span class="bound">c'</span><span class="main">)</span> <span class="main">∨</span> 
        <span class="main">(</span><span class="main">∃</span><span class="bound">s'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="bound">s'</span> <span class="main">∧</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="skolem">t'</span> <span class="main">∧</span> discr <span class="skolem">d'</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> matchC_M <span class="keyword1"><span class="command">unfolding</span></span> matchC_M_def2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
       <span class="keyword3"><span class="command">thus</span></span>
       <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">c'</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">(</span>Par <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="skolem">t'</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span> <span class="skolem">d'</span><span class="main">)</span> <span class="main">∈</span> thetaParWL2 <span class="main">∪</span> Wbis<span class="main">)</span> <span class="main">∨</span>
        <span class="main">(</span><span class="main">∃</span><span class="bound">s'</span><span class="main">.</span> <span class="main">(</span>Par <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="bound">s'</span> <span class="main">∧</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="skolem">t'</span> <span class="main">∧</span> discr <span class="skolem">d'</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">unfolding</span></span> thetaParWL2_def 
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="entity">mauto_no_simp_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> PL.ParCR_MtransC Wbis_Sym c1<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> PL.ParTR_MtransC c1 discr_Wbis<span class="main">)</span> 
     <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">next</span></span>
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"matchT_M <span class="skolem">d</span> <span class="main">(</span>Par <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">unfolding</span></span> matchT_M_def2 Wbis_converse <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="entity">mauto_no_simp_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span> 
       <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">t'</span>
       <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≈</span> <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">d</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="skolem">t'</span>"</span></span>
       <span class="keyword1"><span class="command">hence</span></span> 
       <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">c'</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="skolem">t'</span> <span class="main">∧</span> discr <span class="bound">c'</span><span class="main">)</span> <span class="main">∨</span> 
        <span class="main">(</span><span class="main">∃</span><span class="bound">s'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="bound">s'</span> <span class="main">∧</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="skolem">t'</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> matchT_M <span class="keyword1"><span class="command">unfolding</span></span> matchT_M_def2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
       <span class="keyword3"><span class="command">thus</span></span>
       <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">c'</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">(</span>Par <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="skolem">t'</span> <span class="main">∧</span> discr <span class="bound">c'</span><span class="main">)</span> <span class="main">∨</span> 
        <span class="main">(</span><span class="main">∃</span><span class="bound">s'</span><span class="main">.</span> <span class="main">(</span>Par <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="bound">s'</span> <span class="main">∧</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="skolem">t'</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="entity">mauto_no_simp_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> PL.ParCR_MtransC c1 discr_Par<span class="main">)</span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> PL.ParTR_MtransC c1<span class="main">)</span>
     <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> thetaParWL2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Compositionality-thetaParWL2_Wbis"><span class="command">lemma</span></span> thetaParWL2_Wbis<span class="main">:</span>
<span class="quoted"><span class="quoted">"thetaParWL2 <span class="main">⊆</span> Wbis"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Wbis_coind2<span class="main">)</span>
<span class="keyword1"><span class="command">using</span></span> thetaParWL2_Wretr thetaParWL2_converse_Wretr <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> Par_Wbis_discrL2<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c2</span> <span class="keyword1">≈w</span> <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"discr <span class="free">c1</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Par <span class="free">c1</span> <span class="free">c2</span> <span class="keyword1">≈w</span> <span class="free">d</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms thetaParWL2_Wbis <span class="keyword1"><span class="command">unfolding</span></span> thetaParWL2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">theorem</span></span> Par_Wbis_discrR2<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="keyword1">≈w</span> <span class="free">d2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"discr <span class="free">d1</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="keyword1">≈w</span> Par <span class="free">d1</span> <span class="free">d2</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms Par_Wbis_discrL2 Wbis_Sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="comment1">(*  *)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">thetaParW</span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">thetaParW</span> <span class="main">≡</span> 
 <span class="main">{</span><span class="main">(</span>Par <span class="bound">c1</span> <span class="bound">c2</span><span class="main">,</span> Par <span class="bound">d1</span> <span class="bound">d2</span><span class="main">)</span> <span class="main">|</span> <span class="bound">c1</span> <span class="bound">c2</span> <span class="bound">d1</span> <span class="bound">d2</span><span class="main">.</span> <span class="bound">c1</span> <span class="keyword1">≈w</span> <span class="bound">d1</span> <span class="main">∧</span> <span class="bound">c2</span> <span class="keyword1">≈w</span> <span class="bound">d2</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Compositionality-thetaParW_sym"><span class="command">lemma</span></span> thetaParW_sym<span class="main">:</span>
<span class="quoted"><span class="quoted">"sym thetaParW"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> thetaParW_def sym_def <span class="keyword1"><span class="command">using</span></span> Wbis_Sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Compositionality-thetaParW_Wretr"><span class="command">lemma</span></span> thetaParW_Wretr<span class="main">:</span>
<span class="quoted"><span class="quoted">"thetaParW <span class="main">⊆</span> Wretr <span class="main">(</span>thetaParW <span class="main">∪</span> Wbis<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c1</span> <span class="skolem">c2</span> <span class="skolem">d1</span> <span class="skolem">d2</span>
   <span class="keyword3"><span class="command">assume</span></span> c1d1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span> <span class="keyword1">≈w</span> <span class="skolem">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c2d2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c2</span> <span class="keyword1">≈w</span> <span class="skolem">d2</span>"</span></span>
   <span class="keyword1"><span class="command">hence</span></span> matchC_M1<span class="main">:</span> <span class="quoted"><span class="quoted">"matchC_M Wbis <span class="skolem">c1</span> <span class="skolem">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> matchC_M2<span class="main">:</span> <span class="quoted"><span class="quoted">"matchC_M Wbis <span class="skolem">c2</span> <span class="skolem">d2</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> matchT_M1<span class="main">:</span> <span class="quoted"><span class="quoted">"matchT_M <span class="skolem">c1</span> <span class="skolem">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> matchT_M2<span class="main">:</span> <span class="quoted"><span class="quoted">"matchT_M <span class="skolem">c2</span> <span class="skolem">d2</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> Wbis_matchC_M Wbis_matchT_M <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Par <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">,</span> Par <span class="skolem">d1</span> <span class="skolem">d2</span><span class="main">)</span> <span class="main">∈</span> Wretr <span class="main">(</span>thetaParW <span class="main">∪</span> Wbis<span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">unfolding</span></span> Wretr_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"matchC_M <span class="main">(</span>thetaParW <span class="main">∪</span> Wbis<span class="main">)</span> <span class="main">(</span>Par <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">)</span> <span class="main">(</span>Par <span class="skolem">d1</span> <span class="skolem">d2</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">unfolding</span></span> matchC_M_def <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="entity">mauto_no_simp_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span>
       <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">c'</span> <span class="skolem">s'</span>
       <span class="keyword3"><span class="command">assume</span></span> st<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≈</span> <span class="skolem">t</span>"</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Par <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
       <span class="keyword3"><span class="command">thus</span></span> 
       <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span>Par <span class="skolem">d1</span> <span class="skolem">d2</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="bound">d'</span><span class="main">)</span> <span class="main">∈</span> thetaParW <span class="main">∪</span> Wbis<span class="main">)</span> <span class="main">∨</span> 
        <span class="main">(</span><span class="main">∃</span><span class="bound">t'</span><span class="main">.</span> <span class="main">(</span>Par <span class="skolem">d1</span> <span class="skolem">d2</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> discr <span class="skolem">c'</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">erule</span> Par_transC_invert<span class="main">)</span>
         <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c1'</span> <span class="keyword3"><span class="command">assume</span></span> c1s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c1'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">=</span> Par <span class="skolem">c1'</span> <span class="skolem">c2</span>"</span></span>
         <span class="keyword1"><span class="command">hence</span></span>
         <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d1</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">c1'</span> <span class="keyword1">≈w</span> <span class="bound">d'</span><span class="main">)</span> <span class="main">∨</span> 
          <span class="main">(</span><span class="main">∃</span><span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d1</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> discr <span class="skolem">c1'</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> st matchC_M1 <span class="keyword1"><span class="command">unfolding</span></span> matchC_M_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
         <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> c' thetaParW_def
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="entity">mauto_no_simp_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> PL.ParCL_MtransC c2d2<span class="main">)</span> 
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> PL.ParTL_MtransC Par_Wbis_discrL2 c2d2<span class="main">)</span>
       <span class="keyword1"><span class="command">next</span></span>      
         <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="skolem">s'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">=</span> <span class="skolem">c2</span>"</span></span>
         <span class="keyword1"><span class="command">hence</span></span> 
         <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d1</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> discr <span class="bound">d'</span><span class="main">)</span> <span class="main">∨</span> 
          <span class="main">(</span><span class="main">∃</span><span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d1</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> st matchT_M1 <span class="keyword1"><span class="command">unfolding</span></span> matchT_M_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
         <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
         <span class="keyword1"><span class="command">unfolding</span></span> c' thetaParW_def
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="entity">mauto_no_simp_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> PL.ParCL_MtransC Par_Wbis_discrR2 c2d2<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> PL.ParTL_MtransC c2d2<span class="main">)</span> 
       <span class="keyword1"><span class="command">next</span></span>
         <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c2'</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c2'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">=</span> Par <span class="skolem">c1</span> <span class="skolem">c2'</span>"</span></span>
         <span class="keyword1"><span class="command">hence</span></span> 
         <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d2</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">c2'</span> <span class="keyword1">≈w</span> <span class="bound">d'</span><span class="main">)</span> <span class="main">∨</span> 
          <span class="main">(</span><span class="main">∃</span><span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d2</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> discr <span class="skolem">c2'</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> st matchC_M2 <span class="keyword1"><span class="command">unfolding</span></span> matchC_M_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
         <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
         <span class="keyword1"><span class="command">unfolding</span></span> c' thetaParW_def
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="entity">mauto_no_simp_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> PL.ParCR_MtransC c1d1<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> PL.ParTR_MtransC Par_Wbis_discrL1 c1d1<span class="main">)</span> 
       <span class="keyword1"><span class="command">next</span></span>
         <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="skolem">s'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">=</span> <span class="skolem">c1</span>"</span></span>
         <span class="keyword1"><span class="command">hence</span></span> 
         <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d2</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> discr <span class="bound">d'</span><span class="main">)</span> <span class="main">∨</span> 
          <span class="main">(</span><span class="main">∃</span><span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">d2</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> st matchT_M2 <span class="keyword1"><span class="command">unfolding</span></span> matchT_M_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
         <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
         <span class="keyword1"><span class="command">unfolding</span></span> c' thetaParW_def
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">tactic</span> <span class="quoted">‹<span class="entity">mauto_no_simp_tac</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>›</span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> PL.ParCR_MtransC Par_Wbis_discrR1 c1d1<span class="main">)</span> 
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> PL.ParTR_MtransC c1d1<span class="main">)</span>
       <span class="keyword1"><span class="command">qed</span></span>
     <span class="keyword1"><span class="command">qed</span></span> 
   <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">unfold</span> matchT_M_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> thetaParW_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Compositionality-thetaParW_Wbis"><span class="command">lemma</span></span> thetaParW_Wbis<span class="main">:</span>
<span class="quoted"><span class="quoted">"thetaParW <span class="main">⊆</span> Wbis"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Wbis_coind<span class="main">)</span>
<span class="keyword1"><span class="command">using</span></span> thetaParW_sym thetaParW_Wretr <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> Par_Wbis<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c1</span> <span class="keyword1">≈w</span> <span class="free">d1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">c2</span> <span class="keyword1">≈w</span> <span class="free">d2</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Par <span class="free">c1</span> <span class="free">c2</span> <span class="keyword1">≈w</span> Par <span class="free">d1</span> <span class="free">d2</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms thetaParW_Wbis <span class="keyword1"><span class="command">unfolding</span></span> thetaParW_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* context PL_Indis *)</span>
<span class="comment1">(*******************************************)</span>


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Syntactic_Criteria">
<div class="head">
<h1>Theory Syntactic_Criteria</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Syntactic_Criteria
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="#Compositionality">Compositionality</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">context</span></span> PL_Indis
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(* Table: Compositionality of during-execution noninterferences *)</span>

<span class="keyword1" id="Syntactic_Criteria-noWhile"><span class="command">lemma</span></span> noWhile<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"noWhile <span class="main">(</span>Atm <span class="free">atm</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"noWhile <span class="free">c1</span> <span class="main">⟹</span> noWhile <span class="free">c2</span> <span class="main">⟹</span> noWhile <span class="main">(</span>Seq <span class="free">c1</span> <span class="free">c2</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"noWhile <span class="free">c1</span> <span class="main">⟹</span> noWhile <span class="free">c2</span> <span class="main">⟹</span> noWhile <span class="main">(</span>If <span class="free">tst</span> <span class="free">c1</span> <span class="free">c2</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"noWhile <span class="free">c1</span> <span class="main">⟹</span> noWhile <span class="free">c2</span> <span class="main">⟹</span> noWhile <span class="main">(</span>Par <span class="free">c1</span> <span class="free">c2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Syntactic_Criteria-discr"><span class="command">lemma</span></span> discr<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"presAtm <span class="free">atm</span> <span class="main">⟹</span> discr <span class="main">(</span>Atm <span class="free">atm</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"discr <span class="free">c1</span> <span class="main">⟹</span> discr <span class="free">c2</span> <span class="main">⟹</span> discr <span class="main">(</span>Seq <span class="free">c1</span> <span class="free">c2</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"discr <span class="free">c1</span> <span class="main">⟹</span> discr <span class="free">c2</span> <span class="main">⟹</span> discr <span class="main">(</span>If <span class="free">tst</span> <span class="free">c1</span> <span class="free">c2</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"discr <span class="free">c</span> <span class="main">⟹</span> discr <span class="main">(</span>While <span class="free">tst</span> <span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"discr <span class="free">c1</span> <span class="main">⟹</span> discr <span class="free">c2</span> <span class="main">⟹</span> discr <span class="main">(</span>Par <span class="free">c1</span> <span class="free">c2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Syntactic_Criteria-siso"><span class="command">lemma</span></span> siso<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"compatAtm <span class="free">atm</span> <span class="main">⟹</span> siso <span class="main">(</span>Atm <span class="free">atm</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"siso <span class="free">c1</span> <span class="main">⟹</span> siso <span class="free">c2</span> <span class="main">⟹</span> siso <span class="main">(</span>Seq <span class="free">c1</span> <span class="free">c2</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"compatTst <span class="free">tst</span> <span class="main">⟹</span> siso <span class="free">c1</span> <span class="main">⟹</span> siso <span class="free">c2</span> <span class="main">⟹</span> siso <span class="main">(</span>If <span class="free">tst</span> <span class="free">c1</span> <span class="free">c2</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"compatTst <span class="free">tst</span> <span class="main">⟹</span> siso <span class="free">c</span> <span class="main">⟹</span> siso <span class="main">(</span>While <span class="free">tst</span> <span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"siso <span class="free">c1</span> <span class="main">⟹</span> siso <span class="free">c2</span> <span class="main">⟹</span> siso <span class="main">(</span>Par <span class="free">c1</span> <span class="free">c2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Syntactic_Criteria-Sbis"><span class="command">lemma</span></span> Sbis<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"compatAtm <span class="free">atm</span> <span class="main">⟹</span> Atm <span class="free">atm</span> <span class="keyword1">≈s</span> Atm <span class="free">atm</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">c1</span> <span class="keyword1">≈s</span> <span class="free">c1</span> <span class="main">⟹</span> <span class="free">c2</span> <span class="keyword1">≈s</span> <span class="free">c2</span> <span class="main">⟹</span> Seq <span class="free">c1</span> <span class="free">c2</span> <span class="keyword1">≈s</span> Seq <span class="free">c1</span> <span class="free">c2</span>"</span></span>
  <span class="quoted"><span class="quoted">"compatTst <span class="free">tst</span> <span class="main">⟹</span> <span class="free">c1</span> <span class="keyword1">≈s</span> <span class="free">c1</span> <span class="main">⟹</span> <span class="free">c2</span> <span class="keyword1">≈s</span> <span class="free">c2</span> <span class="main">⟹</span> If <span class="free">tst</span> <span class="free">c1</span> <span class="free">c2</span> <span class="keyword1">≈s</span> If <span class="free">tst</span> <span class="free">c1</span> <span class="free">c2</span>"</span></span>
  <span class="quoted"><span class="quoted">"compatTst <span class="free">tst</span> <span class="main">⟹</span> <span class="free">c</span> <span class="keyword1">≈s</span> <span class="free">c</span> <span class="main">⟹</span> While <span class="free">tst</span> <span class="free">c</span> <span class="keyword1">≈s</span> While <span class="free">tst</span> <span class="free">c</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">c1</span> <span class="keyword1">≈s</span> <span class="free">c1</span> <span class="main">⟹</span> <span class="free">c2</span> <span class="keyword1">≈s</span> <span class="free">c2</span> <span class="main">⟹</span> Par <span class="free">c1</span> <span class="free">c2</span> <span class="keyword1">≈s</span> Par <span class="free">c1</span> <span class="free">c2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Syntactic_Criteria-ZObisT"><span class="command">lemma</span></span> ZObisT<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"compatAtm <span class="free">atm</span> <span class="main">⟹</span> Atm <span class="free">atm</span> <span class="keyword1">≈01T</span> Atm <span class="free">atm</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">c1</span> <span class="keyword1">≈01T</span> <span class="free">c1</span> <span class="main">⟹</span> <span class="free">c2</span> <span class="keyword1">≈01T</span> <span class="free">c2</span> <span class="main">⟹</span> Seq <span class="free">c1</span> <span class="free">c2</span> <span class="keyword1">≈01T</span> Seq <span class="free">c1</span> <span class="free">c2</span>"</span></span>
  <span class="quoted"><span class="quoted">"compatTst <span class="free">tst</span> <span class="main">⟹</span> <span class="free">c1</span> <span class="keyword1">≈01T</span> <span class="free">c1</span> <span class="main">⟹</span> <span class="free">c2</span> <span class="keyword1">≈01T</span> <span class="free">c2</span> <span class="main">⟹</span> If <span class="free">tst</span> <span class="free">c1</span> <span class="free">c2</span> <span class="keyword1">≈01T</span> If <span class="free">tst</span> <span class="free">c1</span> <span class="free">c2</span>"</span></span>
  <span class="quoted"><span class="quoted">"compatTst <span class="free">tst</span> <span class="main">⟹</span> <span class="free">c</span> <span class="keyword1">≈01T</span> <span class="free">c</span> <span class="main">⟹</span> While <span class="free">tst</span> <span class="free">c</span> <span class="keyword1">≈01T</span> While <span class="free">tst</span> <span class="free">c</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">c1</span> <span class="keyword1">≈01T</span> <span class="free">c1</span> <span class="main">⟹</span> <span class="free">c2</span> <span class="keyword1">≈01T</span> <span class="free">c2</span> <span class="main">⟹</span> Par <span class="free">c1</span> <span class="free">c2</span> <span class="keyword1">≈01T</span> Par <span class="free">c1</span> <span class="free">c2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Syntactic_Criteria-BisT"><span class="command">lemma</span></span> BisT<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"compatAtm <span class="free">atm</span> <span class="main">⟹</span> Atm <span class="free">atm</span> <span class="keyword1">≈T</span> Atm <span class="free">atm</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">c1</span> <span class="keyword1">≈T</span> <span class="free">c1</span> <span class="main">⟹</span> <span class="free">c2</span> <span class="keyword1">≈T</span> <span class="free">c2</span> <span class="main">⟹</span> Seq <span class="free">c1</span> <span class="free">c2</span> <span class="keyword1">≈T</span> Seq <span class="free">c1</span> <span class="free">c2</span>"</span></span>
  <span class="quoted"><span class="quoted">"compatTst <span class="free">tst</span> <span class="main">⟹</span> <span class="free">c1</span> <span class="keyword1">≈T</span> <span class="free">c1</span> <span class="main">⟹</span> <span class="free">c2</span> <span class="keyword1">≈T</span> <span class="free">c2</span> <span class="main">⟹</span> If <span class="free">tst</span> <span class="free">c1</span> <span class="free">c2</span> <span class="keyword1">≈T</span> If <span class="free">tst</span> <span class="free">c1</span> <span class="free">c2</span>"</span></span>
  <span class="quoted"><span class="quoted">"compatTst <span class="free">tst</span> <span class="main">⟹</span> <span class="free">c</span> <span class="keyword1">≈T</span> <span class="free">c</span> <span class="main">⟹</span> While <span class="free">tst</span> <span class="free">c</span> <span class="keyword1">≈T</span> While <span class="free">tst</span> <span class="free">c</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">c1</span> <span class="keyword1">≈T</span> <span class="free">c1</span> <span class="main">⟹</span> <span class="free">c2</span> <span class="keyword1">≈T</span> <span class="free">c2</span> <span class="main">⟹</span> Par <span class="free">c1</span> <span class="free">c2</span> <span class="keyword1">≈T</span> Par <span class="free">c1</span> <span class="free">c2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Syntactic_Criteria-WbisT"><span class="command">lemma</span></span> WbisT<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"compatAtm <span class="free">atm</span> <span class="main">⟹</span> Atm <span class="free">atm</span> <span class="keyword1">≈wT</span> Atm <span class="free">atm</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">c1</span> <span class="keyword1">≈wT</span> <span class="free">c1</span> <span class="main">⟹</span> <span class="free">c2</span> <span class="keyword1">≈wT</span> <span class="free">c2</span> <span class="main">⟹</span> Seq <span class="free">c1</span> <span class="free">c2</span> <span class="keyword1">≈wT</span> Seq <span class="free">c1</span> <span class="free">c2</span>"</span></span>
  <span class="quoted"><span class="quoted">"compatTst <span class="free">tst</span> <span class="main">⟹</span> <span class="free">c1</span> <span class="keyword1">≈wT</span> <span class="free">c1</span> <span class="main">⟹</span> <span class="free">c2</span> <span class="keyword1">≈wT</span> <span class="free">c2</span> <span class="main">⟹</span> If <span class="free">tst</span> <span class="free">c1</span> <span class="free">c2</span> <span class="keyword1">≈wT</span> If <span class="free">tst</span> <span class="free">c1</span> <span class="free">c2</span>"</span></span>
  <span class="quoted"><span class="quoted">"compatTst <span class="free">tst</span> <span class="main">⟹</span> <span class="free">c</span> <span class="keyword1">≈wT</span> <span class="free">c</span> <span class="main">⟹</span> While <span class="free">tst</span> <span class="free">c</span> <span class="keyword1">≈wT</span> While <span class="free">tst</span> <span class="free">c</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">c1</span> <span class="keyword1">≈wT</span> <span class="free">c1</span> <span class="main">⟹</span> <span class="free">c2</span> <span class="keyword1">≈wT</span> <span class="free">c2</span> <span class="main">⟹</span> Par <span class="free">c1</span> <span class="free">c2</span> <span class="keyword1">≈wT</span> Par <span class="free">c1</span> <span class="free">c2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Syntactic_Criteria-ZObis"><span class="command">lemma</span></span> ZObis<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"compatAtm <span class="free">atm</span> <span class="main">⟹</span> Atm <span class="free">atm</span> <span class="main">≈01</span> Atm <span class="free">atm</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">c1</span> <span class="keyword1">≈01T</span> <span class="free">c1</span> <span class="main">⟹</span> <span class="free">c2</span> <span class="main">≈01</span> <span class="free">c2</span> <span class="main">⟹</span> Seq <span class="free">c1</span> <span class="free">c2</span> <span class="main">≈01</span> Seq <span class="free">c1</span> <span class="free">c2</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">c1</span> <span class="main">≈01</span> <span class="free">c1</span> <span class="main">⟹</span> discr <span class="free">c2</span> <span class="main">⟹</span> Seq <span class="free">c1</span> <span class="free">c2</span> <span class="main">≈01</span> Seq <span class="free">c1</span> <span class="free">c2</span>"</span></span>
  <span class="quoted"><span class="quoted">"compatTst <span class="free">tst</span> <span class="main">⟹</span> <span class="free">c1</span> <span class="main">≈01</span> <span class="free">c1</span> <span class="main">⟹</span> <span class="free">c2</span> <span class="main">≈01</span> <span class="free">c2</span> <span class="main">⟹</span> If <span class="free">tst</span> <span class="free">c1</span> <span class="free">c2</span> <span class="main">≈01</span> If <span class="free">tst</span> <span class="free">c1</span> <span class="free">c2</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">c1</span> <span class="main">≈01</span> <span class="free">c1</span> <span class="main">⟹</span> <span class="free">c2</span> <span class="main">≈01</span> <span class="free">c2</span> <span class="main">⟹</span> Par <span class="free">c1</span> <span class="free">c2</span> <span class="main">≈01</span> Par <span class="free">c1</span> <span class="free">c2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Syntactic_Criteria-Wbis"><span class="command">lemma</span></span> Wbis<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"compatAtm <span class="free">atm</span> <span class="main">⟹</span> Atm <span class="free">atm</span> <span class="keyword1">≈w</span> Atm <span class="free">atm</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">c1</span> <span class="keyword1">≈wT</span> <span class="free">c1</span> <span class="main">⟹</span> <span class="free">c2</span> <span class="keyword1">≈w</span> <span class="free">c2</span> <span class="main">⟹</span> Seq <span class="free">c1</span> <span class="free">c2</span> <span class="keyword1">≈w</span> Seq <span class="free">c1</span> <span class="free">c2</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">c1</span> <span class="keyword1">≈w</span> <span class="free">c1</span> <span class="main">⟹</span> discr <span class="free">c2</span> <span class="main">⟹</span> Seq <span class="free">c1</span> <span class="free">c2</span> <span class="keyword1">≈w</span> Seq <span class="free">c1</span> <span class="free">c2</span>"</span></span>
  <span class="quoted"><span class="quoted">"compatTst <span class="free">tst</span> <span class="main">⟹</span> <span class="free">c1</span> <span class="keyword1">≈w</span> <span class="free">c1</span> <span class="main">⟹</span> <span class="free">c2</span> <span class="keyword1">≈w</span> <span class="free">c2</span> <span class="main">⟹</span> If <span class="free">tst</span> <span class="free">c1</span> <span class="free">c2</span> <span class="keyword1">≈w</span> If <span class="free">tst</span> <span class="free">c1</span> <span class="free">c2</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">c1</span> <span class="keyword1">≈w</span> <span class="free">c1</span> <span class="main">⟹</span> <span class="free">c2</span> <span class="keyword1">≈w</span> <span class="free">c2</span> <span class="main">⟹</span> Par <span class="free">c1</span> <span class="free">c2</span> <span class="keyword1">≈w</span> Par <span class="free">c1</span> <span class="free">c2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="comment1">(* Graph: The cleaned-up graph of implcations between security notions *)</span>


<span class="keyword1" id="Syntactic_Criteria-discr_noWhile_WbisT"><span class="command">lemma</span></span> discr_noWhile_WbisT<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"discr <span class="free">c</span> <span class="main">⟹</span> noWhile <span class="free">c</span> <span class="main">⟹</span> <span class="free">c</span> <span class="keyword1">≈wT</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Syntactic_Criteria-siso_ZObis"><span class="command">lemma</span></span> siso_ZObis<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"siso <span class="free">c</span> <span class="main">⟹</span> <span class="free">c</span> <span class="main">≈01</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Syntactic_Criteria-WbisT_Wbis"><span class="command">lemma</span></span> WbisT_Wbis<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="keyword1">≈wT</span> <span class="free">c</span> <span class="main">⟹</span> <span class="free">c</span> <span class="keyword1">≈w</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Syntactic_Criteria-ZObis_Wbis"><span class="command">lemma</span></span> ZObis_Wbis<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≈01</span> <span class="free">c</span> <span class="main">⟹</span> <span class="free">c</span> <span class="keyword1">≈w</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Syntactic_Criteria-discr_BisT"><span class="command">lemma</span></span> discr_BisT<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"discr <span class="free">c</span> <span class="main">⟹</span> <span class="free">c</span> <span class="keyword1">≈T</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Syntactic_Criteria-WbisT_BisT"><span class="command">lemma</span></span> WbisT_BisT<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="keyword1">≈wT</span> <span class="free">c</span> <span class="main">⟹</span> <span class="free">c</span> <span class="keyword1">≈T</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> bis_incl <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Syntactic_Criteria-ZObisT_ZObis"><span class="command">lemma</span></span> ZObisT_ZObis<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="keyword1">≈01T</span> <span class="free">c</span> <span class="main">⟹</span> <span class="free">c</span> <span class="main">≈01</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Syntactic_Criteria-siso_ZObisT"><span class="command">lemma</span></span> siso_ZObisT<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"siso <span class="free">c</span> <span class="main">⟹</span> <span class="free">c</span> <span class="keyword1">≈01T</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">SC_discr</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">SC_discr</span> <span class="main">(</span>Atm <span class="free"><span class="bound"><span class="entity">atm</span></span></span><span class="main">)</span>      <span class="main">⟷</span> presAtm <span class="free"><span class="bound"><span class="entity">atm</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">SC_discr</span> <span class="main">(</span>Seq <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span>    <span class="main">⟷</span> <span class="free">SC_discr</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="main">∧</span> <span class="free">SC_discr</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">SC_discr</span> <span class="main">(</span>If <span class="free"><span class="bound"><span class="entity">tst</span></span></span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span> <span class="main">⟷</span> <span class="free">SC_discr</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="main">∧</span> <span class="free">SC_discr</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">SC_discr</span> <span class="main">(</span>While <span class="free"><span class="bound"><span class="entity">tst</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span>  <span class="main">⟷</span> <span class="free">SC_discr</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">SC_discr</span> <span class="main">(</span>Par <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span>    <span class="main">⟷</span> <span class="free">SC_discr</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="main">∧</span> <span class="free">SC_discr</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span>"</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">SC_siso</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">SC_siso</span> <span class="main">(</span>Atm <span class="free"><span class="bound"><span class="entity">atm</span></span></span><span class="main">)</span>      <span class="main">⟷</span> compatAtm <span class="free"><span class="bound"><span class="entity">atm</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">SC_siso</span> <span class="main">(</span>Seq <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span>    <span class="main">⟷</span> <span class="free">SC_siso</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="main">∧</span> <span class="free">SC_siso</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">SC_siso</span> <span class="main">(</span>If <span class="free"><span class="bound"><span class="entity">tst</span></span></span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span> <span class="main">⟷</span> compatTst <span class="free"><span class="bound"><span class="entity">tst</span></span></span> <span class="main">∧</span> <span class="free">SC_siso</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="main">∧</span> <span class="free">SC_siso</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">SC_siso</span> <span class="main">(</span>While <span class="free"><span class="bound"><span class="entity">tst</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span>  <span class="main">⟷</span> compatTst <span class="free"><span class="bound"><span class="entity">tst</span></span></span> <span class="main">∧</span> <span class="free">SC_siso</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">SC_siso</span> <span class="main">(</span>Par <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span>    <span class="main">⟷</span> <span class="free">SC_siso</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="main">∧</span> <span class="free">SC_siso</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span>"</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">SC_WbisT</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">SC_WbisT</span> <span class="main">(</span>Atm <span class="free"><span class="bound"><span class="entity">atm</span></span></span><span class="main">)</span>      <span class="main">⟷</span> compatAtm <span class="free"><span class="bound"><span class="entity">atm</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">SC_WbisT</span> <span class="main">(</span>Seq <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span>    <span class="main">⟷</span> <span class="main">(</span><span class="free">SC_WbisT</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="main">∧</span> <span class="free">SC_WbisT</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span> <span class="main">∨</span>
                              <span class="main">(</span>noWhile <span class="main">(</span>Seq <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span> <span class="main">∧</span> SC_discr <span class="main">(</span>Seq <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> 
                              SC_siso <span class="main">(</span>Seq <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">SC_WbisT</span> <span class="main">(</span>If <span class="free"><span class="bound"><span class="entity">tst</span></span></span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="keyword1">if</span> compatTst <span class="free"><span class="bound"><span class="entity">tst</span></span></span>
                              <span class="keyword1">then</span> <span class="main">(</span><span class="free">SC_WbisT</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="main">∧</span> <span class="free">SC_WbisT</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span>
                              <span class="keyword1">else</span> <span class="main">(</span><span class="main">(</span>noWhile <span class="main">(</span>If <span class="free"><span class="bound"><span class="entity">tst</span></span></span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span> <span class="main">∧</span> SC_discr <span class="main">(</span>If <span class="free"><span class="bound"><span class="entity">tst</span></span></span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> 
                                    SC_siso <span class="main">(</span>If <span class="free"><span class="bound"><span class="entity">tst</span></span></span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">SC_WbisT</span> <span class="main">(</span>While <span class="free"><span class="bound"><span class="entity">tst</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span>  <span class="main">⟷</span> <span class="main">(</span><span class="keyword1">if</span> compatTst <span class="free"><span class="bound"><span class="entity">tst</span></span></span>
                              <span class="keyword1">then</span> <span class="free">SC_WbisT</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span>
                              <span class="keyword1">else</span> <span class="main">(</span><span class="main">(</span>noWhile <span class="main">(</span>While <span class="free"><span class="bound"><span class="entity">tst</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">∧</span> SC_discr <span class="main">(</span>While <span class="free"><span class="bound"><span class="entity">tst</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> 
                                    SC_siso <span class="main">(</span>While <span class="free"><span class="bound"><span class="entity">tst</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">SC_WbisT</span> <span class="main">(</span>Par <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span>    <span class="main">⟷</span> <span class="main">(</span><span class="free">SC_WbisT</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="main">∧</span> <span class="free">SC_WbisT</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span> <span class="main">∨</span>
                              <span class="main">(</span>noWhile <span class="main">(</span>Par <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span> <span class="main">∧</span> SC_discr <span class="main">(</span>Par <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> 
                              SC_siso <span class="main">(</span>Par <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">SC_ZObis</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">SC_ZObis</span> <span class="main">(</span>Atm <span class="free"><span class="bound"><span class="entity">atm</span></span></span><span class="main">)</span>      <span class="main">⟷</span> compatAtm <span class="free"><span class="bound"><span class="entity">atm</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">SC_ZObis</span> <span class="main">(</span>Seq <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span>    <span class="main">⟷</span> <span class="main">(</span>SC_siso <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="main">∧</span> <span class="free">SC_ZObis</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span> <span class="main">∨</span>
                              <span class="main">(</span><span class="free">SC_ZObis</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="main">∧</span> SC_discr <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span> <span class="main">∨</span>
                              SC_discr <span class="main">(</span>Seq <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span> <span class="main">∨</span> 
                              SC_siso <span class="main">(</span>Seq <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">SC_ZObis</span> <span class="main">(</span>If <span class="free"><span class="bound"><span class="entity">tst</span></span></span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="keyword1">if</span> compatTst <span class="free"><span class="bound"><span class="entity">tst</span></span></span>
                              <span class="keyword1">then</span> <span class="main">(</span><span class="free">SC_ZObis</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="main">∧</span> <span class="free">SC_ZObis</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span>
                              <span class="keyword1">else</span> <span class="main">(</span>SC_discr <span class="main">(</span>If <span class="free"><span class="bound"><span class="entity">tst</span></span></span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span> <span class="main">∨</span> 
                                    SC_siso <span class="main">(</span>If <span class="free"><span class="bound"><span class="entity">tst</span></span></span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">SC_ZObis</span> <span class="main">(</span>While <span class="free"><span class="bound"><span class="entity">tst</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span>  <span class="main">⟷</span> SC_discr <span class="main">(</span>While <span class="free"><span class="bound"><span class="entity">tst</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">∨</span> 
                              SC_siso <span class="main">(</span>While <span class="free"><span class="bound"><span class="entity">tst</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">SC_ZObis</span> <span class="main">(</span>Par <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span>    <span class="main">⟷</span> <span class="main">(</span><span class="free">SC_ZObis</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="main">∧</span> <span class="free">SC_ZObis</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span> <span class="main">∨</span>
                              SC_discr <span class="main">(</span>Par <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span> <span class="main">∨</span> 
                              SC_siso <span class="main">(</span>Par <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">SC_Wbis</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">SC_Wbis</span> <span class="main">(</span>Atm <span class="free"><span class="bound"><span class="entity">atm</span></span></span><span class="main">)</span>      <span class="main">⟷</span> compatAtm <span class="free"><span class="bound"><span class="entity">atm</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">SC_Wbis</span> <span class="main">(</span>Seq <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span>    <span class="main">⟷</span> <span class="main">(</span>SC_WbisT <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="main">∧</span> <span class="free">SC_Wbis</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span> <span class="main">∨</span>
                             <span class="main">(</span><span class="free">SC_Wbis</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="main">∧</span> SC_discr <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span> <span class="main">∨</span>
                             SC_ZObis <span class="main">(</span>Seq <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span> <span class="main">∨</span> 
                             SC_WbisT <span class="main">(</span>Seq <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">SC_Wbis</span> <span class="main">(</span>If <span class="free"><span class="bound"><span class="entity">tst</span></span></span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="keyword1">if</span> compatTst <span class="free"><span class="bound"><span class="entity">tst</span></span></span>
                             <span class="keyword1">then</span> <span class="main">(</span><span class="free">SC_Wbis</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="main">∧</span> <span class="free">SC_Wbis</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span>
                             <span class="keyword1">else</span> <span class="main">(</span>SC_ZObis <span class="main">(</span>If <span class="free"><span class="bound"><span class="entity">tst</span></span></span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span> <span class="main">∨</span> 
                                   SC_WbisT <span class="main">(</span>If <span class="free"><span class="bound"><span class="entity">tst</span></span></span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">SC_Wbis</span> <span class="main">(</span>While <span class="free"><span class="bound"><span class="entity">tst</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span>  <span class="main">⟷</span> SC_ZObis <span class="main">(</span>While <span class="free"><span class="bound"><span class="entity">tst</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">∨</span> 
                             SC_WbisT <span class="main">(</span>While <span class="free"><span class="bound"><span class="entity">tst</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">SC_Wbis</span> <span class="main">(</span>Par <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span>    <span class="main">⟷</span> <span class="main">(</span><span class="free">SC_Wbis</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="main">∧</span> <span class="free">SC_Wbis</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span> <span class="main">∨</span>
                             SC_ZObis <span class="main">(</span>Par <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span> <span class="main">∨</span> 
                             SC_WbisT <span class="main">(</span>Par <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">SC_BisT</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">SC_BisT</span> <span class="main">(</span>Atm <span class="free"><span class="bound"><span class="entity">atm</span></span></span><span class="main">)</span>      <span class="main">⟷</span> compatAtm <span class="free"><span class="bound"><span class="entity">atm</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">SC_BisT</span> <span class="main">(</span>Seq <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span>    <span class="main">⟷</span> <span class="main">(</span><span class="free">SC_BisT</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="main">∧</span> <span class="free">SC_BisT</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span> <span class="main">∨</span>
                             SC_discr <span class="main">(</span>Seq <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span> <span class="main">∨</span> 
                             SC_WbisT <span class="main">(</span>Seq <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">SC_BisT</span> <span class="main">(</span>If <span class="free"><span class="bound"><span class="entity">tst</span></span></span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="keyword1">if</span> compatTst <span class="free"><span class="bound"><span class="entity">tst</span></span></span>
                             <span class="keyword1">then</span> <span class="main">(</span><span class="free">SC_BisT</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="main">∧</span> <span class="free">SC_BisT</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span>
                             <span class="keyword1">else</span> <span class="main">(</span>SC_discr <span class="main">(</span>If <span class="free"><span class="bound"><span class="entity">tst</span></span></span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span> <span class="main">∨</span> 
                                   SC_WbisT <span class="main">(</span>If <span class="free"><span class="bound"><span class="entity">tst</span></span></span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">SC_BisT</span> <span class="main">(</span>While <span class="free"><span class="bound"><span class="entity">tst</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span>  <span class="main">⟷</span> <span class="main">(</span><span class="keyword1">if</span> compatTst <span class="free"><span class="bound"><span class="entity">tst</span></span></span>
                             <span class="keyword1">then</span> <span class="free">SC_BisT</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span>
                             <span class="keyword1">else</span> <span class="main">(</span>SC_discr <span class="main">(</span>While <span class="free"><span class="bound"><span class="entity">tst</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">∨</span> 
                                   SC_WbisT <span class="main">(</span>While <span class="free"><span class="bound"><span class="entity">tst</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">SC_BisT</span> <span class="main">(</span>Par <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span>    <span class="main">⟷</span> <span class="main">(</span><span class="free">SC_BisT</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="main">∧</span> <span class="free">SC_BisT</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span> <span class="main">∨</span>
                             SC_discr <span class="main">(</span>Par <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span> <span class="main">∨</span> 
                             SC_WbisT <span class="main">(</span>Par <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">theorem</span></span> SC_discr<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"SC_discr <span class="free">c</span> <span class="main">⟹</span> discr <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">c</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> SC_siso<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"SC_siso <span class="free">c</span> <span class="main">⟹</span> siso <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">c</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> SC_siso_imp_SC_WbisT<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"SC_siso <span class="free">c</span> <span class="main">⟹</span> SC_WbisT <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">c</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> SC_discr_imp_SC_WbisT<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"noWhile <span class="free">c</span> <span class="main">⟹</span> SC_discr <span class="free">c</span> <span class="main">⟹</span> SC_WbisT <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">c</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> presAtm_compatAtm<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> SC_WbisT<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"SC_WbisT <span class="free">c</span> <span class="main">⟹</span> <span class="free">c</span> <span class="keyword1">≈wT</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">c</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> SC_discr_imp_SC_ZObis<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"SC_discr <span class="free">c</span> <span class="main">⟹</span> SC_ZObis <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">c</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> presAtm_compatAtm<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> SC_siso_imp_SC_ZObis<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"SC_siso <span class="free">c</span> <span class="main">⟹</span> SC_ZObis <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">c</span></span><span class="main">)</span> <span class="operator">auto</span>
  
<span class="keyword1"><span class="command">theorem</span></span> SC_ZObis<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"SC_ZObis <span class="free">c</span> <span class="main">⟹</span> <span class="free">c</span> <span class="main">≈01</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">c</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> discr_ZObis<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> SC_ZObis_imp_SC_Wbis<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"SC_ZObis <span class="free">c</span> <span class="main">⟹</span> SC_Wbis <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">c</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> SC_WbisT_imp_SC_Wbis<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"SC_WbisT <span class="free">c</span> <span class="main">⟹</span> SC_Wbis <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">c</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> SC_Wbis<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"SC_Wbis <span class="free">c</span> <span class="main">⟹</span> <span class="free">c</span> <span class="keyword1">≈w</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">c</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> discr_ZObis<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> SC_discr_imp_SC_BisT<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"SC_discr <span class="free">c</span> <span class="main">⟹</span> SC_BisT <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">c</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> presAtm_compatAtm<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> SC_WbisT_imp_SC_BisT<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"SC_WbisT <span class="free">c</span> <span class="main">⟹</span> SC_BisT <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">c</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> SC_ZObis_imp_SC_BisT<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"SC_ZObis <span class="free">c</span> <span class="main">⟹</span> SC_BisT <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">c</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> SC_Wbis_imp_SC_BisT<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"SC_Wbis <span class="free">c</span> <span class="main">⟹</span> SC_BisT <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">c</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> SC_BisT<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"SC_BisT <span class="free">c</span> <span class="main">⟹</span> <span class="free">c</span> <span class="keyword1">≈T</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">c</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>

<span class="comment1">(* reductions *)</span>

<span class="keyword1"><span class="command">theorem</span></span> SC_WbisT_While<span class="main">:</span> <span class="quoted"><span class="quoted">"SC_WbisT <span class="main">(</span>While <span class="free">tst</span> <span class="free">c</span><span class="main">)</span> <span class="main">⟷</span> SC_WbisT <span class="free">c</span> <span class="main">∧</span> compatTst <span class="free">tst</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">theorem</span></span> SC_ZObis_While<span class="main">:</span> <span class="quoted"><span class="quoted">"SC_ZObis <span class="main">(</span>While <span class="free">tst</span> <span class="free">c</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span>compatTst <span class="free">tst</span> <span class="main">∧</span> SC_siso <span class="free">c</span><span class="main">)</span> <span class="main">∨</span> SC_discr <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> SC_ZObis_If<span class="main">:</span> <span class="quoted"><span class="quoted">"SC_ZObis <span class="main">(</span>If <span class="free">tst</span> <span class="free">c1</span> <span class="free">c2</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="keyword1">if</span> compatTst <span class="free">tst</span> <span class="keyword1">then</span> SC_ZObis <span class="free">c1</span> <span class="main">∧</span> SC_ZObis <span class="free">c2</span> <span class="keyword1">else</span> SC_discr <span class="free">c1</span> <span class="main">∧</span> SC_discr <span class="free">c2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">theorem</span></span> SC_WbisT_Seq<span class="main">:</span> <span class="quoted"><span class="quoted">"SC_WbisT <span class="main">(</span>Seq <span class="free">c1</span> <span class="free">c2</span><span class="main">)</span>  <span class="main">⟷</span> <span class="main">(</span>SC_WbisT <span class="free">c1</span> <span class="main">∧</span> SC_WbisT <span class="free">c2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> SC_ZObis_Seq<span class="main">:</span> <span class="quoted"><span class="quoted">"SC_ZObis <span class="main">(</span>Seq <span class="free">c1</span> <span class="free">c2</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span>SC_siso <span class="free">c1</span> <span class="main">∧</span> SC_ZObis <span class="free">c2</span><span class="main">)</span> <span class="main">∨</span>
                              <span class="main">(</span>SC_ZObis <span class="free">c1</span> <span class="main">∧</span> SC_discr <span class="free">c2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> SC_Wbis_Seq<span class="main">:</span> <span class="quoted"><span class="quoted">"SC_Wbis <span class="main">(</span>Seq <span class="free">c1</span> <span class="free">c2</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span>SC_WbisT <span class="free">c1</span> <span class="main">∧</span> SC_Wbis <span class="free">c2</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span>SC_Wbis <span class="free">c1</span> <span class="main">∧</span> SC_discr <span class="free">c2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> SC_BisT_Par<span class="main">:</span>
  <span class="quoted"><span class="quoted">"SC_BisT <span class="main">(</span>Par <span class="free">c1</span> <span class="free">c2</span><span class="main">)</span>    <span class="main">⟷</span> <span class="main">(</span>SC_BisT <span class="free">c1</span> <span class="main">∧</span> SC_BisT <span class="free">c2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="After_Execution">
<div class="head">
<h1>Theory After_Execution</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹After-execution security›</span></span> 

<span class="keyword1"><span class="command">theory</span></span> After_Execution
<span class="keyword2"><span class="keyword">imports</span></span> <a href="#During_Execution">During_Execution</a>
<span class="keyword2"><span class="keyword">begin</span></span> 


<span class="comment1">(* Note: For the paper, I will need the theorems as they are stated. *)</span>

<span class="keyword1"><span class="command">context</span></span> PL_Indis
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Setup for bisimilarities›</span></span>

<span class="comment1">(* Sbis: *)</span>
<span class="keyword1" id="After_Execution-Sbis_transC"><span class="command">lemma</span></span> Sbis_transC<span class="main">[</span><span class="operator">consumes</span> 3<span class="main">,</span> <span class="operator">case_names</span> Match<span class="main">]</span><span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="keyword1">≈s</span> <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> <span class="free">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="free">c'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">d'</span> <span class="free">t'</span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">d</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="free">d'</span><span class="main">,</span><span class="free">t'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s'</span> <span class="main">≈</span> <span class="free">t'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">c'</span> <span class="keyword1">≈s</span> <span class="free">d'</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms Sbis_matchC_C<span class="main">[</span><span class="operator">OF</span> 0<span class="main">]</span> 
<span class="keyword1"><span class="command">unfolding</span></span> matchC_C_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="After_Execution-Sbis_transT"><span class="command">lemma</span></span> Sbis_transT<span class="main">[</span><span class="operator">consumes</span> 3<span class="main">,</span> <span class="operator">case_names</span> Match<span class="main">]</span><span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="keyword1">≈s</span> <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> <span class="free">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="free">s'</span>"</span></span>
<span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">t'</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">d</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="free">t'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s'</span> <span class="main">≈</span> <span class="free">t'</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms Sbis_matchT_T<span class="main">[</span><span class="operator">OF</span> 0<span class="main">]</span> 
<span class="keyword1"><span class="command">unfolding</span></span> matchT_T_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="After_Execution-Sbis_transC2"><span class="command">lemma</span></span> Sbis_transC2<span class="main">[</span><span class="operator">consumes</span> 3<span class="main">,</span> <span class="operator">case_names</span> Match<span class="main">]</span><span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="keyword1">≈s</span> <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> <span class="free">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">d</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="free">d'</span><span class="main">,</span><span class="free">t'</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">c'</span> <span class="free">s'</span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="free">c'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s'</span> <span class="main">≈</span> <span class="free">t'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">c'</span> <span class="keyword1">≈s</span> <span class="free">d'</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms Sbis_matchC_C_rev<span class="main">[</span><span class="operator">OF</span> 0<span class="main">]</span> Sbis_Sym
<span class="keyword1"><span class="command">unfolding</span></span> matchC_C_def2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="After_Execution-Sbis_transT2"><span class="command">lemma</span></span> Sbis_transT2<span class="main">[</span><span class="operator">consumes</span> 3<span class="main">,</span> <span class="operator">case_names</span> Match<span class="main">]</span><span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="keyword1">≈s</span> <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> <span class="free">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">d</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="free">t'</span>"</span></span>
<span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">s'</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="free">s'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s'</span> <span class="main">≈</span> <span class="free">t'</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms Sbis_matchT_T_rev<span class="main">[</span><span class="operator">OF</span> 0<span class="main">]</span> Sbis_Sym
<span class="keyword1"><span class="command">unfolding</span></span> matchT_T_def2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="comment1">(* ZObisT: *)</span>
<span class="keyword1" id="After_Execution-ZObisT_transC"><span class="command">lemma</span></span> ZObisT_transC<span class="main">[</span><span class="operator">consumes</span> 3<span class="main">,</span> <span class="operator">case_names</span> Match MatchS<span class="main">]</span><span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="keyword1">≈01T</span> <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> <span class="free">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="free">c'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">⟦</span><span class="main">(</span><span class="free">d</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span><span class="bound">t'</span><span class="main">)</span><span class="main">;</span> <span class="free">s'</span> <span class="main">≈</span> <span class="bound">t'</span><span class="main">;</span> <span class="free">c'</span> <span class="keyword1">≈01T</span> <span class="bound">d'</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">s'</span> <span class="main">≈</span> <span class="free">t</span><span class="main">;</span> <span class="free">c'</span> <span class="keyword1">≈01T</span> <span class="free">d</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="free">thesis</span></span>
<span class="keyword1"><span class="command">using</span></span> assms ZObisT_matchC_ZOC<span class="main">[</span><span class="operator">OF</span> 0<span class="main">]</span>
<span class="keyword1"><span class="command">unfolding</span></span> matchC_ZOC_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="After_Execution-ZObisT_transT"><span class="command">lemma</span></span> ZObisT_transT<span class="main">[</span><span class="operator">consumes</span> 3<span class="main">,</span> <span class="operator">case_names</span> Match<span class="main">]</span><span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="keyword1">≈01T</span> <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> <span class="free">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="free">s'</span>"</span></span>
<span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">t'</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">d</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="free">t'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s'</span> <span class="main">≈</span> <span class="free">t'</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms ZObisT_matchT_T<span class="main">[</span><span class="operator">OF</span> 0<span class="main">]</span> 
<span class="keyword1"><span class="command">unfolding</span></span> matchT_T_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="After_Execution-ZObisT_transC2"><span class="command">lemma</span></span> ZObisT_transC2<span class="main">[</span><span class="operator">consumes</span> 3<span class="main">,</span> <span class="operator">case_names</span> Match MatchS<span class="main">]</span><span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="keyword1">≈01T</span> <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> <span class="free">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">d</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="free">d'</span><span class="main">,</span><span class="free">t'</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">c'</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">⟦</span><span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span><span class="bound">s'</span><span class="main">)</span><span class="main">;</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="free">t'</span><span class="main">;</span> <span class="bound">c'</span> <span class="keyword1">≈01T</span> <span class="free">d'</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">s</span> <span class="main">≈</span> <span class="free">t'</span><span class="main">;</span> <span class="free">c</span> <span class="keyword1">≈01T</span> <span class="free">d'</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="free">thesis</span></span> 
<span class="keyword1"><span class="command">using</span></span> assms ZObisT_matchC_ZOC_rev<span class="main">[</span><span class="operator">OF</span> 0<span class="main">]</span> ZObisT_Sym
<span class="keyword1"><span class="command">unfolding</span></span> matchC_ZOC_def2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="After_Execution-ZObisT_transT2"><span class="command">lemma</span></span> ZObisT_transT2<span class="main">[</span><span class="operator">consumes</span> 3<span class="main">,</span> <span class="operator">case_names</span> Match<span class="main">]</span><span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="keyword1">≈01T</span> <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> <span class="free">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">d</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="free">t'</span>"</span></span>
<span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">s'</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="free">s'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s'</span> <span class="main">≈</span> <span class="free">t'</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms ZObisT_matchT_T_rev<span class="main">[</span><span class="operator">OF</span> 0<span class="main">]</span> ZObisT_Sym
<span class="keyword1"><span class="command">unfolding</span></span> matchT_T_def2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="comment1">(* WbisT: *)</span>
<span class="keyword1" id="After_Execution-WbisT_transC"><span class="command">lemma</span></span> WbisT_transC<span class="main">[</span><span class="operator">consumes</span> 3<span class="main">,</span> <span class="operator">case_names</span> Match<span class="main">]</span><span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="keyword1">≈wT</span> <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> <span class="free">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="free">c'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">d'</span> <span class="free">t'</span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">d</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="free">d'</span><span class="main">,</span><span class="free">t'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s'</span> <span class="main">≈</span> <span class="free">t'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">c'</span> <span class="keyword1">≈wT</span> <span class="free">d'</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms WbisT_matchC_MC<span class="main">[</span><span class="operator">OF</span> 0<span class="main">]</span> 
<span class="keyword1"><span class="command">unfolding</span></span> matchC_MC_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="After_Execution-WbisT_transT"><span class="command">lemma</span></span> WbisT_transT<span class="main">[</span><span class="operator">consumes</span> 3<span class="main">,</span> <span class="operator">case_names</span> Match<span class="main">]</span><span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="keyword1">≈wT</span> <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> <span class="free">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="free">s'</span>"</span></span>
<span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">t'</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">d</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="free">t'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s'</span> <span class="main">≈</span> <span class="free">t'</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms WbisT_matchT_MT<span class="main">[</span><span class="operator">OF</span> 0<span class="main">]</span> 
<span class="keyword1"><span class="command">unfolding</span></span> matchT_MT_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="After_Execution-WbisT_transC2"><span class="command">lemma</span></span> WbisT_transC2<span class="main">[</span><span class="operator">consumes</span> 3<span class="main">,</span> <span class="operator">case_names</span> Match<span class="main">]</span><span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="keyword1">≈wT</span> <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> <span class="free">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">d</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="free">d'</span><span class="main">,</span><span class="free">t'</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">c'</span> <span class="free">s'</span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="free">c'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s'</span> <span class="main">≈</span> <span class="free">t'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">c'</span> <span class="keyword1">≈wT</span> <span class="free">d'</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms WbisT_matchC_MC_rev<span class="main">[</span><span class="operator">OF</span> 0<span class="main">]</span> WbisT_Sym
<span class="keyword1"><span class="command">unfolding</span></span> matchC_MC_def2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="After_Execution-WbisT_transT2"><span class="command">lemma</span></span> WbisT_transT2<span class="main">[</span><span class="operator">consumes</span> 3<span class="main">,</span> <span class="operator">case_names</span> Match<span class="main">]</span><span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="keyword1">≈wT</span> <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> <span class="free">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">d</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="free">t'</span>"</span></span>
<span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">s'</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="free">s'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s'</span> <span class="main">≈</span> <span class="free">t'</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms WbisT_matchT_MT_rev<span class="main">[</span><span class="operator">OF</span> 0<span class="main">]</span> WbisT_Sym
<span class="keyword1"><span class="command">unfolding</span></span> matchT_MT_def2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="comment1">(*  *)</span>
<span class="keyword1" id="After_Execution-WbisT_MtransC"><span class="command">lemma</span></span> WbisT_MtransC<span class="main">[</span><span class="operator">consumes</span> 3<span class="main">,</span> <span class="operator">case_names</span> Match<span class="main">]</span><span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="keyword1">≈wT</span> <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> <span class="free">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="free">c'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">d'</span> <span class="free">t'</span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">d</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="free">d'</span><span class="main">,</span><span class="free">t'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s'</span> <span class="main">≈</span> <span class="free">t'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">c'</span> <span class="keyword1">≈wT</span> <span class="free">d'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="free">c'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span> <span class="main">⟹</span> 
        <span class="free">c</span> <span class="keyword1">≈wT</span> <span class="free">d</span> <span class="main">⟹</span> <span class="free">s</span> <span class="main">≈</span> <span class="free">t</span> <span class="main">⟹</span> 
        <span class="main">(</span><span class="main">∃</span> <span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="free">d</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span><span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="free">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="free">c'</span> <span class="keyword1">≈wT</span> <span class="bound">d'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> MtransC_induct2<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Trans <span class="skolem">c</span> <span class="skolem">s</span> <span class="skolem">c'</span> <span class="skolem">s'</span> <span class="skolem">c''</span> <span class="skolem">s''</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d'</span></span> <span class="skolem"><span class="skolem">t'</span></span> <span class="keyword2"><span class="keyword">where</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">d</span><span class="main">,</span> <span class="free">t</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="skolem">d'</span><span class="main">,</span> <span class="skolem">t'</span><span class="main">)</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">≈</span> <span class="skolem">t'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="keyword1">≈wT</span> <span class="skolem">d'</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c''</span><span class="main">,</span> <span class="skolem">s''</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d''</span></span> <span class="skolem"><span class="skolem">t''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s''</span> <span class="main">≈</span> <span class="skolem">t''</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c''</span> <span class="keyword1">≈wT</span> <span class="skolem">d''</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">d'</span><span class="main">,</span> <span class="skolem">t'</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="skolem">d''</span><span class="main">,</span> <span class="skolem">t''</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> WbisT_transC<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> d <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> MtransC_Trans<span class="main">)</span> 
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">metis</span> MtransC_Refl<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="keyword1"><span class="command">using</span></span> that assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="After_Execution-WbisT_MtransT"><span class="command">lemma</span></span> WbisT_MtransT<span class="main">[</span><span class="operator">consumes</span> 3<span class="main">,</span> <span class="operator">case_names</span> Match<span class="main">]</span><span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="keyword1">≈wT</span> <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> <span class="free">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="free">s'</span>"</span></span>
<span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">t'</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">d</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="free">t'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s'</span> <span class="main">≈</span> <span class="free">t'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c''</span></span> <span class="skolem"><span class="skolem">s''</span></span> <span class="keyword2"><span class="keyword">where</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="skolem">c''</span><span class="main">,</span><span class="skolem">s''</span><span class="main">)</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c''</span><span class="main">,</span><span class="skolem">s''</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="free">s'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> MtransT_invert2<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d''</span></span> <span class="skolem"><span class="skolem">t''</span></span> <span class="keyword2"><span class="keyword">where</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">d</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="skolem">d''</span><span class="main">,</span><span class="skolem">t''</span><span class="main">)</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s''</span> <span class="main">≈</span> <span class="skolem">t''</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c''</span> <span class="keyword1">≈wT</span> <span class="skolem">d''</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1 2 4 WbisT_MtransC <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">s'</span> <span class="main">≈</span> <span class="skolem">t'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">d''</span><span class="main">,</span><span class="skolem">t''</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="skolem">t'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> 5 WbisT_transT<span class="main">)</span> 
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="keyword1"><span class="command">using</span></span> d that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> MtransC_MtransT<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="After_Execution-WbisT_MtransC2"><span class="command">lemma</span></span> WbisT_MtransC2<span class="main">[</span><span class="operator">consumes</span> 3<span class="main">,</span> <span class="operator">case_names</span> Match<span class="main">]</span><span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="keyword1">≈wT</span> <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> <span class="free">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">d</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="free">d'</span><span class="main">,</span><span class="free">t'</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">c'</span> <span class="free">s'</span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="free">c'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s'</span> <span class="main">≈</span> <span class="free">t'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">c'</span> <span class="keyword1">≈wT</span> <span class="free">d'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="keyword1">≈wT</span> <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≈</span> <span class="free">s</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> WbisT_Sym indis_sym<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c'</span></span> <span class="skolem"><span class="skolem">s'</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span><span class="skolem">s'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t'</span> <span class="main">≈</span> <span class="skolem">s'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">d'</span> <span class="keyword1">≈wT</span> <span class="skolem">c'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> 1 WbisT_MtransC<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> WbisT_Sym indis_sym<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="After_Execution-WbisT_MtransT2"><span class="command">lemma</span></span> WbisT_MtransT2<span class="main">[</span><span class="operator">consumes</span> 3<span class="main">,</span> <span class="operator">case_names</span> Match<span class="main">]</span><span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="keyword1">≈wT</span> <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> <span class="free">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">d</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="free">t'</span>"</span></span>
<span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">s'</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="free">s'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s'</span> <span class="main">≈</span> <span class="free">t'</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> WbisT_MtransT WbisT_Sym assms indis_sym<span class="main">)</span>

<span class="comment1">(* ZObis: *)</span>
<span class="keyword1" id="After_Execution-ZObis_transC"><span class="command">lemma</span></span> ZObis_transC<span class="main">[</span><span class="operator">consumes</span> 3<span class="main">,</span> <span class="operator">case_names</span> Match MatchO MatchS<span class="main">]</span><span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≈01</span> <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> <span class="free">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="free">c'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">⟦</span><span class="main">(</span><span class="free">d</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span><span class="bound">t'</span><span class="main">)</span><span class="main">;</span> <span class="free">s'</span> <span class="main">≈</span> <span class="bound">t'</span><span class="main">;</span> <span class="free">c'</span> <span class="main">≈01</span> <span class="bound">d'</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span> 
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">⟦</span><span class="main">(</span><span class="free">d</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">t'</span><span class="main">;</span> <span class="free">s'</span> <span class="main">≈</span> <span class="bound">t'</span><span class="main">;</span> discr <span class="free">c'</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">s'</span> <span class="main">≈</span> <span class="free">t</span><span class="main">;</span> <span class="free">c'</span> <span class="main">≈01</span> <span class="free">d</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="free">thesis</span></span>
<span class="keyword1"><span class="command">using</span></span> assms ZObis_matchC_ZO<span class="main">[</span><span class="operator">OF</span> 0<span class="main">]</span> 
<span class="keyword1"><span class="command">unfolding</span></span> matchC_ZO_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="After_Execution-ZObis_transT"><span class="command">lemma</span></span> ZObis_transT<span class="main">[</span><span class="operator">consumes</span> 3<span class="main">,</span> <span class="operator">case_names</span> Match MatchO MatchS<span class="main">]</span><span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≈01</span> <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> <span class="free">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="free">s'</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">⟦</span><span class="main">(</span><span class="free">d</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">t'</span><span class="main">;</span> <span class="free">s'</span> <span class="main">≈</span> <span class="bound">t'</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">⟦</span><span class="main">(</span><span class="free">d</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span><span class="bound">t'</span><span class="main">)</span><span class="main">;</span> <span class="free">s'</span> <span class="main">≈</span> <span class="bound">t'</span><span class="main">;</span> discr <span class="bound">d'</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">s'</span> <span class="main">≈</span> <span class="free">t</span><span class="main">;</span> discr <span class="free">d</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="free">thesis</span></span>
<span class="keyword1"><span class="command">using</span></span> assms ZObis_matchT_ZO<span class="main">[</span><span class="operator">OF</span> 0<span class="main">]</span> 
<span class="keyword1"><span class="command">unfolding</span></span> matchT_ZO_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="After_Execution-ZObis_transC2"><span class="command">lemma</span></span> ZObis_transC2<span class="main">[</span><span class="operator">consumes</span> 3<span class="main">,</span> <span class="operator">case_names</span> Match MatchO MatchS<span class="main">]</span><span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≈01</span> <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> <span class="free">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">d</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="free">d'</span><span class="main">,</span><span class="free">t'</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">c'</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">⟦</span><span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span><span class="bound">s'</span><span class="main">)</span><span class="main">;</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="free">t'</span><span class="main">;</span> <span class="bound">c'</span> <span class="main">≈01</span> <span class="free">d'</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">⟦</span><span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">s'</span><span class="main">;</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="free">t'</span><span class="main">;</span> discr <span class="free">d'</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">s</span> <span class="main">≈</span> <span class="free">t'</span><span class="main">;</span> <span class="free">c</span> <span class="main">≈01</span> <span class="free">d'</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="free">thesis</span></span> 
<span class="keyword1"><span class="command">using</span></span> assms ZObis_matchC_ZO_rev<span class="main">[</span><span class="operator">OF</span> 0<span class="main">]</span> ZObis_Sym
<span class="keyword1"><span class="command">unfolding</span></span> matchC_ZO_def2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="After_Execution-ZObis_transT2"><span class="command">lemma</span></span> ZObis_transT2<span class="main">[</span><span class="operator">consumes</span> 3<span class="main">,</span> <span class="operator">case_names</span> Match MatchO MatchS<span class="main">]</span><span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≈01</span> <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> <span class="free">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">d</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="free">t'</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">⟦</span><span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="bound">s'</span><span class="main">;</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="free">t'</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">c'</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">⟦</span><span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span><span class="bound">s'</span><span class="main">)</span><span class="main">;</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="free">t'</span><span class="main">;</span> discr <span class="bound">c'</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">s</span> <span class="main">≈</span> <span class="free">t'</span><span class="main">;</span> discr <span class="free">c</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="free">thesis</span></span>
<span class="keyword1"><span class="command">using</span></span> assms ZObis_matchT_ZO_rev<span class="main">[</span><span class="operator">OF</span> 0<span class="main">]</span> ZObis_Sym
<span class="keyword1"><span class="command">unfolding</span></span> matchT_ZO_def2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="comment1">(* Wbis: *)</span>
<span class="keyword1" id="After_Execution-Wbis_transC"><span class="command">lemma</span></span> Wbis_transC<span class="main">[</span><span class="operator">consumes</span> 3<span class="main">,</span> <span class="operator">case_names</span> Match MatchO<span class="main">]</span><span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="keyword1">≈w</span> <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> <span class="free">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="free">c'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">⟦</span><span class="main">(</span><span class="free">d</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span><span class="bound">t'</span><span class="main">)</span><span class="main">;</span> <span class="free">s'</span> <span class="main">≈</span> <span class="bound">t'</span><span class="main">;</span> <span class="free">c'</span> <span class="keyword1">≈w</span> <span class="bound">d'</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span> 
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">⟦</span><span class="main">(</span><span class="free">d</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="bound">t'</span><span class="main">;</span> <span class="free">s'</span> <span class="main">≈</span> <span class="bound">t'</span><span class="main">;</span> discr <span class="free">c'</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="free">thesis</span></span>
<span class="keyword1"><span class="command">using</span></span> assms Wbis_matchC_M<span class="main">[</span><span class="operator">OF</span> 0<span class="main">]</span> 
<span class="keyword1"><span class="command">unfolding</span></span> matchC_M_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="After_Execution-Wbis_transT"><span class="command">lemma</span></span> Wbis_transT<span class="main">[</span><span class="operator">consumes</span> 3<span class="main">,</span> <span class="operator">case_names</span> Match MatchO<span class="main">]</span><span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="keyword1">≈w</span> <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> <span class="free">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="free">s'</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">⟦</span><span class="main">(</span><span class="free">d</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="bound">t'</span><span class="main">;</span> <span class="free">s'</span> <span class="main">≈</span> <span class="bound">t'</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">⟦</span><span class="main">(</span><span class="free">d</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span><span class="bound">t'</span><span class="main">)</span><span class="main">;</span> <span class="free">s'</span> <span class="main">≈</span> <span class="bound">t'</span><span class="main">;</span> discr <span class="bound">d'</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="free">thesis</span></span>
<span class="keyword1"><span class="command">using</span></span> assms Wbis_matchT_M<span class="main">[</span><span class="operator">OF</span> 0<span class="main">]</span> 
<span class="keyword1"><span class="command">unfolding</span></span> matchT_M_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="After_Execution-Wbis_transC2"><span class="command">lemma</span></span> Wbis_transC2<span class="main">[</span><span class="operator">consumes</span> 3<span class="main">,</span> <span class="operator">case_names</span> Match MatchO<span class="main">]</span><span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="keyword1">≈w</span> <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> <span class="free">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">d</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="free">d'</span><span class="main">,</span><span class="free">t'</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">c'</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">⟦</span><span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span><span class="bound">s'</span><span class="main">)</span><span class="main">;</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="free">t'</span><span class="main">;</span> <span class="bound">c'</span> <span class="keyword1">≈w</span> <span class="free">d'</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">⟦</span><span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="bound">s'</span><span class="main">;</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="free">t'</span><span class="main">;</span> discr <span class="free">d'</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="free">thesis</span></span> 
<span class="keyword1"><span class="command">using</span></span> assms Wbis_matchC_M_rev<span class="main">[</span><span class="operator">OF</span> 0<span class="main">]</span> Wbis_Sym
<span class="keyword1"><span class="command">unfolding</span></span> matchC_M_def2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="After_Execution-Wbis_transT2"><span class="command">lemma</span></span> Wbis_transT2<span class="main">[</span><span class="operator">consumes</span> 3<span class="main">,</span> <span class="operator">case_names</span> Match MatchO<span class="main">]</span><span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="keyword1">≈w</span> <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> <span class="free">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">d</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="free">t'</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">⟦</span><span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="bound">s'</span><span class="main">;</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="free">t'</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">c'</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">⟦</span><span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span><span class="bound">s'</span><span class="main">)</span><span class="main">;</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="free">t'</span><span class="main">;</span> discr <span class="bound">c'</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="free">thesis</span></span>
<span class="keyword1"><span class="command">using</span></span> assms Wbis_matchT_M_rev<span class="main">[</span><span class="operator">OF</span> 0<span class="main">]</span> Wbis_Sym
<span class="keyword1"><span class="command">unfolding</span></span> matchT_M_def2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="comment1">(*  *)</span>
<span class="keyword1" id="After_Execution-Wbis_MtransC"><span class="command">lemma</span></span> Wbis_MtransC<span class="main">[</span><span class="operator">consumes</span> 3<span class="main">,</span> <span class="operator">case_names</span> Match MatchO<span class="main">]</span><span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="keyword1">≈w</span> <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> <span class="free">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="free">c'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">⟦</span><span class="main">(</span><span class="free">d</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span><span class="bound">t'</span><span class="main">)</span><span class="main">;</span> <span class="free">s'</span> <span class="main">≈</span> <span class="bound">t'</span><span class="main">;</span> <span class="free">c'</span> <span class="keyword1">≈w</span> <span class="bound">d'</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">⟦</span><span class="main">(</span><span class="free">d</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="bound">t'</span><span class="main">;</span> <span class="free">s'</span> <span class="main">≈</span> <span class="bound">t'</span><span class="main">;</span> discr <span class="free">c'</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="free">thesis</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="free">c'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span> <span class="main">⟹</span> 
        <span class="free">c</span> <span class="keyword1">≈w</span> <span class="free">d</span> <span class="main">⟹</span> <span class="free">s</span> <span class="main">≈</span> <span class="free">t</span> <span class="main">⟹</span> 
        <span class="main">(</span><span class="main">∃</span> <span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="free">d</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span><span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="free">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="free">c'</span> <span class="keyword1">≈w</span> <span class="bound">d'</span><span class="main">)</span> <span class="main">∨</span> 
        <span class="main">(</span><span class="main">∃</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="free">d</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="free">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> discr <span class="free">c'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> MtransC_induct2<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Trans <span class="skolem">c</span> <span class="skolem">s</span> <span class="skolem">c'</span> <span class="skolem">s'</span> <span class="skolem">c''</span> <span class="skolem">s''</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> c's'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c''</span><span class="main">,</span> <span class="skolem">s''</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>  
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="free">d</span><span class="main">,</span> <span class="free">t</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">c'</span> <span class="keyword1">≈w</span> <span class="bound">d'</span><span class="main">)</span> <span class="main">∨</span>
     <span class="main">(</span><span class="main">∃</span><span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="free">d</span><span class="main">,</span> <span class="free">t</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> discr <span class="skolem">c'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">∨</span> <span class="var">?B</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">elim</span> disjE exE conjE<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">d'</span> <span class="skolem">t'</span>
      <span class="keyword3"><span class="command">assume</span></span> c'd'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="keyword1">≈w</span> <span class="skolem">d'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> s't'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">≈</span> <span class="skolem">t'</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> dt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">d</span><span class="main">,</span> <span class="free">t</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="skolem">d'</span><span class="main">,</span> <span class="skolem">t'</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">from</span></span> c'd' s't' c's' <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Wbis_transC<span class="main">)</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dt MtransC_Trans MtransC_MtransT<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t'</span>
      <span class="keyword3"><span class="command">assume</span></span> s't'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">≈</span> <span class="skolem">t'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"discr <span class="skolem">c'</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> dt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">d</span><span class="main">,</span> <span class="free">t</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="skolem">t'</span>"</span></span> 
      <span class="keyword1"><span class="command">from</span></span> c' s't' c's' <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> discr.simps dt indis_sym indis_trans<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="After_Execution-Wbis_MtransT"><span class="command">lemma</span></span> Wbis_MtransT<span class="main">[</span><span class="operator">consumes</span> 3<span class="main">,</span> <span class="operator">case_names</span> Match MatchO<span class="main">]</span><span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> c_d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="keyword1">≈w</span> <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> st<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> <span class="free">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> cs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="free">s'</span>"</span></span> 
<span class="keyword2"><span class="keyword">and</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">⟦</span><span class="main">(</span><span class="free">d</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="bound">t'</span><span class="main">;</span> <span class="free">s'</span> <span class="main">≈</span> <span class="bound">t'</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">⟦</span><span class="main">(</span><span class="free">d</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span><span class="bound">t'</span><span class="main">)</span><span class="main">;</span> <span class="free">s'</span> <span class="main">≈</span> <span class="bound">t'</span><span class="main">;</span> discr <span class="bound">d'</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="free">thesis</span></span>
<span class="keyword1"><span class="command">using</span></span> cs <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">elim</span> MtransT_invert2<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c''</span> <span class="skolem">s''</span> <span class="keyword3"><span class="command">assume</span></span> cs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="skolem">c''</span><span class="main">,</span><span class="skolem">s''</span><span class="main">)</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> c''s''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c''</span><span class="main">,</span><span class="skolem">s''</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="free">s'</span>"</span></span> 
  <span class="keyword1"><span class="command">from</span></span> c_d st cs <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Wbis_MtransC<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">d''</span> <span class="skolem">t''</span> 
    <span class="keyword3"><span class="command">assume</span></span> dt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">d</span><span class="main">,</span> <span class="free">t</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="skolem">d''</span><span class="main">,</span> <span class="skolem">t''</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> s''t''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s''</span> <span class="main">≈</span> <span class="skolem">t''</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c''d''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c''</span> <span class="keyword1">≈w</span> <span class="skolem">d''</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> c''d'' s''t'' c''s'' <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Wbis_transT<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> 1 2 dt MtransC_MtransT MtransC_Trans<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>MatchO <span class="skolem">t'</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> 1 c''s''
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> discr_MtransT indis_sym indis_trans transT_MtransT<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="After_Execution-Wbis_MtransC2"><span class="command">lemma</span></span> Wbis_MtransC2<span class="main">[</span><span class="operator">consumes</span> 3<span class="main">,</span> <span class="operator">case_names</span> Match MatchO<span class="main">]</span><span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="keyword1">≈w</span> <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> <span class="free">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> dt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">d</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="free">d'</span><span class="main">,</span><span class="free">t'</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">c'</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">⟦</span><span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span><span class="bound">s'</span><span class="main">)</span><span class="main">;</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="free">t'</span><span class="main">;</span> <span class="bound">c'</span> <span class="keyword1">≈w</span> <span class="free">d'</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">⟦</span><span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="bound">s'</span><span class="main">;</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="free">t'</span><span class="main">;</span> discr <span class="free">d'</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="free">thesis</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> dc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="keyword1">≈w</span> <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ts<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≈</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms Wbis_Sym indis_sym<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> dc ts dt <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Wbis_MtransC<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> 1 2 Wbis_Sym indis_sym<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="After_Execution-Wbis_MtransT2"><span class="command">lemma</span></span> Wbis_MtransT2<span class="main">[</span><span class="operator">consumes</span> 3<span class="main">,</span> <span class="operator">case_names</span> Match MatchO<span class="main">]</span><span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="keyword1">≈w</span> <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> <span class="free">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> dt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">d</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="free">t'</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">⟦</span><span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="bound">s'</span><span class="main">;</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="free">t'</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">c'</span> <span class="bound">s'</span><span class="main">.</span> <span class="main">⟦</span><span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="bound">c'</span><span class="main">,</span><span class="bound">s'</span><span class="main">)</span><span class="main">;</span> <span class="bound">s'</span> <span class="main">≈</span> <span class="free">t'</span><span class="main">;</span> discr <span class="bound">c'</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">thesis</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="free">thesis</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> dc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="keyword1">≈w</span> <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ts<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≈</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms Wbis_Sym indis_sym<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">from</span></span> dc ts dt <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Wbis_MtransT<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> 1 2 Wbis_Sym indis_sym<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* BisT: *)</span>
<span class="keyword1" id="After_Execution-BisT_transC"><span class="command">lemma</span></span> BisT_transC<span class="main">[</span><span class="operator">consumes</span> 5<span class="main">,</span> <span class="operator">case_names</span> Match<span class="main">]</span><span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="keyword1">≈T</span> <span class="free">d</span>"</span></span> 
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"mustT <span class="free">c</span> <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"mustT <span class="free">d</span> <span class="free">t</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> <span class="free">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="free">c'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">d'</span> <span class="free">t'</span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">d</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="free">d'</span><span class="main">,</span><span class="free">t'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s'</span> <span class="main">≈</span> <span class="free">t'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">c'</span> <span class="keyword1">≈T</span> <span class="free">d'</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms BisT_matchC_TMC<span class="main">[</span><span class="operator">OF</span> 0<span class="main">]</span> 
<span class="keyword1"><span class="command">unfolding</span></span> matchC_TMC_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="After_Execution-BisT_transT"><span class="command">lemma</span></span> BisT_transT<span class="main">[</span><span class="operator">consumes</span> 5<span class="main">,</span> <span class="operator">case_names</span> Match<span class="main">]</span><span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="keyword1">≈T</span> <span class="free">d</span>"</span></span> 
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"mustT <span class="free">c</span> <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"mustT <span class="free">d</span> <span class="free">t</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> <span class="free">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="free">s'</span>"</span></span>
<span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">t'</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">d</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="free">t'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s'</span> <span class="main">≈</span> <span class="free">t'</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms BisT_matchT_TMT<span class="main">[</span><span class="operator">OF</span> 0<span class="main">]</span> 
<span class="keyword1"><span class="command">unfolding</span></span> matchT_TMT_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="After_Execution-BisT_transC2"><span class="command">lemma</span></span> BisT_transC2<span class="main">[</span><span class="operator">consumes</span> 5<span class="main">,</span> <span class="operator">case_names</span> Match<span class="main">]</span><span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="keyword1">≈T</span> <span class="free">d</span>"</span></span> 
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"mustT <span class="free">c</span> <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"mustT <span class="free">d</span> <span class="free">t</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> <span class="free">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">d</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="free">d'</span><span class="main">,</span><span class="free">t'</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">c'</span> <span class="free">s'</span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="free">c'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s'</span> <span class="main">≈</span> <span class="free">t'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">c'</span> <span class="keyword1">≈T</span> <span class="free">d'</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms BisT_matchC_TMC_rev<span class="main">[</span><span class="operator">OF</span> 0<span class="main">]</span> BisT_Sym
<span class="keyword1"><span class="command">unfolding</span></span> matchC_TMC_def2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="After_Execution-BisT_transT2"><span class="command">lemma</span></span> BisT_transT2<span class="main">[</span><span class="operator">consumes</span> 5<span class="main">,</span> <span class="operator">case_names</span> Match<span class="main">]</span><span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="keyword1">≈T</span> <span class="free">d</span>"</span></span> 
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"mustT <span class="free">c</span> <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"mustT <span class="free">d</span> <span class="free">t</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> <span class="free">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">d</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="free">t'</span>"</span></span>
<span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">s'</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="free">s'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s'</span> <span class="main">≈</span> <span class="free">t'</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms BisT_matchT_TMT_rev<span class="main">[</span><span class="operator">OF</span> 0<span class="main">]</span> BisT_Sym
<span class="keyword1"><span class="command">unfolding</span></span> matchT_TMT_def2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="comment1">(*  *)</span>
<span class="keyword1" id="After_Execution-BisT_MtransC"><span class="command">lemma</span></span> BisT_MtransC<span class="main">[</span><span class="operator">consumes</span> 5<span class="main">,</span> <span class="operator">case_names</span> Match<span class="main">]</span><span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="keyword1">≈T</span> <span class="free">d</span>"</span></span> 
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"mustT <span class="free">c</span> <span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"mustT <span class="free">d</span> <span class="free">t</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> <span class="free">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="free">c'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">d'</span> <span class="free">t'</span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">d</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="free">d'</span><span class="main">,</span><span class="free">t'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s'</span> <span class="main">≈</span> <span class="free">t'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">c'</span> <span class="keyword1">≈T</span> <span class="free">d'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="free">c'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span> <span class="main">⟹</span> 
        mustT <span class="free">c</span> <span class="free">s</span> <span class="main">⟹</span> mustT <span class="free">d</span> <span class="free">t</span> <span class="main">⟹</span> 
        <span class="free">c</span> <span class="keyword1">≈T</span> <span class="free">d</span> <span class="main">⟹</span> <span class="free">s</span> <span class="main">≈</span> <span class="free">t</span> <span class="main">⟹</span> 
        <span class="main">(</span><span class="main">∃</span> <span class="bound">d'</span> <span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="free">d</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="bound">d'</span><span class="main">,</span><span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span> <span class="free">s'</span> <span class="main">≈</span> <span class="bound">t'</span> <span class="main">∧</span> <span class="free">c'</span> <span class="keyword1">≈T</span> <span class="bound">d'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> MtransC_induct2<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Trans <span class="skolem">c</span> <span class="skolem">s</span> <span class="skolem">c'</span> <span class="skolem">s'</span> <span class="skolem">c''</span> <span class="skolem">s''</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d'</span></span> <span class="skolem"><span class="skolem">t'</span></span> <span class="keyword2"><span class="keyword">where</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">d</span><span class="main">,</span> <span class="free">t</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="skolem">d'</span><span class="main">,</span> <span class="skolem">t'</span><span class="main">)</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">≈</span> <span class="skolem">t'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="keyword1">≈T</span> <span class="skolem">d'</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> c's'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c'</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">c''</span><span class="main">,</span> <span class="skolem">s''</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mustT <span class="skolem">c'</span> <span class="skolem">s'</span>"</span></span> <span class="quoted"><span class="quoted">"mustT <span class="skolem">d'</span> <span class="skolem">t'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Trans mustT_MtransC d<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d''</span></span> <span class="skolem"><span class="skolem">t''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s''</span> <span class="main">≈</span> <span class="skolem">t''</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c''</span> <span class="keyword1">≈T</span> <span class="skolem">d''</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">d'</span><span class="main">,</span> <span class="skolem">t'</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="skolem">d''</span><span class="main">,</span> <span class="skolem">t''</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> BisT_transC<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> d <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> MtransC_Trans<span class="main">)</span> 
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">metis</span> MtransC_Refl<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="keyword1"><span class="command">using</span></span> that assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="After_Execution-BisT_MtransT"><span class="command">lemma</span></span> BisT_MtransT<span class="main">[</span><span class="operator">consumes</span> 5<span class="main">,</span> <span class="operator">case_names</span> Match<span class="main">]</span><span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="keyword1">≈T</span> <span class="free">d</span>"</span></span> 
<span class="keyword2"><span class="keyword">and</span></span> ter<span class="main">:</span> <span class="quoted"><span class="quoted">"mustT <span class="free">c</span> <span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"mustT <span class="free">d</span> <span class="free">t</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> <span class="free">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="free">s'</span>"</span></span>
<span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">t'</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">d</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="free">t'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s'</span> <span class="main">≈</span> <span class="free">t'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c''</span></span> <span class="skolem"><span class="skolem">s''</span></span> <span class="keyword2"><span class="keyword">where</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="skolem">c''</span><span class="main">,</span><span class="skolem">s''</span><span class="main">)</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c''</span><span class="main">,</span><span class="skolem">s''</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="free">s'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> MtransT_invert2<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d''</span></span> <span class="skolem"><span class="skolem">t''</span></span> <span class="keyword2"><span class="keyword">where</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">d</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="skolem">d''</span><span class="main">,</span><span class="skolem">t''</span><span class="main">)</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s''</span> <span class="main">≈</span> <span class="skolem">t''</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c''</span> <span class="keyword1">≈T</span> <span class="skolem">d''</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1 2 ter 4 BisT_MtransC <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mustT <span class="skolem">c''</span> <span class="skolem">s''</span>"</span></span> <span class="quoted"><span class="quoted">"mustT <span class="skolem">d''</span> <span class="skolem">t''</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> d 4 assms mustT_MtransC<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">s'</span> <span class="main">≈</span> <span class="skolem">t'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">d''</span><span class="main">,</span><span class="skolem">t''</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="skolem">t'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> 5 ter BisT_transT<span class="main">)</span> 
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="keyword1"><span class="command">using</span></span> d that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> MtransC_MtransT<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="After_Execution-BisT_MtransC2"><span class="command">lemma</span></span> BisT_MtransC2<span class="main">[</span><span class="operator">consumes</span> 3<span class="main">,</span> <span class="operator">case_names</span> Match<span class="main">]</span><span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="keyword1">≈T</span> <span class="free">d</span>"</span></span> 
<span class="keyword2"><span class="keyword">and</span></span> ter<span class="main">:</span> <span class="quoted"><span class="quoted">"mustT <span class="free">c</span> <span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"mustT <span class="free">d</span> <span class="free">t</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> <span class="free">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">d</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="free">d'</span><span class="main">,</span><span class="free">t'</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">c'</span> <span class="free">s'</span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="free">c'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s'</span> <span class="main">≈</span> <span class="free">t'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">c'</span> <span class="keyword1">≈T</span> <span class="free">d'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="keyword1">≈T</span> <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">≈</span> <span class="free">s</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> BisT_Sym indis_sym<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c'</span></span> <span class="skolem"><span class="skolem">s'</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="skolem">c'</span><span class="main">,</span><span class="skolem">s'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t'</span> <span class="main">≈</span> <span class="skolem">s'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">d'</span> <span class="keyword1">≈T</span> <span class="skolem">c'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> 1 ter BisT_MtransC<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> BisT_Sym indis_sym<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="After_Execution-BisT_MtransT02"><span class="command">lemma</span></span> BisT_MtransT02<span class="main">[</span><span class="operator">consumes</span> 3<span class="main">,</span> <span class="operator">case_names</span> Match<span class="main">]</span><span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="keyword1">≈T</span> <span class="free">d</span>"</span></span> 
<span class="keyword2"><span class="keyword">and</span></span> ter<span class="main">:</span> <span class="quoted"><span class="quoted">"mustT <span class="free">c</span> <span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"mustT <span class="free">d</span> <span class="free">t</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> <span class="free">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">d</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="free">t'</span>"</span></span>
<span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">s'</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="free">s'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s'</span> <span class="main">≈</span> <span class="free">t'</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> BisT_MtransT BisT_Sym assms indis_sym<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Execution traces›</span></span>

<span class="comment1">(* Partial traces, modeled as lists of configurations *)</span> 
<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">parTrace</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">parTrace</span> <span class="main">[]</span> <span class="main">⟷</span> False"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">parTrace</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">cf</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">cfl</span></span></span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">cfl</span></span></span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟶</span> <span class="free">parTrace</span> <span class="free"><span class="bound"><span class="entity">cfl</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">cf</span></span></span> <span class="keyword1">→c</span> hd <span class="free"><span class="bound"><span class="entity">cfl</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="After_Execution-trans_Step2"><span class="command">lemma</span></span> trans_Step2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">cf</span> <span class="keyword1">→*c</span> <span class="free">cf'</span> <span class="main">⟹</span> <span class="free">cf'</span> <span class="keyword1">→c</span> <span class="free">cf''</span> <span class="main">⟹</span> <span class="free">cf</span> <span class="keyword1">→*c</span> <span class="free">cf''</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> trans_Step<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"fst <span class="free">cf</span>"</span></span> <span class="quoted"><span class="quoted">"snd <span class="free">cf</span>"</span></span> <span class="quoted"><span class="quoted">"fst <span class="free">cf'</span>"</span></span> <span class="quoted"><span class="quoted">"snd <span class="free">cf'</span>"</span></span> <span class="quoted"><span class="quoted">"fst <span class="free">cf''</span>"</span></span> <span class="quoted"><span class="quoted">"snd <span class="free">cf''</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="After_Execution-parTrace_not_empty"><span class="command">lemma</span></span> parTrace_not_empty<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"parTrace <span class="free">cfl</span> <span class="main">⟹</span> <span class="free">cfl</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">cfl</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main">)</span> <span class="operator">simp</span>

<span class="keyword1" id="After_Execution-parTrace_snoc"><span class="command">lemma</span></span> parTrace_snoc<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"parTrace <span class="main">(</span><span class="free">cfl</span><span class="main">@</span><span class="main">[</span><span class="free">cf</span><span class="main">]</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">cfl</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟶</span> parTrace <span class="free">cfl</span> <span class="main">∧</span> last <span class="free">cfl</span> <span class="keyword1">→c</span> <span class="free">cf</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">cfl</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="After_Execution-MtransC_Ex_parTrace"><span class="command">lemma</span></span> MtransC_Ex_parTrace<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">cf</span> <span class="keyword1">→*c</span> <span class="free">cf'</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">cfl</span><span class="main">.</span> parTrace <span class="bound">cfl</span> <span class="main">∧</span> hd <span class="bound">cfl</span> <span class="main">=</span> <span class="free">cf</span> <span class="main">∧</span> last <span class="bound">cfl</span> <span class="main">=</span> <span class="free">cf'</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> MtransC_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Refl <span class="skolem">cf</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">cf</span><span class="main">]</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Trans <span class="skolem">cf</span> <span class="skolem">cf'</span> <span class="skolem">cf''</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">cfl</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"parTrace <span class="skolem">cfl</span>"</span></span> <span class="quoted"><span class="quoted">"hd <span class="skolem">cfl</span> <span class="main">=</span> <span class="skolem">cf</span>"</span></span> <span class="quoted"><span class="quoted">"last <span class="skolem">cfl</span> <span class="main">=</span> <span class="skolem">cf'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">cf'</span> <span class="keyword1">→c</span> <span class="skolem">cf''</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cfl</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">cf''</span><span class="main">]</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="After_Execution-parTrace_imp_MtransC"><span class="command">lemma</span></span> parTrace_imp_MtransC<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> pT<span class="main">:</span> <span class="quoted"><span class="quoted">"parTrace <span class="free">cfl</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>hd <span class="free">cfl</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span>last <span class="free">cfl</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> pT <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">cfl</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>snoc <span class="skolem">cf</span> <span class="skolem">cfl</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> trans_Step2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"hd <span class="skolem">cfl</span>"</span></span> <span class="quoted"><span class="quoted">"last <span class="skolem">cfl</span>"</span></span> <span class="quoted"><span class="skolem">cf</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="comment1">(* Finite traces, modeled as pairs (partial trace, state): *)</span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">finTrace</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">finTrace</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">cfl</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">⟷</span>  
 parTrace <span class="free"><span class="bound"><span class="entity">cfl</span></span></span> <span class="main">∧</span> last <span class="free"><span class="bound"><span class="entity">cfl</span></span></span> <span class="keyword1">→t</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span>

<span class="keyword1"><span class="command">declare</span></span> finTrace.simps<span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>

<span class="comment1">(* The length of a finite trace *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">lengthFT</span> <span class="free"><span class="bound"><span class="entity">tr</span></span></span> <span class="main">≡</span> Suc <span class="main">(</span>length <span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">tr</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="comment1">(* The final state of a finite trace *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">fstate</span> <span class="free"><span class="bound"><span class="entity">tr</span></span></span> <span class="main">≡</span> snd <span class="free"><span class="bound"><span class="entity">tr</span></span></span>"</span></span>

<span class="comment1">(* The initial configuration of a finite trace *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">iconfig</span> <span class="free"><span class="bound"><span class="entity">tr</span></span></span> <span class="main">≡</span> hd <span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">tr</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="After_Execution-MtransT_Ex_finTrace"><span class="command">lemma</span></span> MtransT_Ex_finTrace<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">cf</span> <span class="keyword1">→*t</span> <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">tr</span><span class="main">.</span> finTrace <span class="bound">tr</span> <span class="main">∧</span> iconfig <span class="bound">tr</span> <span class="main">=</span> <span class="free">cf</span> <span class="main">∧</span> fstate <span class="bound">tr</span> <span class="main">=</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">cf</span> <span class="keyword1">→*t</span> <span class="free">s</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">cf'</span></span> <span class="skolem"><span class="skolem">cfl</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"parTrace <span class="skolem">cfl</span>"</span></span> <span class="quoted"><span class="quoted">"hd <span class="skolem">cfl</span> <span class="main">=</span> <span class="free">cf</span>"</span></span> <span class="quoted"><span class="quoted">"last <span class="skolem">cfl</span> <span class="keyword1">→t</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> MtransT.simps <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> MtransC_Ex_parTrace<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> finTrace.simps iconfig_def fstate_def
             <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cfl</span>"</span></span><span class="main"><span class="main">]</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">s</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="After_Execution-finTrace_imp_MtransT"><span class="command">lemma</span></span> finTrace_imp_MtransT<span class="main">:</span>
  <span class="quoted"><span class="quoted">"finTrace <span class="free">tr</span> <span class="main">⟹</span> iconfig <span class="free">tr</span> <span class="keyword1">→*t</span> fstate <span class="free">tr</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> parTrace_imp_MtransC<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"fst <span class="free">tr</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">tr</span></span><span class="main">)</span>
     <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iconfig_def fstate_def finTrace.simps MtransT.simps
           <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> split_paired_Ex<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span>
<span class="quoted"><span class="plain_text">‹Relationship between during-execution and after-execution security›</span></span>

<span class="comment1">(* For the termination-sensitive versions: *)</span>

<span class="keyword1" id="After_Execution-WbisT_trace2"><span class="command">lemma</span></span> WbisT_trace2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> bis<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="keyword1">≈wT</span> <span class="free">d</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> <span class="free">t</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> tr<span class="main">:</span> <span class="quoted"><span class="quoted">"finTrace <span class="free">tr</span>"</span></span> <span class="quoted"><span class="quoted">"iconfig <span class="free">tr</span> <span class="main">=</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">tr'</span><span class="main">.</span> finTrace <span class="bound">tr'</span> <span class="main">∧</span> iconfig <span class="bound">tr'</span> <span class="main">=</span> <span class="main">(</span><span class="free">d</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="main">∧</span> fstate <span class="free">tr</span> <span class="main">≈</span> fstate <span class="bound">tr'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> tr finTrace_imp_MtransT<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">tr</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">→*t</span> fstate <span class="free">tr</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> WbisT_MtransT<span class="main">[</span><span class="operator">OF</span> bis this<span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">d</span><span class="main">,</span> <span class="free">t</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="skolem">t'</span>"</span></span> <span class="quoted"><span class="quoted">"fstate <span class="free">tr</span> <span class="main">≈</span> <span class="skolem">t'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> MtransT_Ex_finTrace<span class="main">[</span><span class="operator">OF</span> this<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> this<span class="main">(</span>2<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> WbisT_trace<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="keyword1">≈wT</span> <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> <span class="free">t</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finTrace <span class="free">tr</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"iconfig <span class="free">tr</span> <span class="main">=</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">tr'</span><span class="main">.</span> finTrace <span class="bound">tr'</span> <span class="main">∧</span> iconfig <span class="bound">tr'</span> <span class="main">=</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="main">∧</span> fstate <span class="free">tr</span> <span class="main">≈</span> fstate <span class="bound">tr'</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> WbisT_trace2<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">theorem</span></span> ZObisT_trace2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> bis<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="keyword1">≈01T</span> <span class="free">d</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> <span class="free">t</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> tr<span class="main">:</span> <span class="quoted"><span class="quoted">"finTrace <span class="free">tr</span>"</span></span> <span class="quoted"><span class="quoted">"iconfig <span class="free">tr</span> <span class="main">=</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">tr'</span><span class="main">.</span> finTrace <span class="bound">tr'</span> <span class="main">∧</span> iconfig <span class="bound">tr'</span> <span class="main">=</span> <span class="main">(</span><span class="free">d</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="main">∧</span>
               fstate <span class="free">tr</span> <span class="main">≈</span> fstate <span class="bound">tr'</span> <span class="main">∧</span> lengthFT <span class="bound">tr'</span> <span class="main">≤</span> lengthFT <span class="free">tr</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s'</span></span> <span class="skolem"><span class="skolem">cfl</span></span> <span class="keyword2"><span class="keyword">where</span></span> tr_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">tr</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">cfl</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">tr</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> tr <span class="keyword1"><span class="command">have</span></span> cfl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">cfl</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"parTrace <span class="skolem">cfl</span>"</span></span> <span class="quoted"><span class="quoted">"last <span class="skolem">cfl</span> <span class="keyword1">→t</span> <span class="skolem">s'</span>"</span></span> <span class="quoted"><span class="quoted">"hd <span class="skolem">cfl</span> <span class="main">=</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> finTrace.simps iconfig_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this bis
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> tr_eq fstate_def snd_conv
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">cfl</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="free">d</span></span> <span class="quoted"><span class="free">s</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_nonempty_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>single <span class="skolem">cf</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> ZObisT_transT<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">c</span></span> <span class="quoted"><span class="skolem">d</span></span> <span class="quoted"><span class="skolem">s</span></span> <span class="quoted"><span class="skolem">t</span></span> <span class="quoted"><span class="skolem">s'</span></span><span class="main">]</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">d</span><span class="main">,</span><span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="skolem">t'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">≈</span> <span class="skolem">t'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cf</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">c</span><span class="main">,</span><span class="skolem">s</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">(</span></span></span><span class="main"><span class="main"><span class="main">[</span></span></span><span class="main"><span class="main"><span class="main">(</span></span></span><span class="skolem"><span class="skolem"><span class="skolem">d</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span><span class="skolem"><span class="skolem"><span class="skolem">t</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">t'</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> finTrace.simps parTrace_def iconfig_def fstate_def lengthFT_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>cons <span class="skolem">cf</span> <span class="skolem">cfl</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> cfl<span class="main">:</span> <span class="quoted"><span class="quoted">"parTrace <span class="skolem">cfl</span>"</span></span> <span class="quoted"><span class="quoted">"last <span class="skolem">cfl</span> <span class="keyword1">→t</span> <span class="skolem">s'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">from</span></span> cons <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c</span><span class="main">,</span><span class="skolem">s</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span>fst <span class="main">(</span>hd <span class="skolem">cfl</span><span class="main">)</span><span class="main">,</span> snd <span class="main">(</span>hd <span class="skolem">cfl</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> parTrace_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hd_conv_nth<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c</span> <span class="keyword1">≈01T</span> <span class="skolem">d</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">≈</span> <span class="skolem">t</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> ZObisT_transC<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> MatchS
      <span class="keyword1"><span class="command">from</span></span> cons<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> cfl _ this<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lengthFT_def le_Suc_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Match <span class="skolem">d'</span> <span class="skolem">t'</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> cons<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> cfl _ Match<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">cfl'</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"finTrace <span class="main">(</span><span class="skolem">cfl'</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"hd <span class="skolem">cfl'</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">d'</span><span class="main">,</span> <span class="skolem">t'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">≈</span> <span class="skolem">s</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">cfl'</span> <span class="main">≤</span> length <span class="skolem">cfl</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iconfig_def lengthFT_def<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> Match<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">(</span></span></span><span class="main"><span class="main"><span class="main">(</span></span></span><span class="skolem"><span class="skolem"><span class="skolem">d</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span><span class="skolem"><span class="skolem"><span class="skolem">t</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main"><span class="main">#</span></span></span><span class="skolem"><span class="skolem"><span class="skolem">cfl'</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">s</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
           <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iconfig_def lengthFT_def finTrace.simps<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> ZObisT_trace<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="keyword1">≈01T</span> <span class="free">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finTrace <span class="free">tr</span>"</span></span> <span class="quoted"><span class="quoted">"iconfig <span class="free">tr</span> <span class="main">=</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">tr'</span><span class="main">.</span> finTrace <span class="bound">tr'</span> <span class="main">∧</span> iconfig <span class="bound">tr'</span> <span class="main">=</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="main">∧</span>
               fstate <span class="free">tr</span> <span class="main">≈</span> fstate <span class="bound">tr'</span> <span class="main">∧</span> lengthFT <span class="bound">tr'</span> <span class="main">≤</span> lengthFT <span class="free">tr</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ZObisT_trace2<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">theorem</span></span> Sbis_trace<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> bis<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="keyword1">≈s</span> <span class="free">d</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> tr<span class="main">:</span> <span class="quoted"><span class="quoted">"finTrace <span class="free">tr</span>"</span></span> <span class="quoted"><span class="quoted">"iconfig <span class="free">tr</span> <span class="main">=</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">tr'</span><span class="main">.</span> finTrace <span class="bound">tr'</span> <span class="main">∧</span> iconfig <span class="bound">tr'</span> <span class="main">=</span> <span class="main">(</span><span class="free">d</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="main">∧</span> fstate <span class="free">tr</span> <span class="main">≈</span> fstate <span class="bound">tr'</span> <span class="main">∧</span>
               lengthFT <span class="bound">tr'</span> <span class="main">=</span> lengthFT <span class="free">tr</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s'</span></span> <span class="skolem"><span class="skolem">cfl</span></span> <span class="keyword2"><span class="keyword">where</span></span> tr_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">tr</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">cfl</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">tr</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> tr <span class="keyword1"><span class="command">have</span></span> cfl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">cfl</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"parTrace <span class="skolem">cfl</span>"</span></span> <span class="quoted"><span class="quoted">"last <span class="skolem">cfl</span> <span class="keyword1">→t</span> <span class="skolem">s'</span>"</span></span> <span class="quoted"><span class="quoted">"hd <span class="skolem">cfl</span> <span class="main">=</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> finTrace.simps iconfig_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this bis
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> tr_eq fstate_def snd_conv
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">cfl</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="free">d</span></span> <span class="quoted"><span class="free">s</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_nonempty_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>single <span class="skolem">cf</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> Sbis_transT<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">c</span></span> <span class="quoted"><span class="skolem">d</span></span> <span class="quoted"><span class="skolem">s</span></span> <span class="quoted"><span class="skolem">t</span></span> <span class="quoted"><span class="skolem">s'</span></span><span class="main">]</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">d</span><span class="main">,</span><span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→t</span> <span class="skolem">t'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">≈</span> <span class="skolem">t'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cf</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">c</span><span class="main">,</span><span class="skolem">s</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> single <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">(</span></span></span><span class="main"><span class="main"><span class="main">[</span></span></span><span class="main"><span class="main"><span class="main">(</span></span></span><span class="skolem"><span class="skolem"><span class="skolem">d</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span><span class="skolem"><span class="skolem"><span class="skolem">t</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">t'</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lengthFT_def iconfig_def indis_refl finTrace.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>cons <span class="skolem">cf</span> <span class="skolem">cfl</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> Sbis_transC<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">c</span></span> <span class="quoted"><span class="skolem">d</span></span> <span class="quoted"><span class="skolem">s</span></span> <span class="quoted"><span class="skolem">t</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>hd <span class="skolem">cfl</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>hd <span class="skolem">cfl</span><span class="main">)</span>"</span></span><span class="main">]</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d'</span></span> <span class="skolem"><span class="skolem">t'</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">d</span><span class="main">,</span><span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→c</span> <span class="main">(</span><span class="skolem">d'</span><span class="main">,</span><span class="skolem">t'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>hd <span class="skolem">cfl</span><span class="main">)</span> <span class="main">≈</span> <span class="skolem">t'</span>"</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>hd <span class="skolem">cfl</span><span class="main">)</span> <span class="keyword1">≈s</span> <span class="skolem">d'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> cons<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>hd <span class="skolem">cfl</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>hd <span class="skolem">cfl</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">d'</span></span> <span class="quoted"><span class="skolem">t'</span></span><span class="main">]</span> cons<span class="main">(</span>1<span class="main">,</span>3<span class="main">,</span>4<span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">cfl'</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"finTrace <span class="main">(</span><span class="skolem">cfl'</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"hd <span class="skolem">cfl'</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">d'</span><span class="main">,</span> <span class="skolem">t'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">≈</span> <span class="skolem">s</span>"</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">cfl'</span> <span class="main">=</span> length <span class="skolem">cfl</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iconfig_def lengthFT_def<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">(</span></span></span><span class="main"><span class="main"><span class="main">(</span></span></span><span class="skolem"><span class="skolem"><span class="skolem">d</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span><span class="skolem"><span class="skolem"><span class="skolem">t</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main"><span class="main">#</span></span></span><span class="skolem"><span class="skolem"><span class="skolem">cfl'</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">s</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> finTrace.simps lengthFT_def iconfig_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> siso_trace<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"siso <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> <span class="free">t</span>"</span></span> 
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"finTrace <span class="free">tr</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"iconfig <span class="free">tr</span> <span class="main">=</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> 
<span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">tr'</span><span class="main">.</span> finTrace <span class="bound">tr'</span> <span class="main">∧</span> iconfig <span class="bound">tr'</span> <span class="main">=</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="main">∧</span> fstate <span class="free">tr</span> <span class="main">≈</span> fstate <span class="bound">tr'</span>
        <span class="main">∧</span> lengthFT <span class="bound">tr'</span> <span class="main">=</span> lengthFT <span class="free">tr</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Sbis_trace<span class="main">)</span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="comment1">(* For the termination-insensitive versions: *)</span>
<span class="keyword1"><span class="command">theorem</span></span> Wbis_trace<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> T<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> mustT <span class="free">c</span> <span class="bound">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> bis<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="keyword1">≈w</span> <span class="free">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> tr<span class="main">:</span> <span class="quoted"><span class="quoted">"finTrace <span class="free">tr</span>"</span></span> <span class="quoted"><span class="quoted">"iconfig <span class="free">tr</span> <span class="main">=</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">tr'</span><span class="main">.</span> finTrace <span class="bound">tr'</span> <span class="main">∧</span> iconfig <span class="bound">tr'</span> <span class="main">=</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="main">∧</span> fstate <span class="free">tr</span> <span class="main">≈</span> fstate <span class="bound">tr'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> tr finTrace_imp_MtransT<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">tr</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">→*t</span> fstate <span class="free">tr</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> bis this
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Wbis_MtransT<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Match <span class="skolem">t'</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> MtransT_Ex_finTrace<span class="main">[</span><span class="operator">OF</span> this<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> this<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>MatchO <span class="skolem">d'</span> <span class="skolem">t'</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> T<span class="main">[</span><span class="operator">THEN</span> mustT_MtransC<span class="main">,</span> <span class="operator">OF</span> MatchO<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mustT <span class="skolem">d'</span> <span class="skolem">t'</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">THEN</span> mustT_MtransT<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">d'</span><span class="main">,</span> <span class="skolem">t'</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="skolem">s'</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">from</span></span> MatchO<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">d'</span><span class="main">,</span> <span class="skolem">t'</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="skolem">s'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="free">t</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="skolem">s'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> MtransC_MtransT<span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> MtransT_Ex_finTrace<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹discr <span class="skolem">d'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">d'</span><span class="main">,</span> <span class="skolem">t'</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="skolem">s'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span> <span class="main">≈</span> <span class="skolem">s'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> discr_MtransT<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹fstate <span class="free">tr</span> <span class="main">≈</span> <span class="skolem">t'</span>›</span></span><span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fstate <span class="free">tr</span> <span class="main">≈</span> <span class="skolem">s'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> indis_trans<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> ZObis_trace<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> T<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> mustT <span class="free">c</span> <span class="bound">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> ZObis<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≈01</span> <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> indis<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> tr<span class="main">:</span> <span class="quoted"><span class="quoted">"finTrace <span class="free">tr</span>"</span></span> <span class="quoted"><span class="quoted">"iconfig <span class="free">tr</span> <span class="main">=</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">tr'</span><span class="main">.</span> finTrace <span class="bound">tr'</span> <span class="main">∧</span> iconfig <span class="bound">tr'</span> <span class="main">=</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="main">∧</span> fstate <span class="free">tr</span> <span class="main">≈</span> fstate <span class="bound">tr'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Wbis_trace<span class="main"><span class="main">[</span></span><span class="operator">OF</span> T bis_imp<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> ZObis<span class="main"><span class="main">]</span></span> indis tr<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="comment1">(* For the mustT-interactive notion: *)</span>

<span class="keyword1"><span class="command">theorem</span></span> BisT_trace<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> bis<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="keyword1">≈T</span> <span class="free">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≈</span> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> T<span class="main">:</span> <span class="quoted"><span class="quoted">"mustT <span class="free">c</span> <span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"mustT <span class="free">c</span> <span class="free">t</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> tr<span class="main">:</span> <span class="quoted"><span class="quoted">"finTrace <span class="free">tr</span>"</span></span> <span class="quoted"><span class="quoted">"iconfig <span class="free">tr</span> <span class="main">=</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">tr'</span><span class="main">.</span> finTrace <span class="bound">tr'</span> <span class="main">∧</span> iconfig <span class="bound">tr'</span> <span class="main">=</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="main">∧</span> fstate <span class="free">tr</span> <span class="main">≈</span> fstate <span class="bound">tr'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> tr finTrace_imp_MtransT<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">tr</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="keyword1">→*t</span> fstate <span class="free">tr</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> BisT_MtransT<span class="main">[</span><span class="operator">OF</span> bis<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> T bis<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> this<span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">t</span><span class="main">)</span> <span class="keyword1">→*t</span> <span class="skolem">t'</span>"</span></span> <span class="quoted"><span class="quoted">"fstate <span class="free">tr</span> <span class="main">≈</span> <span class="skolem">t'</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">from</span></span> MtransT_Ex_finTrace<span class="main">[</span><span class="operator">OF</span> this<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> this<span class="main">(</span>2<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> 
<span class="comment1">(* context PL_Indis  *)</span>


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Concrete">
<div class="head">
<h1>Theory Concrete</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Concrete setting›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Concrete 
<span class="keyword2"><span class="keyword">imports</span></span> <a href="#Syntactic_Criteria">Syntactic_Criteria</a> <a href="#After_Execution">After_Execution</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> PL_Indis<span class="main">)</span> WbisT_If_cross<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c1</span> <span class="keyword1">≈wT</span> <span class="free">c2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">c1</span> <span class="keyword1">≈wT</span> <span class="free">c1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">c2</span> <span class="keyword1">≈wT</span> <span class="free">c2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>If <span class="free">tst</span> <span class="free">c1</span> <span class="free">c2</span><span class="main">)</span> <span class="keyword1">≈wT</span> <span class="main">(</span>If <span class="free">tst</span> <span class="free">c1</span> <span class="free">c2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">φ</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">φ</span> <span class="skolem">c</span> <span class="skolem">d</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">c1'</span> <span class="bound">c2'</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">=</span> If <span class="free">tst</span> <span class="bound">c1'</span> <span class="bound">c2'</span> <span class="main">∧</span> <span class="skolem">d</span> <span class="main">=</span> If <span class="free">tst</span> <span class="bound">c1'</span> <span class="bound">c2'</span> <span class="main">∧</span> <span class="bound">c1'</span> <span class="keyword1">≈wT</span> <span class="bound">c2'</span> <span class="main">∧</span> <span class="bound">c1'</span> <span class="keyword1">≈wT</span> <span class="bound">c1'</span> <span class="main">∧</span> <span class="bound">c2'</span> <span class="keyword1">≈wT</span> <span class="bound">c2'</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">c</span> <span class="skolem">d</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">φ</span> <span class="main">(</span>If <span class="free">tst</span> <span class="free">c1</span> <span class="free">c2</span><span class="main">)</span> <span class="main">(</span>If <span class="free">tst</span> <span class="free">c1</span> <span class="free">c2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> WbisT_coinduct<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> φ<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">φ</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>cont <span class="skolem">c</span> <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span> <span class="skolem">c'</span> <span class="skolem">s'</span><span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> cont<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> cont <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c1</span></span> <span class="skolem"><span class="skolem">c2</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> φ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> If <span class="free">tst</span> <span class="skolem">c1</span> <span class="skolem">c2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> If <span class="free">tst</span> <span class="skolem">c1</span> <span class="skolem">c2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span> <span class="keyword1">≈wT</span> <span class="skolem">c2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span> <span class="keyword1">≈wT</span> <span class="skolem">c1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c2</span> <span class="keyword1">≈wT</span> <span class="skolem">c2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> φ_def<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c2</span> <span class="keyword1">≈wT</span> <span class="skolem">c1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> WbisT_sym <span class="keyword1"><span class="command">unfolding</span></span> sym_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">d</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">→*c</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">tval</span> <span class="free">tst</span> <span class="skolem">t</span> <span class="keyword1">then</span> <span class="skolem">c1</span> <span class="keyword1">else</span> <span class="skolem">c2</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="main">≈</span> <span class="skolem">t</span> <span class="main">∧</span>
      <span class="main">(</span><span class="skolem">φ</span> <span class="skolem">c'</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">tval</span> <span class="free">tst</span> <span class="skolem">t</span> <span class="keyword1">then</span> <span class="skolem">c1</span> <span class="keyword1">else</span> <span class="skolem">c2</span><span class="main">)</span> <span class="main">∨</span> <span class="skolem">c'</span> <span class="keyword1">≈wT</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">tval</span> <span class="free">tst</span> <span class="skolem">t</span> <span class="keyword1">then</span> <span class="skolem">c1</span> <span class="keyword1">else</span> <span class="skolem">c2</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> φ_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> φ_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹

We instatiate the following notions, kept generic so far:

\begin{itemize}
  \item On the language syntax: 
  \begin{itemize}
    \item atoms, tests and states just like at the possibilistic case; 
    \item choices, to either if-choices (based on tests) or binary fixed-probability choices; 
    \item the schedulers, to the uniform one
  \end{itemize}
  \item On the security semantics, the lattice of levels and the indis relation, again, just like at the possibilistic case. 
\end{itemize}
›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> level <span class="main">=</span> Lo <span class="main">|</span> Hi

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">l</span><span class="main">.</span> <span class="bound">l</span> <span class="main">≠</span> Hi <span class="main">⟷</span> <span class="bound">l</span> <span class="main">=</span> Lo"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
      <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">l</span><span class="main">.</span> Hi <span class="main">≠</span> <span class="bound">l</span> <span class="main">⟷</span> Lo <span class="main">=</span> <span class="bound">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
      <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">l</span><span class="main">.</span> <span class="bound">l</span> <span class="main">≠</span> Lo <span class="main">⟷</span> <span class="bound">l</span> <span class="main">=</span> Hi"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
      <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">l</span><span class="main">.</span> Lo <span class="main">≠</span> <span class="bound">l</span> <span class="main">⟷</span> Hi <span class="main">=</span> <span class="bound">l</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> level.exhaust level.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">dest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">l</span> <span class="bound">A</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">l</span> <span class="main">∈</span> <span class="bound">A</span><span class="main">;</span> Lo <span class="main">∉</span> <span class="bound">A</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="bound">l</span> <span class="main">=</span> Hi"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
      <span class="main">[</span><span class="operator">dest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">l</span> <span class="bound">A</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">l</span> <span class="main">∈</span> <span class="bound">A</span><span class="main">;</span> Hi <span class="main">∉</span> <span class="bound">A</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="bound">l</span> <span class="main">=</span> Lo"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> level.exhaust<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">declare</span></span> level.split<span class="main">[</span><span class="operator">split</span><span class="main">]</span>

<span class="keyword1"><span class="command">instantiation</span></span> level <span class="main">::</span> <span class="quoted">complete_lattice</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">definition</span></span> top_level<span class="main">:</span> <span class="quoted"><span class="quoted">"top <span class="main">≡</span> Hi"</span></span>
  <span class="keyword1"><span class="command">definition</span></span> bot_level<span class="main">:</span> <span class="quoted"><span class="quoted">"bot <span class="main">≡</span> Lo"</span></span>
  <span class="keyword1"><span class="command">definition</span></span> inf_level<span class="main">:</span> <span class="quoted"><span class="quoted">"inf <span class="free"><span class="bound"><span class="entity">l1</span></span></span> <span class="free"><span class="bound"><span class="entity">l2</span></span></span> <span class="main">≡</span> <span class="keyword1">if</span> Lo <span class="main">∈</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">l1</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">l2</span></span></span><span class="main">}</span> <span class="keyword1">then</span> Lo <span class="keyword1">else</span> Hi"</span></span>
  <span class="keyword1"><span class="command">definition</span></span> sup_level<span class="main">:</span> <span class="quoted"><span class="quoted">"sup <span class="free"><span class="bound"><span class="entity">l1</span></span></span> <span class="free"><span class="bound"><span class="entity">l2</span></span></span> <span class="main">≡</span> <span class="keyword1">if</span> Hi <span class="main">∈</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">l1</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">l2</span></span></span><span class="main">}</span> <span class="keyword1">then</span> Hi <span class="keyword1">else</span> Lo"</span></span>
  <span class="keyword1"><span class="command">definition</span></span> less_eq_level<span class="main">:</span> <span class="quoted"><span class="quoted">"less_eq <span class="free"><span class="bound"><span class="entity">l1</span></span></span> <span class="free"><span class="bound"><span class="entity">l2</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">l1</span></span></span> <span class="main">=</span> Lo <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">l2</span></span></span> <span class="main">=</span> Hi<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">definition</span></span> less_level<span class="main">:</span> <span class="quoted"><span class="quoted">"less <span class="free"><span class="bound"><span class="entity">l1</span></span></span> <span class="free"><span class="bound"><span class="entity">l2</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">l1</span></span></span> <span class="main">=</span> Lo <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">l2</span></span></span> <span class="main">=</span> Hi"</span></span>
  <span class="keyword1"><span class="command">definition</span></span> Inf_level<span class="main">:</span> <span class="quoted"><span class="quoted">"Inf <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="main">≡</span> <span class="keyword1">if</span> Lo <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="keyword1">then</span> Lo <span class="keyword1">else</span> Hi"</span></span>
  <span class="keyword1"><span class="command">definition</span></span> Sup_level<span class="main">:</span> <span class="quoted"><span class="quoted">"Sup <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="main">≡</span> <span class="keyword1">if</span> Hi <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="keyword1">then</span> Hi <span class="keyword1">else</span> Lo"</span></span>
<span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> top_level bot_level inf_level sup_level
                        less_eq_level less_level Inf_level Sup_level<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="Concrete-sup_eq_Lo"><span class="command">lemma</span></span> sup_eq_Lo<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"sup <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> Lo <span class="main">⟷</span> <span class="free">a</span> <span class="main">=</span> Lo <span class="main">∧</span> <span class="free">b</span> <span class="main">=</span> Lo"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sup_level<span class="main">)</span>

<span class="keyword1"><span class="command">datatype</span></span> var <span class="main">=</span> h <span class="main">|</span> h' <span class="main">|</span> l <span class="main">|</span> l'
<span class="keyword1"><span class="command">datatype</span></span> exp <span class="main">=</span> Ct <span class="quoted">nat</span> <span class="main">|</span> Var <span class="quoted">var</span> <span class="main">|</span> Plus <span class="quoted">exp</span> <span class="quoted">exp</span> <span class="main">|</span> Minus <span class="quoted">exp</span> <span class="quoted">exp</span>
<span class="keyword1"><span class="command">datatype</span></span> test <span class="main">=</span> Tr <span class="main">|</span> Eq <span class="quoted">exp</span> <span class="quoted">exp</span> <span class="main">|</span> Gt <span class="quoted">exp</span> <span class="quoted">exp</span> <span class="main">|</span> Non <span class="quoted">test</span>
<span class="keyword1"><span class="command">datatype</span></span> atom <span class="main">=</span> Assign <span class="quoted">var</span> <span class="quoted">exp</span>
<span class="keyword1"><span class="command">type_synonym</span></span> state <span class="main">=</span> <span class="quoted"><span class="quoted">"var <span class="main">⇒</span> nat"</span></span>
 
<span class="keyword1"><span class="command">syntax</span></span>
 <span class="quoted">"_assign"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>  <span class="main">(</span><span class="quoted">"_ <span class="keyword1">::=</span> _"</span> <span class="main">[</span>1000<span class="main">,</span> 61<span class="main">]</span> 61<span class="main">)</span>

<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"<span class="free">x</span> <span class="main">::=</span> <span class="free">expr</span>"</span> <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> Atm <span class="main">(</span><span class="keyword1">CONST</span> Assign <span class="free">x</span> <span class="free">expr</span><span class="main">)</span>"</span>
 
<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">sec</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sec</span> h  <span class="main">=</span> Hi"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">sec</span> h' <span class="main">=</span> Hi"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">sec</span> l  <span class="main">=</span> Lo"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">sec</span> l' <span class="main">=</span> Lo"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">eval</span> <span class="keyword2"><span class="keyword">where</span></span> 
 <span class="quoted"><span class="quoted">"<span class="free">eval</span> <span class="main">(</span>Ct <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">eval</span> <span class="main">(</span>Var <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">eval</span> <span class="main">(</span>Plus <span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="free"><span class="bound"><span class="entity">e2</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="free">eval</span> <span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">+</span> <span class="free">eval</span> <span class="free"><span class="bound"><span class="entity">e2</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">eval</span> <span class="main">(</span>Minus <span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="free"><span class="bound"><span class="entity">e2</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="free">eval</span> <span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">-</span> <span class="free">eval</span> <span class="free"><span class="bound"><span class="entity">e2</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">tval</span> <span class="keyword2"><span class="keyword">where</span></span> 
 <span class="quoted"><span class="quoted">"<span class="free">tval</span> Tr <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> True"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">tval</span> <span class="main">(</span>Eq <span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="free"><span class="bound"><span class="entity">e2</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="main">(</span>eval <span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> eval <span class="free"><span class="bound"><span class="entity">e2</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">tval</span> <span class="main">(</span>Gt <span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="free"><span class="bound"><span class="entity">e2</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="main">(</span>eval <span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">&gt;</span> eval <span class="free"><span class="bound"><span class="entity">e2</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">tval</span> <span class="main">(</span>Non <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span> <span class="free">tval</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">aval</span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">aval</span> <span class="main">(</span>Assign <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">:=</span> eval <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">indis</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>state <span class="main">*</span> state<span class="main">)</span> set"</span></span><span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="free">indis</span> <span class="main">≡</span> <span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">t</span><span class="main">)</span><span class="main">.</span> <span class="keyword1">ALL</span> <span class="bound">x</span><span class="main">.</span> sec <span class="bound">x</span> <span class="main">=</span> Lo <span class="main">⟶</span> <span class="bound">s</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">t</span> <span class="bound">x</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> Example_PL<span class="main">:</span> PL_Indis <span class="quoted">tval</span> <span class="quoted">aval</span> <span class="quoted">indis</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"equiv UNIV indis"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> refl_on_def sym_def trans_def equiv_def indis_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">exprSec</span> <span class="keyword2"><span class="keyword">where</span></span> 
 <span class="quoted"><span class="quoted">"<span class="free">exprSec</span> <span class="main">(</span>Ct <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> bot"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">exprSec</span> <span class="main">(</span>Var <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> sec <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">exprSec</span> <span class="main">(</span>Plus <span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="free"><span class="bound"><span class="entity">e2</span></span></span><span class="main">)</span> <span class="main">=</span> sup <span class="main">(</span><span class="free">exprSec</span> <span class="free"><span class="bound"><span class="entity">e1</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">exprSec</span> <span class="free"><span class="bound"><span class="entity">e2</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">exprSec</span> <span class="main">(</span>Minus <span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="free"><span class="bound"><span class="entity">e2</span></span></span><span class="main">)</span> <span class="main">=</span> sup <span class="main">(</span><span class="free">exprSec</span> <span class="free"><span class="bound"><span class="entity">e1</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">exprSec</span> <span class="free"><span class="bound"><span class="entity">e2</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">tstSec</span> <span class="keyword2"><span class="keyword">where</span></span> 
 <span class="quoted"><span class="quoted">"<span class="free">tstSec</span> Tr <span class="main">=</span> bot"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">tstSec</span> <span class="main">(</span>Eq <span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="free"><span class="bound"><span class="entity">e2</span></span></span><span class="main">)</span> <span class="main">=</span> sup <span class="main">(</span>exprSec <span class="free"><span class="bound"><span class="entity">e1</span></span></span><span class="main">)</span> <span class="main">(</span>exprSec <span class="free"><span class="bound"><span class="entity">e2</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">tstSec</span> <span class="main">(</span>Gt <span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="free"><span class="bound"><span class="entity">e2</span></span></span><span class="main">)</span> <span class="main">=</span> sup <span class="main">(</span>exprSec <span class="free"><span class="bound"><span class="entity">e1</span></span></span><span class="main">)</span> <span class="main">(</span>exprSec <span class="free"><span class="bound"><span class="entity">e2</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">tstSec</span> <span class="main">(</span>Non <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">tstSec</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span>"</span></span>

<span class="keyword1" id="Concrete-exprSec_Lo_eval_eq"><span class="command">lemma</span></span> exprSec_Lo_eval_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"exprSec <span class="free">expr</span> <span class="main">=</span> Lo <span class="main">⟹</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span> <span class="free">t</span><span class="main">)</span> <span class="main">∈</span> indis <span class="main">⟹</span> eval <span class="free">expr</span> <span class="free">s</span> <span class="main">=</span> eval <span class="free">expr</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">expr</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> indis_def<span class="main">)</span>

<span class="keyword1" id="Concrete-compatAtmSyntactic"><span class="command">lemma</span></span> compatAtmSyntactic<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"exprSec <span class="free">expr</span> <span class="main">=</span> Lo <span class="main">∨</span> sec <span class="free">v</span> <span class="main">=</span> Hi <span class="main">⟹</span> Example_PL.compatAtm <span class="main">(</span>Assign <span class="free">v</span> <span class="free">expr</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Example_PL.compatAtm_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">expr</span></span><span class="main">)</span>
     <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> indis_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> arg_cong2<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">(+)</span>"</span></span><span class="main"><span class="main">]</span></span> arg_cong2<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">(-)</span>"</span></span><span class="main"><span class="main">]</span></span> exprSec_Lo_eval_eq<span class="main">)</span>

<span class="keyword1" id="Concrete-presAtmSyntactic"><span class="command">lemma</span></span> presAtmSyntactic<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"sec <span class="free">v</span> <span class="main">=</span> Hi <span class="main">⟹</span> Example_PL.presAtm <span class="main">(</span>Assign <span class="free">v</span> <span class="free">expr</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Example_PL.presAtm_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> indis_def<span class="main">)</span>

<span class="keyword1" id="Concrete-compatTstSyntactic"><span class="command">lemma</span></span> compatTstSyntactic<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"tstSec <span class="free">tst</span> <span class="main">=</span> Lo <span class="main">⟹</span> Example_PL.compatTst <span class="free">tst</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Example_PL.compatTst_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">tst</span></span><span class="main">)</span>
     <span class="main">(</span><span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> iffI
              <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> arg_cong2<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">(=)</span>"</span></span><span class="main"><span class="main">]</span></span> arg_cong2<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">(&lt;)</span> <span class="main">::</span> nat <span class="main">⇒</span> nat <span class="main">⇒</span> bool"</span></span><span class="main"><span class="main">]</span></span> exprSec_Lo_eval_eq<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"Example_PL.SC_discr <span class="main">(</span>h <span class="main">::=</span> Ct <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Example_PL.SC_discr.simps<span class="main">)</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">siso</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">≡</span> Example_PL.siso <span class="free"><span class="bound"><span class="entity">c</span></span></span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">siso0</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">≡</span> Example_PL.siso0 <span class="free"><span class="bound"><span class="entity">c</span></span></span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">discr</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">≡</span> Example_PL.discr <span class="free"><span class="bound"><span class="entity">c</span></span></span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">discr0</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">≡</span> Example_PL.discr0 <span class="free"><span class="bound"><span class="entity">c</span></span></span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">Sbis_abbrev</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">≈s</span>"</span> 55<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="keyword1"><span class="free">≈s</span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span> <span class="main">∈</span> Example_PL.Sbis"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">ZObis_abbrev</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">≈01</span>"</span> 55<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="main"><span class="free">≈01</span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span> <span class="main">∈</span> Example_PL.ZObis"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">ZObisT_abbrev</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">≈01T</span>"</span> 55<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="keyword1"><span class="free">≈01T</span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span> <span class="main">∈</span> Example_PL.ZObisT"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">Wbis_abbrev</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">≈w</span>"</span> 55<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="keyword1"><span class="free">≈w</span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span> <span class="main">∈</span> Example_PL.Wbis"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">WbisT_abbrev</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">≈wT</span>"</span> 55<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="keyword1"><span class="free">≈wT</span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span> <span class="main">∈</span> Example_PL.WbisT"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">BisT_abbrev</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">≈T</span>"</span> 55<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="keyword1"><span class="free">≈T</span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span> <span class="main">∈</span> Example_PL.BisT"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Programs from EXAMPLE 1›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c0</span> <span class="main">=</span> <span class="main">(</span>h <span class="main">::=</span> Ct <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c1</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> Eq <span class="main">(</span>Var l<span class="main">)</span> <span class="main">(</span>Ct <span class="main">0</span><span class="main">)</span> <span class="keyword1">then</span> h <span class="main">::=</span> Ct <span class="main">1</span> <span class="keyword1">else</span> l <span class="main">::=</span> Ct <span class="numeral">2</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c2</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> Eq <span class="main">(</span>Var h<span class="main">)</span> <span class="main">(</span>Ct <span class="main">0</span><span class="main">)</span> <span class="keyword1">then</span> h <span class="main">::=</span> Ct <span class="main">1</span> <span class="keyword1">else</span> h <span class="main">::=</span> Ct <span class="numeral">2</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c3</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> Eq <span class="main">(</span>Var h<span class="main">)</span> <span class="main">(</span>Ct <span class="main">0</span><span class="main">)</span> <span class="keyword1">then</span> h <span class="main">::=</span> Ct <span class="main">1</span> <span class="main">;;</span> h <span class="main">::=</span> Ct <span class="numeral">2</span>
                                         <span class="keyword1">else</span> h <span class="main">::=</span> Ct <span class="numeral">3</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c4</span> <span class="main">=</span> l <span class="main">::=</span> Ct <span class="numeral">4</span> <span class="main">;;</span> c3"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c5</span> <span class="main">=</span> c3 <span class="main">;;</span> l <span class="main">::=</span> Ct <span class="numeral">4</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c6</span> <span class="main">=</span> l <span class="main">::=</span> Var h"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c7</span> <span class="main">=</span> l <span class="main">::=</span> Var h <span class="main">;;</span> l <span class="main">::=</span> Ct <span class="main">0</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c8</span> <span class="main">=</span> h' <span class="main">::=</span> Var h <span class="main">;;</span>
  <span class="keyword1">while</span> Gt <span class="main">(</span>Var h<span class="main">)</span> <span class="main">(</span>Ct <span class="main">0</span><span class="main">)</span> <span class="keyword1">do</span> <span class="main">(</span>h <span class="main">::=</span> Minus <span class="main">(</span>Var h<span class="main">)</span> <span class="main">(</span>Ct <span class="main">1</span><span class="main">)</span> <span class="main">;;</span> h' <span class="main">::=</span> Plus <span class="main">(</span>Var h'<span class="main">)</span> <span class="main">(</span>Ct <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">;;</span>
  l <span class="main">::=</span> Ct <span class="numeral">4</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c9</span> <span class="main">=</span> c7 <span class="main">|</span> l' <span class="main">::=</span> Var l"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c10</span> <span class="main">=</span> c5 <span class="main">|</span> l <span class="main">::=</span> Ct <span class="numeral">5</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c11</span> <span class="main">=</span> c8 <span class="main">|</span> l <span class="main">::=</span> Ct <span class="numeral">5</span>"</span></span>

<span class="keyword1"><span class="command">declare</span></span> bot_level<span class="main">[</span><span class="operator">iff</span><span class="main">]</span>

<span class="keyword1"><span class="command">theorem</span></span> c0<span class="main">:</span> <span class="quoted"><span class="quoted">"siso c0"</span></span> <span class="quoted"><span class="quoted">"discr c0"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> c1<span class="main">:</span> <span class="quoted"><span class="quoted">"siso c1"</span></span> <span class="quoted"><span class="quoted">"c1 <span class="keyword1">≈s</span> c1"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> c2<span class="main">:</span> <span class="quoted"><span class="quoted">"discr c2"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> Sbis_c2<span class="main">:</span> <span class="quoted"><span class="quoted">"c2 <span class="keyword1">≈s</span> c2"</span></span>
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">theorem</span></span> c3<span class="main">:</span> <span class="quoted"><span class="quoted">"discr c3"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> c4<span class="main">:</span> <span class="quoted"><span class="quoted">"c4 <span class="main">≈01</span> c4"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> c5<span class="main">:</span> <span class="quoted"><span class="quoted">"c5 <span class="keyword1">≈w</span> c5"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Example 4 from the paper›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> <span class="quoted"><span class="quoted">"c3 <span class="keyword1">≈wT</span> c3"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> <span class="quoted"><span class="quoted">"c5 <span class="keyword1">≈wT</span> c5"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">corollary</span></span> <span class="quoted"><span class="quoted">"discr <span class="main">(</span><span class="keyword1">while</span> Eq <span class="main">(</span>Var h<span class="main">)</span> <span class="main">(</span>Ct <span class="main">0</span><span class="main">)</span>  <span class="keyword1">do</span> h <span class="main">::=</span> Ct <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Example 5 from the paper›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c12</span> <span class="main">≡</span> h <span class="main">::=</span> Ct <span class="numeral">4</span> <span class="main">;;</span>
  <span class="keyword1">while</span> Gt <span class="main">(</span>Var h<span class="main">)</span> <span class="main">(</span>Ct <span class="main">0</span><span class="main">)</span>
    <span class="keyword1">do</span> <span class="main">(</span>h <span class="main">::=</span> Minus <span class="main">(</span>Var h<span class="main">)</span> <span class="main">(</span>Ct <span class="main">1</span><span class="main">)</span> <span class="main">;;</span> h' <span class="main">::=</span> Plus <span class="main">(</span>Var h'<span class="main">)</span> <span class="main">(</span>Ct <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">;;</span>
  l <span class="main">::=</span> Ct <span class="main">1</span>"</span></span>

<span class="keyword1"><span class="command">corollary</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>c12 <span class="main">|</span> l <span class="main">::=</span> Ct <span class="numeral">2</span><span class="main">)</span> <span class="keyword1">≈T</span> <span class="main">(</span>c12 <span class="main">|</span> l <span class="main">::=</span> Ct <span class="numeral">2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c13</span> <span class="main">=</span>
  <span class="main">(</span><span class="keyword1">if</span> Eq <span class="main">(</span>Var h<span class="main">)</span> <span class="main">(</span>Ct <span class="main">0</span><span class="main">)</span> <span class="keyword1">then</span> h <span class="main">::=</span> Ct <span class="main">1</span> <span class="main">;;</span> l <span class="main">::=</span> Ct <span class="numeral">2</span> <span class="keyword1">else</span> l <span class="main">::=</span> Ct <span class="numeral">2</span><span class="main">)</span> <span class="main">;;</span> l' <span class="main">::=</span> Ct <span class="numeral">4</span>"</span></span>

<span class="keyword1" id="Concrete-c13_inner"><span class="command">lemma</span></span> c13_inner<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>h <span class="main">::=</span> Ct <span class="main">1</span> <span class="main">;;</span> l <span class="main">::=</span> Ct <span class="numeral">2</span><span class="main">)</span> <span class="keyword1">≈wT</span> <span class="main">(</span>l <span class="main">::=</span> Ct <span class="numeral">2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">φ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">φ</span> <span class="main">=</span>
    <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">c</span> <span class="main">::</span> <span class="main">(</span>test<span class="main">,</span> atom<span class="main">)</span> com<span class="main">)</span> <span class="main">(</span><span class="bound">d</span> <span class="main">::</span> <span class="main">(</span>test<span class="main">,</span> atom<span class="main">)</span> com<span class="main">)</span><span class="main">.</span>
      <span class="bound">c</span> <span class="main">=</span> h <span class="main">::=</span> Ct <span class="main">1</span> <span class="main">;;</span> l <span class="main">::=</span> Ct <span class="numeral">2</span> <span class="main">∧</span> <span class="bound">d</span> <span class="main">=</span> l <span class="main">::=</span> Ct <span class="numeral">2</span> <span class="main">∨</span>
      <span class="bound">d</span> <span class="main">=</span> h <span class="main">::=</span> Ct <span class="main">1</span> <span class="main">;;</span> l <span class="main">::=</span> Ct <span class="numeral">2</span> <span class="main">∧</span> <span class="bound">c</span> <span class="main">=</span> l <span class="main">::=</span> Ct <span class="numeral">2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">φ</span> <span class="main">(</span>h <span class="main">::=</span> Ct <span class="main">1</span> <span class="main">;;</span> l <span class="main">::=</span> Ct <span class="numeral">2</span><span class="main">)</span> <span class="main">(</span>l <span class="main">::=</span> Ct <span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Example_PL.WbisT_coinduct<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> φ<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">φ</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> sym <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> φ_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>cont <span class="skolem">c</span> <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span> <span class="skolem">c'</span> <span class="skolem">s'</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> φ_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"l <span class="main">::=</span> Ct <span class="numeral">2</span>"</span></span><span class="main"><span class="main">]</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">t</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> indis_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">have</span></span> exec<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">t</span><span class="main">.</span> Example_PL.MtransT <span class="main">(</span>h <span class="main">::=</span> Ct <span class="main">1</span> <span class="main">;;</span> l <span class="main">::=</span> Ct <span class="numeral">2</span><span class="main">,</span> <span class="bound">t</span><span class="main">)</span> <span class="main">(</span>aval <span class="main">(</span>Assign l <span class="main">(</span>Ct <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>aval <span class="main">(</span>Assign h <span class="main">(</span>Ct <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> aval.simps<span class="main">)</span>
           <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Example_PL.transC_MtransT Example_PL.transC_MtransC.SeqT Example_PL.transT.Atm Example_PL.transT_MtransT<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>termi <span class="skolem">c</span> <span class="skolem">s</span> <span class="skolem">d</span> <span class="skolem">t</span> <span class="skolem">s'</span><span class="main">)</span> <span class="keyword1"><span class="command">with</span></span> exec <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> φ_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">(</span>h <span class="main">:=</span> <span class="main">1</span><span class="main">,</span> l <span class="main">:=</span> <span class="numeral">2</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> indis_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> <span class="quoted"><span class="quoted">"c13 <span class="keyword1">≈wT</span> c13"</span></span>
   <span class="keyword1"><span class="command">using</span></span> c13_inner
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Example_PL.Seq_WbisT Example_PL.WbisT_If_cross<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>